#!/bin/bash
# shellcheck disable=SC2086
###############################################################################
# Copyright (c) 2025, Advanced Micro Devices, Inc. All rights reserved.
#
# See LICENSE for license information.
###############################################################################

export RUN_ENV=slurm
export NUM_NODES=${NUM_NODES:-2}

SCRIPT_DIR=$(dirname "$(realpath "${BASH_SOURCE[0]}")")

     # --nodelist=smc300x-ccs-aus-a16-10 \
     # --nodelist=gpu-[21,26,42,45] \
srun -N ${NUM_NODES} \
     --exclusive \
     --ntasks-per-node=1 \
     --cpus-per-task=96 \
     -t 04:30:00 \
     --partition=amd-oci-phx-003 \
     --nodelist=uswocpm2m-059-[004,006,008,010-014,017,019-021,023,025,029-030,032,034-035,040,043-045,048,052-053,055,057-059,067-068,073,079-080,082-084,086-088,092-093,095-103,108,111-112,114-117,123,129,135-136,139,146,152-153,158,160,173-174,176,178-180,182-184,187,189-190,197,203-206,208,218,221,224,227-229,232,235,237-240,242,244,246-247,249-250,252-254,257,259-262,264,267-272,276,278,280,282,284-286,288-290,295,297-298,303,307,310-312,314,322,325-329,336-339,342-343,345-347,349-350,352,354,357,359-362,364-365,369-370,373-374,378-383,386-388,390-392,394-395,397,401,403-406,409,411-415,417,422,424-429,432,434-436,438,440,445,448-452,458-459,461-462,464,466-471,473,476-482,484-486,488,490-491,494-495,497,504-507,509-510,513-517,521-524,526-529,531,533-540,542-543,545,547-551,553,555-556,558-563,565,569-570,574-577,581,584-586,589-590,592,594-597,600-601,603-604,607,610,612-614,616-617,623,625,627,629-630,632-635,637,642,646,648,651,653,656-659,664-665,670-672,674,676,678,680,683,685-686,688-690] \
     --account=amd-oci-phx \
     bash ${SCRIPT_DIR}/run_preflight.sh 2>&1 | tee output/log_slurm_preflight.txt
