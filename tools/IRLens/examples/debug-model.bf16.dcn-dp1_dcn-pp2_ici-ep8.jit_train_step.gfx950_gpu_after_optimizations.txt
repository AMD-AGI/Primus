HloModule jit_train_step, is_scheduled=true, input_output_alias={ {0}: (0, {}, may-alias), {1}: (1, {}, may-alias), {2}: (2, {}, may-alias), {3}: (3, {}, may-alias), {4}: (4, {}, may-alias), {5}: (5, {}, may-alias), {6}: (6, {}, may-alias), {7}: (7, {}, may-alias), {8}: (8, {}, may-alias), {9}: (9, {}, may-alias), {10}: (10, {}, may-alias), {11}: (11, {}, may-alias), {12}: (12, {}, may-alias), {13}: (13, {}, may-alias), {14}: (14, {}, may-alias), {15}: (15, {}, may-alias), {16}: (16, {}, may-alias), {17}: (17, {}, may-alias), {18}: (18, {}, may-alias), {19}: (19, {}, may-alias), {20}: (20, {}, may-alias), {21}: (21, {}, may-alias), {22}: (22, {}, may-alias), {23}: (23, {}, may-alias), {24}: (24, {}, may-alias), {25}: (25, {}, may-alias), {26}: (26, {}, may-alias), {27}: (27, {}, may-alias), {28}: (28, {}, may-alias), {29}: (29, {}, may-alias), {30}: (30, {}, may-alias), {31}: (31, {}, may-alias), {32}: (32, {}, may-alias), {33}: (33, {}, may-alias), {34}: (34, {}, may-alias), {35}: (35, {}, may-alias), {36}: (36, {}, may-alias), {37}: (37, {}, may-alias), {38}: (38, {}, may-alias), {39}: (39, {}, may-alias), {40}: (40, {}, may-alias), {41}: (41, {}, may-alias), {42}: (42, {}, may-alias), {43}: (43, {}, may-alias), {44}: (44, {}, may-alias), {45}: (45, {}, may-alias), {46}: (46, {}, may-alias), {47}: (47, {}, may-alias), {48}: (48, {}, may-alias), {49}: (49, {}, may-alias), {50}: (50, {}, may-alias), {51}: (51, {}, may-alias), {52}: (52, {}, may-alias), {53}: (53, {}, may-alias), {54}: (54, {}, may-alias), {55}: (55, {}, may-alias), {56}: (56, {}, may-alias), {57}: (57, {}, may-alias), {58}: (58, {}, may-alias), {59}: (59, {}, may-alias), {60}: (60, {}, may-alias), {61}: (61, {}, may-alias), {62}: (62, {}, may-alias), {63}: (63, {}, may-alias), {64}: (64, {}, may-alias), {65}: (65, {}, may-alias), {66}: (66, {}, may-alias), {67}: (67, {}, may-alias), {68}: (68, {}, may-alias), {69}: (69, {}, may-alias), {70}: (70, {}, may-alias), {71}: (71, {}, may-alias) }, entry_computation_layout={(s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], s32[8,8192]{1,0}, s32[8,8192]{1,0}, s32[8,8192]{1,0}, /*index=75*/s32[8,8192]{1,0})->(s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[])}, allow_spmd_sharding_propagation_to_parameters={false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false}, allow_spmd_sharding_propagation_to_output={false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true}, num_partitions=16, frontend_attributes={fingerprint_before_lhs="7b4807cfa9d6cea68345e316fbcef4e7"}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.2 (p.0.lhs.34: f32[], p.0.rhs.34: f32[], p.1.lhs.34: s32[], p.1.rhs.34: s32[]) -> pred[] {
  %constant_5332_0 = s32[] constant(2147483647)
  %constant_5331_0 = s32[] constant(0)
  %p.1.rhs.34 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.34"}
  %p.1.lhs.34 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.34"}
  %p.0.rhs.34 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.34"}
  %p.0.lhs.34 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.34"}
  %compare.1662.0 = pred[] compare(%p.1.lhs.34, %p.1.rhs.34), direction=LT, metadata={scheduling_name="compare.1662.0"}
  %bitcast-convert.73.0 = s32[] bitcast-convert(%p.0.rhs.34), metadata={scheduling_name="bitcast-convert.73.0"}
  %compare.1658.0 = pred[] compare(%bitcast-convert.73.0, %constant_5331_0), direction=LT, metadata={scheduling_name="compare.1658.0"}
  %xor.73.0 = s32[] xor(%constant_5332_0, %bitcast-convert.73.0), metadata={scheduling_name="xor.73.0"}
  %select.1320.0 = s32[] select(%compare.1658.0, %xor.73.0, %bitcast-convert.73.0), metadata={scheduling_name="select.1320.0"}
  %bitcast-convert.72.0 = s32[] bitcast-convert(%p.0.lhs.34), metadata={scheduling_name="bitcast-convert.72.0"}
  %compare.1657.0 = pred[] compare(%bitcast-convert.72.0, %constant_5331_0), direction=LT, metadata={scheduling_name="compare.1657.0"}
  %xor.72.0 = s32[] xor(%constant_5332_0, %bitcast-convert.72.0), metadata={scheduling_name="xor.72.0"}
  %select.1319.0 = s32[] select(%compare.1657.0, %xor.72.0, %bitcast-convert.72.0), metadata={scheduling_name="select.1319.0"}
  %compare.1659.0 = pred[] compare(%select.1319.0, %select.1320.0), direction=GT, metadata={scheduling_name="compare.1659.0"}
  %compare.1660.0 = pred[] compare(%select.1320.0, %select.1319.0), direction=GT, metadata={scheduling_name="compare.1660.0"}
  %compare.1661.0 = pred[] compare(%compare.1659.0, %compare.1660.0), direction=EQ, metadata={scheduling_name="compare.1661.0"}
  ROOT %select.1321.0 = pred[] select(%compare.1661.0, %compare.1662.0, %compare.1659.0), metadata={scheduling_name="select.1321.0"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.3 (p.0.lhs.36: f32[], p.0.rhs.36: f32[], p.1.lhs.36: s32[], p.1.rhs.36: s32[]) -> pred[] {
  %constant_5336_0 = s32[] constant(2147483647)
  %constant_5335_0 = s32[] constant(0)
  %p.1.rhs.36 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.36"}
  %p.1.lhs.36 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.36"}
  %p.0.rhs.36 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.36"}
  %p.0.lhs.36 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.36"}
  %compare.1678.0 = pred[] compare(%p.1.lhs.36, %p.1.rhs.36), direction=LT, metadata={scheduling_name="compare.1678.0"}
  %bitcast-convert.77.0 = s32[] bitcast-convert(%p.0.rhs.36), metadata={scheduling_name="bitcast-convert.77.0"}
  %compare.1674.0 = pred[] compare(%bitcast-convert.77.0, %constant_5335_0), direction=LT, metadata={scheduling_name="compare.1674.0"}
  %xor.77.0 = s32[] xor(%constant_5336_0, %bitcast-convert.77.0), metadata={scheduling_name="xor.77.0"}
  %select.1328.0 = s32[] select(%compare.1674.0, %xor.77.0, %bitcast-convert.77.0), metadata={scheduling_name="select.1328.0"}
  %bitcast-convert.76.0 = s32[] bitcast-convert(%p.0.lhs.36), metadata={scheduling_name="bitcast-convert.76.0"}
  %compare.1673.0 = pred[] compare(%bitcast-convert.76.0, %constant_5335_0), direction=LT, metadata={scheduling_name="compare.1673.0"}
  %xor.76.0 = s32[] xor(%constant_5336_0, %bitcast-convert.76.0), metadata={scheduling_name="xor.76.0"}
  %select.1327.0 = s32[] select(%compare.1673.0, %xor.76.0, %bitcast-convert.76.0), metadata={scheduling_name="select.1327.0"}
  %compare.1675.0 = pred[] compare(%select.1327.0, %select.1328.0), direction=GT, metadata={scheduling_name="compare.1675.0"}
  %compare.1676.0 = pred[] compare(%select.1328.0, %select.1327.0), direction=GT, metadata={scheduling_name="compare.1676.0"}
  %compare.1677.0 = pred[] compare(%compare.1675.0, %compare.1676.0), direction=EQ, metadata={scheduling_name="compare.1677.0"}
  ROOT %select.1329.0 = pred[] select(%compare.1677.0, %compare.1678.0, %compare.1675.0), metadata={scheduling_name="select.1329.0"}
}

%compare-value-and-index.9.clone.clone.2 (p.0.lhs.35: f32[], p.0.rhs.35: f32[], p.1.lhs.35: s32[], p.1.rhs.35: s32[], p.2.lhs.clone.6: s32[], p.2.rhs.clone.6: s32[]) -> pred[] {
  %constant_5334_0 = s32[] constant(2147483647)
  %constant_5333_0 = s32[] constant(0)
  %p.2.rhs.clone.6 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.6"}
  %p.2.lhs.clone.6 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.6"}
  %p.1.rhs.35 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.35"}
  %p.1.lhs.35 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.35"}
  %p.0.rhs.35 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.35"}
  %p.0.lhs.35 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.35"}
  %compare.1672.0 = pred[] compare(%p.2.lhs.clone.6, %p.2.rhs.clone.6), direction=LT, metadata={scheduling_name="compare.1672.0"}
  %compare.1669.0 = pred[] compare(%p.1.rhs.35, %p.1.lhs.35), direction=LT, metadata={scheduling_name="compare.1669.0"}
  %compare.1666.0 = pred[] compare(%p.1.lhs.35, %p.1.rhs.35), direction=LT, metadata={scheduling_name="compare.1666.0"}
  %bitcast-convert.75.0 = s32[] bitcast-convert(%p.0.rhs.35), metadata={scheduling_name="bitcast-convert.75.0"}
  %compare.1664.0 = pred[] compare(%bitcast-convert.75.0, %constant_5333_0), direction=LT, metadata={scheduling_name="compare.1664.0"}
  %xor.75.0 = s32[] xor(%constant_5334_0, %bitcast-convert.75.0), metadata={scheduling_name="xor.75.0"}
  %select.1323.0 = s32[] select(%compare.1664.0, %xor.75.0, %bitcast-convert.75.0), metadata={scheduling_name="select.1323.0"}
  %compare.1670.0 = pred[] compare(%p.0.rhs.35, %p.0.lhs.35), direction=GT, metadata={scheduling_name="compare.1670.0"}
  %compare.1667.0 = pred[] compare(%p.0.lhs.35, %p.0.rhs.35), direction=GT, metadata={scheduling_name="compare.1667.0"}
  %bitcast-convert.74.0 = s32[] bitcast-convert(%p.0.lhs.35), metadata={scheduling_name="bitcast-convert.74.0"}
  %compare.1663.0 = pred[] compare(%bitcast-convert.74.0, %constant_5333_0), direction=LT, metadata={scheduling_name="compare.1663.0"}
  %xor.74.0 = s32[] xor(%constant_5334_0, %bitcast-convert.74.0), metadata={scheduling_name="xor.74.0"}
  %select.1322.0 = s32[] select(%compare.1663.0, %xor.74.0, %bitcast-convert.74.0), metadata={scheduling_name="select.1322.0"}
  %compare.1665.0 = pred[] compare(%select.1322.0, %select.1323.0), direction=EQ, metadata={scheduling_name="compare.1665.0"}
  %select.1324.0 = pred[] select(%compare.1665.0, %compare.1666.0, %compare.1667.0), metadata={scheduling_name="select.1324.0"}
  %compare.1668.0 = pred[] compare(%select.1323.0, %select.1322.0), direction=EQ, metadata={scheduling_name="compare.1668.0"}
  %select.1325.0 = pred[] select(%compare.1668.0, %compare.1669.0, %compare.1670.0), metadata={scheduling_name="select.1325.0"}
  %compare.1671.0 = pred[] compare(%select.1324.0, %select.1325.0), direction=EQ, metadata={scheduling_name="compare.1671.0"}
  ROOT %select.1326.0 = pred[] select(%compare.1671.0, %compare.1672.0, %select.1324.0), metadata={scheduling_name="select.1326.0"}
}

%compare-value-and-index.9.clone.clone.3 (p.0.lhs.37: f32[], p.0.rhs.37: f32[], p.1.lhs.37: s32[], p.1.rhs.37: s32[], p.2.lhs.clone.7: s32[], p.2.rhs.clone.7: s32[]) -> pred[] {
  %constant_5338_0 = s32[] constant(2147483647)
  %constant_5337_0 = s32[] constant(0)
  %p.2.rhs.clone.7 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.7"}
  %p.2.lhs.clone.7 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.7"}
  %p.1.rhs.37 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.37"}
  %p.1.lhs.37 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.37"}
  %p.0.rhs.37 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.37"}
  %p.0.lhs.37 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.37"}
  %compare.1688.0 = pred[] compare(%p.2.lhs.clone.7, %p.2.rhs.clone.7), direction=LT, metadata={scheduling_name="compare.1688.0"}
  %compare.1685.0 = pred[] compare(%p.1.rhs.37, %p.1.lhs.37), direction=LT, metadata={scheduling_name="compare.1685.0"}
  %compare.1682.0 = pred[] compare(%p.1.lhs.37, %p.1.rhs.37), direction=LT, metadata={scheduling_name="compare.1682.0"}
  %bitcast-convert.79.0 = s32[] bitcast-convert(%p.0.rhs.37), metadata={scheduling_name="bitcast-convert.79.0"}
  %compare.1680.0 = pred[] compare(%bitcast-convert.79.0, %constant_5337_0), direction=LT, metadata={scheduling_name="compare.1680.0"}
  %xor.79.0 = s32[] xor(%constant_5338_0, %bitcast-convert.79.0), metadata={scheduling_name="xor.79.0"}
  %select.1331.0 = s32[] select(%compare.1680.0, %xor.79.0, %bitcast-convert.79.0), metadata={scheduling_name="select.1331.0"}
  %compare.1686.0 = pred[] compare(%p.0.rhs.37, %p.0.lhs.37), direction=GT, metadata={scheduling_name="compare.1686.0"}
  %compare.1683.0 = pred[] compare(%p.0.lhs.37, %p.0.rhs.37), direction=GT, metadata={scheduling_name="compare.1683.0"}
  %bitcast-convert.78.0 = s32[] bitcast-convert(%p.0.lhs.37), metadata={scheduling_name="bitcast-convert.78.0"}
  %compare.1679.0 = pred[] compare(%bitcast-convert.78.0, %constant_5337_0), direction=LT, metadata={scheduling_name="compare.1679.0"}
  %xor.78.0 = s32[] xor(%constant_5338_0, %bitcast-convert.78.0), metadata={scheduling_name="xor.78.0"}
  %select.1330.0 = s32[] select(%compare.1679.0, %xor.78.0, %bitcast-convert.78.0), metadata={scheduling_name="select.1330.0"}
  %compare.1681.0 = pred[] compare(%select.1330.0, %select.1331.0), direction=EQ, metadata={scheduling_name="compare.1681.0"}
  %select.1332.0 = pred[] select(%compare.1681.0, %compare.1682.0, %compare.1683.0), metadata={scheduling_name="select.1332.0"}
  %compare.1684.0 = pred[] compare(%select.1331.0, %select.1330.0), direction=EQ, metadata={scheduling_name="compare.1684.0"}
  %select.1333.0 = pred[] select(%compare.1684.0, %compare.1685.0, %compare.1686.0), metadata={scheduling_name="select.1333.0"}
  %compare.1687.0 = pred[] compare(%select.1332.0, %select.1333.0), direction=EQ, metadata={scheduling_name="compare.1687.0"}
  ROOT %select.1334.0 = pred[] select(%compare.1687.0, %compare.1688.0, %select.1332.0), metadata={scheduling_name="select.1334.0"}
}

%fused_dynamic_update_slice (param_0.2416: bf16[9,1,4,8192,6144], param_1.2626: s32[], param_2.2726: bf16[4,8192,6144]) -> bf16[9,1,4,8192,6144] {
  %param_0.2416 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2416"}
  %param_2.2726 = bf16[4,8192,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2726"}
  %bitcast.25897.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_2.2726), metadata={scheduling_name="bitcast.25897.1"}
  %param_1.2626 = s32[] parameter(1), metadata={scheduling_name="param_1.2626"}
  %constant_5288_31 = s32[] constant(0)
  ROOT %dynamic-update-slice.425.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2416, %bitcast.25897.1, %param_1.2626, %constant_5288_31, %constant_5288_31, /*index=5*/%constant_5288_31, %constant_5288_31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.425.1"}
}

%fused_dynamic_update_slice.1 (param_0.2417: bf16[9,1,4,8192,48,128], param_1.2628: s32[], param_2.2702: bf16[1,4,8192,48,128]) -> bf16[9,1,4,8192,48,128] {
  %param_0.2417 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2417"}
  %param_2.2702 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2702"}
  %bitcast.25934.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} bitcast(%param_2.2702), metadata={scheduling_name="bitcast.25934.1"}
  %param_1.2628 = s32[] parameter(1), metadata={scheduling_name="param_1.2628"}
  %constant_5288_2 = s32[] constant(0)
  ROOT %dynamic-update-slice.428.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-update-slice(%param_0.2417, %bitcast.25934.1, %param_1.2628, %constant_5288_2, %constant_5288_2, /*index=5*/%constant_5288_2, %constant_5288_2, %constant_5288_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.428.1"}
}

%fused_dynamic_update_slice.2 (param_0.2418: u32[9,2,4], param_1.2630: s32[], param_2.2711: u32[2,4]) -> u32[9,2,4] {
  %param_0.2418 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2418"}
  %param_2.2711 = u32[2,4]{1,0} parameter(2), metadata={scheduling_name="param_2.2711"}
  %bitcast.25923.1 = u32[1,2,4]{2,1,0} bitcast(%param_2.2711), metadata={scheduling_name="bitcast.25923.1"}
  %param_1.2630 = s32[] parameter(1), metadata={scheduling_name="param_1.2630"}
  %constant_5288_16 = s32[] constant(0)
  ROOT %dynamic-update-slice.427.1 = u32[9,2,4]{2,1,0} dynamic-update-slice(%param_0.2418, %bitcast.25923.1, %param_1.2630, %constant_5288_16, %constant_5288_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.427.1"}
}

%fused_dynamic_update_slice.3 (param_0.2420: s32[], param_1.3491: f32[1,4,48,8192,1], param_2.2715: f32[9,1,4,48,8192,1]) -> f32[9,1,1,4,48,8192] {
  %param_2.2715 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(2), metadata={scheduling_name="param_2.2715"}
  %bitcast.25906.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_2.2715), metadata={scheduling_name="bitcast.25906.1"}
  %param_1.3491 = f32[1,4,48,8192,1]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3491"}
  %bitcast.25910.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_1.3491), metadata={scheduling_name="bitcast.25910.1"}
  %param_0.2420 = s32[] parameter(0), metadata={scheduling_name="param_0.2420"}
  %constant_5288_20 = s32[] constant(0)
  ROOT %dynamic-update-slice.426.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-update-slice(%bitcast.25906.1, %bitcast.25910.1, %param_0.2420, %constant_5288_20, %constant_5288_20, /*index=5*/%constant_5288_20, %constant_5288_20, %constant_5288_20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.426.1"}
}

%fused_dynamic_update_slice.4 (param_0.2421: bf16[9,1,4,8192,48,128], param_1.2635: s32[], param_2.2725: bf16[1,4,8192,48,128]) -> bf16[9,1,4,8192,48,128] {
  %param_0.2421 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2421"}
  %param_2.2725 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2725"}
  %bitcast.25886.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} bitcast(%param_2.2725), metadata={scheduling_name="bitcast.25886.1"}
  %param_1.2635 = s32[] parameter(1), metadata={scheduling_name="param_1.2635"}
  %constant_5288_30 = s32[] constant(0)
  ROOT %dynamic-update-slice.424.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-update-slice(%param_0.2421, %bitcast.25886.1, %param_1.2635, %constant_5288_30, %constant_5288_30, /*index=5*/%constant_5288_30, %constant_5288_30, %constant_5288_30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.424.1"}
}

%fused_dynamic_update_slice.5 (param_0.2422: u32[9,2,4], param_1.2637: s32[], param_2.2722: u32[2,4]) -> u32[9,2,4] {
  %param_0.2422 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2422"}
  %param_2.2722 = u32[2,4]{1,0} parameter(2), metadata={scheduling_name="param_2.2722"}
  %bitcast.25875.1 = u32[1,2,4]{2,1,0} bitcast(%param_2.2722), metadata={scheduling_name="bitcast.25875.1"}
  %param_1.2637 = s32[] parameter(1), metadata={scheduling_name="param_1.2637"}
  %constant_5288_27 = s32[] constant(0)
  ROOT %dynamic-update-slice.423.1 = u32[9,2,4]{2,1,0} dynamic-update-slice(%param_0.2422, %bitcast.25875.1, %param_1.2637, %constant_5288_27, %constant_5288_27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.423.1"}
}

%fused_dynamic_update_slice.6 (param_0.2424: s32[], param_1.3499: f32[1,4,48,8192,1], param_2.2724: f32[9,1,4,48,8192,1]) -> f32[9,1,1,4,48,8192] {
  %param_2.2724 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(2), metadata={scheduling_name="param_2.2724"}
  %bitcast.25858.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_2.2724), metadata={scheduling_name="bitcast.25858.1"}
  %param_1.3499 = f32[1,4,48,8192,1]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3499"}
  %bitcast.25862.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_1.3499), metadata={scheduling_name="bitcast.25862.1"}
  %param_0.2424 = s32[] parameter(0), metadata={scheduling_name="param_0.2424"}
  %constant_5288_29 = s32[] constant(0)
  ROOT %dynamic-update-slice.422.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-update-slice(%bitcast.25858.1, %bitcast.25862.1, %param_0.2424, %constant_5288_29, %constant_5288_29, /*index=5*/%constant_5288_29, %constant_5288_29, %constant_5288_29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.422.1"}
}

%fused_dynamic_update_slice.7 (param_0.2425: bf16[9,1,4,8192,6144], param_1.2642: s32[], param_2.2727: bf16[1,4,8192,6144]) -> bf16[9,1,4,8192,6144] {
  %param_0.2425 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2425"}
  %param_2.2727 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2727"}
  %bitcast.25849.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_2.2727), metadata={scheduling_name="bitcast.25849.1"}
  %param_1.2642 = s32[] parameter(1), metadata={scheduling_name="param_1.2642"}
  %constant_5288_32 = s32[] constant(0)
  ROOT %dynamic-update-slice.421.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2425, %bitcast.25849.1, %param_1.2642, %constant_5288_32, %constant_5288_32, /*index=5*/%constant_5288_32, %constant_5288_32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.421.1"}
}

%fused_dynamic_update_slice.8 (param_0.2426: bf16[1,2,4,8192,6144], param_1.3497: pred[1,4,8192,6144], param_2.2721: bf16[1,4,8192,6144], param_3.2211: bf16[4,8192,6144], param_4.1849: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.2426 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2426"}
  %param_1.3497 = pred[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3497"}
  %param_3.2211 = bf16[4,8192,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.2211"}
  %bitcast.25830.3 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_3.2211), metadata={scheduling_name="bitcast.25830.3"}
  %param_2.2721 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2721"}
  %select.1359.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%param_1.3497, %bitcast.25830.3, %param_2.2721), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1359.3"}
  %bitcast.25838.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1359.3), metadata={scheduling_name="bitcast.25838.1"}
  %constant_5288_26 = s32[] constant(0)
  %param_4.1849 = s32[] parameter(4), metadata={scheduling_name="param_4.1849"}
  %compare.1694.1 = pred[] compare(%param_4.1849, %constant_5288_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1694.1"}
  %negate.227.1 = s32[] negate(%param_4.1849), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.227.1"}
  %select.1339.3 = s32[] select(%compare.1694.1, %negate.227.1, %param_4.1849), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1339.3"}
  %constant_5286_3 = s32[] constant(1)
  %and.317.1 = s32[] and(%select.1339.3, %constant_5286_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.317.1"}
  %negate.228.1 = s32[] negate(%and.317.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.228.1"}
  %select.1340.3 = s32[] select(%compare.1694.1, %negate.228.1, %and.317.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1340.3"}
  %compare.1695.1 = pred[] compare(%select.1340.3, %constant_5288_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1695.1"}
  %compare.1696.1 = pred[] compare(%select.1340.3, %constant_5288_26), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1696.1"}
  %and.318.3 = pred[] and(%compare.1695.1, %compare.1696.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.318.3"}
  %constant_5292_2 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.2972.3 = s32[] add(%select.1340.3, %constant_5292_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2972.3"}
  %select.1341.2 = s32[] select(%and.318.3, %add.2972.3, %select.1340.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1341.2"}
  %compare.1697.2 = pred[] compare(%select.1341.2, %constant_5288_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="compare.1697.2"}
  %add.2973.2 = s32[] add(%select.1341.2, %constant_5292_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.2973.2"}
  %select.1342.1 = s32[] select(%compare.1697.2, %add.2973.2, %select.1341.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="select.1342.1"}
  ROOT %dynamic-update-slice.420.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2426, %bitcast.25838.1, %constant_5288_26, %select.1342.1, %constant_5288_26, /*index=5*/%constant_5288_26, %constant_5288_26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-update-slice.420.1"}
}

%fused_transpose (param_0.2429: bf16[1,1,8,4,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.2429 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.2429"}
  %bitcast.25812.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.2429), metadata={scheduling_name="bitcast.25812.1"}
  ROOT %transpose.770.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.25812.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.770.1"}
}

%fused_transpose.1 (param_0.2435: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.2435 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2435"}
  %bitcast.25754.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.2435), metadata={scheduling_name="bitcast.25754.1"}
  ROOT %transpose.769.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.25754.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.769.1"}
}

%fused_convert_transpose (param_0.3014: s32[1,1,1,1,2049], param_1.3111: s32[1,4,8,8192], param_2.2323: bf16[1,4,8,8192]) -> (bf16[4,16384,8192], bf16[4,8192,16384]) {
  %param_2.2323 = bf16[1,4,8,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2323"}
  %bitcast.25701.8 = bf16[4,8,8192]{2,1,0} bitcast(%param_2.2323), metadata={scheduling_name="bitcast.25701.8"}
  %convert.5008.5 = f32[4,8,8192]{2,1,0} convert(%bitcast.25701.8), metadata={scheduling_name="convert.5008.5"}
  %broadcast.6021.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.5008.5), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6021.11"}
  %param_1.3111 = s32[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3111"}
  %bitcast.25723.9 = s32[4,8,8192]{2,1,0} bitcast(%param_1.3111), metadata={scheduling_name="bitcast.25723.9"}
  %broadcast.5730.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25723.9), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5730.9"}
  %param_0.3014 = s32[1,1,1,1,2049]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3014"}
  %bitcast.25181.15 = s32[2049]{0} bitcast(%param_0.3014), metadata={scheduling_name="bitcast.25181.15"}
  %broadcast.5706.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25181.15), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5706.15"}
  %compare.1717.7 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5730.9, %broadcast.5706.15), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1717.7"}
  %convert.4301.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1717.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4301.9"}
  %convert.4303.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4301.9), metadata={scheduling_name="convert.4303.9"}
  %multiply.2712.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6021.11, %convert.4303.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2712.11"}
  %convert.4304.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2712.11), metadata={scheduling_name="convert.4304.9"}
  %slice.2441.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4304.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2441.7"}
  %convert.4306.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2441.7), metadata={scheduling_name="convert.4306.3"}
  %constant_5291_5 = bf16[] constant(0)
  %convert.5005.1 = f32[] convert(%constant_5291_5), metadata={scheduling_name="convert.5005.1"}
  %broadcast.6018.4 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.5005.1), dimensions={}, metadata={scheduling_name="broadcast.6018.4"}
  %compare.1718.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4306.3, %broadcast.6018.4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1718.3"}
  %bitcast.25745.1 = pred[4,16384,8192]{2,1,0} bitcast(%compare.1718.3), metadata={scheduling_name="bitcast.25745.1"}
  %convert.4308.1 = bf16[4,16384,8192]{2,1,0} convert(%bitcast.25745.1), metadata={scheduling_name="convert.4308.1"}
  %bitcast.25734.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2441.7), metadata={scheduling_name="bitcast.25734.1.clone.1"}
  %transpose.768.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.25734.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.768.1.clone.1"}
  ROOT %tuple.543 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4308.1, %transpose.768.1.clone.1), metadata={scheduling_name="tuple.543"}
}

%fused_multiply_transpose (param_0.2454: s32[4,8,8192], param_1.2653: s32[4,8,8192], param_2.4727: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.2454 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2454"}
  %bitcast.25718.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.2454), metadata={scheduling_name="bitcast.25718.1"}
  %param_1.2653 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2653"}
  %bitcast.25696.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.2653), metadata={scheduling_name="bitcast.25696.2"}
  %multiply.2711.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.25718.1, %bitcast.25696.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2711.1"}
  %param_2.4727 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4727"}
  %bitcast.25615.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4727), metadata={scheduling_name="bitcast.25615.3.clone.1"}
  %transpose.767.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.25615.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.767.3.clone.1"}
  %bitcast.25618.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.767.3.clone.1), metadata={scheduling_name="bitcast.25618.5.clone.1"}
  %convert.4295.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25618.5.clone.1), metadata={scheduling_name="convert.4295.5.clone.1"}
  %convert.4298.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25696.2), metadata={scheduling_name="convert.4298.3.clone.1"}
  %multiply.2709.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4295.5.clone.1, %convert.4298.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2709.3.clone.1"}
  %convert.4299.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2709.3.clone.1), metadata={scheduling_name="convert.4299.1.clone.1"}
  ROOT %tuple.544 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2711.1, %convert.4299.1.clone.1), metadata={scheduling_name="tuple.544"}
}

%region_7.620 (Arg_0.621: s32[], Arg_1.622: s32[]) -> s32[] {
  %Arg_1.622 = s32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" scheduling_name="Arg_1.622"}
  %Arg_0.621 = s32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" scheduling_name="Arg_0.621"}
  ROOT %add.2749.0 = s32[] add(%Arg_0.621, %Arg_1.622), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2749.0"}
}

%fused_reduce (param_0.3340: pred[1,4,8,8192,2], param_1.3516: s32[1,4,8,64,16], param_2.2745: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.3340 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3340"}
  %convert.4297.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3340), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4297.17"}
  %bitcast.25630.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4297.17), metadata={scheduling_name="bitcast.25630.11"}
  %constant_5288_24 = s32[] constant(0)
  %reduce-window.172.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25630.11, %constant_5288_24), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.172.11"}
  %param_1.3516 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3516"}
  %param_2.2745 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2745"}
  %slice.2437.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.2745), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2437.7"}
  %bitcast.25654.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2437.7), metadata={scheduling_name="bitcast.25654.9"}
  %reduce-window.175.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.25654.9, %constant_5288_24), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.175.9"}
  %slice.2438.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.175.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2438.7"}
  %bitcast.25660.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2438.7), metadata={scheduling_name="bitcast.25660.9"}
  %broadcast.5724.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.25660.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5724.9"}
  %add.2993.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.2745, %broadcast.5724.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2993.7"}
  %bitcast.25664.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.2993.7), metadata={scheduling_name="bitcast.25664.7"}
  %pad.362.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.25664.7, %constant_5288_24), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.362.7"}
  %slice.2439.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.362.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2439.5"}
  %bitcast.25668.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2439.5), metadata={scheduling_name="bitcast.25668.9"}
  %broadcast.5725.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.25668.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5725.9"}
  %add.2994.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.3516, %broadcast.5725.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2994.7"}
  %bitcast.25672.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.2994.7), metadata={scheduling_name="bitcast.25672.5"}
  %pad.363.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.25672.5, %constant_5288_24), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.363.5"}
  %slice.2440.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.363.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2440.1"}
  %bitcast.25676.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2440.1), metadata={scheduling_name="bitcast.25676.9"}
  %broadcast.5726.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.25676.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5726.9"}
  %add.2995.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.172.11, %broadcast.5726.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2995.7"}
  %bitcast.25680.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.2995.7), metadata={scheduling_name="bitcast.25680.6"}
  %constant_5303_1 = s32[] constant(2048)
  %broadcast.5702.6 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_5303_1), dimensions={}, metadata={scheduling_name="broadcast.5702.6"}
  %compare.1716.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.25680.6, %broadcast.5702.6), direction=LE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1716.3"}
  %bitcast.25686.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1716.3), metadata={scheduling_name="bitcast.25686.3"}
  %broadcast.5703.6 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_5288_24), dimensions={}, metadata={scheduling_name="broadcast.5703.6"}
  %select.1358.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.25686.3, %convert.4297.17, %broadcast.5703.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1358.3"}
  %bitcast.25693.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1358.3), metadata={scheduling_name="bitcast.25693.1"}
  %reduce.507.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25693.1, %constant_5288_24), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.507.1"}
  %bitcast.25707.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.4297.17), metadata={scheduling_name="bitcast.25707.3.clone.1"}
  %multiply.2710.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.25707.3.clone.1, %bitcast.25680.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2710.3.clone.1"}
  %bitcast.25713.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2710.3.clone.1), metadata={scheduling_name="bitcast.25713.1.clone.1"}
  %reduce.508.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25713.1.clone.1, %constant_5288_24), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.508.1.clone.1"}
  ROOT %tuple.545 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.507.1, %reduce.508.1.clone.1), metadata={scheduling_name="tuple.545"}
}

%fused_reduce_window (param_0.3341: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.3341 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3341"}
  %slice.2436.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.3341), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2436.1"}
  %bitcast.25646.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2436.1), metadata={scheduling_name="bitcast.25646.1"}
  %constant_5288_33 = s32[] constant(0)
  ROOT %reduce-window.174.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.25646.1, %constant_5288_33), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.174.1"}
}

%fused_reduce_window.1 (param_0.3343: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.3343 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3343"}
  %bitcast.25638.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.3343), metadata={scheduling_name="bitcast.25638.1"}
  %constant_5288_38 = s32[] constant(0)
  ROOT %reduce-window.173.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.25638.1, %constant_5288_38), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.173.1"}
}

%region_6.604 (Arg_0.605: bf16[], Arg_1.606: bf16[]) -> bf16[] {
  %Arg_1.606 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.606"}
  %Arg_0.605 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.605"}
  %convert.3882.0 = f32[] convert(%Arg_1.606), metadata={scheduling_name="convert.3882.0"}
  %convert.3881.0 = f32[] convert(%Arg_0.605), metadata={scheduling_name="convert.3881.0"}
  %add.2747.0 = f32[] add(%convert.3881.0, %convert.3882.0), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2747.0"}
  ROOT %convert.3883.0 = bf16[] convert(%add.2747.0), metadata={scheduling_name="convert.3883.0"}
}

%region_1.585 (Arg_0.586: f32[], Arg_1.587: f32[]) -> f32[] {
  %Arg_1.587 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_1.587"}
  %Arg_0.586 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_0.586"}
  ROOT %add.2746.0 = f32[] add(%Arg_0.586, %Arg_1.587), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2746.0"}
}

%region_3.593 (Arg_0.594: f32[], Arg_1.595: f32[]) -> f32[] {
  %Arg_1.595 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" scheduling_name="Arg_1.595"}
  %Arg_0.594 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" scheduling_name="Arg_0.594"}
  ROOT %maximum.46.0 = f32[] maximum(%Arg_0.594, %Arg_1.595), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="maximum.46.0"}
}

%fused_scatter (param_0.2486: bf16[1,4,8192,8], param_1.2673: s32[65536,4], param_2.2515: u32[1,4,8192,2], param_3.1984: u32[1,4,8192,8], param_4.1847: s32[1,4,8192,2,1], param_5.1648: s32[1,4,8192,2,1], param_6.1582: s32[32768,2], param_7.1501: f32[32768,2], param_8.1330: u32[16], param_9.1000: u32[]) -> bf16[1,4,8192,8] {
  %param_0.2486 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2486"}
  %param_1.2673 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2673"}
  %param_2.2515 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2515"}
  %param_3.1984 = u32[1,4,8192,8]{3,2,1,0} parameter(3), metadata={scheduling_name="param_3.1984"}
  %param_5.1648 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(5), metadata={scheduling_name="param_5.1648"}
  %bitcast.24505.26 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_5.1648), metadata={scheduling_name="bitcast.24505.26"}
  %param_4.1847 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(4), metadata={scheduling_name="param_4.1847"}
  %bitcast.24507.26 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_4.1847), metadata={scheduling_name="bitcast.24507.26"}
  %param_6.1582 = s32[32768,2]{1,0} parameter(6), metadata={scheduling_name="param_6.1582"}
  %bitcast.25542.19 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_6.1582), metadata={scheduling_name="bitcast.25542.19"}
  %constant_5288_52 = s32[] constant(0)
  %broadcast.5690.14 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5288_52), dimensions={}, metadata={scheduling_name="broadcast.5690.14"}
  %compare.1713.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25542.19, %broadcast.5690.14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1713.7"}
  %constant_5300_1 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5691.14 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5300_1), dimensions={}, metadata={scheduling_name="broadcast.5691.14"}
  %add.2992.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25542.19, %broadcast.5691.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2992.7"}
  %select.1356.5 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1713.7, %add.2992.7, %bitcast.25542.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1356.5"}
  %bitcast.25555.13 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1356.5), metadata={scheduling_name="bitcast.25555.13"}
  %concatenate.724.13 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24505.26, %bitcast.24507.26, %bitcast.25555.13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.724.13"}
  %constant_5312_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_8.1330 = u32[16]{0} parameter(8), metadata={scheduling_name="param_8.1330"}
  %param_9.1000 = u32[] parameter(9), metadata={scheduling_name="param_9.1000"}
  %dynamic-slice.1444.9 = u32[1]{0} dynamic-slice(%param_8.1330, %param_9.1000), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1444.9"}
  %constant_5313_1 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.9 = u32[1]{0} clamp(%constant_5312_1, %dynamic-slice.1444.9, %constant_5313_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.9"}
  %convert.4236.9 = s32[1]{0} convert(%clamp.27.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4236.9"}
  %constant_5311_2 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2687.9 = s32[1]{0} multiply(%convert.4236.9, %constant_5311_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2687.9"}
  %constant_5299_6 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.3 = s32[3]{0} concatenate(%multiply.2687.9, %constant_5299_6, %constant_5299_6), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.3"}
  %broadcast.5692.22 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5692.22"}
  %subtract.266.11 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.724.13, %broadcast.5692.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.266.11"}
  %pad.361.8 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.266.11, %constant_5288_52), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.361.8"}
  %bitcast.25576.7 = s32[65536,4]{0,1} bitcast(%pad.361.8), metadata={scheduling_name="bitcast.25576.7"}
  %gather.364.7 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_3.1984, %bitcast.25576.7), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.364.7"}
  %bitcast.25579.5 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.364.7), metadata={scheduling_name="bitcast.25579.5"}
  %compare.1714.5 = pred[1,4,8192,2]{3,2,1,0} compare(%param_2.2515, %bitcast.25579.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1714.5"}
  %param_7.1501 = f32[32768,2]{1,0} parameter(7), metadata={scheduling_name="param_7.1501"}
  %bitcast.25584.9 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_7.1501), metadata={scheduling_name="bitcast.25584.9"}
  %constant_5302_1 = f32[] constant(-inf)
  %reduce.399.1 = f32[32768]{0} reduce(%param_7.1501, %constant_5302_1), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.399.1"}
  %bitcast.25592.9 = f32[4,8192]{1,0} bitcast(%reduce.399.1), metadata={scheduling_name="bitcast.25592.9"}
  %broadcast.5720.9 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.25592.9), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5720.9"}
  %subtract.267.9 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.25584.9, %broadcast.5720.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.267.9"}
  %exponential.98.7 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.267.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.98.7"}
  %bitcast.25600.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.98.7), metadata={scheduling_name="bitcast.25600.3"}
  %constant_5293_3 = f32[] constant(0)
  %reduce.434.3 = f32[4,8192]{1,0} reduce(%bitcast.25600.3, %constant_5293_3), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.434.3"}
  %broadcast.5721.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.434.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5721.5"}
  %divide.474.5 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.98.7, %broadcast.5721.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.474.5"}
  %convert.4294.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.474.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4294.3"}
  %constant_5291_3 = bf16[] constant(0)
  %broadcast.5696.2 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_5291_3), dimensions={}, metadata={scheduling_name="broadcast.5696.2"}
  %select.1357.3 = bf16[1,4,8192,2]{3,2,1,0} select(%compare.1714.5, %convert.4294.3, %broadcast.5696.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1357.3"}
  %bitcast.25612.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1357.3), metadata={scheduling_name="bitcast.25612.1"}
  ROOT %scatter.220.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.2486, %param_1.2673, %bitcast.25612.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.220.1"}
}

%fused_transpose.2 (param_0.3336: s32[1,4,8192,2,1], param_1.3485: s32[1,4,8192,2,1], param_2.2708: s32[32768,2], param_3.2306: u32[16], param_4.1935: u32[]) -> s32[65536,4] {
  %param_1.3485 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(1), metadata={scheduling_name="param_1.3485"}
  %bitcast.24505.10 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_1.3485), metadata={scheduling_name="bitcast.24505.10"}
  %param_0.3336 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(0), metadata={scheduling_name="param_0.3336"}
  %bitcast.24507.10 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.3336), metadata={scheduling_name="bitcast.24507.10"}
  %param_2.2708 = s32[32768,2]{1,0} parameter(2), metadata={scheduling_name="param_2.2708"}
  %bitcast.25542.13 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_2.2708), metadata={scheduling_name="bitcast.25542.13"}
  %constant_5288_13 = s32[] constant(0)
  %broadcast.5690.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5288_13), dimensions={}, metadata={scheduling_name="broadcast.5690.12"}
  %compare.1713.5 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25542.13, %broadcast.5690.12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1713.5"}
  %constant_5300_4 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5691.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5300_4), dimensions={}, metadata={scheduling_name="broadcast.5691.12"}
  %add.2992.5 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25542.13, %broadcast.5691.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2992.5"}
  %select.1356.3 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1713.5, %add.2992.5, %bitcast.25542.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1356.3"}
  %bitcast.25555.7 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1356.3), metadata={scheduling_name="bitcast.25555.7"}
  %concatenate.724.7 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24505.10, %bitcast.24507.10, %bitcast.25555.7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.724.7"}
  %constant_5312_4 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_3.2306 = u32[16]{0} parameter(3), metadata={scheduling_name="param_3.2306"}
  %param_4.1935 = u32[] parameter(4), metadata={scheduling_name="param_4.1935"}
  %dynamic-slice.1444.7 = u32[1]{0} dynamic-slice(%param_3.2306, %param_4.1935), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1444.7"}
  %constant_5313_4 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.7 = u32[1]{0} clamp(%constant_5312_4, %dynamic-slice.1444.7, %constant_5313_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.7"}
  %convert.4236.7 = s32[1]{0} convert(%clamp.27.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4236.7"}
  %constant_5311_6 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2687.7 = s32[1]{0} multiply(%convert.4236.7, %constant_5311_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2687.7"}
  %constant_5299_8 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.2 = s32[3]{0} concatenate(%multiply.2687.7, %constant_5299_8, %constant_5299_8), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.2"}
  %broadcast.5692.6 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.2), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5692.6"}
  %subtract.266.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.724.7, %broadcast.5692.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.266.5"}
  %pad.361.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.266.5, %constant_5288_13), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.361.1"}
  %bitcast.25560.1 = s32[4,65536]{1,0} bitcast(%pad.361.1), metadata={scheduling_name="bitcast.25560.1"}
  ROOT %transpose.766.1 = s32[65536,4]{1,0} transpose(%bitcast.25560.1), dimensions={1,0}, metadata={scheduling_name="transpose.766.1"}
}

%fused_reduce.1 (param_0.3352: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.3352 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.3352"}
  %bitcast.25472.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3352), metadata={scheduling_name="bitcast.25472.9"}
  %convert.4286.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25472.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4286.9"}
  %multiply.2705.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4286.9, %convert.4286.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2705.3"}
  %bitcast.25479.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2705.3), metadata={scheduling_name="bitcast.25479.1"}
  %constant_5293_2 = f32[] constant(0)
  ROOT %reduce.433.1 = f32[4,8192]{1,0} reduce(%bitcast.25479.1, %constant_5293_2), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.433.1"}
}

%fused_dynamic_slice (param_0.3339: bf16[1,2,48,128,768], param_1.3540: s32[1], param_2.2801: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.3339 = bf16[1,2,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3339"}
  %bitcast.25453.1 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param_0.3339), metadata={scheduling_name="bitcast.25453.1"}
  %constant_5288_21 = s32[] constant(0)
  %constant_5310_15 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2801 = s32[] parameter(2), metadata={scheduling_name="param_2.2801"}
  %bitcast.24639.38 = s32[1]{0} bitcast(%param_2.2801), metadata={scheduling_name="bitcast.24639.38"}
  %param_1.3540 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3540"}
  %subtract.259.37 = s32[1]{0} subtract(%bitcast.24639.38, %param_1.3540), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.37"}
  %constant_5299_21 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.31 = s32[1]{0} maximum(%subtract.259.37, %constant_5299_21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.31"}
  %sign.28.30 = s32[1]{0} sign(%maximum.48.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.30"}
  %constant_5306_16 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.30 = pred[1]{0} compare(%sign.28.30, %constant_5306_16), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.30"}
  %constant_5307_17 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.31 = s32[1]{0} and(%maximum.48.31, %constant_5307_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.31"}
  %compare.1703.31 = pred[1]{0} compare(%and.321.31, %constant_5299_21), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.31"}
  %and.322.30 = pred[1]{0} and(%compare.1702.30, %compare.1703.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.30"}
  %constant_5308_16 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.30 = s32[1]{0} shift-right-logical(%maximum.48.31, %constant_5308_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.30"}
  %constant_5309_16 = s32[1]{0} constant({-1})
  %add.2977.30 = s32[1]{0} add(%shift-right-logical.21.30, %constant_5309_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.30"}
  %select.1349.30 = s32[1]{0} select(%and.322.30, %add.2977.30, %shift-right-logical.21.30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.30"}
  %compare.1704.30 = pred[1]{0} compare(%select.1349.30, %constant_5299_21), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.30"}
  %add.2978.30 = s32[1]{0} add(%select.1349.30, %constant_5308_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.30"}
  %select.1350.30 = s32[1]{0} select(%compare.1704.30, %add.2978.30, %select.1349.30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.30"}
  %bitcast.24671.37 = s32[1,1]{1,0} bitcast(%select.1350.30), metadata={scheduling_name="bitcast.24671.37"}
  %concatenate.716.27 = s32[1,5]{1,0} concatenate(%constant_5310_15, %bitcast.24671.37, %constant_5310_15, %constant_5310_15, %constant_5310_15), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.27"}
  %bitcast.24699.25 = s32[5]{0} bitcast(%concatenate.716.27), metadata={scheduling_name="bitcast.24699.25"}
  %slice.2414.25 = s32[1]{0} slice(%bitcast.24699.25), slice={[1:2]}, metadata={scheduling_name="slice.2414.25"}
  %bitcast.25802.11 = s32[] bitcast(%slice.2414.25), metadata={scheduling_name="bitcast.25802.11"}
  ROOT %dynamic-slice.1452.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.25453.1, %constant_5288_21, %bitcast.25802.11, %constant_5288_21, %constant_5288_21, /*index=5*/%constant_5288_21), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1452.1"}
}

%fused_reduce.2 (param_0.3351: bf16[4,8192,6144]) -> f32[4,8192] {
  %param_0.3351 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.3351"}
  %bitcast.25279.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3351), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/reduce_precision" source_file="/workspace/maxtext/MaxText/layers/mixtral.py" source_line=64 scheduling_name="bitcast.25279.9"}
  %convert.4256.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25279.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4256.9"}
  %multiply.2693.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4256.9, %convert.4256.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2693.3"}
  %bitcast.25287.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2693.3), metadata={scheduling_name="bitcast.25287.1"}
  %constant_5293_1 = f32[] constant(0)
  ROOT %reduce.432.1 = f32[4,8192]{1,0} reduce(%bitcast.25287.1, %constant_5293_1), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.432.1"}
}

%fused_transpose.3 (param_0.2538: bf16[1,1,8,4,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.2538 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.2538"}
  %bitcast.25268.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.2538), metadata={scheduling_name="bitcast.25268.1"}
  ROOT %transpose.765.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.25268.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.765.1"}
}

%fused_transpose.4 (param_0.2544: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.2544 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2544"}
  %bitcast.25210.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.2544), metadata={scheduling_name="bitcast.25210.1"}
  ROOT %transpose.764.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.25210.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.764.1"}
}

%fused_convert_transpose.1 (param_0.3015: s32[1,1,1,1,2049], param_1.3112: s32[1,4,8,8192], param_2.2324: bf16[1,4,8,8192]) -> (bf16[4,16384,8192], bf16[4,8192,16384]) {
  %param_2.2324 = bf16[1,4,8,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2324"}
  %bitcast.25154.8 = bf16[4,8,8192]{2,1,0} bitcast(%param_2.2324), metadata={scheduling_name="bitcast.25154.8"}
  %convert.5003.5 = f32[4,8,8192]{2,1,0} convert(%bitcast.25154.8), metadata={scheduling_name="convert.5003.5"}
  %broadcast.6016.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.5003.5), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6016.11"}
  %param_1.3112 = s32[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3112"}
  %bitcast.25176.9 = s32[4,8,8192]{2,1,0} bitcast(%param_1.3112), metadata={scheduling_name="bitcast.25176.9"}
  %broadcast.5705.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25176.9), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5705.9"}
  %param_0.3015 = s32[1,1,1,1,2049]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3015"}
  %bitcast.25181.17 = s32[2049]{0} bitcast(%param_0.3015), metadata={scheduling_name="bitcast.25181.17"}
  %broadcast.5706.17 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25181.17), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5706.17"}
  %compare.1711.7 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5705.9, %broadcast.5706.17), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1711.7"}
  %convert.4245.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1711.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4245.9"}
  %convert.4246.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4245.9), metadata={scheduling_name="convert.4246.9"}
  %multiply.2691.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6016.11, %convert.4246.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2691.11"}
  %convert.4247.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2691.11), metadata={scheduling_name="convert.4247.9"}
  %slice.2428.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4247.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2428.7"}
  %convert.4249.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2428.7), metadata={scheduling_name="convert.4249.3"}
  %constant_5291_1 = bf16[] constant(0)
  %convert.5005.2 = f32[] convert(%constant_5291_1), metadata={scheduling_name="convert.5005.2"}
  %broadcast.6018.6 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.5005.2), dimensions={}, metadata={scheduling_name="broadcast.6018.6"}
  %compare.1712.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4249.3, %broadcast.6018.6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1712.3"}
  %bitcast.25201.1 = pred[4,16384,8192]{2,1,0} bitcast(%compare.1712.3), metadata={scheduling_name="bitcast.25201.1"}
  %convert.4252.1 = bf16[4,16384,8192]{2,1,0} convert(%bitcast.25201.1), metadata={scheduling_name="convert.4252.1"}
  %bitcast.25190.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2428.7), metadata={scheduling_name="bitcast.25190.1.clone.1"}
  %transpose.763.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.25190.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.763.1.clone.1"}
  ROOT %tuple.546 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4252.1, %transpose.763.1.clone.1), metadata={scheduling_name="tuple.546"}
}

%fused_multiply_transpose.1 (param_0.2565: s32[4,8,8192], param_1.2704: s32[4,8,8192], param_2.4733: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.2565 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2565"}
  %bitcast.25171.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.2565), metadata={scheduling_name="bitcast.25171.1"}
  %param_1.2704 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2704"}
  %bitcast.25149.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.2704), metadata={scheduling_name="bitcast.25149.2"}
  %multiply.2690.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.25171.1, %bitcast.25149.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2690.1"}
  %param_2.4733 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4733"}
  %bitcast.25066.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4733), metadata={scheduling_name="bitcast.25066.3.clone.1"}
  %transpose.762.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.25066.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.762.3.clone.1"}
  %bitcast.25069.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.762.3.clone.1), metadata={scheduling_name="bitcast.25069.5.clone.1"}
  %convert.4238.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25069.5.clone.1), metadata={scheduling_name="convert.4238.5.clone.1"}
  %convert.4241.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25149.2), metadata={scheduling_name="convert.4241.3.clone.1"}
  %multiply.2688.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4238.5.clone.1, %convert.4241.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2688.3.clone.1"}
  %convert.4243.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2688.3.clone.1), metadata={scheduling_name="convert.4243.1.clone.1"}
  ROOT %tuple.547 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2690.1, %convert.4243.1.clone.1), metadata={scheduling_name="tuple.547"}
}

%fused_reduce.3 (param_0.3348: pred[1,4,8,8192,2], param_1.3517: s32[1,4,8,64,16], param_2.2746: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.3348 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3348"}
  %convert.4240.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3348), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4240.17"}
  %bitcast.25084.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4240.17), metadata={scheduling_name="bitcast.25084.11"}
  %constant_5288_49 = s32[] constant(0)
  %reduce-window.168.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25084.11, %constant_5288_49), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.168.11"}
  %param_1.3517 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3517"}
  %param_2.2746 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2746"}
  %slice.2424.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.2746), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2424.7"}
  %bitcast.25108.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2424.7), metadata={scheduling_name="bitcast.25108.9"}
  %reduce-window.171.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.25108.9, %constant_5288_49), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.171.9"}
  %slice.2425.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.171.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2425.7"}
  %bitcast.25114.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2425.7), metadata={scheduling_name="bitcast.25114.9"}
  %broadcast.5699.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.25114.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5699.9"}
  %add.2985.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.2746, %broadcast.5699.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2985.7"}
  %bitcast.25118.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.2985.7), metadata={scheduling_name="bitcast.25118.7"}
  %pad.359.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.25118.7, %constant_5288_49), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.359.7"}
  %slice.2426.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.359.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2426.5"}
  %bitcast.25122.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2426.5), metadata={scheduling_name="bitcast.25122.9"}
  %broadcast.5700.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.25122.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5700.9"}
  %add.2986.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.3517, %broadcast.5700.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2986.7"}
  %bitcast.25126.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.2986.7), metadata={scheduling_name="bitcast.25126.5"}
  %pad.360.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.25126.5, %constant_5288_49), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.360.5"}
  %slice.2427.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.360.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2427.1"}
  %bitcast.25130.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2427.1), metadata={scheduling_name="bitcast.25130.9"}
  %broadcast.5701.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.25130.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5701.9"}
  %add.2987.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.168.11, %broadcast.5701.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2987.7"}
  %bitcast.25134.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.2987.7), metadata={scheduling_name="bitcast.25134.6"}
  %constant_5303_2 = s32[] constant(2048)
  %broadcast.5702.4 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_5303_2), dimensions={}, metadata={scheduling_name="broadcast.5702.4"}
  %compare.1710.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.25134.6, %broadcast.5702.4), direction=LE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1710.3"}
  %bitcast.25139.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1710.3), metadata={scheduling_name="bitcast.25139.3"}
  %broadcast.5703.4 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_5288_49), dimensions={}, metadata={scheduling_name="broadcast.5703.4"}
  %select.1355.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.25139.3, %convert.4240.17, %broadcast.5703.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1355.3"}
  %bitcast.25146.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1355.3), metadata={scheduling_name="bitcast.25146.1"}
  %reduce.505.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25146.1, %constant_5288_49), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.505.1"}
  %bitcast.25160.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.4240.17), metadata={scheduling_name="bitcast.25160.3.clone.1"}
  %multiply.2689.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.25160.3.clone.1, %bitcast.25134.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2689.3.clone.1"}
  %bitcast.25166.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2689.3.clone.1), metadata={scheduling_name="bitcast.25166.1.clone.1"}
  %reduce.506.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25166.1.clone.1, %constant_5288_49), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.506.1.clone.1"}
  ROOT %tuple.548 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.505.1, %reduce.506.1.clone.1), metadata={scheduling_name="tuple.548"}
}

%fused_reduce_window.2 (param_0.3342: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.3342 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3342"}
  %slice.2423.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.3342), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2423.1"}
  %bitcast.25100.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2423.1), metadata={scheduling_name="bitcast.25100.1"}
  %constant_5288_36 = s32[] constant(0)
  ROOT %reduce-window.170.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.25100.1, %constant_5288_36), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.170.1"}
}

%fused_reduce_window.3 (param_0.3344: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.3344 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3344"}
  %bitcast.25092.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.3344), metadata={scheduling_name="bitcast.25092.1"}
  %constant_5288_40 = s32[] constant(0)
  ROOT %reduce-window.169.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.25092.1, %constant_5288_40), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.169.1"}
}

%fused_scatter.1 (param_0.2599: bf16[1,4,8192,8], param_1.2724: s32[65536,4], param_2.2518: u32[1,4,8192,2], param_3.1985: u32[1,4,8192,8], param_4.1848: s32[1,4,8192,2,1], param_5.1649: s32[1,4,8192,2,1], param_6.1583: s32[32768,2], param_7.1502: f32[32768,2], param_8.1331: u32[16], param_9.1001: u32[]) -> bf16[1,4,8192,8] {
  %param_0.2599 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2599"}
  %param_1.2724 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2724"}
  %param_2.2518 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2518"}
  %param_3.1985 = u32[1,4,8192,8]{3,2,1,0} parameter(3), metadata={scheduling_name="param_3.1985"}
  %param_5.1649 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(5), metadata={scheduling_name="param_5.1649"}
  %bitcast.24505.22 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_5.1649), metadata={scheduling_name="bitcast.24505.22"}
  %param_4.1848 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(4), metadata={scheduling_name="param_4.1848"}
  %bitcast.24507.22 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_4.1848), metadata={scheduling_name="bitcast.24507.22"}
  %param_6.1583 = s32[32768,2]{1,0} parameter(6), metadata={scheduling_name="param_6.1583"}
  %bitcast.24978.19 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_6.1583), metadata={scheduling_name="bitcast.24978.19"}
  %constant_5288_53 = s32[] constant(0)
  %broadcast.5690.8 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5288_53), dimensions={}, metadata={scheduling_name="broadcast.5690.8"}
  %compare.1707.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.24978.19, %broadcast.5690.8), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1707.7"}
  %constant_5300_2 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5691.10 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5300_2), dimensions={}, metadata={scheduling_name="broadcast.5691.10"}
  %add.2984.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.24978.19, %broadcast.5691.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.7"}
  %select.1353.5 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1707.7, %add.2984.7, %bitcast.24978.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1353.5"}
  %bitcast.24990.13 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1353.5), metadata={scheduling_name="bitcast.24990.13"}
  %concatenate.720.13 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24505.22, %bitcast.24507.22, %bitcast.24990.13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.720.13"}
  %constant_5312_2 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_8.1331 = u32[16]{0} parameter(8), metadata={scheduling_name="param_8.1331"}
  %param_9.1001 = u32[] parameter(9), metadata={scheduling_name="param_9.1001"}
  %dynamic-slice.1444.3 = u32[1]{0} dynamic-slice(%param_8.1331, %param_9.1001), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1444.3"}
  %constant_5313_2 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.3 = u32[1]{0} clamp(%constant_5312_2, %dynamic-slice.1444.3, %constant_5313_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.3"}
  %convert.4236.3 = s32[1]{0} convert(%clamp.27.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4236.3"}
  %constant_5311_4 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2687.3 = s32[1]{0} multiply(%convert.4236.3, %constant_5311_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2687.3"}
  %constant_5299_5 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.4 = s32[3]{0} concatenate(%multiply.2687.3, %constant_5299_5, %constant_5299_5), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.4"}
  %broadcast.5692.18 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5692.18"}
  %subtract.262.11 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.720.13, %broadcast.5692.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.262.11"}
  %pad.358.8 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.262.11, %constant_5288_53), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.358.8"}
  %bitcast.25028.7 = s32[65536,4]{0,1} bitcast(%pad.358.8), metadata={scheduling_name="bitcast.25028.7"}
  %gather.363.7 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_3.1985, %bitcast.25028.7), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.363.7"}
  %bitcast.25031.5 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.363.7), metadata={scheduling_name="bitcast.25031.5"}
  %compare.1708.5 = pred[1,4,8192,2]{3,2,1,0} compare(%param_2.2518, %bitcast.25031.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1708.5"}
  %param_7.1502 = f32[32768,2]{1,0} parameter(7), metadata={scheduling_name="param_7.1502"}
  %bitcast.25036.9 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_7.1502), metadata={scheduling_name="bitcast.25036.9"}
  %constant_5302_2 = f32[] constant(-inf)
  %reduce.393.1 = f32[32768]{0} reduce(%param_7.1502, %constant_5302_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.393.1"}
  %bitcast.25043.9 = f32[4,8192]{1,0} bitcast(%reduce.393.1), metadata={scheduling_name="bitcast.25043.9"}
  %broadcast.5694.9 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.25043.9), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5694.9"}
  %subtract.263.9 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.25036.9, %broadcast.5694.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.263.9"}
  %exponential.97.7 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.263.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.97.7"}
  %bitcast.25051.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.97.7), metadata={scheduling_name="bitcast.25051.3"}
  %constant_5293_6 = f32[] constant(0)
  %reduce.429.3 = f32[4,8192]{1,0} reduce(%bitcast.25051.3, %constant_5293_6), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.429.3"}
  %broadcast.5695.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.429.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5695.5"}
  %divide.473.5 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.97.7, %broadcast.5695.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.473.5"}
  %convert.4237.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.473.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4237.3"}
  %constant_5291_6 = bf16[] constant(0)
  %broadcast.5696.1 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_5291_6), dimensions={}, metadata={scheduling_name="broadcast.5696.1"}
  %select.1354.3 = bf16[1,4,8192,2]{3,2,1,0} select(%compare.1708.5, %convert.4237.3, %broadcast.5696.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1354.3"}
  %bitcast.25063.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1354.3), metadata={scheduling_name="bitcast.25063.1"}
  ROOT %scatter.218.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.2599, %param_1.2724, %bitcast.25063.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.218.1"}
}

%region_5.601 (Arg_0.602: u32[], Arg_1.603: u32[]) -> u32[] {
  ROOT %Arg_1.603 = u32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" scheduling_name="Arg_1.603"}
  %Arg_0.602 = u32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" scheduling_name="Arg_0.602"}
}

%fused_scatter.2 (param_0.2608: u32[1,4,8192,8], param_1.2733: s32[65536,4], param_2.2088: u32[1,4,8192,2]) -> u32[1,4,8192,8] {
  %param_0.2608 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2608"}
  %param_1.2733 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2733"}
  %param_2.2088 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2088"}
  %bitcast.25022.1 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%param_2.2088), metadata={scheduling_name="bitcast.25022.1"}
  ROOT %scatter.217.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.2608, %param_1.2733, %bitcast.25022.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.217.1"}
}

%fused_scatter.3 (param_0.2609: u32[1,4,8192,8], param_1.2734: s32[65536,4], param_2.2090: u32[1,4,8192,2]) -> u32[1,4,8192,8] {
  %param_0.2609 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2609"}
  %param_1.2734 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2734"}
  %param_2.2090 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2090"}
  %bitcast.25022.2 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%param_2.2090), metadata={scheduling_name="bitcast.25022.2"}
  ROOT %scatter.219.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.2609, %param_1.2734, %bitcast.25022.2), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.219.1"}
}

%fused_transpose.5 (param_0.3337: s32[1,4,8192,2,1], param_1.3486: s32[1,4,8192,2,1], param_2.2709: s32[32768,2], param_3.2305: u32[16], param_4.1934: u32[]) -> s32[65536,4] {
  %param_1.3486 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(1), metadata={scheduling_name="param_1.3486"}
  %bitcast.24505.14 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_1.3486), metadata={scheduling_name="bitcast.24505.14"}
  %param_0.3337 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(0), metadata={scheduling_name="param_0.3337"}
  %bitcast.24507.14 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.3337), metadata={scheduling_name="bitcast.24507.14"}
  %param_2.2709 = s32[32768,2]{1,0} parameter(2), metadata={scheduling_name="param_2.2709"}
  %bitcast.24978.13 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_2.2709), metadata={scheduling_name="bitcast.24978.13"}
  %constant_5288_14 = s32[] constant(0)
  %broadcast.5690.6 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5288_14), dimensions={}, metadata={scheduling_name="broadcast.5690.6"}
  %compare.1707.5 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.24978.13, %broadcast.5690.6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1707.5"}
  %constant_5300_3 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5691.8 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5300_3), dimensions={}, metadata={scheduling_name="broadcast.5691.8"}
  %add.2984.5 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.24978.13, %broadcast.5691.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.5"}
  %select.1353.3 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1707.5, %add.2984.5, %bitcast.24978.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1353.3"}
  %bitcast.24990.7 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1353.3), metadata={scheduling_name="bitcast.24990.7"}
  %concatenate.720.7 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24505.14, %bitcast.24507.14, %bitcast.24990.7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.720.7"}
  %constant_5312_3 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_3.2305 = u32[16]{0} parameter(3), metadata={scheduling_name="param_3.2305"}
  %param_4.1934 = u32[] parameter(4), metadata={scheduling_name="param_4.1934"}
  %dynamic-slice.1444.5 = u32[1]{0} dynamic-slice(%param_3.2305, %param_4.1934), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1444.5"}
  %constant_5313_3 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.5 = u32[1]{0} clamp(%constant_5312_3, %dynamic-slice.1444.5, %constant_5313_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.5"}
  %convert.4236.5 = s32[1]{0} convert(%clamp.27.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4236.5"}
  %constant_5311_5 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2687.5 = s32[1]{0} multiply(%convert.4236.5, %constant_5311_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2687.5"}
  %constant_5299_7 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.1 = s32[3]{0} concatenate(%multiply.2687.5, %constant_5299_7, %constant_5299_7), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.1"}
  %broadcast.5692.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5692.10"}
  %subtract.262.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.720.7, %broadcast.5692.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.262.5"}
  %pad.358.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.262.5, %constant_5288_14), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.358.1"}
  %bitcast.25010.1 = s32[4,65536]{1,0} bitcast(%pad.358.1), metadata={scheduling_name="bitcast.25010.1"}
  ROOT %transpose.761.1 = s32[65536,4]{1,0} transpose(%bitcast.25010.1), dimensions={1,0}, metadata={scheduling_name="transpose.761.1"}
}

%fused_dynamic_slice.1 (param_0.2618: bf16[1,2,768,8], param_1.3526: s32[1], param_2.2787: s32[]) -> bf16[1,1,768,8] {
  %param_0.2618 = bf16[1,2,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2618"}
  %constant_5288_3 = s32[] constant(0)
  %constant_5310_1 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2787 = s32[] parameter(2), metadata={scheduling_name="param_2.2787"}
  %bitcast.24639.12 = s32[1]{0} bitcast(%param_2.2787), metadata={scheduling_name="bitcast.24639.12"}
  %param_1.3526 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3526"}
  %subtract.259.11 = s32[1]{0} subtract(%bitcast.24639.12, %param_1.3526), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.11"}
  %constant_5299_2 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.4 = s32[1]{0} maximum(%subtract.259.11, %constant_5299_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.4"}
  %sign.28.3 = s32[1]{0} sign(%maximum.48.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.3"}
  %constant_5306_3 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.2 = pred[1]{0} compare(%sign.28.3, %constant_5306_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.2"}
  %constant_5307_5 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.4 = s32[1]{0} and(%maximum.48.4, %constant_5307_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.4"}
  %compare.1703.3 = pred[1]{0} compare(%and.321.4, %constant_5299_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.3"}
  %and.322.1 = pred[1]{0} and(%compare.1702.2, %compare.1703.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.1"}
  %constant_5308_4 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.1 = s32[1]{0} shift-right-logical(%maximum.48.4, %constant_5308_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.1"}
  %constant_5309_2 = s32[1]{0} constant({-1})
  %add.2977.1 = s32[1]{0} add(%shift-right-logical.21.1, %constant_5309_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.1"}
  %select.1349.4 = s32[1]{0} select(%and.322.1, %add.2977.1, %shift-right-logical.21.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.4"}
  %compare.1704.2 = pred[1]{0} compare(%select.1349.4, %constant_5299_2), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.2"}
  %add.2978.2 = s32[1]{0} add(%select.1349.4, %constant_5308_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.2"}
  %select.1350.1 = s32[1]{0} select(%compare.1704.2, %add.2978.2, %select.1349.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.1"}
  %bitcast.24671.9 = s32[1,1]{1,0} bitcast(%select.1350.1), metadata={scheduling_name="bitcast.24671.9"}
  %concatenate.719.7 = s32[1,4]{1,0} concatenate(%constant_5310_1, %bitcast.24671.9, %constant_5310_1, %constant_5310_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.719.7"}
  %bitcast.24951.5 = s32[4]{0} bitcast(%concatenate.719.7), metadata={scheduling_name="bitcast.24951.5"}
  %slice.2419.5 = s32[1]{0} slice(%bitcast.24951.5), slice={[1:2]}, metadata={scheduling_name="slice.2419.5"}
  %bitcast.25519.1 = s32[] bitcast(%slice.2419.5), metadata={scheduling_name="bitcast.25519.1"}
  ROOT %dynamic-slice.1443.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_0.2618, %constant_5288_3, %bitcast.25519.1, %constant_5288_3, %constant_5288_3), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1443.1"}
}

%fused_dynamic_slice.2 (param_0.2619: bf16[1,2,768,8], param_1.3528: s32[1], param_2.2789: s32[]) -> bf16[1,1,768,8] {
  %param_0.2619 = bf16[1,2,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2619"}
  %constant_5288_25 = s32[] constant(0)
  %constant_5310_3 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2789 = s32[] parameter(2), metadata={scheduling_name="param_2.2789"}
  %bitcast.24639.4 = s32[1]{0} bitcast(%param_2.2789), metadata={scheduling_name="bitcast.24639.4"}
  %param_1.3528 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3528"}
  %subtract.259.3 = s32[1]{0} subtract(%bitcast.24639.4, %param_1.3528), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.3"}
  %constant_5299_9 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.5 = s32[1]{0} maximum(%subtract.259.3, %constant_5299_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.5"}
  %sign.28.2 = s32[1]{0} sign(%maximum.48.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.2"}
  %constant_5306_2 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.1 = pred[1]{0} compare(%sign.28.2, %constant_5306_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.1"}
  %constant_5307_4 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.3 = s32[1]{0} and(%maximum.48.5, %constant_5307_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.3"}
  %compare.1703.2 = pred[1]{0} compare(%and.321.3, %constant_5299_9), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.2"}
  %and.322.4 = pred[1]{0} and(%compare.1702.1, %compare.1703.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.4"}
  %constant_5308_3 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.2 = s32[1]{0} shift-right-logical(%maximum.48.5, %constant_5308_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.2"}
  %constant_5309_1 = s32[1]{0} constant({-1})
  %add.2977.4 = s32[1]{0} add(%shift-right-logical.21.2, %constant_5309_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.4"}
  %select.1349.3 = s32[1]{0} select(%and.322.4, %add.2977.4, %shift-right-logical.21.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.3"}
  %compare.1704.1 = pred[1]{0} compare(%select.1349.3, %constant_5299_9), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.1"}
  %add.2978.1 = s32[1]{0} add(%select.1349.3, %constant_5308_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.1"}
  %select.1350.4 = s32[1]{0} select(%compare.1704.1, %add.2978.1, %select.1349.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.4"}
  %bitcast.24671.7 = s32[1,1]{1,0} bitcast(%select.1350.4), metadata={scheduling_name="bitcast.24671.7"}
  %concatenate.719.5 = s32[1,4]{1,0} concatenate(%constant_5310_3, %bitcast.24671.7, %constant_5310_3, %constant_5310_3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.719.5"}
  %bitcast.24951.3 = s32[4]{0} bitcast(%concatenate.719.5), metadata={scheduling_name="bitcast.24951.3"}
  %slice.2419.3 = s32[1]{0} slice(%bitcast.24951.3), slice={[1:2]}, metadata={scheduling_name="slice.2419.3"}
  %bitcast.25519.2 = s32[] bitcast(%slice.2419.3), metadata={scheduling_name="bitcast.25519.2"}
  ROOT %dynamic-slice.1454.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_0.2619, %constant_5288_25, %bitcast.25519.2, %constant_5288_25, %constant_5288_25), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1454.1"}
}

%fused_reduce.4 (param_0.3354: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.3354 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.3354"}
  %bitcast.24900.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3354), metadata={scheduling_name="bitcast.24900.9"}
  %convert.4228.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.24900.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4228.9"}
  %multiply.2683.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4228.9, %convert.4228.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2683.3"}
  %bitcast.24907.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2683.3), metadata={scheduling_name="bitcast.24907.1"}
  %constant_5293_5 = f32[] constant(0)
  ROOT %reduce.428.1 = f32[4,8192]{1,0} reduce(%bitcast.24907.1, %constant_5293_5), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.428.1"}
}

%fused_dynamic_slice.3 (param_0.3334: bf16[1,2,48,128,768], param_1.3533: s32[1], param_2.2794: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.3334 = bf16[1,2,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3334"}
  %bitcast.24881.1 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param_0.3334), metadata={scheduling_name="bitcast.24881.1"}
  %constant_5288_7 = s32[] constant(0)
  %constant_5310_8 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2794 = s32[] parameter(2), metadata={scheduling_name="param_2.2794"}
  %bitcast.24639.24 = s32[1]{0} bitcast(%param_2.2794), metadata={scheduling_name="bitcast.24639.24"}
  %param_1.3533 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3533"}
  %subtract.259.23 = s32[1]{0} subtract(%bitcast.24639.24, %param_1.3533), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.23"}
  %constant_5299_14 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.17 = s32[1]{0} maximum(%subtract.259.23, %constant_5299_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.17"}
  %sign.28.16 = s32[1]{0} sign(%maximum.48.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.16"}
  %constant_5306_9 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.16 = pred[1]{0} compare(%sign.28.16, %constant_5306_9), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.16"}
  %constant_5307_10 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.17 = s32[1]{0} and(%maximum.48.17, %constant_5307_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.17"}
  %compare.1703.17 = pred[1]{0} compare(%and.321.17, %constant_5299_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.17"}
  %and.322.16 = pred[1]{0} and(%compare.1702.16, %compare.1703.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.16"}
  %constant_5308_9 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.16 = s32[1]{0} shift-right-logical(%maximum.48.17, %constant_5308_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.16"}
  %constant_5309_9 = s32[1]{0} constant({-1})
  %add.2977.16 = s32[1]{0} add(%shift-right-logical.21.16, %constant_5309_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.16"}
  %select.1349.16 = s32[1]{0} select(%and.322.16, %add.2977.16, %shift-right-logical.21.16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.16"}
  %compare.1704.16 = pred[1]{0} compare(%select.1349.16, %constant_5299_14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.16"}
  %add.2978.16 = s32[1]{0} add(%select.1349.16, %constant_5308_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.16"}
  %select.1350.16 = s32[1]{0} select(%compare.1704.16, %add.2978.16, %select.1349.16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.16"}
  %bitcast.24671.23 = s32[1,1]{1,0} bitcast(%select.1350.16), metadata={scheduling_name="bitcast.24671.23"}
  %concatenate.716.13 = s32[1,5]{1,0} concatenate(%constant_5310_8, %bitcast.24671.23, %constant_5310_8, %constant_5310_8, %constant_5310_8), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.13"}
  %bitcast.24699.11 = s32[5]{0} bitcast(%concatenate.716.13), metadata={scheduling_name="bitcast.24699.11"}
  %slice.2414.11 = s32[1]{0} slice(%bitcast.24699.11), slice={[1:2]}, metadata={scheduling_name="slice.2414.11"}
  %bitcast.25802.4 = s32[] bitcast(%slice.2414.11), metadata={scheduling_name="bitcast.25802.4"}
  ROOT %dynamic-slice.1441.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.24881.1, %constant_5288_7, %bitcast.25802.4, %constant_5288_7, %constant_5288_7, /*index=5*/%constant_5288_7), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1441.1"}
}

%fused_dynamic_slice.4 (param_0.2661: bf16[1,2,768,48,128], param_1.3530: s32[1], param_2.2791: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.2661 = bf16[1,2,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2661"}
  %constant_5288_23 = s32[] constant(0)
  %constant_5310_5 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2791 = s32[] parameter(2), metadata={scheduling_name="param_2.2791"}
  %bitcast.24639.18 = s32[1]{0} bitcast(%param_2.2791), metadata={scheduling_name="bitcast.24639.18"}
  %param_1.3530 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3530"}
  %subtract.259.17 = s32[1]{0} subtract(%bitcast.24639.18, %param_1.3530), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.17"}
  %constant_5299_11 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.11 = s32[1]{0} maximum(%subtract.259.17, %constant_5299_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.11"}
  %sign.28.10 = s32[1]{0} sign(%maximum.48.11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.10"}
  %constant_5306_6 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.10 = pred[1]{0} compare(%sign.28.10, %constant_5306_6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.10"}
  %constant_5307_7 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.11 = s32[1]{0} and(%maximum.48.11, %constant_5307_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.11"}
  %compare.1703.11 = pred[1]{0} compare(%and.321.11, %constant_5299_11), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.11"}
  %and.322.10 = pred[1]{0} and(%compare.1702.10, %compare.1703.11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.10"}
  %constant_5308_6 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.10 = s32[1]{0} shift-right-logical(%maximum.48.11, %constant_5308_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.10"}
  %constant_5309_6 = s32[1]{0} constant({-1})
  %add.2977.10 = s32[1]{0} add(%shift-right-logical.21.10, %constant_5309_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.10"}
  %select.1349.10 = s32[1]{0} select(%and.322.10, %add.2977.10, %shift-right-logical.21.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.10"}
  %compare.1704.10 = pred[1]{0} compare(%select.1349.10, %constant_5299_11), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.10"}
  %add.2978.10 = s32[1]{0} add(%select.1349.10, %constant_5308_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.10"}
  %select.1350.10 = s32[1]{0} select(%compare.1704.10, %add.2978.10, %select.1349.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.10"}
  %bitcast.24671.17 = s32[1,1]{1,0} bitcast(%select.1350.10), metadata={scheduling_name="bitcast.24671.17"}
  %concatenate.716.7 = s32[1,5]{1,0} concatenate(%constant_5310_5, %bitcast.24671.17, %constant_5310_5, %constant_5310_5, %constant_5310_5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.7"}
  %bitcast.24699.5 = s32[5]{0} bitcast(%concatenate.716.7), metadata={scheduling_name="bitcast.24699.5"}
  %slice.2414.5 = s32[1]{0} slice(%bitcast.24699.5), slice={[1:2]}, metadata={scheduling_name="slice.2414.5"}
  %bitcast.25802.1 = s32[] bitcast(%slice.2414.5), metadata={scheduling_name="bitcast.25802.1"}
  ROOT %dynamic-slice.1437.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_0.2661, %constant_5288_23, %bitcast.25802.1, %constant_5288_23, %constant_5288_23, /*index=5*/%constant_5288_23), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1437.1"}
}

%fused_dynamic_slice.5 (param_0.2662: bf16[1,2,768,8,128], param_1.3531: s32[1], param_2.2792: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2662 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2662"}
  %constant_5288_9 = s32[] constant(0)
  %constant_5310_6 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2792 = s32[] parameter(2), metadata={scheduling_name="param_2.2792"}
  %bitcast.24639.20 = s32[1]{0} bitcast(%param_2.2792), metadata={scheduling_name="bitcast.24639.20"}
  %param_1.3531 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3531"}
  %subtract.259.19 = s32[1]{0} subtract(%bitcast.24639.20, %param_1.3531), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.19"}
  %constant_5299_12 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.13 = s32[1]{0} maximum(%subtract.259.19, %constant_5299_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.13"}
  %sign.28.12 = s32[1]{0} sign(%maximum.48.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.12"}
  %constant_5306_7 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.12 = pred[1]{0} compare(%sign.28.12, %constant_5306_7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.12"}
  %constant_5307_8 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.13 = s32[1]{0} and(%maximum.48.13, %constant_5307_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.13"}
  %compare.1703.13 = pred[1]{0} compare(%and.321.13, %constant_5299_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.13"}
  %and.322.12 = pred[1]{0} and(%compare.1702.12, %compare.1703.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.12"}
  %constant_5308_7 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.12 = s32[1]{0} shift-right-logical(%maximum.48.13, %constant_5308_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.12"}
  %constant_5309_7 = s32[1]{0} constant({-1})
  %add.2977.12 = s32[1]{0} add(%shift-right-logical.21.12, %constant_5309_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.12"}
  %select.1349.12 = s32[1]{0} select(%and.322.12, %add.2977.12, %shift-right-logical.21.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.12"}
  %compare.1704.12 = pred[1]{0} compare(%select.1349.12, %constant_5299_12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.12"}
  %add.2978.12 = s32[1]{0} add(%select.1349.12, %constant_5308_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.12"}
  %select.1350.12 = s32[1]{0} select(%compare.1704.12, %add.2978.12, %select.1349.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.12"}
  %bitcast.24671.19 = s32[1,1]{1,0} bitcast(%select.1350.12), metadata={scheduling_name="bitcast.24671.19"}
  %concatenate.716.9 = s32[1,5]{1,0} concatenate(%constant_5310_6, %bitcast.24671.19, %constant_5310_6, %constant_5310_6, %constant_5310_6), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.9"}
  %bitcast.24699.7 = s32[5]{0} bitcast(%concatenate.716.9), metadata={scheduling_name="bitcast.24699.7"}
  %slice.2414.7 = s32[1]{0} slice(%bitcast.24699.7), slice={[1:2]}, metadata={scheduling_name="slice.2414.7"}
  %bitcast.25802.2 = s32[] bitcast(%slice.2414.7), metadata={scheduling_name="bitcast.25802.2"}
  ROOT %dynamic-slice.1439.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2662, %constant_5288_9, %bitcast.25802.2, %constant_5288_9, %constant_5288_9, /*index=5*/%constant_5288_9), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1439.1"}
}

%fused_dynamic_slice.6 (param_0.2663: bf16[1,2,768,8,128], param_1.3532: s32[1], param_2.2793: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2663 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2663"}
  %constant_5288_4 = s32[] constant(0)
  %constant_5310_7 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2793 = s32[] parameter(2), metadata={scheduling_name="param_2.2793"}
  %bitcast.24639.22 = s32[1]{0} bitcast(%param_2.2793), metadata={scheduling_name="bitcast.24639.22"}
  %param_1.3532 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3532"}
  %subtract.259.21 = s32[1]{0} subtract(%bitcast.24639.22, %param_1.3532), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.21"}
  %constant_5299_13 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.15 = s32[1]{0} maximum(%subtract.259.21, %constant_5299_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.15"}
  %sign.28.14 = s32[1]{0} sign(%maximum.48.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.14"}
  %constant_5306_8 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.14 = pred[1]{0} compare(%sign.28.14, %constant_5306_8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.14"}
  %constant_5307_9 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.15 = s32[1]{0} and(%maximum.48.15, %constant_5307_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.15"}
  %compare.1703.15 = pred[1]{0} compare(%and.321.15, %constant_5299_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.15"}
  %and.322.14 = pred[1]{0} and(%compare.1702.14, %compare.1703.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.14"}
  %constant_5308_8 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.14 = s32[1]{0} shift-right-logical(%maximum.48.15, %constant_5308_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.14"}
  %constant_5309_8 = s32[1]{0} constant({-1})
  %add.2977.14 = s32[1]{0} add(%shift-right-logical.21.14, %constant_5309_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.14"}
  %select.1349.14 = s32[1]{0} select(%and.322.14, %add.2977.14, %shift-right-logical.21.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.14"}
  %compare.1704.14 = pred[1]{0} compare(%select.1349.14, %constant_5299_13), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.14"}
  %add.2978.14 = s32[1]{0} add(%select.1349.14, %constant_5308_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.14"}
  %select.1350.14 = s32[1]{0} select(%compare.1704.14, %add.2978.14, %select.1349.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.14"}
  %bitcast.24671.21 = s32[1,1]{1,0} bitcast(%select.1350.14), metadata={scheduling_name="bitcast.24671.21"}
  %concatenate.716.11 = s32[1,5]{1,0} concatenate(%constant_5310_7, %bitcast.24671.21, %constant_5310_7, %constant_5310_7, %constant_5310_7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.11"}
  %bitcast.24699.9 = s32[5]{0} bitcast(%concatenate.716.11), metadata={scheduling_name="bitcast.24699.9"}
  %slice.2414.9 = s32[1]{0} slice(%bitcast.24699.9), slice={[1:2]}, metadata={scheduling_name="slice.2414.9"}
  %bitcast.25802.3 = s32[] bitcast(%slice.2414.9), metadata={scheduling_name="bitcast.25802.3"}
  ROOT %dynamic-slice.1440.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2663, %constant_5288_4, %bitcast.25802.3, %constant_5288_4, %constant_5288_4, /*index=5*/%constant_5288_4), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1440.1"}
}

%fused_dynamic_slice.7 (param_0.2664: bf16[1,2,1,6144,16384], param_1.3534: s32[1], param_2.2795: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2664 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2664"}
  %constant_5288_15 = s32[] constant(0)
  %constant_5310_9 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2795 = s32[] parameter(2), metadata={scheduling_name="param_2.2795"}
  %bitcast.24639.26 = s32[1]{0} bitcast(%param_2.2795), metadata={scheduling_name="bitcast.24639.26"}
  %param_1.3534 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3534"}
  %subtract.259.25 = s32[1]{0} subtract(%bitcast.24639.26, %param_1.3534), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.25"}
  %constant_5299_15 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.19 = s32[1]{0} maximum(%subtract.259.25, %constant_5299_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.19"}
  %sign.28.18 = s32[1]{0} sign(%maximum.48.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.18"}
  %constant_5306_10 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.18 = pred[1]{0} compare(%sign.28.18, %constant_5306_10), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.18"}
  %constant_5307_11 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.19 = s32[1]{0} and(%maximum.48.19, %constant_5307_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.19"}
  %compare.1703.19 = pred[1]{0} compare(%and.321.19, %constant_5299_15), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.19"}
  %and.322.18 = pred[1]{0} and(%compare.1702.18, %compare.1703.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.18"}
  %constant_5308_10 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.18 = s32[1]{0} shift-right-logical(%maximum.48.19, %constant_5308_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.18"}
  %constant_5309_10 = s32[1]{0} constant({-1})
  %add.2977.18 = s32[1]{0} add(%shift-right-logical.21.18, %constant_5309_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.18"}
  %select.1349.18 = s32[1]{0} select(%and.322.18, %add.2977.18, %shift-right-logical.21.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.18"}
  %compare.1704.18 = pred[1]{0} compare(%select.1349.18, %constant_5299_15), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.18"}
  %add.2978.18 = s32[1]{0} add(%select.1349.18, %constant_5308_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.18"}
  %select.1350.18 = s32[1]{0} select(%compare.1704.18, %add.2978.18, %select.1349.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.18"}
  %bitcast.24671.25 = s32[1,1]{1,0} bitcast(%select.1350.18), metadata={scheduling_name="bitcast.24671.25"}
  %concatenate.716.15 = s32[1,5]{1,0} concatenate(%constant_5310_9, %bitcast.24671.25, %constant_5310_9, %constant_5310_9, %constant_5310_9), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.15"}
  %bitcast.24699.13 = s32[5]{0} bitcast(%concatenate.716.15), metadata={scheduling_name="bitcast.24699.13"}
  %slice.2414.13 = s32[1]{0} slice(%bitcast.24699.13), slice={[1:2]}, metadata={scheduling_name="slice.2414.13"}
  %bitcast.25802.5 = s32[] bitcast(%slice.2414.13), metadata={scheduling_name="bitcast.25802.5"}
  ROOT %dynamic-slice.1445.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2664, %constant_5288_15, %bitcast.25802.5, %constant_5288_15, %constant_5288_15, /*index=5*/%constant_5288_15), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1445.1"}
}

%fused_dynamic_slice.8 (param_0.2665: bf16[1,2,1,6144,16384], param_1.3535: s32[1], param_2.2796: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2665 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2665"}
  %constant_5288_17 = s32[] constant(0)
  %constant_5310_10 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2796 = s32[] parameter(2), metadata={scheduling_name="param_2.2796"}
  %bitcast.24639.28 = s32[1]{0} bitcast(%param_2.2796), metadata={scheduling_name="bitcast.24639.28"}
  %param_1.3535 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3535"}
  %subtract.259.27 = s32[1]{0} subtract(%bitcast.24639.28, %param_1.3535), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.27"}
  %constant_5299_16 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.21 = s32[1]{0} maximum(%subtract.259.27, %constant_5299_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.21"}
  %sign.28.20 = s32[1]{0} sign(%maximum.48.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.20"}
  %constant_5306_11 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.20 = pred[1]{0} compare(%sign.28.20, %constant_5306_11), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.20"}
  %constant_5307_12 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.21 = s32[1]{0} and(%maximum.48.21, %constant_5307_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.21"}
  %compare.1703.21 = pred[1]{0} compare(%and.321.21, %constant_5299_16), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.21"}
  %and.322.20 = pred[1]{0} and(%compare.1702.20, %compare.1703.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.20"}
  %constant_5308_11 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.20 = s32[1]{0} shift-right-logical(%maximum.48.21, %constant_5308_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.20"}
  %constant_5309_11 = s32[1]{0} constant({-1})
  %add.2977.20 = s32[1]{0} add(%shift-right-logical.21.20, %constant_5309_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.20"}
  %select.1349.20 = s32[1]{0} select(%and.322.20, %add.2977.20, %shift-right-logical.21.20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.20"}
  %compare.1704.20 = pred[1]{0} compare(%select.1349.20, %constant_5299_16), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.20"}
  %add.2978.20 = s32[1]{0} add(%select.1349.20, %constant_5308_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.20"}
  %select.1350.20 = s32[1]{0} select(%compare.1704.20, %add.2978.20, %select.1349.20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.20"}
  %bitcast.24671.27 = s32[1,1]{1,0} bitcast(%select.1350.20), metadata={scheduling_name="bitcast.24671.27"}
  %concatenate.716.17 = s32[1,5]{1,0} concatenate(%constant_5310_10, %bitcast.24671.27, %constant_5310_10, %constant_5310_10, %constant_5310_10), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.17"}
  %bitcast.24699.15 = s32[5]{0} bitcast(%concatenate.716.17), metadata={scheduling_name="bitcast.24699.15"}
  %slice.2414.15 = s32[1]{0} slice(%bitcast.24699.15), slice={[1:2]}, metadata={scheduling_name="slice.2414.15"}
  %bitcast.25802.6 = s32[] bitcast(%slice.2414.15), metadata={scheduling_name="bitcast.25802.6"}
  ROOT %dynamic-slice.1446.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2665, %constant_5288_17, %bitcast.25802.6, %constant_5288_17, %constant_5288_17, /*index=5*/%constant_5288_17), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1446.1"}
}

%fused_dynamic_slice.9 (param_0.2666: bf16[1,2,1,16384,6144], param_1.3536: s32[1], param_2.2797: s32[]) -> bf16[1,1,1,16384,6144] {
  %param_0.2666 = bf16[1,2,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2666"}
  %constant_5288_34 = s32[] constant(0)
  %constant_5310_11 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2797 = s32[] parameter(2), metadata={scheduling_name="param_2.2797"}
  %bitcast.24639.30 = s32[1]{0} bitcast(%param_2.2797), metadata={scheduling_name="bitcast.24639.30"}
  %param_1.3536 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3536"}
  %subtract.259.29 = s32[1]{0} subtract(%bitcast.24639.30, %param_1.3536), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.29"}
  %constant_5299_17 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.23 = s32[1]{0} maximum(%subtract.259.29, %constant_5299_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.23"}
  %sign.28.22 = s32[1]{0} sign(%maximum.48.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.22"}
  %constant_5306_12 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.22 = pred[1]{0} compare(%sign.28.22, %constant_5306_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.22"}
  %constant_5307_13 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.23 = s32[1]{0} and(%maximum.48.23, %constant_5307_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.23"}
  %compare.1703.23 = pred[1]{0} compare(%and.321.23, %constant_5299_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.23"}
  %and.322.22 = pred[1]{0} and(%compare.1702.22, %compare.1703.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.22"}
  %constant_5308_12 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.22 = s32[1]{0} shift-right-logical(%maximum.48.23, %constant_5308_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.22"}
  %constant_5309_12 = s32[1]{0} constant({-1})
  %add.2977.22 = s32[1]{0} add(%shift-right-logical.21.22, %constant_5309_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.22"}
  %select.1349.22 = s32[1]{0} select(%and.322.22, %add.2977.22, %shift-right-logical.21.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.22"}
  %compare.1704.22 = pred[1]{0} compare(%select.1349.22, %constant_5299_17), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.22"}
  %add.2978.22 = s32[1]{0} add(%select.1349.22, %constant_5308_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.22"}
  %select.1350.22 = s32[1]{0} select(%compare.1704.22, %add.2978.22, %select.1349.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.22"}
  %bitcast.24671.29 = s32[1,1]{1,0} bitcast(%select.1350.22), metadata={scheduling_name="bitcast.24671.29"}
  %concatenate.716.19 = s32[1,5]{1,0} concatenate(%constant_5310_11, %bitcast.24671.29, %constant_5310_11, %constant_5310_11, %constant_5310_11), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.19"}
  %bitcast.24699.17 = s32[5]{0} bitcast(%concatenate.716.19), metadata={scheduling_name="bitcast.24699.17"}
  %slice.2414.17 = s32[1]{0} slice(%bitcast.24699.17), slice={[1:2]}, metadata={scheduling_name="slice.2414.17"}
  %bitcast.25802.7 = s32[] bitcast(%slice.2414.17), metadata={scheduling_name="bitcast.25802.7"}
  ROOT %dynamic-slice.1447.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_0.2666, %constant_5288_34, %bitcast.25802.7, %constant_5288_34, %constant_5288_34, /*index=5*/%constant_5288_34), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1447.1"}
}

%fused_dynamic_slice.10 (param_0.2667: bf16[1,2,768,48,128], param_1.3537: s32[1], param_2.2798: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.2667 = bf16[1,2,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2667"}
  %constant_5288_47 = s32[] constant(0)
  %constant_5310_12 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2798 = s32[] parameter(2), metadata={scheduling_name="param_2.2798"}
  %bitcast.24639.32 = s32[1]{0} bitcast(%param_2.2798), metadata={scheduling_name="bitcast.24639.32"}
  %param_1.3537 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3537"}
  %subtract.259.31 = s32[1]{0} subtract(%bitcast.24639.32, %param_1.3537), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.31"}
  %constant_5299_18 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.25 = s32[1]{0} maximum(%subtract.259.31, %constant_5299_18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.25"}
  %sign.28.24 = s32[1]{0} sign(%maximum.48.25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.24"}
  %constant_5306_13 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.24 = pred[1]{0} compare(%sign.28.24, %constant_5306_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.24"}
  %constant_5307_14 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.25 = s32[1]{0} and(%maximum.48.25, %constant_5307_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.25"}
  %compare.1703.25 = pred[1]{0} compare(%and.321.25, %constant_5299_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.25"}
  %and.322.24 = pred[1]{0} and(%compare.1702.24, %compare.1703.25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.24"}
  %constant_5308_13 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.24 = s32[1]{0} shift-right-logical(%maximum.48.25, %constant_5308_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.24"}
  %constant_5309_13 = s32[1]{0} constant({-1})
  %add.2977.24 = s32[1]{0} add(%shift-right-logical.21.24, %constant_5309_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.24"}
  %select.1349.24 = s32[1]{0} select(%and.322.24, %add.2977.24, %shift-right-logical.21.24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.24"}
  %compare.1704.24 = pred[1]{0} compare(%select.1349.24, %constant_5299_18), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.24"}
  %add.2978.24 = s32[1]{0} add(%select.1349.24, %constant_5308_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.24"}
  %select.1350.24 = s32[1]{0} select(%compare.1704.24, %add.2978.24, %select.1349.24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.24"}
  %bitcast.24671.31 = s32[1,1]{1,0} bitcast(%select.1350.24), metadata={scheduling_name="bitcast.24671.31"}
  %concatenate.716.21 = s32[1,5]{1,0} concatenate(%constant_5310_12, %bitcast.24671.31, %constant_5310_12, %constant_5310_12, %constant_5310_12), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.21"}
  %bitcast.24699.19 = s32[5]{0} bitcast(%concatenate.716.21), metadata={scheduling_name="bitcast.24699.19"}
  %slice.2414.19 = s32[1]{0} slice(%bitcast.24699.19), slice={[1:2]}, metadata={scheduling_name="slice.2414.19"}
  %bitcast.25802.8 = s32[] bitcast(%slice.2414.19), metadata={scheduling_name="bitcast.25802.8"}
  ROOT %dynamic-slice.1449.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_0.2667, %constant_5288_47, %bitcast.25802.8, %constant_5288_47, %constant_5288_47, /*index=5*/%constant_5288_47), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1449.1"}
}

%fused_dynamic_slice.11 (param_0.2668: bf16[1,2,768,8,128], param_1.3538: s32[1], param_2.2799: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2668 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2668"}
  %constant_5288_37 = s32[] constant(0)
  %constant_5310_13 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2799 = s32[] parameter(2), metadata={scheduling_name="param_2.2799"}
  %bitcast.24639.34 = s32[1]{0} bitcast(%param_2.2799), metadata={scheduling_name="bitcast.24639.34"}
  %param_1.3538 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3538"}
  %subtract.259.33 = s32[1]{0} subtract(%bitcast.24639.34, %param_1.3538), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.33"}
  %constant_5299_19 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.27 = s32[1]{0} maximum(%subtract.259.33, %constant_5299_19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.27"}
  %sign.28.26 = s32[1]{0} sign(%maximum.48.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.26"}
  %constant_5306_14 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.26 = pred[1]{0} compare(%sign.28.26, %constant_5306_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.26"}
  %constant_5307_15 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.27 = s32[1]{0} and(%maximum.48.27, %constant_5307_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.27"}
  %compare.1703.27 = pred[1]{0} compare(%and.321.27, %constant_5299_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.27"}
  %and.322.26 = pred[1]{0} and(%compare.1702.26, %compare.1703.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.26"}
  %constant_5308_14 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.26 = s32[1]{0} shift-right-logical(%maximum.48.27, %constant_5308_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.26"}
  %constant_5309_14 = s32[1]{0} constant({-1})
  %add.2977.26 = s32[1]{0} add(%shift-right-logical.21.26, %constant_5309_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.26"}
  %select.1349.26 = s32[1]{0} select(%and.322.26, %add.2977.26, %shift-right-logical.21.26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.26"}
  %compare.1704.26 = pred[1]{0} compare(%select.1349.26, %constant_5299_19), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.26"}
  %add.2978.26 = s32[1]{0} add(%select.1349.26, %constant_5308_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.26"}
  %select.1350.26 = s32[1]{0} select(%compare.1704.26, %add.2978.26, %select.1349.26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.26"}
  %bitcast.24671.33 = s32[1,1]{1,0} bitcast(%select.1350.26), metadata={scheduling_name="bitcast.24671.33"}
  %concatenate.716.23 = s32[1,5]{1,0} concatenate(%constant_5310_13, %bitcast.24671.33, %constant_5310_13, %constant_5310_13, %constant_5310_13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.23"}
  %bitcast.24699.21 = s32[5]{0} bitcast(%concatenate.716.23), metadata={scheduling_name="bitcast.24699.21"}
  %slice.2414.21 = s32[1]{0} slice(%bitcast.24699.21), slice={[1:2]}, metadata={scheduling_name="slice.2414.21"}
  %bitcast.25802.9 = s32[] bitcast(%slice.2414.21), metadata={scheduling_name="bitcast.25802.9"}
  ROOT %dynamic-slice.1450.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2668, %constant_5288_37, %bitcast.25802.9, %constant_5288_37, %constant_5288_37, /*index=5*/%constant_5288_37), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1450.1"}
}

%fused_dynamic_slice.12 (param_0.2669: bf16[1,2,768,8,128], param_1.3539: s32[1], param_2.2800: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2669 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2669"}
  %constant_5288_51 = s32[] constant(0)
  %constant_5310_14 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2800 = s32[] parameter(2), metadata={scheduling_name="param_2.2800"}
  %bitcast.24639.36 = s32[1]{0} bitcast(%param_2.2800), metadata={scheduling_name="bitcast.24639.36"}
  %param_1.3539 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3539"}
  %subtract.259.35 = s32[1]{0} subtract(%bitcast.24639.36, %param_1.3539), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.35"}
  %constant_5299_20 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.29 = s32[1]{0} maximum(%subtract.259.35, %constant_5299_20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.29"}
  %sign.28.28 = s32[1]{0} sign(%maximum.48.29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.28"}
  %constant_5306_15 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.28 = pred[1]{0} compare(%sign.28.28, %constant_5306_15), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.28"}
  %constant_5307_16 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.29 = s32[1]{0} and(%maximum.48.29, %constant_5307_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.29"}
  %compare.1703.29 = pred[1]{0} compare(%and.321.29, %constant_5299_20), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.29"}
  %and.322.28 = pred[1]{0} and(%compare.1702.28, %compare.1703.29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.28"}
  %constant_5308_15 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.28 = s32[1]{0} shift-right-logical(%maximum.48.29, %constant_5308_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.28"}
  %constant_5309_15 = s32[1]{0} constant({-1})
  %add.2977.28 = s32[1]{0} add(%shift-right-logical.21.28, %constant_5309_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.28"}
  %select.1349.28 = s32[1]{0} select(%and.322.28, %add.2977.28, %shift-right-logical.21.28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.28"}
  %compare.1704.28 = pred[1]{0} compare(%select.1349.28, %constant_5299_20), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.28"}
  %add.2978.28 = s32[1]{0} add(%select.1349.28, %constant_5308_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.28"}
  %select.1350.28 = s32[1]{0} select(%compare.1704.28, %add.2978.28, %select.1349.28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.28"}
  %bitcast.24671.35 = s32[1,1]{1,0} bitcast(%select.1350.28), metadata={scheduling_name="bitcast.24671.35"}
  %concatenate.716.25 = s32[1,5]{1,0} concatenate(%constant_5310_14, %bitcast.24671.35, %constant_5310_14, %constant_5310_14, %constant_5310_14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.25"}
  %bitcast.24699.23 = s32[5]{0} bitcast(%concatenate.716.25), metadata={scheduling_name="bitcast.24699.23"}
  %slice.2414.23 = s32[1]{0} slice(%bitcast.24699.23), slice={[1:2]}, metadata={scheduling_name="slice.2414.23"}
  %bitcast.25802.10 = s32[] bitcast(%slice.2414.23), metadata={scheduling_name="bitcast.25802.10"}
  ROOT %dynamic-slice.1451.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2669, %constant_5288_51, %bitcast.25802.10, %constant_5288_51, %constant_5288_51, /*index=5*/%constant_5288_51), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1451.1"}
}

%fused_dynamic_slice.13 (param_0.2670: bf16[1,2,1,6144,16384], param_1.3541: s32[1], param_2.2802: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2670 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2670"}
  %constant_5288_18 = s32[] constant(0)
  %constant_5310_16 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2802 = s32[] parameter(2), metadata={scheduling_name="param_2.2802"}
  %bitcast.24639.40 = s32[1]{0} bitcast(%param_2.2802), metadata={scheduling_name="bitcast.24639.40"}
  %param_1.3541 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3541"}
  %subtract.259.39 = s32[1]{0} subtract(%bitcast.24639.40, %param_1.3541), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.39"}
  %constant_5299_22 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.33 = s32[1]{0} maximum(%subtract.259.39, %constant_5299_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.33"}
  %sign.28.32 = s32[1]{0} sign(%maximum.48.33), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.32"}
  %constant_5306_17 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.32 = pred[1]{0} compare(%sign.28.32, %constant_5306_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.32"}
  %constant_5307_18 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.33 = s32[1]{0} and(%maximum.48.33, %constant_5307_18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.33"}
  %compare.1703.33 = pred[1]{0} compare(%and.321.33, %constant_5299_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.33"}
  %and.322.32 = pred[1]{0} and(%compare.1702.32, %compare.1703.33), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.32"}
  %constant_5308_17 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.32 = s32[1]{0} shift-right-logical(%maximum.48.33, %constant_5308_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.32"}
  %constant_5309_17 = s32[1]{0} constant({-1})
  %add.2977.32 = s32[1]{0} add(%shift-right-logical.21.32, %constant_5309_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.32"}
  %select.1349.32 = s32[1]{0} select(%and.322.32, %add.2977.32, %shift-right-logical.21.32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.32"}
  %compare.1704.32 = pred[1]{0} compare(%select.1349.32, %constant_5299_22), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.32"}
  %add.2978.32 = s32[1]{0} add(%select.1349.32, %constant_5308_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.32"}
  %select.1350.32 = s32[1]{0} select(%compare.1704.32, %add.2978.32, %select.1349.32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.32"}
  %bitcast.24671.39 = s32[1,1]{1,0} bitcast(%select.1350.32), metadata={scheduling_name="bitcast.24671.39"}
  %concatenate.716.29 = s32[1,5]{1,0} concatenate(%constant_5310_16, %bitcast.24671.39, %constant_5310_16, %constant_5310_16, %constant_5310_16), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.29"}
  %bitcast.24699.27 = s32[5]{0} bitcast(%concatenate.716.29), metadata={scheduling_name="bitcast.24699.27"}
  %slice.2414.27 = s32[1]{0} slice(%bitcast.24699.27), slice={[1:2]}, metadata={scheduling_name="slice.2414.27"}
  %bitcast.25802.12 = s32[] bitcast(%slice.2414.27), metadata={scheduling_name="bitcast.25802.12"}
  ROOT %dynamic-slice.1455.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2670, %constant_5288_18, %bitcast.25802.12, %constant_5288_18, %constant_5288_18, /*index=5*/%constant_5288_18), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1455.1"}
}

%fused_dynamic_slice.14 (param_0.2671: bf16[1,2,1,6144,16384], param_1.3527: s32[1], param_2.2788: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2671 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2671"}
  %constant_5288_28 = s32[] constant(0)
  %constant_5310_2 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2788 = s32[] parameter(2), metadata={scheduling_name="param_2.2788"}
  %bitcast.24639.42 = s32[1]{0} bitcast(%param_2.2788), metadata={scheduling_name="bitcast.24639.42"}
  %param_1.3527 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3527"}
  %subtract.259.41 = s32[1]{0} subtract(%bitcast.24639.42, %param_1.3527), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.41"}
  %constant_5299_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.35 = s32[1]{0} maximum(%subtract.259.41, %constant_5299_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.35"}
  %sign.28.34 = s32[1]{0} sign(%maximum.48.35), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.34"}
  %constant_5306_4 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.34 = pred[1]{0} compare(%sign.28.34, %constant_5306_4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.34"}
  %constant_5307_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.35 = s32[1]{0} and(%maximum.48.35, %constant_5307_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.35"}
  %compare.1703.35 = pred[1]{0} compare(%and.321.35, %constant_5299_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.35"}
  %and.322.34 = pred[1]{0} and(%compare.1702.34, %compare.1703.35), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.34"}
  %constant_5308_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.34 = s32[1]{0} shift-right-logical(%maximum.48.35, %constant_5308_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.34"}
  %constant_5309_3 = s32[1]{0} constant({-1})
  %add.2977.34 = s32[1]{0} add(%shift-right-logical.21.34, %constant_5309_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.34"}
  %select.1349.34 = s32[1]{0} select(%and.322.34, %add.2977.34, %shift-right-logical.21.34), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.34"}
  %compare.1704.34 = pred[1]{0} compare(%select.1349.34, %constant_5299_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.34"}
  %add.2978.34 = s32[1]{0} add(%select.1349.34, %constant_5308_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.34"}
  %select.1350.34 = s32[1]{0} select(%compare.1704.34, %add.2978.34, %select.1349.34), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.34"}
  %bitcast.24671.41 = s32[1,1]{1,0} bitcast(%select.1350.34), metadata={scheduling_name="bitcast.24671.41"}
  %concatenate.716.31 = s32[1,5]{1,0} concatenate(%constant_5310_2, %bitcast.24671.41, %constant_5310_2, %constant_5310_2, %constant_5310_2), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.31"}
  %bitcast.24699.29 = s32[5]{0} bitcast(%concatenate.716.31), metadata={scheduling_name="bitcast.24699.29"}
  %slice.2414.29 = s32[1]{0} slice(%bitcast.24699.29), slice={[1:2]}, metadata={scheduling_name="slice.2414.29"}
  %bitcast.25802.13 = s32[] bitcast(%slice.2414.29), metadata={scheduling_name="bitcast.25802.13"}
  ROOT %dynamic-slice.1456.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2671, %constant_5288_28, %bitcast.25802.13, %constant_5288_28, %constant_5288_28, /*index=5*/%constant_5288_28), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1456.1"}
}

%fused_dynamic_slice.15 (param_0.2672: bf16[1,2,1,16384,6144], param_1.3529: s32[1], param_2.2790: s32[]) -> bf16[1,1,1,16384,6144] {
  %param_0.2672 = bf16[1,2,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2672"}
  %constant_5288_44 = s32[] constant(0)
  %constant_5310_4 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2790 = s32[] parameter(2), metadata={scheduling_name="param_2.2790"}
  %bitcast.24639.16 = s32[1]{0} bitcast(%param_2.2790), metadata={scheduling_name="bitcast.24639.16"}
  %param_1.3529 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3529"}
  %subtract.259.15 = s32[1]{0} subtract(%bitcast.24639.16, %param_1.3529), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.15"}
  %constant_5299_10 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.9 = s32[1]{0} maximum(%subtract.259.15, %constant_5299_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.9"}
  %sign.28.8 = s32[1]{0} sign(%maximum.48.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.8"}
  %constant_5306_5 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.8 = pred[1]{0} compare(%sign.28.8, %constant_5306_5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.8"}
  %constant_5307_6 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.9 = s32[1]{0} and(%maximum.48.9, %constant_5307_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.9"}
  %compare.1703.9 = pred[1]{0} compare(%and.321.9, %constant_5299_10), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.9"}
  %and.322.8 = pred[1]{0} and(%compare.1702.8, %compare.1703.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.8"}
  %constant_5308_5 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.8 = s32[1]{0} shift-right-logical(%maximum.48.9, %constant_5308_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.8"}
  %constant_5309_5 = s32[1]{0} constant({-1})
  %add.2977.8 = s32[1]{0} add(%shift-right-logical.21.8, %constant_5309_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.8"}
  %select.1349.8 = s32[1]{0} select(%and.322.8, %add.2977.8, %shift-right-logical.21.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.8"}
  %compare.1704.8 = pred[1]{0} compare(%select.1349.8, %constant_5299_10), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.8"}
  %add.2978.8 = s32[1]{0} add(%select.1349.8, %constant_5308_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.8"}
  %select.1350.8 = s32[1]{0} select(%compare.1704.8, %add.2978.8, %select.1349.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.8"}
  %bitcast.24671.15 = s32[1,1]{1,0} bitcast(%select.1350.8), metadata={scheduling_name="bitcast.24671.15"}
  %concatenate.716.5 = s32[1,5]{1,0} concatenate(%constant_5310_4, %bitcast.24671.15, %constant_5310_4, %constant_5310_4, %constant_5310_4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.5"}
  %bitcast.24699.3 = s32[5]{0} bitcast(%concatenate.716.5), metadata={scheduling_name="bitcast.24699.3"}
  %slice.2414.3 = s32[1]{0} slice(%bitcast.24699.3), slice={[1:2]}, metadata={scheduling_name="slice.2414.3"}
  %bitcast.25802.14 = s32[] bitcast(%slice.2414.3), metadata={scheduling_name="bitcast.25802.14"}
  ROOT %dynamic-slice.1457.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_0.2672, %constant_5288_44, %bitcast.25802.14, %constant_5288_44, %constant_5288_44, /*index=5*/%constant_5288_44), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1457.1"}
}

%fused_dynamic_update_slice.9 (param_0.2691: s32[9], param_1.2778: s32[]) -> s32[9] {
  %param_0.2691 = s32[9]{0} parameter(0), metadata={scheduling_name="param_0.2691"}
  %param_1.2778 = s32[] parameter(1), metadata={scheduling_name="param_1.2778"}
  %bitcast.24639.2 = s32[1]{0} bitcast(%param_1.2778), metadata={scheduling_name="bitcast.24639.2"}
  ROOT %dynamic-update-slice.429.1 = s32[9]{0} dynamic-update-slice(%param_0.2691, %bitcast.24639.2, %param_1.2778), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.429.1"}
}

%fused_dynamic_slice_reduce_select (param_0.6068: pred[1,4,8192,6144], param_1.6467: bf16[1,4,8192,6144], param_2.4737: bf16[1,4,8192,6144], param_3.3949: pred[], param_4.2897: bf16[1,4,4,8192,6144], param_5.2683: bf16[1,2,4,8192,6144], param_6.2504: s32[], param_7.2302: pred[]) -> (f32[4,8192], bf16[1,4,8192,6144], bf16[1,1,4,8192,6144]) {
  %param_0.6068 = pred[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6068"}
  %param_7.2302 = pred[] parameter(7), metadata={scheduling_name="param_7.2302"}
  %broadcast.5672.1.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%param_7.2302), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5672.1.clone.1"}
  %param_5.2683 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2683"}
  %constant_5288_41_clone_1 = s32[] constant(0)
  %param_6.2504 = s32[] parameter(6), metadata={scheduling_name="param_6.2504"}
  %compare.1694.2.clone.1 = pred[] compare(%param_6.2504, %constant_5288_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1694.2.clone.1"}
  %negate.227.2.clone.1 = s32[] negate(%param_6.2504), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.227.2.clone.1"}
  %select.1339.1.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.227.2.clone.1, %param_6.2504), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1339.1.clone.1"}
  %constant_5286_4_clone_1 = s32[] constant(1)
  %and.317.2.clone.1 = s32[] and(%select.1339.1.clone.1, %constant_5286_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.317.2.clone.1"}
  %negate.228.3.clone.1 = s32[] negate(%and.317.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.228.3.clone.1"}
  %select.1340.2.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.228.3.clone.1, %and.317.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1340.2.clone.1"}
  %compare.1695.2.clone.1 = pred[] compare(%select.1340.2.clone.1, %constant_5288_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1695.2.clone.1"}
  %compare.1696.2.clone.1 = pred[] compare(%select.1340.2.clone.1, %constant_5288_41_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1696.2.clone.1"}
  %and.318.1.clone.1 = pred[] and(%compare.1695.2.clone.1, %compare.1696.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.318.1.clone.1"}
  %constant_5292_3_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.2972.1.clone.1 = s32[] add(%select.1340.2.clone.1, %constant_5292_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2972.1.clone.1"}
  %select.1341.3.clone.1 = s32[] select(%and.318.1.clone.1, %add.2972.1.clone.1, %select.1340.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1341.3.clone.1"}
  %compare.1697.1.clone.1 = pred[] compare(%select.1341.3.clone.1, %constant_5288_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="compare.1697.1.clone.1"}
  %add.2973.1.clone.1 = s32[] add(%select.1341.3.clone.1, %constant_5292_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.2973.1.clone.1"}
  %select.1342.3.clone.1 = s32[] select(%compare.1697.1.clone.1, %add.2973.1.clone.1, %select.1341.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="select.1342.3.clone.1"}
  %dynamic-slice.1434.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_5.2683, %constant_5288_41_clone_1, %select.1342.3.clone.1, %constant_5288_41_clone_1, %constant_5288_41_clone_1, /*index=5*/%constant_5288_41_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="dynamic-slice.1434.1.clone.1"}
  %param_4.2897 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2897"}
  %constant_5289_1_clone_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %and.319.1.clone.1 = s32[] and(%select.1339.1.clone.1, %constant_5289_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.319.1.clone.1"}
  %negate.229.1.clone.1 = s32[] negate(%and.319.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.229.1.clone.1"}
  %select.1343.1.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.229.1.clone.1, %and.319.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1343.1.clone.1"}
  %compare.1698.1.clone.1 = pred[] compare(%select.1343.1.clone.1, %constant_5288_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1698.1.clone.1"}
  %compare.1699.1.clone.1 = pred[] compare(%select.1343.1.clone.1, %constant_5288_41_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1699.1.clone.1"}
  %and.320.1.clone.1 = pred[] and(%compare.1698.1.clone.1, %compare.1699.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.320.1.clone.1"}
  %constant_5290_2_clone_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.2974.1.clone.1 = s32[] add(%select.1343.1.clone.1, %constant_5290_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2974.1.clone.1"}
  %select.1344.1.clone.1 = s32[] select(%and.320.1.clone.1, %add.2974.1.clone.1, %select.1343.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1344.1.clone.1"}
  %compare.1700.1.clone.1 = pred[] compare(%select.1344.1.clone.1, %constant_5288_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="compare.1700.1.clone.1"}
  %add.2975.1.clone.1 = s32[] add(%select.1344.1.clone.1, %constant_5290_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.2975.1.clone.1"}
  %select.1345.1.clone.1 = s32[] select(%compare.1700.1.clone.1, %add.2975.1.clone.1, %select.1344.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="select.1345.1.clone.1"}
  %dynamic-slice.1435.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_4.2897, %constant_5288_41_clone_1, %select.1345.1.clone.1, %constant_5288_41_clone_1, %constant_5288_41_clone_1, /*index=5*/%constant_5288_41_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="dynamic-slice.1435.1.clone.1"}
  %select.1346.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5672.1.clone.1, %dynamic-slice.1434.1.clone.1, %dynamic-slice.1435.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1346.1.clone.1"}
  %bitcast.24594.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1346.1.clone.1), metadata={scheduling_name="bitcast.24594.1.clone.1"}
  %param_3.3949 = pred[] parameter(3), metadata={scheduling_name="param_3.3949"}
  %broadcast.5673.1.clone.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.3949), dimensions={}, metadata={scheduling_name="broadcast.5673.1.clone.1"}
  %param_1.6467 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6467"}
  %param_2.4737 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4737"}
  %select.1347.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5673.1.clone.1, %param_1.6467, %param_2.4737), metadata={scheduling_name="select.1347.1.clone.1"}
  %select.1348.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%param_0.6068, %bitcast.24594.1.clone.1, %select.1347.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1348.1.clone.1"}
  %convert.4195.6 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1348.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4195.6"}
  %multiply.2670.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4195.6, %convert.4195.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2670.3"}
  %bitcast.24616.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2670.3), metadata={scheduling_name="bitcast.24616.1"}
  %constant_5293_4 = f32[] constant(0)
  %reduce.427.1 = f32[4,8192]{1,0} reduce(%bitcast.24616.1, %constant_5293_4), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.427.1"}
  ROOT %tuple.550 = (f32[4,8192]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) tuple(%reduce.427.1, %select.1348.1.clone.1, %dynamic-slice.1434.1.clone.1), metadata={scheduling_name="tuple.550"}
}

%fused_dynamic_update_slice.10 (param_0.2701: bf16[1,4,4,8192,6144], param_1.3503: bf16[1,4,8192,6144], param_2.2740: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.2701 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2701"}
  %param_1.3503 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3503"}
  %bitcast.24452.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_1.3503), metadata={scheduling_name="bitcast.24452.1"}
  %constant_5288_39 = s32[] constant(0)
  %param_2.2740 = s32[] parameter(2), metadata={scheduling_name="param_2.2740"}
  %constant_5287_1 = s32[] constant(-2)
  %add.2969.1 = s32[] add(%param_2.2740, %constant_5287_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.2969.1"}
  %compare.1689.1 = pred[] compare(%add.2969.1, %constant_5288_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1689.1"}
  %negate.225.1 = s32[] negate(%add.2969.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.225.1"}
  %select.1335.1 = s32[] select(%compare.1689.1, %negate.225.1, %add.2969.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1335.1"}
  %constant_5289_2 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %and.315.1 = s32[] and(%select.1335.1, %constant_5289_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.315.1"}
  %negate.226.1 = s32[] negate(%and.315.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.226.1"}
  %select.1336.1 = s32[] select(%compare.1689.1, %negate.226.1, %and.315.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1336.1"}
  %compare.1690.1 = pred[] compare(%select.1336.1, %constant_5288_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1690.1"}
  %compare.1691.1 = pred[] compare(%select.1336.1, %constant_5288_39), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1691.1"}
  %and.316.1 = pred[] and(%compare.1690.1, %compare.1691.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.316.1"}
  %constant_5290_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.2970.1 = s32[] add(%select.1336.1, %constant_5290_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2970.1"}
  %select.1337.1 = s32[] select(%and.316.1, %add.2970.1, %select.1336.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1337.1"}
  %compare.1692.1 = pred[] compare(%select.1337.1, %constant_5288_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1692.1"}
  %add.2971.1 = s32[] add(%select.1337.1, %constant_5290_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.2971.1"}
  %select.1338.1 = s32[] select(%compare.1692.1, %add.2971.1, %select.1337.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1338.1"}
  ROOT %dynamic-update-slice.419.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2701, %bitcast.24452.1, %constant_5288_39, %select.1338.1, %constant_5288_39, /*index=5*/%constant_5288_39, %constant_5288_39), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-update-slice.419.1"}
}

%fused_convert (param_0.2713: bf16[65536,16384], param_1.2802: bf16[65536,16384]) -> bf16[1,1,32,2048,16384] {
  %param_0.2713 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.2713"}
  %bitcast.25774.5 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.2713), metadata={scheduling_name="bitcast.25774.5"}
  %convert.4309.5 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25774.5), metadata={scheduling_name="convert.4309.5"}
  %param_1.2802 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.2802"}
  %bitcast.25790.3 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.2802), metadata={scheduling_name="bitcast.25790.3"}
  %convert.4310.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25790.3), metadata={scheduling_name="convert.4310.3"}
  %multiply.2713.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4309.5, %convert.4310.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2713.3"}
  ROOT %convert.4312.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2713.3), metadata={scheduling_name="convert.4312.1"}
}

%fused_convert.1 (param_0.2719: bf16[65536,16384], param_1.2808: bf16[65536,16384]) -> bf16[1,1,32,2048,16384] {
  %param_0.2719 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.2719"}
  %bitcast.25230.5 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.2719), metadata={scheduling_name="bitcast.25230.5"}
  %convert.4253.5 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25230.5), metadata={scheduling_name="convert.4253.5"}
  %param_1.2808 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.2808"}
  %bitcast.25246.3 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.2808), metadata={scheduling_name="bitcast.25246.3"}
  %convert.4254.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25246.3), metadata={scheduling_name="convert.4254.3"}
  %multiply.2692.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4253.5, %convert.4254.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2692.3"}
  ROOT %convert.4255.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2692.3), metadata={scheduling_name="convert.4255.1"}
}

%fused_convert.2 (param_0.2823: bf16[32768,6144], param_1.2900: f32[1,4,8192], param_2.2537: bf16[1,2,6144], param_3.2296: s32[1], param_4.1927: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2823 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2823"}
  %bitcast.25472.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2823), metadata={scheduling_name="bitcast.25472.7"}
  %convert.4286.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25472.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4286.7"}
  %param_1.2900 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2900"}
  %bitcast.25495.3 = f32[4,8192]{1,0} bitcast(%param_1.2900), metadata={scheduling_name="bitcast.25495.3"}
  %broadcast.5715.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.25495.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5715.3"}
  %multiply.2707.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4286.7, %broadcast.5715.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2707.3"}
  %param_2.2537 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2537"}
  %constant_5288_6 = s32[] constant(0)
  %param_4.1927 = s32[] parameter(4), metadata={scheduling_name="param_4.1927"}
  %bitcast.24639.58 = s32[1]{0} bitcast(%param_4.1927), metadata={scheduling_name="bitcast.24639.58"}
  %param_3.2296 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2296"}
  %subtract.259.57 = s32[1]{0} subtract(%bitcast.24639.58, %param_3.2296), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.57"}
  %constant_5299_28 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.51 = s32[1]{0} maximum(%subtract.259.57, %constant_5299_28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.51"}
  %sign.28.46 = s32[1]{0} sign(%maximum.48.51), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.46"}
  %constant_5306_22 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.46 = pred[1]{0} compare(%sign.28.46, %constant_5306_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.46"}
  %constant_5307_24 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.51 = s32[1]{0} and(%maximum.48.51, %constant_5307_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.51"}
  %compare.1703.51 = pred[1]{0} compare(%and.321.51, %constant_5299_28), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.51"}
  %and.322.46 = pred[1]{0} and(%compare.1702.46, %compare.1703.51), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.46"}
  %constant_5308_22 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.46 = s32[1]{0} shift-right-logical(%maximum.48.51, %constant_5308_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.46"}
  %constant_5309_22 = s32[1]{0} constant({-1})
  %add.2977.46 = s32[1]{0} add(%shift-right-logical.21.46, %constant_5309_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.46"}
  %select.1349.46 = s32[1]{0} select(%and.322.46, %add.2977.46, %shift-right-logical.21.46), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.46"}
  %compare.1704.46 = pred[1]{0} compare(%select.1349.46, %constant_5299_28), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.46"}
  %add.2978.46 = s32[1]{0} add(%select.1349.46, %constant_5308_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.46"}
  %select.1350.46 = s32[1]{0} select(%compare.1704.46, %add.2978.46, %select.1349.46), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.46"}
  %bitcast.24671.53 = s32[1,1]{1,0} bitcast(%select.1350.46), metadata={scheduling_name="bitcast.24671.53"}
  %pad.356.15 = s32[1,2]{1,0} pad(%bitcast.24671.53, %constant_5288_6), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.15"}
  %pad.357.13 = s32[1,3]{1,0} pad(%pad.356.15, %constant_5288_6), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.13"}
  %bitcast.24677.11 = s32[3]{0} bitcast(%pad.357.13), metadata={scheduling_name="bitcast.24677.11"}
  %slice.2413.11 = s32[1]{0} slice(%bitcast.24677.11), slice={[1:2]}, metadata={scheduling_name="slice.2413.11"}
  %bitcast.25504.6 = s32[] bitcast(%slice.2413.11), metadata={scheduling_name="bitcast.25504.6"}
  %dynamic-slice.1453.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2537, %constant_5288_6, %bitcast.25504.6, %constant_5288_6), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1453.3"}
  %bitcast.25506.6 = bf16[6144]{0} bitcast(%dynamic-slice.1453.3), metadata={scheduling_name="bitcast.25506.6"}
  %convert.5007.3 = f32[6144]{0} convert(%bitcast.25506.6), metadata={scheduling_name="convert.5007.3"}
  %broadcast.6020.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5007.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6020.1"}
  %multiply.2708.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2707.3, %broadcast.6020.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2708.1"}
  ROOT %convert.4289.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2708.1), metadata={scheduling_name="convert.4289.1"}
}

%fused_convert.3 (param_0.2824: bf16[4,8192,6144], param_1.2901: f32[1,4,8192], param_2.2542: bf16[1,2,6144], param_3.2297: s32[1], param_4.1928: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2824 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2824"}
  %bitcast.25279.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2824), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/reduce_precision" source_file="/workspace/maxtext/MaxText/layers/mixtral.py" source_line=64 scheduling_name="bitcast.25279.7"}
  %convert.4256.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25279.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4256.7"}
  %param_1.2901 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2901"}
  %bitcast.25303.3 = f32[4,8192]{1,0} bitcast(%param_1.2901), metadata={scheduling_name="bitcast.25303.3"}
  %broadcast.5710.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.25303.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5710.3"}
  %multiply.2695.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4256.7, %broadcast.5710.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2695.3"}
  %param_2.2542 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2542"}
  %constant_5288_8 = s32[] constant(0)
  %param_4.1928 = s32[] parameter(4), metadata={scheduling_name="param_4.1928"}
  %bitcast.24639.60 = s32[1]{0} bitcast(%param_4.1928), metadata={scheduling_name="bitcast.24639.60"}
  %param_3.2297 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2297"}
  %subtract.259.59 = s32[1]{0} subtract(%bitcast.24639.60, %param_3.2297), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.59"}
  %constant_5299_29 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.53 = s32[1]{0} maximum(%subtract.259.59, %constant_5299_29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.53"}
  %sign.28.48 = s32[1]{0} sign(%maximum.48.53), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.48"}
  %constant_5306_23 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.48 = pred[1]{0} compare(%sign.28.48, %constant_5306_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.48"}
  %constant_5307_25 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.53 = s32[1]{0} and(%maximum.48.53, %constant_5307_25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.53"}
  %compare.1703.53 = pred[1]{0} compare(%and.321.53, %constant_5299_29), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.53"}
  %and.322.48 = pred[1]{0} and(%compare.1702.48, %compare.1703.53), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.48"}
  %constant_5308_23 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.48 = s32[1]{0} shift-right-logical(%maximum.48.53, %constant_5308_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.48"}
  %constant_5309_23 = s32[1]{0} constant({-1})
  %add.2977.48 = s32[1]{0} add(%shift-right-logical.21.48, %constant_5309_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.48"}
  %select.1349.48 = s32[1]{0} select(%and.322.48, %add.2977.48, %shift-right-logical.21.48), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.48"}
  %compare.1704.48 = pred[1]{0} compare(%select.1349.48, %constant_5299_29), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.48"}
  %add.2978.48 = s32[1]{0} add(%select.1349.48, %constant_5308_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.48"}
  %select.1350.48 = s32[1]{0} select(%compare.1704.48, %add.2978.48, %select.1349.48), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.48"}
  %bitcast.24671.55 = s32[1,1]{1,0} bitcast(%select.1350.48), metadata={scheduling_name="bitcast.24671.55"}
  %pad.356.17 = s32[1,2]{1,0} pad(%bitcast.24671.55, %constant_5288_8), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.17"}
  %pad.357.15 = s32[1,3]{1,0} pad(%pad.356.17, %constant_5288_8), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.15"}
  %bitcast.24677.13 = s32[3]{0} bitcast(%pad.357.15), metadata={scheduling_name="bitcast.24677.13"}
  %slice.2413.13 = s32[1]{0} slice(%bitcast.24677.13), slice={[1:2]}, metadata={scheduling_name="slice.2413.13"}
  %bitcast.25504.10 = s32[] bitcast(%slice.2413.13), metadata={scheduling_name="bitcast.25504.10"}
  %dynamic-slice.1448.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2542, %constant_5288_8, %bitcast.25504.10, %constant_5288_8), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1448.3"}
  %bitcast.25314.6 = bf16[6144]{0} bitcast(%dynamic-slice.1448.3), metadata={scheduling_name="bitcast.25314.6"}
  %convert.5006.3 = f32[6144]{0} convert(%bitcast.25314.6), metadata={scheduling_name="convert.5006.3"}
  %broadcast.6019.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5006.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6019.1"}
  %multiply.2696.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2695.3, %broadcast.6019.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2696.1"}
  ROOT %convert.4259.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2696.1), metadata={scheduling_name="convert.4259.1"}
}

%fused_convert.4 (param_0.2825: bf16[32768,6144], param_1.2902: f32[1,4,8192], param_2.2547: bf16[1,2,6144], param_3.2298: s32[1], param_4.1929: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2825 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2825"}
  %bitcast.24900.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2825), metadata={scheduling_name="bitcast.24900.7"}
  %convert.4228.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.24900.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4228.7"}
  %param_1.2902 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2902"}
  %bitcast.24923.3 = f32[4,8192]{1,0} bitcast(%param_1.2902), metadata={scheduling_name="bitcast.24923.3"}
  %broadcast.5688.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24923.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5688.3"}
  %multiply.2685.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4228.7, %broadcast.5688.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2685.3"}
  %param_2.2547 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2547"}
  %constant_5288_12 = s32[] constant(0)
  %param_4.1929 = s32[] parameter(4), metadata={scheduling_name="param_4.1929"}
  %bitcast.24639.62 = s32[1]{0} bitcast(%param_4.1929), metadata={scheduling_name="bitcast.24639.62"}
  %param_3.2298 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2298"}
  %subtract.259.61 = s32[1]{0} subtract(%bitcast.24639.62, %param_3.2298), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.61"}
  %constant_5299_30 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.55 = s32[1]{0} maximum(%subtract.259.61, %constant_5299_30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.55"}
  %sign.28.50 = s32[1]{0} sign(%maximum.48.55), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.50"}
  %constant_5306_24 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.50 = pred[1]{0} compare(%sign.28.50, %constant_5306_24), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.50"}
  %constant_5307_26 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.55 = s32[1]{0} and(%maximum.48.55, %constant_5307_26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.55"}
  %compare.1703.55 = pred[1]{0} compare(%and.321.55, %constant_5299_30), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.55"}
  %and.322.50 = pred[1]{0} and(%compare.1702.50, %compare.1703.55), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.50"}
  %constant_5308_24 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.50 = s32[1]{0} shift-right-logical(%maximum.48.55, %constant_5308_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.50"}
  %constant_5309_24 = s32[1]{0} constant({-1})
  %add.2977.50 = s32[1]{0} add(%shift-right-logical.21.50, %constant_5309_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.50"}
  %select.1349.50 = s32[1]{0} select(%and.322.50, %add.2977.50, %shift-right-logical.21.50), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.50"}
  %compare.1704.50 = pred[1]{0} compare(%select.1349.50, %constant_5299_30), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.50"}
  %add.2978.50 = s32[1]{0} add(%select.1349.50, %constant_5308_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.50"}
  %select.1350.50 = s32[1]{0} select(%compare.1704.50, %add.2978.50, %select.1349.50), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.50"}
  %bitcast.24671.57 = s32[1,1]{1,0} bitcast(%select.1350.50), metadata={scheduling_name="bitcast.24671.57"}
  %pad.356.19 = s32[1,2]{1,0} pad(%bitcast.24671.57, %constant_5288_12), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.19"}
  %pad.357.17 = s32[1,3]{1,0} pad(%pad.356.19, %constant_5288_12), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.17"}
  %bitcast.24677.15 = s32[3]{0} bitcast(%pad.357.17), metadata={scheduling_name="bitcast.24677.15"}
  %slice.2413.15 = s32[1]{0} slice(%bitcast.24677.15), slice={[1:2]}, metadata={scheduling_name="slice.2413.15"}
  %bitcast.25504.14 = s32[] bitcast(%slice.2413.15), metadata={scheduling_name="bitcast.25504.14"}
  %dynamic-slice.1442.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2547, %constant_5288_12, %bitcast.25504.14, %constant_5288_12), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1442.3"}
  %bitcast.24934.6 = bf16[6144]{0} bitcast(%dynamic-slice.1442.3), metadata={scheduling_name="bitcast.24934.6"}
  %convert.5002.3 = f32[6144]{0} convert(%bitcast.24934.6), metadata={scheduling_name="convert.5002.3"}
  %broadcast.6015.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5002.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6015.1"}
  %multiply.2686.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2685.3, %broadcast.6015.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2686.1"}
  ROOT %convert.4231.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2686.1), metadata={scheduling_name="convert.4231.1"}
}

%fused_convert.5 (param_0.2826: bf16[1,4,8192,6144], param_1.2903: f32[1,4,8192], param_2.2552: bf16[1,2,6144], param_3.2282: s32[1], param_4.1926: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2826 = bf16[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2826"}
  %convert.4195.4 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_0.2826), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4195.4"}
  %param_1.2903 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2903"}
  %bitcast.24629.3 = f32[4,8192]{1,0} bitcast(%param_1.2903), metadata={scheduling_name="bitcast.24629.3"}
  %broadcast.5676.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24629.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5676.3"}
  %multiply.2672.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4195.4, %broadcast.5676.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2672.3"}
  %param_2.2552 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2552"}
  %constant_5288_10 = s32[] constant(0)
  %param_4.1926 = s32[] parameter(4), metadata={scheduling_name="param_4.1926"}
  %bitcast.24639.64 = s32[1]{0} bitcast(%param_4.1926), metadata={scheduling_name="bitcast.24639.64"}
  %param_3.2282 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2282"}
  %subtract.259.63 = s32[1]{0} subtract(%bitcast.24639.64, %param_3.2282), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.63"}
  %constant_5299_4 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.57 = s32[1]{0} maximum(%subtract.259.63, %constant_5299_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.57"}
  %sign.28.52 = s32[1]{0} sign(%maximum.48.57), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.52"}
  %constant_5306_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.52 = pred[1]{0} compare(%sign.28.52, %constant_5306_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.52"}
  %constant_5307_3 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.57 = s32[1]{0} and(%maximum.48.57, %constant_5307_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.57"}
  %compare.1703.57 = pred[1]{0} compare(%and.321.57, %constant_5299_4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.57"}
  %and.322.52 = pred[1]{0} and(%compare.1702.52, %compare.1703.57), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.52"}
  %constant_5308_2 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.52 = s32[1]{0} shift-right-logical(%maximum.48.57, %constant_5308_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.52"}
  %constant_5309_4 = s32[1]{0} constant({-1})
  %add.2977.52 = s32[1]{0} add(%shift-right-logical.21.52, %constant_5309_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2977.52"}
  %select.1349.52 = s32[1]{0} select(%and.322.52, %add.2977.52, %shift-right-logical.21.52), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1349.52"}
  %compare.1704.52 = pred[1]{0} compare(%select.1349.52, %constant_5299_4), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.52"}
  %add.2978.52 = s32[1]{0} add(%select.1349.52, %constant_5308_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2978.52"}
  %select.1350.52 = s32[1]{0} select(%compare.1704.52, %add.2978.52, %select.1349.52), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1350.52"}
  %bitcast.24671.59 = s32[1,1]{1,0} bitcast(%select.1350.52), metadata={scheduling_name="bitcast.24671.59"}
  %pad.356.21 = s32[1,2]{1,0} pad(%bitcast.24671.59, %constant_5288_10), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.21"}
  %pad.357.19 = s32[1,3]{1,0} pad(%pad.356.21, %constant_5288_10), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.19"}
  %bitcast.24677.17 = s32[3]{0} bitcast(%pad.357.19), metadata={scheduling_name="bitcast.24677.17"}
  %slice.2413.17 = s32[1]{0} slice(%bitcast.24677.17), slice={[1:2]}, metadata={scheduling_name="slice.2413.17"}
  %bitcast.25504.18 = s32[] bitcast(%slice.2413.17), metadata={scheduling_name="bitcast.25504.18"}
  %dynamic-slice.1436.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2552, %constant_5288_10, %bitcast.25504.18, %constant_5288_10), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1436.3"}
  %bitcast.24683.6 = bf16[6144]{0} bitcast(%dynamic-slice.1436.3), metadata={scheduling_name="bitcast.24683.6"}
  %convert.4996.3 = f32[6144]{0} convert(%bitcast.24683.6), metadata={scheduling_name="convert.4996.3"}
  %broadcast.6010.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4996.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6010.1"}
  %multiply.2673.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2672.3, %broadcast.6010.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2673.1"}
  ROOT %convert.4198.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2673.1), metadata={scheduling_name="convert.4198.1"}
}

%fused_concatenate (param_0.2951: bf16[1,1,4,8192,64], param_1.3021: bf16[32768,6144], param_2.2259: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.3021 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.3021"}
  %bitcast.24713.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.3021), metadata={scheduling_name="bitcast.24713.18"}
  %slice.2415.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.24713.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2415.9"}
  %convert.4199.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2415.9), metadata={scheduling_name="convert.4199.14"}
  %param_2.2259 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2259"}
  %bitcast.24756.19 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2259), metadata={scheduling_name="bitcast.24756.19"}
  %convert.4997.15 = f32[4,8192,64]{2,1,0} convert(%bitcast.24756.19), metadata={scheduling_name="convert.4997.15"}
  %broadcast.6011.8 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4997.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6011.8"}
  %multiply.2674.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4199.14, %broadcast.6011.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2674.7"}
  %slice.2416.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.24713.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2416.9"}
  %convert.4204.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2416.9), metadata={scheduling_name="convert.4204.10"}
  %param_0.2951 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2951"}
  %bitcast.24769.19 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.2951), metadata={scheduling_name="bitcast.24769.19"}
  %convert.4998.15 = f32[4,8192,64]{2,1,0} convert(%bitcast.24769.19), metadata={scheduling_name="convert.4998.15"}
  %broadcast.6012.8 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4998.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6012.8"}
  %multiply.2675.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4204.10, %broadcast.6012.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2675.5"}
  %subtract.260.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2674.7, %multiply.2675.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.260.5"}
  %convert.4208.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.260.5), metadata={scheduling_name="convert.4208.3"}
  %multiply.2676.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4204.10, %broadcast.6011.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2676.5"}
  %multiply.2677.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4199.14, %broadcast.6012.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2677.7"}
  %add.2981.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2676.5, %multiply.2677.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2981.5"}
  %convert.4214.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2981.5), metadata={scheduling_name="convert.4214.3"}
  ROOT %concatenate.717.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4208.3, %convert.4214.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.717.1"}
}

%fused_concatenate.1 (param_0.2955: bf16[1,1,4,8192,64], param_1.3028: bf16[32768,6144], param_2.2266: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.3028 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.3028"}
  %bitcast.25337.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.3028), metadata={scheduling_name="bitcast.25337.18"}
  %slice.2429.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.25337.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2429.9"}
  %convert.4261.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2429.9), metadata={scheduling_name="convert.4261.14"}
  %param_2.2266 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2266"}
  %bitcast.24756.23 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2266), metadata={scheduling_name="bitcast.24756.23"}
  %convert.4997.19 = f32[4,8192,64]{2,1,0} convert(%bitcast.24756.23), metadata={scheduling_name="convert.4997.19"}
  %broadcast.6011.12 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4997.19), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6011.12"}
  %multiply.2697.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4261.14, %broadcast.6011.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2697.7"}
  %slice.2430.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.25337.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2430.9"}
  %convert.4263.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2430.9), metadata={scheduling_name="convert.4263.10"}
  %param_0.2955 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2955"}
  %bitcast.24769.23 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.2955), metadata={scheduling_name="bitcast.24769.23"}
  %convert.4998.19 = f32[4,8192,64]{2,1,0} convert(%bitcast.24769.23), metadata={scheduling_name="convert.4998.19"}
  %broadcast.6012.12 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4998.19), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6012.12"}
  %multiply.2698.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4263.10, %broadcast.6012.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2698.5"}
  %subtract.264.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2697.7, %multiply.2698.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.264.5"}
  %convert.4265.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.264.5), metadata={scheduling_name="convert.4265.3"}
  %multiply.2699.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4263.10, %broadcast.6011.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2699.5"}
  %multiply.2700.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4261.14, %broadcast.6012.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2700.7"}
  %add.2989.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2699.5, %multiply.2700.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2989.5"}
  %convert.4272.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2989.5), metadata={scheduling_name="convert.4272.3"}
  ROOT %concatenate.722.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4265.3, %convert.4272.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.722.1"}
}

%fused_concatenate.2 (param_0.3036: bf16[1,1,4,8192,64], param_1.3123: bf16[32768,1024], param_2.2337: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.3123 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.3123"}
  %bitcast.24810.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.3123), metadata={scheduling_name="bitcast.24810.14"}
  %slice.2417.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.24810.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2417.7"}
  %convert.4216.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2417.7), metadata={scheduling_name="convert.4216.10"}
  %param_2.2337 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2337"}
  %bitcast.24756.43 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2337), metadata={scheduling_name="bitcast.24756.43"}
  %convert.4997.37 = f32[4,8192,64]{2,1,0} convert(%bitcast.24756.43), metadata={scheduling_name="convert.4997.37"}
  %broadcast.6013.19 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4997.37), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6013.19"}
  %multiply.2678.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4216.10, %broadcast.6013.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2678.5"}
  %slice.2418.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.24810.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2418.7"}
  %convert.4218.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2418.7), metadata={scheduling_name="convert.4218.10"}
  %param_0.3036 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3036"}
  %bitcast.24769.51 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.3036), metadata={scheduling_name="bitcast.24769.51"}
  %convert.4998.45 = f32[4,8192,64]{2,1,0} convert(%bitcast.24769.51), metadata={scheduling_name="convert.4998.45"}
  %broadcast.6014.27 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4998.45), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6014.27"}
  %multiply.2679.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4218.10, %broadcast.6014.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2679.7"}
  %subtract.261.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2678.5, %multiply.2679.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.261.5"}
  %convert.4220.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.261.5), metadata={scheduling_name="convert.4220.3"}
  %multiply.2680.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4218.10, %broadcast.6013.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2680.5"}
  %multiply.2681.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4216.10, %broadcast.6014.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2681.7"}
  %add.2982.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2680.5, %multiply.2681.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2982.5"}
  %convert.4227.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2982.5), metadata={scheduling_name="convert.4227.3"}
  ROOT %concatenate.718.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4220.3, %convert.4227.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.718.1"}
}

%fused_concatenate.3 (param_0.3041: bf16[1,1,4,8192,64], param_1.3130: bf16[32768,1024], param_2.2344: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.3130 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.3130"}
  %bitcast.25389.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.3130), metadata={scheduling_name="bitcast.25389.14"}
  %slice.2431.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25389.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2431.7"}
  %convert.4273.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2431.7), metadata={scheduling_name="convert.4273.10"}
  %param_2.2344 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2344"}
  %bitcast.24756.47 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2344), metadata={scheduling_name="bitcast.24756.47"}
  %convert.4997.41 = f32[4,8192,64]{2,1,0} convert(%bitcast.24756.47), metadata={scheduling_name="convert.4997.41"}
  %broadcast.6013.23 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4997.41), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6013.23"}
  %multiply.2701.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4273.10, %broadcast.6013.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2701.5"}
  %slice.2432.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25389.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2432.7"}
  %convert.4276.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2432.7), metadata={scheduling_name="convert.4276.10"}
  %param_0.3041 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3041"}
  %bitcast.24769.55 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.3041), metadata={scheduling_name="bitcast.24769.55"}
  %convert.4998.49 = f32[4,8192,64]{2,1,0} convert(%bitcast.24769.55), metadata={scheduling_name="convert.4998.49"}
  %broadcast.6014.31 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4998.49), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6014.31"}
  %multiply.2702.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4276.10, %broadcast.6014.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2702.7"}
  %subtract.265.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2701.5, %multiply.2702.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.265.5"}
  %convert.4279.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.265.5), metadata={scheduling_name="convert.4279.3"}
  %multiply.2703.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4276.10, %broadcast.6013.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2703.5"}
  %multiply.2704.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4273.10, %broadcast.6014.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2704.7"}
  %add.2990.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2703.5, %multiply.2704.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2990.5"}
  %convert.4285.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2990.5), metadata={scheduling_name="convert.4285.3"}
  ROOT %concatenate.723.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4279.3, %convert.4285.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.723.1"}
}

%fused_convert.6 (param_0.3316: f32[1,1,1,1,64], param_1.3460: s32[4,4,8192], param_2.2803: s32[1], param_3.2299: s32[]) -> (bf16[1,1,4,8192,64], bf16[1,1,4,8192,64]) {
  %param_1.3460 = s32[4,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.3460"}
  %param_3.2299 = s32[] parameter(3), metadata={scheduling_name="param_3.2299"}
  %bitcast.24639.48 = s32[1]{0} bitcast(%param_3.2299), metadata={scheduling_name="bitcast.24639.48"}
  %param_2.2803 = s32[1]{0} parameter(2), metadata={scheduling_name="param_2.2803"}
  %subtract.259.47 = s32[1]{0} subtract(%bitcast.24639.48, %param_2.2803), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.47"}
  %constant_5299_3 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.41 = s32[1]{0} maximum(%subtract.259.47, %constant_5299_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.41"}
  %constant_5307_2 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.41 = s32[1]{0} and(%maximum.48.41, %constant_5307_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.41"}
  %compare.1705.5 = pred[1]{0} compare(%and.321.41, %constant_5299_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="compare.1705.5"}
  %compare.1703.41 = pred[1]{0} compare(%and.321.41, %constant_5299_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.41"}
  %and.323.5 = pred[1]{0} and(%compare.1705.5, %compare.1703.41), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="and.323.5"}
  %constant_5311_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %add.2979.5 = s32[1]{0} add(%and.321.41, %constant_5311_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="add.2979.5"}
  %select.1351.5 = s32[1]{0} select(%and.323.5, %add.2979.5, %and.321.41), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="select.1351.5"}
  %compare.1706.5 = pred[1]{0} compare(%select.1351.5, %constant_5299_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="compare.1706.5"}
  %add.2980.5 = s32[1]{0} add(%select.1351.5, %constant_5311_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="add.2980.5"}
  %select.1352.5 = s32[1]{0} select(%compare.1706.5, %add.2980.5, %select.1351.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="select.1352.5"}
  %bitcast.24740.7 = s32[] bitcast(%select.1352.5), metadata={scheduling_name="bitcast.24740.7"}
  %constant_5288_50 = s32[] constant(0)
  %dynamic-slice.1438.7 = s32[1,4,8192]{2,1,0} dynamic-slice(%param_1.3460, %bitcast.24740.7, %constant_5288_50, %constant_5288_50), dynamic_slice_sizes={1,4,8192}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/squeeze" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="dynamic-slice.1438.7"}
  %convert.4200.5 = f32[1,4,8192]{2,1,0} convert(%dynamic-slice.1438.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="convert.4200.5"}
  %bitcast.24745.3 = f32[4,8192]{1,0} bitcast(%convert.4200.5), metadata={scheduling_name="bitcast.24745.3"}
  %broadcast.5678.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.24745.3), dimensions={2,3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5678.3"}
  %param_0.3316 = f32[1,1,1,1,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3316"}
  %bitcast.24750.3 = f32[64]{0} bitcast(%param_0.3316), metadata={scheduling_name="bitcast.24750.3"}
  %broadcast.5679.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.24750.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5679.3"}
  %divide.472.4 = f32[1,1,4,8192,64]{4,3,2,1,0} divide(%broadcast.5678.3, %broadcast.5679.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="divide.472.4"}
  %cosine.71.3 = f32[1,1,4,8192,64]{4,3,2,1,0} cosine(%divide.472.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/cos" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="cosine.71.3"}
  %convert.4201.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%cosine.71.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="convert.4201.1"}
  %sine.68.3.clone.1 = f32[1,1,4,8192,64]{4,3,2,1,0} sine(%divide.472.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sin" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="sine.68.3.clone.1"}
  %convert.4205.1.clone.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%sine.68.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="convert.4205.1.clone.1"}
  ROOT %tuple.551 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) tuple(%convert.4201.1, %convert.4205.1.clone.1), metadata={scheduling_name="tuple.551"}
}

%fused_compare.2 (param_0.3088: s32[1,1,1,1,8], param_1.3180: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_1.3180 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.3180"}
  %bitcast.25623.3 = s32[4,8192,2]{2,1,0} bitcast(%param_1.3180), metadata={scheduling_name="bitcast.25623.3"}
  %broadcast.5723.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25623.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5723.3"}
  %param_0.3088 = s32[1,1,1,1,8]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3088"}
  %bitcast.25079.3 = s32[8]{0} bitcast(%param_0.3088), metadata={scheduling_name="bitcast.25079.3"}
  %broadcast.5698.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25079.3), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5698.3"}
  ROOT %compare.1715.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5723.3, %broadcast.5698.3), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1715.1"}
}

%fused_compare.3 (param_0.3083: s32[1,1,1,1,8], param_1.3172: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_1.3172 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.3172"}
  %bitcast.25074.3 = s32[4,8192,2]{2,1,0} bitcast(%param_1.3172), metadata={scheduling_name="bitcast.25074.3"}
  %broadcast.5697.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25074.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5697.3"}
  %param_0.3083 = s32[1,1,1,1,8]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3083"}
  %bitcast.25079.5 = s32[8]{0} bitcast(%param_0.3083), metadata={scheduling_name="bitcast.25079.5"}
  %broadcast.5698.5 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25079.5), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5698.5"}
  ROOT %compare.1709.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5697.3, %broadcast.5698.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1709.1"}
}

%fused_slice (param_0.3345: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.3345 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3345"}
  %convert.4240.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3345), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4240.9"}
  %bitcast.25084.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4240.9), metadata={scheduling_name="bitcast.25084.3"}
  %constant_5288_42 = s32[] constant(0)
  %reduce-window.168.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25084.3, %constant_5288_42), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.168.3"}
  ROOT %slice.2422.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.168.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2422.1"}
}

%fused_slice.1 (param_0.3346: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.3346 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3346"}
  %convert.4297.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3346), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4297.9"}
  %bitcast.25630.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4297.9), metadata={scheduling_name="bitcast.25630.3"}
  %constant_5288_46 = s32[] constant(0)
  %reduce-window.172.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25630.3, %constant_5288_46), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.172.3"}
  ROOT %slice.2435.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.172.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2435.1"}
}

%fused_rsqrt (param_0.3355: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3355 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3355"}
  %bitcast.25484.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3355), metadata={scheduling_name="bitcast.25484.3"}
  %constant_5294_1 = f32[] constant(0.000162760422)
  %broadcast.5674.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_5294_1), dimensions={}, metadata={scheduling_name="broadcast.5674.6"}
  %multiply.2706.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.25484.3, %broadcast.5674.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2706.3"}
  %constant_5295_1 = f32[] constant(1e-05)
  %broadcast.5675.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_5295_1), dimensions={}, metadata={scheduling_name="broadcast.5675.6"}
  %add.2991.3 = f32[1,4,8192]{2,1,0} add(%multiply.2706.3, %broadcast.5675.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2991.3"}
  ROOT %rsqrt.102.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.2991.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.102.1"}
}

%fused_rsqrt.1 (param_0.3358: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3358 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3358"}
  %bitcast.25292.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3358), metadata={scheduling_name="bitcast.25292.3"}
  %constant_5294_4 = f32[] constant(0.000162760422)
  %broadcast.5674.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_5294_4), dimensions={}, metadata={scheduling_name="broadcast.5674.8"}
  %multiply.2694.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.25292.3, %broadcast.5674.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2694.3"}
  %constant_5295_4 = f32[] constant(1e-05)
  %broadcast.5675.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_5295_4), dimensions={}, metadata={scheduling_name="broadcast.5675.8"}
  %add.2988.3 = f32[1,4,8192]{2,1,0} add(%multiply.2694.3, %broadcast.5675.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2988.3"}
  ROOT %rsqrt.101.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.2988.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.101.1"}
}

%fused_rsqrt.2 (param_0.3357: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3357 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3357"}
  %bitcast.24912.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3357), metadata={scheduling_name="bitcast.24912.3"}
  %constant_5294_3 = f32[] constant(0.000162760422)
  %broadcast.5674.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_5294_3), dimensions={}, metadata={scheduling_name="broadcast.5674.10"}
  %multiply.2684.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.24912.3, %broadcast.5674.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2684.3"}
  %constant_5295_3 = f32[] constant(1e-05)
  %broadcast.5675.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_5295_3), dimensions={}, metadata={scheduling_name="broadcast.5675.10"}
  %add.2983.3 = f32[1,4,8192]{2,1,0} add(%multiply.2684.3, %broadcast.5675.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2983.3"}
  ROOT %rsqrt.100.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.2983.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.100.1"}
}

%fused_rsqrt.3 (param_0.3356: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3356 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3356"}
  %bitcast.24620.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3356), metadata={scheduling_name="bitcast.24620.3"}
  %constant_5294_2 = f32[] constant(0.000162760422)
  %broadcast.5674.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_5294_2), dimensions={}, metadata={scheduling_name="broadcast.5674.12"}
  %multiply.2671.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.24620.3, %broadcast.5674.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2671.3"}
  %constant_5295_2 = f32[] constant(1e-05)
  %broadcast.5675.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_5295_2), dimensions={}, metadata={scheduling_name="broadcast.5675.12"}
  %add.2976.3 = f32[1,4,8192]{2,1,0} add(%multiply.2671.3, %broadcast.5675.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2976.3"}
  ROOT %rsqrt.99.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.2976.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.99.1"}
}

%fused_convert.7 (param_0.3250: f32[32768,8]) -> f32[32768,2] {
  %param_0.3250 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.3250"}
  %convert.4234.3 = bf16[32768,8]{1,0} convert(%param_0.3250), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.4234.3"}
  %slice.2420.3 = bf16[32768,2]{1,0} slice(%convert.4234.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2420.3"}
  ROOT %convert.4235.1 = f32[32768,2]{1,0} convert(%slice.2420.3), metadata={scheduling_name="convert.4235.1"}
}

%fused_convert.8 (param_0.3254: f32[32768,8]) -> f32[32768,2] {
  %param_0.3254 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.3254"}
  %convert.4291.3 = bf16[32768,8]{1,0} convert(%param_0.3254), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.4291.3"}
  %slice.2433.3 = bf16[32768,2]{1,0} slice(%convert.4291.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2433.3"}
  ROOT %convert.4292.1 = f32[32768,2]{1,0} convert(%slice.2433.3), metadata={scheduling_name="convert.4292.1"}
}

%fused_multiply () -> s32[33] {
  %iota.388.1 = s32[33]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="iota.388.1"}
  %constant_5314_1 = s32[] constant(8192), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %broadcast.5685.1 = s32[33]{0} broadcast(%constant_5314_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5685.1"}
  ROOT %multiply.2682.1 = s32[33]{0} multiply(%iota.388.1, %broadcast.5685.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="multiply.2682.1"}
}

%fused_add (param_0.3333: s32[]) -> s32[] {
  %param_0.3333 = s32[] parameter(0), metadata={scheduling_name="param_0.3333"}
  %constant_5286_2 = s32[] constant(1)
  ROOT %add.2968.1 = s32[] add(%param_0.3333, %constant_5286_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="add.2968.1"}
}

%fused_broadcast () -> bf16[1,4,8192,8] {
  %constant_5291_2 = bf16[] constant(0)
  ROOT %broadcast.5670.1 = bf16[1,4,8192,8]{3,2,1,0} broadcast(%constant_5291_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5670.1"}
}

%fused_broadcast.1 () -> u32[1,4,8192,8] {
  %constant_5297_1 = u32[] constant(0)
  ROOT %broadcast.5693.1 = u32[1,4,8192,8]{3,2,1,0} broadcast(%constant_5297_1), dimensions={}, metadata={scheduling_name="broadcast.5693.1"}
}

%fused_broadcast.2 () -> u32[2] {
  %constant_5297_2 = u32[] constant(0)
  ROOT %broadcast.5684.1 = u32[2]{0} broadcast(%constant_5297_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5684.1"}
}

%fused_compare.4 (param_0_0: s32[]) -> (pred[], pred[]) {
  %param_0_0 = s32[] parameter(0), metadata={scheduling_name="param_0_0"}
  %constant_5288_54 = s32[] constant(0)
  %compare.1701.2 = pred[] compare(%param_0_0, %constant_5288_54), direction=EQ, metadata={scheduling_name="compare.1701.2"}
  %constant_5290_4 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %compare.1693.2 = pred[] compare(%param_0_0, %constant_5290_4), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="compare.1693.2"}
  ROOT %tuple.648 = (pred[], pred[]) tuple(%compare.1701.2, %compare.1693.2), metadata={scheduling_name="tuple.648"}
}

%async_computation (param_0.6078: bf16[1,4,8,1,2048,6144]) -> bf16[1,4,8,1,2048,6144] {
  %param_0.6078 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6078"}
  ROOT %all-to-all.40.1 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6078), channel_id=59, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.40.1"}
}

%async_computation.1 (param_0.6079: bf16[1,1,8,4,2048,6144]) -> bf16[1,1,8,4,2048,6144] {
  %param_0.6079 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6079"}
  ROOT %all-to-all.41.1 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6079), channel_id=66, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.41.1"}
}

%async_computation.2 (param_0.6080: bf16[1,4,8,1,2048,6144]) -> bf16[1,4,8,1,2048,6144] {
  %param_0.6080 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6080"}
  ROOT %all-to-all.42.1 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6080), channel_id=118, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.42.1"}
}

%async_computation.3 (param_0.6081: bf16[1,1,8,4,2048,6144]) -> bf16[1,1,8,4,2048,6144] {
  %param_0.6081 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6081"}
  ROOT %all-to-all.43.1 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6081), channel_id=125, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.43.1"}
}

%wrapped_convert_computation (param_0.6103: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6103 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6103"}
  ROOT %convert.4232.1 = f32[32768,8]{1,0} convert(%param_0.6103), metadata={scheduling_name="convert.4232.1"}
}

%wrapped_iota_computation.3 () -> s32[32768,8] {
  ROOT %iota.389.1 = s32[32768,8]{1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="iota.389.1"}
}

%wrapped_slice_computation (param_0.6104: s32[32768,8]) -> s32[32768,2] {
  %param_0.6104 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6104"}
  ROOT %slice.2421.1 = s32[32768,2]{1,0} slice(%param_0.6104), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2421.1"}
}

%wrapped_iota_computation.4 () -> s32[32768,2] {
  ROOT %iota.390.1 = s32[32768,2]{1,0} iota(), iota_dimension=1, metadata={scheduling_name="iota.390.1"}
}

%wrapped_convert_computation.1 (param_0.6105: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6105 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6105"}
  ROOT %convert.4290.1 = f32[32768,8]{1,0} convert(%param_0.6105), metadata={scheduling_name="convert.4290.1"}
}

%wrapped_slice_computation.1 (param_0.6106: s32[32768,8]) -> s32[32768,2] {
  %param_0.6106 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6106"}
  ROOT %slice.2434.1 = s32[32768,2]{1,0} slice(%param_0.6106), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2434.1"}
}

%region_0.1585.sunk.clone.sunk.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone (param.217: (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144])) -> (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144]) {
  %param.217 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) parameter(0), metadata={scheduling_name="param.217"}
  %constant_5298_0 = f32[0]{0} constant({})
  %constant_5296_0 = bf16[0]{0} constant({})
  %constant_5301_0 = u32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %get-tuple-element.4445 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=3, metadata={scheduling_name="get-tuple-element.4445"}
  %collective-permute-start.2 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4445), channel_id=126, source_target_pairs={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.2 = u32[2]{0} fusion(), kind=kLoop, calls=%fused_broadcast.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="loop_broadcast_fusion.2"}
  %loop_multiply_fusion = s32[33]{0} fusion(), kind=kLoop, calls=%fused_multiply, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 deduplicated_name="loop_multiply_fusion.5" scheduling_name="loop_multiply_fusion"}
  %get-tuple-element.4442 = s32[] get-tuple-element(%param.217), index=0, metadata={scheduling_name="get-tuple-element.4442"}
  %copy.750 = s32[] copy(%get-tuple-element.4442), metadata={scheduling_name="copy.750"}
  %loop_compare_fusion.4 = (pred[], pred[]) fusion(%copy.750), kind=kLoop, calls=%fused_compare.4, metadata={scheduling_name="loop_compare_fusion.4"}
  %get-tuple-element.4504 = s32[1]{0} get-tuple-element(%param.217), index=18, metadata={scheduling_name="get-tuple-element.4504"}
  %get-tuple-element.4525 = bf16[1,2,768,8]{3,2,1,0} get-tuple-element(%param.217), index=39, metadata={scheduling_name="get-tuple-element.4525"}
  %loop_dynamic_slice_fusion.2 = bf16[1,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4525, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.2, metadata={deduplicated_name="loop_dynamic_slice_fusion.1" scheduling_name="loop_dynamic_slice_fusion.2"}
  %get-tuple-element.4512 = bf16[1,2,768,8]{3,2,1,0} get-tuple-element(%param.217), index=26, metadata={scheduling_name="get-tuple-element.4512"}
  %loop_dynamic_slice_fusion.1 = bf16[1,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4512, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.1, metadata={deduplicated_name="loop_dynamic_slice_fusion.1" scheduling_name="loop_dynamic_slice_fusion.1"}
  %get-tuple-element.4522 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=36, metadata={scheduling_name="get-tuple-element.4522"}
  %loop_dynamic_slice_fusion.12 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4522, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.12, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.12"}
  %get-tuple-element.4521 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=35, metadata={scheduling_name="get-tuple-element.4521"}
  %loop_dynamic_slice_fusion.11 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4521, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.11, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.11"}
  %get-tuple-element.4509 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=23, metadata={scheduling_name="get-tuple-element.4509"}
  %loop_dynamic_slice_fusion.6 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4509, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.6, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.6"}
  %get-tuple-element.4508 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=22, metadata={scheduling_name="get-tuple-element.4508"}
  %loop_dynamic_slice_fusion.5 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4508, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.5, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.5"}
  %get-tuple-element.4523 = bf16[1,2,48,128,768]{3,2,4,1,0} get-tuple-element(%param.217), index=37, metadata={scheduling_name="get-tuple-element.4523"}
  %loop_dynamic_slice_fusion = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4523, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice, metadata={deduplicated_name="loop_dynamic_slice_fusion" scheduling_name="loop_dynamic_slice_fusion"}
  %get-tuple-element.4520 = bf16[1,2,768,48,128]{4,3,2,1,0} get-tuple-element(%param.217), index=34, metadata={scheduling_name="get-tuple-element.4520"}
  %loop_dynamic_slice_fusion.10 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4520, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.10, metadata={deduplicated_name="loop_dynamic_slice_fusion.4" scheduling_name="loop_dynamic_slice_fusion.10"}
  %get-tuple-element.4510 = bf16[1,2,48,128,768]{3,2,4,1,0} get-tuple-element(%param.217), index=24, metadata={scheduling_name="get-tuple-element.4510"}
  %loop_dynamic_slice_fusion.3 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4510, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.3, metadata={deduplicated_name="loop_dynamic_slice_fusion" scheduling_name="loop_dynamic_slice_fusion.3"}
  %get-tuple-element.4505 = bf16[1,2,768,48,128]{4,3,2,1,0} get-tuple-element(%param.217), index=19, metadata={scheduling_name="get-tuple-element.4505"}
  %loop_dynamic_slice_fusion.4 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4505, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.4, metadata={deduplicated_name="loop_dynamic_slice_fusion.4" scheduling_name="loop_dynamic_slice_fusion.4"}
  %collective-permute-done.2 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-done.2"}
  %bitcast.25522.0 = bf16[1,768,8]{2,0,1} bitcast(%loop_dynamic_slice_fusion.2), metadata={scheduling_name="bitcast.25522.0"}
  %bitcast.24958.0 = bf16[1,768,8]{2,0,1} bitcast(%loop_dynamic_slice_fusion.1), metadata={scheduling_name="bitcast.24958.0"}
  %bitcast.25434.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.12), metadata={scheduling_name="bitcast.25434.0"}
  %bitcast.25382.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.11), metadata={scheduling_name="bitcast.25382.0"}
  %bitcast.24857.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.6), metadata={scheduling_name="bitcast.24857.0"}
  %bitcast.24803.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.5), metadata={scheduling_name="bitcast.24803.0"}
  %bitcast.32019 = bf16[1,768,128,48]{2,3,0,1} bitcast(%loop_dynamic_slice_fusion), metadata={scheduling_name="bitcast.32019"}
  %bitcast.25330.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.10), metadata={scheduling_name="bitcast.25330.0"}
  %bitcast.32018 = bf16[1,768,128,48]{2,3,0,1} bitcast(%loop_dynamic_slice_fusion.3), metadata={scheduling_name="bitcast.32018"}
  %bitcast.24706.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.4), metadata={scheduling_name="bitcast.24706.0"}
  %all-gather-start = ((bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, /*index=5*/bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}), (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1})) all-gather-start(%bitcast.24706.0, %bitcast.24803.0, %bitcast.24857.0, %bitcast.32018, %bitcast.24958.0, /*index=5*/%bitcast.25330.0, %bitcast.25382.0, %bitcast.25434.0, %bitcast.32019, %bitcast.25522.0), channel_id=8, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={1}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_iota.4 = s32[32768,2]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.4, metadata={scheduling_name="wrapped_iota.4"}
  %loop_broadcast_fusion = bf16[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_broadcast_fusion.3" scheduling_name="loop_broadcast_fusion"}
  %get-tuple-element.4443 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=1, metadata={scheduling_name="get-tuple-element.4443"}
  %get-tuple-element.4446 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=4, metadata={scheduling_name="get-tuple-element.4446"}
  %get-tuple-element.4502 = pred[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=16, metadata={scheduling_name="get-tuple-element.4502"}
  %get-tuple-element.4257 = pred[] get-tuple-element(%loop_compare_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.4257"}
  %get-tuple-element.4256 = pred[] get-tuple-element(%loop_compare_fusion.4), index=0, metadata={scheduling_name="get-tuple-element.4256"}
  %input_dynamic_slice_reduce_select_fusion = (f32[4,8192]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) fusion(%get-tuple-element.4502, %get-tuple-element.4445, %collective-permute-done.2, %get-tuple-element.4256, %get-tuple-element.4443, /*index=5*/%get-tuple-element.4446, %copy.750, %get-tuple-element.4257), kind=kInput, calls=%fused_dynamic_slice_reduce_select, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_dynamic_slice_reduce_select_fusion"}
  %get-tuple-element.4506 = s32[4,4,8192]{2,1,0} get-tuple-element(%param.217), index=20, metadata={scheduling_name="get-tuple-element.4506"}
  %get-tuple-element.4507 = f32[1,1,1,1,64]{4,3,2,1,0} get-tuple-element(%param.217), index=21, metadata={scheduling_name="get-tuple-element.4507"}
  %loop_convert_fusion.6 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) fusion(%get-tuple-element.4507, %get-tuple-element.4506, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_convert.6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="loop_convert_fusion.6"}
  %get-tuple-element.4094 = f32[4,8192]{1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4094"}
  %loop_rsqrt_fusion.3 = f32[1,4,8192]{2,1,0} fusion(%get-tuple-element.4094), kind=kLoop, calls=%fused_rsqrt.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.3"}
  %get-tuple-element.4503 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=17, metadata={scheduling_name="get-tuple-element.4503"}
  %get-tuple-element.4120 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4120"}
  %loop_convert_fusion.5 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.4120, %loop_rsqrt_fusion.3, %get-tuple-element.4503, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_convert.5, metadata={scheduling_name="loop_convert_fusion.5"}
  %all-gather-done = (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}) all-gather-done(%all-gather-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-done"}
  %get-tuple-element.4273 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4273"}
  %bitcast.24861.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4273), metadata={scheduling_name="bitcast.24861.0"}
  %bitcast.24848.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.5), metadata={scheduling_name="bitcast.24848.0"}
  %custom-call.1168 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24848.0, %bitcast.24861.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1168"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4271 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4271"}
  %bitcast.24710.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4271), metadata={scheduling_name="bitcast.24710.0"}
  %custom-call.1166 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24848.0, %bitcast.24710.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1166"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4272 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4272"}
  %bitcast.24807.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4272), metadata={scheduling_name="bitcast.24807.0"}
  %custom-call.1167 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24848.0, %bitcast.24807.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1167"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4123 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.4123"}
  %get-tuple-element.4122 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.4122"}
  %get-tuple-element.3810.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1166), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3810.0"}
  %input_concatenate_fusion = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3810.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion"}
  %get-tuple-element.3811.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1167), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3811.0"}
  %input_concatenate_fusion.2 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3811.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.2"}
  %get-tuple-element.3812.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1168), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3812.0"}
  %bitcast.24865.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3812.0), metadata={scheduling_name="bitcast.24865.0"}
  %custom-call.1006 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, u8[1]{0}) custom-call(%input_concatenate_fusion, %input_concatenate_fusion.2, %bitcast.24865.0, %constant_5296_0, %loop_broadcast_fusion.2, /*index=5*/%loop_multiply_fusion, %loop_multiply_fusion, %constant_5298_0, %constant_5298_0, %constant_5298_0, /*index=10*/%constant_5298_0, %constant_5298_0, %constant_5298_0), custom_call_target="te_fused_attn_forward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u32[2]{0}, s32[33]{0}, s32[33]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.1006"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.24897.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.4120), metadata={scheduling_name="bitcast.24897.0"}
  %copy.679 = bf16[32768,6144]{1,0} copy(%bitcast.24897.0), metadata={scheduling_name="copy.679"}
  %get-tuple-element.4274 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done), index=3, metadata={scheduling_name="get-tuple-element.4274"}
  %bitcast.24893.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4274), metadata={scheduling_name="bitcast.24893.0"}
  %get-tuple-element.3468.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.1006), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3468.0"}
  %bitcast.24878.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3468.0), metadata={scheduling_name="bitcast.24878.0"}
  %cublas-lt-matmul.36 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24878.0, %bitcast.24893.0, %copy.679), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.36"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %wrapped_iota.3 = s32[32768,8]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_iota.3"}
  %get-tuple-element.3813.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.36), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3813.0"}
  %input_reduce_fusion.4 = f32[4,8192]{1,0} fusion(%get-tuple-element.3813.0), kind=kInput, calls=%fused_reduce.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.4"}
  %loop_rsqrt_fusion.2 = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.4), kind=kLoop, calls=%fused_rsqrt.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.2"}
  %get-tuple-element.4511 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=25, metadata={scheduling_name="get-tuple-element.4511"}
  %loop_convert_fusion.4 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3813.0, %loop_rsqrt_fusion.2, %get-tuple-element.4511, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_convert.4, metadata={deduplicated_name="loop_convert_fusion.2" scheduling_name="loop_convert_fusion.4"}
  %get-tuple-element.4275 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done), index=4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4275"}
  %bitcast.24962.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4275), metadata={scheduling_name="bitcast.24962.0"}
  %bitcast.24941.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.4), metadata={scheduling_name="bitcast.24941.0"}
  %custom-call.1169 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24941.0, %bitcast.24962.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1169"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_broadcast_fusion.1 = u32[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.1, metadata={deduplicated_name="loop_broadcast_fusion.4" scheduling_name="loop_broadcast_fusion.1"}
  %partition-id.13.0 = u32[] partition-id(), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="partition-id.13.0"}
  %get-tuple-element.3814.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1169), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3814.0"}
  %wrapped_convert = f32[32768,8]{1,0} fusion(%get-tuple-element.3814.0), kind=kLoop, calls=%wrapped_convert_computation, metadata={scheduling_name="wrapped_convert"}
  %sort.44.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert, %wrapped_iota.3), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.44.0"}
  %copy.681 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion), metadata={scheduling_name="copy.681"}
  %get-tuple-element.3504.0 = s32[32768,8]{1,0} get-tuple-element(%sort.44.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3504.0"}
  %wrapped_slice = s32[32768,2]{1,0} fusion(%get-tuple-element.3504.0), kind=kLoop, calls=%wrapped_slice_computation, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice"}
  %get-tuple-element.3845.0 = f32[32768,8]{1,0} get-tuple-element(%sort.44.0), index=0, metadata={scheduling_name="get-tuple-element.3845.0"}
  %loop_convert_fusion.7 = f32[32768,2]{1,0} fusion(%get-tuple-element.3845.0), kind=kLoop, calls=%fused_convert.7, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.7"}
  %sort.46.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.7, %wrapped_slice, %wrapped_iota.4), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.46.0"}
  %copy.680 = u32[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.1), metadata={scheduling_name="copy.680"}
  %get-tuple-element.4514 = s32[1,1,1,1,8]{4,3,2,1,0} get-tuple-element(%param.217), index=28, metadata={scheduling_name="get-tuple-element.4514"}
  %get-tuple-element.3508.0 = s32[32768,2]{1,0} get-tuple-element(%sort.46.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3508.0"}
  %loop_compare_fusion.3 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.4514, %get-tuple-element.3508.0), kind=kLoop, calls=%fused_compare.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.2" scheduling_name="loop_compare_fusion.3"}
  %loop_slice_fusion = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.3), kind=kLoop, calls=%fused_slice, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion"}
  %loop_reduce_window_fusion.3 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion), kind=kLoop, calls=%fused_reduce_window.3, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.3"}
  %loop_reduce_window_fusion.2 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.3), kind=kLoop, calls=%fused_reduce_window.2, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.2"}
  %input_reduce_fusion.3 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.3, %loop_reduce_window_fusion.3, %loop_reduce_window_fusion.2), kind=kInput, calls=%fused_reduce.3, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.3"}
  %get-tuple-element.4500 = s32[1,4,8192,2,1]{3,2,1,4,0} get-tuple-element(%param.217), index=14, metadata={scheduling_name="get-tuple-element.4500"}
  %get-tuple-element.4501 = s32[1,4,8192,2,1]{3,2,1,4,0} get-tuple-element(%param.217), index=15, metadata={scheduling_name="get-tuple-element.4501"}
  %loop_transpose_fusion.5 = s32[65536,4]{1,0} fusion(%get-tuple-element.4501, %get-tuple-element.4500, %get-tuple-element.3508.0, %constant_5301_0, %partition-id.13.0), kind=kLoop, calls=%fused_transpose.5, metadata={deduplicated_name="loop_transpose_fusion.2" scheduling_name="loop_transpose_fusion.5"}
  %get-tuple-element.4513 = u32[1,4,8192,2]{3,2,1,0} get-tuple-element(%param.217), index=27, metadata={scheduling_name="get-tuple-element.4513"}
  %input_scatter_fusion.2 = u32[1,4,8192,8]{3,2,1,0} fusion(%copy.680, %loop_transpose_fusion.5, %get-tuple-element.4513), kind=kInput, calls=%fused_scatter.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.2" scheduling_name="input_scatter_fusion.2"}
  %get-tuple-element.3847.0 = f32[32768,2]{1,0} get-tuple-element(%sort.46.0), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3847.0"}
  %input_scatter_fusion.1 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.681, %loop_transpose_fusion.5, %get-tuple-element.4513, %input_scatter_fusion.2, %get-tuple-element.4501, /*index=5*/%get-tuple-element.4500, %get-tuple-element.3508.0, %get-tuple-element.3847.0, %constant_5301_0, %partition-id.13.0), kind=kInput, calls=%fused_scatter.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion" scheduling_name="input_scatter_fusion.1"}
  %get-tuple-element.4093 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.3), index=1, metadata={scheduling_name="get-tuple-element.4093"}
  %get-tuple-element.4092 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.3), index=0, metadata={scheduling_name="get-tuple-element.4092"}
  %input_multiply_transpose_fusion.1 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.4093, %get-tuple-element.4092, %input_scatter_fusion.1), kind=kInput, calls=%fused_multiply_transpose.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.1"}
  %get-tuple-element.4515 = s32[1,1,1,1,2049]{4,3,2,1,0} get-tuple-element(%param.217), index=29, metadata={scheduling_name="get-tuple-element.4515"}
  %get-tuple-element.4036 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4036"}
  %get-tuple-element.4035 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4035"}
  %input_convert_transpose_fusion.1 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.4515, %get-tuple-element.4035, %get-tuple-element.4036), kind=kInput, calls=%fused_convert_transpose.1, metadata={deduplicated_name="input_convert_transpose_fusion" scheduling_name="input_convert_transpose_fusion.1"}
  %bitcast.25207.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.4), metadata={scheduling_name="bitcast.25207.0"}
  %get-tuple-element.4033 = bf16[4,16384,8192]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4033"}
  %custom-call.1170 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4033, %bitcast.25207.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1170"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3815.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1170), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3815.0"}
  %loop_transpose_fusion.4 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3815.0), kind=kLoop, calls=%fused_transpose.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.4"}
  %bitcast.25214.0 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} bitcast(%loop_transpose_fusion.4), metadata={scheduling_name="bitcast.25214.0"}
  %all-to-all-start = ((bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}), bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.25214.0), calls=%async_computation, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4517 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=31, metadata={scheduling_name="get-tuple-element.4517"}
  %loop_dynamic_slice_fusion.8 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4517, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.8, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.8"}
  %get-tuple-element.4516 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=30, metadata={scheduling_name="get-tuple-element.4516"}
  %loop_dynamic_slice_fusion.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4516, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.7, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.7"}
  %all-to-all-done = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done"}
  %bitcast.25243.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.8), metadata={scheduling_name="bitcast.25243.0"}
  %bitcast.25234.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done), metadata={scheduling_name="bitcast.25234.0"}
  %custom-call.1174 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25234.0, %bitcast.25243.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1174"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.25227.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.7), metadata={scheduling_name="bitcast.25227.0"}
  %cublas-lt-matmul.37 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25234.0, %bitcast.25227.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="cublas-lt-matmul.37"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"SILU","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4518 = bf16[1,2,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=32, metadata={scheduling_name="get-tuple-element.4518"}
  %loop_dynamic_slice_fusion.9 = bf16[1,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4518, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.9, metadata={deduplicated_name="loop_dynamic_slice_fusion.9" scheduling_name="loop_dynamic_slice_fusion.9"}
  %get-tuple-element.3817.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1174), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3817.0"}
  %get-tuple-element.3816.0 = bf16[65536,16384]{1,0} get-tuple-element(%cublas-lt-matmul.37), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3816.0"}
  %loop_convert_fusion.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} fusion(%get-tuple-element.3816.0, %get-tuple-element.3817.0), kind=kLoop, calls=%fused_convert.1, metadata={deduplicated_name="loop_convert_fusion" scheduling_name="loop_convert_fusion.1"}
  %bitcast.25261.0 = bf16[16384,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.9), metadata={scheduling_name="bitcast.25261.0"}
  %bitcast.25252.0 = bf16[65536,16384]{1,0} bitcast(%loop_convert_fusion.1), metadata={scheduling_name="bitcast.25252.0"}
  %custom-call.1175 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25252.0, %bitcast.25261.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1175"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3818.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1175), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3818.0"}
  %bitcast.25265.0 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} bitcast(%get-tuple-element.3818.0), metadata={scheduling_name="bitcast.25265.0"}
  %all-to-all-start.1 = ((bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}), bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.25265.0), calls=%async_computation.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-to-all-done.1 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.1"}
  %loop_transpose_fusion.3 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.1), kind=kLoop, calls=%fused_transpose.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion" scheduling_name="loop_transpose_fusion.3"}
  %bitcast.25276.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3813.0), metadata={scheduling_name="bitcast.25276.0"}
  %get-tuple-element.4034 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4034"}
  %bitcast.25272.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.3), metadata={scheduling_name="bitcast.25272.0"}
  %cublas-lt-matmul.38 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4034, %bitcast.25272.0, %bitcast.25276.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="cublas-lt-matmul.38"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3819.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.38), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3819.0"}
  %input_reduce_fusion.2 = f32[4,8192]{1,0} fusion(%get-tuple-element.3819.0), kind=kInput, calls=%fused_reduce.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_reduce_fusion.2"}
  %loop_rsqrt_fusion.1 = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.2), kind=kLoop, calls=%fused_rsqrt.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.1"}
  %get-tuple-element.4519 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=33, metadata={scheduling_name="get-tuple-element.4519"}
  %loop_convert_fusion.3 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3819.0, %loop_rsqrt_fusion.1, %get-tuple-element.4519, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_convert.3, metadata={scheduling_name="loop_convert_fusion.3"}
  %get-tuple-element.4278 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4278"}
  %bitcast.25438.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4278), metadata={scheduling_name="bitcast.25438.0"}
  %bitcast.25425.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.3), metadata={scheduling_name="bitcast.25425.0"}
  %custom-call.1178 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25425.0, %bitcast.25438.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1178"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4276 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4276"}
  %bitcast.25334.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4276), metadata={scheduling_name="bitcast.25334.0"}
  %custom-call.1176 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25425.0, %bitcast.25334.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1176"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4277 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4277"}
  %bitcast.25386.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4277), metadata={scheduling_name="bitcast.25386.0"}
  %custom-call.1177 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25425.0, %bitcast.25386.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1177"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3820.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1176), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3820.0"}
  %input_concatenate_fusion.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3820.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.1"}
  %get-tuple-element.3821.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1177), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3821.0"}
  %input_concatenate_fusion.3 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3821.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.3"}
  %get-tuple-element.3822.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1178), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3822.0"}
  %bitcast.25442.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3822.0), metadata={scheduling_name="bitcast.25442.0"}
  %custom-call.1009 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, u8[1]{0}) custom-call(%input_concatenate_fusion.1, %input_concatenate_fusion.3, %bitcast.25442.0, %constant_5296_0, %loop_broadcast_fusion.2, /*index=5*/%loop_multiply_fusion, %loop_multiply_fusion, %constant_5298_0, %constant_5298_0, %constant_5298_0, /*index=10*/%constant_5298_0, %constant_5298_0, %constant_5298_0), custom_call_target="te_fused_attn_forward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u32[2]{0}, s32[33]{0}, s32[33]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.1009"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.25469.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3819.0), metadata={scheduling_name="bitcast.25469.0"}
  %copy.683 = bf16[32768,6144]{1,0} copy(%bitcast.25469.0), metadata={scheduling_name="copy.683"}
  %get-tuple-element.4279 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done), index=8, metadata={scheduling_name="get-tuple-element.4279"}
  %bitcast.25465.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4279), metadata={scheduling_name="bitcast.25465.0"}
  %get-tuple-element.3484.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.1009), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3484.0"}
  %bitcast.25450.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3484.0), metadata={scheduling_name="bitcast.25450.0"}
  %cublas-lt-matmul.39 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25450.0, %bitcast.25465.0, %copy.683), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.39"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3823.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.39), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3823.0"}
  %input_reduce_fusion.1 = f32[4,8192]{1,0} fusion(%get-tuple-element.3823.0), kind=kInput, calls=%fused_reduce.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.1"}
  %loop_rsqrt_fusion = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.1), kind=kLoop, calls=%fused_rsqrt, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion"}
  %get-tuple-element.4524 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=38, metadata={scheduling_name="get-tuple-element.4524"}
  %loop_convert_fusion.2 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3823.0, %loop_rsqrt_fusion, %get-tuple-element.4524, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_convert.2, metadata={deduplicated_name="loop_convert_fusion.2" scheduling_name="loop_convert_fusion.2"}
  %get-tuple-element.4280 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done), index=9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4280"}
  %bitcast.25526.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4280), metadata={scheduling_name="bitcast.25526.0"}
  %bitcast.25513.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.2), metadata={scheduling_name="bitcast.25513.0"}
  %custom-call.1179 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25513.0, %bitcast.25526.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1179"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3824.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1179), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3824.0"}
  %wrapped_convert.1 = f32[32768,8]{1,0} fusion(%get-tuple-element.3824.0), kind=kLoop, calls=%wrapped_convert_computation.1, metadata={scheduling_name="wrapped_convert.1"}
  %sort.45.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.1, %wrapped_iota.3), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.45.0"}
  %get-tuple-element.3506.0 = s32[32768,8]{1,0} get-tuple-element(%sort.45.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3506.0"}
  %wrapped_slice.1 = s32[32768,2]{1,0} fusion(%get-tuple-element.3506.0), kind=kLoop, calls=%wrapped_slice_computation.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.1"}
  %get-tuple-element.3850.0 = f32[32768,8]{1,0} get-tuple-element(%sort.45.0), index=0, metadata={scheduling_name="get-tuple-element.3850.0"}
  %loop_convert_fusion.8 = f32[32768,2]{1,0} fusion(%get-tuple-element.3850.0), kind=kLoop, calls=%fused_convert.8, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.8"}
  %sort.47.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.8, %wrapped_slice.1, %wrapped_iota.4), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.47.0"}
  %get-tuple-element.3510.0 = s32[32768,2]{1,0} get-tuple-element(%sort.47.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3510.0"}
  %loop_compare_fusion.2 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.4514, %get-tuple-element.3510.0), kind=kLoop, calls=%fused_compare.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.2" scheduling_name="loop_compare_fusion.2"}
  %loop_transpose_fusion.2 = s32[65536,4]{1,0} fusion(%get-tuple-element.4501, %get-tuple-element.4500, %get-tuple-element.3510.0, %constant_5301_0, %partition-id.13.0), kind=kLoop, calls=%fused_transpose.2, metadata={deduplicated_name="loop_transpose_fusion.2" scheduling_name="loop_transpose_fusion.2"}
  %loop_slice_fusion.1 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.2), kind=kLoop, calls=%fused_slice.1, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.1"}
  %loop_reduce_window_fusion.1 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.1), kind=kLoop, calls=%fused_reduce_window.1, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.1"}
  %loop_reduce_window_fusion = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.1), kind=kLoop, calls=%fused_reduce_window, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion"}
  %input_scatter_fusion.3 = u32[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.1, %loop_transpose_fusion.2, %get-tuple-element.4513), kind=kInput, calls=%fused_scatter.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.2" scheduling_name="input_scatter_fusion.3"}
  %input_reduce_fusion = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.2, %loop_reduce_window_fusion.1, %loop_reduce_window_fusion), kind=kInput, calls=%fused_reduce, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion"}
  %get-tuple-element.3852.0 = f32[32768,2]{1,0} get-tuple-element(%sort.47.0), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3852.0"}
  %input_scatter_fusion = bf16[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion, %loop_transpose_fusion.2, %get-tuple-element.4513, %input_scatter_fusion.3, %get-tuple-element.4501, /*index=5*/%get-tuple-element.4500, %get-tuple-element.3510.0, %get-tuple-element.3852.0, %constant_5301_0, %partition-id.13.0), kind=kInput, calls=%fused_scatter, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion" scheduling_name="input_scatter_fusion"}
  %get-tuple-element.4008 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion), index=1, metadata={scheduling_name="get-tuple-element.4008"}
  %get-tuple-element.4007 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion), index=0, metadata={scheduling_name="get-tuple-element.4007"}
  %input_multiply_transpose_fusion = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.4008, %get-tuple-element.4007, %input_scatter_fusion), kind=kInput, calls=%fused_multiply_transpose, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion"}
  %get-tuple-element.4006 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4006"}
  %get-tuple-element.4005 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4005"}
  %input_convert_transpose_fusion = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.4515, %get-tuple-element.4005, %get-tuple-element.4006), kind=kInput, calls=%fused_convert_transpose, metadata={deduplicated_name="input_convert_transpose_fusion" scheduling_name="input_convert_transpose_fusion"}
  %bitcast.25751.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.2), metadata={scheduling_name="bitcast.25751.0"}
  %get-tuple-element.4003 = bf16[4,16384,8192]{2,1,0} get-tuple-element(%input_convert_transpose_fusion), index=0, metadata={scheduling_name="get-tuple-element.4003"}
  %custom-call.1180 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4003, %bitcast.25751.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1180"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3825.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1180), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3825.0"}
  %loop_transpose_fusion.1 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3825.0), kind=kLoop, calls=%fused_transpose.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.1"}
  %get-tuple-element.4444 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=2, metadata={scheduling_name="get-tuple-element.4444"}
  %bitcast.25758.0 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} bitcast(%loop_transpose_fusion.1), metadata={scheduling_name="bitcast.25758.0"}
  %all-to-all-start.2 = ((bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}), bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.25758.0), calls=%async_computation.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_add_fusion = s32[] fusion(%copy.750), kind=kLoop, calls=%fused_add, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_add_fusion.1" scheduling_name="loop_add_fusion"}
  %get-tuple-element.4455 = s32[9]{0} get-tuple-element(%param.217), index=13, metadata={scheduling_name="get-tuple-element.4455"}
  %loop_dynamic_update_slice_fusion.9 = s32[9]{0} fusion(%get-tuple-element.4455, %copy.750), kind=kLoop, calls=%fused_dynamic_update_slice.9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion.9"}
  %get-tuple-element.4528 = bf16[1,2,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=42, metadata={scheduling_name="get-tuple-element.4528"}
  %loop_dynamic_slice_fusion.15 = bf16[1,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4528, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.15, metadata={deduplicated_name="loop_dynamic_slice_fusion.9" scheduling_name="loop_dynamic_slice_fusion.15"}
  %get-tuple-element.4527 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=41, metadata={scheduling_name="get-tuple-element.4527"}
  %loop_dynamic_slice_fusion.14 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4527, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.14, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.14"}
  %get-tuple-element.4526 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=40, metadata={scheduling_name="get-tuple-element.4526"}
  %loop_dynamic_slice_fusion.13 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4526, %get-tuple-element.4504, %copy.750), kind=kLoop, calls=%fused_dynamic_slice.13, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.13"}
  %all-to-all-done.2 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.2"}
  %collective-permute-start = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4444), channel_id=5, source_target_pairs={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{8,0},{9,1},{10,2},{11,3},{12,4},{13,5},{14,6},{15,7}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.25787.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.14), metadata={scheduling_name="bitcast.25787.0"}
  %bitcast.25778.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.2), metadata={scheduling_name="bitcast.25778.0"}
  %custom-call.1181 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25778.0, %bitcast.25787.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1181"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.25771.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.13), metadata={scheduling_name="bitcast.25771.0"}
  %cublas-lt-matmul.40 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25778.0, %bitcast.25771.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="cublas-lt-matmul.40"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"SILU","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3827.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1181), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3827.0"}
  %get-tuple-element.3826.0 = bf16[65536,16384]{1,0} get-tuple-element(%cublas-lt-matmul.40), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3826.0"}
  %loop_convert_fusion = bf16[1,1,32,2048,16384]{4,3,2,1,0} fusion(%get-tuple-element.3826.0, %get-tuple-element.3827.0), kind=kLoop, calls=%fused_convert, metadata={deduplicated_name="loop_convert_fusion" scheduling_name="loop_convert_fusion"}
  %get-tuple-element.4447 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=5, metadata={scheduling_name="get-tuple-element.4447"}
  %loop_dynamic_update_slice_fusion.7 = bf16[9,1,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4447, %copy.750, %get-tuple-element.4120), kind=kLoop, calls=%fused_dynamic_update_slice.7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion.7"}
  %bitcast.25805.0 = bf16[16384,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.15), metadata={scheduling_name="bitcast.25805.0"}
  %bitcast.25796.0 = bf16[65536,16384]{1,0} bitcast(%loop_convert_fusion), metadata={scheduling_name="bitcast.25796.0"}
  %custom-call.1182 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25796.0, %bitcast.25805.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1182"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-done"}
  %get-tuple-element.3828.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1182), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3828.0"}
  %bitcast.25809.0 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} bitcast(%get-tuple-element.3828.0), metadata={scheduling_name="bitcast.25809.0"}
  %all-to-all-start.3 = ((bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}), bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.25809.0), calls=%async_computation.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4450 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.217), index=8, metadata={scheduling_name="get-tuple-element.4450"}
  %loop_dynamic_update_slice_fusion.4 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4450, %copy.750, %get-tuple-element.3468.0), kind=kLoop, calls=%fused_dynamic_update_slice.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.1" scheduling_name="loop_dynamic_update_slice_fusion.4"}
  %get-tuple-element.4449 = u32[9,2,4]{2,1,0} get-tuple-element(%param.217), index=7, metadata={scheduling_name="get-tuple-element.4449"}
  %get-tuple-element.3470.0 = u32[2,4]{1,0} get-tuple-element(%custom-call.1006), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3470.0"}
  %loop_dynamic_update_slice_fusion.5 = u32[9,2,4]{2,1,0} fusion(%get-tuple-element.4449, %copy.750, %get-tuple-element.3470.0), kind=kLoop, calls=%fused_dynamic_update_slice.5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.2" scheduling_name="loop_dynamic_update_slice_fusion.5"}
  %get-tuple-element.4448 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.217), index=6, metadata={scheduling_name="get-tuple-element.4448"}
  %get-tuple-element.3469.0 = f32[1,4,48,8192,1]{4,3,2,1,0} get-tuple-element(%custom-call.1006), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3469.0"}
  %loop_dynamic_update_slice_fusion.6 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%copy.750, %get-tuple-element.3469.0, %get-tuple-element.4448), kind=kLoop, calls=%fused_dynamic_update_slice.6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.3" scheduling_name="loop_dynamic_update_slice_fusion.6"}
  %loop_dynamic_update_slice_fusion.10 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4443, %collective-permute-done, %copy.750), kind=kLoop, calls=%fused_dynamic_update_slice.10, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="loop_dynamic_update_slice_fusion.10"}
  %get-tuple-element.4451 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=9, metadata={scheduling_name="get-tuple-element.4451"}
  %loop_dynamic_update_slice_fusion = bf16[9,1,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4451, %copy.750, %get-tuple-element.3819.0), kind=kLoop, calls=%fused_dynamic_update_slice, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion"}
  %all-to-all-done.3 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.3"}
  %get-tuple-element.4121 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4121"}
  %bitcast.25834.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.4121), metadata={scheduling_name="bitcast.25834.0"}
  %collective-permute-start.1 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.25834.0), channel_id=127, source_target_pairs={{8,0},{9,1},{10,2},{11,3},{12,4},{13,5},{14,6},{15,7}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4454 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.217), index=12, metadata={scheduling_name="get-tuple-element.4454"}
  %loop_dynamic_update_slice_fusion.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4454, %copy.750, %get-tuple-element.3484.0), kind=kLoop, calls=%fused_dynamic_update_slice.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.1" scheduling_name="loop_dynamic_update_slice_fusion.1"}
  %get-tuple-element.4453 = u32[9,2,4]{2,1,0} get-tuple-element(%param.217), index=11, metadata={scheduling_name="get-tuple-element.4453"}
  %get-tuple-element.3486.0 = u32[2,4]{1,0} get-tuple-element(%custom-call.1009), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3486.0"}
  %loop_dynamic_update_slice_fusion.2 = u32[9,2,4]{2,1,0} fusion(%get-tuple-element.4453, %copy.750, %get-tuple-element.3486.0), kind=kLoop, calls=%fused_dynamic_update_slice.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.2" scheduling_name="loop_dynamic_update_slice_fusion.2"}
  %loop_transpose_fusion = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.3), kind=kLoop, calls=%fused_transpose, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion" scheduling_name="loop_transpose_fusion"}
  %get-tuple-element.4452 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.217), index=10, metadata={scheduling_name="get-tuple-element.4452"}
  %get-tuple-element.3485.0 = f32[1,4,48,8192,1]{4,3,2,1,0} get-tuple-element(%custom-call.1009), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3485.0"}
  %loop_dynamic_update_slice_fusion.3 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%copy.750, %get-tuple-element.3485.0, %get-tuple-element.4452), kind=kLoop, calls=%fused_dynamic_update_slice.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.3" scheduling_name="loop_dynamic_update_slice_fusion.3"}
  %bitcast.25820.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3823.0), metadata={scheduling_name="bitcast.25820.0"}
  %get-tuple-element.4004 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion), index=1, metadata={scheduling_name="get-tuple-element.4004"}
  %bitcast.25816.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion), metadata={scheduling_name="bitcast.25816.0"}
  %cublas-lt-matmul.41 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4004, %bitcast.25816.0, %bitcast.25820.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="cublas-lt-matmul.41"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.1 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-done.1"}
  %get-tuple-element.4529 = pred[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=43, metadata={scheduling_name="get-tuple-element.4529"}
  %get-tuple-element.3829.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.41), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3829.0"}
  %loop_dynamic_update_slice_fusion.8 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4446, %get-tuple-element.4529, %collective-permute-done.1, %get-tuple-element.3829.0, %copy.750), kind=kLoop, calls=%fused_dynamic_update_slice.8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="loop_dynamic_update_slice_fusion.8"}
  %bitcast.25830.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3829.0), metadata={scheduling_name="bitcast.25830.0"}
  %copy.766 = bf16[1,4,8192,6144]{3,2,1,0} copy(%bitcast.25830.0), metadata={scheduling_name="copy.766"}
  %bitcast.25870.0 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} bitcast(%loop_dynamic_update_slice_fusion.6), metadata={scheduling_name="bitcast.25870.0"}
  %bitcast.25918.0 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} bitcast(%loop_dynamic_update_slice_fusion.3), metadata={scheduling_name="bitcast.25918.0"}
  ROOT %tuple.664 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) tuple(%loop_add_fusion, %loop_dynamic_update_slice_fusion.10, %copy.766, %bitcast.25830.0, %loop_dynamic_update_slice_fusion.8, /*index=5*/%loop_dynamic_update_slice_fusion.7, %bitcast.25870.0, %loop_dynamic_update_slice_fusion.5, %loop_dynamic_update_slice_fusion.4, %loop_dynamic_update_slice_fusion, /*index=10*/%bitcast.25918.0, %loop_dynamic_update_slice_fusion.2, %loop_dynamic_update_slice_fusion.1, %loop_dynamic_update_slice_fusion.9, %get-tuple-element.4500, /*index=15*/%get-tuple-element.4501, %get-tuple-element.4502, %get-tuple-element.4503, %get-tuple-element.4504, %get-tuple-element.4505, /*index=20*/%get-tuple-element.4506, %get-tuple-element.4507, %get-tuple-element.4508, %get-tuple-element.4509, %get-tuple-element.4510, /*index=25*/%get-tuple-element.4511, %get-tuple-element.4512, %get-tuple-element.4513, %get-tuple-element.4514, %get-tuple-element.4515, /*index=30*/%get-tuple-element.4516, %get-tuple-element.4517, %get-tuple-element.4518, %get-tuple-element.4519, %get-tuple-element.4520, /*index=35*/%get-tuple-element.4521, %get-tuple-element.4522, %get-tuple-element.4523, %get-tuple-element.4524, %get-tuple-element.4525, /*index=40*/%get-tuple-element.4526, %get-tuple-element.4527, %get-tuple-element.4528, %get-tuple-element.4529), metadata={scheduling_name="tuple.664"}
}

%fused_compare.1 (param_0.1: s32[]) -> pred[] {
  %param_0.1 = s32[] parameter(0), metadata={scheduling_name="param_0.1"}
  %constant_5285_1 = s32[] constant(9)
  ROOT %compare.1581.1 = pred[] compare(%param_0.1, %constant_5285_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="compare.1581.1"}
}

%region_18.1706.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone (param.216: (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144])) -> pred[] {
  %param.216 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) parameter(0), metadata={scheduling_name="param.216"}
  %get-tuple-element.3451.0 = s32[] get-tuple-element(%param.216), index=0, metadata={scheduling_name="get-tuple-element.3451.0"}
  ROOT %loop_compare_fusion.1 = pred[] fusion(%get-tuple-element.3451.0), kind=kLoop, calls=%fused_compare.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_compare_fusion" scheduling_name="loop_compare_fusion.1"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone (p.0.lhs.30: f32[], p.0.rhs.30: f32[], p.1.lhs.30: s32[], p.1.rhs.30: s32[]) -> pred[] {
  %constant_5324_0 = s32[] constant(2147483647)
  %constant_5323_0 = s32[] constant(0)
  %p.1.rhs.30 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.30"}
  %p.1.lhs.30 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.30"}
  %p.0.rhs.30 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.30"}
  %p.0.lhs.30 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.30"}
  %compare.1587.0 = pred[] compare(%p.1.lhs.30, %p.1.rhs.30), direction=LT, metadata={scheduling_name="compare.1587.0"}
  %bitcast-convert.65.0 = s32[] bitcast-convert(%p.0.rhs.30), metadata={scheduling_name="bitcast-convert.65.0"}
  %compare.1583.0 = pred[] compare(%bitcast-convert.65.0, %constant_5323_0), direction=LT, metadata={scheduling_name="compare.1583.0"}
  %xor.65.0 = s32[] xor(%constant_5324_0, %bitcast-convert.65.0), metadata={scheduling_name="xor.65.0"}
  %select.1248.0 = s32[] select(%compare.1583.0, %xor.65.0, %bitcast-convert.65.0), metadata={scheduling_name="select.1248.0"}
  %bitcast-convert.64.0 = s32[] bitcast-convert(%p.0.lhs.30), metadata={scheduling_name="bitcast-convert.64.0"}
  %compare.1582.0 = pred[] compare(%bitcast-convert.64.0, %constant_5323_0), direction=LT, metadata={scheduling_name="compare.1582.0"}
  %xor.64.0 = s32[] xor(%constant_5324_0, %bitcast-convert.64.0), metadata={scheduling_name="xor.64.0"}
  %select.1247.0 = s32[] select(%compare.1582.0, %xor.64.0, %bitcast-convert.64.0), metadata={scheduling_name="select.1247.0"}
  %compare.1584.0 = pred[] compare(%select.1247.0, %select.1248.0), direction=GT, metadata={scheduling_name="compare.1584.0"}
  %compare.1585.0 = pred[] compare(%select.1248.0, %select.1247.0), direction=GT, metadata={scheduling_name="compare.1585.0"}
  %compare.1586.0 = pred[] compare(%compare.1584.0, %compare.1585.0), direction=EQ, metadata={scheduling_name="compare.1586.0"}
  ROOT %select.1249.0 = pred[] select(%compare.1586.0, %compare.1587.0, %compare.1584.0), metadata={scheduling_name="select.1249.0"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.1 (p.0.lhs.32: f32[], p.0.rhs.32: f32[], p.1.lhs.32: s32[], p.1.rhs.32: s32[]) -> pred[] {
  %constant_5328_0 = s32[] constant(2147483647)
  %constant_5327_0 = s32[] constant(0)
  %p.1.rhs.32 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.32"}
  %p.1.lhs.32 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.32"}
  %p.0.rhs.32 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.32"}
  %p.0.lhs.32 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.32"}
  %compare.1603.0 = pred[] compare(%p.1.lhs.32, %p.1.rhs.32), direction=LT, metadata={scheduling_name="compare.1603.0"}
  %bitcast-convert.69.0 = s32[] bitcast-convert(%p.0.rhs.32), metadata={scheduling_name="bitcast-convert.69.0"}
  %compare.1599.0 = pred[] compare(%bitcast-convert.69.0, %constant_5327_0), direction=LT, metadata={scheduling_name="compare.1599.0"}
  %xor.69.0 = s32[] xor(%constant_5328_0, %bitcast-convert.69.0), metadata={scheduling_name="xor.69.0"}
  %select.1256.0 = s32[] select(%compare.1599.0, %xor.69.0, %bitcast-convert.69.0), metadata={scheduling_name="select.1256.0"}
  %bitcast-convert.68.0 = s32[] bitcast-convert(%p.0.lhs.32), metadata={scheduling_name="bitcast-convert.68.0"}
  %compare.1598.0 = pred[] compare(%bitcast-convert.68.0, %constant_5327_0), direction=LT, metadata={scheduling_name="compare.1598.0"}
  %xor.68.0 = s32[] xor(%constant_5328_0, %bitcast-convert.68.0), metadata={scheduling_name="xor.68.0"}
  %select.1255.0 = s32[] select(%compare.1598.0, %xor.68.0, %bitcast-convert.68.0), metadata={scheduling_name="select.1255.0"}
  %compare.1600.0 = pred[] compare(%select.1255.0, %select.1256.0), direction=GT, metadata={scheduling_name="compare.1600.0"}
  %compare.1601.0 = pred[] compare(%select.1256.0, %select.1255.0), direction=GT, metadata={scheduling_name="compare.1601.0"}
  %compare.1602.0 = pred[] compare(%compare.1600.0, %compare.1601.0), direction=EQ, metadata={scheduling_name="compare.1602.0"}
  ROOT %select.1257.0 = pred[] select(%compare.1602.0, %compare.1603.0, %compare.1600.0), metadata={scheduling_name="select.1257.0"}
}

%compare-value-and-index.9.clone.clone (p.0.lhs.31: f32[], p.0.rhs.31: f32[], p.1.lhs.31: s32[], p.1.rhs.31: s32[], p.2.lhs.clone.4: s32[], p.2.rhs.clone.4: s32[]) -> pred[] {
  %constant_5326_0 = s32[] constant(2147483647)
  %constant_5325_0 = s32[] constant(0)
  %p.2.rhs.clone.4 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.4"}
  %p.2.lhs.clone.4 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.4"}
  %p.1.rhs.31 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.31"}
  %p.1.lhs.31 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.31"}
  %p.0.rhs.31 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.31"}
  %p.0.lhs.31 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.31"}
  %compare.1597.0 = pred[] compare(%p.2.lhs.clone.4, %p.2.rhs.clone.4), direction=LT, metadata={scheduling_name="compare.1597.0"}
  %compare.1594.0 = pred[] compare(%p.1.rhs.31, %p.1.lhs.31), direction=LT, metadata={scheduling_name="compare.1594.0"}
  %compare.1591.0 = pred[] compare(%p.1.lhs.31, %p.1.rhs.31), direction=LT, metadata={scheduling_name="compare.1591.0"}
  %bitcast-convert.67.0 = s32[] bitcast-convert(%p.0.rhs.31), metadata={scheduling_name="bitcast-convert.67.0"}
  %compare.1589.0 = pred[] compare(%bitcast-convert.67.0, %constant_5325_0), direction=LT, metadata={scheduling_name="compare.1589.0"}
  %xor.67.0 = s32[] xor(%constant_5326_0, %bitcast-convert.67.0), metadata={scheduling_name="xor.67.0"}
  %select.1251.0 = s32[] select(%compare.1589.0, %xor.67.0, %bitcast-convert.67.0), metadata={scheduling_name="select.1251.0"}
  %compare.1595.0 = pred[] compare(%p.0.rhs.31, %p.0.lhs.31), direction=GT, metadata={scheduling_name="compare.1595.0"}
  %compare.1592.0 = pred[] compare(%p.0.lhs.31, %p.0.rhs.31), direction=GT, metadata={scheduling_name="compare.1592.0"}
  %bitcast-convert.66.0 = s32[] bitcast-convert(%p.0.lhs.31), metadata={scheduling_name="bitcast-convert.66.0"}
  %compare.1588.0 = pred[] compare(%bitcast-convert.66.0, %constant_5325_0), direction=LT, metadata={scheduling_name="compare.1588.0"}
  %xor.66.0 = s32[] xor(%constant_5326_0, %bitcast-convert.66.0), metadata={scheduling_name="xor.66.0"}
  %select.1250.0 = s32[] select(%compare.1588.0, %xor.66.0, %bitcast-convert.66.0), metadata={scheduling_name="select.1250.0"}
  %compare.1590.0 = pred[] compare(%select.1250.0, %select.1251.0), direction=EQ, metadata={scheduling_name="compare.1590.0"}
  %select.1252.0 = pred[] select(%compare.1590.0, %compare.1591.0, %compare.1592.0), metadata={scheduling_name="select.1252.0"}
  %compare.1593.0 = pred[] compare(%select.1251.0, %select.1250.0), direction=EQ, metadata={scheduling_name="compare.1593.0"}
  %select.1253.0 = pred[] select(%compare.1593.0, %compare.1594.0, %compare.1595.0), metadata={scheduling_name="select.1253.0"}
  %compare.1596.0 = pred[] compare(%select.1252.0, %select.1253.0), direction=EQ, metadata={scheduling_name="compare.1596.0"}
  ROOT %select.1254.0 = pred[] select(%compare.1596.0, %compare.1597.0, %select.1252.0), metadata={scheduling_name="select.1254.0"}
}

%compare-value-and-index.9.clone.clone.1 (p.0.lhs.33: f32[], p.0.rhs.33: f32[], p.1.lhs.33: s32[], p.1.rhs.33: s32[], p.2.lhs.clone.5: s32[], p.2.rhs.clone.5: s32[]) -> pred[] {
  %constant_5330_0 = s32[] constant(2147483647)
  %constant_5329_0 = s32[] constant(0)
  %p.2.rhs.clone.5 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.5"}
  %p.2.lhs.clone.5 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.5"}
  %p.1.rhs.33 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.33"}
  %p.1.lhs.33 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.33"}
  %p.0.rhs.33 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.33"}
  %p.0.lhs.33 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.33"}
  %compare.1613.0 = pred[] compare(%p.2.lhs.clone.5, %p.2.rhs.clone.5), direction=LT, metadata={scheduling_name="compare.1613.0"}
  %compare.1610.0 = pred[] compare(%p.1.rhs.33, %p.1.lhs.33), direction=LT, metadata={scheduling_name="compare.1610.0"}
  %compare.1607.0 = pred[] compare(%p.1.lhs.33, %p.1.rhs.33), direction=LT, metadata={scheduling_name="compare.1607.0"}
  %bitcast-convert.71.0 = s32[] bitcast-convert(%p.0.rhs.33), metadata={scheduling_name="bitcast-convert.71.0"}
  %compare.1605.0 = pred[] compare(%bitcast-convert.71.0, %constant_5329_0), direction=LT, metadata={scheduling_name="compare.1605.0"}
  %xor.71.0 = s32[] xor(%constant_5330_0, %bitcast-convert.71.0), metadata={scheduling_name="xor.71.0"}
  %select.1259.0 = s32[] select(%compare.1605.0, %xor.71.0, %bitcast-convert.71.0), metadata={scheduling_name="select.1259.0"}
  %compare.1611.0 = pred[] compare(%p.0.rhs.33, %p.0.lhs.33), direction=GT, metadata={scheduling_name="compare.1611.0"}
  %compare.1608.0 = pred[] compare(%p.0.lhs.33, %p.0.rhs.33), direction=GT, metadata={scheduling_name="compare.1608.0"}
  %bitcast-convert.70.0 = s32[] bitcast-convert(%p.0.lhs.33), metadata={scheduling_name="bitcast-convert.70.0"}
  %compare.1604.0 = pred[] compare(%bitcast-convert.70.0, %constant_5329_0), direction=LT, metadata={scheduling_name="compare.1604.0"}
  %xor.70.0 = s32[] xor(%constant_5330_0, %bitcast-convert.70.0), metadata={scheduling_name="xor.70.0"}
  %select.1258.0 = s32[] select(%compare.1604.0, %xor.70.0, %bitcast-convert.70.0), metadata={scheduling_name="select.1258.0"}
  %compare.1606.0 = pred[] compare(%select.1258.0, %select.1259.0), direction=EQ, metadata={scheduling_name="compare.1606.0"}
  %select.1260.0 = pred[] select(%compare.1606.0, %compare.1607.0, %compare.1608.0), metadata={scheduling_name="select.1260.0"}
  %compare.1609.0 = pred[] compare(%select.1259.0, %select.1258.0), direction=EQ, metadata={scheduling_name="compare.1609.0"}
  %select.1261.0 = pred[] select(%compare.1609.0, %compare.1610.0, %compare.1611.0), metadata={scheduling_name="select.1261.0"}
  %compare.1612.0 = pred[] compare(%select.1260.0, %select.1261.0), direction=EQ, metadata={scheduling_name="compare.1612.0"}
  ROOT %select.1262.0 = pred[] select(%compare.1612.0, %compare.1613.0, %select.1260.0), metadata={scheduling_name="select.1262.0"}
}

%fused_convert_reduce (param_0.6060: bf16[9,1,4,8192,6144], param_1.6450: s32[], param_2.4635: bf16[2,1,6144], param_3.3805: s32[16], param_4.2790: u32[], param_5.2558: s32[9], param_6.2323: bf16[32768,6144], param_7.2146: bf16[32768,6144]) -> (f32[4,8192], bf16[32768,6144]) {
  %param_0.6060 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6060"}
  %constant_1624_25 = s32[] constant(8)
  %param_1.6450 = s32[] parameter(1), metadata={scheduling_name="param_1.6450"}
  %subtract.247.18 = s32[] subtract(%constant_1624_25, %param_1.6450), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.18"}
  %constant_1627_19 = s32[] constant(0)
  %dynamic-slice.1381.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.6060, %subtract.247.18, %constant_1627_19, %constant_1627_19, %constant_1627_19, /*index=5*/%constant_1627_19), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1381.3"}
  %bitcast.23080.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1381.3), metadata={scheduling_name="bitcast.23080.23"}
  %convert.4053.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23080.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4053.23"}
  %param_7.2146 = bf16[32768,6144]{1,0} parameter(7), metadata={scheduling_name="param_7.2146"}
  %convert.4089.1.clone.1 = f32[32768,6144]{1,0} convert(%param_7.2146), metadata={scheduling_name="convert.4089.1.clone.1"}
  %param_6.2323 = bf16[32768,6144]{1,0} parameter(6), metadata={scheduling_name="param_6.2323"}
  %convert.4100.1.clone.1 = f32[32768,6144]{1,0} convert(%param_6.2323), metadata={scheduling_name="convert.4100.1.clone.1"}
  %add.2940.1.clone.1 = f32[32768,6144]{1,0} add(%convert.4089.1.clone.1, %convert.4100.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/attentions.py" source_line=838 scheduling_name="add.2940.1.clone.1"}
  %convert.4101.1.clone.1 = bf16[32768,6144]{1,0} convert(%add.2940.1.clone.1), metadata={scheduling_name="convert.4101.1.clone.1"}
  %bitcast.23437.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%convert.4101.1.clone.1), metadata={scheduling_name="bitcast.23437.17"}
  %convert.4102.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23437.17), metadata={scheduling_name="convert.4102.17"}
  %param_2.4635 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4635"}
  %param_5.2558 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2558"}
  %dynamic-slice.1376.146 = s32[1]{0} dynamic-slice(%param_5.2558, %subtract.247.18), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.146"}
  %param_3.3805 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.3805"}
  %param_4.2790 = u32[] parameter(4), metadata={scheduling_name="param_4.2790"}
  %dynamic-slice.1377.141 = s32[1]{0} dynamic-slice(%param_3.3805, %param_4.2790), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.141"}
  %subtract.248.136 = s32[1]{0} subtract(%dynamic-slice.1376.146, %dynamic-slice.1377.141), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.136"}
  %constant_2102_73 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.136 = s32[1]{0} maximum(%subtract.248.136, %constant_2102_73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.136"}
  %sign.27.131 = s32[1]{0} sign(%maximum.47.136), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.131"}
  %constant_5000_67 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.131 = pred[1]{0} compare(%sign.27.131, %constant_5000_67), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.131"}
  %constant_5001_66 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.136 = s32[1]{0} and(%maximum.47.136, %constant_5001_66), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.136"}
  %compare.1615.136 = pred[1]{0} compare(%and.301.136, %constant_2102_73), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.136"}
  %and.302.131 = pred[1]{0} and(%compare.1614.131, %compare.1615.136), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.131"}
  %constant_5002_64 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.131 = s32[1]{0} shift-right-logical(%maximum.47.136, %constant_5002_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.131"}
  %constant_5003_64 = s32[1]{0} constant({-1})
  %add.2882.131 = s32[1]{0} add(%shift-right-logical.20.131, %constant_5003_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.131"}
  %select.1263.131 = s32[1]{0} select(%and.302.131, %add.2882.131, %shift-right-logical.20.131), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.131"}
  %compare.1616.131 = pred[1]{0} compare(%select.1263.131, %constant_2102_73), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.131"}
  %add.2883.131 = s32[1]{0} add(%select.1263.131, %constant_5002_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.131"}
  %select.1264.131 = s32[1]{0} select(%compare.1616.131, %add.2883.131, %select.1263.131), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.131"}
  %bitcast.20992.145 = s32[1,1]{1,0} bitcast(%select.1264.131), metadata={scheduling_name="bitcast.20992.145"}
  %pad.345.37 = s32[1,2]{1,0} pad(%bitcast.20992.145, %constant_1627_19), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.37"}
  %pad.346.35 = s32[1,3]{1,0} pad(%pad.345.37, %constant_1627_19), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.35"}
  %bitcast.21099.32 = s32[3]{0} bitcast(%pad.346.35), metadata={scheduling_name="bitcast.21099.32"}
  %slice.2376.27 = s32[1]{0} slice(%bitcast.21099.32), slice={[1:2]}, metadata={scheduling_name="slice.2376.27"}
  %bitcast.23800.14 = s32[] bitcast(%slice.2376.27), metadata={scheduling_name="bitcast.23800.14"}
  %dynamic-slice.1410.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4635, %bitcast.23800.14, %constant_1627_19, %constant_1627_19), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1410.3"}
  %bitcast.23118.10 = bf16[6144]{0} bitcast(%dynamic-slice.1410.3), metadata={scheduling_name="bitcast.23118.10"}
  %convert.4994.7 = f32[6144]{0} convert(%bitcast.23118.10), metadata={scheduling_name="convert.4994.7"}
  %broadcast.6009.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4994.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6009.14"}
  %multiply.2663.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4102.17, %broadcast.6009.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2663.11"}
  %multiply.2665.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4053.23, %multiply.2663.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2665.3"}
  %bitcast.24110.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2665.3), metadata={scheduling_name="bitcast.24110.1"}
  %constant_1651_3 = f32[] constant(0)
  %reduce.426.1 = f32[4,8192]{1,0} reduce(%bitcast.24110.1, %constant_1651_3), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.426.1"}
  ROOT %tuple.476 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}) tuple(%reduce.426.1, %convert.4101.1.clone.1), metadata={scheduling_name="tuple.476"}
}

%fused_dynamic_update_slice.11 (param_0.2388: bf16[2,1,48,128,768], param_1.2521: bf16[1,1,768,48,128], param_2.1865: bf16[1,768,48,128], param_3.1457: pred[], param_4.1433: s32[16], param_5.1310: u32[], param_6.1264: s32[9], param_7.1190: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.2388 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2388"}
  %bitcast.23884.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2388), metadata={scheduling_name="bitcast.23884.1"}
  %param_1.2521 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2521"}
  %convert.4164.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2521), metadata={scheduling_name="convert.4164.3"}
  %param_3.1457 = pred[] parameter(3), metadata={scheduling_name="param_3.1457"}
  %broadcast.5640.10 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1457), dimensions={}, metadata={scheduling_name="broadcast.5640.10"}
  %param_2.1865 = bf16[1,768,48,128]{3,2,0,1} parameter(2), metadata={scheduling_name="param_2.1865"}
  %bitcast.23906.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1865), metadata={scheduling_name="bitcast.23906.3"}
  %constant_1623_41 = bf16[] constant(0)
  %broadcast.5641.10 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1623_41), dimensions={}, metadata={scheduling_name="broadcast.5641.10"}
  %select.1300.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5640.10, %bitcast.23906.3, %broadcast.5641.10), metadata={scheduling_name="select.1300.3"}
  %bitcast.23912.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1300.3), metadata={scheduling_name="bitcast.23912.7"}
  %convert.4165.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23912.7), metadata={scheduling_name="convert.4165.7"}
  %add.2953.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4164.3, %convert.4165.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2953.5"}
  %convert.4166.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.2953.5), metadata={scheduling_name="convert.4166.3"}
  %constant_5004_37 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1264 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1264"}
  %constant_1624_87 = s32[] constant(8)
  %param_7.1190 = s32[] parameter(7), metadata={scheduling_name="param_7.1190"}
  %subtract.247.131 = s32[] subtract(%constant_1624_87, %param_7.1190), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.131"}
  %dynamic-slice.1376.112 = s32[1]{0} dynamic-slice(%param_6.1264, %subtract.247.131), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.112"}
  %param_4.1433 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1433"}
  %param_5.1310 = u32[] parameter(5), metadata={scheduling_name="param_5.1310"}
  %dynamic-slice.1377.107 = s32[1]{0} dynamic-slice(%param_4.1433, %param_5.1310), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.107"}
  %subtract.248.102 = s32[1]{0} subtract(%dynamic-slice.1376.112, %dynamic-slice.1377.107), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.102"}
  %constant_2102_59 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.102 = s32[1]{0} maximum(%subtract.248.102, %constant_2102_59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.102"}
  %sign.27.101 = s32[1]{0} sign(%maximum.47.102), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.101"}
  %constant_5000_54 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.101 = pred[1]{0} compare(%sign.27.101, %constant_5000_54), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.101"}
  %constant_5001_52 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.102 = s32[1]{0} and(%maximum.47.102, %constant_5001_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.102"}
  %compare.1615.102 = pred[1]{0} compare(%and.301.102, %constant_2102_59), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.102"}
  %and.302.101 = pred[1]{0} and(%compare.1614.101, %compare.1615.102), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.101"}
  %constant_5002_51 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.101 = s32[1]{0} shift-right-logical(%maximum.47.102, %constant_5002_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.101"}
  %constant_5003_51 = s32[1]{0} constant({-1})
  %add.2882.101 = s32[1]{0} add(%shift-right-logical.20.101, %constant_5003_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.101"}
  %select.1263.101 = s32[1]{0} select(%and.302.101, %add.2882.101, %shift-right-logical.20.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.101"}
  %compare.1616.101 = pred[1]{0} compare(%select.1263.101, %constant_2102_59), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.101"}
  %add.2883.101 = s32[1]{0} add(%select.1263.101, %constant_5002_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.101"}
  %select.1264.101 = s32[1]{0} select(%compare.1616.101, %add.2883.101, %select.1263.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.101"}
  %bitcast.20992.111 = s32[1,1]{1,0} bitcast(%select.1264.101), metadata={scheduling_name="bitcast.20992.111"}
  %concatenate.701.59 = s32[1,5]{1,0} concatenate(%constant_5004_37, %bitcast.20992.111, %constant_5004_37, %constant_5004_37, %constant_5004_37), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.59"}
  %bitcast.21040.58 = s32[5]{0} bitcast(%concatenate.701.59), metadata={scheduling_name="bitcast.21040.58"}
  %slice.2375.55 = s32[1]{0} slice(%bitcast.21040.58), slice={[1:2]}, metadata={scheduling_name="slice.2375.55"}
  %bitcast.23961.26 = s32[] bitcast(%slice.2375.55), metadata={scheduling_name="bitcast.23961.26"}
  %constant_1627_112 = s32[] constant(0)
  ROOT %dynamic-update-slice.411.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%bitcast.23884.1, %convert.4166.3, %bitcast.23961.26, %constant_1627_112, %constant_1627_112, /*index=5*/%constant_1627_112, %constant_1627_112), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.411.1"}
}

%fused_dynamic_slice.16 (param_0.2384: bf16[2,1,48,128,768], param_1.2583: s32[16], param_2.1999: u32[], param_3.1643: s32[9], param_4.1397: s32[], param_5.2667: bf16[2,1,768,48,128], param_6.2457: bf16[2,1,48,128,768], param_7.2280: bf16[2,1,48,128,768], param_8.2132: bf16[2,1,768,48,128], param_9.1870: bf16[2,1,768,48,128], param_10.1498: bf16[2,1,48,128,768], param_11.1405: bf16[2,1,768,48,128]) -> (bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], /*index=5*/bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128]) {
  %param_0.2384 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2384"}
  %bitcast.23884.2 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2384), metadata={scheduling_name="bitcast.23884.2"}
  %constant_5004_1 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1643 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1643"}
  %constant_1624_40 = s32[] constant(8)
  %param_4.1397 = s32[] parameter(4), metadata={scheduling_name="param_4.1397"}
  %subtract.247.37 = s32[] subtract(%constant_1624_40, %param_4.1397), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.37"}
  %dynamic-slice.1376.18 = s32[1]{0} dynamic-slice(%param_3.1643, %subtract.247.37), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.18"}
  %param_1.2583 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1.2583"}
  %param_2.1999 = u32[] parameter(2), metadata={scheduling_name="param_2.1999"}
  %dynamic-slice.1377.13 = s32[1]{0} dynamic-slice(%param_1.2583, %param_2.1999), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.13"}
  %subtract.248.8 = s32[1]{0} subtract(%dynamic-slice.1376.18, %dynamic-slice.1377.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.8"}
  %constant_2102_14 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.8 = s32[1]{0} maximum(%subtract.248.8, %constant_2102_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.8"}
  %sign.27.7 = s32[1]{0} sign(%maximum.47.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.7"}
  %constant_5000_7 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.7 = pred[1]{0} compare(%sign.27.7, %constant_5000_7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.7"}
  %constant_5001_5 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.8 = s32[1]{0} and(%maximum.47.8, %constant_5001_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.8"}
  %compare.1615.8 = pred[1]{0} compare(%and.301.8, %constant_2102_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.8"}
  %and.302.7 = pred[1]{0} and(%compare.1614.7, %compare.1615.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.7"}
  %constant_5002_4 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.7 = s32[1]{0} shift-right-logical(%maximum.47.8, %constant_5002_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.7"}
  %constant_5003_4 = s32[1]{0} constant({-1})
  %add.2882.7 = s32[1]{0} add(%shift-right-logical.20.7, %constant_5003_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.7"}
  %select.1263.7 = s32[1]{0} select(%and.302.7, %add.2882.7, %shift-right-logical.20.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.7"}
  %compare.1616.7 = pred[1]{0} compare(%select.1263.7, %constant_2102_14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.7"}
  %add.2883.7 = s32[1]{0} add(%select.1263.7, %constant_5002_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.7"}
  %select.1264.7 = s32[1]{0} select(%compare.1616.7, %add.2883.7, %select.1263.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.7"}
  %bitcast.20992.139 = s32[1,1]{1,0} bitcast(%select.1264.7), metadata={scheduling_name="bitcast.20992.139"}
  %concatenate.701.87 = s32[1,5]{1,0} concatenate(%constant_5004_1, %bitcast.20992.139, %constant_5004_1, %constant_5004_1, %constant_5004_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.87"}
  %bitcast.21040.86 = s32[5]{0} bitcast(%concatenate.701.87), metadata={scheduling_name="bitcast.21040.86"}
  %slice.2375.83 = s32[1]{0} slice(%bitcast.21040.86), slice={[1:2]}, metadata={scheduling_name="slice.2375.83"}
  %bitcast.23961.40 = s32[] bitcast(%slice.2375.83), metadata={scheduling_name="bitcast.23961.40"}
  %constant_1627_96 = s32[] constant(0)
  %dynamic-slice.1427.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.23884.2, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1427.1"}
  %param_5.2667 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2667"}
  %dynamic-slice.1428.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_5.2667, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1428.1.clone.1"}
  %param_6.2457 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(6), metadata={scheduling_name="param_6.2457"}
  %bitcast.21033.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_6.2457), metadata={scheduling_name="bitcast.21033.1.clone.1"}
  %dynamic-slice.1380.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.21033.1.clone.1, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1380.1.clone.1"}
  %param_7.2280 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(7), metadata={scheduling_name="param_7.2280"}
  %bitcast.21356.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_7.2280), metadata={scheduling_name="bitcast.21356.1.clone.1"}
  %dynamic-slice.1388.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.21356.1.clone.1, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1388.1.clone.1"}
  %param_8.2132 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2132"}
  %dynamic-slice.1396.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_8.2132, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1396.1.clone.1"}
  %param_9.1870 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1870"}
  %dynamic-slice.1411.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_9.1870, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1411.1.clone.1"}
  %param_10.1498 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(10), metadata={scheduling_name="param_10.1498"}
  %bitcast.23513.2.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_10.1498), metadata={scheduling_name="bitcast.23513.2.clone.1"}
  %dynamic-slice.1417.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.23513.2.clone.1, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1417.1.clone.1"}
  %param_11.1405 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1405"}
  %dynamic-slice.1418.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_11.1405, %bitcast.23961.40, %constant_1627_96, %constant_1627_96, %constant_1627_96, /*index=5*/%constant_1627_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1418.1.clone.1"}
  ROOT %tuple.531 = (bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}) tuple(%dynamic-slice.1427.1, %dynamic-slice.1428.1.clone.1, %dynamic-slice.1380.1.clone.1, %dynamic-slice.1388.1.clone.1, %dynamic-slice.1396.1.clone.1, /*index=5*/%dynamic-slice.1411.1.clone.1, %dynamic-slice.1417.1.clone.1, %dynamic-slice.1418.1.clone.1), metadata={scheduling_name="tuple.531"}
}

%fused_dynamic_update_slice.12 (param_0.2380: bf16[2,1,48,128,768], param_1.2463: bf16[1,1,768,48,128], param_2.1812: bf16[1,768,48,128], param_3.1402: pred[], param_4.1426: s32[16], param_5.1303: u32[], param_6.1257: s32[9], param_7.1183: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.2380 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2380"}
  %bitcast.23513.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2380), metadata={scheduling_name="bitcast.23513.1"}
  %param_1.2463 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2463"}
  %convert.4113.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2463), metadata={scheduling_name="convert.4113.3"}
  %param_3.1402 = pred[] parameter(3), metadata={scheduling_name="param_3.1402"}
  %broadcast.5640.6 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1402), dimensions={}, metadata={scheduling_name="broadcast.5640.6"}
  %param_2.1812 = bf16[1,768,48,128]{3,2,0,1} parameter(2), metadata={scheduling_name="param_2.1812"}
  %bitcast.23536.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1812), metadata={scheduling_name="bitcast.23536.3"}
  %constant_1623_39 = bf16[] constant(0)
  %broadcast.5641.6 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1623_39), dimensions={}, metadata={scheduling_name="broadcast.5641.6"}
  %select.1289.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5640.6, %bitcast.23536.3, %broadcast.5641.6), metadata={scheduling_name="select.1289.3"}
  %bitcast.23542.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1289.3), metadata={scheduling_name="bitcast.23542.7"}
  %convert.4114.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23542.7), metadata={scheduling_name="convert.4114.7"}
  %add.2943.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4113.3, %convert.4114.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2943.5"}
  %convert.4115.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.2943.5), metadata={scheduling_name="convert.4115.3"}
  %constant_5004_30 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1257 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1257"}
  %constant_1624_80 = s32[] constant(8)
  %param_7.1183 = s32[] parameter(7), metadata={scheduling_name="param_7.1183"}
  %subtract.247.117 = s32[] subtract(%constant_1624_80, %param_7.1183), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.117"}
  %dynamic-slice.1376.98 = s32[1]{0} dynamic-slice(%param_6.1257, %subtract.247.117), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.98"}
  %param_4.1426 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1426"}
  %param_5.1303 = u32[] parameter(5), metadata={scheduling_name="param_5.1303"}
  %dynamic-slice.1377.93 = s32[1]{0} dynamic-slice(%param_4.1426, %param_5.1303), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.93"}
  %subtract.248.88 = s32[1]{0} subtract(%dynamic-slice.1376.98, %dynamic-slice.1377.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.88"}
  %constant_2102_52 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.88 = s32[1]{0} maximum(%subtract.248.88, %constant_2102_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.88"}
  %sign.27.87 = s32[1]{0} sign(%maximum.47.88), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.87"}
  %constant_5000_47 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.87 = pred[1]{0} compare(%sign.27.87, %constant_5000_47), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.87"}
  %constant_5001_45 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.88 = s32[1]{0} and(%maximum.47.88, %constant_5001_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.88"}
  %compare.1615.88 = pred[1]{0} compare(%and.301.88, %constant_2102_52), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.88"}
  %and.302.87 = pred[1]{0} and(%compare.1614.87, %compare.1615.88), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.87"}
  %constant_5002_44 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.87 = s32[1]{0} shift-right-logical(%maximum.47.88, %constant_5002_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.87"}
  %constant_5003_44 = s32[1]{0} constant({-1})
  %add.2882.87 = s32[1]{0} add(%shift-right-logical.20.87, %constant_5003_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.87"}
  %select.1263.87 = s32[1]{0} select(%and.302.87, %add.2882.87, %shift-right-logical.20.87), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.87"}
  %compare.1616.87 = pred[1]{0} compare(%select.1263.87, %constant_2102_52), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.87"}
  %add.2883.87 = s32[1]{0} add(%select.1263.87, %constant_5002_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.87"}
  %select.1264.87 = s32[1]{0} select(%compare.1616.87, %add.2883.87, %select.1263.87), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.87"}
  %bitcast.20992.97 = s32[1,1]{1,0} bitcast(%select.1264.87), metadata={scheduling_name="bitcast.20992.97"}
  %concatenate.701.45 = s32[1,5]{1,0} concatenate(%constant_5004_30, %bitcast.20992.97, %constant_5004_30, %constant_5004_30, %constant_5004_30), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.45"}
  %bitcast.21040.44 = s32[5]{0} bitcast(%concatenate.701.45), metadata={scheduling_name="bitcast.21040.44"}
  %slice.2375.41 = s32[1]{0} slice(%bitcast.21040.44), slice={[1:2]}, metadata={scheduling_name="slice.2375.41"}
  %bitcast.23961.19 = s32[] bitcast(%slice.2375.41), metadata={scheduling_name="bitcast.23961.19"}
  %constant_1627_47 = s32[] constant(0)
  ROOT %dynamic-update-slice.401.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%bitcast.23513.1, %convert.4115.3, %bitcast.23961.19, %constant_1627_47, %constant_1627_47, /*index=5*/%constant_1627_47, %constant_1627_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.401.1"}
}

%fused_reduce.5 (param_0.2390: bf16[4,8192,6144], param_1.2526: bf16[32768,6144], param_2.1873: bf16[2,1,6144], param_3.1640: s32[16], param_4.1393: u32[], param_5.1295: s32[9], param_6.1249: s32[]) -> f32[4,8192] {
  %param_1.2526 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2526"}
  %bitcast.21065.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.2526), metadata={scheduling_name="bitcast.21065.23"}
  %convert.3885.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21065.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3885.23"}
  %param_0.2390 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2390"}
  %bitcast.23031.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2390), metadata={scheduling_name="bitcast.23031.17"}
  %convert.4044.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23031.17), metadata={scheduling_name="convert.4044.17"}
  %param_2.1873 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1873"}
  %param_5.1295 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1295"}
  %constant_1624_103 = s32[] constant(8)
  %param_6.1249 = s32[] parameter(6), metadata={scheduling_name="param_6.1249"}
  %subtract.247.181 = s32[] subtract(%constant_1624_103, %param_6.1249), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.181"}
  %dynamic-slice.1376.162 = s32[1]{0} dynamic-slice(%param_5.1295, %subtract.247.181), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.162"}
  %param_3.1640 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.1640"}
  %param_4.1393 = u32[] parameter(4), metadata={scheduling_name="param_4.1393"}
  %dynamic-slice.1377.157 = s32[1]{0} dynamic-slice(%param_3.1640, %param_4.1393), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.157"}
  %subtract.248.152 = s32[1]{0} subtract(%dynamic-slice.1376.162, %dynamic-slice.1377.157), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.152"}
  %constant_2102_79 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.152 = s32[1]{0} maximum(%subtract.248.152, %constant_2102_79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.152"}
  %sign.27.147 = s32[1]{0} sign(%maximum.47.152), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.147"}
  %constant_5000_73 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.147 = pred[1]{0} compare(%sign.27.147, %constant_5000_73), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.147"}
  %constant_5001_72 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.152 = s32[1]{0} and(%maximum.47.152, %constant_5001_72), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.152"}
  %compare.1615.152 = pred[1]{0} compare(%and.301.152, %constant_2102_79), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.152"}
  %and.302.147 = pred[1]{0} and(%compare.1614.147, %compare.1615.152), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.147"}
  %constant_5002_70 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.147 = s32[1]{0} shift-right-logical(%maximum.47.152, %constant_5002_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.147"}
  %constant_5003_70 = s32[1]{0} constant({-1})
  %add.2882.147 = s32[1]{0} add(%shift-right-logical.20.147, %constant_5003_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.147"}
  %select.1263.147 = s32[1]{0} select(%and.302.147, %add.2882.147, %shift-right-logical.20.147), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.147"}
  %compare.1616.147 = pred[1]{0} compare(%select.1263.147, %constant_2102_79), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.147"}
  %add.2883.147 = s32[1]{0} add(%select.1263.147, %constant_5002_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.147"}
  %select.1264.147 = s32[1]{0} select(%compare.1616.147, %add.2883.147, %select.1263.147), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.147"}
  %bitcast.20992.161 = s32[1,1]{1,0} bitcast(%select.1264.147), metadata={scheduling_name="bitcast.20992.161"}
  %constant_1627_92 = s32[] constant(0)
  %pad.345.53 = s32[1,2]{1,0} pad(%bitcast.20992.161, %constant_1627_92), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.53"}
  %pad.346.51 = s32[1,3]{1,0} pad(%pad.345.53, %constant_1627_92), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.51"}
  %bitcast.21099.48 = s32[3]{0} bitcast(%pad.346.51), metadata={scheduling_name="bitcast.21099.48"}
  %slice.2376.43 = s32[1]{0} slice(%bitcast.21099.48), slice={[1:2]}, metadata={scheduling_name="slice.2376.43"}
  %bitcast.23800.30 = s32[] bitcast(%slice.2376.43), metadata={scheduling_name="bitcast.23800.30"}
  %dynamic-slice.1382.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1873, %bitcast.23800.30, %constant_1627_92, %constant_1627_92), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1382.3"}
  %bitcast.21105.10 = bf16[6144]{0} bitcast(%dynamic-slice.1382.3), metadata={scheduling_name="bitcast.21105.10"}
  %convert.4975.7 = f32[6144]{0} convert(%bitcast.21105.10), metadata={scheduling_name="convert.4975.7"}
  %broadcast.5984.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4975.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5984.14"}
  %multiply.2645.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4044.17, %broadcast.5984.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2645.11"}
  %multiply.2647.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3885.23, %multiply.2645.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2647.3"}
  %bitcast.23293.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2647.3), metadata={scheduling_name="bitcast.23293.1"}
  %constant_1651_2 = f32[] constant(0)
  ROOT %reduce.422.1 = f32[4,8192]{1,0} reduce(%bitcast.23293.1, %constant_1651_2), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.422.1"}
}

%fused_dynamic_slice.17 (param_0.2379: f32[9,1,4,48,8192,1], param_1.2462: s32[]) -> f32[1,1,1,4,48,8192] {
  %param_0.2379 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(0), metadata={scheduling_name="param_0.2379"}
  %bitcast.23251.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_0.2379), metadata={scheduling_name="bitcast.23251.1"}
  %constant_1624_9 = s32[] constant(8)
  %param_1.2462 = s32[] parameter(1), metadata={scheduling_name="param_1.2462"}
  %subtract.247.2 = s32[] subtract(%constant_1624_9, %param_1.2462), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.2"}
  %constant_1627_46 = s32[] constant(0)
  ROOT %dynamic-slice.1414.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-slice(%bitcast.23251.1, %subtract.247.2, %constant_1627_46, %constant_1627_46, %constant_1627_46, /*index=5*/%constant_1627_46, %constant_1627_46), dynamic_slice_sizes={1,1,1,4,48,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1414.1"}
}

%fused_rsqrt.4 (param_0.2397: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2397 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2397"}
  %bitcast.23092.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2397), metadata={scheduling_name="bitcast.23092.7"}
  %constant_1652_1 = f32[] constant(0.000162760422)
  %broadcast.5527.16 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_1), dimensions={}, metadata={scheduling_name="broadcast.5527.16"}
  %multiply.2634.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.23092.7, %broadcast.5527.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2634.7"}
  %constant_1653_1 = f32[] constant(1e-05)
  %broadcast.5528.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_1), dimensions={}, metadata={scheduling_name="broadcast.5528.8"}
  %add.2931.5 = f32[1,4,8192]{2,1,0} add(%multiply.2634.7, %broadcast.5528.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2931.5"}
  %bitcast.23102.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2931.5), metadata={scheduling_name="bitcast.23102.1"}
  ROOT %rsqrt.98.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.23102.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.98.1"}
}

%fused_reduce.6 (param_0.2389: bf16[9,1,4,8192,6144], param_1.2525: s32[]) -> f32[4,8192] {
  %param_0.2389 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2389"}
  %constant_1624_26 = s32[] constant(8)
  %param_1.2525 = s32[] parameter(1), metadata={scheduling_name="param_1.2525"}
  %subtract.247.19 = s32[] subtract(%constant_1624_26, %param_1.2525), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.19"}
  %constant_1627_23 = s32[] constant(0)
  %dynamic-slice.1381.4 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2389, %subtract.247.19, %constant_1627_23, %constant_1627_23, %constant_1627_23, /*index=5*/%constant_1627_23), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1381.4"}
  %bitcast.23080.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1381.4), metadata={scheduling_name="bitcast.23080.21"}
  %convert.4053.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23080.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4053.21"}
  %multiply.2633.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4053.21, %convert.4053.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2633.3"}
  %bitcast.23087.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2633.3), metadata={scheduling_name="bitcast.23087.1"}
  %constant_1651_1 = f32[] constant(0)
  ROOT %reduce.421.1 = f32[4,8192]{1,0} reduce(%bitcast.23087.1, %constant_1651_1), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.421.1"}
}

%fused_transpose.6 (param_0.117: bf16[1,8,4,1,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.117 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.117"}
  %bitcast.23014.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.117), metadata={scheduling_name="bitcast.23014.1"}
  ROOT %transpose.760.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.23014.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.760.1"}
}

%fused_transpose.7 (param_0.127: bf16[1,4,6144,8,1,2048]) -> bf16[32,2048,6144] {
  %param_0.127 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.127"}
  %bitcast.22839.1 = bf16[32,6144,2048]{2,1,0} bitcast(%param_0.127), metadata={scheduling_name="bitcast.22839.1"}
  ROOT %transpose.758.1 = bf16[32,2048,6144]{2,1,0} transpose(%bitcast.22839.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.758.1"}
}

%fused_transpose.8 (param_0.129: bf16[4,6144,16384]) -> bf16[8,24576,2048] {
  %param_0.129 = bf16[4,6144,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.129"}
  %bitcast.22832.1 = bf16[24576,8,2048]{2,1,0} bitcast(%param_0.129), metadata={scheduling_name="bitcast.22832.1"}
  ROOT %transpose.757.1 = bf16[8,24576,2048]{2,1,0} transpose(%bitcast.22832.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.757.1"}
}

%fused_scatter.4 (param_0.135: bf16[1,4,8192,8], param_1.54: s32[65536,4], param_2.1740: bf16[1,4,8192,2], param_3.1481: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.135 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.135"}
  %param_1.54 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.54"}
  %param_2.1740 = bf16[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1740"}
  %convert.4023.16 = f32[1,4,8192,2]{3,2,1,0} convert(%param_2.1740), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4023.16"}
  %param_3.1481 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1481"}
  %bitcast.22438.13 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1481), metadata={scheduling_name="bitcast.22438.13"}
  %constant_1826_3 = f32[] constant(-inf)
  %reduce.165.1 = f32[32768]{0} reduce(%param_3.1481, %constant_1826_3), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.165.1"}
  %bitcast.22446.13 = f32[4,8192]{1,0} bitcast(%reduce.165.1), metadata={scheduling_name="bitcast.22446.13"}
  %broadcast.5600.13 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22446.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5600.13"}
  %subtract.255.13 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.22438.13, %broadcast.5600.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.255.13"}
  %exponential.95.11 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.255.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.95.11"}
  %bitcast.22454.5 = f32[4,8192,2]{2,1,0} bitcast(%exponential.95.11), metadata={scheduling_name="bitcast.22454.5"}
  %constant_1651_12 = f32[] constant(0)
  %reduce.415.5 = f32[4,8192]{1,0} reduce(%bitcast.22454.5, %constant_1651_12), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.415.5"}
  %broadcast.5601.16 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.415.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5601.16"}
  %divide.468.9 = f32[1,4,8192,2]{3,2,1,0} divide(%convert.4023.16, %broadcast.5601.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.468.9"}
  %constant_1990_1 = f32[] constant(1)
  %broadcast.5576.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_1990_1), dimensions={}, metadata={scheduling_name="broadcast.5576.14"}
  %bitcast.22738.5 = f32[1,4,8192]{2,1,0} bitcast(%reduce.415.5), metadata={scheduling_name="bitcast.22738.5"}
  %multiply.2622.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22738.5, %bitcast.22738.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2622.5"}
  %divide.469.7 = f32[1,4,8192]{2,1,0} divide(%broadcast.5576.14, %multiply.2622.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.469.7"}
  %bitcast.22742.7 = f32[4,8192]{1,0} bitcast(%divide.469.7), metadata={scheduling_name="bitcast.22742.7"}
  %broadcast.5617.7 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22742.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5617.7"}
  %multiply.2623.9 = f32[1,4,8192,2]{3,2,1,0} multiply(%convert.4023.16, %broadcast.5617.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2623.9"}
  %multiply.2624.7 = f32[1,4,8192,2]{3,2,1,0} multiply(%multiply.2623.9, %exponential.95.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2624.7"}
  %bitcast.22750.5 = f32[4,8192,2]{2,1,0} bitcast(%multiply.2624.7), metadata={scheduling_name="bitcast.22750.5"}
  %reduce.419.5 = f32[4,8192]{1,0} reduce(%bitcast.22750.5, %constant_1651_12), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.419.5"}
  %bitcast.22755.3 = f32[1,4,8192]{2,1,0} bitcast(%reduce.419.5), metadata={scheduling_name="bitcast.22755.3"}
  %negate.219.3 = f32[1,4,8192]{2,1,0} negate(%bitcast.22755.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="negate.219.3"}
  %bitcast.22758.5 = f32[4,8192]{1,0} bitcast(%negate.219.3), metadata={scheduling_name="bitcast.22758.5"}
  %broadcast.5618.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22758.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5618.5"}
  %add.2924.7 = f32[1,4,8192,2]{3,2,1,0} add(%divide.468.9, %broadcast.5618.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="add.2924.7"}
  %multiply.2625.5 = f32[1,4,8192,2]{3,2,1,0} multiply(%add.2924.7, %exponential.95.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2625.5"}
  %convert.4024.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%multiply.2625.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4024.3"}
  %bitcast.22764.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%convert.4024.3), metadata={scheduling_name="bitcast.22764.1"}
  ROOT %scatter.216.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.135, %param_1.54, %bitcast.22764.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="scatter.216.1"}
}

%fused_transpose.9 (param_0.2366: bf16[4,8192,16384]) -> bf16[4,16392,8192] {
  %param_0.2366 = bf16[4,8192,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2366"}
  %bitcast.22682.3 = bf16[1,4,8192,8,2048]{4,3,2,1,0} bitcast(%param_0.2366), metadata={scheduling_name="bitcast.22682.3"}
  %constant_1623_8 = bf16[] constant(0)
  %pad.354.3 = bf16[1,4,8192,8,2049]{4,3,2,1,0} pad(%bitcast.22682.3, %constant_1623_8), padding=0_0x0_0x0_0x0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="pad.354.3"}
  %bitcast.22685.1 = bf16[4,8192,16392]{2,1,0} bitcast(%pad.354.3), metadata={scheduling_name="bitcast.22685.1"}
  ROOT %transpose.755.1 = bf16[4,16392,8192]{2,1,0} transpose(%bitcast.22685.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.755.1"}
}

%fused_transpose.10 (param_0.158: bf16[1,1,8,4,2048,6144]) -> bf16[4,6144,8,2048] {
  %param_0.158 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.158"}
  %bitcast.22675.1 = bf16[8,4,2048,6144]{3,2,1,0} bitcast(%param_0.158), metadata={scheduling_name="bitcast.22675.1"}
  ROOT %transpose.754.1 = bf16[4,6144,8,2048]{3,2,1,0} transpose(%bitcast.22675.1), dimensions={1,3,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.754.1"}
}

%fused_transpose.11 (param_0.164: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.164 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.164"}
  %bitcast.22601.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.164), metadata={scheduling_name="bitcast.22601.1"}
  ROOT %transpose.753.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.22601.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.753.1"}
}

%fused_multiply_transpose.2 (param_0.181: s32[4,8,8192], param_1.67: s32[4,8,8192], param_2.4715: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.181 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.181"}
  %bitcast.22571.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.181), metadata={scheduling_name="bitcast.22571.1"}
  %param_1.67 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.67"}
  %bitcast.22549.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.67), metadata={scheduling_name="bitcast.22549.2"}
  %multiply.2616.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.22571.1, %bitcast.22549.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2616.1"}
  %param_2.4715 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4715"}
  %bitcast.22469.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4715), metadata={scheduling_name="bitcast.22469.3.clone.1"}
  %transpose.752.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.22469.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.752.3.clone.1"}
  %bitcast.22472.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.752.3.clone.1), metadata={scheduling_name="bitcast.22472.5.clone.1"}
  %convert.3997.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22472.5.clone.1), metadata={scheduling_name="convert.3997.5.clone.1"}
  %convert.3999.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22549.2), metadata={scheduling_name="convert.3999.3.clone.1"}
  %multiply.2614.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3997.5.clone.1, %convert.3999.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2614.3.clone.1"}
  %convert.4000.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2614.3.clone.1), metadata={scheduling_name="convert.4000.1.clone.1"}
  ROOT %tuple.499 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2616.1, %convert.4000.1.clone.1), metadata={scheduling_name="tuple.499"}
}

%fused_reduce.7 (param_0.2372: pred[1,4,8,8192,2], param_1.2541: s32[1,4,8,64,16], param_2.1884: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.2372 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2372"}
  %convert.3998.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2372), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3998.17"}
  %bitcast.22483.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3998.17), metadata={scheduling_name="bitcast.22483.11"}
  %constant_1627_13 = s32[] constant(0)
  %reduce-window.164.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.22483.11, %constant_1627_13), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.164.11"}
  %param_1.2541 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2541"}
  %param_2.1884 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1884"}
  %slice.2398.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.1884), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2398.7"}
  %bitcast.22507.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2398.7), metadata={scheduling_name="bitcast.22507.9"}
  %reduce-window.167.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.22507.9, %constant_1627_13), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.167.9"}
  %slice.2399.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.167.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2399.7"}
  %bitcast.22513.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2399.7), metadata={scheduling_name="bitcast.22513.9"}
  %broadcast.5604.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.22513.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5604.9"}
  %add.2920.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.1884, %broadcast.5604.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2920.7"}
  %bitcast.22517.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.2920.7), metadata={scheduling_name="bitcast.22517.7"}
  %pad.352.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.22517.7, %constant_1627_13), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.352.7"}
  %slice.2400.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.352.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2400.5"}
  %bitcast.22521.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2400.5), metadata={scheduling_name="bitcast.22521.9"}
  %broadcast.5605.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.22521.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5605.9"}
  %add.2921.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.2541, %broadcast.5605.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2921.7"}
  %bitcast.22525.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.2921.7), metadata={scheduling_name="bitcast.22525.5"}
  %pad.353.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.22525.5, %constant_1627_13), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.353.5"}
  %slice.2401.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.353.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2401.1"}
  %bitcast.22529.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2401.1), metadata={scheduling_name="bitcast.22529.9"}
  %broadcast.5606.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.22529.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5606.9"}
  %add.2922.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.164.11, %broadcast.5606.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2922.7"}
  %bitcast.22533.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.2922.7), metadata={scheduling_name="bitcast.22533.6"}
  %constant_1848_1 = s32[] constant(2048)
  %broadcast.5562.6 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_1848_1), dimensions={}, metadata={scheduling_name="broadcast.5562.6"}
  %compare.1639.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.22533.6, %broadcast.5562.6), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1639.3"}
  %bitcast.22539.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1639.3), metadata={scheduling_name="bitcast.22539.3"}
  %broadcast.5563.6 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_1627_13), dimensions={}, metadata={scheduling_name="broadcast.5563.6"}
  %select.1279.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.22539.3, %convert.3998.17, %broadcast.5563.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1279.3"}
  %bitcast.22546.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1279.3), metadata={scheduling_name="bitcast.22546.1"}
  %reduce.502.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.22546.1, %constant_1627_13), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.502.1"}
  %bitcast.22560.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.3998.17), metadata={scheduling_name="bitcast.22560.3.clone.1"}
  %multiply.2615.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.22560.3.clone.1, %bitcast.22533.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2615.3.clone.1"}
  %bitcast.22566.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2615.3.clone.1), metadata={scheduling_name="bitcast.22566.1.clone.1"}
  %reduce.503.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.22566.1.clone.1, %constant_1627_13), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.503.1.clone.1"}
  ROOT %tuple.500 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.502.1, %reduce.503.1.clone.1), metadata={scheduling_name="tuple.500"}
}

%fused_reduce_window.4 (param_0.2383: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.2383 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2383"}
  %slice.2397.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.2383), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2397.1"}
  %bitcast.22499.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2397.1), metadata={scheduling_name="bitcast.22499.1"}
  %constant_1627_78 = s32[] constant(0)
  ROOT %reduce-window.166.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.22499.1, %constant_1627_78), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.166.1"}
}

%fused_reduce_window.5 (param_0.2373: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.2373 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2373"}
  %bitcast.22491.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.2373), metadata={scheduling_name="bitcast.22491.1"}
  %constant_1627_24 = s32[] constant(0)
  ROOT %reduce-window.165.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.22491.1, %constant_1627_24), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.165.1"}
}

%fused_scatter.5 (param_0.213: bf16[1,4,8192,8], param_1.87: s32[65536,4], param_2.1183: pred[1,4,8192,2], param_3.1364: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.213 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.213"}
  %param_1.87 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.87"}
  %param_2.1183 = pred[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1183"}
  %param_3.1364 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1364"}
  %bitcast.22438.5 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1364), metadata={scheduling_name="bitcast.22438.5"}
  %constant_1826_1 = f32[] constant(-inf)
  %reduce.165.2 = f32[32768]{0} reduce(%param_3.1364, %constant_1826_1), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.165.2"}
  %bitcast.22446.5 = f32[4,8192]{1,0} bitcast(%reduce.165.2), metadata={scheduling_name="bitcast.22446.5"}
  %broadcast.5600.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22446.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5600.5"}
  %subtract.255.5 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.22438.5, %broadcast.5600.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.255.5"}
  %exponential.95.3 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.255.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.95.3"}
  %bitcast.22454.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.95.3), metadata={scheduling_name="bitcast.22454.3"}
  %constant_1651_11 = f32[] constant(0)
  %reduce.415.3 = f32[4,8192]{1,0} reduce(%bitcast.22454.3, %constant_1651_11), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.415.3"}
  %broadcast.5601.14 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.415.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5601.14"}
  %divide.466.7 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.95.3, %broadcast.5601.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.466.7"}
  %convert.3996.5 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.466.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3996.5"}
  %constant_1623_46 = bf16[] constant(0)
  %broadcast.5557.12 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1623_46), dimensions={}, metadata={scheduling_name="broadcast.5557.12"}
  %select.1278.3 = bf16[1,4,8192,2]{3,2,1,0} select(%param_2.1183, %convert.3996.5, %broadcast.5557.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1278.3"}
  %bitcast.22466.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1278.3), metadata={scheduling_name="bitcast.22466.1"}
  ROOT %scatter.215.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.213, %param_1.87, %bitcast.22466.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.215.1"}
}

%fused_convert_reduce.1 (param_0.6064: bf16[9,1,4,8192,6144], param_1.6455: s32[], param_2.4665: bf16[2,1,6144], param_3.3843: s32[16], param_4.2813: u32[], param_5.2578: s32[9], param_6.2332: bf16[32768,6144], param_7.2155: bf16[32768,6144], param_8.2042: bf16[2,1,6144], param_9.1755: f32[1,1,4,8192], param_10.1360: bf16[32768,6144]) -> (f32[4,8192], bf16[32768,6144], bf16[1,4,8192,6144]) {
  %param_0.6064 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6064"}
  %constant_1624_19 = s32[] constant(8)
  %param_1.6455 = s32[] parameter(1), metadata={scheduling_name="param_1.6455"}
  %subtract.247.12 = s32[] subtract(%constant_1624_19, %param_1.6455), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.12"}
  %constant_1627_9 = s32[] constant(0)
  %dynamic-slice.1389.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.6064, %subtract.247.12, %constant_1627_9, %constant_1627_9, %constant_1627_9, /*index=5*/%constant_1627_9), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1389.3"}
  %bitcast.22017.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1389.3), metadata={scheduling_name="bitcast.22017.23"}
  %convert.3942.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22017.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3942.23"}
  %param_7.2155 = bf16[32768,6144]{1,0} parameter(7), metadata={scheduling_name="param_7.2155"}
  %convert.3980.1.clone.1 = f32[32768,6144]{1,0} convert(%param_7.2155), metadata={scheduling_name="convert.3980.1.clone.1"}
  %param_6.2332 = bf16[32768,6144]{1,0} parameter(6), metadata={scheduling_name="param_6.2332"}
  %convert.3991.1.clone.1 = f32[32768,6144]{1,0} convert(%param_6.2332), metadata={scheduling_name="convert.3991.1.clone.1"}
  %add.2917.1.clone.1 = f32[32768,6144]{1,0} add(%convert.3980.1.clone.1, %convert.3991.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/attentions.py" source_line=838 scheduling_name="add.2917.1.clone.1"}
  %convert.3992.1.clone.1 = bf16[32768,6144]{1,0} convert(%add.2917.1.clone.1), metadata={scheduling_name="convert.3992.1.clone.1"}
  %bitcast.22383.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%convert.3992.1.clone.1), metadata={scheduling_name="bitcast.22383.17"}
  %convert.3993.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22383.17), metadata={scheduling_name="convert.3993.17"}
  %param_2.4665 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4665"}
  %param_5.2578 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2578"}
  %dynamic-slice.1376.178 = s32[1]{0} dynamic-slice(%param_5.2578, %subtract.247.12), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.178"}
  %param_3.3843 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.3843"}
  %param_4.2813 = u32[] parameter(4), metadata={scheduling_name="param_4.2813"}
  %dynamic-slice.1377.173 = s32[1]{0} dynamic-slice(%param_3.3843, %param_4.2813), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.173"}
  %subtract.248.168 = s32[1]{0} subtract(%dynamic-slice.1376.178, %dynamic-slice.1377.173), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.168"}
  %constant_2102_24 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.168 = s32[1]{0} maximum(%subtract.248.168, %constant_2102_24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.168"}
  %sign.27.163 = s32[1]{0} sign(%maximum.47.168), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.163"}
  %constant_5000_18 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.163 = pred[1]{0} compare(%sign.27.163, %constant_5000_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.163"}
  %constant_5001_16 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.168 = s32[1]{0} and(%maximum.47.168, %constant_5001_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.168"}
  %compare.1615.168 = pred[1]{0} compare(%and.301.168, %constant_2102_24), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.168"}
  %and.302.163 = pred[1]{0} and(%compare.1614.163, %compare.1615.168), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.163"}
  %constant_5002_15 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.163 = s32[1]{0} shift-right-logical(%maximum.47.168, %constant_5002_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.163"}
  %constant_5003_15 = s32[1]{0} constant({-1})
  %add.2882.163 = s32[1]{0} add(%shift-right-logical.20.163, %constant_5003_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.163"}
  %select.1263.163 = s32[1]{0} select(%and.302.163, %add.2882.163, %shift-right-logical.20.163), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.163"}
  %compare.1616.163 = pred[1]{0} compare(%select.1263.163, %constant_2102_24), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.163"}
  %add.2883.163 = s32[1]{0} add(%select.1263.163, %constant_5002_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.163"}
  %select.1264.163 = s32[1]{0} select(%compare.1616.163, %add.2883.163, %select.1263.163), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.163"}
  %bitcast.20992.177 = s32[1,1]{1,0} bitcast(%select.1264.163), metadata={scheduling_name="bitcast.20992.177"}
  %pad.345.69 = s32[1,2]{1,0} pad(%bitcast.20992.177, %constant_1627_9), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.69"}
  %pad.346.67 = s32[1,3]{1,0} pad(%pad.345.69, %constant_1627_9), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.67"}
  %bitcast.21099.64 = s32[3]{0} bitcast(%pad.346.67), metadata={scheduling_name="bitcast.21099.64"}
  %slice.2376.59 = s32[1]{0} slice(%bitcast.21099.64), slice={[1:2]}, metadata={scheduling_name="slice.2376.59"}
  %bitcast.23800.46 = s32[] bitcast(%slice.2376.59), metadata={scheduling_name="bitcast.23800.46"}
  %dynamic-slice.1395.11 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4665, %bitcast.23800.46, %constant_1627_9, %constant_1627_9), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1395.11"}
  %bitcast.22053.10 = bf16[6144]{0} bitcast(%dynamic-slice.1395.11), metadata={scheduling_name="bitcast.22053.10"}
  %convert.4982.7 = f32[6144]{0} convert(%bitcast.22053.10), metadata={scheduling_name="convert.4982.7"}
  %broadcast.5995.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4982.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5995.14"}
  %multiply.2607.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3993.17, %broadcast.5995.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2607.11"}
  %multiply.2609.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.23, %multiply.2607.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2609.3"}
  %bitcast.22399.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2609.3), metadata={scheduling_name="bitcast.22399.1"}
  %constant_1651_10 = f32[] constant(0)
  %reduce.414.1 = f32[4,8192]{1,0} reduce(%bitcast.22399.1, %constant_1651_10), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.414.1"}
  %param_10.1360 = bf16[32768,6144]{1,0} parameter(10), metadata={scheduling_name="param_10.1360"}
  %bitcast.21065.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_10.1360), metadata={scheduling_name="bitcast.21065.15.clone.1"}
  %convert.3885.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21065.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3885.15.clone.1"}
  %param_9.1755 = f32[1,1,4,8192]{3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1755"}
  %bitcast.21087.13.clone.1 = f32[4,8192]{1,0} bitcast(%param_9.1755), metadata={scheduling_name="bitcast.21087.13.clone.1"}
  %broadcast.5529.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21087.13.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5529.13.clone.1"}
  %multiply.2548.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3885.15.clone.1, %broadcast.5529.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2548.7.clone.1"}
  %param_8.2042 = bf16[2,1,6144]{2,1,0} parameter(8), metadata={scheduling_name="param_8.2042"}
  %dynamic-slice.1382.9.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_8.2042, %bitcast.23800.46, %constant_1627_9, %constant_1627_9), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1382.9.clone.1"}
  %bitcast.21105.8.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1382.9.clone.1), metadata={scheduling_name="bitcast.21105.8.clone.1"}
  %convert.4975.5.clone.1 = f32[6144]{0} convert(%bitcast.21105.8.clone.1), metadata={scheduling_name="convert.4975.5.clone.1"}
  %broadcast.5984.10.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4975.5.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5984.10.clone.1"}
  %multiply.2549.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2548.7.clone.1, %broadcast.5984.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2549.3.clone.1"}
  %convert.3887.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2549.3.clone.1), metadata={scheduling_name="convert.3887.1.clone.1"}
  ROOT %tuple.506 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%reduce.414.1, %convert.3992.1.clone.1, %convert.3887.1.clone.1), metadata={scheduling_name="tuple.506"}
}

%fused_dynamic_slice.18 (param_0.2387: f32[9,1,4,48,8192,1], param_1.2516: s32[]) -> f32[1,1,1,4,48,8192] {
  %param_0.2387 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(0), metadata={scheduling_name="param_0.2387"}
  %bitcast.22241.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_0.2387), metadata={scheduling_name="bitcast.22241.1"}
  %constant_1624_16 = s32[] constant(8)
  %param_1.2516 = s32[] parameter(1), metadata={scheduling_name="param_1.2516"}
  %subtract.247.9 = s32[] subtract(%constant_1624_16, %param_1.2516), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.9"}
  %constant_1627_107 = s32[] constant(0)
  ROOT %dynamic-slice.1400.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-slice(%bitcast.22241.1, %subtract.247.9, %constant_1627_107, %constant_1627_107, %constant_1627_107, /*index=5*/%constant_1627_107, %constant_1627_107), dynamic_slice_sizes={1,1,1,4,48,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1400.1"}
}

%fused_rsqrt.5 (param_0.2400: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2400 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2400"}
  %bitcast.22029.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2400), metadata={scheduling_name="bitcast.22029.7"}
  %constant_1652_4 = f32[] constant(0.000162760422)
  %broadcast.5527.20 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_4), dimensions={}, metadata={scheduling_name="broadcast.5527.20"}
  %multiply.2585.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22029.7, %broadcast.5527.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2585.7"}
  %constant_1653_4 = f32[] constant(1e-05)
  %broadcast.5528.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_4), dimensions={}, metadata={scheduling_name="broadcast.5528.12"}
  %add.2908.5 = f32[1,4,8192]{2,1,0} add(%multiply.2585.7, %broadcast.5528.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2908.5"}
  %bitcast.22039.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2908.5), metadata={scheduling_name="bitcast.22039.1"}
  ROOT %rsqrt.97.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.22039.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.97.1"}
}

%fused_reduce.8 (param_0.2395: bf16[9,1,4,8192,6144], param_1.2529: s32[]) -> f32[4,8192] {
  %param_0.2395 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2395"}
  %constant_1624_20 = s32[] constant(8)
  %param_1.2529 = s32[] parameter(1), metadata={scheduling_name="param_1.2529"}
  %subtract.247.13 = s32[] subtract(%constant_1624_20, %param_1.2529), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.13"}
  %constant_1627_6 = s32[] constant(0)
  %dynamic-slice.1389.4 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2395, %subtract.247.13, %constant_1627_6, %constant_1627_6, %constant_1627_6, /*index=5*/%constant_1627_6), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1389.4"}
  %bitcast.22017.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1389.4), metadata={scheduling_name="bitcast.22017.21"}
  %convert.3942.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22017.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3942.21"}
  %multiply.2584.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.21, %convert.3942.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2584.3"}
  %bitcast.22024.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2584.3), metadata={scheduling_name="bitcast.22024.1"}
  %constant_1651_9 = f32[] constant(0)
  ROOT %reduce.413.1 = f32[4,8192]{1,0} reduce(%bitcast.22024.1, %constant_1651_9), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.413.1"}
}

%fused_reduce.9 (param_0.2394: bf16[4,8192,6144], param_1.2528: bf16[32768,6144], param_2.1875: bf16[2,1,6144], param_3.1638: s32[16], param_4.1391: u32[], param_5.1294: s32[9], param_6.1248: s32[]) -> f32[4,8192] {
  %param_1.2528 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2528"}
  %bitcast.21380.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.2528), metadata={scheduling_name="bitcast.21380.23"}
  %convert.3897.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21380.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3897.23"}
  %param_0.2394 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2394"}
  %bitcast.21974.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2394), metadata={scheduling_name="bitcast.21974.17"}
  %convert.3940.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21974.17), metadata={scheduling_name="convert.3940.17"}
  %param_2.1875 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1875"}
  %param_5.1294 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1294"}
  %constant_1624_101 = s32[] constant(8)
  %param_6.1248 = s32[] parameter(6), metadata={scheduling_name="param_6.1248"}
  %subtract.247.173 = s32[] subtract(%constant_1624_101, %param_6.1248), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.173"}
  %dynamic-slice.1376.154 = s32[1]{0} dynamic-slice(%param_5.1294, %subtract.247.173), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.154"}
  %param_3.1638 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.1638"}
  %param_4.1391 = u32[] parameter(4), metadata={scheduling_name="param_4.1391"}
  %dynamic-slice.1377.149 = s32[1]{0} dynamic-slice(%param_3.1638, %param_4.1391), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.149"}
  %subtract.248.144 = s32[1]{0} subtract(%dynamic-slice.1376.154, %dynamic-slice.1377.149), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.144"}
  %constant_2102_76 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.144 = s32[1]{0} maximum(%subtract.248.144, %constant_2102_76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.144"}
  %sign.27.139 = s32[1]{0} sign(%maximum.47.144), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.139"}
  %constant_5000_70 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.139 = pred[1]{0} compare(%sign.27.139, %constant_5000_70), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.139"}
  %constant_5001_69 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.144 = s32[1]{0} and(%maximum.47.144, %constant_5001_69), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.144"}
  %compare.1615.144 = pred[1]{0} compare(%and.301.144, %constant_2102_76), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.144"}
  %and.302.139 = pred[1]{0} and(%compare.1614.139, %compare.1615.144), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.139"}
  %constant_5002_67 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.139 = s32[1]{0} shift-right-logical(%maximum.47.144, %constant_5002_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.139"}
  %constant_5003_67 = s32[1]{0} constant({-1})
  %add.2882.139 = s32[1]{0} add(%shift-right-logical.20.139, %constant_5003_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.139"}
  %select.1263.139 = s32[1]{0} select(%and.302.139, %add.2882.139, %shift-right-logical.20.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.139"}
  %compare.1616.139 = pred[1]{0} compare(%select.1263.139, %constant_2102_76), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.139"}
  %add.2883.139 = s32[1]{0} add(%select.1263.139, %constant_5002_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.139"}
  %select.1264.139 = s32[1]{0} select(%compare.1616.139, %add.2883.139, %select.1263.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.139"}
  %bitcast.20992.153 = s32[1,1]{1,0} bitcast(%select.1264.139), metadata={scheduling_name="bitcast.20992.153"}
  %constant_1627_114 = s32[] constant(0)
  %pad.345.45 = s32[1,2]{1,0} pad(%bitcast.20992.153, %constant_1627_114), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.45"}
  %pad.346.43 = s32[1,3]{1,0} pad(%pad.345.45, %constant_1627_114), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.43"}
  %bitcast.21099.40 = s32[3]{0} bitcast(%pad.346.43), metadata={scheduling_name="bitcast.21099.40"}
  %slice.2376.35 = s32[1]{0} slice(%bitcast.21099.40), slice={[1:2]}, metadata={scheduling_name="slice.2376.35"}
  %bitcast.23800.22 = s32[] bitcast(%slice.2376.35), metadata={scheduling_name="bitcast.23800.22"}
  %dynamic-slice.1390.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1875, %bitcast.23800.22, %constant_1627_114, %constant_1627_114), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1390.3"}
  %bitcast.21416.10 = bf16[6144]{0} bitcast(%dynamic-slice.1390.3), metadata={scheduling_name="bitcast.21416.10"}
  %convert.4976.7 = f32[6144]{0} convert(%bitcast.21416.10), metadata={scheduling_name="convert.4976.7"}
  %broadcast.5985.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4976.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5985.14"}
  %multiply.2577.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3940.17, %broadcast.5985.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2577.11"}
  %multiply.2579.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3897.23, %multiply.2577.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2579.3"}
  %bitcast.21990.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2579.3), metadata={scheduling_name="bitcast.21990.1"}
  %constant_1651_8 = f32[] constant(0)
  ROOT %reduce.412.1 = f32[4,8192]{1,0} reduce(%bitcast.21990.1, %constant_1651_8), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.412.1"}
}

%fused_scatter.6 (param_0.276: bf16[1,4,8192,8], param_1.110: s32[65536,4], param_2.1737: bf16[1,4,8192,2], param_3.1482: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.276 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.276"}
  %param_1.110 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.110"}
  %param_2.1737 = bf16[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1737"}
  %convert.3938.16 = f32[1,4,8192,2]{3,2,1,0} convert(%param_2.1737), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3938.16"}
  %param_3.1482 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1482"}
  %bitcast.21496.13 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1482), metadata={scheduling_name="bitcast.21496.13"}
  %constant_1826_4 = f32[] constant(-inf)
  %reduce.155.1 = f32[32768]{0} reduce(%param_3.1482, %constant_1826_4), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.155.1"}
  %bitcast.21503.13 = f32[4,8192]{1,0} bitcast(%reduce.155.1), metadata={scheduling_name="bitcast.21503.13"}
  %broadcast.5555.13 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21503.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5555.13"}
  %subtract.251.13 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.21496.13, %broadcast.5555.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.251.13"}
  %exponential.93.11 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.251.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.93.11"}
  %bitcast.21511.5 = f32[4,8192,2]{2,1,0} bitcast(%exponential.93.11), metadata={scheduling_name="bitcast.21511.5"}
  %constant_1651_7 = f32[] constant(0)
  %reduce.406.5 = f32[4,8192]{1,0} reduce(%bitcast.21511.5, %constant_1651_7), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.406.5"}
  %broadcast.5556.16 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.406.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5556.16"}
  %divide.461.9 = f32[1,4,8192,2]{3,2,1,0} divide(%convert.3938.16, %broadcast.5556.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.461.9"}
  %constant_1990_2 = f32[] constant(1)
  %broadcast.5576.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_1990_2), dimensions={}, metadata={scheduling_name="broadcast.5576.12"}
  %bitcast.21933.5 = f32[1,4,8192]{2,1,0} bitcast(%reduce.406.5), metadata={scheduling_name="bitcast.21933.5"}
  %multiply.2573.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21933.5, %bitcast.21933.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2573.5"}
  %divide.462.7 = f32[1,4,8192]{2,1,0} divide(%broadcast.5576.12, %multiply.2573.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.462.7"}
  %bitcast.21937.7 = f32[4,8192]{1,0} bitcast(%divide.462.7), metadata={scheduling_name="bitcast.21937.7"}
  %broadcast.5577.7 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21937.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5577.7"}
  %multiply.2574.9 = f32[1,4,8192,2]{3,2,1,0} multiply(%convert.3938.16, %broadcast.5577.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2574.9"}
  %multiply.2575.7 = f32[1,4,8192,2]{3,2,1,0} multiply(%multiply.2574.9, %exponential.93.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2575.7"}
  %bitcast.21945.5 = f32[4,8192,2]{2,1,0} bitcast(%multiply.2575.7), metadata={scheduling_name="bitcast.21945.5"}
  %reduce.411.5 = f32[4,8192]{1,0} reduce(%bitcast.21945.5, %constant_1651_7), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.411.5"}
  %bitcast.21950.3 = f32[1,4,8192]{2,1,0} bitcast(%reduce.411.5), metadata={scheduling_name="bitcast.21950.3"}
  %negate.215.3 = f32[1,4,8192]{2,1,0} negate(%bitcast.21950.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="negate.215.3"}
  %bitcast.21953.5 = f32[4,8192]{1,0} bitcast(%negate.215.3), metadata={scheduling_name="bitcast.21953.5"}
  %broadcast.5578.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21953.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5578.5"}
  %add.2904.7 = f32[1,4,8192,2]{3,2,1,0} add(%divide.461.9, %broadcast.5578.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="add.2904.7"}
  %multiply.2576.5 = f32[1,4,8192,2]{3,2,1,0} multiply(%add.2904.7, %exponential.93.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2576.5"}
  %convert.3939.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%multiply.2576.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3939.3"}
  %bitcast.21959.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%convert.3939.3), metadata={scheduling_name="bitcast.21959.1"}
  ROOT %scatter.214.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.276, %param_1.110, %bitcast.21959.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="scatter.214.1"}
}

%fused_transpose.12 (param_0.2365: bf16[4,8192,16384]) -> bf16[4,16392,8192] {
  %param_0.2365 = bf16[4,8192,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2365"}
  %bitcast.21874.3 = bf16[1,4,8192,8,2048]{4,3,2,1,0} bitcast(%param_0.2365), metadata={scheduling_name="bitcast.21874.3"}
  %constant_1623_6 = bf16[] constant(0)
  %pad.351.3 = bf16[1,4,8192,8,2049]{4,3,2,1,0} pad(%bitcast.21874.3, %constant_1623_6), padding=0_0x0_0x0_0x0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="pad.351.3"}
  %bitcast.21879.1 = bf16[4,8192,16392]{2,1,0} bitcast(%pad.351.3), metadata={scheduling_name="bitcast.21879.1"}
  ROOT %transpose.751.1 = bf16[4,16392,8192]{2,1,0} transpose(%bitcast.21879.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.751.1"}
}

%fused_transpose.13 (param_0.299: bf16[1,1,8,4,2048,6144]) -> bf16[4,6144,8,2048] {
  %param_0.299 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.299"}
  %bitcast.21867.1 = bf16[8,4,2048,6144]{3,2,1,0} bitcast(%param_0.299), metadata={scheduling_name="bitcast.21867.1"}
  ROOT %transpose.750.1 = bf16[4,6144,8,2048]{3,2,1,0} transpose(%bitcast.21867.1), dimensions={1,3,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.750.1"}
}

%fused_transpose.14 (param_0.1640: s32[32768,2], param_1.6465: u32[16], param_2.4706: u32[], param_3.3893: s32[16]) -> (s32[65536,4], s32[65536,4]) {
  %constant_1627_2 = s32[] constant(0)
  %broadcast.5532.4 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%constant_1627_2), dimensions={}, metadata={scheduling_name="broadcast.5532.4"}
  %iota.381.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={scheduling_name="iota.381.1"}
  %iota.382.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={scheduling_name="iota.382.1"}
  %param_0.1640 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1640"}
  %bitcast.21815.3 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.1640), metadata={scheduling_name="bitcast.21815.3"}
  %concatenate.706.3 = s32[1,4,4,8192,2]{4,3,2,1,0} concatenate(%broadcast.5532.4, %iota.381.1, %iota.382.1, %bitcast.21815.3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="concatenate.706.3"}
  %bitcast.21818.1 = s32[4,65536]{1,0} bitcast(%concatenate.706.3), metadata={scheduling_name="bitcast.21818.1"}
  %transpose.749.1 = s32[65536,4]{1,0} transpose(%bitcast.21818.1), dimensions={1,0}, metadata={scheduling_name="transpose.749.1"}
  %iota.373.22.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.22.clone.1"}
  %param_3.3893 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.3893"}
  %param_2.4706 = u32[] parameter(2), metadata={scheduling_name="param_2.4706"}
  %dynamic-slice.1384.3.clone.1 = s32[1]{0} dynamic-slice(%param_3.3893, %param_2.4706), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.3.clone.1"}
  %constant_5005_5_clone_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.3.clone.1 = s32[1]{0} multiply(%dynamic-slice.1384.3.clone.1, %constant_5005_5_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.3.clone.1"}
  %bitcast.21171.26.clone.1 = s32[] bitcast(%multiply.2551.3.clone.1), metadata={scheduling_name="bitcast.21171.26.clone.1"}
  %broadcast.5539.25.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.26.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.25.clone.1"}
  %add.2890.22.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.22.clone.1, %broadcast.5539.25.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.22.clone.1"}
  %iota.375.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.1.clone.1"}
  %bitcast.21452.39.clone.1 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_0.1640), metadata={scheduling_name="bitcast.21452.39.clone.1"}
  %broadcast.5540.26.clone.1 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_2), dimensions={}, metadata={scheduling_name="broadcast.5540.26.clone.1"}
  %compare.1628.13.clone.1 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.39.clone.1, %broadcast.5540.26.clone.1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.13.clone.1"}
  %constant_1624_1_clone_1 = s32[] constant(8)
  %broadcast.5541.22.clone.1 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_1_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5541.22.clone.1"}
  %add.2898.13.clone.1 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.39.clone.1, %broadcast.5541.22.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2898.13.clone.1"}
  %select.1271.13.clone.1 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.13.clone.1, %add.2898.13.clone.1, %bitcast.21452.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.13.clone.1"}
  %bitcast.21465.11.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.13.clone.1), metadata={scheduling_name="bitcast.21465.11.clone.1"}
  %concatenate.705.11.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.22.clone.1, %iota.375.1.clone.1, %bitcast.21465.11.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.11.clone.1"}
  %constant_5006_2_clone_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_1.6465 = u32[16]{0} parameter(1), metadata={scheduling_name="param_1.6465"}
  %dynamic-slice.1385.3.clone.1 = u32[1]{0} dynamic-slice(%param_1.6465, %param_2.4706), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.3.clone.1"}
  %constant_5007_2_clone_1 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.3.clone.1 = u32[1]{0} clamp(%constant_5006_2_clone_1, %dynamic-slice.1385.3.clone.1, %constant_5007_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.3.clone.1"}
  %convert.3893.3.clone.1 = s32[1]{0} convert(%clamp.26.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.3.clone.1"}
  %multiply.2554.3.clone.1 = s32[1]{0} multiply(%convert.3893.3.clone.1, %constant_5005_5_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.3.clone.1"}
  %constant_2102_5_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.6.clone.1 = s32[3]{0} concatenate(%multiply.2554.3.clone.1, %constant_2102_5_clone_1, %constant_2102_5_clone_1), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.6.clone.1"}
  %broadcast.5542.12.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.6.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.12.clone.1"}
  %subtract.250.5.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.11.clone.1, %broadcast.5542.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.5.clone.1"}
  %pad.348.1.clone.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.5.clone.1, %constant_1627_2), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.1.clone.1"}
  %bitcast.21472.1.clone.1 = s32[4,65536]{1,0} bitcast(%pad.348.1.clone.1), metadata={scheduling_name="bitcast.21472.1.clone.1"}
  %transpose.741.1.clone.1 = s32[65536,4]{1,0} transpose(%bitcast.21472.1.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.741.1.clone.1"}
  ROOT %tuple.496 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) tuple(%transpose.749.1, %transpose.741.1.clone.1), metadata={scheduling_name="tuple.496"}
}

%fused_transpose.15 (param_0.307: bf16[1,8,4,1,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.307 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.307"}
  %bitcast.21800.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.307), metadata={scheduling_name="bitcast.21800.1"}
  ROOT %transpose.748.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.21800.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.748.1"}
}

%fused_transpose.16 (param_0.313: bf16[1,4,6144,8,1,2048]) -> bf16[32,2048,6144] {
  %param_0.313 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.313"}
  %bitcast.21717.1 = bf16[32,6144,2048]{2,1,0} bitcast(%param_0.313), metadata={scheduling_name="bitcast.21717.1"}
  ROOT %transpose.747.1 = bf16[32,2048,6144]{2,1,0} transpose(%bitcast.21717.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.747.1"}
}

%fused_transpose.17 (param_0.315: bf16[4,6144,16384]) -> bf16[8,24576,2048] {
  %param_0.315 = bf16[4,6144,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.315"}
  %bitcast.21710.1 = bf16[24576,8,2048]{2,1,0} bitcast(%param_0.315), metadata={scheduling_name="bitcast.21710.1"}
  ROOT %transpose.746.1 = bf16[8,24576,2048]{2,1,0} transpose(%bitcast.21710.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.746.1"}
}

%fused_transpose.18 (param_0.321: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.321 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.321"}
  %bitcast.21660.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.321), metadata={scheduling_name="bitcast.21660.1"}
  ROOT %transpose.744.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.21660.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.744.1"}
}

%fused_multiply_transpose.3 (param_0.338: s32[4,8,8192], param_1.127: s32[4,8,8192], param_2.4701: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.338 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.338"}
  %bitcast.21627.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.338), metadata={scheduling_name="bitcast.21627.1"}
  %param_1.127 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.127"}
  %bitcast.21605.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.127), metadata={scheduling_name="bitcast.21605.2"}
  %multiply.2561.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.21627.1, %bitcast.21605.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2561.1"}
  %param_2.4701 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4701"}
  %bitcast.21526.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4701), metadata={scheduling_name="bitcast.21526.3.clone.1"}
  %transpose.742.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.21526.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.742.3.clone.1"}
  %bitcast.21529.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.742.3.clone.1), metadata={scheduling_name="bitcast.21529.5.clone.1"}
  %convert.3904.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21529.5.clone.1), metadata={scheduling_name="convert.3904.5.clone.1"}
  %convert.3906.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21605.2), metadata={scheduling_name="convert.3906.3.clone.1"}
  %multiply.2559.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3904.5.clone.1, %convert.3906.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2559.3.clone.1"}
  %convert.3907.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2559.3.clone.1), metadata={scheduling_name="convert.3907.1.clone.1"}
  ROOT %tuple.494 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2561.1, %convert.3907.1.clone.1), metadata={scheduling_name="tuple.494"}
}

%fused_reduce.10 (param_0.2385: pred[1,4,8,8192,2], param_1.2542: s32[1,4,8,64,16], param_2.1885: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.2385 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2385"}
  %convert.3905.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2385), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3905.17"}
  %bitcast.21540.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3905.17), metadata={scheduling_name="bitcast.21540.11"}
  %constant_1627_101 = s32[] constant(0)
  %reduce-window.160.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.21540.11, %constant_1627_101), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.160.11"}
  %param_1.2542 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2542"}
  %param_2.1885 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1885"}
  %slice.2383.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.1885), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2383.7"}
  %bitcast.21564.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2383.7), metadata={scheduling_name="bitcast.21564.9"}
  %reduce-window.163.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.21564.9, %constant_1627_101), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.163.9"}
  %slice.2384.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.163.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2384.7"}
  %bitcast.21570.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2384.7), metadata={scheduling_name="bitcast.21570.9"}
  %broadcast.5559.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.21570.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5559.9"}
  %add.2899.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.1885, %broadcast.5559.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2899.7"}
  %bitcast.21574.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.2899.7), metadata={scheduling_name="bitcast.21574.7"}
  %pad.349.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.21574.7, %constant_1627_101), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.349.7"}
  %slice.2385.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.349.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2385.5"}
  %bitcast.21578.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2385.5), metadata={scheduling_name="bitcast.21578.9"}
  %broadcast.5560.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.21578.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5560.9"}
  %add.2900.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.2542, %broadcast.5560.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2900.7"}
  %bitcast.21582.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.2900.7), metadata={scheduling_name="bitcast.21582.5"}
  %pad.350.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.21582.5, %constant_1627_101), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.350.5"}
  %slice.2386.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.350.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2386.1"}
  %bitcast.21586.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2386.1), metadata={scheduling_name="bitcast.21586.9"}
  %broadcast.5561.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.21586.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5561.9"}
  %add.2901.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.160.11, %broadcast.5561.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2901.7"}
  %bitcast.21590.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.2901.7), metadata={scheduling_name="bitcast.21590.6"}
  %constant_1848_2 = s32[] constant(2048)
  %broadcast.5562.4 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_1848_2), dimensions={}, metadata={scheduling_name="broadcast.5562.4"}
  %compare.1631.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.21590.6, %broadcast.5562.4), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1631.3"}
  %bitcast.21595.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1631.3), metadata={scheduling_name="bitcast.21595.3"}
  %broadcast.5563.4 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_1627_101), dimensions={}, metadata={scheduling_name="broadcast.5563.4"}
  %select.1273.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.21595.3, %convert.3905.17, %broadcast.5563.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1273.3"}
  %bitcast.21602.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1273.3), metadata={scheduling_name="bitcast.21602.1"}
  %reduce.498.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.21602.1, %constant_1627_101), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.498.1"}
  %bitcast.21616.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.3905.17), metadata={scheduling_name="bitcast.21616.3.clone.1"}
  %multiply.2560.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.21616.3.clone.1, %bitcast.21590.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2560.3.clone.1"}
  %bitcast.21622.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2560.3.clone.1), metadata={scheduling_name="bitcast.21622.1.clone.1"}
  %reduce.499.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.21622.1.clone.1, %constant_1627_101), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.499.1.clone.1"}
  ROOT %tuple.495 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.498.1, %reduce.499.1.clone.1), metadata={scheduling_name="tuple.495"}
}

%fused_reduce_window.6 (param_0.2375: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.2375 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2375"}
  %slice.2382.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.2375), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2382.1"}
  %bitcast.21556.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2382.1), metadata={scheduling_name="bitcast.21556.1"}
  %constant_1627_27 = s32[] constant(0)
  ROOT %reduce-window.162.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.21556.1, %constant_1627_27), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.162.1"}
}

%fused_reduce_window.7 (param_0.2377: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.2377 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2377"}
  %bitcast.21548.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.2377), metadata={scheduling_name="bitcast.21548.1"}
  %constant_1627_38 = s32[] constant(0)
  ROOT %reduce-window.161.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.21548.1, %constant_1627_38), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.161.1"}
}

%fused_scatter.7 (param_0.370: bf16[1,4,8192,8], param_1.147: s32[65536,4], param_2.1185: pred[1,4,8192,2], param_3.1363: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.370 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.370"}
  %param_1.147 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.147"}
  %param_2.1185 = pred[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1185"}
  %param_3.1363 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1363"}
  %bitcast.21496.5 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1363), metadata={scheduling_name="bitcast.21496.5"}
  %constant_1826_2 = f32[] constant(-inf)
  %reduce.155.2 = f32[32768]{0} reduce(%param_3.1363, %constant_1826_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.155.2"}
  %bitcast.21503.5 = f32[4,8192]{1,0} bitcast(%reduce.155.2), metadata={scheduling_name="bitcast.21503.5"}
  %broadcast.5555.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21503.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5555.5"}
  %subtract.251.5 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.21496.5, %broadcast.5555.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.251.5"}
  %exponential.93.3 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.251.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.93.3"}
  %bitcast.21511.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.93.3), metadata={scheduling_name="bitcast.21511.3"}
  %constant_1651_6 = f32[] constant(0)
  %reduce.406.3 = f32[4,8192]{1,0} reduce(%bitcast.21511.3, %constant_1651_6), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.406.3"}
  %broadcast.5556.14 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.406.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5556.14"}
  %divide.459.7 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.93.3, %broadcast.5556.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.459.7"}
  %convert.3903.5 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.459.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3903.5"}
  %constant_1623_45 = bf16[] constant(0)
  %broadcast.5557.14 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1623_45), dimensions={}, metadata={scheduling_name="broadcast.5557.14"}
  %select.1272.3 = bf16[1,4,8192,2]{3,2,1,0} select(%param_2.1185, %convert.3903.5, %broadcast.5557.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1272.3"}
  %bitcast.21523.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1272.3), metadata={scheduling_name="bitcast.21523.1"}
  ROOT %scatter.213.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.370, %param_1.147, %bitcast.21523.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.213.1"}
}

%fused_compare.5 (param_0.1992: u32[1,4,8192,8], param_1.2556: s32[32768,2], param_2.2045: u32[16], param_3.1689: u32[], param_4.1462: s32[16], param_5.1332: s32[16]) -> pred[1,4,8192,2] {
  %iota.370.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.11"}
  %iota.371.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.9"}
  %constant_1682_3 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5533.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1682_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5533.9"}
  %multiply.2550.9 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.9, %broadcast.5533.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2550.9"}
  %add.2885.11 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.11, %multiply.2550.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2885.11"}
  %iota.372.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.9"}
  %param_5.1332 = s32[16]{0} parameter(5), metadata={scheduling_name="param_5.1332"}
  %param_3.1689 = u32[] parameter(3), metadata={scheduling_name="param_3.1689"}
  %dynamic-slice.1384.13 = s32[1]{0} dynamic-slice(%param_5.1332, %param_3.1689), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.13"}
  %constant_5005_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.13 = s32[1]{0} multiply(%dynamic-slice.1384.13, %constant_5005_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.13"}
  %bitcast.21171.56 = s32[] bitcast(%multiply.2551.13), metadata={scheduling_name="bitcast.21171.56"}
  %convert.3891.7 = u32[] convert(%bitcast.21171.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3891.7"}
  %broadcast.5534.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3891.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5534.9"}
  %add.2886.9 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.9, %broadcast.5534.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2886.9"}
  %constant_1688_3 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5535.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1688_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5535.9"}
  %multiply.2552.9 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2886.9, %broadcast.5535.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2552.9"}
  %add.2887.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2885.11, %multiply.2552.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2887.9"}
  %param_4.1462 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1462"}
  %dynamic-slice.1377.179 = s32[1]{0} dynamic-slice(%param_4.1462, %param_3.1689), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.179"}
  %convert.3892.7 = u32[1]{0} convert(%dynamic-slice.1377.179), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3892.7"}
  %constant_5224_4 = u32[1]{0} constant({524288}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2553.7 = u32[1]{0} multiply(%convert.3892.7, %constant_5224_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2553.7"}
  %bitcast.21185.9 = u32[] bitcast(%multiply.2553.7), metadata={scheduling_name="bitcast.21185.9"}
  %broadcast.5536.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21185.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5536.9"}
  %add.2888.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2887.9, %broadcast.5536.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2888.7"}
  %constant_1695_3 = u32[] constant(1)
  %broadcast.5537.5 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1695_3), dimensions={}, metadata={scheduling_name="broadcast.5537.5"}
  %add.2889.5 = u32[1,4,8192,2]{3,2,1,0} add(%add.2888.7, %broadcast.5537.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2889.5"}
  %param_0.1992 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1992"}
  %iota.373.20 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.20"}
  %broadcast.5539.23 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.56), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.23"}
  %add.2890.20 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.20, %broadcast.5539.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.20"}
  %iota.375.5 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.5"}
  %param_1.2556 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2556"}
  %bitcast.21452.33 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2556), metadata={scheduling_name="bitcast.21452.33"}
  %constant_1627_105 = s32[] constant(0)
  %broadcast.5540.24 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_105), dimensions={}, metadata={scheduling_name="broadcast.5540.24"}
  %compare.1628.11 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.33, %broadcast.5540.24), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.11"}
  %constant_1624_6 = s32[] constant(8)
  %broadcast.5541.20 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_6), dimensions={}, metadata={scheduling_name="broadcast.5541.20"}
  %add.2898.11 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.33, %broadcast.5541.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2898.11"}
  %select.1271.11 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.11, %add.2898.11, %bitcast.21452.33), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.11"}
  %bitcast.21465.9 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.11), metadata={scheduling_name="bitcast.21465.9"}
  %concatenate.705.9 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.20, %iota.375.5, %bitcast.21465.9), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.9"}
  %constant_5006_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_2.2045 = u32[16]{0} parameter(2), metadata={scheduling_name="param_2.2045"}
  %dynamic-slice.1385.13 = u32[1]{0} dynamic-slice(%param_2.2045, %param_3.1689), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.13"}
  %constant_5007_1 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.13 = u32[1]{0} clamp(%constant_5006_1, %dynamic-slice.1385.13, %constant_5007_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.13"}
  %convert.3893.13 = s32[1]{0} convert(%clamp.26.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.13"}
  %multiply.2554.13 = s32[1]{0} multiply(%convert.3893.13, %constant_5005_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.13"}
  %constant_2102_8 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.5 = s32[3]{0} concatenate(%multiply.2554.13, %constant_2102_8, %constant_2102_8), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.5"}
  %broadcast.5542.18 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.18"}
  %subtract.250.9 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.9, %broadcast.5542.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.9"}
  %pad.348.5 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.9, %constant_1627_105), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.5"}
  %bitcast.21910.4 = s32[65536,4]{0,1} bitcast(%pad.348.5), metadata={scheduling_name="bitcast.21910.4"}
  %gather.333.3 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_0.1992, %bitcast.21910.4), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.333.3"}
  %bitcast.21491.1 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.333.3), metadata={scheduling_name="bitcast.21491.1"}
  ROOT %compare.1629.1 = pred[1,4,8192,2]{3,2,1,0} compare(%add.2889.5, %bitcast.21491.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1629.1"}
}

%fused_rsqrt.6 (param_0.2399: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2399 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2399"}
  %bitcast.21392.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2399), metadata={scheduling_name="bitcast.21392.7"}
  %constant_1652_3 = f32[] constant(0.000162760422)
  %broadcast.5527.24 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_3), dimensions={}, metadata={scheduling_name="broadcast.5527.24"}
  %multiply.2556.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21392.7, %broadcast.5527.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2556.7"}
  %constant_1653_3 = f32[] constant(1e-05)
  %broadcast.5528.16 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_3), dimensions={}, metadata={scheduling_name="broadcast.5528.16"}
  %add.2897.5 = f32[1,4,8192]{2,1,0} add(%multiply.2556.7, %broadcast.5528.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2897.5"}
  %bitcast.21402.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2897.5), metadata={scheduling_name="bitcast.21402.1"}
  ROOT %rsqrt.96.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.21402.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.96.1"}
}

%fused_reduce.11 (param_0.2393: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.2393 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2393"}
  %bitcast.21380.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2393), metadata={scheduling_name="bitcast.21380.21"}
  %convert.3897.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21380.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3897.21"}
  %multiply.2555.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3897.21, %convert.3897.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2555.3"}
  %bitcast.21387.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2555.3), metadata={scheduling_name="bitcast.21387.1"}
  %constant_1651_5 = f32[] constant(0)
  ROOT %reduce.405.1 = f32[4,8192]{1,0} reduce(%bitcast.21387.1, %constant_1651_5), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.405.1"}
}

%region_51.2293 (Arg_0.2294: pred[], Arg_1.2295: pred[]) -> pred[] {
  %Arg_1.2295 = pred[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" scheduling_name="Arg_1.2295"}
  %Arg_0.2294 = pred[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" scheduling_name="Arg_0.2294"}
  ROOT %and.300.0 = pred[] and(%Arg_0.2294, %Arg_1.2295), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.300.0"}
}

%fused_compare_reduce (param_0.2401: s32[9], param_1.2537: s32[], param_2.4721: s32[3], param_3.3920: s32[16], param_4.2872: u32[], param_5.2665: s32[5]) -> (pred[], pred[], pred[]) {
  %param_0.2401 = s32[9]{0} parameter(0), metadata={scheduling_name="param_0.2401"}
  %constant_1624_28 = s32[] constant(8)
  %param_1.2537 = s32[] parameter(1), metadata={scheduling_name="param_1.2537"}
  %subtract.247.21 = s32[] subtract(%constant_1624_28, %param_1.2537), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.21"}
  %dynamic-slice.1376.1 = s32[1]{0} dynamic-slice(%param_0.2401, %subtract.247.21), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.1"}
  %bitcast.21289.5 = s32[] bitcast(%dynamic-slice.1376.1), metadata={scheduling_name="bitcast.21289.5"}
  %constant_1687_3 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %compare.1653.1 = pred[] compare(%bitcast.21289.5, %constant_1687_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="compare.1653.1"}
  %constant_1627_57_clone_1 = s32[] constant(0)
  %broadcast.5627.5.clone.1 = s32[3]{0} broadcast(%constant_1627_57_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5627.5.clone.1"}
  %param_3.3920 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.3920"}
  %param_4.2872 = u32[] parameter(4), metadata={scheduling_name="param_4.2872"}
  %dynamic-slice.1377.135.clone.1 = s32[1]{0} dynamic-slice(%param_3.3920, %param_4.2872), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.135.clone.1"}
  %subtract.248.130.clone.1 = s32[1]{0} subtract(%dynamic-slice.1376.1, %dynamic-slice.1377.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.130.clone.1"}
  %constant_2102_20_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.130.clone.1 = s32[1]{0} maximum(%subtract.248.130.clone.1, %constant_2102_20_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.130.clone.1"}
  %sign.27.129.clone.1 = s32[1]{0} sign(%maximum.47.130.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.129.clone.1"}
  %constant_5000_14_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.129.clone.1 = pred[1]{0} compare(%sign.27.129.clone.1, %constant_5000_14_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.129.clone.1"}
  %constant_5001_12_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.130.clone.1 = s32[1]{0} and(%maximum.47.130.clone.1, %constant_5001_12_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.130.clone.1"}
  %compare.1615.130.clone.1 = pred[1]{0} compare(%and.301.130.clone.1, %constant_2102_20_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.130.clone.1"}
  %and.302.129.clone.1 = pred[1]{0} and(%compare.1614.129.clone.1, %compare.1615.130.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.129.clone.1"}
  %constant_5002_11_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.129.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.130.clone.1, %constant_5002_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.129.clone.1"}
  %constant_5003_11_clone_1 = s32[1]{0} constant({-1})
  %add.2882.129.clone.1 = s32[1]{0} add(%shift-right-logical.20.129.clone.1, %constant_5003_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.129.clone.1"}
  %select.1263.129.clone.1 = s32[1]{0} select(%and.302.129.clone.1, %add.2882.129.clone.1, %shift-right-logical.20.129.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.129.clone.1"}
  %compare.1616.129.clone.1 = pred[1]{0} compare(%select.1263.129.clone.1, %constant_2102_20_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.129.clone.1"}
  %add.2883.129.clone.1 = s32[1]{0} add(%select.1263.129.clone.1, %constant_5002_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.129.clone.1"}
  %select.1264.129.clone.1 = s32[1]{0} select(%compare.1616.129.clone.1, %add.2883.129.clone.1, %select.1263.129.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.129.clone.1"}
  %bitcast.20992.143.clone.1 = s32[1,1]{1,0} bitcast(%select.1264.129.clone.1), metadata={scheduling_name="bitcast.20992.143.clone.1"}
  %pad.345.35.clone.1 = s32[1,2]{1,0} pad(%bitcast.20992.143.clone.1, %constant_1627_57_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.35.clone.1"}
  %pad.346.33.clone.1 = s32[1,3]{1,0} pad(%pad.345.35.clone.1, %constant_1627_57_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.33.clone.1"}
  %bitcast.21099.30.clone.1 = s32[3]{0} bitcast(%pad.346.33.clone.1), metadata={scheduling_name="bitcast.21099.30.clone.1"}
  %slice.2404.5.clone.1 = s32[2]{0} slice(%bitcast.21099.30.clone.1), slice={[1:3]}, metadata={scheduling_name="slice.2404.5.clone.1"}
  %pad.355.10.clone.1 = s32[3]{0} pad(%slice.2404.5.clone.1, %constant_1627_57_clone_1), padding=1_0, metadata={scheduling_name="pad.355.10.clone.1"}
  %compare.1644.5.clone.1 = pred[3]{0} compare(%broadcast.5627.5.clone.1, %pad.355.10.clone.1), direction=LE, metadata={scheduling_name="compare.1644.5.clone.1"}
  %param_2.4721 = s32[3]{0} parameter(2), metadata={scheduling_name="param_2.4721"}
  %compare.1645.5.clone.1 = pred[3]{0} compare(%param_2.4721, %pad.355.10.clone.1), direction=GE, metadata={scheduling_name="compare.1645.5.clone.1"}
  %and.310.3.clone.1 = pred[3]{0} and(%compare.1644.5.clone.1, %compare.1645.5.clone.1), metadata={scheduling_name="and.310.3.clone.1"}
  %constant_1725_3_clone_1 = pred[] constant(true)
  %reduce.302.1.clone.1 = pred[] reduce(%and.310.3.clone.1, %constant_1725_3_clone_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.302.1.clone.1"}
  %broadcast.5620.5.clone.1 = s32[5]{0} broadcast(%constant_1627_57_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5620.5.clone.1"}
  %constant_5004_9_clone_1 = s32[1,1]{1,0} constant({ {0} })
  %concatenate.701.91.clone.1 = s32[1,5]{1,0} concatenate(%constant_5004_9_clone_1, %bitcast.20992.143.clone.1, %constant_5004_9_clone_1, %constant_5004_9_clone_1, %constant_5004_9_clone_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.91.clone.1"}
  %bitcast.21040.92.clone.1 = s32[5]{0} bitcast(%concatenate.701.91.clone.1), metadata={scheduling_name="bitcast.21040.92.clone.1"}
  %slice.2403.7.clone.1 = s32[4]{0} slice(%bitcast.21040.92.clone.1), slice={[1:5]}, metadata={scheduling_name="slice.2403.7.clone.1"}
  %concatenate.711.5.clone.1 = s32[5]{0} concatenate(%constant_2102_20_clone_1, %slice.2403.7.clone.1), dimensions={0}, metadata={scheduling_name="concatenate.711.5.clone.1"}
  %compare.1642.5.clone.1 = pred[5]{0} compare(%broadcast.5620.5.clone.1, %concatenate.711.5.clone.1), direction=LE, metadata={scheduling_name="compare.1642.5.clone.1"}
  %param_5.2665 = s32[5]{0} parameter(5), metadata={scheduling_name="param_5.2665"}
  %compare.1643.3.clone.1 = pred[5]{0} compare(%param_5.2665, %concatenate.711.5.clone.1), direction=GE, metadata={scheduling_name="compare.1643.3.clone.1"}
  %and.309.3.clone.1 = pred[5]{0} and(%compare.1642.5.clone.1, %compare.1643.3.clone.1), metadata={scheduling_name="and.309.3.clone.1"}
  %reduce.299.1.clone.1 = pred[] reduce(%and.309.3.clone.1, %constant_1725_3_clone_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.299.1.clone.1"}
  ROOT %tuple.517 = (pred[], pred[], pred[]) tuple(%compare.1653.1, %reduce.302.1.clone.1, %reduce.299.1.clone.1), metadata={scheduling_name="tuple.517"}
}

%fused_compare.6 (param_0.1990: u32[1,4,8192,8], param_1.2558: s32[32768,2], param_2.2047: u32[16], param_3.1691: u32[], param_4.1461: s32[16], param_5.1331: s32[16]) -> pred[1,4,8192,2] {
  %iota.370.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.9"}
  %iota.371.7 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.7"}
  %constant_1682_2 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5533.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1682_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5533.7"}
  %multiply.2550.7 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.7, %broadcast.5533.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2550.7"}
  %add.2885.9 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.9, %multiply.2550.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2885.9"}
  %iota.372.7 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.7"}
  %param_5.1331 = s32[16]{0} parameter(5), metadata={scheduling_name="param_5.1331"}
  %param_3.1691 = u32[] parameter(3), metadata={scheduling_name="param_3.1691"}
  %dynamic-slice.1384.11 = s32[1]{0} dynamic-slice(%param_5.1331, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.11"}
  %constant_5005_6 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.11 = s32[1]{0} multiply(%dynamic-slice.1384.11, %constant_5005_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.11"}
  %bitcast.21171.54 = s32[] bitcast(%multiply.2551.11), metadata={scheduling_name="bitcast.21171.54"}
  %convert.3891.5 = u32[] convert(%bitcast.21171.54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3891.5"}
  %broadcast.5534.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3891.5), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5534.7"}
  %add.2886.7 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.7, %broadcast.5534.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2886.7"}
  %constant_1688_2 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5535.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1688_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5535.7"}
  %multiply.2552.7 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2886.7, %broadcast.5535.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2552.7"}
  %add.2887.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2885.9, %multiply.2552.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2887.7"}
  %param_4.1461 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1461"}
  %dynamic-slice.1377.177 = s32[1]{0} dynamic-slice(%param_4.1461, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.177"}
  %convert.3892.5 = u32[1]{0} convert(%dynamic-slice.1377.177), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3892.5"}
  %constant_5224_3 = u32[1]{0} constant({524288}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2553.5 = u32[1]{0} multiply(%convert.3892.5, %constant_5224_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2553.5"}
  %bitcast.21185.7 = u32[] bitcast(%multiply.2553.5), metadata={scheduling_name="bitcast.21185.7"}
  %broadcast.5536.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21185.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5536.7"}
  %add.2888.5 = u32[1,4,8192,2]{3,2,1,0} add(%add.2887.7, %broadcast.5536.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2888.5"}
  %constant_1695_2 = u32[] constant(1)
  %broadcast.5537.3 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1695_2), dimensions={}, metadata={scheduling_name="broadcast.5537.3"}
  %add.2889.3 = u32[1,4,8192,2]{3,2,1,0} add(%add.2888.5, %broadcast.5537.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2889.3"}
  %param_0.1990 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1990"}
  %iota.373.6 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.6"}
  %broadcast.5539.9 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.54), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.9"}
  %add.2890.6 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.6, %broadcast.5539.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.6"}
  %iota.374.3 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.3"}
  %param_1.2558 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2558"}
  %bitcast.21202.21 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2558), metadata={scheduling_name="bitcast.21202.21"}
  %constant_1627_10 = s32[] constant(0)
  %broadcast.5540.10 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_10), dimensions={}, metadata={scheduling_name="broadcast.5540.10"}
  %compare.1619.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21202.21, %broadcast.5540.10), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.7"}
  %constant_1624_5 = s32[] constant(8)
  %broadcast.5541.6 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_5), dimensions={}, metadata={scheduling_name="broadcast.5541.6"}
  %add.2892.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21202.21, %broadcast.5541.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2892.7"}
  %select.1265.7 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.7, %add.2892.7, %bitcast.21202.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1265.7"}
  %bitcast.21215.5 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1265.7), metadata={scheduling_name="bitcast.21215.5"}
  %concatenate.703.5 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.6, %iota.374.3, %bitcast.21215.5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.5"}
  %constant_5006_3 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_2.2047 = u32[16]{0} parameter(2), metadata={scheduling_name="param_2.2047"}
  %dynamic-slice.1385.5 = u32[1]{0} dynamic-slice(%param_2.2047, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.5"}
  %constant_5007_3 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.5 = u32[1]{0} clamp(%constant_5006_3, %dynamic-slice.1385.5, %constant_5007_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.5"}
  %convert.3893.5 = s32[1]{0} convert(%clamp.26.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.5"}
  %multiply.2554.5 = s32[1]{0} multiply(%convert.3893.5, %constant_5005_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.5"}
  %constant_2102_10 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.1 = s32[3]{0} concatenate(%multiply.2554.5, %constant_2102_10, %constant_2102_10), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.1"}
  %broadcast.5542.16 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.16"}
  %subtract.249.9 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.5, %broadcast.5542.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.9"}
  %pad.347.5 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.9, %constant_1627_10), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.5"}
  %bitcast.22716.4 = s32[65536,4]{0,1} bitcast(%pad.347.5), metadata={scheduling_name="bitcast.22716.4"}
  %gather.329.3 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_0.1990, %bitcast.22716.4), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.329.3"}
  %bitcast.21249.1 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.329.3), metadata={scheduling_name="bitcast.21249.1"}
  ROOT %compare.1620.1 = pred[1,4,8192,2]{3,2,1,0} compare(%add.2889.3, %bitcast.21249.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1620.1"}
}

%fused_scatter.8 (param_0.424: u32[1,4,8192,8], param_1.188: s32[65536,4], param_2.2050: s32[16], param_3.1694: u32[], param_4.1460: s32[16]) -> u32[1,4,8192,8] {
  %param_0.424 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.424"}
  %param_1.188 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.188"}
  %iota.370.15 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.15"}
  %iota.371.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.13"}
  %constant_1682_1 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5533.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1682_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5533.13"}
  %multiply.2550.13 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.13, %broadcast.5533.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2550.13"}
  %add.2885.15 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.15, %multiply.2550.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2885.15"}
  %iota.372.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.13"}
  %param_4.1460 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1460"}
  %param_3.1694 = u32[] parameter(3), metadata={scheduling_name="param_3.1694"}
  %dynamic-slice.1384.17 = s32[1]{0} dynamic-slice(%param_4.1460, %param_3.1694), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.17"}
  %constant_5005_2 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.17 = s32[1]{0} multiply(%dynamic-slice.1384.17, %constant_5005_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.17"}
  %bitcast.21171.52 = s32[] bitcast(%multiply.2551.17), metadata={scheduling_name="bitcast.21171.52"}
  %convert.3891.3 = u32[] convert(%bitcast.21171.52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3891.3"}
  %broadcast.5534.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3891.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5534.13"}
  %add.2886.13 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.13, %broadcast.5534.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2886.13"}
  %constant_1688_1 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5535.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1688_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5535.13"}
  %multiply.2552.13 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2886.13, %broadcast.5535.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2552.13"}
  %add.2887.13 = u32[1,4,8192,2]{3,2,1,0} add(%add.2885.15, %multiply.2552.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2887.13"}
  %param_2.2050 = s32[16]{0} parameter(2), metadata={scheduling_name="param_2.2050"}
  %dynamic-slice.1377.175 = s32[1]{0} dynamic-slice(%param_2.2050, %param_3.1694), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.175"}
  %convert.3892.3 = u32[1]{0} convert(%dynamic-slice.1377.175), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3892.3"}
  %constant_5224_2 = u32[1]{0} constant({524288}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2553.3 = u32[1]{0} multiply(%convert.3892.3, %constant_5224_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2553.3"}
  %bitcast.21185.13 = u32[] bitcast(%multiply.2553.3), metadata={scheduling_name="bitcast.21185.13"}
  %broadcast.5536.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21185.13), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5536.13"}
  %add.2888.11 = u32[1,4,8192,2]{3,2,1,0} add(%add.2887.13, %broadcast.5536.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2888.11"}
  %constant_1695_1 = u32[] constant(1)
  %broadcast.5537.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1695_1), dimensions={}, metadata={scheduling_name="broadcast.5537.9"}
  %add.2889.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2888.11, %broadcast.5537.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2889.9"}
  %bitcast.21240.1 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%add.2889.9), metadata={scheduling_name="bitcast.21240.1"}
  ROOT %scatter.211.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.424, %param_1.188, %bitcast.21240.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.211.1"}
}

%fused_scatter.9 (param_0.425: u32[1,4,8192,8], param_1.189: s32[65536,4], param_2.2049: s32[16], param_3.1693: u32[], param_4.1459: s32[16]) -> u32[1,4,8192,8] {
  %param_0.425 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.425"}
  %param_1.189 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.189"}
  %iota.370.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.13"}
  %iota.371.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.11"}
  %constant_1682_4 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5533.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1682_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5533.11"}
  %multiply.2550.11 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.11, %broadcast.5533.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2550.11"}
  %add.2885.13 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.13, %multiply.2550.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2885.13"}
  %iota.372.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.11"}
  %param_4.1459 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1459"}
  %param_3.1693 = u32[] parameter(3), metadata={scheduling_name="param_3.1693"}
  %dynamic-slice.1384.5 = s32[1]{0} dynamic-slice(%param_4.1459, %param_3.1693), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.5"}
  %constant_5005_10 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.5 = s32[1]{0} multiply(%dynamic-slice.1384.5, %constant_5005_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.5"}
  %bitcast.21171.58 = s32[] bitcast(%multiply.2551.5), metadata={scheduling_name="bitcast.21171.58"}
  %convert.3891.9 = u32[] convert(%bitcast.21171.58), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3891.9"}
  %broadcast.5534.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3891.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5534.11"}
  %add.2886.11 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.11, %broadcast.5534.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2886.11"}
  %constant_1688_4 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5535.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1688_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5535.11"}
  %multiply.2552.11 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2886.11, %broadcast.5535.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2552.11"}
  %add.2887.11 = u32[1,4,8192,2]{3,2,1,0} add(%add.2885.13, %multiply.2552.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2887.11"}
  %param_2.2049 = s32[16]{0} parameter(2), metadata={scheduling_name="param_2.2049"}
  %dynamic-slice.1377.181 = s32[1]{0} dynamic-slice(%param_2.2049, %param_3.1693), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.181"}
  %convert.3892.9 = u32[1]{0} convert(%dynamic-slice.1377.181), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3892.9"}
  %constant_5224_1 = u32[1]{0} constant({524288}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2553.9 = u32[1]{0} multiply(%convert.3892.9, %constant_5224_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2553.9"}
  %bitcast.21185.11 = u32[] bitcast(%multiply.2553.9), metadata={scheduling_name="bitcast.21185.11"}
  %broadcast.5536.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21185.11), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5536.11"}
  %add.2888.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2887.11, %broadcast.5536.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2888.9"}
  %constant_1695_4 = u32[] constant(1)
  %broadcast.5537.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1695_4), dimensions={}, metadata={scheduling_name="broadcast.5537.7"}
  %add.2889.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2888.9, %broadcast.5537.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2889.7"}
  %bitcast.21240.2 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%add.2889.7), metadata={scheduling_name="bitcast.21240.2"}
  ROOT %scatter.212.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.425, %param_1.189, %bitcast.21240.2), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.212.1"}
}

%fused_transpose.19 (param_0.2410: s32[32768,2], param_1.2624: u32[16], param_2.2048: u32[], param_3.1692: s32[16]) -> (s32[65536,4], s32[65536,4]) {
  %iota.373.12 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.12"}
  %param_3.1692 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.1692"}
  %param_2.2048 = u32[] parameter(2), metadata={scheduling_name="param_2.2048"}
  %dynamic-slice.1384.7 = s32[1]{0} dynamic-slice(%param_3.1692, %param_2.2048), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.7"}
  %constant_5005_9 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.7 = s32[1]{0} multiply(%dynamic-slice.1384.7, %constant_5005_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.7"}
  %bitcast.21171.16 = s32[] bitcast(%multiply.2551.7), metadata={scheduling_name="bitcast.21171.16"}
  %broadcast.5539.15 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.16), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.15"}
  %add.2890.12 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.12, %broadcast.5539.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.12"}
  %iota.374.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.1"}
  %param_0.2410 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.2410"}
  %bitcast.21202.39 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_0.2410), metadata={scheduling_name="bitcast.21202.39"}
  %constant_1627_37 = s32[] constant(0)
  %broadcast.5540.16 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_37), dimensions={}, metadata={scheduling_name="broadcast.5540.16"}
  %compare.1619.13 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21202.39, %broadcast.5540.16), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.13"}
  %constant_1624_3 = s32[] constant(8)
  %broadcast.5541.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_3), dimensions={}, metadata={scheduling_name="broadcast.5541.12"}
  %add.2892.13 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21202.39, %broadcast.5541.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2892.13"}
  %select.1265.13 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.13, %add.2892.13, %bitcast.21202.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1265.13"}
  %bitcast.21215.11 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1265.13), metadata={scheduling_name="bitcast.21215.11"}
  %concatenate.703.11 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.12, %iota.374.1, %bitcast.21215.11), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.11"}
  %constant_5006_6 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_1.2624 = u32[16]{0} parameter(1), metadata={scheduling_name="param_1.2624"}
  %dynamic-slice.1385.11 = u32[1]{0} dynamic-slice(%param_1.2624, %param_2.2048), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.11"}
  %constant_5007_6 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.11 = u32[1]{0} clamp(%constant_5006_6, %dynamic-slice.1385.11, %constant_5007_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.11"}
  %convert.3893.11 = s32[1]{0} convert(%clamp.26.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.11"}
  %multiply.2554.11 = s32[1]{0} multiply(%convert.3893.11, %constant_5005_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.11"}
  %constant_2102_4 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.4 = s32[3]{0} concatenate(%multiply.2554.11, %constant_2102_4, %constant_2102_4), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.4"}
  %broadcast.5542.6 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.6"}
  %subtract.249.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.11, %broadcast.5542.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.5"}
  %pad.347.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.5, %constant_1627_37), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.1"}
  %bitcast.21235.1 = s32[4,65536]{1,0} bitcast(%pad.347.1), metadata={scheduling_name="bitcast.21235.1"}
  %transpose.740.1 = s32[65536,4]{1,0} transpose(%bitcast.21235.1), dimensions={1,0}, metadata={scheduling_name="transpose.740.1"}
  %broadcast.5532.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%constant_1627_37), dimensions={}, metadata={scheduling_name="broadcast.5532.1.clone.1"}
  %iota.366.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={scheduling_name="iota.366.1.clone.1"}
  %iota.367.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={scheduling_name="iota.367.1.clone.1"}
  %bitcast.21152.3.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.2410), metadata={scheduling_name="bitcast.21152.3.clone.1"}
  %concatenate.702.3.clone.1 = s32[1,4,4,8192,2]{4,3,2,1,0} concatenate(%broadcast.5532.1.clone.1, %iota.366.1.clone.1, %iota.367.1.clone.1, %bitcast.21152.3.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="concatenate.702.3.clone.1"}
  %bitcast.21155.1.clone.1 = s32[4,65536]{1,0} bitcast(%concatenate.702.3.clone.1), metadata={scheduling_name="bitcast.21155.1.clone.1"}
  %transpose.739.1.clone.1 = s32[65536,4]{1,0} transpose(%bitcast.21155.1.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.739.1.clone.1"}
  ROOT %tuple.501 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) tuple(%transpose.740.1, %transpose.739.1.clone.1), metadata={scheduling_name="tuple.501"}
}

%fused_dynamic_update_slice.13 (param_0.450: bf16[2,1,6144], param_1.2474: bf16[1,1,6144], param_2.1824: bf16[6144], param_3.1414: pred[], param_4.1355: s32[16], param_5.1247: u32[], param_6.1228: s32[9], param_7.1157: s32[]) -> bf16[2,1,6144] {
  %param_0.450 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.450"}
  %param_1.2474 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2474"}
  %convert.4043.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2474), metadata={scheduling_name="convert.4043.3"}
  %param_3.1414 = pred[] parameter(3), metadata={scheduling_name="param_3.1414"}
  %broadcast.5628.2 = pred[1,6144]{1,0} broadcast(%param_3.1414), dimensions={}, metadata={scheduling_name="broadcast.5628.2"}
  %param_2.1824 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1824"}
  %bitcast.23054.3 = bf16[1,6144]{1,0} bitcast(%param_2.1824), metadata={scheduling_name="bitcast.23054.3"}
  %constant_1623_48 = bf16[] constant(0)
  %broadcast.5629.1 = bf16[1,6144]{1,0} broadcast(%constant_1623_48), dimensions={}, metadata={scheduling_name="broadcast.5629.1"}
  %select.1286.3 = bf16[1,6144]{1,0} select(%broadcast.5628.2, %bitcast.23054.3, %broadcast.5629.1), metadata={scheduling_name="select.1286.3"}
  %bitcast.23060.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1286.3), metadata={scheduling_name="bitcast.23060.7"}
  %convert.4050.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23060.7), metadata={scheduling_name="convert.4050.7"}
  %add.2930.5 = f32[1,1,6144]{2,1,0} add(%convert.4043.3, %convert.4050.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2930.5"}
  %convert.4051.3 = bf16[1,1,6144]{2,1,0} convert(%add.2930.5), metadata={scheduling_name="convert.4051.3"}
  %param_6.1228 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1228"}
  %constant_1624_52 = s32[] constant(8)
  %param_7.1157 = s32[] parameter(7), metadata={scheduling_name="param_7.1157"}
  %subtract.247.61 = s32[] subtract(%constant_1624_52, %param_7.1157), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.61"}
  %dynamic-slice.1376.42 = s32[1]{0} dynamic-slice(%param_6.1228, %subtract.247.61), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.42"}
  %param_4.1355 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1355"}
  %param_5.1247 = u32[] parameter(5), metadata={scheduling_name="param_5.1247"}
  %dynamic-slice.1377.37 = s32[1]{0} dynamic-slice(%param_4.1355, %param_5.1247), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.37"}
  %subtract.248.32 = s32[1]{0} subtract(%dynamic-slice.1376.42, %dynamic-slice.1377.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.32"}
  %constant_2102_25 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.32 = s32[1]{0} maximum(%subtract.248.32, %constant_2102_25), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.32"}
  %sign.27.31 = s32[1]{0} sign(%maximum.47.32), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.31"}
  %constant_5000_19 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.31 = pred[1]{0} compare(%sign.27.31, %constant_5000_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.31"}
  %constant_5001_17 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.32 = s32[1]{0} and(%maximum.47.32, %constant_5001_17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.32"}
  %compare.1615.32 = pred[1]{0} compare(%and.301.32, %constant_2102_25), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.32"}
  %and.302.31 = pred[1]{0} and(%compare.1614.31, %compare.1615.32), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.31"}
  %constant_5002_16 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.31 = s32[1]{0} shift-right-logical(%maximum.47.32, %constant_5002_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.31"}
  %constant_5003_16 = s32[1]{0} constant({-1})
  %add.2882.31 = s32[1]{0} add(%shift-right-logical.20.31, %constant_5003_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.31"}
  %select.1263.31 = s32[1]{0} select(%and.302.31, %add.2882.31, %shift-right-logical.20.31), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.31"}
  %compare.1616.31 = pred[1]{0} compare(%select.1263.31, %constant_2102_25), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.31"}
  %add.2883.31 = s32[1]{0} add(%select.1263.31, %constant_5002_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.31"}
  %select.1264.31 = s32[1]{0} select(%compare.1616.31, %add.2883.31, %select.1263.31), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.31"}
  %bitcast.20992.39 = s32[1,1]{1,0} bitcast(%select.1264.31), metadata={scheduling_name="bitcast.20992.39"}
  %constant_1627_59 = s32[] constant(0)
  %pad.345.19 = s32[1,2]{1,0} pad(%bitcast.20992.39, %constant_1627_59), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.19"}
  %pad.346.17 = s32[1,3]{1,0} pad(%pad.345.19, %constant_1627_59), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.17"}
  %bitcast.21099.14 = s32[3]{0} bitcast(%pad.346.17), metadata={scheduling_name="bitcast.21099.14"}
  %slice.2376.11 = s32[1]{0} slice(%bitcast.21099.14), slice={[1:2]}, metadata={scheduling_name="slice.2376.11"}
  %bitcast.23800.4 = s32[] bitcast(%slice.2376.11), metadata={scheduling_name="bitcast.23800.4"}
  ROOT %dynamic-update-slice.398.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.450, %convert.4051.3, %bitcast.23800.4, %constant_1627_59, %constant_1627_59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.398.1"}
}

%fused_dynamic_update_slice.14 (param_0.452: bf16[2,1,6144], param_1.2466: bf16[1,1,6144], param_2.1815: bf16[6144], param_3.1405: pred[], param_4.1357: s32[16], param_5.1249: u32[], param_6.1230: s32[9], param_7.1158: s32[]) -> bf16[2,1,6144] {
  %param_0.452 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.452"}
  %param_1.2466 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2466"}
  %convert.4052.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2466), metadata={scheduling_name="convert.4052.3"}
  %param_3.1405 = pred[] parameter(3), metadata={scheduling_name="param_3.1405"}
  %broadcast.5628.1 = pred[1,6144]{1,0} broadcast(%param_3.1405), dimensions={}, metadata={scheduling_name="broadcast.5628.1"}
  %param_2.1815 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1815"}
  %bitcast.23460.3 = bf16[1,6144]{1,0} bitcast(%param_2.1815), metadata={scheduling_name="bitcast.23460.3"}
  %constant_1623_49 = bf16[] constant(0)
  %broadcast.5629.2 = bf16[1,6144]{1,0} broadcast(%constant_1623_49), dimensions={}, metadata={scheduling_name="broadcast.5629.2"}
  %select.1287.3 = bf16[1,6144]{1,0} select(%broadcast.5628.1, %bitcast.23460.3, %broadcast.5629.2), metadata={scheduling_name="select.1287.3"}
  %bitcast.23466.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1287.3), metadata={scheduling_name="bitcast.23466.7"}
  %convert.4108.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23466.7), metadata={scheduling_name="convert.4108.7"}
  %add.2941.5 = f32[1,1,6144]{2,1,0} add(%convert.4052.3, %convert.4108.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2941.5"}
  %convert.4109.3 = bf16[1,1,6144]{2,1,0} convert(%add.2941.5), metadata={scheduling_name="convert.4109.3"}
  %param_6.1230 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1230"}
  %constant_1624_54 = s32[] constant(8)
  %param_7.1158 = s32[] parameter(7), metadata={scheduling_name="param_7.1158"}
  %subtract.247.65 = s32[] subtract(%constant_1624_54, %param_7.1158), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.65"}
  %dynamic-slice.1376.46 = s32[1]{0} dynamic-slice(%param_6.1230, %subtract.247.65), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.46"}
  %param_4.1357 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1357"}
  %param_5.1249 = u32[] parameter(5), metadata={scheduling_name="param_5.1249"}
  %dynamic-slice.1377.41 = s32[1]{0} dynamic-slice(%param_4.1357, %param_5.1249), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.41"}
  %subtract.248.36 = s32[1]{0} subtract(%dynamic-slice.1376.46, %dynamic-slice.1377.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.36"}
  %constant_2102_27 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.36 = s32[1]{0} maximum(%subtract.248.36, %constant_2102_27), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.36"}
  %sign.27.35 = s32[1]{0} sign(%maximum.47.36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.35"}
  %constant_5000_21 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.35 = pred[1]{0} compare(%sign.27.35, %constant_5000_21), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.35"}
  %constant_5001_19 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.36 = s32[1]{0} and(%maximum.47.36, %constant_5001_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.36"}
  %compare.1615.36 = pred[1]{0} compare(%and.301.36, %constant_2102_27), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.36"}
  %and.302.35 = pred[1]{0} and(%compare.1614.35, %compare.1615.36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.35"}
  %constant_5002_18 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.35 = s32[1]{0} shift-right-logical(%maximum.47.36, %constant_5002_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.35"}
  %constant_5003_18 = s32[1]{0} constant({-1})
  %add.2882.35 = s32[1]{0} add(%shift-right-logical.20.35, %constant_5003_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.35"}
  %select.1263.35 = s32[1]{0} select(%and.302.35, %add.2882.35, %shift-right-logical.20.35), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.35"}
  %compare.1616.35 = pred[1]{0} compare(%select.1263.35, %constant_2102_27), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.35"}
  %add.2883.35 = s32[1]{0} add(%select.1263.35, %constant_5002_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.35"}
  %select.1264.35 = s32[1]{0} select(%compare.1616.35, %add.2883.35, %select.1263.35), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.35"}
  %bitcast.20992.43 = s32[1,1]{1,0} bitcast(%select.1264.35), metadata={scheduling_name="bitcast.20992.43"}
  %constant_1627_50 = s32[] constant(0)
  %pad.345.23 = s32[1,2]{1,0} pad(%bitcast.20992.43, %constant_1627_50), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.23"}
  %pad.346.21 = s32[1,3]{1,0} pad(%pad.345.23, %constant_1627_50), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.21"}
  %bitcast.21099.18 = s32[3]{0} bitcast(%pad.346.21), metadata={scheduling_name="bitcast.21099.18"}
  %slice.2376.15 = s32[1]{0} slice(%bitcast.21099.18), slice={[1:2]}, metadata={scheduling_name="slice.2376.15"}
  %bitcast.23800.6 = s32[] bitcast(%slice.2376.15), metadata={scheduling_name="bitcast.23800.6"}
  ROOT %dynamic-update-slice.399.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.452, %convert.4109.3, %bitcast.23800.6, %constant_1627_50, %constant_1627_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.399.1"}
}

%fused_dynamic_update_slice.15 (param_0.453: bf16[2,1,6144], param_1.2520: bf16[1,1,6144], param_2.1864: bf16[6144], param_3.1456: pred[], param_4.1358: s32[16], param_5.1250: u32[], param_6.1231: s32[9], param_7.1159: s32[]) -> bf16[2,1,6144] {
  %param_0.453 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.453"}
  %param_1.2520 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2520"}
  %convert.4137.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2520), metadata={scheduling_name="convert.4137.3"}
  %param_3.1456 = pred[] parameter(3), metadata={scheduling_name="param_3.1456"}
  %broadcast.5628.3 = pred[1,6144]{1,0} broadcast(%param_3.1456), dimensions={}, metadata={scheduling_name="broadcast.5628.3"}
  %param_2.1864 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1864"}
  %bitcast.23783.3 = bf16[1,6144]{1,0} bitcast(%param_2.1864), metadata={scheduling_name="bitcast.23783.3"}
  %constant_1623_50 = bf16[] constant(0)
  %broadcast.5629.3 = bf16[1,6144]{1,0} broadcast(%constant_1623_50), dimensions={}, metadata={scheduling_name="broadcast.5629.3"}
  %select.1296.3 = bf16[1,6144]{1,0} select(%broadcast.5628.3, %bitcast.23783.3, %broadcast.5629.3), metadata={scheduling_name="select.1296.3"}
  %bitcast.23789.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1296.3), metadata={scheduling_name="bitcast.23789.7"}
  %convert.4146.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23789.7), metadata={scheduling_name="convert.4146.7"}
  %add.2950.5 = f32[1,1,6144]{2,1,0} add(%convert.4137.3, %convert.4146.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2950.5"}
  %convert.4147.3 = bf16[1,1,6144]{2,1,0} convert(%add.2950.5), metadata={scheduling_name="convert.4147.3"}
  %param_6.1231 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1231"}
  %constant_1624_55 = s32[] constant(8)
  %param_7.1159 = s32[] parameter(7), metadata={scheduling_name="param_7.1159"}
  %subtract.247.67 = s32[] subtract(%constant_1624_55, %param_7.1159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.67"}
  %dynamic-slice.1376.48 = s32[1]{0} dynamic-slice(%param_6.1231, %subtract.247.67), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.48"}
  %param_4.1358 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1358"}
  %param_5.1250 = u32[] parameter(5), metadata={scheduling_name="param_5.1250"}
  %dynamic-slice.1377.43 = s32[1]{0} dynamic-slice(%param_4.1358, %param_5.1250), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.43"}
  %subtract.248.38 = s32[1]{0} subtract(%dynamic-slice.1376.48, %dynamic-slice.1377.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.38"}
  %constant_2102_28 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.38 = s32[1]{0} maximum(%subtract.248.38, %constant_2102_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.38"}
  %sign.27.37 = s32[1]{0} sign(%maximum.47.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.37"}
  %constant_5000_22 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.37 = pred[1]{0} compare(%sign.27.37, %constant_5000_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.37"}
  %constant_5001_20 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.38 = s32[1]{0} and(%maximum.47.38, %constant_5001_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.38"}
  %compare.1615.38 = pred[1]{0} compare(%and.301.38, %constant_2102_28), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.38"}
  %and.302.37 = pred[1]{0} and(%compare.1614.37, %compare.1615.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.37"}
  %constant_5002_19 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.37 = s32[1]{0} shift-right-logical(%maximum.47.38, %constant_5002_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.37"}
  %constant_5003_19 = s32[1]{0} constant({-1})
  %add.2882.37 = s32[1]{0} add(%shift-right-logical.20.37, %constant_5003_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.37"}
  %select.1263.37 = s32[1]{0} select(%and.302.37, %add.2882.37, %shift-right-logical.20.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.37"}
  %compare.1616.37 = pred[1]{0} compare(%select.1263.37, %constant_2102_28), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.37"}
  %add.2883.37 = s32[1]{0} add(%select.1263.37, %constant_5002_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.37"}
  %select.1264.37 = s32[1]{0} select(%compare.1616.37, %add.2883.37, %select.1263.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.37"}
  %bitcast.20992.45 = s32[1,1]{1,0} bitcast(%select.1264.37), metadata={scheduling_name="bitcast.20992.45"}
  %constant_1627_111 = s32[] constant(0)
  %pad.345.25 = s32[1,2]{1,0} pad(%bitcast.20992.45, %constant_1627_111), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.25"}
  %pad.346.23 = s32[1,3]{1,0} pad(%pad.345.25, %constant_1627_111), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.23"}
  %bitcast.21099.20 = s32[3]{0} bitcast(%pad.346.23), metadata={scheduling_name="bitcast.21099.20"}
  %slice.2376.17 = s32[1]{0} slice(%bitcast.21099.20), slice={[1:2]}, metadata={scheduling_name="slice.2376.17"}
  %bitcast.23800.7 = s32[] bitcast(%slice.2376.17), metadata={scheduling_name="bitcast.23800.7"}
  ROOT %dynamic-update-slice.408.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.453, %convert.4147.3, %bitcast.23800.7, %constant_1627_111, %constant_1627_111), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.408.1"}
}

%fused_dynamic_update_slice.16 (param_0.454: bf16[2,1,6144], param_1.2471: bf16[1,1,6144], param_2.1820: bf16[6144], param_3.1410: pred[], param_4.1359: s32[16], param_5.1251: u32[], param_6.1232: s32[9], param_7.1160: s32[]) -> bf16[2,1,6144] {
  %param_0.454 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.454"}
  %param_1.2471 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2471"}
  %convert.4148.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2471), metadata={scheduling_name="convert.4148.3"}
  %param_3.1410 = pred[] parameter(3), metadata={scheduling_name="param_3.1410"}
  %broadcast.5628.4 = pred[1,6144]{1,0} broadcast(%param_3.1410), dimensions={}, metadata={scheduling_name="broadcast.5628.4"}
  %param_2.1820 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1820"}
  %bitcast.23832.3 = bf16[1,6144]{1,0} bitcast(%param_2.1820), metadata={scheduling_name="bitcast.23832.3"}
  %constant_1623_12 = bf16[] constant(0)
  %broadcast.5629.4 = bf16[1,6144]{1,0} broadcast(%constant_1623_12), dimensions={}, metadata={scheduling_name="broadcast.5629.4"}
  %select.1297.3 = bf16[1,6144]{1,0} select(%broadcast.5628.4, %bitcast.23832.3, %broadcast.5629.4), metadata={scheduling_name="select.1297.3"}
  %bitcast.23838.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1297.3), metadata={scheduling_name="bitcast.23838.7"}
  %convert.4157.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23838.7), metadata={scheduling_name="convert.4157.7"}
  %add.2951.5 = f32[1,1,6144]{2,1,0} add(%convert.4148.3, %convert.4157.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2951.5"}
  %convert.4159.3 = bf16[1,1,6144]{2,1,0} convert(%add.2951.5), metadata={scheduling_name="convert.4159.3"}
  %param_6.1232 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1232"}
  %constant_1624_56 = s32[] constant(8)
  %param_7.1160 = s32[] parameter(7), metadata={scheduling_name="param_7.1160"}
  %subtract.247.69 = s32[] subtract(%constant_1624_56, %param_7.1160), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.69"}
  %dynamic-slice.1376.50 = s32[1]{0} dynamic-slice(%param_6.1232, %subtract.247.69), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.50"}
  %param_4.1359 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1359"}
  %param_5.1251 = u32[] parameter(5), metadata={scheduling_name="param_5.1251"}
  %dynamic-slice.1377.45 = s32[1]{0} dynamic-slice(%param_4.1359, %param_5.1251), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.45"}
  %subtract.248.40 = s32[1]{0} subtract(%dynamic-slice.1376.50, %dynamic-slice.1377.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.40"}
  %constant_2102_29 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.40 = s32[1]{0} maximum(%subtract.248.40, %constant_2102_29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.40"}
  %sign.27.39 = s32[1]{0} sign(%maximum.47.40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.39"}
  %constant_5000_23 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.39 = pred[1]{0} compare(%sign.27.39, %constant_5000_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.39"}
  %constant_5001_21 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.40 = s32[1]{0} and(%maximum.47.40, %constant_5001_21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.40"}
  %compare.1615.40 = pred[1]{0} compare(%and.301.40, %constant_2102_29), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.40"}
  %and.302.39 = pred[1]{0} and(%compare.1614.39, %compare.1615.40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.39"}
  %constant_5002_20 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.39 = s32[1]{0} shift-right-logical(%maximum.47.40, %constant_5002_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.39"}
  %constant_5003_20 = s32[1]{0} constant({-1})
  %add.2882.39 = s32[1]{0} add(%shift-right-logical.20.39, %constant_5003_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.39"}
  %select.1263.39 = s32[1]{0} select(%and.302.39, %add.2882.39, %shift-right-logical.20.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.39"}
  %compare.1616.39 = pred[1]{0} compare(%select.1263.39, %constant_2102_29), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.39"}
  %add.2883.39 = s32[1]{0} add(%select.1263.39, %constant_5002_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.39"}
  %select.1264.39 = s32[1]{0} select(%compare.1616.39, %add.2883.39, %select.1263.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.39"}
  %bitcast.20992.47 = s32[1,1]{1,0} bitcast(%select.1264.39), metadata={scheduling_name="bitcast.20992.47"}
  %constant_1627_55 = s32[] constant(0)
  %pad.345.27 = s32[1,2]{1,0} pad(%bitcast.20992.47, %constant_1627_55), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.27"}
  %pad.346.25 = s32[1,3]{1,0} pad(%pad.345.27, %constant_1627_55), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.25"}
  %bitcast.21099.22 = s32[3]{0} bitcast(%pad.346.25), metadata={scheduling_name="bitcast.21099.22"}
  %slice.2376.19 = s32[1]{0} slice(%bitcast.21099.22), slice={[1:2]}, metadata={scheduling_name="slice.2376.19"}
  %bitcast.23800.8 = s32[] bitcast(%slice.2376.19), metadata={scheduling_name="bitcast.23800.8"}
  ROOT %dynamic-update-slice.409.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.454, %convert.4159.3, %bitcast.23800.8, %constant_1627_55, %constant_1627_55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.409.1"}
}

%fused_dynamic_slice.19 (param_0.457: bf16[2,1,6144], param_1.2574: s32[16], param_2.1957: u32[], param_3.1597: s32[9], param_4.1343: s32[], param_5.2666: bf16[2,1,768,8], param_6.2450: bf16[2,1,768,8], param_7.2262: bf16[2,1,768,8], param_8.2107: bf16[2,1,768,8], param_9.1838: bf16[2,1,6144], param_10.1458: bf16[2,1,6144], param_11.1364: bf16[2,1,6144]) -> (bf16[1,1,6144], bf16[1,1,768,8], bf16[1,1,768,8], bf16[1,1,768,8], bf16[1,1,768,8], /*index=5*/bf16[1,1,6144], bf16[1,1,6144], bf16[1,1,6144]) {
  %param_0.457 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.457"}
  %param_3.1597 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1597"}
  %constant_1624_38 = s32[] constant(8)
  %param_4.1343 = s32[] parameter(4), metadata={scheduling_name="param_4.1343"}
  %subtract.247.33 = s32[] subtract(%constant_1624_38, %param_4.1343), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.33"}
  %dynamic-slice.1376.14 = s32[1]{0} dynamic-slice(%param_3.1597, %subtract.247.33), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.14"}
  %param_1.2574 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1.2574"}
  %param_2.1957 = u32[] parameter(2), metadata={scheduling_name="param_2.1957"}
  %dynamic-slice.1377.9 = s32[1]{0} dynamic-slice(%param_1.2574, %param_2.1957), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.9"}
  %subtract.248.4 = s32[1]{0} subtract(%dynamic-slice.1376.14, %dynamic-slice.1377.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.4"}
  %constant_2102_12 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.4 = s32[1]{0} maximum(%subtract.248.4, %constant_2102_12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.4"}
  %sign.27.3 = s32[1]{0} sign(%maximum.47.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.3"}
  %constant_5000_5 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.3 = pred[1]{0} compare(%sign.27.3, %constant_5000_5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.3"}
  %constant_5001_3 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.4 = s32[1]{0} and(%maximum.47.4, %constant_5001_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.4"}
  %compare.1615.4 = pred[1]{0} compare(%and.301.4, %constant_2102_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.4"}
  %and.302.3 = pred[1]{0} and(%compare.1614.3, %compare.1615.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.3"}
  %constant_5002_2 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.3 = s32[1]{0} shift-right-logical(%maximum.47.4, %constant_5002_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.3"}
  %constant_5003_2 = s32[1]{0} constant({-1})
  %add.2882.3 = s32[1]{0} add(%shift-right-logical.20.3, %constant_5003_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.3"}
  %select.1263.3 = s32[1]{0} select(%and.302.3, %add.2882.3, %shift-right-logical.20.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.3"}
  %compare.1616.3 = pred[1]{0} compare(%select.1263.3, %constant_2102_12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.3"}
  %add.2883.3 = s32[1]{0} add(%select.1263.3, %constant_5002_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.3"}
  %select.1264.3 = s32[1]{0} select(%compare.1616.3, %add.2883.3, %select.1263.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.3"}
  %bitcast.20992.53 = s32[1,1]{1,0} bitcast(%select.1264.3), metadata={scheduling_name="bitcast.20992.53"}
  %constant_1627_93 = s32[] constant(0)
  %pad.345.33 = s32[1,2]{1,0} pad(%bitcast.20992.53, %constant_1627_93), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.33"}
  %pad.346.31 = s32[1,3]{1,0} pad(%pad.345.33, %constant_1627_93), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.31"}
  %bitcast.21099.28 = s32[3]{0} bitcast(%pad.346.31), metadata={scheduling_name="bitcast.21099.28"}
  %slice.2376.25 = s32[1]{0} slice(%bitcast.21099.28), slice={[1:2]}, metadata={scheduling_name="slice.2376.25"}
  %bitcast.23800.11 = s32[] bitcast(%slice.2376.25), metadata={scheduling_name="bitcast.23800.11"}
  %dynamic-slice.1424.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_0.457, %bitcast.23800.11, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1424.1"}
  %param_5.2666 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2666"}
  %constant_5004_2_clone_1 = s32[1,1]{1,0} constant({ {0} })
  %concatenate.699.17.clone.1 = s32[1,4]{1,0} concatenate(%constant_5004_2_clone_1, %bitcast.20992.53, %constant_5004_2_clone_1, %constant_5004_2_clone_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.17.clone.1"}
  %bitcast.20995.14.clone.1 = s32[4]{0} bitcast(%concatenate.699.17.clone.1), metadata={scheduling_name="bitcast.20995.14.clone.1"}
  %slice.2373.13.clone.1 = s32[1]{0} slice(%bitcast.20995.14.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2373.13.clone.1"}
  %bitcast.23627.5.clone.1 = s32[] bitcast(%slice.2373.13.clone.1), metadata={scheduling_name="bitcast.23627.5.clone.1"}
  %dynamic-slice.1378.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_5.2666, %bitcast.23627.5.clone.1, %constant_1627_93, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1378.1.clone.1"}
  %param_6.2450 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2450"}
  %dynamic-slice.1420.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_6.2450, %bitcast.23627.5.clone.1, %constant_1627_93, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1420.1.clone.1"}
  %param_7.2262 = bf16[2,1,768,8]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2262"}
  %dynamic-slice.1383.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_7.2262, %bitcast.23627.5.clone.1, %constant_1627_93, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1383.1.clone.1"}
  %param_8.2107 = bf16[2,1,768,8]{3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2107"}
  %dynamic-slice.1391.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_8.2107, %bitcast.23627.5.clone.1, %constant_1627_93, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1391.1.clone.1"}
  %param_9.1838 = bf16[2,1,6144]{2,1,0} parameter(9), metadata={scheduling_name="param_9.1838"}
  %dynamic-slice.1425.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_9.1838, %bitcast.23800.11, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1425.1.clone.1"}
  %param_10.1458 = bf16[2,1,6144]{2,1,0} parameter(10), metadata={scheduling_name="param_10.1458"}
  %dynamic-slice.1408.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_10.1458, %bitcast.23800.11, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1408.1.clone.1"}
  %param_11.1364 = bf16[2,1,6144]{2,1,0} parameter(11), metadata={scheduling_name="param_11.1364"}
  %dynamic-slice.1409.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_11.1364, %bitcast.23800.11, %constant_1627_93, %constant_1627_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1409.1.clone.1"}
  ROOT %tuple.524 = (bf16[1,1,6144]{2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, /*index=5*/bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}) tuple(%dynamic-slice.1424.1, %dynamic-slice.1378.1.clone.1, %dynamic-slice.1420.1.clone.1, %dynamic-slice.1383.1.clone.1, %dynamic-slice.1391.1.clone.1, /*index=5*/%dynamic-slice.1425.1.clone.1, %dynamic-slice.1408.1.clone.1, %dynamic-slice.1409.1.clone.1), metadata={scheduling_name="tuple.524"}
}

%fused_rsqrt.7 (param_0.2398: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2398 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2398"}
  %bitcast.21076.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2398), metadata={scheduling_name="bitcast.21076.7"}
  %constant_1652_2 = f32[] constant(0.000162760422)
  %broadcast.5527.28 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_2), dimensions={}, metadata={scheduling_name="broadcast.5527.28"}
  %multiply.2547.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21076.7, %broadcast.5527.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2547.7"}
  %constant_1653_2 = f32[] constant(1e-05)
  %broadcast.5528.20 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_2), dimensions={}, metadata={scheduling_name="broadcast.5528.20"}
  %add.2884.5 = f32[1,4,8192]{2,1,0} add(%multiply.2547.7, %broadcast.5528.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2884.5"}
  %bitcast.21084.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2884.5), metadata={scheduling_name="bitcast.21084.1"}
  ROOT %rsqrt.95.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.21084.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.95.1"}
}

%fused_reduce.12 (param_0.2392: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.2392 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2392"}
  %bitcast.21065.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2392), metadata={scheduling_name="bitcast.21065.21"}
  %convert.3885.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21065.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3885.21"}
  %multiply.2546.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3885.21, %convert.3885.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2546.3"}
  %bitcast.21072.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2546.3), metadata={scheduling_name="bitcast.21072.1"}
  %constant_1651_4 = f32[] constant(0)
  ROOT %reduce.403.1 = f32[4,8192]{1,0} reduce(%bitcast.21072.1, %constant_1651_4), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.403.1"}
}

%fused_dynamic_slice.20 (param_0.476: bf16[2,1,1,6144,16384], param_1.2596: s32[16], param_2.2012: u32[], param_3.1656: s32[9], param_4.1410: s32[], param_5.2668: bf16[2,1,1,16384,6144], param_6.2463: bf16[2,1,1,6144,16384], param_7.2297: bf16[2,1,1,6144,16384], param_8.2157: bf16[2,1,1,6144,16384], param_9.1902: bf16[2,1,1,16384,6144], param_10.1537: bf16[2,1,1,6144,16384], param_11.1446: bf16[2,1,1,6144,16384], param_12.1192: bf16[2,1,1,16384,6144], param_13.909: bf16[2,1,1,6144,16384], param_14.655: bf16[2,1,1,6144,16384], param_15.401: bf16[2,1,1,16384,6144]) -> (bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], /*index=5*/bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], /*index=10*/bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144]) {
  %param_0.476 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.476"}
  %constant_5004_14 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1656 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1656"}
  %constant_1624_64 = s32[] constant(8)
  %param_4.1410 = s32[] parameter(4), metadata={scheduling_name="param_4.1410"}
  %subtract.247.85 = s32[] subtract(%constant_1624_64, %param_4.1410), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.85"}
  %dynamic-slice.1376.66 = s32[1]{0} dynamic-slice(%param_3.1656, %subtract.247.85), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.66"}
  %param_1.2596 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1.2596"}
  %param_2.2012 = u32[] parameter(2), metadata={scheduling_name="param_2.2012"}
  %dynamic-slice.1377.61 = s32[1]{0} dynamic-slice(%param_1.2596, %param_2.2012), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.61"}
  %subtract.248.56 = s32[1]{0} subtract(%dynamic-slice.1376.66, %dynamic-slice.1377.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.56"}
  %constant_2102_36 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.56 = s32[1]{0} maximum(%subtract.248.56, %constant_2102_36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.56"}
  %sign.27.55 = s32[1]{0} sign(%maximum.47.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.55"}
  %constant_5000_31 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.55 = pred[1]{0} compare(%sign.27.55, %constant_5000_31), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.55"}
  %constant_5001_29 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.56 = s32[1]{0} and(%maximum.47.56, %constant_5001_29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.56"}
  %compare.1615.56 = pred[1]{0} compare(%and.301.56, %constant_2102_36), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.56"}
  %and.302.55 = pred[1]{0} and(%compare.1614.55, %compare.1615.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.55"}
  %constant_5002_28 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.55 = s32[1]{0} shift-right-logical(%maximum.47.56, %constant_5002_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.55"}
  %constant_5003_28 = s32[1]{0} constant({-1})
  %add.2882.55 = s32[1]{0} add(%shift-right-logical.20.55, %constant_5003_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.55"}
  %select.1263.55 = s32[1]{0} select(%and.302.55, %add.2882.55, %shift-right-logical.20.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.55"}
  %compare.1616.55 = pred[1]{0} compare(%select.1263.55, %constant_2102_36), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.55"}
  %add.2883.55 = s32[1]{0} add(%select.1263.55, %constant_5002_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.55"}
  %select.1264.55 = s32[1]{0} select(%compare.1616.55, %add.2883.55, %select.1263.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.55"}
  %bitcast.20992.65 = s32[1,1]{1,0} bitcast(%select.1264.55), metadata={scheduling_name="bitcast.20992.65"}
  %concatenate.701.13 = s32[1,5]{1,0} concatenate(%constant_5004_14, %bitcast.20992.65, %constant_5004_14, %constant_5004_14, %constant_5004_14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.13"}
  %bitcast.21040.12 = s32[5]{0} bitcast(%concatenate.701.13), metadata={scheduling_name="bitcast.21040.12"}
  %slice.2375.9 = s32[1]{0} slice(%bitcast.21040.12), slice={[1:2]}, metadata={scheduling_name="slice.2375.9"}
  %bitcast.23961.3 = s32[] bitcast(%slice.2375.9), metadata={scheduling_name="bitcast.23961.3"}
  %constant_1627_69 = s32[] constant(0)
  %dynamic-slice.1392.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.476, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1392.1"}
  %param_5.2668 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2668"}
  %dynamic-slice.1393.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_5.2668, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1393.1.clone.1"}
  %param_6.2463 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2463"}
  %dynamic-slice.1394.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_6.2463, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1394.1.clone.1"}
  %param_7.2297 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2297"}
  %dynamic-slice.1402.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_7.2297, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1402.1.clone.1"}
  %param_8.2157 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2157"}
  %dynamic-slice.1403.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_8.2157, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1403.1.clone.1"}
  %param_9.1902 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1902"}
  %dynamic-slice.1404.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_9.1902, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1404.1.clone.1"}
  %param_10.1537 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1537"}
  %dynamic-slice.1405.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_10.1537, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1405.1.clone.1"}
  %param_11.1446 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1446"}
  %dynamic-slice.1406.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_11.1446, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1406.1.clone.1"}
  %param_12.1192 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(12), metadata={scheduling_name="param_12.1192"}
  %dynamic-slice.1407.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_12.1192, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1407.1.clone.1"}
  %param_13.909 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(13), metadata={scheduling_name="param_13.909"}
  %dynamic-slice.1421.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_13.909, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1421.1.clone.1"}
  %param_14.655 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(14), metadata={scheduling_name="param_14.655"}
  %dynamic-slice.1422.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_14.655, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1422.1.clone.1"}
  %param_15.401 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(15), metadata={scheduling_name="param_15.401"}
  %dynamic-slice.1423.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_15.401, %bitcast.23961.3, %constant_1627_69, %constant_1627_69, %constant_1627_69, /*index=5*/%constant_1627_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1423.1.clone.1"}
  ROOT %tuple.542 = (bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=10*/bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}) tuple(%dynamic-slice.1392.1, %dynamic-slice.1393.1.clone.1, %dynamic-slice.1394.1.clone.1, %dynamic-slice.1402.1.clone.1, %dynamic-slice.1403.1.clone.1, /*index=5*/%dynamic-slice.1404.1.clone.1, %dynamic-slice.1405.1.clone.1, %dynamic-slice.1406.1.clone.1, %dynamic-slice.1407.1.clone.1, %dynamic-slice.1421.1.clone.1, /*index=10*/%dynamic-slice.1422.1.clone.1, %dynamic-slice.1423.1.clone.1), metadata={scheduling_name="tuple.542"}
}

%fused_dynamic_update_slice.17 (param_0.485: bf16[2,1,1,6144,16384], param_1.2467: bf16[1,1,1,6144,16384], param_2.1816: bf16[6144,16384], param_3.1406: pred[], param_4.1419: s32[16], param_5.1299: u32[], param_6.1253: s32[9], param_7.1179: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.485 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.485"}
  %param_1.2467 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2467"}
  %convert.4027.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2467), metadata={scheduling_name="convert.4027.3"}
  %param_3.1406 = pred[] parameter(3), metadata={scheduling_name="param_3.1406"}
  %broadcast.5621.12 = pred[6144,16384]{1,0} broadcast(%param_3.1406), dimensions={}, metadata={scheduling_name="broadcast.5621.12"}
  %param_2.1816 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1816"}
  %constant_1623_23 = bf16[] constant(0)
  %broadcast.5623.12 = bf16[6144,16384]{1,0} broadcast(%constant_1623_23), dimensions={}, metadata={scheduling_name="broadcast.5623.12"}
  %select.1283.3 = bf16[6144,16384]{1,0} select(%broadcast.5621.12, %param_2.1816, %broadcast.5623.12), metadata={scheduling_name="select.1283.3"}
  %bitcast.22887.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1283.3), metadata={scheduling_name="bitcast.22887.7"}
  %convert.4033.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.22887.7), metadata={scheduling_name="convert.4033.7"}
  %add.2927.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4027.3, %convert.4033.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2927.5"}
  %convert.4034.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.2927.5), metadata={scheduling_name="convert.4034.3"}
  %constant_5004_23 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1253 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1253"}
  %constant_1624_73 = s32[] constant(8)
  %param_7.1179 = s32[] parameter(7), metadata={scheduling_name="param_7.1179"}
  %subtract.247.103 = s32[] subtract(%constant_1624_73, %param_7.1179), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.103"}
  %dynamic-slice.1376.84 = s32[1]{0} dynamic-slice(%param_6.1253, %subtract.247.103), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.84"}
  %param_4.1419 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1419"}
  %param_5.1299 = u32[] parameter(5), metadata={scheduling_name="param_5.1299"}
  %dynamic-slice.1377.79 = s32[1]{0} dynamic-slice(%param_4.1419, %param_5.1299), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.79"}
  %subtract.248.74 = s32[1]{0} subtract(%dynamic-slice.1376.84, %dynamic-slice.1377.79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.74"}
  %constant_2102_45 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.74 = s32[1]{0} maximum(%subtract.248.74, %constant_2102_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.74"}
  %sign.27.73 = s32[1]{0} sign(%maximum.47.74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.73"}
  %constant_5000_40 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.73 = pred[1]{0} compare(%sign.27.73, %constant_5000_40), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.73"}
  %constant_5001_38 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.74 = s32[1]{0} and(%maximum.47.74, %constant_5001_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.74"}
  %compare.1615.74 = pred[1]{0} compare(%and.301.74, %constant_2102_45), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.74"}
  %and.302.73 = pred[1]{0} and(%compare.1614.73, %compare.1615.74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.73"}
  %constant_5002_37 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.73 = s32[1]{0} shift-right-logical(%maximum.47.74, %constant_5002_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.73"}
  %constant_5003_37 = s32[1]{0} constant({-1})
  %add.2882.73 = s32[1]{0} add(%shift-right-logical.20.73, %constant_5003_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.73"}
  %select.1263.73 = s32[1]{0} select(%and.302.73, %add.2882.73, %shift-right-logical.20.73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.73"}
  %compare.1616.73 = pred[1]{0} compare(%select.1263.73, %constant_2102_45), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.73"}
  %add.2883.73 = s32[1]{0} add(%select.1263.73, %constant_5002_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.73"}
  %select.1264.73 = s32[1]{0} select(%compare.1616.73, %add.2883.73, %select.1263.73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.73"}
  %bitcast.20992.83 = s32[1,1]{1,0} bitcast(%select.1264.73), metadata={scheduling_name="bitcast.20992.83"}
  %concatenate.701.31 = s32[1,5]{1,0} concatenate(%constant_5004_23, %bitcast.20992.83, %constant_5004_23, %constant_5004_23, %constant_5004_23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.31"}
  %bitcast.21040.30 = s32[5]{0} bitcast(%concatenate.701.31), metadata={scheduling_name="bitcast.21040.30"}
  %slice.2375.27 = s32[1]{0} slice(%bitcast.21040.30), slice={[1:2]}, metadata={scheduling_name="slice.2375.27"}
  %bitcast.23961.12 = s32[] bitcast(%slice.2375.27), metadata={scheduling_name="bitcast.23961.12"}
  %constant_1627_51 = s32[] constant(0)
  ROOT %dynamic-update-slice.395.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.485, %convert.4034.3, %bitcast.23961.12, %constant_1627_51, %constant_1627_51, /*index=5*/%constant_1627_51, %constant_1627_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.395.1"}
}

%fused_dynamic_update_slice.18 (param_0.486: bf16[2,1,1,6144,16384], param_1.2439: bf16[1,1,1,6144,16384], param_2.1787: bf16[6144,16384], param_3.1375: pred[], param_4.1420: s32[16], param_5.1300: u32[], param_6.1254: s32[9], param_7.1180: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.486 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.486"}
  %param_1.2439 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2439"}
  %convert.4035.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2439), metadata={scheduling_name="convert.4035.3"}
  %param_3.1375 = pred[] parameter(3), metadata={scheduling_name="param_3.1375"}
  %broadcast.5621.10 = pred[6144,16384]{1,0} broadcast(%param_3.1375), dimensions={}, metadata={scheduling_name="broadcast.5621.10"}
  %param_2.1787 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1787"}
  %constant_1623_24 = bf16[] constant(0)
  %broadcast.5623.10 = bf16[6144,16384]{1,0} broadcast(%constant_1623_24), dimensions={}, metadata={scheduling_name="broadcast.5623.10"}
  %select.1284.3 = bf16[6144,16384]{1,0} select(%broadcast.5621.10, %param_2.1787, %broadcast.5623.10), metadata={scheduling_name="select.1284.3"}
  %bitcast.22922.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1284.3), metadata={scheduling_name="bitcast.22922.7"}
  %convert.4038.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.22922.7), metadata={scheduling_name="convert.4038.7"}
  %add.2928.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4035.3, %convert.4038.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2928.5"}
  %convert.4039.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.2928.5), metadata={scheduling_name="convert.4039.3"}
  %constant_5004_24 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1254 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1254"}
  %constant_1624_74 = s32[] constant(8)
  %param_7.1180 = s32[] parameter(7), metadata={scheduling_name="param_7.1180"}
  %subtract.247.105 = s32[] subtract(%constant_1624_74, %param_7.1180), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.105"}
  %dynamic-slice.1376.86 = s32[1]{0} dynamic-slice(%param_6.1254, %subtract.247.105), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.86"}
  %param_4.1420 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1420"}
  %param_5.1300 = u32[] parameter(5), metadata={scheduling_name="param_5.1300"}
  %dynamic-slice.1377.81 = s32[1]{0} dynamic-slice(%param_4.1420, %param_5.1300), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.81"}
  %subtract.248.76 = s32[1]{0} subtract(%dynamic-slice.1376.86, %dynamic-slice.1377.81), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.76"}
  %constant_2102_46 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.76 = s32[1]{0} maximum(%subtract.248.76, %constant_2102_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.76"}
  %sign.27.75 = s32[1]{0} sign(%maximum.47.76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.75"}
  %constant_5000_41 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.75 = pred[1]{0} compare(%sign.27.75, %constant_5000_41), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.75"}
  %constant_5001_39 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.76 = s32[1]{0} and(%maximum.47.76, %constant_5001_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.76"}
  %compare.1615.76 = pred[1]{0} compare(%and.301.76, %constant_2102_46), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.76"}
  %and.302.75 = pred[1]{0} and(%compare.1614.75, %compare.1615.76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.75"}
  %constant_5002_38 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.75 = s32[1]{0} shift-right-logical(%maximum.47.76, %constant_5002_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.75"}
  %constant_5003_38 = s32[1]{0} constant({-1})
  %add.2882.75 = s32[1]{0} add(%shift-right-logical.20.75, %constant_5003_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.75"}
  %select.1263.75 = s32[1]{0} select(%and.302.75, %add.2882.75, %shift-right-logical.20.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.75"}
  %compare.1616.75 = pred[1]{0} compare(%select.1263.75, %constant_2102_46), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.75"}
  %add.2883.75 = s32[1]{0} add(%select.1263.75, %constant_5002_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.75"}
  %select.1264.75 = s32[1]{0} select(%compare.1616.75, %add.2883.75, %select.1263.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.75"}
  %bitcast.20992.85 = s32[1,1]{1,0} bitcast(%select.1264.75), metadata={scheduling_name="bitcast.20992.85"}
  %concatenate.701.33 = s32[1,5]{1,0} concatenate(%constant_5004_24, %bitcast.20992.85, %constant_5004_24, %constant_5004_24, %constant_5004_24), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.33"}
  %bitcast.21040.32 = s32[5]{0} bitcast(%concatenate.701.33), metadata={scheduling_name="bitcast.21040.32"}
  %slice.2375.29 = s32[1]{0} slice(%bitcast.21040.32), slice={[1:2]}, metadata={scheduling_name="slice.2375.29"}
  %bitcast.23961.13 = s32[] bitcast(%slice.2375.29), metadata={scheduling_name="bitcast.23961.13"}
  %constant_1627_8 = s32[] constant(0)
  ROOT %dynamic-update-slice.396.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.486, %convert.4039.3, %bitcast.23961.13, %constant_1627_8, %constant_1627_8, /*index=5*/%constant_1627_8, %constant_1627_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.396.1"}
}

%fused_dynamic_update_slice.19 (param_0.487: bf16[2,1,1,16384,6144], param_1.2473: bf16[16384,6144], param_2.1823: bf16[1,1,1,16384,6144], param_3.1413: pred[], param_4.1421: s32[16], param_5.1301: u32[], param_6.1255: s32[9], param_7.1181: s32[]) -> bf16[2,1,1,16384,6144] {
  %param_0.487 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.487"}
  %param_2.1823 = bf16[1,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1823"}
  %convert.4040.3 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.1823), metadata={scheduling_name="convert.4040.3"}
  %param_3.1413 = pred[] parameter(3), metadata={scheduling_name="param_3.1413"}
  %broadcast.5625.2 = pred[16384,6144]{1,0} broadcast(%param_3.1413), dimensions={}, metadata={scheduling_name="broadcast.5625.2"}
  %param_1.2473 = bf16[16384,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2473"}
  %constant_1623_25 = bf16[] constant(0)
  %broadcast.5626.10 = bf16[16384,6144]{1,0} broadcast(%constant_1623_25), dimensions={}, metadata={scheduling_name="broadcast.5626.10"}
  %select.1285.5 = bf16[16384,6144]{1,0} select(%broadcast.5625.2, %param_1.2473, %broadcast.5626.10), metadata={scheduling_name="select.1285.5"}
  %bitcast.22953.7 = bf16[1,1,1,16384,6144]{4,3,2,1,0} bitcast(%select.1285.5), metadata={scheduling_name="bitcast.22953.7"}
  %convert.4041.7 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%bitcast.22953.7), metadata={scheduling_name="convert.4041.7"}
  %add.2929.5 = f32[1,1,1,16384,6144]{4,3,2,1,0} add(%convert.4040.3, %convert.4041.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2929.5"}
  %convert.4042.3 = bf16[1,1,1,16384,6144]{4,3,2,1,0} convert(%add.2929.5), metadata={scheduling_name="convert.4042.3"}
  %constant_5004_25 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1255 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1255"}
  %constant_1624_75 = s32[] constant(8)
  %param_7.1181 = s32[] parameter(7), metadata={scheduling_name="param_7.1181"}
  %subtract.247.107 = s32[] subtract(%constant_1624_75, %param_7.1181), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.107"}
  %dynamic-slice.1376.88 = s32[1]{0} dynamic-slice(%param_6.1255, %subtract.247.107), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.88"}
  %param_4.1421 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1421"}
  %param_5.1301 = u32[] parameter(5), metadata={scheduling_name="param_5.1301"}
  %dynamic-slice.1377.83 = s32[1]{0} dynamic-slice(%param_4.1421, %param_5.1301), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.83"}
  %subtract.248.78 = s32[1]{0} subtract(%dynamic-slice.1376.88, %dynamic-slice.1377.83), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.78"}
  %constant_2102_47 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.78 = s32[1]{0} maximum(%subtract.248.78, %constant_2102_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.78"}
  %sign.27.77 = s32[1]{0} sign(%maximum.47.78), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.77"}
  %constant_5000_42 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.77 = pred[1]{0} compare(%sign.27.77, %constant_5000_42), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.77"}
  %constant_5001_40 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.78 = s32[1]{0} and(%maximum.47.78, %constant_5001_40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.78"}
  %compare.1615.78 = pred[1]{0} compare(%and.301.78, %constant_2102_47), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.78"}
  %and.302.77 = pred[1]{0} and(%compare.1614.77, %compare.1615.78), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.77"}
  %constant_5002_39 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.77 = s32[1]{0} shift-right-logical(%maximum.47.78, %constant_5002_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.77"}
  %constant_5003_39 = s32[1]{0} constant({-1})
  %add.2882.77 = s32[1]{0} add(%shift-right-logical.20.77, %constant_5003_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.77"}
  %select.1263.77 = s32[1]{0} select(%and.302.77, %add.2882.77, %shift-right-logical.20.77), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.77"}
  %compare.1616.77 = pred[1]{0} compare(%select.1263.77, %constant_2102_47), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.77"}
  %add.2883.77 = s32[1]{0} add(%select.1263.77, %constant_5002_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.77"}
  %select.1264.77 = s32[1]{0} select(%compare.1616.77, %add.2883.77, %select.1263.77), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.77"}
  %bitcast.20992.87 = s32[1,1]{1,0} bitcast(%select.1264.77), metadata={scheduling_name="bitcast.20992.87"}
  %concatenate.701.35 = s32[1,5]{1,0} concatenate(%constant_5004_25, %bitcast.20992.87, %constant_5004_25, %constant_5004_25, %constant_5004_25), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.35"}
  %bitcast.21040.34 = s32[5]{0} bitcast(%concatenate.701.35), metadata={scheduling_name="bitcast.21040.34"}
  %slice.2375.31 = s32[1]{0} slice(%bitcast.21040.34), slice={[1:2]}, metadata={scheduling_name="slice.2375.31"}
  %bitcast.23961.14 = s32[] bitcast(%slice.2375.31), metadata={scheduling_name="bitcast.23961.14"}
  %constant_1627_58 = s32[] constant(0)
  ROOT %dynamic-update-slice.397.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.487, %convert.4042.3, %bitcast.23961.14, %constant_1627_58, %constant_1627_58, /*index=5*/%constant_1627_58, %constant_1627_58), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.397.1"}
}

%fused_dynamic_update_slice.20 (param_0.491: bf16[2,1,768,8,128], param_1.2475: bf16[1,1,768,8,128], param_2.1825: bf16[1,8,128,768], param_3.1415: pred[], param_4.1425: s32[16], param_5.1302: u32[], param_6.1256: s32[9], param_7.1182: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.491 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.491"}
  %param_1.2475 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2475"}
  %convert.4110.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2475), metadata={scheduling_name="convert.4110.3"}
  %param_3.1415 = pred[] parameter(3), metadata={scheduling_name="param_3.1415"}
  %broadcast.5638.6 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1415), dimensions={}, metadata={scheduling_name="broadcast.5638.6"}
  %param_2.1825 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1825"}
  %bitcast.23497.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1825), metadata={scheduling_name="bitcast.23497.3"}
  %constant_1623_42 = bf16[] constant(0)
  %broadcast.5639.6 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1623_42), dimensions={}, metadata={scheduling_name="broadcast.5639.6"}
  %select.1288.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5638.6, %bitcast.23497.3, %broadcast.5639.6), metadata={scheduling_name="select.1288.3"}
  %bitcast.23503.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1288.3), metadata={scheduling_name="bitcast.23503.7"}
  %convert.4111.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23503.7), metadata={scheduling_name="convert.4111.7"}
  %add.2942.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4110.3, %convert.4111.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2942.5"}
  %convert.4112.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.2942.5), metadata={scheduling_name="convert.4112.3"}
  %constant_5004_29 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1256 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1256"}
  %constant_1624_79 = s32[] constant(8)
  %param_7.1182 = s32[] parameter(7), metadata={scheduling_name="param_7.1182"}
  %subtract.247.115 = s32[] subtract(%constant_1624_79, %param_7.1182), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.115"}
  %dynamic-slice.1376.96 = s32[1]{0} dynamic-slice(%param_6.1256, %subtract.247.115), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.96"}
  %param_4.1425 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1425"}
  %param_5.1302 = u32[] parameter(5), metadata={scheduling_name="param_5.1302"}
  %dynamic-slice.1377.91 = s32[1]{0} dynamic-slice(%param_4.1425, %param_5.1302), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.91"}
  %subtract.248.86 = s32[1]{0} subtract(%dynamic-slice.1376.96, %dynamic-slice.1377.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.86"}
  %constant_2102_51 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.86 = s32[1]{0} maximum(%subtract.248.86, %constant_2102_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.86"}
  %sign.27.85 = s32[1]{0} sign(%maximum.47.86), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.85"}
  %constant_5000_46 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.85 = pred[1]{0} compare(%sign.27.85, %constant_5000_46), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.85"}
  %constant_5001_44 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.86 = s32[1]{0} and(%maximum.47.86, %constant_5001_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.86"}
  %compare.1615.86 = pred[1]{0} compare(%and.301.86, %constant_2102_51), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.86"}
  %and.302.85 = pred[1]{0} and(%compare.1614.85, %compare.1615.86), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.85"}
  %constant_5002_43 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.85 = s32[1]{0} shift-right-logical(%maximum.47.86, %constant_5002_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.85"}
  %constant_5003_43 = s32[1]{0} constant({-1})
  %add.2882.85 = s32[1]{0} add(%shift-right-logical.20.85, %constant_5003_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.85"}
  %select.1263.85 = s32[1]{0} select(%and.302.85, %add.2882.85, %shift-right-logical.20.85), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.85"}
  %compare.1616.85 = pred[1]{0} compare(%select.1263.85, %constant_2102_51), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.85"}
  %add.2883.85 = s32[1]{0} add(%select.1263.85, %constant_5002_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.85"}
  %select.1264.85 = s32[1]{0} select(%compare.1616.85, %add.2883.85, %select.1263.85), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.85"}
  %bitcast.20992.95 = s32[1,1]{1,0} bitcast(%select.1264.85), metadata={scheduling_name="bitcast.20992.95"}
  %concatenate.701.43 = s32[1,5]{1,0} concatenate(%constant_5004_29, %bitcast.20992.95, %constant_5004_29, %constant_5004_29, %constant_5004_29), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.43"}
  %bitcast.21040.42 = s32[5]{0} bitcast(%concatenate.701.43), metadata={scheduling_name="bitcast.21040.42"}
  %slice.2375.39 = s32[1]{0} slice(%bitcast.21040.42), slice={[1:2]}, metadata={scheduling_name="slice.2375.39"}
  %bitcast.23961.18 = s32[] bitcast(%slice.2375.39), metadata={scheduling_name="bitcast.23961.18"}
  %constant_1627_60 = s32[] constant(0)
  ROOT %dynamic-update-slice.400.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.491, %convert.4112.3, %bitcast.23961.18, %constant_1627_60, %constant_1627_60, /*index=5*/%constant_1627_60, %constant_1627_60), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.400.1"}
}

%fused_dynamic_update_slice.21 (param_0.492: bf16[2,1,768,48,128], param_1.2469: bf16[1,1,768,48,128], param_2.1818: bf16[1,48,128,768], param_3.1408: pred[], param_4.1427: s32[16], param_5.1304: u32[], param_6.1258: s32[9], param_7.1184: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.492 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.492"}
  %param_1.2469 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2469"}
  %convert.4116.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2469), metadata={scheduling_name="convert.4116.3"}
  %param_3.1408 = pred[] parameter(3), metadata={scheduling_name="param_3.1408"}
  %broadcast.5640.8 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1408), dimensions={}, metadata={scheduling_name="broadcast.5640.8"}
  %param_2.1818 = bf16[1,48,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1818"}
  %bitcast.23574.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1818), metadata={scheduling_name="bitcast.23574.3"}
  %constant_1623_40 = bf16[] constant(0)
  %broadcast.5641.8 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1623_40), dimensions={}, metadata={scheduling_name="broadcast.5641.8"}
  %select.1290.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5640.8, %bitcast.23574.3, %broadcast.5641.8), metadata={scheduling_name="select.1290.3"}
  %bitcast.23580.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1290.3), metadata={scheduling_name="bitcast.23580.7"}
  %convert.4117.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23580.7), metadata={scheduling_name="convert.4117.7"}
  %add.2944.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4116.3, %convert.4117.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2944.5"}
  %convert.4118.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.2944.5), metadata={scheduling_name="convert.4118.3"}
  %constant_5004_31 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1258 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1258"}
  %constant_1624_81 = s32[] constant(8)
  %param_7.1184 = s32[] parameter(7), metadata={scheduling_name="param_7.1184"}
  %subtract.247.119 = s32[] subtract(%constant_1624_81, %param_7.1184), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.119"}
  %dynamic-slice.1376.100 = s32[1]{0} dynamic-slice(%param_6.1258, %subtract.247.119), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.100"}
  %param_4.1427 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1427"}
  %param_5.1304 = u32[] parameter(5), metadata={scheduling_name="param_5.1304"}
  %dynamic-slice.1377.95 = s32[1]{0} dynamic-slice(%param_4.1427, %param_5.1304), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.95"}
  %subtract.248.90 = s32[1]{0} subtract(%dynamic-slice.1376.100, %dynamic-slice.1377.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.90"}
  %constant_2102_53 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.90 = s32[1]{0} maximum(%subtract.248.90, %constant_2102_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.90"}
  %sign.27.89 = s32[1]{0} sign(%maximum.47.90), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.89"}
  %constant_5000_48 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.89 = pred[1]{0} compare(%sign.27.89, %constant_5000_48), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.89"}
  %constant_5001_46 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.90 = s32[1]{0} and(%maximum.47.90, %constant_5001_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.90"}
  %compare.1615.90 = pred[1]{0} compare(%and.301.90, %constant_2102_53), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.90"}
  %and.302.89 = pred[1]{0} and(%compare.1614.89, %compare.1615.90), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.89"}
  %constant_5002_45 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.89 = s32[1]{0} shift-right-logical(%maximum.47.90, %constant_5002_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.89"}
  %constant_5003_45 = s32[1]{0} constant({-1})
  %add.2882.89 = s32[1]{0} add(%shift-right-logical.20.89, %constant_5003_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.89"}
  %select.1263.89 = s32[1]{0} select(%and.302.89, %add.2882.89, %shift-right-logical.20.89), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.89"}
  %compare.1616.89 = pred[1]{0} compare(%select.1263.89, %constant_2102_53), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.89"}
  %add.2883.89 = s32[1]{0} add(%select.1263.89, %constant_5002_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.89"}
  %select.1264.89 = s32[1]{0} select(%compare.1616.89, %add.2883.89, %select.1263.89), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.89"}
  %bitcast.20992.99 = s32[1,1]{1,0} bitcast(%select.1264.89), metadata={scheduling_name="bitcast.20992.99"}
  %concatenate.701.47 = s32[1,5]{1,0} concatenate(%constant_5004_31, %bitcast.20992.99, %constant_5004_31, %constant_5004_31, %constant_5004_31), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.47"}
  %bitcast.21040.46 = s32[5]{0} bitcast(%concatenate.701.47), metadata={scheduling_name="bitcast.21040.46"}
  %slice.2375.43 = s32[1]{0} slice(%bitcast.21040.46), slice={[1:2]}, metadata={scheduling_name="slice.2375.43"}
  %bitcast.23961.20 = s32[] bitcast(%slice.2375.43), metadata={scheduling_name="bitcast.23961.20"}
  %constant_1627_53 = s32[] constant(0)
  ROOT %dynamic-update-slice.402.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%param_0.492, %convert.4118.3, %bitcast.23961.20, %constant_1627_53, %constant_1627_53, /*index=5*/%constant_1627_53, %constant_1627_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.402.1"}
}

%fused_dynamic_update_slice.22 (param_0.493: bf16[2,1,768,8,128], param_1.2465: bf16[1,1,768,8,128], param_2.1814: bf16[1,8,128,768], param_3.1404: pred[], param_4.1428: s32[16], param_5.1305: u32[], param_6.1259: s32[9], param_7.1185: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.493 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.493"}
  %param_1.2465 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2465"}
  %convert.4119.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2465), metadata={scheduling_name="convert.4119.3"}
  %param_3.1404 = pred[] parameter(3), metadata={scheduling_name="param_3.1404"}
  %broadcast.5638.8 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1404), dimensions={}, metadata={scheduling_name="broadcast.5638.8"}
  %param_2.1814 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1814"}
  %bitcast.23610.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1814), metadata={scheduling_name="bitcast.23610.3"}
  %constant_1623_43 = bf16[] constant(0)
  %broadcast.5639.8 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1623_43), dimensions={}, metadata={scheduling_name="broadcast.5639.8"}
  %select.1291.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5638.8, %bitcast.23610.3, %broadcast.5639.8), metadata={scheduling_name="select.1291.3"}
  %bitcast.23616.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1291.3), metadata={scheduling_name="bitcast.23616.7"}
  %convert.4120.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23616.7), metadata={scheduling_name="convert.4120.7"}
  %add.2945.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4119.3, %convert.4120.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2945.5"}
  %convert.4121.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.2945.5), metadata={scheduling_name="convert.4121.3"}
  %constant_5004_32 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1259 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1259"}
  %constant_1624_82 = s32[] constant(8)
  %param_7.1185 = s32[] parameter(7), metadata={scheduling_name="param_7.1185"}
  %subtract.247.121 = s32[] subtract(%constant_1624_82, %param_7.1185), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.121"}
  %dynamic-slice.1376.102 = s32[1]{0} dynamic-slice(%param_6.1259, %subtract.247.121), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.102"}
  %param_4.1428 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1428"}
  %param_5.1305 = u32[] parameter(5), metadata={scheduling_name="param_5.1305"}
  %dynamic-slice.1377.97 = s32[1]{0} dynamic-slice(%param_4.1428, %param_5.1305), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.97"}
  %subtract.248.92 = s32[1]{0} subtract(%dynamic-slice.1376.102, %dynamic-slice.1377.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.92"}
  %constant_2102_54 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.92 = s32[1]{0} maximum(%subtract.248.92, %constant_2102_54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.92"}
  %sign.27.91 = s32[1]{0} sign(%maximum.47.92), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.91"}
  %constant_5000_49 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.91 = pred[1]{0} compare(%sign.27.91, %constant_5000_49), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.91"}
  %constant_5001_47 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.92 = s32[1]{0} and(%maximum.47.92, %constant_5001_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.92"}
  %compare.1615.92 = pred[1]{0} compare(%and.301.92, %constant_2102_54), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.92"}
  %and.302.91 = pred[1]{0} and(%compare.1614.91, %compare.1615.92), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.91"}
  %constant_5002_46 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.91 = s32[1]{0} shift-right-logical(%maximum.47.92, %constant_5002_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.91"}
  %constant_5003_46 = s32[1]{0} constant({-1})
  %add.2882.91 = s32[1]{0} add(%shift-right-logical.20.91, %constant_5003_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.91"}
  %select.1263.91 = s32[1]{0} select(%and.302.91, %add.2882.91, %shift-right-logical.20.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.91"}
  %compare.1616.91 = pred[1]{0} compare(%select.1263.91, %constant_2102_54), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.91"}
  %add.2883.91 = s32[1]{0} add(%select.1263.91, %constant_5002_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.91"}
  %select.1264.91 = s32[1]{0} select(%compare.1616.91, %add.2883.91, %select.1263.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.91"}
  %bitcast.20992.101 = s32[1,1]{1,0} bitcast(%select.1264.91), metadata={scheduling_name="bitcast.20992.101"}
  %concatenate.701.49 = s32[1,5]{1,0} concatenate(%constant_5004_32, %bitcast.20992.101, %constant_5004_32, %constant_5004_32, %constant_5004_32), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.49"}
  %bitcast.21040.48 = s32[5]{0} bitcast(%concatenate.701.49), metadata={scheduling_name="bitcast.21040.48"}
  %slice.2375.45 = s32[1]{0} slice(%bitcast.21040.48), slice={[1:2]}, metadata={scheduling_name="slice.2375.45"}
  %bitcast.23961.21 = s32[] bitcast(%slice.2375.45), metadata={scheduling_name="bitcast.23961.21"}
  %constant_1627_49 = s32[] constant(0)
  ROOT %dynamic-update-slice.403.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.493, %convert.4121.3, %bitcast.23961.21, %constant_1627_49, %constant_1627_49, /*index=5*/%constant_1627_49, %constant_1627_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.403.1"}
}

%fused_dynamic_update_slice.23 (param_0.494: bf16[2,1,1,6144,16384], param_1.2490: bf16[1,1,1,6144,16384], param_2.1838: bf16[6144,16384], param_3.1430: pred[], param_4.1429: s32[16], param_5.1306: u32[], param_6.1260: s32[9], param_7.1186: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.494 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.494"}
  %param_1.2490 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2490"}
  %convert.4125.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2490), metadata={scheduling_name="convert.4125.3"}
  %param_3.1430 = pred[] parameter(3), metadata={scheduling_name="param_3.1430"}
  %broadcast.5621.8 = pred[6144,16384]{1,0} broadcast(%param_3.1430), dimensions={}, metadata={scheduling_name="broadcast.5621.8"}
  %param_2.1838 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1838"}
  %constant_1623_17 = bf16[] constant(0)
  %broadcast.5623.8 = bf16[6144,16384]{1,0} broadcast(%constant_1623_17), dimensions={}, metadata={scheduling_name="broadcast.5623.8"}
  %select.1293.3 = bf16[6144,16384]{1,0} select(%broadcast.5621.8, %param_2.1838, %broadcast.5623.8), metadata={scheduling_name="select.1293.3"}
  %bitcast.23682.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1293.3), metadata={scheduling_name="bitcast.23682.7"}
  %convert.4127.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23682.7), metadata={scheduling_name="convert.4127.7"}
  %add.2947.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4125.3, %convert.4127.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2947.5"}
  %convert.4128.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.2947.5), metadata={scheduling_name="convert.4128.3"}
  %constant_5004_33 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1260 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1260"}
  %constant_1624_83 = s32[] constant(8)
  %param_7.1186 = s32[] parameter(7), metadata={scheduling_name="param_7.1186"}
  %subtract.247.123 = s32[] subtract(%constant_1624_83, %param_7.1186), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.123"}
  %dynamic-slice.1376.104 = s32[1]{0} dynamic-slice(%param_6.1260, %subtract.247.123), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.104"}
  %param_4.1429 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1429"}
  %param_5.1306 = u32[] parameter(5), metadata={scheduling_name="param_5.1306"}
  %dynamic-slice.1377.99 = s32[1]{0} dynamic-slice(%param_4.1429, %param_5.1306), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.99"}
  %subtract.248.94 = s32[1]{0} subtract(%dynamic-slice.1376.104, %dynamic-slice.1377.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.94"}
  %constant_2102_55 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.94 = s32[1]{0} maximum(%subtract.248.94, %constant_2102_55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.94"}
  %sign.27.93 = s32[1]{0} sign(%maximum.47.94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.93"}
  %constant_5000_50 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.93 = pred[1]{0} compare(%sign.27.93, %constant_5000_50), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.93"}
  %constant_5001_48 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.94 = s32[1]{0} and(%maximum.47.94, %constant_5001_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.94"}
  %compare.1615.94 = pred[1]{0} compare(%and.301.94, %constant_2102_55), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.94"}
  %and.302.93 = pred[1]{0} and(%compare.1614.93, %compare.1615.94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.93"}
  %constant_5002_47 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.93 = s32[1]{0} shift-right-logical(%maximum.47.94, %constant_5002_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.93"}
  %constant_5003_47 = s32[1]{0} constant({-1})
  %add.2882.93 = s32[1]{0} add(%shift-right-logical.20.93, %constant_5003_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.93"}
  %select.1263.93 = s32[1]{0} select(%and.302.93, %add.2882.93, %shift-right-logical.20.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.93"}
  %compare.1616.93 = pred[1]{0} compare(%select.1263.93, %constant_2102_55), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.93"}
  %add.2883.93 = s32[1]{0} add(%select.1263.93, %constant_5002_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.93"}
  %select.1264.93 = s32[1]{0} select(%compare.1616.93, %add.2883.93, %select.1263.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.93"}
  %bitcast.20992.103 = s32[1,1]{1,0} bitcast(%select.1264.93), metadata={scheduling_name="bitcast.20992.103"}
  %concatenate.701.51 = s32[1,5]{1,0} concatenate(%constant_5004_33, %bitcast.20992.103, %constant_5004_33, %constant_5004_33, %constant_5004_33), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.51"}
  %bitcast.21040.50 = s32[5]{0} bitcast(%concatenate.701.51), metadata={scheduling_name="bitcast.21040.50"}
  %slice.2375.47 = s32[1]{0} slice(%bitcast.21040.50), slice={[1:2]}, metadata={scheduling_name="slice.2375.47"}
  %bitcast.23961.22 = s32[] bitcast(%slice.2375.47), metadata={scheduling_name="bitcast.23961.22"}
  %constant_1627_79 = s32[] constant(0)
  ROOT %dynamic-update-slice.405.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.494, %convert.4128.3, %bitcast.23961.22, %constant_1627_79, %constant_1627_79, /*index=5*/%constant_1627_79, %constant_1627_79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.405.1"}
}

%fused_dynamic_update_slice.24 (param_0.495: bf16[2,1,1,6144,16384], param_1.2441: bf16[1,1,1,6144,16384], param_2.1789: bf16[6144,16384], param_3.1378: pred[], param_4.1430: s32[16], param_5.1307: u32[], param_6.1261: s32[9], param_7.1187: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.495 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.495"}
  %param_1.2441 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2441"}
  %convert.4129.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2441), metadata={scheduling_name="convert.4129.3"}
  %param_3.1378 = pred[] parameter(3), metadata={scheduling_name="param_3.1378"}
  %broadcast.5621.6 = pred[6144,16384]{1,0} broadcast(%param_3.1378), dimensions={}, metadata={scheduling_name="broadcast.5621.6"}
  %param_2.1789 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1789"}
  %constant_1623_11 = bf16[] constant(0)
  %broadcast.5623.6 = bf16[6144,16384]{1,0} broadcast(%constant_1623_11), dimensions={}, metadata={scheduling_name="broadcast.5623.6"}
  %select.1294.3 = bf16[6144,16384]{1,0} select(%broadcast.5621.6, %param_2.1789, %broadcast.5623.6), metadata={scheduling_name="select.1294.3"}
  %bitcast.23710.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1294.3), metadata={scheduling_name="bitcast.23710.7"}
  %convert.4130.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23710.7), metadata={scheduling_name="convert.4130.7"}
  %add.2948.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4129.3, %convert.4130.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2948.5"}
  %convert.4131.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.2948.5), metadata={scheduling_name="convert.4131.3"}
  %constant_5004_34 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1261 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1261"}
  %constant_1624_84 = s32[] constant(8)
  %param_7.1187 = s32[] parameter(7), metadata={scheduling_name="param_7.1187"}
  %subtract.247.125 = s32[] subtract(%constant_1624_84, %param_7.1187), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.125"}
  %dynamic-slice.1376.106 = s32[1]{0} dynamic-slice(%param_6.1261, %subtract.247.125), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.106"}
  %param_4.1430 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1430"}
  %param_5.1307 = u32[] parameter(5), metadata={scheduling_name="param_5.1307"}
  %dynamic-slice.1377.101 = s32[1]{0} dynamic-slice(%param_4.1430, %param_5.1307), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.101"}
  %subtract.248.96 = s32[1]{0} subtract(%dynamic-slice.1376.106, %dynamic-slice.1377.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.96"}
  %constant_2102_56 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.96 = s32[1]{0} maximum(%subtract.248.96, %constant_2102_56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.96"}
  %sign.27.95 = s32[1]{0} sign(%maximum.47.96), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.95"}
  %constant_5000_51 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.95 = pred[1]{0} compare(%sign.27.95, %constant_5000_51), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.95"}
  %constant_5001_49 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.96 = s32[1]{0} and(%maximum.47.96, %constant_5001_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.96"}
  %compare.1615.96 = pred[1]{0} compare(%and.301.96, %constant_2102_56), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.96"}
  %and.302.95 = pred[1]{0} and(%compare.1614.95, %compare.1615.96), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.95"}
  %constant_5002_48 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.95 = s32[1]{0} shift-right-logical(%maximum.47.96, %constant_5002_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.95"}
  %constant_5003_48 = s32[1]{0} constant({-1})
  %add.2882.95 = s32[1]{0} add(%shift-right-logical.20.95, %constant_5003_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.95"}
  %select.1263.95 = s32[1]{0} select(%and.302.95, %add.2882.95, %shift-right-logical.20.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.95"}
  %compare.1616.95 = pred[1]{0} compare(%select.1263.95, %constant_2102_56), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.95"}
  %add.2883.95 = s32[1]{0} add(%select.1263.95, %constant_5002_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.95"}
  %select.1264.95 = s32[1]{0} select(%compare.1616.95, %add.2883.95, %select.1263.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.95"}
  %bitcast.20992.105 = s32[1,1]{1,0} bitcast(%select.1264.95), metadata={scheduling_name="bitcast.20992.105"}
  %concatenate.701.53 = s32[1,5]{1,0} concatenate(%constant_5004_34, %bitcast.20992.105, %constant_5004_34, %constant_5004_34, %constant_5004_34), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.53"}
  %bitcast.21040.52 = s32[5]{0} bitcast(%concatenate.701.53), metadata={scheduling_name="bitcast.21040.52"}
  %slice.2375.49 = s32[1]{0} slice(%bitcast.21040.52), slice={[1:2]}, metadata={scheduling_name="slice.2375.49"}
  %bitcast.23961.23 = s32[] bitcast(%slice.2375.49), metadata={scheduling_name="bitcast.23961.23"}
  %constant_1627_11 = s32[] constant(0)
  ROOT %dynamic-update-slice.406.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.495, %convert.4131.3, %bitcast.23961.23, %constant_1627_11, %constant_1627_11, /*index=5*/%constant_1627_11, %constant_1627_11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.406.1"}
}

%fused_dynamic_update_slice.25 (param_0.496: bf16[2,1,1,16384,6144], param_1.2515: bf16[16384,6144], param_2.1861: bf16[1,1,1,16384,6144], param_3.1453: pred[], param_4.1431: s32[16], param_5.1308: u32[], param_6.1262: s32[9], param_7.1188: s32[]) -> bf16[2,1,1,16384,6144] {
  %param_0.496 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.496"}
  %param_2.1861 = bf16[1,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1861"}
  %convert.4133.3 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.1861), metadata={scheduling_name="convert.4133.3"}
  %param_3.1453 = pred[] parameter(3), metadata={scheduling_name="param_3.1453"}
  %broadcast.5625.1 = pred[16384,6144]{1,0} broadcast(%param_3.1453), dimensions={}, metadata={scheduling_name="broadcast.5625.1"}
  %param_1.2515 = bf16[16384,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2515"}
  %constant_1623_3 = bf16[] constant(0)
  %broadcast.5626.8 = bf16[16384,6144]{1,0} broadcast(%constant_1623_3), dimensions={}, metadata={scheduling_name="broadcast.5626.8"}
  %select.1295.5 = bf16[16384,6144]{1,0} select(%broadcast.5625.1, %param_1.2515, %broadcast.5626.8), metadata={scheduling_name="select.1295.5"}
  %bitcast.23740.7 = bf16[1,1,1,16384,6144]{4,3,2,1,0} bitcast(%select.1295.5), metadata={scheduling_name="bitcast.23740.7"}
  %convert.4135.7 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%bitcast.23740.7), metadata={scheduling_name="convert.4135.7"}
  %add.2949.5 = f32[1,1,1,16384,6144]{4,3,2,1,0} add(%convert.4133.3, %convert.4135.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2949.5"}
  %convert.4136.3 = bf16[1,1,1,16384,6144]{4,3,2,1,0} convert(%add.2949.5), metadata={scheduling_name="convert.4136.3"}
  %constant_5004_35 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1262 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1262"}
  %constant_1624_85 = s32[] constant(8)
  %param_7.1188 = s32[] parameter(7), metadata={scheduling_name="param_7.1188"}
  %subtract.247.127 = s32[] subtract(%constant_1624_85, %param_7.1188), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.127"}
  %dynamic-slice.1376.108 = s32[1]{0} dynamic-slice(%param_6.1262, %subtract.247.127), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.108"}
  %param_4.1431 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1431"}
  %param_5.1308 = u32[] parameter(5), metadata={scheduling_name="param_5.1308"}
  %dynamic-slice.1377.103 = s32[1]{0} dynamic-slice(%param_4.1431, %param_5.1308), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.103"}
  %subtract.248.98 = s32[1]{0} subtract(%dynamic-slice.1376.108, %dynamic-slice.1377.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.98"}
  %constant_2102_57 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.98 = s32[1]{0} maximum(%subtract.248.98, %constant_2102_57), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.98"}
  %sign.27.97 = s32[1]{0} sign(%maximum.47.98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.97"}
  %constant_5000_52 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.97 = pred[1]{0} compare(%sign.27.97, %constant_5000_52), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.97"}
  %constant_5001_50 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.98 = s32[1]{0} and(%maximum.47.98, %constant_5001_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.98"}
  %compare.1615.98 = pred[1]{0} compare(%and.301.98, %constant_2102_57), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.98"}
  %and.302.97 = pred[1]{0} and(%compare.1614.97, %compare.1615.98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.97"}
  %constant_5002_49 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.97 = s32[1]{0} shift-right-logical(%maximum.47.98, %constant_5002_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.97"}
  %constant_5003_49 = s32[1]{0} constant({-1})
  %add.2882.97 = s32[1]{0} add(%shift-right-logical.20.97, %constant_5003_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.97"}
  %select.1263.97 = s32[1]{0} select(%and.302.97, %add.2882.97, %shift-right-logical.20.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.97"}
  %compare.1616.97 = pred[1]{0} compare(%select.1263.97, %constant_2102_57), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.97"}
  %add.2883.97 = s32[1]{0} add(%select.1263.97, %constant_5002_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.97"}
  %select.1264.97 = s32[1]{0} select(%compare.1616.97, %add.2883.97, %select.1263.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.97"}
  %bitcast.20992.107 = s32[1,1]{1,0} bitcast(%select.1264.97), metadata={scheduling_name="bitcast.20992.107"}
  %concatenate.701.55 = s32[1,5]{1,0} concatenate(%constant_5004_35, %bitcast.20992.107, %constant_5004_35, %constant_5004_35, %constant_5004_35), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.55"}
  %bitcast.21040.54 = s32[5]{0} bitcast(%concatenate.701.55), metadata={scheduling_name="bitcast.21040.54"}
  %slice.2375.51 = s32[1]{0} slice(%bitcast.21040.54), slice={[1:2]}, metadata={scheduling_name="slice.2375.51"}
  %bitcast.23961.24 = s32[] bitcast(%slice.2375.51), metadata={scheduling_name="bitcast.23961.24"}
  %constant_1627_106 = s32[] constant(0)
  ROOT %dynamic-update-slice.407.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.496, %convert.4136.3, %bitcast.23961.24, %constant_1627_106, %constant_1627_106, /*index=5*/%constant_1627_106, %constant_1627_106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.407.1"}
}

%fused_dynamic_update_slice.26 (param_0.497: bf16[2,1,768,8,128], param_1.2483: bf16[1,1,768,8,128], param_2.1833: bf16[1,8,128,768], param_3.1425: pred[], param_4.1432: s32[16], param_5.1309: u32[], param_6.1263: s32[9], param_7.1189: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.497 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.497"}
  %param_1.2483 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2483"}
  %convert.4160.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2483), metadata={scheduling_name="convert.4160.3"}
  %param_3.1425 = pred[] parameter(3), metadata={scheduling_name="param_3.1425"}
  %broadcast.5638.10 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1425), dimensions={}, metadata={scheduling_name="broadcast.5638.10"}
  %param_2.1833 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1833"}
  %bitcast.23868.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1833), metadata={scheduling_name="bitcast.23868.3"}
  %constant_1623_44 = bf16[] constant(0)
  %broadcast.5639.10 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1623_44), dimensions={}, metadata={scheduling_name="broadcast.5639.10"}
  %select.1299.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5638.10, %bitcast.23868.3, %broadcast.5639.10), metadata={scheduling_name="select.1299.3"}
  %bitcast.23874.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1299.3), metadata={scheduling_name="bitcast.23874.7"}
  %convert.4162.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23874.7), metadata={scheduling_name="convert.4162.7"}
  %add.2952.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4160.3, %convert.4162.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2952.5"}
  %convert.4163.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.2952.5), metadata={scheduling_name="convert.4163.3"}
  %constant_5004_36 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1263 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1263"}
  %constant_1624_86 = s32[] constant(8)
  %param_7.1189 = s32[] parameter(7), metadata={scheduling_name="param_7.1189"}
  %subtract.247.129 = s32[] subtract(%constant_1624_86, %param_7.1189), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.129"}
  %dynamic-slice.1376.110 = s32[1]{0} dynamic-slice(%param_6.1263, %subtract.247.129), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.110"}
  %param_4.1432 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1432"}
  %param_5.1309 = u32[] parameter(5), metadata={scheduling_name="param_5.1309"}
  %dynamic-slice.1377.105 = s32[1]{0} dynamic-slice(%param_4.1432, %param_5.1309), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.105"}
  %subtract.248.100 = s32[1]{0} subtract(%dynamic-slice.1376.110, %dynamic-slice.1377.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.100"}
  %constant_2102_58 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.100 = s32[1]{0} maximum(%subtract.248.100, %constant_2102_58), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.100"}
  %sign.27.99 = s32[1]{0} sign(%maximum.47.100), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.99"}
  %constant_5000_53 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.99 = pred[1]{0} compare(%sign.27.99, %constant_5000_53), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.99"}
  %constant_5001_51 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.100 = s32[1]{0} and(%maximum.47.100, %constant_5001_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.100"}
  %compare.1615.100 = pred[1]{0} compare(%and.301.100, %constant_2102_58), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.100"}
  %and.302.99 = pred[1]{0} and(%compare.1614.99, %compare.1615.100), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.99"}
  %constant_5002_50 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.99 = s32[1]{0} shift-right-logical(%maximum.47.100, %constant_5002_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.99"}
  %constant_5003_50 = s32[1]{0} constant({-1})
  %add.2882.99 = s32[1]{0} add(%shift-right-logical.20.99, %constant_5003_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.99"}
  %select.1263.99 = s32[1]{0} select(%and.302.99, %add.2882.99, %shift-right-logical.20.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.99"}
  %compare.1616.99 = pred[1]{0} compare(%select.1263.99, %constant_2102_58), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.99"}
  %add.2883.99 = s32[1]{0} add(%select.1263.99, %constant_5002_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.99"}
  %select.1264.99 = s32[1]{0} select(%compare.1616.99, %add.2883.99, %select.1263.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.99"}
  %bitcast.20992.109 = s32[1,1]{1,0} bitcast(%select.1264.99), metadata={scheduling_name="bitcast.20992.109"}
  %concatenate.701.57 = s32[1,5]{1,0} concatenate(%constant_5004_36, %bitcast.20992.109, %constant_5004_36, %constant_5004_36, %constant_5004_36), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.57"}
  %bitcast.21040.56 = s32[5]{0} bitcast(%concatenate.701.57), metadata={scheduling_name="bitcast.21040.56"}
  %slice.2375.53 = s32[1]{0} slice(%bitcast.21040.56), slice={[1:2]}, metadata={scheduling_name="slice.2375.53"}
  %bitcast.23961.25 = s32[] bitcast(%slice.2375.53), metadata={scheduling_name="bitcast.23961.25"}
  %constant_1627_70 = s32[] constant(0)
  ROOT %dynamic-update-slice.410.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.497, %convert.4163.3, %bitcast.23961.25, %constant_1627_70, %constant_1627_70, /*index=5*/%constant_1627_70, %constant_1627_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.410.1"}
}

%fused_dynamic_update_slice.27 (param_0.498: bf16[2,1,768,48,128], param_1.2481: bf16[1,1,768,48,128], param_2.1831: bf16[1,48,128,768], param_3.1423: pred[], param_4.1434: s32[16], param_5.1311: u32[], param_6.1265: s32[9], param_7.1191: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.498 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.498"}
  %param_1.2481 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2481"}
  %convert.4168.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2481), metadata={scheduling_name="convert.4168.3"}
  %param_3.1423 = pred[] parameter(3), metadata={scheduling_name="param_3.1423"}
  %broadcast.5640.12 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1423), dimensions={}, metadata={scheduling_name="broadcast.5640.12"}
  %param_2.1831 = bf16[1,48,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1831"}
  %bitcast.23944.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1831), metadata={scheduling_name="bitcast.23944.3"}
  %constant_1623_14 = bf16[] constant(0)
  %broadcast.5641.12 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1623_14), dimensions={}, metadata={scheduling_name="broadcast.5641.12"}
  %select.1301.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5640.12, %bitcast.23944.3, %broadcast.5641.12), metadata={scheduling_name="select.1301.3"}
  %bitcast.23950.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1301.3), metadata={scheduling_name="bitcast.23950.7"}
  %convert.4169.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23950.7), metadata={scheduling_name="convert.4169.7"}
  %add.2954.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4168.3, %convert.4169.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2954.5"}
  %convert.4171.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.2954.5), metadata={scheduling_name="convert.4171.3"}
  %constant_5004_38 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1265 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1265"}
  %constant_1624_88 = s32[] constant(8)
  %param_7.1191 = s32[] parameter(7), metadata={scheduling_name="param_7.1191"}
  %subtract.247.133 = s32[] subtract(%constant_1624_88, %param_7.1191), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.133"}
  %dynamic-slice.1376.114 = s32[1]{0} dynamic-slice(%param_6.1265, %subtract.247.133), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.114"}
  %param_4.1434 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1434"}
  %param_5.1311 = u32[] parameter(5), metadata={scheduling_name="param_5.1311"}
  %dynamic-slice.1377.109 = s32[1]{0} dynamic-slice(%param_4.1434, %param_5.1311), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.109"}
  %subtract.248.104 = s32[1]{0} subtract(%dynamic-slice.1376.114, %dynamic-slice.1377.109), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.104"}
  %constant_2102_60 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.104 = s32[1]{0} maximum(%subtract.248.104, %constant_2102_60), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.104"}
  %sign.27.103 = s32[1]{0} sign(%maximum.47.104), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.103"}
  %constant_5000_55 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.103 = pred[1]{0} compare(%sign.27.103, %constant_5000_55), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.103"}
  %constant_5001_53 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.104 = s32[1]{0} and(%maximum.47.104, %constant_5001_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.104"}
  %compare.1615.104 = pred[1]{0} compare(%and.301.104, %constant_2102_60), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.104"}
  %and.302.103 = pred[1]{0} and(%compare.1614.103, %compare.1615.104), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.103"}
  %constant_5002_52 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.103 = s32[1]{0} shift-right-logical(%maximum.47.104, %constant_5002_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.103"}
  %constant_5003_52 = s32[1]{0} constant({-1})
  %add.2882.103 = s32[1]{0} add(%shift-right-logical.20.103, %constant_5003_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.103"}
  %select.1263.103 = s32[1]{0} select(%and.302.103, %add.2882.103, %shift-right-logical.20.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.103"}
  %compare.1616.103 = pred[1]{0} compare(%select.1263.103, %constant_2102_60), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.103"}
  %add.2883.103 = s32[1]{0} add(%select.1263.103, %constant_5002_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.103"}
  %select.1264.103 = s32[1]{0} select(%compare.1616.103, %add.2883.103, %select.1263.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.103"}
  %bitcast.20992.113 = s32[1,1]{1,0} bitcast(%select.1264.103), metadata={scheduling_name="bitcast.20992.113"}
  %concatenate.701.61 = s32[1,5]{1,0} concatenate(%constant_5004_38, %bitcast.20992.113, %constant_5004_38, %constant_5004_38, %constant_5004_38), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.61"}
  %bitcast.21040.60 = s32[5]{0} bitcast(%concatenate.701.61), metadata={scheduling_name="bitcast.21040.60"}
  %slice.2375.57 = s32[1]{0} slice(%bitcast.21040.60), slice={[1:2]}, metadata={scheduling_name="slice.2375.57"}
  %bitcast.23961.27 = s32[] bitcast(%slice.2375.57), metadata={scheduling_name="bitcast.23961.27"}
  %constant_1627_68 = s32[] constant(0)
  ROOT %dynamic-update-slice.412.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%param_0.498, %convert.4171.3, %bitcast.23961.27, %constant_1627_68, %constant_1627_68, /*index=5*/%constant_1627_68, %constant_1627_68), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.412.1"}
}

%fused_dynamic_update_slice.28 (param_0.499: bf16[2,1,768,8,128], param_1.2468: bf16[1,1,768,8,128], param_2.1817: bf16[1,8,128,768], param_3.1407: pred[], param_4.1435: s32[16], param_5.1312: u32[], param_6.1266: s32[9], param_7.1192: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.499 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.499"}
  %param_1.2468 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2468"}
  %convert.4172.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2468), metadata={scheduling_name="convert.4172.3"}
  %param_3.1407 = pred[] parameter(3), metadata={scheduling_name="param_3.1407"}
  %broadcast.5638.12 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1407), dimensions={}, metadata={scheduling_name="broadcast.5638.12"}
  %param_2.1817 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1817"}
  %bitcast.23980.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1817), metadata={scheduling_name="bitcast.23980.3"}
  %constant_1623_13 = bf16[] constant(0)
  %broadcast.5639.12 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1623_13), dimensions={}, metadata={scheduling_name="broadcast.5639.12"}
  %select.1302.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5638.12, %bitcast.23980.3, %broadcast.5639.12), metadata={scheduling_name="select.1302.3"}
  %bitcast.23986.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1302.3), metadata={scheduling_name="bitcast.23986.7"}
  %convert.4173.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23986.7), metadata={scheduling_name="convert.4173.7"}
  %add.2955.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4172.3, %convert.4173.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2955.5"}
  %convert.4174.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.2955.5), metadata={scheduling_name="convert.4174.3"}
  %constant_5004_39 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1266 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1266"}
  %constant_1624_89 = s32[] constant(8)
  %param_7.1192 = s32[] parameter(7), metadata={scheduling_name="param_7.1192"}
  %subtract.247.135 = s32[] subtract(%constant_1624_89, %param_7.1192), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.135"}
  %dynamic-slice.1376.116 = s32[1]{0} dynamic-slice(%param_6.1266, %subtract.247.135), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.116"}
  %param_4.1435 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1435"}
  %param_5.1312 = u32[] parameter(5), metadata={scheduling_name="param_5.1312"}
  %dynamic-slice.1377.111 = s32[1]{0} dynamic-slice(%param_4.1435, %param_5.1312), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.111"}
  %subtract.248.106 = s32[1]{0} subtract(%dynamic-slice.1376.116, %dynamic-slice.1377.111), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.106"}
  %constant_2102_61 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.106 = s32[1]{0} maximum(%subtract.248.106, %constant_2102_61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.106"}
  %sign.27.105 = s32[1]{0} sign(%maximum.47.106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.105"}
  %constant_5000_56 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.105 = pred[1]{0} compare(%sign.27.105, %constant_5000_56), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.105"}
  %constant_5001_54 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.106 = s32[1]{0} and(%maximum.47.106, %constant_5001_54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.106"}
  %compare.1615.106 = pred[1]{0} compare(%and.301.106, %constant_2102_61), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.106"}
  %and.302.105 = pred[1]{0} and(%compare.1614.105, %compare.1615.106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.105"}
  %constant_5002_53 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.105 = s32[1]{0} shift-right-logical(%maximum.47.106, %constant_5002_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.105"}
  %constant_5003_53 = s32[1]{0} constant({-1})
  %add.2882.105 = s32[1]{0} add(%shift-right-logical.20.105, %constant_5003_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.105"}
  %select.1263.105 = s32[1]{0} select(%and.302.105, %add.2882.105, %shift-right-logical.20.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.105"}
  %compare.1616.105 = pred[1]{0} compare(%select.1263.105, %constant_2102_61), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.105"}
  %add.2883.105 = s32[1]{0} add(%select.1263.105, %constant_5002_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.105"}
  %select.1264.105 = s32[1]{0} select(%compare.1616.105, %add.2883.105, %select.1263.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.105"}
  %bitcast.20992.115 = s32[1,1]{1,0} bitcast(%select.1264.105), metadata={scheduling_name="bitcast.20992.115"}
  %concatenate.701.63 = s32[1,5]{1,0} concatenate(%constant_5004_39, %bitcast.20992.115, %constant_5004_39, %constant_5004_39, %constant_5004_39), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.63"}
  %bitcast.21040.62 = s32[5]{0} bitcast(%concatenate.701.63), metadata={scheduling_name="bitcast.21040.62"}
  %slice.2375.59 = s32[1]{0} slice(%bitcast.21040.62), slice={[1:2]}, metadata={scheduling_name="slice.2375.59"}
  %bitcast.23961.28 = s32[] bitcast(%slice.2375.59), metadata={scheduling_name="bitcast.23961.28"}
  %constant_1627_52 = s32[] constant(0)
  ROOT %dynamic-update-slice.413.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.499, %convert.4174.3, %bitcast.23961.28, %constant_1627_52, %constant_1627_52, /*index=5*/%constant_1627_52, %constant_1627_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.413.1"}
}

%fused_dynamic_slice.21 (param_0.510: bf16[2,1,768,8,128], param_1.2618: s32[16], param_2.2034: u32[], param_3.1678: s32[9], param_4.1446: s32[], param_5.2648: bf16[2,1,768,8,128], param_6.2428: bf16[2,1,768,8,128], param_7.2232: bf16[2,1,768,8,128], param_8.2071: bf16[2,1,768,8,128], param_9.1793: bf16[2,1,768,8,128], param_10.1404: bf16[2,1,768,8,128], param_11.1304: bf16[2,1,768,8,128]) -> (bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], /*index=5*/bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128]) {
  %param_0.510 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.510"}
  %constant_5004_50 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1678 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1678"}
  %constant_1624_11 = s32[] constant(8)
  %param_4.1446 = s32[] parameter(4), metadata={scheduling_name="param_4.1446"}
  %subtract.247.157 = s32[] subtract(%constant_1624_11, %param_4.1446), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.157"}
  %dynamic-slice.1376.138 = s32[1]{0} dynamic-slice(%param_3.1678, %subtract.247.157), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.138"}
  %param_1.2618 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1.2618"}
  %param_2.2034 = u32[] parameter(2), metadata={scheduling_name="param_2.2034"}
  %dynamic-slice.1377.133 = s32[1]{0} dynamic-slice(%param_1.2618, %param_2.2034), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.133"}
  %subtract.248.128 = s32[1]{0} subtract(%dynamic-slice.1376.138, %dynamic-slice.1377.133), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.128"}
  %constant_2102_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.128 = s32[1]{0} maximum(%subtract.248.128, %constant_2102_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.128"}
  %sign.27.127 = s32[1]{0} sign(%maximum.47.128), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.127"}
  %constant_5000_2 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.127 = pred[1]{0} compare(%sign.27.127, %constant_5000_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.127"}
  %constant_5001_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.128 = s32[1]{0} and(%maximum.47.128, %constant_5001_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.128"}
  %compare.1615.128 = pred[1]{0} compare(%and.301.128, %constant_2102_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.128"}
  %and.302.127 = pred[1]{0} and(%compare.1614.127, %compare.1615.128), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.127"}
  %constant_5002_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.127 = s32[1]{0} shift-right-logical(%maximum.47.128, %constant_5002_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.127"}
  %constant_5003_1 = s32[1]{0} constant({-1})
  %add.2882.127 = s32[1]{0} add(%shift-right-logical.20.127, %constant_5003_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.127"}
  %select.1263.127 = s32[1]{0} select(%and.302.127, %add.2882.127, %shift-right-logical.20.127), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.127"}
  %compare.1616.127 = pred[1]{0} compare(%select.1263.127, %constant_2102_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.127"}
  %add.2883.127 = s32[1]{0} add(%select.1263.127, %constant_5002_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.127"}
  %select.1264.127 = s32[1]{0} select(%compare.1616.127, %add.2883.127, %select.1263.127), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.127"}
  %bitcast.20992.137 = s32[1,1]{1,0} bitcast(%select.1264.127), metadata={scheduling_name="bitcast.20992.137"}
  %concatenate.701.85 = s32[1,5]{1,0} concatenate(%constant_5004_50, %bitcast.20992.137, %constant_5004_50, %constant_5004_50, %constant_5004_50), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.85"}
  %bitcast.21040.84 = s32[5]{0} bitcast(%concatenate.701.85), metadata={scheduling_name="bitcast.21040.84"}
  %slice.2375.81 = s32[1]{0} slice(%bitcast.21040.84), slice={[1:2]}, metadata={scheduling_name="slice.2375.81"}
  %bitcast.23961.39 = s32[] bitcast(%slice.2375.81), metadata={scheduling_name="bitcast.23961.39"}
  %constant_1627_72 = s32[] constant(0)
  %dynamic-slice.1426.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.510, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1426.1"}
  %param_5.2648 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2648"}
  %dynamic-slice.1429.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_5.2648, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1429.1.clone.1"}
  %param_6.2428 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2428"}
  %dynamic-slice.1398.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_6.2428, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1398.1.clone.1"}
  %param_7.2232 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2232"}
  %dynamic-slice.1399.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_7.2232, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1399.1.clone.1"}
  %param_8.2071 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2071"}
  %dynamic-slice.1412.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_8.2071, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1412.1.clone.1"}
  %param_9.1793 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1793"}
  %dynamic-slice.1413.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_9.1793, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1413.1.clone.1"}
  %param_10.1404 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1404"}
  %dynamic-slice.1416.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_10.1404, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1416.1.clone.1"}
  %param_11.1304 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1304"}
  %dynamic-slice.1419.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_11.1304, %bitcast.23961.39, %constant_1627_72, %constant_1627_72, %constant_1627_72, /*index=5*/%constant_1627_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1419.1.clone.1"}
  ROOT %tuple.515 = (bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}) tuple(%dynamic-slice.1426.1, %dynamic-slice.1429.1.clone.1, %dynamic-slice.1398.1.clone.1, %dynamic-slice.1399.1.clone.1, %dynamic-slice.1412.1.clone.1, /*index=5*/%dynamic-slice.1413.1.clone.1, %dynamic-slice.1416.1.clone.1, %dynamic-slice.1419.1.clone.1), metadata={scheduling_name="tuple.515"}
}

%fused_dynamic_update_slice.29 (param_0.521: bf16[2,1,768,8], param_1.2589: bf16[1,1,768,8], param_2.2005: bf16[1,768,8], param_3.1649: pred[], param_4.1403: s32[16], param_5.1297: u32[], param_6.1251: s32[9], param_7.1177: s32[]) -> bf16[2,1,768,8] {
  %param_0.521 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.521"}
  %param_1.2589 = bf16[1,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2589"}
  %convert.3884.3 = f32[1,1,768,8]{3,2,1,0} convert(%param_1.2589), metadata={scheduling_name="convert.3884.3"}
  %param_3.1649 = pred[] parameter(3), metadata={scheduling_name="param_3.1649"}
  %broadcast.5526.2 = pred[768,1,8]{2,1,0} broadcast(%param_3.1649), dimensions={}, metadata={scheduling_name="broadcast.5526.2"}
  %param_2.2005 = bf16[1,768,8]{2,0,1} parameter(2), metadata={scheduling_name="param_2.2005"}
  %bitcast.22775.3 = bf16[768,1,8]{2,1,0} bitcast(%param_2.2005), metadata={scheduling_name="bitcast.22775.3"}
  %constant_1623_51 = bf16[] constant(0)
  %broadcast.5619.1 = bf16[768,1,8]{2,1,0} broadcast(%constant_1623_51), dimensions={}, metadata={scheduling_name="broadcast.5619.1"}
  %select.1282.3 = bf16[768,1,8]{2,1,0} select(%broadcast.5526.2, %bitcast.22775.3, %broadcast.5619.1), metadata={scheduling_name="select.1282.3"}
  %bitcast.22781.7 = bf16[1,1,768,8]{3,2,1,0} bitcast(%select.1282.3), metadata={scheduling_name="bitcast.22781.7"}
  %convert.4025.7 = f32[1,1,768,8]{3,2,1,0} convert(%bitcast.22781.7), metadata={scheduling_name="convert.4025.7"}
  %add.2925.5 = f32[1,1,768,8]{3,2,1,0} add(%convert.3884.3, %convert.4025.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2925.5"}
  %convert.4026.3 = bf16[1,1,768,8]{3,2,1,0} convert(%add.2925.5), metadata={scheduling_name="convert.4026.3"}
  %constant_5004_7 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1251 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1251"}
  %constant_1624_45 = s32[] constant(8)
  %param_7.1177 = s32[] parameter(7), metadata={scheduling_name="param_7.1177"}
  %subtract.247.47 = s32[] subtract(%constant_1624_45, %param_7.1177), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.47"}
  %dynamic-slice.1376.28 = s32[1]{0} dynamic-slice(%param_6.1251, %subtract.247.47), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.28"}
  %param_4.1403 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1403"}
  %param_5.1297 = u32[] parameter(5), metadata={scheduling_name="param_5.1297"}
  %dynamic-slice.1377.23 = s32[1]{0} dynamic-slice(%param_4.1403, %param_5.1297), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.23"}
  %subtract.248.18 = s32[1]{0} subtract(%dynamic-slice.1376.28, %dynamic-slice.1377.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.18"}
  %constant_2102_18 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.18 = s32[1]{0} maximum(%subtract.248.18, %constant_2102_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.18"}
  %sign.27.17 = s32[1]{0} sign(%maximum.47.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.17"}
  %constant_5000_12 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.17 = pred[1]{0} compare(%sign.27.17, %constant_5000_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.17"}
  %constant_5001_10 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.18 = s32[1]{0} and(%maximum.47.18, %constant_5001_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.18"}
  %compare.1615.18 = pred[1]{0} compare(%and.301.18, %constant_2102_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.18"}
  %and.302.17 = pred[1]{0} and(%compare.1614.17, %compare.1615.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.17"}
  %constant_5002_9 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.17 = s32[1]{0} shift-right-logical(%maximum.47.18, %constant_5002_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.17"}
  %constant_5003_9 = s32[1]{0} constant({-1})
  %add.2882.17 = s32[1]{0} add(%shift-right-logical.20.17, %constant_5003_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.17"}
  %select.1263.17 = s32[1]{0} select(%and.302.17, %add.2882.17, %shift-right-logical.20.17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.17"}
  %compare.1616.17 = pred[1]{0} compare(%select.1263.17, %constant_2102_18), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.17"}
  %add.2883.17 = s32[1]{0} add(%select.1263.17, %constant_5002_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.17"}
  %select.1264.17 = s32[1]{0} select(%compare.1616.17, %add.2883.17, %select.1263.17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.17"}
  %bitcast.20992.15 = s32[1,1]{1,0} bitcast(%select.1264.17), metadata={scheduling_name="bitcast.20992.15"}
  %concatenate.699.13 = s32[1,4]{1,0} concatenate(%constant_5004_7, %bitcast.20992.15, %constant_5004_7, %constant_5004_7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.13"}
  %bitcast.20995.10 = s32[4]{0} bitcast(%concatenate.699.13), metadata={scheduling_name="bitcast.20995.10"}
  %slice.2373.9 = s32[1]{0} slice(%bitcast.20995.10), slice={[1:2]}, metadata={scheduling_name="slice.2373.9"}
  %bitcast.23627.3 = s32[] bitcast(%slice.2373.9), metadata={scheduling_name="bitcast.23627.3"}
  %constant_1627_109 = s32[] constant(0)
  ROOT %dynamic-update-slice.394.1 = bf16[2,1,768,8]{3,2,1,0} dynamic-update-slice(%param_0.521, %convert.4026.3, %bitcast.23627.3, %constant_1627_109, %constant_1627_109, /*index=5*/%constant_1627_109), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.394.1"}
}

%fused_dynamic_update_slice.30 (param_0.522: bf16[2,1,768,8], param_1.2590: bf16[1,1,768,8], param_2.2006: bf16[1,768,8], param_3.1650: pred[], param_4.1404: s32[16], param_5.1298: u32[], param_6.1252: s32[9], param_7.1178: s32[]) -> bf16[2,1,768,8] {
  %param_0.522 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.522"}
  %param_1.2590 = bf16[1,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2590"}
  %convert.4122.3 = f32[1,1,768,8]{3,2,1,0} convert(%param_1.2590), metadata={scheduling_name="convert.4122.3"}
  %param_3.1650 = pred[] parameter(3), metadata={scheduling_name="param_3.1650"}
  %broadcast.5526.1 = pred[768,1,8]{2,1,0} broadcast(%param_3.1650), dimensions={}, metadata={scheduling_name="broadcast.5526.1"}
  %param_2.2006 = bf16[1,768,8]{2,0,1} parameter(2), metadata={scheduling_name="param_2.2006"}
  %bitcast.23646.3 = bf16[768,1,8]{2,1,0} bitcast(%param_2.2006), metadata={scheduling_name="bitcast.23646.3"}
  %constant_1623_10 = bf16[] constant(0)
  %broadcast.5619.2 = bf16[768,1,8]{2,1,0} broadcast(%constant_1623_10), dimensions={}, metadata={scheduling_name="broadcast.5619.2"}
  %select.1292.3 = bf16[768,1,8]{2,1,0} select(%broadcast.5526.1, %bitcast.23646.3, %broadcast.5619.2), metadata={scheduling_name="select.1292.3"}
  %bitcast.23652.7 = bf16[1,1,768,8]{3,2,1,0} bitcast(%select.1292.3), metadata={scheduling_name="bitcast.23652.7"}
  %convert.4123.7 = f32[1,1,768,8]{3,2,1,0} convert(%bitcast.23652.7), metadata={scheduling_name="convert.4123.7"}
  %add.2946.5 = f32[1,1,768,8]{3,2,1,0} add(%convert.4122.3, %convert.4123.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2946.5"}
  %convert.4124.3 = bf16[1,1,768,8]{3,2,1,0} convert(%add.2946.5), metadata={scheduling_name="convert.4124.3"}
  %constant_5004_8 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1252 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1252"}
  %constant_1624_46 = s32[] constant(8)
  %param_7.1178 = s32[] parameter(7), metadata={scheduling_name="param_7.1178"}
  %subtract.247.49 = s32[] subtract(%constant_1624_46, %param_7.1178), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.49"}
  %dynamic-slice.1376.30 = s32[1]{0} dynamic-slice(%param_6.1252, %subtract.247.49), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.30"}
  %param_4.1404 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.1404"}
  %param_5.1298 = u32[] parameter(5), metadata={scheduling_name="param_5.1298"}
  %dynamic-slice.1377.25 = s32[1]{0} dynamic-slice(%param_4.1404, %param_5.1298), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.25"}
  %subtract.248.20 = s32[1]{0} subtract(%dynamic-slice.1376.30, %dynamic-slice.1377.25), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.20"}
  %constant_2102_19 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.20 = s32[1]{0} maximum(%subtract.248.20, %constant_2102_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.20"}
  %sign.27.19 = s32[1]{0} sign(%maximum.47.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.19"}
  %constant_5000_13 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.19 = pred[1]{0} compare(%sign.27.19, %constant_5000_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.19"}
  %constant_5001_11 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.20 = s32[1]{0} and(%maximum.47.20, %constant_5001_11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.20"}
  %compare.1615.20 = pred[1]{0} compare(%and.301.20, %constant_2102_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.20"}
  %and.302.19 = pred[1]{0} and(%compare.1614.19, %compare.1615.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.19"}
  %constant_5002_10 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.19 = s32[1]{0} shift-right-logical(%maximum.47.20, %constant_5002_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.19"}
  %constant_5003_10 = s32[1]{0} constant({-1})
  %add.2882.19 = s32[1]{0} add(%shift-right-logical.20.19, %constant_5003_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.19"}
  %select.1263.19 = s32[1]{0} select(%and.302.19, %add.2882.19, %shift-right-logical.20.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.19"}
  %compare.1616.19 = pred[1]{0} compare(%select.1263.19, %constant_2102_19), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.19"}
  %add.2883.19 = s32[1]{0} add(%select.1263.19, %constant_5002_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.19"}
  %select.1264.19 = s32[1]{0} select(%compare.1616.19, %add.2883.19, %select.1263.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.19"}
  %bitcast.20992.17 = s32[1,1]{1,0} bitcast(%select.1264.19), metadata={scheduling_name="bitcast.20992.17"}
  %concatenate.699.15 = s32[1,4]{1,0} concatenate(%constant_5004_8, %bitcast.20992.17, %constant_5004_8, %constant_5004_8), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.15"}
  %bitcast.20995.12 = s32[4]{0} bitcast(%concatenate.699.15), metadata={scheduling_name="bitcast.20995.12"}
  %slice.2373.11 = s32[1]{0} slice(%bitcast.20995.12), slice={[1:2]}, metadata={scheduling_name="slice.2373.11"}
  %bitcast.23627.4 = s32[] bitcast(%slice.2373.11), metadata={scheduling_name="bitcast.23627.4"}
  %constant_1627_110 = s32[] constant(0)
  ROOT %dynamic-update-slice.404.1 = bf16[2,1,768,8]{3,2,1,0} dynamic-update-slice(%param_0.522, %convert.4124.3, %bitcast.23627.4, %constant_1627_110, %constant_1627_110, /*index=5*/%constant_1627_110), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.404.1"}
}

%fused_convert.9 (param_0.643: bf16[65536,16384], param_1.865: bf16[65536,16384], param_2.4647: bf16[65536,16384]) -> (bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384]) {
  %param_1.865 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.865"}
  %bitcast.22621.23 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.865), metadata={scheduling_name="bitcast.22621.23"}
  %convert.4008.23 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22621.23), metadata={scheduling_name="convert.4008.23"}
  %constant_1890_7 = bf16[] constant(1)
  %convert.4979.5 = f32[] convert(%constant_1890_7), metadata={scheduling_name="convert.4979.5"}
  %broadcast.5990.38 = f32[1,1,32,2048,16384]{4,3,2,1,0} broadcast(%convert.4979.5), dimensions={}, metadata={scheduling_name="broadcast.5990.38"}
  %negate.218.11 = f32[1,1,32,2048,16384]{4,3,2,1,0} negate(%convert.4008.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="negate.218.11"}
  %exponential.96.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} exponential(%negate.218.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="exponential.96.9"}
  %add.2923.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%exponential.96.9, %broadcast.5990.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.2923.9"}
  %divide.467.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} divide(%broadcast.5990.38, %add.2923.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="divide.467.7"}
  %multiply.2618.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4008.23, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2618.3"}
  %param_0.643 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.643"}
  %bitcast.22850.7 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.643), metadata={scheduling_name="bitcast.22850.7"}
  %convert.4028.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22850.7), metadata={scheduling_name="convert.4028.7"}
  %multiply.2631.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2618.3, %convert.4028.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2631.3"}
  %convert.4037.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2631.3), metadata={scheduling_name="convert.4037.1"}
  %param_2.4647 = bf16[65536,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.4647"}
  %bitcast.22653.9.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_2.4647), metadata={scheduling_name="bitcast.22653.9.clone.1"}
  %convert.4012.9.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22653.9.clone.1), metadata={scheduling_name="convert.4012.9.clone.1"}
  %multiply.2626.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4028.7, %convert.4012.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2626.3.clone.1"}
  %multiply.2627.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2626.3.clone.1, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2627.1.clone.1"}
  %multiply.2628.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4008.23, %multiply.2626.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2628.5.clone.1"}
  %subtract.256.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} subtract(%broadcast.5990.38, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="subtract.256.5.clone.1"}
  %multiply.2629.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%divide.467.7, %subtract.256.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2629.3.clone.1"}
  %multiply.2630.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2628.5.clone.1, %multiply.2629.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2630.3.clone.1"}
  %add.2926.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%multiply.2627.1.clone.1, %multiply.2630.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.2926.1.clone.1"}
  %convert.4032.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%add.2926.1.clone.1), metadata={scheduling_name="convert.4032.1.clone.1"}
  %multiply.2619.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2618.3, %convert.4012.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2619.3.clone.1"}
  %convert.4013.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2619.3.clone.1), metadata={scheduling_name="convert.4013.1.clone.1"}
  ROOT %tuple.480 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) tuple(%convert.4037.1, %convert.4032.1.clone.1, %convert.4013.1.clone.1), metadata={scheduling_name="tuple.480"}
}

%fused_convert.10 (param_0.647: bf16[65536,16384], param_1.866: bf16[65536,16384], param_2.4678: bf16[65536,16384]) -> (bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384]) {
  %param_1.866 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.866"}
  %bitcast.21680.23 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.866), metadata={scheduling_name="bitcast.21680.23"}
  %convert.3915.23 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.21680.23), metadata={scheduling_name="convert.3915.23"}
  %constant_1890_1 = bf16[] constant(1)
  %convert.4979.6 = f32[] convert(%constant_1890_1), metadata={scheduling_name="convert.4979.6"}
  %broadcast.5990.46 = f32[1,1,32,2048,16384]{4,3,2,1,0} broadcast(%convert.4979.6), dimensions={}, metadata={scheduling_name="broadcast.5990.46"}
  %negate.214.11 = f32[1,1,32,2048,16384]{4,3,2,1,0} negate(%convert.3915.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="negate.214.11"}
  %exponential.94.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} exponential(%negate.214.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="exponential.94.9"}
  %add.2902.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%exponential.94.9, %broadcast.5990.46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.2902.9"}
  %divide.460.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} divide(%broadcast.5990.46, %add.2902.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="divide.460.7"}
  %multiply.2563.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3915.23, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2563.3"}
  %param_0.647 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.647"}
  %bitcast.21760.7 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.647), metadata={scheduling_name="bitcast.21760.7"}
  %convert.3923.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.21760.7), metadata={scheduling_name="convert.3923.7"}
  %multiply.2570.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2563.3, %convert.3923.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2570.3"}
  %convert.3928.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2570.3), metadata={scheduling_name="convert.3928.1"}
  %param_2.4678 = bf16[65536,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.4678"}
  %bitcast.21733.9.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_2.4678), metadata={scheduling_name="bitcast.21733.9.clone.1"}
  %convert.3920.9.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.21733.9.clone.1), metadata={scheduling_name="convert.3920.9.clone.1"}
  %multiply.2565.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3920.9.clone.1, %convert.3923.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2565.3.clone.1"}
  %multiply.2566.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2565.3.clone.1, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2566.1.clone.1"}
  %multiply.2567.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3915.23, %multiply.2565.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2567.5.clone.1"}
  %subtract.252.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} subtract(%broadcast.5990.46, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="subtract.252.5.clone.1"}
  %multiply.2568.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%divide.460.7, %subtract.252.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2568.3.clone.1"}
  %multiply.2569.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2567.5.clone.1, %multiply.2568.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2569.3.clone.1"}
  %add.2903.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%multiply.2566.1.clone.1, %multiply.2569.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.2903.1.clone.1"}
  %convert.3926.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%add.2903.1.clone.1), metadata={scheduling_name="convert.3926.1.clone.1"}
  %multiply.2564.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2563.3, %convert.3920.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2564.3.clone.1"}
  %convert.3921.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2564.3.clone.1), metadata={scheduling_name="convert.3921.1.clone.1"}
  ROOT %tuple.490 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) tuple(%convert.3928.1, %convert.3926.1.clone.1, %convert.3921.1.clone.1), metadata={scheduling_name="tuple.490"}
}

%region_6.604.clone.4 (Arg_0.173: f32[], Arg_1.173: f32[]) -> f32[] {
  %Arg_1.173 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.173"}
  %Arg_0.173 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.173"}
  ROOT %add.2874.0 = f32[] add(%Arg_0.173, %Arg_1.173), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2874.0"}
}

%fused_convert_reduce_select (param_0.6059: pred[1], param_1.6449: f32[1,4,8192,6144], param_2.4634: f32[1,1,4,8192], param_3.3804: bf16[9,1,4,8192,6144], param_4.2789: f32[1,1,4,8192], param_5.2557: bf16[2,1,6144], param_6.2320: s32[16], param_7.2143: u32[], param_8.1989: s32[9], param_9.1704: s32[], param_10.1317: bf16[32768,6144]) -> (bf16[1,4,8192,6144], bf16[1,4,8192,6144], f32[128,6144]) {
  %param_0.6059 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.6059"}
  %bitcast.24087.3 = pred[] bitcast(%param_0.6059), metadata={scheduling_name="bitcast.24087.3"}
  %broadcast.5657.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24087.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5657.3"}
  %constant_1623_19 = bf16[] constant(0)
  %broadcast.5656.5 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1623_19), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5656.5"}
  %param_1.6449 = f32[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6449"}
  %param_10.1317 = bf16[32768,6144]{1,0} parameter(10), metadata={scheduling_name="param_10.1317"}
  %bitcast.23437.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_10.1317), metadata={scheduling_name="bitcast.23437.15.clone.1"}
  %convert.4102.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23437.15.clone.1), metadata={scheduling_name="convert.4102.15.clone.1"}
  %param_5.2557 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2557"}
  %param_8.1989 = s32[9]{0} parameter(8), metadata={scheduling_name="param_8.1989"}
  %constant_1624_23_clone_1 = s32[] constant(8)
  %param_9.1704 = s32[] parameter(9), metadata={scheduling_name="param_9.1704"}
  %subtract.247.169.clone.1 = s32[] subtract(%constant_1624_23_clone_1, %param_9.1704), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.169.clone.1"}
  %dynamic-slice.1376.150.clone.1 = s32[1]{0} dynamic-slice(%param_8.1989, %subtract.247.169.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.150.clone.1"}
  %param_6.2320 = s32[16]{0} parameter(6), metadata={scheduling_name="param_6.2320"}
  %param_7.2143 = u32[] parameter(7), metadata={scheduling_name="param_7.2143"}
  %dynamic-slice.1377.145.clone.1 = s32[1]{0} dynamic-slice(%param_6.2320, %param_7.2143), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.145.clone.1"}
  %subtract.248.140.clone.1 = s32[1]{0} subtract(%dynamic-slice.1376.150.clone.1, %dynamic-slice.1377.145.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.140.clone.1"}
  %constant_2102_75_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.140.clone.1 = s32[1]{0} maximum(%subtract.248.140.clone.1, %constant_2102_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.140.clone.1"}
  %sign.27.135.clone.1 = s32[1]{0} sign(%maximum.47.140.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.135.clone.1"}
  %constant_5000_69_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.135.clone.1 = pred[1]{0} compare(%sign.27.135.clone.1, %constant_5000_69_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.135.clone.1"}
  %constant_5001_68_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.140.clone.1 = s32[1]{0} and(%maximum.47.140.clone.1, %constant_5001_68_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.140.clone.1"}
  %compare.1615.140.clone.1 = pred[1]{0} compare(%and.301.140.clone.1, %constant_2102_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.140.clone.1"}
  %and.302.135.clone.1 = pred[1]{0} and(%compare.1614.135.clone.1, %compare.1615.140.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.135.clone.1"}
  %constant_5002_66_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.135.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.140.clone.1, %constant_5002_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.135.clone.1"}
  %constant_5003_66_clone_1 = s32[1]{0} constant({-1})
  %add.2882.135.clone.1 = s32[1]{0} add(%shift-right-logical.20.135.clone.1, %constant_5003_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.135.clone.1"}
  %select.1263.135.clone.1 = s32[1]{0} select(%and.302.135.clone.1, %add.2882.135.clone.1, %shift-right-logical.20.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.135.clone.1"}
  %compare.1616.135.clone.1 = pred[1]{0} compare(%select.1263.135.clone.1, %constant_2102_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.135.clone.1"}
  %add.2883.135.clone.1 = s32[1]{0} add(%select.1263.135.clone.1, %constant_5002_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.135.clone.1"}
  %select.1264.135.clone.1 = s32[1]{0} select(%compare.1616.135.clone.1, %add.2883.135.clone.1, %select.1263.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.135.clone.1"}
  %bitcast.20992.149.clone.1 = s32[1,1]{1,0} bitcast(%select.1264.135.clone.1), metadata={scheduling_name="bitcast.20992.149.clone.1"}
  %constant_1627_20_clone_1 = s32[] constant(0)
  %pad.345.41.clone.1 = s32[1,2]{1,0} pad(%bitcast.20992.149.clone.1, %constant_1627_20_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.41.clone.1"}
  %pad.346.39.clone.1 = s32[1,3]{1,0} pad(%pad.345.41.clone.1, %constant_1627_20_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.39.clone.1"}
  %bitcast.21099.36.clone.1 = s32[3]{0} bitcast(%pad.346.39.clone.1), metadata={scheduling_name="bitcast.21099.36.clone.1"}
  %slice.2376.31.clone.1 = s32[1]{0} slice(%bitcast.21099.36.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.31.clone.1"}
  %bitcast.23800.18.clone.1 = s32[] bitcast(%slice.2376.31.clone.1), metadata={scheduling_name="bitcast.23800.18.clone.1"}
  %dynamic-slice.1410.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_5.2557, %bitcast.23800.18.clone.1, %constant_1627_20_clone_1, %constant_1627_20_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1410.7.clone.1"}
  %bitcast.23118.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1410.7.clone.1), metadata={scheduling_name="bitcast.23118.6.clone.1"}
  %convert.4994.3.clone.1 = f32[6144]{0} convert(%bitcast.23118.6.clone.1), metadata={scheduling_name="convert.4994.3.clone.1"}
  %broadcast.6009.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4994.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6009.12.clone.1"}
  %multiply.2663.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4102.15.clone.1, %broadcast.6009.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2663.9.clone.1"}
  %param_4.2789 = f32[1,1,4,8192]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2789"}
  %bitcast.23105.17.clone.1 = f32[4,8192]{1,0} bitcast(%param_4.2789), metadata={scheduling_name="bitcast.23105.17.clone.1"}
  %broadcast.5632.17.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23105.17.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5632.17.clone.1"}
  %multiply.2664.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2663.9.clone.1, %broadcast.5632.17.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2664.5.clone.1"}
  %param_3.3804 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(3), metadata={scheduling_name="param_3.3804"}
  %dynamic-slice.1381.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_3.3804, %subtract.247.169.clone.1, %constant_1627_20_clone_1, %constant_1627_20_clone_1, %constant_1627_20_clone_1, /*index=5*/%constant_1627_20_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1381.1.clone.1"}
  %bitcast.23080.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1381.1.clone.1), metadata={scheduling_name="bitcast.23080.19.clone.1"}
  %convert.4053.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23080.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4053.19.clone.1"}
  %param_2.4634 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4634"}
  %bitcast.24131.5.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4634), metadata={scheduling_name="bitcast.24131.5.clone.1"}
  %broadcast.5660.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24131.5.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5660.5.clone.1"}
  %multiply.2669.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4053.19.clone.1, %broadcast.5660.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2669.3.clone.1"}
  %add.2961.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2664.5.clone.1, %multiply.2669.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2961.3.clone.1"}
  %add.2962.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%param_1.6449, %add.2961.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.2962.1.clone.1"}
  %convert.4180.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2962.1.clone.1), metadata={scheduling_name="convert.4180.1.clone.1"}
  %select.1316.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5657.3, %broadcast.5656.5, %convert.4180.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1316.1"}
  %multiply.2635.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4053.19.clone.1, %broadcast.5632.17.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2635.11.clone.1"}
  %multiply.2660.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2635.11.clone.1, %convert.4102.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2660.5.clone.1"}
  %convert.4103.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2660.5.clone.1), metadata={scheduling_name="convert.4103.3.clone.1"}
  %bitcast.23446.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4103.3.clone.1), metadata={scheduling_name="bitcast.23446.3.clone.1"}
  %convert.4104.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23446.3.clone.1), metadata={scheduling_name="convert.4104.3.clone.1"}
  %convert.4978.6.clone.1 = f32[] convert(%constant_1623_19), metadata={scheduling_name="convert.4978.6.clone.1"}
  %reduce.589.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4104.3.clone.1, %convert.4978.6.clone.1), dimensions={1}, to_apply=%region_6.604.clone.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.589.1.clone.1"}
  ROOT %tuple.475 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}) tuple(%select.1316.1, %convert.4180.1.clone.1, %reduce.589.1.clone.1), metadata={scheduling_name="tuple.475"}
}

%fused_dynamic_update_slice.31 (param_0.879: bf16[1,4,4,8192,6144], param_1.2561: s32[9], param_2.1912: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.879 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.879"}
  %constant_1623_21 = bf16[] constant(0)
  %broadcast.5546.2 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1623_21), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5546.2"}
  %constant_1627_77 = s32[] constant(0)
  %param_1.2561 = s32[9]{0} parameter(1), metadata={scheduling_name="param_1.2561"}
  %constant_1624_34 = s32[] constant(8)
  %param_2.1912 = s32[] parameter(2), metadata={scheduling_name="param_2.1912"}
  %subtract.247.27 = s32[] subtract(%constant_1624_34, %param_2.1912), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.27"}
  %dynamic-slice.1376.7 = s32[1]{0} dynamic-slice(%param_1.2561, %subtract.247.27), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.7"}
  %bitcast.21289.7 = s32[] bitcast(%dynamic-slice.1376.7), metadata={scheduling_name="bitcast.21289.7"}
  %constant_2707_2 = s32[] constant(-2)
  %add.2956.3 = s32[] add(%bitcast.21289.7, %constant_2707_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.2956.3"}
  %compare.1646.1 = pred[] compare(%add.2956.3, %constant_1627_77), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1646.1"}
  %negate.222.2 = s32[] negate(%add.2956.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.222.2"}
  %select.1303.1 = s32[] select(%compare.1646.1, %negate.222.2, %add.2956.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1303.1"}
  %constant_1629_2 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.311.2 = s32[] and(%select.1303.1, %constant_1629_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.311.2"}
  %negate.223.2 = s32[] negate(%and.311.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.223.2"}
  %select.1305.1 = s32[] select(%compare.1646.1, %negate.223.2, %and.311.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1305.1"}
  %compare.1647.2 = pred[] compare(%select.1305.1, %constant_1627_77), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1647.2"}
  %compare.1648.2 = pred[] compare(%select.1305.1, %constant_1627_77), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1648.2"}
  %and.312.1 = pred[] and(%compare.1647.2, %compare.1648.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.312.1"}
  %constant_1687_2 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.2957.1 = s32[] add(%select.1305.1, %constant_1687_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2957.1"}
  %select.1307.2 = s32[] select(%and.312.1, %add.2957.1, %select.1305.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1307.2"}
  %compare.1649.1 = pred[] compare(%select.1307.2, %constant_1627_77), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1649.1"}
  %add.2958.1 = s32[] add(%select.1307.2, %constant_1687_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.2958.1"}
  %select.1308.2 = s32[] select(%compare.1649.1, %add.2958.1, %select.1307.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1308.2"}
  ROOT %dynamic-update-slice.414.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.879, %broadcast.5546.2, %constant_1627_77, %select.1308.2, %constant_1627_77, /*index=5*/%constant_1627_77, %constant_1627_77), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-update-slice.414.1"}
}

%fused_dynamic_update_slice.32 (param_0.880: bf16[1,2,4,8192,6144], param_1.2524: s32[9], param_2.1872: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.880 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.880"}
  %constant_1623_22 = bf16[] constant(0)
  %broadcast.5546.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1623_22), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5546.3"}
  %constant_1627_94 = s32[] constant(0)
  %param_1.2524 = s32[9]{0} parameter(1), metadata={scheduling_name="param_1.2524"}
  %constant_1624_31 = s32[] constant(8)
  %param_2.1872 = s32[] parameter(2), metadata={scheduling_name="param_2.1872"}
  %subtract.247.24 = s32[] subtract(%constant_1624_31, %param_2.1872), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.24"}
  %dynamic-slice.1376.4 = s32[1]{0} dynamic-slice(%param_1.2524, %subtract.247.24), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.4"}
  %bitcast.21289.49 = s32[] bitcast(%dynamic-slice.1376.4), metadata={scheduling_name="bitcast.21289.49"}
  %compare.1624.13 = pred[] compare(%bitcast.21289.49, %constant_1627_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.13"}
  %negate.212.3 = s32[] negate(%bitcast.21289.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.3"}
  %select.1266.15 = s32[] select(%compare.1624.13, %negate.212.3, %bitcast.21289.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.15"}
  %constant_1622_7 = s32[] constant(1)
  %and.305.5 = s32[] and(%select.1266.15, %constant_1622_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.5"}
  %negate.213.4 = s32[] negate(%and.305.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.4"}
  %select.1267.3 = s32[] select(%compare.1624.13, %negate.213.4, %and.305.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1267.3"}
  %compare.1625.1 = pred[] compare(%select.1267.3, %constant_1627_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.1"}
  %compare.1626.1 = pred[] compare(%select.1267.3, %constant_1627_94), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.1"}
  %and.306.6 = pred[] and(%compare.1625.1, %compare.1626.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.6"}
  %constant_1631_6 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2893.6 = s32[] add(%select.1267.3, %constant_1631_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2893.6"}
  %select.1268.5 = s32[] select(%and.306.6, %add.2893.6, %select.1267.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1268.5"}
  %compare.1627.3 = pred[] compare(%select.1268.5, %constant_1627_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.3"}
  %add.2894.3 = s32[] add(%select.1268.5, %constant_1631_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2894.3"}
  %select.1269.2 = s32[] select(%compare.1627.3, %add.2894.3, %select.1268.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1269.2"}
  ROOT %dynamic-update-slice.416.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.880, %broadcast.5546.3, %constant_1627_94, %select.1269.2, %constant_1627_94, /*index=5*/%constant_1627_94, %constant_1627_94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-update-slice.416.1"}
}

%fused_convert.11 (param_0.1493: f32[1,1,4,8192], param_1.1432: bf16[32768,6144], param_2.1690: bf16[2,1,6144], param_3.1607: s32[16], param_4.1353: u32[], param_5.1245: s32[9], param_6.1226: s32[]) -> bf16[1,4,8192,6144] {
  %param_1.1432 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1432"}
  %bitcast.21380.15 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.1432), metadata={scheduling_name="bitcast.21380.15"}
  %convert.3897.15 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21380.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3897.15"}
  %param_0.1493 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1493"}
  %bitcast.21405.13 = f32[4,8192]{1,0} bitcast(%param_0.1493), metadata={scheduling_name="bitcast.21405.13"}
  %broadcast.5550.13 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21405.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5550.13"}
  %multiply.2557.7 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3897.15, %broadcast.5550.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2557.7"}
  %param_2.1690 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1690"}
  %param_5.1245 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1245"}
  %constant_1624_50 = s32[] constant(8)
  %param_6.1226 = s32[] parameter(6), metadata={scheduling_name="param_6.1226"}
  %subtract.247.179 = s32[] subtract(%constant_1624_50, %param_6.1226), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.179"}
  %dynamic-slice.1376.160 = s32[1]{0} dynamic-slice(%param_5.1245, %subtract.247.179), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.160"}
  %param_3.1607 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.1607"}
  %param_4.1353 = u32[] parameter(4), metadata={scheduling_name="param_4.1353"}
  %dynamic-slice.1377.155 = s32[1]{0} dynamic-slice(%param_3.1607, %param_4.1353), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.155"}
  %subtract.248.150 = s32[1]{0} subtract(%dynamic-slice.1376.160, %dynamic-slice.1377.155), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.150"}
  %constant_2102_23 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.150 = s32[1]{0} maximum(%subtract.248.150, %constant_2102_23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.150"}
  %sign.27.145 = s32[1]{0} sign(%maximum.47.150), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.145"}
  %constant_5000_17 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.145 = pred[1]{0} compare(%sign.27.145, %constant_5000_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.145"}
  %constant_5001_15 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.150 = s32[1]{0} and(%maximum.47.150, %constant_5001_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.150"}
  %compare.1615.150 = pred[1]{0} compare(%and.301.150, %constant_2102_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.150"}
  %and.302.145 = pred[1]{0} and(%compare.1614.145, %compare.1615.150), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.145"}
  %constant_5002_14 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.145 = s32[1]{0} shift-right-logical(%maximum.47.150, %constant_5002_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.145"}
  %constant_5003_14 = s32[1]{0} constant({-1})
  %add.2882.145 = s32[1]{0} add(%shift-right-logical.20.145, %constant_5003_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.145"}
  %select.1263.145 = s32[1]{0} select(%and.302.145, %add.2882.145, %shift-right-logical.20.145), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.145"}
  %compare.1616.145 = pred[1]{0} compare(%select.1263.145, %constant_2102_23), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.145"}
  %add.2883.145 = s32[1]{0} add(%select.1263.145, %constant_5002_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.145"}
  %select.1264.145 = s32[1]{0} select(%compare.1616.145, %add.2883.145, %select.1263.145), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.145"}
  %bitcast.20992.159 = s32[1,1]{1,0} bitcast(%select.1264.145), metadata={scheduling_name="bitcast.20992.159"}
  %constant_1627_66 = s32[] constant(0)
  %pad.345.51 = s32[1,2]{1,0} pad(%bitcast.20992.159, %constant_1627_66), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.51"}
  %pad.346.49 = s32[1,3]{1,0} pad(%pad.345.51, %constant_1627_66), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.49"}
  %bitcast.21099.46 = s32[3]{0} bitcast(%pad.346.49), metadata={scheduling_name="bitcast.21099.46"}
  %slice.2376.41 = s32[1]{0} slice(%bitcast.21099.46), slice={[1:2]}, metadata={scheduling_name="slice.2376.41"}
  %bitcast.23800.28 = s32[] bitcast(%slice.2376.41), metadata={scheduling_name="bitcast.23800.28"}
  %dynamic-slice.1390.9 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1690, %bitcast.23800.28, %constant_1627_66, %constant_1627_66), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1390.9"}
  %bitcast.21416.8 = bf16[6144]{0} bitcast(%dynamic-slice.1390.9), metadata={scheduling_name="bitcast.21416.8"}
  %convert.4976.5 = f32[6144]{0} convert(%bitcast.21416.8), metadata={scheduling_name="convert.4976.5"}
  %broadcast.5985.10 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4976.5), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5985.10"}
  %multiply.2558.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2557.7, %broadcast.5985.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2558.3"}
  ROOT %convert.3899.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2558.3), metadata={scheduling_name="convert.3899.1"}
}

%fused_convert.12 (param_0.1301: bf16[1,4,8192,6144], param_1.2430: bf16[1,4,8192,6144], param_2.1769: pred[1], param_3.1352: pred[1]) -> bf16[1,4,8192,6144] {
  %param_2.1769 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1769"}
  %bitcast.24154.3 = pred[] bitcast(%param_2.1769), metadata={scheduling_name="bitcast.24154.3"}
  %broadcast.5662.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24154.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="broadcast.5662.3"}
  %param_1.2430 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2430"}
  %constant_1623_18 = bf16[] constant(0)
  %broadcast.5656.12 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1623_18), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5656.12"}
  %select.1314.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5662.3, %param_1.2430, %broadcast.5656.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="select.1314.3"}
  %convert.4183.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1314.3), metadata={scheduling_name="convert.4183.1"}
  %param_3.1352 = pred[1]{0} parameter(3), metadata={scheduling_name="param_3.1352"}
  %bitcast.24178.3 = pred[] bitcast(%param_3.1352), metadata={scheduling_name="bitcast.24178.3"}
  %broadcast.5664.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24178.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="broadcast.5664.3"}
  %param_0.1301 = bf16[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1301"}
  %select.1315.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5664.3, %param_0.1301, %broadcast.5656.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="select.1315.3"}
  %convert.4184.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1315.3), metadata={scheduling_name="convert.4184.1"}
  %add.2965.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.4183.1, %convert.4184.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="add.2965.1"}
  ROOT %convert.4186.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2965.1), metadata={scheduling_name="convert.4186.1"}
}

%fused_convert_transpose.2 (param_0.1360: s32[1,4,8,8192], param_1.2436: bf16[1,4,8,8192]) -> (bf16[1,4,8,2048,8192], bf16[4,8192,16384], bf16[4,8192,16384]) {
  %param_1.2436 = bf16[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2436"}
  %bitcast.22554.10 = bf16[4,8,8192]{2,1,0} bitcast(%param_1.2436), metadata={scheduling_name="bitcast.22554.10"}
  %convert.4988.7 = f32[4,8,8192]{2,1,0} convert(%bitcast.22554.10), metadata={scheduling_name="convert.4988.7"}
  %broadcast.6000.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.4988.7), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6000.11"}
  %param_0.1360 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1360"}
  %bitcast.22576.11 = s32[4,8,8192]{2,1,0} bitcast(%param_0.1360), metadata={scheduling_name="bitcast.22576.11"}
  %broadcast.5610.11 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.22576.11), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5610.11"}
  %iota.387.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.387.9"}
  %compare.1640.9 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5610.11, %iota.387.9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1640.9"}
  %convert.4002.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1640.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4002.15"}
  %convert.4003.15 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4002.15), metadata={scheduling_name="convert.4003.15"}
  %multiply.2617.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6000.11, %convert.4003.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2617.11"}
  %convert.4004.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2617.11), metadata={scheduling_name="convert.4004.9"}
  %slice.2402.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4004.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2402.7"}
  %convert.4005.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2402.7), metadata={scheduling_name="convert.4005.3"}
  %constant_1623_38 = bf16[] constant(0)
  %convert.4978.13 = f32[] convert(%constant_1623_38), metadata={scheduling_name="convert.4978.13"}
  %broadcast.5988.4 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.4978.13), dimensions={}, metadata={scheduling_name="broadcast.5988.4"}
  %compare.1641.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4005.3, %broadcast.5988.4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1641.3"}
  %convert.4007.2 = bf16[1,4,8,2048,8192]{4,3,2,1,0} convert(%compare.1641.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="convert.4007.2"}
  %bitcast.22827.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2402.7), metadata={scheduling_name="bitcast.22827.1.clone.1"}
  %transpose.756.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.22827.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.756.1.clone.1"}
  %bitcast.22992.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%convert.4007.2), metadata={scheduling_name="bitcast.22992.1.clone.1"}
  %transpose.759.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.22992.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.759.1.clone.1"}
  ROOT %tuple.483 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4007.2, %transpose.756.1.clone.1, %transpose.759.1.clone.1), metadata={scheduling_name="tuple.483"}
}

%fused_convert_transpose.3 (param_0.1361: s32[1,4,8,8192], param_1.2429: bf16[1,4,8,8192]) -> (bf16[1,4,8,2048,8192], bf16[4,8192,16384], bf16[4,8192,16384]) {
  %param_1.2429 = bf16[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2429"}
  %bitcast.21610.10 = bf16[4,8,8192]{2,1,0} bitcast(%param_1.2429), metadata={scheduling_name="bitcast.21610.10"}
  %convert.4977.7 = f32[4,8,8192]{2,1,0} convert(%bitcast.21610.10), metadata={scheduling_name="convert.4977.7"}
  %broadcast.5986.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.4977.7), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.5986.11"}
  %param_0.1361 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1361"}
  %bitcast.21632.11 = s32[4,8,8192]{2,1,0} bitcast(%param_0.1361), metadata={scheduling_name="bitcast.21632.11"}
  %broadcast.5565.11 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.21632.11), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5565.11"}
  %iota.379.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.379.9"}
  %compare.1632.9 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5565.11, %iota.379.9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1632.9"}
  %convert.3909.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1632.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.3909.15"}
  %convert.3910.15 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.3909.15), metadata={scheduling_name="convert.3910.15"}
  %multiply.2562.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.5986.11, %convert.3910.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2562.11"}
  %convert.3911.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2562.11), metadata={scheduling_name="convert.3911.9"}
  %slice.2387.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.3911.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2387.7"}
  %convert.3912.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2387.7), metadata={scheduling_name="convert.3912.3"}
  %constant_1623_7 = bf16[] constant(0)
  %convert.4978.14 = f32[] convert(%constant_1623_7), metadata={scheduling_name="convert.4978.14"}
  %broadcast.5988.8 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.4978.14), dimensions={}, metadata={scheduling_name="broadcast.5988.8"}
  %compare.1633.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.3912.3, %broadcast.5988.8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1633.3"}
  %convert.3914.2 = bf16[1,4,8,2048,8192]{4,3,2,1,0} convert(%compare.1633.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="convert.3914.2"}
  %bitcast.21705.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2387.7), metadata={scheduling_name="bitcast.21705.1.clone.1"}
  %transpose.745.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.21705.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.745.1.clone.1"}
  %bitcast.21649.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%convert.3914.2), metadata={scheduling_name="bitcast.21649.1.clone.1"}
  %transpose.743.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.21649.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.743.1.clone.1"}
  ROOT %tuple.493 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.3914.2, %transpose.745.1.clone.1, %transpose.743.1.clone.1), metadata={scheduling_name="tuple.493"}
}

%fused_dynamic_update_slice.33 (param_0.1136: bf16[1,4,4,8192,6144], param_1.2512: bf16[1,4,8192,6144], param_2.1858: pred[1], param_3.1450: pred[], param_4.1166: s32[9], param_5.995: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.1136 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1136"}
  %constant_1627_103 = s32[] constant(0)
  %param_4.1166 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1166"}
  %constant_1624_35 = s32[] constant(8)
  %param_5.995 = s32[] parameter(5), metadata={scheduling_name="param_5.995"}
  %subtract.247.28 = s32[] subtract(%constant_1624_35, %param_5.995), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.28"}
  %dynamic-slice.1376.8 = s32[1]{0} dynamic-slice(%param_4.1166, %subtract.247.28), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.8"}
  %bitcast.21289.41 = s32[] bitcast(%dynamic-slice.1376.8), metadata={scheduling_name="bitcast.21289.41"}
  %compare.1624.5 = pred[] compare(%bitcast.21289.41, %constant_1627_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.5"}
  %negate.212.5 = s32[] negate(%bitcast.21289.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.5"}
  %select.1266.3 = s32[] select(%compare.1624.5, %negate.212.5, %bitcast.21289.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.3"}
  %constant_1629_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.313.1 = s32[] and(%select.1266.3, %constant_1629_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.313.1"}
  %negate.224.1 = s32[] negate(%and.313.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.224.1"}
  %select.1309.1 = s32[] select(%compare.1624.5, %negate.224.1, %and.313.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1309.1"}
  %compare.1650.1 = pred[] compare(%select.1309.1, %constant_1627_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1650.1"}
  %compare.1651.1 = pred[] compare(%select.1309.1, %constant_1627_103), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1651.1"}
  %and.314.1 = pred[] and(%compare.1650.1, %compare.1651.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.314.1"}
  %constant_1687_4 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.2959.1 = s32[] add(%select.1309.1, %constant_1687_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2959.1"}
  %select.1310.1 = s32[] select(%and.314.1, %add.2959.1, %select.1309.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1310.1"}
  %compare.1652.1 = pred[] compare(%select.1310.1, %constant_1627_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="compare.1652.1"}
  %add.2960.1 = s32[] add(%select.1310.1, %constant_1687_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.2960.1"}
  %select.1311.1 = s32[] select(%compare.1652.1, %add.2960.1, %select.1310.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="select.1311.1"}
  %dynamic-slice.1430.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1136, %constant_1627_103, %select.1311.1, %constant_1627_103, %constant_1627_103, /*index=5*/%constant_1627_103), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-slice.1430.1"}
  %convert.4175.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1430.1), metadata={scheduling_name="convert.4175.3"}
  %param_3.1450 = pred[] parameter(3), metadata={scheduling_name="param_3.1450"}
  %broadcast.5655.2 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.1450), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5655.2"}
  %constant_1623_15 = bf16[] constant(0)
  %broadcast.5656.14 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1623_15), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5656.14"}
  %param_2.1858 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1858"}
  %bitcast.24087.9 = pred[] bitcast(%param_2.1858), metadata={scheduling_name="bitcast.24087.9"}
  %broadcast.5657.9 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24087.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5657.9"}
  %param_1.2512 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2512"}
  %select.1312.5 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5657.9, %param_1.2512, %broadcast.5656.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1312.5"}
  %select.1313.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5655.2, %broadcast.5656.14, %select.1312.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1313.3"}
  %bitcast.24143.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1313.3), metadata={scheduling_name="bitcast.24143.7"}
  %convert.4181.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24143.7), metadata={scheduling_name="convert.4181.7"}
  %add.2964.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4175.3, %convert.4181.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.2964.5"}
  %convert.4182.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.2964.5), metadata={scheduling_name="convert.4182.3"}
  ROOT %dynamic-update-slice.415.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1136, %convert.4182.3, %constant_1627_103, %select.1311.1, %constant_1627_103, /*index=5*/%constant_1627_103, %constant_1627_103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="dynamic-update-slice.415.1"}
}

%fused_dynamic_update_slice.34 (param_0.1138: bf16[1,2,4,8192,6144], param_1.2507: bf16[1,4,8192,6144], param_2.1871: s32[9], param_3.1463: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.1138 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1138"}
  %constant_1627_98 = s32[] constant(0)
  %param_2.1871 = s32[9]{0} parameter(2), metadata={scheduling_name="param_2.1871"}
  %constant_1624_30 = s32[] constant(8)
  %param_3.1463 = s32[] parameter(3), metadata={scheduling_name="param_3.1463"}
  %subtract.247.23 = s32[] subtract(%constant_1624_30, %param_3.1463), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.23"}
  %dynamic-slice.1376.3 = s32[1]{0} dynamic-slice(%param_2.1871, %subtract.247.23), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.3"}
  %bitcast.21289.45 = s32[] bitcast(%dynamic-slice.1376.3), metadata={scheduling_name="bitcast.21289.45"}
  %compare.1624.9 = pred[] compare(%bitcast.21289.45, %constant_1627_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.9"}
  %negate.212.13 = s32[] negate(%bitcast.21289.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.13"}
  %select.1266.11 = s32[] select(%compare.1624.9, %negate.212.13, %bitcast.21289.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.11"}
  %constant_1622_5 = s32[] constant(1)
  %and.305.3 = s32[] and(%select.1266.11, %constant_1622_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.3"}
  %negate.213.2 = s32[] negate(%and.305.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.2"}
  %select.1267.1 = s32[] select(%compare.1624.9, %negate.213.2, %and.305.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1267.1"}
  %compare.1625.6 = pred[] compare(%select.1267.1, %constant_1627_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.6"}
  %compare.1626.6 = pred[] compare(%select.1267.1, %constant_1627_98), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.6"}
  %and.306.5 = pred[] and(%compare.1625.6, %compare.1626.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.5"}
  %constant_1631_5 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2893.5 = s32[] add(%select.1267.1, %constant_1631_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2893.5"}
  %select.1268.4 = s32[] select(%and.306.5, %add.2893.5, %select.1267.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1268.4"}
  %compare.1627.2 = pred[] compare(%select.1268.4, %constant_1627_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.2"}
  %add.2894.2 = s32[] add(%select.1268.4, %constant_1631_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2894.2"}
  %select.1269.1 = s32[] select(%compare.1627.2, %add.2894.2, %select.1268.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1269.1"}
  %dynamic-slice.1432.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1138, %constant_1627_98, %select.1269.1, %constant_1627_98, %constant_1627_98, /*index=5*/%constant_1627_98), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1432.1"}
  %convert.4187.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1432.1), metadata={scheduling_name="convert.4187.3"}
  %param_1.2507 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2507"}
  %bitcast.24230.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_1.2507), metadata={scheduling_name="bitcast.24230.7"}
  %convert.4189.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24230.7), metadata={scheduling_name="convert.4189.7"}
  %add.2966.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4187.3, %convert.4189.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="add.2966.5"}
  %convert.4190.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.2966.5), metadata={scheduling_name="convert.4190.3"}
  ROOT %dynamic-update-slice.417.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1138, %convert.4190.3, %constant_1627_98, %select.1269.1, %constant_1627_98, /*index=5*/%constant_1627_98, %constant_1627_98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="dynamic-update-slice.417.1"}
}

%fused_dynamic_update_slice.35 (param_0.1140: bf16[1,2,4,8192,6144], param_1.2484: bf16[1,4,8192,6144], param_2.1834: pred[1], param_3.1426: pred[], param_4.1151: s32[9], param_5.980: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.1140 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1140"}
  %constant_1627_71 = s32[] constant(0)
  %param_4.1151 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1151"}
  %constant_1624_36 = s32[] constant(8)
  %param_5.980 = s32[] parameter(5), metadata={scheduling_name="param_5.980"}
  %subtract.247.29 = s32[] subtract(%constant_1624_36, %param_5.980), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.29"}
  %dynamic-slice.1376.9 = s32[1]{0} dynamic-slice(%param_4.1151, %subtract.247.29), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.9"}
  %bitcast.21289.51 = s32[] bitcast(%dynamic-slice.1376.9), metadata={scheduling_name="bitcast.21289.51"}
  %compare.1624.15 = pred[] compare(%bitcast.21289.51, %constant_1627_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.15"}
  %negate.212.7 = s32[] negate(%bitcast.21289.51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.7"}
  %select.1266.5 = s32[] select(%compare.1624.15, %negate.212.7, %bitcast.21289.51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.5"}
  %constant_1622_1 = s32[] constant(1)
  %and.305.6 = s32[] and(%select.1266.5, %constant_1622_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.6"}
  %negate.213.5 = s32[] negate(%and.305.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.5"}
  %select.1267.4 = s32[] select(%compare.1624.15, %negate.213.5, %and.305.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1267.4"}
  %compare.1625.2 = pred[] compare(%select.1267.4, %constant_1627_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.2"}
  %compare.1626.2 = pred[] compare(%select.1267.4, %constant_1627_71), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.2"}
  %and.306.1 = pred[] and(%compare.1625.2, %compare.1626.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.1"}
  %constant_1631_7 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2893.1 = s32[] add(%select.1267.4, %constant_1631_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2893.1"}
  %select.1268.6 = s32[] select(%and.306.1, %add.2893.1, %select.1267.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1268.6"}
  %compare.1627.4 = pred[] compare(%select.1268.6, %constant_1627_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.4"}
  %add.2894.4 = s32[] add(%select.1268.6, %constant_1631_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2894.4"}
  %select.1269.3 = s32[] select(%compare.1627.4, %add.2894.4, %select.1268.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1269.3"}
  %dynamic-slice.1433.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1140, %constant_1627_71, %select.1269.3, %constant_1627_71, %constant_1627_71, /*index=5*/%constant_1627_71), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="dynamic-slice.1433.1"}
  %convert.4191.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1433.1), metadata={scheduling_name="convert.4191.3"}
  %param_3.1426 = pred[] parameter(3), metadata={scheduling_name="param_3.1426"}
  %broadcast.5655.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.1426), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5655.1"}
  %param_2.1834 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1834"}
  %bitcast.24087.7 = pred[] bitcast(%param_2.1834), metadata={scheduling_name="bitcast.24087.7"}
  %broadcast.5657.7 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24087.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5657.7"}
  %param_1.2484 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2484"}
  %constant_1623_9 = bf16[] constant(0)
  %broadcast.5656.16 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1623_9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5656.16"}
  %select.1312.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5657.7, %param_1.2484, %broadcast.5656.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1312.3"}
  %select.1318.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5655.1, %select.1312.3, %broadcast.5656.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1318.3"}
  %bitcast.24252.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1318.3), metadata={scheduling_name="bitcast.24252.7"}
  %convert.4192.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24252.7), metadata={scheduling_name="convert.4192.7"}
  %add.2967.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4191.3, %convert.4192.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.2967.5"}
  %convert.4193.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.2967.5), metadata={scheduling_name="convert.4193.3"}
  ROOT %dynamic-update-slice.418.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1140, %convert.4193.3, %constant_1627_71, %select.1269.3, %constant_1627_71, /*index=5*/%constant_1627_71, %constant_1627_71), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="dynamic-update-slice.418.1"}
}

%fused_convert.13 (param_0.1242: f32[1,4,8192,6144], param_1.1128: f32[1,1,4,8192], param_2.709: f32[1,1,4,8192], param_3.462: bf16[32768,6144], param_4.204: bf16[9,1,4,8192,6144], param_5.896: s32[], param_6.876: bf16[2,1,6144], param_7.1176: s32[16], param_8.1072: u32[], param_9.869: s32[9]) -> bf16[1,4,8192,6144] {
  %param_0.1242 = f32[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1242"}
  %param_3.462 = bf16[32768,6144]{1,0} parameter(3), metadata={scheduling_name="param_3.462"}
  %bitcast.22383.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_3.462), metadata={scheduling_name="bitcast.22383.23"}
  %convert.3993.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22383.23), metadata={scheduling_name="convert.3993.23"}
  %param_6.876 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.876"}
  %param_9.869 = s32[9]{0} parameter(9), metadata={scheduling_name="param_9.869"}
  %constant_1624_17 = s32[] constant(8)
  %param_5.896 = s32[] parameter(5), metadata={scheduling_name="param_5.896"}
  %subtract.247.193 = s32[] subtract(%constant_1624_17, %param_5.896), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.193"}
  %dynamic-slice.1376.174 = s32[1]{0} dynamic-slice(%param_9.869, %subtract.247.193), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.174"}
  %param_7.1176 = s32[16]{0} parameter(7), metadata={scheduling_name="param_7.1176"}
  %param_8.1072 = u32[] parameter(8), metadata={scheduling_name="param_8.1072"}
  %dynamic-slice.1377.169 = s32[1]{0} dynamic-slice(%param_7.1176, %param_8.1072), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.169"}
  %subtract.248.164 = s32[1]{0} subtract(%dynamic-slice.1376.174, %dynamic-slice.1377.169), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.164"}
  %constant_2102_83 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.164 = s32[1]{0} maximum(%subtract.248.164, %constant_2102_83), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.164"}
  %sign.27.159 = s32[1]{0} sign(%maximum.47.164), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.159"}
  %constant_5000_77 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.159 = pred[1]{0} compare(%sign.27.159, %constant_5000_77), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.159"}
  %constant_5001_76 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.164 = s32[1]{0} and(%maximum.47.164, %constant_5001_76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.164"}
  %compare.1615.164 = pred[1]{0} compare(%and.301.164, %constant_2102_83), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.164"}
  %and.302.159 = pred[1]{0} and(%compare.1614.159, %compare.1615.164), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.159"}
  %constant_5002_74 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.159 = s32[1]{0} shift-right-logical(%maximum.47.164, %constant_5002_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.159"}
  %constant_5003_74 = s32[1]{0} constant({-1})
  %add.2882.159 = s32[1]{0} add(%shift-right-logical.20.159, %constant_5003_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.159"}
  %select.1263.159 = s32[1]{0} select(%and.302.159, %add.2882.159, %shift-right-logical.20.159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.159"}
  %compare.1616.159 = pred[1]{0} compare(%select.1263.159, %constant_2102_83), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.159"}
  %add.2883.159 = s32[1]{0} add(%select.1263.159, %constant_5002_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.159"}
  %select.1264.159 = s32[1]{0} select(%compare.1616.159, %add.2883.159, %select.1263.159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.159"}
  %bitcast.20992.173 = s32[1,1]{1,0} bitcast(%select.1264.159), metadata={scheduling_name="bitcast.20992.173"}
  %constant_1627_7 = s32[] constant(0)
  %pad.345.65 = s32[1,2]{1,0} pad(%bitcast.20992.173, %constant_1627_7), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.65"}
  %pad.346.63 = s32[1,3]{1,0} pad(%pad.345.65, %constant_1627_7), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.63"}
  %bitcast.21099.60 = s32[3]{0} bitcast(%pad.346.63), metadata={scheduling_name="bitcast.21099.60"}
  %slice.2376.55 = s32[1]{0} slice(%bitcast.21099.60), slice={[1:2]}, metadata={scheduling_name="slice.2376.55"}
  %bitcast.23800.42 = s32[] bitcast(%slice.2376.55), metadata={scheduling_name="bitcast.23800.42"}
  %dynamic-slice.1395.7 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_6.876, %bitcast.23800.42, %constant_1627_7, %constant_1627_7), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1395.7"}
  %bitcast.22053.6 = bf16[6144]{0} bitcast(%dynamic-slice.1395.7), metadata={scheduling_name="bitcast.22053.6"}
  %convert.4982.3 = f32[6144]{0} convert(%bitcast.22053.6), metadata={scheduling_name="convert.4982.3"}
  %broadcast.5995.18 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4982.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5995.18"}
  %multiply.2607.15 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3993.23, %broadcast.5995.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2607.15"}
  %param_2.709 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.709"}
  %bitcast.22042.23 = f32[4,8192]{1,0} bitcast(%param_2.709), metadata={scheduling_name="bitcast.22042.23"}
  %broadcast.5584.23 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22042.23), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5584.23"}
  %multiply.2608.9 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2607.15, %broadcast.5584.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2608.9"}
  %param_4.204 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.204"}
  %dynamic-slice.1389.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_4.204, %subtract.247.193, %constant_1627_7, %constant_1627_7, %constant_1627_7, /*index=5*/%constant_1627_7), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1389.1"}
  %bitcast.22017.29 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1389.1), metadata={scheduling_name="bitcast.22017.29"}
  %convert.3942.29 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22017.29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3942.29"}
  %param_1.1128 = f32[1,1,4,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1128"}
  %bitcast.22420.7 = f32[4,8192]{1,0} bitcast(%param_1.1128), metadata={scheduling_name="bitcast.22420.7"}
  %broadcast.5598.7 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22420.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5598.7"}
  %multiply.2613.7 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.29, %broadcast.5598.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2613.7"}
  %add.2918.7 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2608.9, %multiply.2613.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2918.7"}
  %add.2919.5 = f32[1,4,8192,6144]{3,2,1,0} add(%param_0.1242, %add.2918.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.2919.5"}
  ROOT %convert.3995.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2919.5), metadata={scheduling_name="convert.3995.1"}
}

%fused_concatenate.4 (param_0.1309: bf16[1,1,4,8192,64], param_1.1197: bf16[1,1,4,8192,64], param_2.722: bf16[1,4,8192,48,128]) -> bf16[1,4,8192,48,128] {
  %param_2.722 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.722"}
  %slice.2394.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.722), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2394.4"}
  %convert.3981.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2394.4), metadata={scheduling_name="convert.3981.14"}
  %param_0.1309 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1309"}
  %bitcast.22141.37 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1309), metadata={scheduling_name="bitcast.22141.37"}
  %convert.4984.33 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.37), metadata={scheduling_name="convert.4984.33"}
  %broadcast.5997.22 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4984.33), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5997.22"}
  %multiply.2603.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3981.14, %broadcast.5997.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2603.7"}
  %slice.2395.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.722), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2395.4"}
  %convert.3983.12 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2395.4), metadata={scheduling_name="convert.3983.12"}
  %param_1.1197 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1197"}
  %bitcast.22128.33 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1197), metadata={scheduling_name="bitcast.22128.33"}
  %convert.4983.29 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.33), metadata={scheduling_name="convert.4983.29"}
  %broadcast.5996.18 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4983.29), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5996.18"}
  %multiply.2604.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3983.12, %broadcast.5996.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2604.5"}
  %add.2915.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2603.7, %multiply.2604.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2915.5"}
  %convert.3985.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2915.5), metadata={scheduling_name="convert.3985.3"}
  %multiply.2605.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3981.14, %broadcast.5996.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2605.7"}
  %negate.217.7 = f32[1,4,8192,48,64]{4,3,2,1,0} negate(%convert.3983.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.217.7"}
  %multiply.2606.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%negate.217.7, %broadcast.5997.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2606.5"}
  %add.2916.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2605.7, %multiply.2606.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2916.5"}
  %convert.3990.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2916.5), metadata={scheduling_name="convert.3990.3"}
  ROOT %concatenate.710.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.3985.3, %convert.3990.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.710.1"}
}

%fused_concatenate.5 (param_0.1315: bf16[1,1,4,8192,64], param_1.1206: bf16[1,1,4,8192,64], param_2.731: bf16[1,4,8192,48,128]) -> bf16[1,4,8192,48,128] {
  %param_2.731 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.731"}
  %slice.2411.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.731), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2411.4"}
  %convert.4090.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2411.4), metadata={scheduling_name="convert.4090.14"}
  %param_0.1315 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1315"}
  %bitcast.22141.43 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1315), metadata={scheduling_name="bitcast.22141.43"}
  %convert.4984.39 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.43), metadata={scheduling_name="convert.4984.39"}
  %broadcast.5997.28 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4984.39), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5997.28"}
  %multiply.2656.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4090.14, %broadcast.5997.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2656.7"}
  %slice.2412.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.731), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2412.4"}
  %convert.4092.12 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2412.4), metadata={scheduling_name="convert.4092.12"}
  %param_1.1206 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1206"}
  %bitcast.22128.39 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1206), metadata={scheduling_name="bitcast.22128.39"}
  %convert.4983.35 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.39), metadata={scheduling_name="convert.4983.35"}
  %broadcast.5996.24 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4983.35), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5996.24"}
  %multiply.2657.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4092.12, %broadcast.5996.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2657.5"}
  %add.2938.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2656.7, %multiply.2657.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2938.5"}
  %convert.4094.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2938.5), metadata={scheduling_name="convert.4094.3"}
  %multiply.2658.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4090.14, %broadcast.5996.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2658.7"}
  %negate.221.7 = f32[1,4,8192,48,64]{4,3,2,1,0} negate(%convert.4092.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.221.7"}
  %multiply.2659.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%negate.221.7, %broadcast.5997.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2659.5"}
  %add.2939.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2658.7, %multiply.2659.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2939.5"}
  %convert.4099.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2939.5), metadata={scheduling_name="convert.4099.3"}
  ROOT %concatenate.715.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4094.3, %convert.4099.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.715.1"}
}

%fused_concatenate.6 (param_0.1307: bf16[1,1,4,8192,64], param_1.1195: bf16[32768,6144], param_2.720: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.1195 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1195"}
  %bitcast.22076.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.1195), metadata={scheduling_name="bitcast.22076.18"}
  %slice.2388.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.22076.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2388.9"}
  %convert.3945.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2388.9), metadata={scheduling_name="convert.3945.14"}
  %param_2.720 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.720"}
  %bitcast.22128.31 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.720), metadata={scheduling_name="bitcast.22128.31"}
  %convert.4983.27 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.31), metadata={scheduling_name="convert.4983.27"}
  %broadcast.5996.16 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4983.27), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5996.16"}
  %multiply.2590.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3945.14, %broadcast.5996.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2590.7"}
  %slice.2389.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.22076.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2389.9"}
  %convert.3950.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2389.9), metadata={scheduling_name="convert.3950.10"}
  %param_0.1307 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1307"}
  %bitcast.22141.35 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1307), metadata={scheduling_name="bitcast.22141.35"}
  %convert.4984.31 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.35), metadata={scheduling_name="convert.4984.31"}
  %broadcast.5997.20 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4984.31), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5997.20"}
  %multiply.2591.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3950.10, %broadcast.5997.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2591.5"}
  %subtract.253.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2590.7, %multiply.2591.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.253.5"}
  %convert.3953.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.253.5), metadata={scheduling_name="convert.3953.3"}
  %multiply.2592.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3950.10, %broadcast.5996.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2592.5"}
  %multiply.2593.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3945.14, %broadcast.5997.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2593.7"}
  %add.2911.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2592.5, %multiply.2593.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2911.5"}
  %convert.3958.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2911.5), metadata={scheduling_name="convert.3958.3"}
  ROOT %concatenate.707.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.3953.3, %convert.3958.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.707.1"}
}

%fused_concatenate.7 (param_0.1313: bf16[1,1,4,8192,64], param_1.1204: bf16[32768,6144], param_2.729: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.1204 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1204"}
  %bitcast.23141.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.1204), metadata={scheduling_name="bitcast.23141.18"}
  %slice.2405.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.23141.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2405.9"}
  %convert.4056.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2405.9), metadata={scheduling_name="convert.4056.14"}
  %param_2.729 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.729"}
  %bitcast.22128.37 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.729), metadata={scheduling_name="bitcast.22128.37"}
  %convert.4983.33 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.37), metadata={scheduling_name="convert.4983.33"}
  %broadcast.5996.22 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4983.33), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5996.22"}
  %multiply.2637.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4056.14, %broadcast.5996.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2637.7"}
  %slice.2406.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.23141.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2406.9"}
  %convert.4058.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2406.9), metadata={scheduling_name="convert.4058.10"}
  %param_0.1313 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1313"}
  %bitcast.22141.41 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1313), metadata={scheduling_name="bitcast.22141.41"}
  %convert.4984.37 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.41), metadata={scheduling_name="convert.4984.37"}
  %broadcast.5997.26 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4984.37), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5997.26"}
  %multiply.2638.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4058.10, %broadcast.5997.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2638.5"}
  %subtract.257.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2637.7, %multiply.2638.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.257.5"}
  %convert.4060.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.257.5), metadata={scheduling_name="convert.4060.3"}
  %multiply.2639.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4058.10, %broadcast.5996.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2639.5"}
  %multiply.2640.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4056.14, %broadcast.5997.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2640.7"}
  %add.2932.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2639.5, %multiply.2640.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2932.5"}
  %convert.4065.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.2932.5), metadata={scheduling_name="convert.4065.3"}
  ROOT %concatenate.712.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4060.3, %convert.4065.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.712.1"}
}

%fused_concatenate.8 (param_0.1483: bf16[1,1,4,8192,64], param_1.1421: bf16[1,1,4,8192,64], param_2.888: bf16[1,4,8192,8,128]) -> bf16[1,4,8192,8,128] {
  %param_2.888 = bf16[1,4,8192,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.888"}
  %slice.2392.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.888), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2392.4"}
  %convert.3970.12 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2392.4), metadata={scheduling_name="convert.3970.12"}
  %param_0.1483 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1483"}
  %bitcast.22141.103 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1483), metadata={scheduling_name="bitcast.22141.103"}
  %convert.4984.97 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.103), metadata={scheduling_name="convert.4984.97"}
  %broadcast.5999.59 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4984.97), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5999.59"}
  %multiply.2599.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3970.12, %broadcast.5999.59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2599.7"}
  %slice.2393.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.888), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2393.4"}
  %convert.3972.14 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2393.4), metadata={scheduling_name="convert.3972.14"}
  %param_1.1421 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1421"}
  %bitcast.22128.83 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1421), metadata={scheduling_name="bitcast.22128.83"}
  %convert.4983.77 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.83), metadata={scheduling_name="convert.4983.77"}
  %broadcast.5998.43 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4983.77), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5998.43"}
  %multiply.2600.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3972.14, %broadcast.5998.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2600.5"}
  %add.2913.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2599.7, %multiply.2600.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2913.5"}
  %convert.3974.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2913.5), metadata={scheduling_name="convert.3974.3"}
  %multiply.2601.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3970.12, %broadcast.5998.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2601.5"}
  %negate.216.9 = f32[1,4,8192,8,64]{4,3,2,1,0} negate(%convert.3972.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.216.9"}
  %multiply.2602.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%negate.216.9, %broadcast.5999.59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2602.7"}
  %add.2914.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2601.5, %multiply.2602.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2914.5"}
  %convert.3979.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2914.5), metadata={scheduling_name="convert.3979.3"}
  ROOT %concatenate.709.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.3974.3, %convert.3979.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.709.1"}
}

%fused_concatenate.9 (param_0.1490: bf16[1,1,4,8192,64], param_1.1430: bf16[1,1,4,8192,64], param_2.897: bf16[1,4,8192,8,128]) -> bf16[1,4,8192,8,128] {
  %param_2.897 = bf16[1,4,8192,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.897"}
  %slice.2409.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.897), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2409.4"}
  %convert.4079.12 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2409.4), metadata={scheduling_name="convert.4079.12"}
  %param_0.1490 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1490"}
  %bitcast.22141.109 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1490), metadata={scheduling_name="bitcast.22141.109"}
  %convert.4984.103 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.109), metadata={scheduling_name="convert.4984.103"}
  %broadcast.5999.65 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4984.103), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5999.65"}
  %multiply.2652.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4079.12, %broadcast.5999.65), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2652.7"}
  %slice.2410.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.897), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2410.4"}
  %convert.4081.14 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2410.4), metadata={scheduling_name="convert.4081.14"}
  %param_1.1430 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1430"}
  %bitcast.22128.89 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1430), metadata={scheduling_name="bitcast.22128.89"}
  %convert.4983.83 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.89), metadata={scheduling_name="convert.4983.83"}
  %broadcast.5998.49 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4983.83), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5998.49"}
  %multiply.2653.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4081.14, %broadcast.5998.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2653.5"}
  %add.2936.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2652.7, %multiply.2653.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2936.5"}
  %convert.4083.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2936.5), metadata={scheduling_name="convert.4083.3"}
  %multiply.2654.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4079.12, %broadcast.5998.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2654.5"}
  %negate.220.9 = f32[1,4,8192,8,64]{4,3,2,1,0} negate(%convert.4081.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.220.9"}
  %multiply.2655.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%negate.220.9, %broadcast.5999.65), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2655.7"}
  %add.2937.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2654.5, %multiply.2655.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.2937.5"}
  %convert.4088.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2937.5), metadata={scheduling_name="convert.4088.3"}
  ROOT %concatenate.714.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4083.3, %convert.4088.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.714.1"}
}

%fused_concatenate.10 (param_0.1481: bf16[1,1,4,8192,64], param_1.1419: bf16[32768,1024], param_2.886: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.1419 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.1419"}
  %bitcast.22182.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.1419), metadata={scheduling_name="bitcast.22182.14"}
  %slice.2390.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.22182.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2390.7"}
  %convert.3959.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2390.7), metadata={scheduling_name="convert.3959.10"}
  %param_2.886 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.886"}
  %bitcast.22128.79 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.886), metadata={scheduling_name="bitcast.22128.79"}
  %convert.4983.73 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.79), metadata={scheduling_name="convert.4983.73"}
  %broadcast.5998.39 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4983.73), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5998.39"}
  %multiply.2594.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3959.10, %broadcast.5998.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2594.5"}
  %slice.2391.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.22182.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2391.7"}
  %convert.3961.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2391.7), metadata={scheduling_name="convert.3961.10"}
  %param_0.1481 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1481"}
  %bitcast.22141.99 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1481), metadata={scheduling_name="bitcast.22141.99"}
  %convert.4984.93 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.99), metadata={scheduling_name="convert.4984.93"}
  %broadcast.5999.55 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4984.93), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5999.55"}
  %multiply.2595.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3961.10, %broadcast.5999.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2595.7"}
  %subtract.254.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2594.5, %multiply.2595.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.254.5"}
  %convert.3963.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.254.5), metadata={scheduling_name="convert.3963.3"}
  %multiply.2596.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3961.10, %broadcast.5998.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2596.5"}
  %multiply.2597.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3959.10, %broadcast.5999.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2597.7"}
  %add.2912.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2596.5, %multiply.2597.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2912.5"}
  %convert.3968.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2912.5), metadata={scheduling_name="convert.3968.3"}
  ROOT %concatenate.708.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.3963.3, %convert.3968.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.708.1"}
}

%fused_concatenate.11 (param_0.1488: bf16[1,1,4,8192,64], param_1.1428: bf16[32768,1024], param_2.895: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.1428 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.1428"}
  %bitcast.23193.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.1428), metadata={scheduling_name="bitcast.23193.14"}
  %slice.2407.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.23193.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2407.7"}
  %convert.4066.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2407.7), metadata={scheduling_name="convert.4066.10"}
  %param_2.895 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.895"}
  %bitcast.22128.85 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.895), metadata={scheduling_name="bitcast.22128.85"}
  %convert.4983.79 = f32[4,8192,64]{2,1,0} convert(%bitcast.22128.85), metadata={scheduling_name="convert.4983.79"}
  %broadcast.5998.45 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4983.79), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5998.45"}
  %multiply.2641.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4066.10, %broadcast.5998.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2641.5"}
  %slice.2408.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.23193.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2408.7"}
  %convert.4068.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2408.7), metadata={scheduling_name="convert.4068.10"}
  %param_0.1488 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1488"}
  %bitcast.22141.105 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1488), metadata={scheduling_name="bitcast.22141.105"}
  %convert.4984.99 = f32[4,8192,64]{2,1,0} convert(%bitcast.22141.105), metadata={scheduling_name="convert.4984.99"}
  %broadcast.5999.61 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4984.99), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.5999.61"}
  %multiply.2642.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4068.10, %broadcast.5999.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2642.7"}
  %subtract.258.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2641.5, %multiply.2642.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.258.5"}
  %convert.4070.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.258.5), metadata={scheduling_name="convert.4070.3"}
  %multiply.2643.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4068.10, %broadcast.5998.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2643.5"}
  %multiply.2644.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4066.10, %broadcast.5999.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2644.7"}
  %add.2933.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2643.5, %multiply.2644.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.2933.5"}
  %convert.4075.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.2933.5), metadata={scheduling_name="convert.4075.3"}
  ROOT %concatenate.713.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4070.3, %convert.4075.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.713.1"}
}

%fused_convert.14 (param_0.2311: f32[64], param_1.2368: s32[4,4,8192], param_2.2036: s32[16], param_3.1680: u32[], param_4.1448: s32[9], param_5.1315: s32[]) -> (bf16[1,1,4,8192,64], bf16[1,1,4,8192,64]) {
  %param_1.2368 = s32[4,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2368"}
  %param_4.1448 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1448"}
  %constant_1624_29 = s32[] constant(8)
  %param_5.1315 = s32[] parameter(5), metadata={scheduling_name="param_5.1315"}
  %subtract.247.163 = s32[] subtract(%constant_1624_29, %param_5.1315), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.163"}
  %dynamic-slice.1376.144 = s32[1]{0} dynamic-slice(%param_4.1448, %subtract.247.163), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.144"}
  %param_2.2036 = s32[16]{0} parameter(2), metadata={scheduling_name="param_2.2036"}
  %param_3.1680 = u32[] parameter(3), metadata={scheduling_name="param_3.1680"}
  %dynamic-slice.1377.139 = s32[1]{0} dynamic-slice(%param_2.2036, %param_3.1680), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.139"}
  %subtract.248.134 = s32[1]{0} subtract(%dynamic-slice.1376.144, %dynamic-slice.1377.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.134"}
  %constant_2102_6 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.134 = s32[1]{0} maximum(%subtract.248.134, %constant_2102_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.134"}
  %constant_5001_2 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.134 = s32[1]{0} and(%maximum.47.134, %constant_5001_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.134"}
  %compare.1636.5 = pred[1]{0} compare(%and.301.134, %constant_2102_6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="compare.1636.5"}
  %compare.1615.134 = pred[1]{0} compare(%and.301.134, %constant_2102_6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.134"}
  %and.308.5 = pred[1]{0} and(%compare.1636.5, %compare.1615.134), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="and.308.5"}
  %constant_5005_3 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.2909.5 = s32[1]{0} add(%and.301.134, %constant_5005_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="add.2909.5"}
  %select.1276.5 = s32[1]{0} select(%and.308.5, %add.2909.5, %and.301.134), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="select.1276.5"}
  %compare.1637.5 = pred[1]{0} compare(%select.1276.5, %constant_2102_6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="compare.1637.5"}
  %add.2910.5 = s32[1]{0} add(%select.1276.5, %constant_5005_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="add.2910.5"}
  %select.1277.5 = s32[1]{0} select(%compare.1637.5, %add.2910.5, %select.1276.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="select.1277.5"}
  %bitcast.22104.7 = s32[] bitcast(%select.1277.5), metadata={scheduling_name="bitcast.22104.7"}
  %constant_1627_34 = s32[] constant(0)
  %dynamic-slice.1397.7 = s32[1,4,8192]{2,1,0} dynamic-slice(%param_1.2368, %bitcast.22104.7, %constant_1627_34, %constant_1627_34), dynamic_slice_sizes={1,4,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/squeeze" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="dynamic-slice.1397.7"}
  %convert.3946.5 = f32[1,4,8192]{2,1,0} convert(%dynamic-slice.1397.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="convert.3946.5"}
  %bitcast.22109.3 = f32[4,8192]{1,0} bitcast(%convert.3946.5), metadata={scheduling_name="bitcast.22109.3"}
  %broadcast.5586.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.22109.3), dimensions={2,3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5586.3"}
  %param_0.2311 = f32[64]{0} parameter(0), metadata={scheduling_name="param_0.2311"}
  %broadcast.5590.1 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%param_0.2311), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5590.1"}
  %divide.464.4 = f32[1,1,4,8192,64]{4,3,2,1,0} divide(%broadcast.5586.3, %broadcast.5590.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="divide.464.4"}
  %cosine.70.3 = f32[1,1,4,8192,64]{4,3,2,1,0} cosine(%divide.464.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/cos" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="cosine.70.3"}
  %convert.3948.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%cosine.70.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="convert.3948.1"}
  %sine.67.3.clone.1 = f32[1,1,4,8192,64]{4,3,2,1,0} sine(%divide.464.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sin" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="sine.67.3.clone.1"}
  %convert.3951.1.clone.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%sine.67.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="convert.3951.1.clone.1"}
  ROOT %tuple.486 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) tuple(%convert.3948.1, %convert.3951.1.clone.1), metadata={scheduling_name="tuple.486"}
}

%fused_compare.7 (param_0.1610: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_0.1610 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1610"}
  %bitcast.21534.3 = s32[4,8192,2]{2,1,0} bitcast(%param_0.1610), metadata={scheduling_name="bitcast.21534.3"}
  %broadcast.5558.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.21534.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5558.3"}
  %iota.378.1 = s32[1,4,8,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.378.1"}
  ROOT %compare.1630.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5558.3, %iota.378.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1630.1"}
}

%fused_compare.8 (param_0.1609: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_0.1609 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1609"}
  %bitcast.22477.3 = s32[4,8192,2]{2,1,0} bitcast(%param_0.1609), metadata={scheduling_name="bitcast.22477.3"}
  %broadcast.5603.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.22477.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5603.3"}
  %iota.385.1 = s32[1,4,8,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.385.1"}
  ROOT %compare.1638.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5603.3, %iota.385.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1638.1"}
}

%fused_slice.2 (param_0.2369: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.2369 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2369"}
  %convert.3905.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2369), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3905.9"}
  %bitcast.21540.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3905.9), metadata={scheduling_name="bitcast.21540.3"}
  %constant_1627_3 = s32[] constant(0)
  %reduce-window.160.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.21540.3, %constant_1627_3), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.160.3"}
  ROOT %slice.2381.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.160.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2381.1"}
}

%fused_slice.3 (param_0.2374: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.2374 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2374"}
  %convert.3998.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2374), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3998.9"}
  %bitcast.22483.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3998.9), metadata={scheduling_name="bitcast.22483.3"}
  %constant_1627_25 = s32[] constant(0)
  %reduce-window.164.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.22483.3, %constant_1627_25), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.164.3"}
  ROOT %slice.2396.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.164.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2396.1"}
}

%region_6.604.clone.1 (Arg_0.170: f32[], Arg_1.170: f32[]) -> f32[] {
  %Arg_1.170 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.170"}
  %Arg_0.170 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.170"}
  ROOT %add.2871.0 = f32[] add(%Arg_0.170, %Arg_1.170), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2871.0"}
}

%fused_reduce.13 (param_0.2368: s32[1,4,8,8192], param_1.2434: bf16[4,16392,8192]) -> bf16[4,8,8192] {
  %param_1.2434 = bf16[4,16392,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2434"}
  %bitcast.22688.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} bitcast(%param_1.2434), metadata={scheduling_name="bitcast.22688.9"}
  %convert.4014.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%bitcast.22688.9), metadata={scheduling_name="convert.4014.9"}
  %param_0.2368 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2368"}
  %bitcast.22576.15 = s32[4,8,8192]{2,1,0} bitcast(%param_0.2368), metadata={scheduling_name="bitcast.22576.15"}
  %broadcast.5610.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.22576.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5610.15"}
  %iota.387.13 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.387.13"}
  %compare.1640.13 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5610.15, %iota.387.13), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1640.13"}
  %convert.4002.19 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1640.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4002.19"}
  %convert.4003.19 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4002.19), metadata={scheduling_name="convert.4003.19"}
  %multiply.2620.7 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%convert.4014.9, %convert.4003.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2620.7"}
  %convert.4016.5 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2620.7), metadata={scheduling_name="convert.4016.5"}
  %bitcast.22696.5 = bf16[4,8,2049,8192]{3,2,1,0} bitcast(%convert.4016.5), metadata={scheduling_name="bitcast.22696.5"}
  %convert.4017.5 = f32[4,8,2049,8192]{3,2,1,0} convert(%bitcast.22696.5), metadata={scheduling_name="convert.4017.5"}
  %constant_1623_28 = bf16[] constant(0)
  %convert.4978.16 = f32[] convert(%constant_1623_28), metadata={scheduling_name="convert.4978.16"}
  %reduce.504.3 = f32[4,8,8192]{2,1,0} reduce(%convert.4017.5, %convert.4978.16), dimensions={2}, to_apply=%region_6.604.clone.1, metadata={scheduling_name="reduce.504.3"}
  ROOT %convert.4019.1 = bf16[4,8,8192]{2,1,0} convert(%reduce.504.3), metadata={scheduling_name="convert.4019.1"}
}

%region_6.604.clone (Arg_0.169: f32[], Arg_1.169: f32[]) -> f32[] {
  %Arg_1.169 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.169"}
  %Arg_0.169 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.169"}
  ROOT %add.2870.0 = f32[] add(%Arg_0.169, %Arg_1.169), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2870.0"}
}

%fused_reduce.14 (param_0.2367: s32[1,4,8,8192], param_1.2433: bf16[4,16392,8192]) -> bf16[4,8,8192] {
  %param_1.2433 = bf16[4,16392,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2433"}
  %bitcast.21882.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} bitcast(%param_1.2433), metadata={scheduling_name="bitcast.21882.9"}
  %convert.3929.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%bitcast.21882.9), metadata={scheduling_name="convert.3929.9"}
  %param_0.2367 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2367"}
  %bitcast.21632.15 = s32[4,8,8192]{2,1,0} bitcast(%param_0.2367), metadata={scheduling_name="bitcast.21632.15"}
  %broadcast.5565.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.21632.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5565.15"}
  %iota.379.13 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.379.13"}
  %compare.1632.13 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5565.15, %iota.379.13), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1632.13"}
  %convert.3909.19 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1632.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.3909.19"}
  %convert.3910.19 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.3909.19), metadata={scheduling_name="convert.3910.19"}
  %multiply.2571.7 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%convert.3929.9, %convert.3910.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2571.7"}
  %convert.3931.5 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2571.7), metadata={scheduling_name="convert.3931.5"}
  %bitcast.21890.5 = bf16[4,8,2049,8192]{3,2,1,0} bitcast(%convert.3931.5), metadata={scheduling_name="bitcast.21890.5"}
  %convert.3932.5 = f32[4,8,2049,8192]{3,2,1,0} convert(%bitcast.21890.5), metadata={scheduling_name="convert.3932.5"}
  %constant_1623_27 = bf16[] constant(0)
  %convert.4978.18 = f32[] convert(%constant_1623_27), metadata={scheduling_name="convert.4978.18"}
  %reduce.501.3 = f32[4,8,8192]{2,1,0} reduce(%convert.3932.5, %convert.4978.18), dimensions={2}, to_apply=%region_6.604.clone, metadata={scheduling_name="reduce.501.3"}
  ROOT %convert.3934.1 = bf16[4,8,8192]{2,1,0} convert(%reduce.501.3), metadata={scheduling_name="convert.3934.1"}
}

%fused_select (param_0.1746: pred[1,4,8192,2], param_1.2559: s32[32768,2], param_2.1901: s32[4,8,8192], param_3.1496: bf16[4,8,8192], param_4.1187: s32[3], param_5.1329: u32[16], param_6.1277: u32[], param_7.1201: s32[16]) -> bf16[1,4,8192,2] {
  %param_0.1746 = pred[1,4,8192,2]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1746"}
  %iota.373.46 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.46"}
  %param_7.1201 = s32[16]{0} parameter(7), metadata={scheduling_name="param_7.1201"}
  %param_6.1277 = u32[] parameter(6), metadata={scheduling_name="param_6.1277"}
  %dynamic-slice.1384.9 = s32[1]{0} dynamic-slice(%param_7.1201, %param_6.1277), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.9"}
  %constant_5005_7 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.9 = s32[1]{0} multiply(%dynamic-slice.1384.9, %constant_5005_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.9"}
  %bitcast.21171.50 = s32[] bitcast(%multiply.2551.9), metadata={scheduling_name="bitcast.21171.50"}
  %broadcast.5539.49 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.50), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.49"}
  %add.2890.46 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.46, %broadcast.5539.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.46"}
  %iota.375.17 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.17"}
  %param_1.2559 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2559"}
  %bitcast.21452.75 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2559), metadata={scheduling_name="bitcast.21452.75"}
  %constant_1627_43 = s32[] constant(0)
  %broadcast.5540.50 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_43), dimensions={}, metadata={scheduling_name="broadcast.5540.50"}
  %compare.1628.25 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.75, %broadcast.5540.50), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.25"}
  %constant_1624_4 = s32[] constant(8)
  %broadcast.5541.46 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_4), dimensions={}, metadata={scheduling_name="broadcast.5541.46"}
  %add.2898.25 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.75, %broadcast.5541.46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2898.25"}
  %select.1271.25 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.25, %add.2898.25, %bitcast.21452.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.25"}
  %bitcast.21465.23 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.25), metadata={scheduling_name="bitcast.21465.23"}
  %concatenate.705.23 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.46, %iota.375.17, %bitcast.21465.23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.23"}
  %broadcast.5543.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%constant_1627_43), dimensions={}, metadata={scheduling_name="broadcast.5543.10"}
  %compare.1634.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.705.23, %broadcast.5543.10), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/ge" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1634.5"}
  %param_4.1187 = s32[3]{0} parameter(4), metadata={scheduling_name="param_4.1187"}
  %broadcast.5544.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%param_4.1187), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5544.10"}
  %compare.1635.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.705.23, %broadcast.5544.10), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1635.5"}
  %and.307.3 = pred[1,3,4,8192,2]{4,3,2,1,0} and(%compare.1634.5, %compare.1635.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.307.3"}
  %bitcast.21837.3 = pred[3,4,8192,2]{3,2,1,0} bitcast(%and.307.3), metadata={scheduling_name="bitcast.21837.3"}
  %constant_1725_5 = pred[] constant(true)
  %reduce.409.3 = pred[4,8192,2]{2,1,0} reduce(%bitcast.21837.3, %constant_1725_5), dimensions={0}, to_apply=%region_51.2293, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reduce.409.3"}
  %bitcast.21842.3 = pred[1,4,8192,2]{3,2,1,0} bitcast(%reduce.409.3), metadata={scheduling_name="bitcast.21842.3"}
  %param_3.1496 = bf16[4,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.1496"}
  %bitcast.21899.11 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%param_3.1496), metadata={scheduling_name="bitcast.21899.11"}
  %convert.3935.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21899.11), metadata={scheduling_name="convert.3935.11"}
  %param_2.1901 = s32[4,8,8192]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1901"}
  %bitcast.21605.12 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_2.1901), metadata={scheduling_name="bitcast.21605.12"}
  %convert.3906.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21605.12), metadata={scheduling_name="convert.3906.11"}
  %multiply.2572.9 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3935.11, %convert.3906.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2572.9"}
  %convert.3937.7 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2572.9), metadata={scheduling_name="convert.3937.7"}
  %bitcast.21908.5 = bf16[1,4,8192,8]{2,3,1,0} bitcast(%convert.3937.7), metadata={scheduling_name="bitcast.21908.5"}
  %constant_5006_4 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_5.1329 = u32[16]{0} parameter(5), metadata={scheduling_name="param_5.1329"}
  %dynamic-slice.1385.7 = u32[1]{0} dynamic-slice(%param_5.1329, %param_6.1277), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.7"}
  %constant_5007_4 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.7 = u32[1]{0} clamp(%constant_5006_4, %dynamic-slice.1385.7, %constant_5007_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.7"}
  %convert.3893.7 = s32[1]{0} convert(%clamp.26.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.7"}
  %multiply.2554.7 = s32[1]{0} multiply(%convert.3893.7, %constant_5005_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.7"}
  %constant_2102_11 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.12 = s32[3]{0} concatenate(%multiply.2554.7, %constant_2102_11, %constant_2102_11), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.12"}
  %broadcast.5542.24 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.12), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.24"}
  %subtract.250.13 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.23, %broadcast.5542.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.13"}
  %pad.348.9 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.13, %constant_1627_43), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.9"}
  %bitcast.21910.8 = s32[65536,4]{0,1} bitcast(%pad.348.9), metadata={scheduling_name="bitcast.21910.8"}
  %gather.337.5 = bf16[65536,1,1,1,1]{0,4,3,2,1} gather(%bitcast.21908.5, %bitcast.21910.8), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.337.5"}
  %bitcast.21913.3 = bf16[1,4,8192,2]{3,2,1,0} bitcast(%gather.337.5), metadata={scheduling_name="bitcast.21913.3"}
  %constant_1623_47 = bf16[] constant(0)
  %broadcast.5557.8 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1623_47), dimensions={}, metadata={scheduling_name="broadcast.5557.8"}
  %select.1274.3 = bf16[1,4,8192,2]{3,2,1,0} select(%bitcast.21842.3, %bitcast.21913.3, %broadcast.5557.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1274.3"}
  ROOT %select.1275.1 = bf16[1,4,8192,2]{3,2,1,0} select(%param_0.1746, %select.1274.3, %broadcast.5557.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1275.1"}
}

%fused_select.1 (param_0.1749: pred[1,4,8192,2], param_1.2551: s32[32768,2], param_2.1894: s32[4,8,8192], param_3.1488: bf16[4,8,8192], param_4.1179: s32[3], param_5.1330: u32[16], param_6.1278: u32[], param_7.1202: s32[16]) -> bf16[1,4,8192,2] {
  %param_0.1749 = pred[1,4,8192,2]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1749"}
  %iota.373.42 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.42"}
  %param_7.1202 = s32[16]{0} parameter(7), metadata={scheduling_name="param_7.1202"}
  %param_6.1278 = u32[] parameter(6), metadata={scheduling_name="param_6.1278"}
  %dynamic-slice.1384.15 = s32[1]{0} dynamic-slice(%param_7.1202, %param_6.1278), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1384.15"}
  %constant_5005_8 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2551.15 = s32[1]{0} multiply(%dynamic-slice.1384.15, %constant_5005_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2551.15"}
  %bitcast.21171.46 = s32[] bitcast(%multiply.2551.15), metadata={scheduling_name="bitcast.21171.46"}
  %broadcast.5539.45 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21171.46), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5539.45"}
  %add.2890.42 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.42, %broadcast.5539.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2890.42"}
  %iota.374.17 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.17"}
  %param_1.2551 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2551"}
  %bitcast.21202.75 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2551), metadata={scheduling_name="bitcast.21202.75"}
  %constant_1627_39 = s32[] constant(0)
  %broadcast.5540.46 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1627_39), dimensions={}, metadata={scheduling_name="broadcast.5540.46"}
  %compare.1619.25 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21202.75, %broadcast.5540.46), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.25"}
  %constant_1624_7 = s32[] constant(8)
  %broadcast.5541.42 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1624_7), dimensions={}, metadata={scheduling_name="broadcast.5541.42"}
  %add.2892.25 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21202.75, %broadcast.5541.42), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2892.25"}
  %select.1265.25 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.25, %add.2892.25, %bitcast.21202.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1265.25"}
  %bitcast.21215.23 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1265.25), metadata={scheduling_name="bitcast.21215.23"}
  %concatenate.703.23 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2890.42, %iota.374.17, %bitcast.21215.23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.23"}
  %broadcast.5543.8 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%constant_1627_39), dimensions={}, metadata={scheduling_name="broadcast.5543.8"}
  %compare.1621.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.703.23, %broadcast.5543.8), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/ge" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1621.5"}
  %param_4.1179 = s32[3]{0} parameter(4), metadata={scheduling_name="param_4.1179"}
  %broadcast.5544.8 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%param_4.1179), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5544.8"}
  %compare.1622.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.703.23, %broadcast.5544.8), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1622.5"}
  %and.304.3 = pred[1,3,4,8192,2]{4,3,2,1,0} and(%compare.1621.5, %compare.1622.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.304.3"}
  %bitcast.21265.3 = pred[3,4,8192,2]{3,2,1,0} bitcast(%and.304.3), metadata={scheduling_name="bitcast.21265.3"}
  %constant_1725_4 = pred[] constant(true)
  %reduce.404.3 = pred[4,8192,2]{2,1,0} reduce(%bitcast.21265.3, %constant_1725_4), dimensions={0}, to_apply=%region_51.2293, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reduce.404.3"}
  %bitcast.21270.3 = pred[1,4,8192,2]{3,2,1,0} bitcast(%reduce.404.3), metadata={scheduling_name="bitcast.21270.3"}
  %param_3.1488 = bf16[4,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.1488"}
  %bitcast.22705.11 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%param_3.1488), metadata={scheduling_name="bitcast.22705.11"}
  %convert.4020.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22705.11), metadata={scheduling_name="convert.4020.11"}
  %param_2.1894 = s32[4,8,8192]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1894"}
  %bitcast.22549.12 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_2.1894), metadata={scheduling_name="bitcast.22549.12"}
  %convert.3999.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22549.12), metadata={scheduling_name="convert.3999.11"}
  %multiply.2621.9 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4020.11, %convert.3999.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2621.9"}
  %convert.4022.7 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2621.9), metadata={scheduling_name="convert.4022.7"}
  %bitcast.22714.5 = bf16[1,4,8192,8]{2,3,1,0} bitcast(%convert.4022.7), metadata={scheduling_name="bitcast.22714.5"}
  %constant_5006_5 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_5.1330 = u32[16]{0} parameter(5), metadata={scheduling_name="param_5.1330"}
  %dynamic-slice.1385.9 = u32[1]{0} dynamic-slice(%param_5.1330, %param_6.1278), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1385.9"}
  %constant_5007_5 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.9 = u32[1]{0} clamp(%constant_5006_5, %dynamic-slice.1385.9, %constant_5007_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.9"}
  %convert.3893.9 = s32[1]{0} convert(%clamp.26.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.9"}
  %multiply.2554.9 = s32[1]{0} multiply(%convert.3893.9, %constant_5005_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2554.9"}
  %constant_2102_2 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.14 = s32[3]{0} concatenate(%multiply.2554.9, %constant_2102_2, %constant_2102_2), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.14"}
  %broadcast.5542.26 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5542.26"}
  %subtract.249.13 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.23, %broadcast.5542.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.13"}
  %pad.347.9 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.13, %constant_1627_39), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.9"}
  %bitcast.22716.8 = s32[65536,4]{0,1} bitcast(%pad.347.9), metadata={scheduling_name="bitcast.22716.8"}
  %gather.345.5 = bf16[65536,1,1,1,1]{0,4,3,2,1} gather(%bitcast.22714.5, %bitcast.22716.8), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.345.5"}
  %bitcast.22719.3 = bf16[1,4,8192,2]{3,2,1,0} bitcast(%gather.345.5), metadata={scheduling_name="bitcast.22719.3"}
  %constant_1623_4 = bf16[] constant(0)
  %broadcast.5557.10 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1623_4), dimensions={}, metadata={scheduling_name="broadcast.5557.10"}
  %select.1280.3 = bf16[1,4,8192,2]{3,2,1,0} select(%bitcast.21270.3, %bitcast.22719.3, %broadcast.5557.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1280.3"}
  ROOT %select.1281.1 = bf16[1,4,8192,2]{3,2,1,0} select(%param_0.1749, %select.1280.3, %broadcast.5557.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1281.1"}
}

%fused_multiply.1 (param_0.2407: f32[1,1,4,8192], param_1.2548: f32[4,8192], param_2.1891: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2548 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2548"}
  %bitcast.21995.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2548), metadata={scheduling_name="bitcast.21995.3"}
  %param_0.2407 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2407"}
  %param_2.1891 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1891"}
  %bitcast.21392.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1891), metadata={scheduling_name="bitcast.21392.5"}
  %constant_1652_7 = f32[] constant(0.000162760422)
  %broadcast.5527.22 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_7), dimensions={}, metadata={scheduling_name="broadcast.5527.22"}
  %multiply.2556.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21392.5, %broadcast.5527.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2556.5"}
  %constant_1653_7 = f32[] constant(1e-05)
  %broadcast.5528.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_7), dimensions={}, metadata={scheduling_name="broadcast.5528.14"}
  %add.2897.3 = f32[1,4,8192]{2,1,0} add(%multiply.2556.5, %broadcast.5528.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2897.3"}
  %bitcast.21402.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2897.3), metadata={scheduling_name="bitcast.21402.6"}
  %divide.463.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2407, %bitcast.21402.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.463.5"}
  %constant_1999_2 = f32[] constant(-0.5)
  %broadcast.5579.20 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_1999_2), dimensions={}, metadata={scheduling_name="broadcast.5579.20"}
  %multiply.2580.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.463.5, %broadcast.5579.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2580.5"}
  %multiply.2581.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.21995.3, %multiply.2580.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2581.3"}
  %constant_2000_2 = f32[] constant(0.000325520843)
  %broadcast.5580.1 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2000_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5580.1"}
  ROOT %multiply.2582.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2581.3, %broadcast.5580.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2582.1"}
}

%fused_multiply.2 (param_0.2408: f32[1,1,4,8192], param_1.2549: f32[4,8192], param_2.1892: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2549 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2549"}
  %bitcast.22404.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2549), metadata={scheduling_name="bitcast.22404.3"}
  %param_0.2408 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2408"}
  %param_2.1892 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1892"}
  %bitcast.22029.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1892), metadata={scheduling_name="bitcast.22029.5"}
  %constant_1652_6 = f32[] constant(0.000162760422)
  %broadcast.5527.18 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_6), dimensions={}, metadata={scheduling_name="broadcast.5527.18"}
  %multiply.2585.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22029.5, %broadcast.5527.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2585.5"}
  %constant_1653_6 = f32[] constant(1e-05)
  %broadcast.5528.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_6), dimensions={}, metadata={scheduling_name="broadcast.5528.10"}
  %add.2908.3 = f32[1,4,8192]{2,1,0} add(%multiply.2585.5, %broadcast.5528.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2908.3"}
  %bitcast.22039.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2908.3), metadata={scheduling_name="bitcast.22039.6"}
  %divide.465.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2408, %bitcast.22039.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.465.5"}
  %constant_1999_3 = f32[] constant(-0.5)
  %broadcast.5579.16 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_1999_3), dimensions={}, metadata={scheduling_name="broadcast.5579.16"}
  %multiply.2610.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.465.5, %broadcast.5579.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2610.5"}
  %multiply.2611.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.22404.3, %multiply.2610.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2611.3"}
  %constant_2000_3 = f32[] constant(0.000325520843)
  %broadcast.5580.2 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2000_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5580.2"}
  ROOT %multiply.2612.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2611.3, %broadcast.5580.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2612.1"}
}

%fused_multiply.3 (param_0.2409: f32[1,1,4,8192], param_1.2550: f32[4,8192], param_2.1893: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2550 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2550"}
  %bitcast.23298.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2550), metadata={scheduling_name="bitcast.23298.3"}
  %param_0.2409 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2409"}
  %param_2.1893 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1893"}
  %bitcast.21076.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1893), metadata={scheduling_name="bitcast.21076.5"}
  %constant_1652_8 = f32[] constant(0.000162760422)
  %broadcast.5527.26 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_8), dimensions={}, metadata={scheduling_name="broadcast.5527.26"}
  %multiply.2547.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21076.5, %broadcast.5527.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2547.5"}
  %constant_1653_8 = f32[] constant(1e-05)
  %broadcast.5528.18 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_8), dimensions={}, metadata={scheduling_name="broadcast.5528.18"}
  %add.2884.3 = f32[1,4,8192]{2,1,0} add(%multiply.2547.5, %broadcast.5528.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2884.3"}
  %bitcast.21084.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2884.3), metadata={scheduling_name="bitcast.21084.6"}
  %divide.470.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2409, %bitcast.21084.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.470.5"}
  %constant_1999_4 = f32[] constant(-0.5)
  %broadcast.5579.12 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_1999_4), dimensions={}, metadata={scheduling_name="broadcast.5579.12"}
  %multiply.2648.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.470.5, %broadcast.5579.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2648.5"}
  %multiply.2649.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.23298.3, %multiply.2648.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2649.3"}
  %constant_2000_4 = f32[] constant(0.000325520843)
  %broadcast.5580.3 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2000_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5580.3"}
  ROOT %multiply.2650.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2649.3, %broadcast.5580.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2650.1"}
}

%fused_multiply.4 (param_0.2406: f32[1,1,4,8192], param_1.2547: f32[4,8192], param_2.1890: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2547 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2547"}
  %bitcast.24115.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2547), metadata={scheduling_name="bitcast.24115.3"}
  %param_0.2406 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2406"}
  %param_2.1890 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1890"}
  %bitcast.23092.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1890), metadata={scheduling_name="bitcast.23092.5"}
  %constant_1652_5 = f32[] constant(0.000162760422)
  %broadcast.5527.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_1652_5), dimensions={}, metadata={scheduling_name="broadcast.5527.14"}
  %multiply.2634.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.23092.5, %broadcast.5527.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2634.5"}
  %constant_1653_5 = f32[] constant(1e-05)
  %broadcast.5528.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_1653_5), dimensions={}, metadata={scheduling_name="broadcast.5528.6"}
  %add.2931.3 = f32[1,4,8192]{2,1,0} add(%multiply.2634.5, %broadcast.5528.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2931.3"}
  %bitcast.23102.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2931.3), metadata={scheduling_name="bitcast.23102.6"}
  %divide.471.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2406, %bitcast.23102.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.471.5"}
  %constant_1999_1 = f32[] constant(-0.5)
  %broadcast.5579.8 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_1999_1), dimensions={}, metadata={scheduling_name="broadcast.5579.8"}
  %multiply.2666.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.471.5, %broadcast.5579.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2666.5"}
  %multiply.2667.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.24115.3, %multiply.2666.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2667.3"}
  %constant_2000_1 = f32[] constant(0.000325520843)
  %broadcast.5580.4 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2000_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5580.4"}
  ROOT %multiply.2668.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2667.3, %broadcast.5580.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2668.1"}
}

%fused_convert.15 (param_0.1924: f32[32768,8]) -> f32[32768,2] {
  %param_0.1924 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.1924"}
  %convert.3889.3 = bf16[32768,8]{1,0} convert(%param_0.1924), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.3889.3"}
  %slice.2377.3 = bf16[32768,2]{1,0} slice(%convert.3889.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2377.3"}
  ROOT %convert.3890.1 = f32[32768,2]{1,0} convert(%slice.2377.3), metadata={scheduling_name="convert.3890.1"}
}

%fused_convert.16 (param_0.1928: f32[32768,8]) -> f32[32768,2] {
  %param_0.1928 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.1928"}
  %convert.3901.3 = bf16[32768,8]{1,0} convert(%param_0.1928), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.3901.3"}
  %slice.2379.3 = bf16[32768,2]{1,0} slice(%convert.3901.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2379.3"}
  ROOT %convert.3902.1 = f32[32768,2]{1,0} convert(%slice.2379.3), metadata={scheduling_name="convert.3902.1"}
}

%region_6.604.clone.9 (Arg_0.178: f32[], Arg_1.178: f32[]) -> f32[] {
  %Arg_1.178 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.178"}
  %Arg_0.178 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.178"}
  ROOT %add.2879.0 = f32[] add(%Arg_0.178, %Arg_1.178), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2879.0"}
}

%fused_reduce.15 (param_0.1943: f32[128,6144]) -> bf16[6144] {
  %param_0.1943 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1943"}
  %constant_1623_36 = bf16[] constant(0)
  %convert.4978.20 = f32[] convert(%constant_1623_36), metadata={scheduling_name="convert.4978.20"}
  %reduce.425.3 = f32[6144]{0} reduce(%param_0.1943, %convert.4978.20), dimensions={0}, to_apply=%region_6.604.clone.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.425.3"}
  ROOT %convert.4156.1 = bf16[6144]{0} convert(%reduce.425.3), metadata={scheduling_name="convert.4156.1"}
}

%region_6.604.clone.7 (Arg_0.176: f32[], Arg_1.176: f32[]) -> f32[] {
  %Arg_1.176 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.176"}
  %Arg_0.176 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.176"}
  ROOT %add.2877.0 = f32[] add(%Arg_0.176, %Arg_1.176), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2877.0"}
}

%fused_reduce.16 (param_0.1946: f32[128,6144]) -> bf16[6144] {
  %param_0.1946 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1946"}
  %constant_1623_34 = bf16[] constant(0)
  %convert.4978.22 = f32[] convert(%constant_1623_34), metadata={scheduling_name="convert.4978.22"}
  %reduce.424.3 = f32[6144]{0} reduce(%param_0.1946, %convert.4978.22), dimensions={0}, to_apply=%region_6.604.clone.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.424.3"}
  ROOT %convert.4145.1 = bf16[6144]{0} convert(%reduce.424.3), metadata={scheduling_name="convert.4145.1"}
}

%region_6.604.clone.5 (Arg_0.174: f32[], Arg_1.174: f32[]) -> f32[] {
  %Arg_1.174 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.174"}
  %Arg_0.174 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.174"}
  ROOT %add.2875.0 = f32[] add(%Arg_0.174, %Arg_1.174), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2875.0"}
}

%fused_reduce.17 (param_0.1949: f32[128,6144]) -> bf16[6144] {
  %param_0.1949 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1949"}
  %constant_1623_32 = bf16[] constant(0)
  %convert.4978.24 = f32[] convert(%constant_1623_32), metadata={scheduling_name="convert.4978.24"}
  %reduce.423.3 = f32[6144]{0} reduce(%param_0.1949, %convert.4978.24), dimensions={0}, to_apply=%region_6.604.clone.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.423.3"}
  ROOT %convert.4107.1 = bf16[6144]{0} convert(%reduce.423.3), metadata={scheduling_name="convert.4107.1"}
}

%region_6.604.clone.3 (Arg_0.172: f32[], Arg_1.172: f32[]) -> f32[] {
  %Arg_1.172 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.172"}
  %Arg_0.172 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.172"}
  ROOT %add.2873.0 = f32[] add(%Arg_0.172, %Arg_1.172), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2873.0"}
}

%fused_reduce.18 (param_0.1952: f32[128,6144]) -> bf16[6144] {
  %param_0.1952 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1952"}
  %constant_1623_30 = bf16[] constant(0)
  %convert.4978.26 = f32[] convert(%constant_1623_30), metadata={scheduling_name="convert.4978.26"}
  %reduce.420.3 = f32[6144]{0} reduce(%param_0.1952, %convert.4978.26), dimensions={0}, to_apply=%region_6.604.clone.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.420.3"}
  ROOT %convert.4049.1 = bf16[6144]{0} convert(%reduce.420.3), metadata={scheduling_name="convert.4049.1"}
}

%fused_power () -> f32[64] {
  %constant_2041_1 = f32[] constant(1e+06)
  %broadcast.5587.1 = f32[64]{0} broadcast(%constant_2041_1), dimensions={}, metadata={scheduling_name="broadcast.5587.1"}
  %iota.383.1 = s32[64]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/iota" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="iota.383.1"}
  %constant_1631_3 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %broadcast.5588.1 = s32[64]{0} broadcast(%constant_1631_3), dimensions={}, metadata={scheduling_name="broadcast.5588.1"}
  %multiply.2588.3 = s32[64]{0} multiply(%iota.383.1, %broadcast.5588.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2588.3"}
  %convert.3947.3 = f32[64]{0} convert(%multiply.2588.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="convert.3947.3"}
  %constant_2043_1 = f32[] constant(0.0078125)
  %broadcast.5589.1 = f32[64]{0} broadcast(%constant_2043_1), dimensions={}, metadata={scheduling_name="broadcast.5589.1"}
  %multiply.2589.1 = f32[64]{0} multiply(%convert.3947.3, %broadcast.5589.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2589.1"}
  ROOT %power.22.1 = f32[64]{0} power(%broadcast.5587.1, %multiply.2589.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 scheduling_name="power.22.1"}
}

%fused_multiply.5 () -> s32[33] {
  %iota.384.1 = s32[33]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="iota.384.1"}
  %constant_5154_1 = s32[] constant(8192), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %broadcast.5595.1 = s32[33]{0} broadcast(%constant_5154_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5595.1"}
  ROOT %multiply.2598.1 = s32[33]{0} multiply(%iota.384.1, %broadcast.5595.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="multiply.2598.1"}
}

%fused_reduce.19 (param_0.2403: s32[4], param_1.2585: s32[16], param_2.2001: u32[], param_3.1645: s32[9], param_4.1399: s32[]) -> pred[] {
  %constant_1627_1 = s32[] constant(0)
  %broadcast.5525.3 = s32[4]{0} broadcast(%constant_1627_1), dimensions={}, metadata={scheduling_name="broadcast.5525.3"}
  %constant_2102_3 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %constant_5004_3 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1645 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1645"}
  %constant_1624_41 = s32[] constant(8)
  %param_4.1399 = s32[] parameter(4), metadata={scheduling_name="param_4.1399"}
  %subtract.247.39 = s32[] subtract(%constant_1624_41, %param_4.1399), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.39"}
  %dynamic-slice.1376.20 = s32[1]{0} dynamic-slice(%param_3.1645, %subtract.247.39), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.20"}
  %param_1.2585 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1.2585"}
  %param_2.2001 = u32[] parameter(2), metadata={scheduling_name="param_2.2001"}
  %dynamic-slice.1377.15 = s32[1]{0} dynamic-slice(%param_1.2585, %param_2.2001), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.15"}
  %subtract.248.10 = s32[1]{0} subtract(%dynamic-slice.1376.20, %dynamic-slice.1377.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.10"}
  %maximum.47.10 = s32[1]{0} maximum(%subtract.248.10, %constant_2102_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.10"}
  %sign.27.9 = s32[1]{0} sign(%maximum.47.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.9"}
  %constant_5000_8 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.9 = pred[1]{0} compare(%sign.27.9, %constant_5000_8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.9"}
  %constant_5001_6 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.10 = s32[1]{0} and(%maximum.47.10, %constant_5001_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.10"}
  %compare.1615.10 = pred[1]{0} compare(%and.301.10, %constant_2102_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.10"}
  %and.302.9 = pred[1]{0} and(%compare.1614.9, %compare.1615.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.9"}
  %constant_5002_5 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.9 = s32[1]{0} shift-right-logical(%maximum.47.10, %constant_5002_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.9"}
  %constant_5003_5 = s32[1]{0} constant({-1})
  %add.2882.9 = s32[1]{0} add(%shift-right-logical.20.9, %constant_5003_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.9"}
  %select.1263.9 = s32[1]{0} select(%and.302.9, %add.2882.9, %shift-right-logical.20.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.9"}
  %compare.1616.9 = pred[1]{0} compare(%select.1263.9, %constant_2102_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.9"}
  %add.2883.9 = s32[1]{0} add(%select.1263.9, %constant_5002_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.9"}
  %select.1264.9 = s32[1]{0} select(%compare.1616.9, %add.2883.9, %select.1263.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.9"}
  %bitcast.20992.27 = s32[1,1]{1,0} bitcast(%select.1264.9), metadata={scheduling_name="bitcast.20992.27"}
  %concatenate.699.19 = s32[1,4]{1,0} concatenate(%constant_5004_3, %bitcast.20992.27, %constant_5004_3, %constant_5004_3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.19"}
  %bitcast.20995.16 = s32[4]{0} bitcast(%concatenate.699.19), metadata={scheduling_name="bitcast.20995.16"}
  %slice.2374.3 = s32[3]{0} slice(%bitcast.20995.16), slice={[1:4]}, metadata={scheduling_name="slice.2374.3"}
  %concatenate.700.1 = s32[4]{0} concatenate(%constant_2102_3, %slice.2374.3), dimensions={0}, metadata={scheduling_name="concatenate.700.1"}
  %compare.1617.3 = pred[4]{0} compare(%broadcast.5525.3, %concatenate.700.1), direction=LE, metadata={scheduling_name="compare.1617.3"}
  %param_0.2403 = s32[4]{0} parameter(0), metadata={scheduling_name="param_0.2403"}
  %compare.1618.3 = pred[4]{0} compare(%param_0.2403, %concatenate.700.1), direction=GE, metadata={scheduling_name="compare.1618.3"}
  %and.303.3 = pred[4]{0} and(%compare.1617.3, %compare.1618.3), metadata={scheduling_name="and.303.3"}
  %constant_1725_1 = pred[] constant(true)
  ROOT %reduce.298.1 = pred[] reduce(%and.303.3, %constant_1725_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.298.1"}
}

%fused_compare.9 (param_0.2413: s32[16], param_1.2562: u32[]) -> pred[1] {
  %param_0.2413 = s32[16]{0} parameter(0), metadata={scheduling_name="param_0.2413"}
  %param_1.2562 = u32[] parameter(1), metadata={scheduling_name="param_1.2562"}
  %dynamic-slice.1377.3 = s32[1]{0} dynamic-slice(%param_0.2413, %param_1.2562), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.3"}
  %constant_5000_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  ROOT %compare.1623.1 = pred[1]{0} compare(%dynamic-slice.1377.3, %constant_5000_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="compare.1623.1"}
}

%fused_compare.10 (param_0.2412: s32[16], param_1.2557: u32[]) -> pred[1] {
  %param_0.2412 = s32[16]{0} parameter(0), metadata={scheduling_name="param_0.2412"}
  %param_1.2557 = u32[] parameter(1), metadata={scheduling_name="param_1.2557"}
  %dynamic-slice.1377.4 = s32[1]{0} dynamic-slice(%param_0.2412, %param_1.2557), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.4"}
  %constant_2102_9 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  ROOT %compare.1654.1 = pred[1]{0} compare(%dynamic-slice.1377.4, %constant_2102_9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="compare.1654.1"}
}

%fused_dynamic_slice.22 (param_0.2222: u32[9,2,4], param_1.2517: s32[]) -> u32[1,2,4] {
  %param_0.2222 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2222"}
  %constant_1624_8 = s32[] constant(8)
  %param_1.2517 = s32[] parameter(1), metadata={scheduling_name="param_1.2517"}
  %subtract.247.1 = s32[] subtract(%constant_1624_8, %param_1.2517), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.1"}
  %constant_1627_108 = s32[] constant(0)
  ROOT %dynamic-slice.1401.1 = u32[1,2,4]{2,1,0} dynamic-slice(%param_0.2222, %subtract.247.1, %constant_1627_108, %constant_1627_108), dynamic_slice_sizes={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1401.1"}
}

%fused_dynamic_slice.23 (param_0.2224: u32[9,2,4], param_1.2458: s32[]) -> u32[1,2,4] {
  %param_0.2224 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2224"}
  %constant_1624_10 = s32[] constant(8)
  %param_1.2458 = s32[] parameter(1), metadata={scheduling_name="param_1.2458"}
  %subtract.247.3 = s32[] subtract(%constant_1624_10, %param_1.2458), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.3"}
  %constant_1627_42 = s32[] constant(0)
  ROOT %dynamic-slice.1415.1 = u32[1,2,4]{2,1,0} dynamic-slice(%param_0.2224, %subtract.247.3, %constant_1627_42, %constant_1627_42), dynamic_slice_sizes={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1415.1"}
}

%fused_dynamic_slice.24 (param_0.2226: bf16[9,1,4,8192,48,128], param_1.2487: s32[]) -> bf16[1,1,4,8192,48,128] {
  %param_0.2226 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2226"}
  %constant_1624_13 = s32[] constant(8)
  %param_1.2487 = s32[] parameter(1), metadata={scheduling_name="param_1.2487"}
  %subtract.247.6 = s32[] subtract(%constant_1624_13, %param_1.2487), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.6"}
  %constant_1627_74 = s32[] constant(0)
  ROOT %dynamic-slice.1379.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-slice(%param_0.2226, %subtract.247.6, %constant_1627_74, %constant_1627_74, %constant_1627_74, /*index=5*/%constant_1627_74, %constant_1627_74), dynamic_slice_sizes={1,1,4,8192,48,128}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1379.1"}
}

%fused_convert_dynamic_slice (param_0.2227: bf16[9,1,4,8192,6144], param_1.2498: s32[], param_2.4709: bf16[2,1,6144], param_3.3900: s32[16], param_4.2853: u32[], param_5.2626: s32[9], param_6.2390: f32[1,1,4,8192], param_7.2215: bf16[1,4,8192,6144], param_8.2046: bf16[1,2,4,8192,6144], param_9.1761: pred[1], param_10.1365: bf16[1,4,8192,6144]) -> (bf16[1,1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144]) {
  %param_0.2227 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2227"}
  %constant_1624_14 = s32[] constant(8)
  %param_1.2498 = s32[] parameter(1), metadata={scheduling_name="param_1.2498"}
  %subtract.247.7 = s32[] subtract(%constant_1624_14, %param_1.2498), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.7"}
  %constant_1627_88 = s32[] constant(0)
  %dynamic-slice.1389.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2227, %subtract.247.7, %constant_1627_88, %constant_1627_88, %constant_1627_88, /*index=5*/%constant_1627_88), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1389.7"}
  %bitcast.22017.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1389.7), metadata={scheduling_name="bitcast.22017.15.clone.1"}
  %convert.3942.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22017.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3942.15.clone.1"}
  %param_6.2390 = f32[1,1,4,8192]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2390"}
  %bitcast.22042.13.clone.1 = f32[4,8192]{1,0} bitcast(%param_6.2390), metadata={scheduling_name="bitcast.22042.13.clone.1"}
  %broadcast.5584.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22042.13.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5584.13.clone.1"}
  %multiply.2586.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.15.clone.1, %broadcast.5584.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2586.7.clone.1"}
  %param_2.4709 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4709"}
  %param_5.2626 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2626"}
  %dynamic-slice.1376.176.clone.1 = s32[1]{0} dynamic-slice(%param_5.2626, %subtract.247.7), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.176.clone.1"}
  %param_3.3900 = s32[16]{0} parameter(3), metadata={scheduling_name="param_3.3900"}
  %param_4.2853 = u32[] parameter(4), metadata={scheduling_name="param_4.2853"}
  %dynamic-slice.1377.171.clone.1 = s32[1]{0} dynamic-slice(%param_3.3900, %param_4.2853), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.171.clone.1"}
  %subtract.248.166.clone.1 = s32[1]{0} subtract(%dynamic-slice.1376.176.clone.1, %dynamic-slice.1377.171.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.166.clone.1"}
  %constant_2102_84_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.166.clone.1 = s32[1]{0} maximum(%subtract.248.166.clone.1, %constant_2102_84_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.166.clone.1"}
  %sign.27.161.clone.1 = s32[1]{0} sign(%maximum.47.166.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.161.clone.1"}
  %constant_5000_78_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.161.clone.1 = pred[1]{0} compare(%sign.27.161.clone.1, %constant_5000_78_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.161.clone.1"}
  %constant_5001_77_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.166.clone.1 = s32[1]{0} and(%maximum.47.166.clone.1, %constant_5001_77_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.166.clone.1"}
  %compare.1615.166.clone.1 = pred[1]{0} compare(%and.301.166.clone.1, %constant_2102_84_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.166.clone.1"}
  %and.302.161.clone.1 = pred[1]{0} and(%compare.1614.161.clone.1, %compare.1615.166.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.161.clone.1"}
  %constant_5002_75_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.161.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.166.clone.1, %constant_5002_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.161.clone.1"}
  %constant_5003_75_clone_1 = s32[1]{0} constant({-1})
  %add.2882.161.clone.1 = s32[1]{0} add(%shift-right-logical.20.161.clone.1, %constant_5003_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.161.clone.1"}
  %select.1263.161.clone.1 = s32[1]{0} select(%and.302.161.clone.1, %add.2882.161.clone.1, %shift-right-logical.20.161.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.161.clone.1"}
  %compare.1616.161.clone.1 = pred[1]{0} compare(%select.1263.161.clone.1, %constant_2102_84_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.161.clone.1"}
  %add.2883.161.clone.1 = s32[1]{0} add(%select.1263.161.clone.1, %constant_5002_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.161.clone.1"}
  %select.1264.161.clone.1 = s32[1]{0} select(%compare.1616.161.clone.1, %add.2883.161.clone.1, %select.1263.161.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.161.clone.1"}
  %bitcast.20992.175.clone.1 = s32[1,1]{1,0} bitcast(%select.1264.161.clone.1), metadata={scheduling_name="bitcast.20992.175.clone.1"}
  %pad.345.67.clone.1 = s32[1,2]{1,0} pad(%bitcast.20992.175.clone.1, %constant_1627_88), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.67.clone.1"}
  %pad.346.65.clone.1 = s32[1,3]{1,0} pad(%pad.345.67.clone.1, %constant_1627_88), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.65.clone.1"}
  %bitcast.21099.62.clone.1 = s32[3]{0} bitcast(%pad.346.65.clone.1), metadata={scheduling_name="bitcast.21099.62.clone.1"}
  %slice.2376.57.clone.1 = s32[1]{0} slice(%bitcast.21099.62.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.57.clone.1"}
  %bitcast.23800.44.clone.1 = s32[] bitcast(%slice.2376.57.clone.1), metadata={scheduling_name="bitcast.23800.44.clone.1"}
  %dynamic-slice.1395.9.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4709, %bitcast.23800.44.clone.1, %constant_1627_88, %constant_1627_88), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1395.9.clone.1"}
  %bitcast.22053.8.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1395.9.clone.1), metadata={scheduling_name="bitcast.22053.8.clone.1"}
  %convert.4982.5.clone.1 = f32[6144]{0} convert(%bitcast.22053.8.clone.1), metadata={scheduling_name="convert.4982.5.clone.1"}
  %broadcast.5995.10.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4982.5.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5995.10.clone.1"}
  %multiply.2587.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2586.7.clone.1, %broadcast.5995.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2587.3.clone.1"}
  %convert.3944.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2587.3.clone.1), metadata={scheduling_name="convert.3944.1.clone.1"}
  %param_10.1365 = bf16[1,4,8192,6144]{3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1365"}
  %convert.3894.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_10.1365), metadata={scheduling_name="convert.3894.3.clone.1"}
  %param_9.1761 = pred[1]{0} parameter(9), metadata={scheduling_name="param_9.1761"}
  %bitcast.21280.9.clone.1 = pred[] bitcast(%param_9.1761), metadata={scheduling_name="bitcast.21280.9.clone.1"}
  %broadcast.5545.9.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%bitcast.21280.9.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5545.9.clone.1"}
  %param_8.2046 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2046"}
  %bitcast.21289.39.clone.1 = s32[] bitcast(%dynamic-slice.1376.176.clone.1), metadata={scheduling_name="bitcast.21289.39.clone.1"}
  %compare.1624.3.clone.1 = pred[] compare(%bitcast.21289.39.clone.1, %constant_1627_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.3.clone.1"}
  %negate.212.9.clone.1 = s32[] negate(%bitcast.21289.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.9.clone.1"}
  %select.1266.7.clone.1 = s32[] select(%compare.1624.3.clone.1, %negate.212.9.clone.1, %bitcast.21289.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.7.clone.1"}
  %constant_1622_3_clone_1 = s32[] constant(1)
  %and.305.1.clone.1 = s32[] and(%select.1266.7.clone.1, %constant_1622_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.1.clone.1"}
  %negate.213.1.clone.1 = s32[] negate(%and.305.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.1.clone.1"}
  %select.1267.6.clone.1 = s32[] select(%compare.1624.3.clone.1, %negate.213.1.clone.1, %and.305.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1267.6.clone.1"}
  %compare.1625.4.clone.1 = pred[] compare(%select.1267.6.clone.1, %constant_1627_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.4.clone.1"}
  %compare.1626.4.clone.1 = pred[] compare(%select.1267.6.clone.1, %constant_1627_88), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.4.clone.1"}
  %and.306.3.clone.1 = pred[] and(%compare.1625.4.clone.1, %compare.1626.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.3.clone.1"}
  %constant_1631_2_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2893.3.clone.1 = s32[] add(%select.1267.6.clone.1, %constant_1631_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2893.3.clone.1"}
  %select.1268.2.clone.1 = s32[] select(%and.306.3.clone.1, %add.2893.3.clone.1, %select.1267.6.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1268.2.clone.1"}
  %compare.1627.5.clone.1 = pred[] compare(%select.1268.2.clone.1, %constant_1627_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.5.clone.1"}
  %add.2894.5.clone.1 = s32[] add(%select.1268.2.clone.1, %constant_1631_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2894.5.clone.1"}
  %select.1269.4.clone.1 = s32[] select(%compare.1627.5.clone.1, %add.2894.5.clone.1, %select.1268.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1269.4.clone.1"}
  %dynamic-slice.1386.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_8.2046, %constant_1627_88, %select.1269.4.clone.1, %constant_1627_88, %constant_1627_88, /*index=5*/%constant_1627_88), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1386.6.clone.1"}
  %constant_1623_20_clone_1 = bf16[] constant(0)
  %broadcast.5546.8.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1623_20_clone_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5546.8.clone.1"}
  %select.1270.5.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5545.9.clone.1, %dynamic-slice.1386.6.clone.1, %broadcast.5546.8.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1270.5.clone.1"}
  %bitcast.21329.7.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1270.5.clone.1), metadata={scheduling_name="bitcast.21329.7.clone.1"}
  %convert.3895.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21329.7.clone.1), metadata={scheduling_name="convert.3895.7.clone.1"}
  %add.2895.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.3894.3.clone.1, %convert.3895.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="add.2895.5.clone.1"}
  %param_7.2215 = bf16[1,4,8192,6144]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2215"}
  %convert.3896.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_7.2215), metadata={scheduling_name="convert.3896.3.clone.1"}
  %add.2896.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2895.5.clone.1, %convert.3896.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="add.2896.3.clone.1"}
  %convert.3919.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2896.3.clone.1), metadata={scheduling_name="convert.3919.1.clone.1"}
  ROOT %tuple.507 = (bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%dynamic-slice.1389.7, %convert.3944.1.clone.1, %convert.3919.1.clone.1), metadata={scheduling_name="tuple.507"}
}

%fused_dynamic_slice.25 (param_0.2228: bf16[9,1,4,8192,48,128], param_1.2499: s32[]) -> bf16[1,1,4,8192,48,128] {
  %param_0.2228 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2228"}
  %constant_1624_15 = s32[] constant(8)
  %param_1.2499 = s32[] parameter(1), metadata={scheduling_name="param_1.2499"}
  %subtract.247.8 = s32[] subtract(%constant_1624_15, %param_1.2499), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.8"}
  %constant_1627_89 = s32[] constant(0)
  ROOT %dynamic-slice.1387.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-slice(%param_0.2228, %subtract.247.8, %constant_1627_89, %constant_1627_89, %constant_1627_89, /*index=5*/%constant_1627_89, %constant_1627_89), dynamic_slice_sizes={1,1,4,8192,48,128}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1387.1"}
}

%fused_add.1 (param_0.2362: s32[]) -> s32[] {
  %param_0.2362 = s32[] parameter(0), metadata={scheduling_name="param_0.2362"}
  %constant_1622_2 = s32[] constant(1)
  ROOT %add.2881.1 = s32[] add(%param_0.2362, %constant_1622_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="add.2881.1"}
}

%fused_broadcast.3 () -> bf16[1,4,8192,8] {
  %constant_1623_2 = bf16[] constant(0)
  ROOT %broadcast.5531.1 = bf16[1,4,8192,8]{3,2,1,0} broadcast(%constant_1623_2), dimensions={}, metadata={scheduling_name="broadcast.5531.1"}
}

%fused_broadcast.4 () -> u32[1,4,8192,8] {
  %constant_1696_1 = u32[] constant(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  ROOT %broadcast.5538.1 = u32[1,4,8192,8]{3,2,1,0} broadcast(%constant_1696_1), dimensions={}, metadata={scheduling_name="broadcast.5538.1"}
}

%region_6.604.clone.2 (Arg_0.171: f32[], Arg_1.171: f32[]) -> f32[] {
  %Arg_1.171 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.171"}
  %Arg_0.171 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.171"}
  ROOT %add.2872.0 = f32[] add(%Arg_0.171, %Arg_1.171), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2872.0"}
}

%region_6.604.clone.8 (Arg_0.177: f32[], Arg_1.177: f32[]) -> f32[] {
  %Arg_1.177 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.177"}
  %Arg_0.177 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.177"}
  ROOT %add.2878.0 = f32[] add(%Arg_0.177, %Arg_1.177), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2878.0"}
}

%fused_add_convert_reduce (param_0.6063: f32[1,1,4,8192], param_1.6454: bf16[32768,6144], param_2.4640: f32[1,1,4,8192], param_3.3813: bf16[2,1,6144], param_4.2798: bf16[4,8192,6144], param_5.2567: f32[1,4,8192,6144], param_6.2328: f32[1,1,4,8192], param_7.2152: bf16[9,1,4,8192,6144], param_8.1995: f32[1,1,4,8192], param_9.1712: bf16[2,1,6144], param_10.1328: s32[16], param_11.1236: u32[], param_12.995: s32[9], param_13.718: s32[], param_14.510: bf16[32768,6144]) -> (bf16[1,4,8192,6144], f32[1,4,8192,6144], f32[128,6144], f32[128,6144]) {
  %param_5.2567 = f32[1,4,8192,6144]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2567"}
  %param_14.510 = bf16[32768,6144]{1,0} parameter(14), metadata={scheduling_name="param_14.510"}
  %bitcast.22383.21.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_14.510), metadata={scheduling_name="bitcast.22383.21.clone.1"}
  %convert.3993.21.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22383.21.clone.1), metadata={scheduling_name="convert.3993.21.clone.1"}
  %param_9.1712 = bf16[2,1,6144]{2,1,0} parameter(9), metadata={scheduling_name="param_9.1712"}
  %param_12.995 = s32[9]{0} parameter(12), metadata={scheduling_name="param_12.995"}
  %constant_1624_22_clone_1 = s32[] constant(8)
  %param_13.718 = s32[] parameter(13), metadata={scheduling_name="param_13.718"}
  %subtract.247.189.clone.1 = s32[] subtract(%constant_1624_22_clone_1, %param_13.718), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.189.clone.1"}
  %dynamic-slice.1376.170.clone.1 = s32[1]{0} dynamic-slice(%param_12.995, %subtract.247.189.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.170.clone.1"}
  %param_10.1328 = s32[16]{0} parameter(10), metadata={scheduling_name="param_10.1328"}
  %param_11.1236 = u32[] parameter(11), metadata={scheduling_name="param_11.1236"}
  %dynamic-slice.1377.165.clone.1 = s32[1]{0} dynamic-slice(%param_10.1328, %param_11.1236), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.165.clone.1"}
  %subtract.248.160.clone.1 = s32[1]{0} subtract(%dynamic-slice.1376.170.clone.1, %dynamic-slice.1377.165.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.160.clone.1"}
  %constant_2102_81_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.160.clone.1 = s32[1]{0} maximum(%subtract.248.160.clone.1, %constant_2102_81_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.160.clone.1"}
  %sign.27.155.clone.1 = s32[1]{0} sign(%maximum.47.160.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.155.clone.1"}
  %constant_5000_75_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.155.clone.1 = pred[1]{0} compare(%sign.27.155.clone.1, %constant_5000_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.155.clone.1"}
  %constant_5001_74_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.160.clone.1 = s32[1]{0} and(%maximum.47.160.clone.1, %constant_5001_74_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.160.clone.1"}
  %compare.1615.160.clone.1 = pred[1]{0} compare(%and.301.160.clone.1, %constant_2102_81_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.160.clone.1"}
  %and.302.155.clone.1 = pred[1]{0} and(%compare.1614.155.clone.1, %compare.1615.160.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.155.clone.1"}
  %constant_5002_72_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.155.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.160.clone.1, %constant_5002_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.155.clone.1"}
  %constant_5003_72_clone_1 = s32[1]{0} constant({-1})
  %add.2882.155.clone.1 = s32[1]{0} add(%shift-right-logical.20.155.clone.1, %constant_5003_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.155.clone.1"}
  %select.1263.155.clone.1 = s32[1]{0} select(%and.302.155.clone.1, %add.2882.155.clone.1, %shift-right-logical.20.155.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.155.clone.1"}
  %compare.1616.155.clone.1 = pred[1]{0} compare(%select.1263.155.clone.1, %constant_2102_81_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.155.clone.1"}
  %add.2883.155.clone.1 = s32[1]{0} add(%select.1263.155.clone.1, %constant_5002_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.155.clone.1"}
  %select.1264.155.clone.1 = s32[1]{0} select(%compare.1616.155.clone.1, %add.2883.155.clone.1, %select.1263.155.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.155.clone.1"}
  %bitcast.20992.169.clone.1 = s32[1,1]{1,0} bitcast(%select.1264.155.clone.1), metadata={scheduling_name="bitcast.20992.169.clone.1"}
  %constant_1627_16_clone_1 = s32[] constant(0)
  %pad.345.61.clone.1 = s32[1,2]{1,0} pad(%bitcast.20992.169.clone.1, %constant_1627_16_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.61.clone.1"}
  %pad.346.59.clone.1 = s32[1,3]{1,0} pad(%pad.345.61.clone.1, %constant_1627_16_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.59.clone.1"}
  %bitcast.21099.56.clone.1 = s32[3]{0} bitcast(%pad.346.59.clone.1), metadata={scheduling_name="bitcast.21099.56.clone.1"}
  %slice.2376.51.clone.1 = s32[1]{0} slice(%bitcast.21099.56.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.51.clone.1"}
  %bitcast.23800.38.clone.1 = s32[] bitcast(%slice.2376.51.clone.1), metadata={scheduling_name="bitcast.23800.38.clone.1"}
  %dynamic-slice.1395.3.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_9.1712, %bitcast.23800.38.clone.1, %constant_1627_16_clone_1, %constant_1627_16_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1395.3.clone.1"}
  %bitcast.22053.12.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1395.3.clone.1), metadata={scheduling_name="bitcast.22053.12.clone.1"}
  %convert.4982.9.clone.1 = f32[6144]{0} convert(%bitcast.22053.12.clone.1), metadata={scheduling_name="convert.4982.9.clone.1"}
  %broadcast.5995.16.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4982.9.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5995.16.clone.1"}
  %multiply.2607.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3993.21.clone.1, %broadcast.5995.16.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2607.13.clone.1"}
  %param_8.1995 = f32[1,1,4,8192]{3,2,1,0} parameter(8), metadata={scheduling_name="param_8.1995"}
  %bitcast.22042.21.clone.1 = f32[4,8192]{1,0} bitcast(%param_8.1995), metadata={scheduling_name="bitcast.22042.21.clone.1"}
  %broadcast.5584.21.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22042.21.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5584.21.clone.1"}
  %multiply.2608.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2607.13.clone.1, %broadcast.5584.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2608.7.clone.1"}
  %param_7.2152 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2152"}
  %dynamic-slice.1389.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_7.2152, %subtract.247.189.clone.1, %constant_1627_16_clone_1, %constant_1627_16_clone_1, %constant_1627_16_clone_1, /*index=5*/%constant_1627_16_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1389.6.clone.1"}
  %bitcast.22017.27.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1389.6.clone.1), metadata={scheduling_name="bitcast.22017.27.clone.1"}
  %convert.3942.27.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22017.27.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3942.27.clone.1"}
  %param_6.2328 = f32[1,1,4,8192]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2328"}
  %bitcast.22420.5.clone.1 = f32[4,8192]{1,0} bitcast(%param_6.2328), metadata={scheduling_name="bitcast.22420.5.clone.1"}
  %broadcast.5598.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22420.5.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5598.5.clone.1"}
  %multiply.2613.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.27.clone.1, %broadcast.5598.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2613.5.clone.1"}
  %add.2918.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2608.7.clone.1, %multiply.2613.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2918.5.clone.1"}
  %add.2919.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%param_5.2567, %add.2918.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.2919.3.clone.1"}
  %param_4.2798 = bf16[4,8192,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2798"}
  %bitcast.23031.13.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_4.2798), metadata={scheduling_name="bitcast.23031.13.clone.1"}
  %convert.4044.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23031.13.clone.1), metadata={scheduling_name="convert.4044.13.clone.1"}
  %param_3.3813 = bf16[2,1,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.3813"}
  %dynamic-slice.1382.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_3.3813, %bitcast.23800.38.clone.1, %constant_1627_16_clone_1, %constant_1627_16_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1382.7.clone.1"}
  %bitcast.21105.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1382.7.clone.1), metadata={scheduling_name="bitcast.21105.6.clone.1"}
  %convert.4975.3.clone.1 = f32[6144]{0} convert(%bitcast.21105.6.clone.1), metadata={scheduling_name="convert.4975.3.clone.1"}
  %broadcast.5984.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4975.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5984.12.clone.1"}
  %multiply.2645.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4044.13.clone.1, %broadcast.5984.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2645.9.clone.1"}
  %param_2.4640 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4640"}
  %bitcast.21087.15.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4640), metadata={scheduling_name="bitcast.21087.15.clone.1"}
  %broadcast.5529.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21087.15.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5529.15.clone.1"}
  %multiply.2646.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2645.9.clone.1, %broadcast.5529.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2646.5.clone.1"}
  %param_1.6454 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.6454"}
  %bitcast.21065.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.6454), metadata={scheduling_name="bitcast.21065.19.clone.1"}
  %convert.3885.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21065.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3885.19.clone.1"}
  %param_0.6063 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6063"}
  %bitcast.23314.3.clone.1 = f32[4,8192]{1,0} bitcast(%param_0.6063), metadata={scheduling_name="bitcast.23314.3.clone.1"}
  %broadcast.5636.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23314.3.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5636.3.clone.1"}
  %multiply.2651.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3885.19.clone.1, %broadcast.5636.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2651.3.clone.1"}
  %add.2934.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2646.5.clone.1, %multiply.2651.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2934.3.clone.1"}
  %add.2935.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2919.3.clone.1, %add.2934.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.2935.1.clone.1"}
  %convert.4078.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2935.1.clone.1), metadata={scheduling_name="convert.4078.1"}
  %multiply.2548.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3885.19.clone.1, %broadcast.5529.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2548.11.clone.1"}
  %multiply.2632.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2548.11.clone.1, %convert.4044.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2632.5.clone.1"}
  %convert.4045.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2632.5.clone.1), metadata={scheduling_name="convert.4045.3.clone.1"}
  %bitcast.23040.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4045.3.clone.1), metadata={scheduling_name="bitcast.23040.3.clone.1"}
  %convert.4046.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23040.3.clone.1), metadata={scheduling_name="convert.4046.3.clone.1"}
  %constant_1623_29_clone_1 = bf16[] constant(0)
  %convert.4978.4.clone.1 = f32[] convert(%constant_1623_29_clone_1), metadata={scheduling_name="convert.4978.4.clone.1"}
  %reduce.587.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4046.3.clone.1, %convert.4978.4.clone.1), dimensions={1}, to_apply=%region_6.604.clone.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.587.1.clone.1"}
  %multiply.2586.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.27.clone.1, %broadcast.5584.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2586.11.clone.1"}
  %multiply.2662.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2586.11.clone.1, %convert.3993.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2662.5.clone.1"}
  %convert.4151.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2662.5.clone.1), metadata={scheduling_name="convert.4151.3.clone.1"}
  %bitcast.23818.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4151.3.clone.1), metadata={scheduling_name="bitcast.23818.3.clone.1"}
  %convert.4153.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23818.3.clone.1), metadata={scheduling_name="convert.4153.3.clone.1"}
  %reduce.593.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4153.3.clone.1, %convert.4978.4.clone.1), dimensions={1}, to_apply=%region_6.604.clone.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.593.1.clone.1"}
  ROOT %tuple.484 = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, f32[128,6144]{1,0}) tuple(%convert.4078.1, %add.2935.1.clone.1, %reduce.587.1.clone.1, %reduce.593.1.clone.1), metadata={scheduling_name="tuple.484"}
}

%region_6.604.clone.6 (Arg_0.175: f32[], Arg_1.175: f32[]) -> f32[] {
  %Arg_1.175 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.175"}
  %Arg_0.175 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.175"}
  ROOT %add.2876.0 = f32[] add(%Arg_0.175, %Arg_1.175), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2876.0"}
}

%fused_add_convert_dynamic_slice_reduce_select (param_0.6067: f32[1,1,4,8192], param_1.6459: bf16[32768,6144], param_2.4670: f32[1,1,4,8192], param_3.3851: bf16[2,1,6144], param_4.2820: s32[16], param_5.2587: u32[], param_6.2354: bf16[4,8192,6144], param_7.2183: bf16[1,4,8192,6144], param_8.2016: bf16[1,2,4,8192,6144], param_9.1731: s32[9], param_10.1343: s32[], param_11.1246: pred[1], param_12.1002: bf16[1,4,8192,6144], param_13.743: bf16[2,1,6144], param_14.538: f32[1,1,4,8192], param_15.318: bf16[9,1,4,8192,6144], param_16.154: bf16[1,4,4,8192,6144]) -> (bf16[1,4,8192,6144], f32[1,4,8192,6144], f32[128,6144], bf16[1,1,4,8192,6144], bf16[1,4,8192,6144], /*index=5*/bf16[1,1,4,8192,6144], bf16[1,1,4,8192,6144]) {
  %param_12.1002 = bf16[1,4,8192,6144]{3,2,1,0} parameter(12), metadata={scheduling_name="param_12.1002"}
  %convert.3894.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_12.1002), metadata={scheduling_name="convert.3894.5.clone.1"}
  %param_11.1246 = pred[1]{0} parameter(11), metadata={scheduling_name="param_11.1246"}
  %bitcast.21280.7.clone.1 = pred[] bitcast(%param_11.1246), metadata={scheduling_name="bitcast.21280.7.clone.1"}
  %broadcast.5545.7.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%bitcast.21280.7.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5545.7.clone.1"}
  %param_8.2016 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2016"}
  %constant_1627_75_clone_1 = s32[] constant(0)
  %param_9.1731 = s32[9]{0} parameter(9), metadata={scheduling_name="param_9.1731"}
  %constant_1624_32_clone_1 = s32[] constant(8)
  %param_10.1343 = s32[] parameter(10), metadata={scheduling_name="param_10.1343"}
  %subtract.247.25.clone.1 = s32[] subtract(%constant_1624_32_clone_1, %param_10.1343), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.25.clone.1"}
  %dynamic-slice.1376.5.clone.1 = s32[1]{0} dynamic-slice(%param_9.1731, %subtract.247.25.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1376.5.clone.1"}
  %bitcast.21289.47.clone.1 = s32[] bitcast(%dynamic-slice.1376.5.clone.1), metadata={scheduling_name="bitcast.21289.47.clone.1"}
  %compare.1624.11.clone.1 = pred[] compare(%bitcast.21289.47.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.11.clone.1"}
  %negate.212.15.clone.1 = s32[] negate(%bitcast.21289.47.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.15.clone.1"}
  %select.1266.13.clone.1 = s32[] select(%compare.1624.11.clone.1, %negate.212.15.clone.1, %bitcast.21289.47.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1266.13.clone.1"}
  %constant_1622_6_clone_1 = s32[] constant(1)
  %and.305.4.clone.1 = s32[] and(%select.1266.13.clone.1, %constant_1622_6_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.4.clone.1"}
  %negate.213.3.clone.1 = s32[] negate(%and.305.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.3.clone.1"}
  %select.1267.2.clone.1 = s32[] select(%compare.1624.11.clone.1, %negate.213.3.clone.1, %and.305.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1267.2.clone.1"}
  %compare.1625.5.clone.1 = pred[] compare(%select.1267.2.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.5.clone.1"}
  %compare.1626.5.clone.1 = pred[] compare(%select.1267.2.clone.1, %constant_1627_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.5.clone.1"}
  %and.306.4.clone.1 = pred[] and(%compare.1625.5.clone.1, %compare.1626.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.4.clone.1"}
  %constant_1631_4_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2893.4.clone.1 = s32[] add(%select.1267.2.clone.1, %constant_1631_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2893.4.clone.1"}
  %select.1268.3.clone.1 = s32[] select(%and.306.4.clone.1, %add.2893.4.clone.1, %select.1267.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1268.3.clone.1"}
  %compare.1627.1.clone.1 = pred[] compare(%select.1268.3.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.1.clone.1"}
  %add.2894.1.clone.1 = s32[] add(%select.1268.3.clone.1, %constant_1631_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2894.1.clone.1"}
  %select.1269.6.clone.1 = s32[] select(%compare.1627.1.clone.1, %add.2894.1.clone.1, %select.1268.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1269.6.clone.1"}
  %dynamic-slice.1386.4.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_8.2016, %constant_1627_75_clone_1, %select.1269.6.clone.1, %constant_1627_75_clone_1, %constant_1627_75_clone_1, /*index=5*/%constant_1627_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1386.4.clone.1"}
  %constant_1623_16_clone_1 = bf16[] constant(0)
  %broadcast.5546.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1623_16_clone_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5546.6.clone.1"}
  %select.1270.3.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5545.7.clone.1, %dynamic-slice.1386.4.clone.1, %broadcast.5546.6.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1270.3.clone.1"}
  %bitcast.21329.9.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1270.3.clone.1), metadata={scheduling_name="bitcast.21329.9.clone.1"}
  %convert.3895.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21329.9.clone.1), metadata={scheduling_name="convert.3895.9.clone.1"}
  %add.2895.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.3894.5.clone.1, %convert.3895.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="add.2895.7.clone.1"}
  %param_7.2183 = bf16[1,4,8192,6144]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2183"}
  %convert.3896.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_7.2183), metadata={scheduling_name="convert.3896.5.clone.1"}
  %add.2896.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2895.7.clone.1, %convert.3896.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="add.2896.5.clone.1"}
  %param_6.2354 = bf16[4,8192,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2354"}
  %bitcast.21974.13.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_6.2354), metadata={scheduling_name="bitcast.21974.13.clone.1"}
  %convert.3940.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21974.13.clone.1), metadata={scheduling_name="convert.3940.13.clone.1"}
  %param_3.3851 = bf16[2,1,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.3851"}
  %param_4.2820 = s32[16]{0} parameter(4), metadata={scheduling_name="param_4.2820"}
  %param_5.2587 = u32[] parameter(5), metadata={scheduling_name="param_5.2587"}
  %dynamic-slice.1377.153.clone.1 = s32[1]{0} dynamic-slice(%param_4.2820, %param_5.2587), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.153.clone.1"}
  %subtract.248.148.clone.1 = s32[1]{0} subtract(%dynamic-slice.1376.5.clone.1, %dynamic-slice.1377.153.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.148.clone.1"}
  %constant_2102_78_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.148.clone.1 = s32[1]{0} maximum(%subtract.248.148.clone.1, %constant_2102_78_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.148.clone.1"}
  %sign.27.143.clone.1 = s32[1]{0} sign(%maximum.47.148.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.143.clone.1"}
  %constant_5000_72_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.143.clone.1 = pred[1]{0} compare(%sign.27.143.clone.1, %constant_5000_72_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.143.clone.1"}
  %constant_5001_71_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.148.clone.1 = s32[1]{0} and(%maximum.47.148.clone.1, %constant_5001_71_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.148.clone.1"}
  %compare.1615.148.clone.1 = pred[1]{0} compare(%and.301.148.clone.1, %constant_2102_78_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.148.clone.1"}
  %and.302.143.clone.1 = pred[1]{0} and(%compare.1614.143.clone.1, %compare.1615.148.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.143.clone.1"}
  %constant_5002_69_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.143.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.148.clone.1, %constant_5002_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.143.clone.1"}
  %constant_5003_69_clone_1 = s32[1]{0} constant({-1})
  %add.2882.143.clone.1 = s32[1]{0} add(%shift-right-logical.20.143.clone.1, %constant_5003_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2882.143.clone.1"}
  %select.1263.143.clone.1 = s32[1]{0} select(%and.302.143.clone.1, %add.2882.143.clone.1, %shift-right-logical.20.143.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1263.143.clone.1"}
  %compare.1616.143.clone.1 = pred[1]{0} compare(%select.1263.143.clone.1, %constant_2102_78_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.143.clone.1"}
  %add.2883.143.clone.1 = s32[1]{0} add(%select.1263.143.clone.1, %constant_5002_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2883.143.clone.1"}
  %select.1264.143.clone.1 = s32[1]{0} select(%compare.1616.143.clone.1, %add.2883.143.clone.1, %select.1263.143.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1264.143.clone.1"}
  %bitcast.20992.157.clone.1 = s32[1,1]{1,0} bitcast(%select.1264.143.clone.1), metadata={scheduling_name="bitcast.20992.157.clone.1"}
  %pad.345.49.clone.1 = s32[1,2]{1,0} pad(%bitcast.20992.157.clone.1, %constant_1627_75_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.49.clone.1"}
  %pad.346.47.clone.1 = s32[1,3]{1,0} pad(%pad.345.49.clone.1, %constant_1627_75_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.47.clone.1"}
  %bitcast.21099.44.clone.1 = s32[3]{0} bitcast(%pad.346.47.clone.1), metadata={scheduling_name="bitcast.21099.44.clone.1"}
  %slice.2376.39.clone.1 = s32[1]{0} slice(%bitcast.21099.44.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.39.clone.1"}
  %bitcast.23800.26.clone.1 = s32[] bitcast(%slice.2376.39.clone.1), metadata={scheduling_name="bitcast.23800.26.clone.1"}
  %dynamic-slice.1390.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_3.3851, %bitcast.23800.26.clone.1, %constant_1627_75_clone_1, %constant_1627_75_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1390.7.clone.1"}
  %bitcast.21416.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1390.7.clone.1), metadata={scheduling_name="bitcast.21416.6.clone.1"}
  %convert.4976.3.clone.1 = f32[6144]{0} convert(%bitcast.21416.6.clone.1), metadata={scheduling_name="convert.4976.3.clone.1"}
  %broadcast.5985.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4976.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.5985.12.clone.1"}
  %multiply.2577.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3940.13.clone.1, %broadcast.5985.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2577.9.clone.1"}
  %param_2.4670 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4670"}
  %bitcast.21405.15.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4670), metadata={scheduling_name="bitcast.21405.15.clone.1"}
  %broadcast.5550.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21405.15.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5550.15.clone.1"}
  %multiply.2578.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2577.9.clone.1, %broadcast.5550.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2578.5.clone.1"}
  %param_1.6459 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.6459"}
  %bitcast.21380.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.6459), metadata={scheduling_name="bitcast.21380.19.clone.1"}
  %convert.3897.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21380.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3897.19.clone.1"}
  %param_0.6067 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6067"}
  %bitcast.22009.3.clone.1 = f32[4,8192]{1,0} bitcast(%param_0.6067), metadata={scheduling_name="bitcast.22009.3.clone.1"}
  %broadcast.5581.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22009.3.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5581.3.clone.1"}
  %multiply.2583.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3897.19.clone.1, %broadcast.5581.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2583.3.clone.1"}
  %add.2906.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2578.5.clone.1, %multiply.2583.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2906.3.clone.1"}
  %add.2907.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2896.5.clone.1, %add.2906.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.2907.1.clone.1"}
  %convert.3969.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2907.1.clone.1), metadata={scheduling_name="convert.3969.1"}
  %multiply.2557.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3897.19.clone.1, %broadcast.5550.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2557.11.clone.1"}
  %multiply.2661.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2557.11.clone.1, %convert.3940.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2661.5.clone.1"}
  %convert.4139.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2661.5.clone.1), metadata={scheduling_name="convert.4139.3.clone.1"}
  %bitcast.23769.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4139.3.clone.1), metadata={scheduling_name="bitcast.23769.3.clone.1"}
  %convert.4141.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23769.3.clone.1), metadata={scheduling_name="convert.4141.3.clone.1"}
  %convert.4978.8.clone.1 = f32[] convert(%constant_1623_16_clone_1), metadata={scheduling_name="convert.4978.8.clone.1"}
  %reduce.591.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4141.3.clone.1, %convert.4978.8.clone.1), dimensions={1}, to_apply=%region_6.604.clone.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.591.1.clone.1"}
  %select.1317.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5545.7.clone.1, %broadcast.5546.6.clone.1, %dynamic-slice.1386.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1317.1.clone.1"}
  %param_15.318 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(15), metadata={scheduling_name="param_15.318"}
  %dynamic-slice.1381.5.clone.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_15.318, %subtract.247.25.clone.1, %constant_1627_75_clone_1, %constant_1627_75_clone_1, %constant_1627_75_clone_1, /*index=5*/%constant_1627_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1381.5.clone.1.clone.1"}
  %bitcast.23080.15.clone.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1381.5.clone.1.clone.1), metadata={scheduling_name="bitcast.23080.15.clone.1.clone.1"}
  %convert.4053.15.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23080.15.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4053.15.clone.1.clone.1"}
  %param_14.538 = f32[1,1,4,8192]{3,2,1,0} parameter(14), metadata={scheduling_name="param_14.538"}
  %bitcast.23105.13.clone.1.clone.1 = f32[4,8192]{1,0} bitcast(%param_14.538), metadata={scheduling_name="bitcast.23105.13.clone.1.clone.1"}
  %broadcast.5632.13.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23105.13.clone.1.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5632.13.clone.1.clone.1"}
  %multiply.2635.7.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4053.15.clone.1.clone.1, %broadcast.5632.13.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2635.7.clone.1.clone.1"}
  %param_13.743 = bf16[2,1,6144]{2,1,0} parameter(13), metadata={scheduling_name="param_13.743"}
  %dynamic-slice.1410.9.clone.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_13.743, %bitcast.23800.26.clone.1, %constant_1627_75_clone_1, %constant_1627_75_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1410.9.clone.1.clone.1"}
  %bitcast.23118.8.clone.1.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1410.9.clone.1.clone.1), metadata={scheduling_name="bitcast.23118.8.clone.1.clone.1"}
  %convert.4994.5.clone.1.clone.1 = f32[6144]{0} convert(%bitcast.23118.8.clone.1.clone.1), metadata={scheduling_name="convert.4994.5.clone.1.clone.1"}
  %broadcast.6009.10.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4994.5.clone.1.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6009.10.clone.1.clone.1"}
  %multiply.2636.3.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2635.7.clone.1.clone.1, %broadcast.6009.10.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2636.3.clone.1.clone.1"}
  %convert.4055.1.clone.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2636.3.clone.1.clone.1), metadata={scheduling_name="convert.4055.1.clone.1.clone.1"}
  %param_16.154 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(16), metadata={scheduling_name="param_16.154"}
  %constant_2707_1_clone_1 = s32[] constant(-2)
  %add.2956.5.clone.1 = s32[] add(%bitcast.21289.47.clone.1, %constant_2707_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.2956.5.clone.1"}
  %compare.1646.2.clone.1 = pred[] compare(%add.2956.5.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1646.2.clone.1"}
  %negate.222.1.clone.1 = s32[] negate(%add.2956.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.222.1.clone.1"}
  %select.1303.2.clone.1 = s32[] select(%compare.1646.2.clone.1, %negate.222.1.clone.1, %add.2956.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1303.2.clone.1"}
  %constant_1629_3_clone_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.311.1.clone.1 = s32[] and(%select.1303.2.clone.1, %constant_1629_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.311.1.clone.1"}
  %negate.223.1.clone.1 = s32[] negate(%and.311.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.223.1.clone.1"}
  %select.1305.2.clone.1 = s32[] select(%compare.1646.2.clone.1, %negate.223.1.clone.1, %and.311.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1305.2.clone.1"}
  %compare.1647.1.clone.1 = pred[] compare(%select.1305.2.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1647.1.clone.1"}
  %compare.1648.1.clone.1 = pred[] compare(%select.1305.2.clone.1, %constant_1627_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1648.1.clone.1"}
  %and.312.2.clone.1 = pred[] and(%compare.1647.1.clone.1, %compare.1648.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.312.2.clone.1"}
  %constant_1687_1_clone_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.2957.2.clone.1 = s32[] add(%select.1305.2.clone.1, %constant_1687_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2957.2.clone.1"}
  %select.1307.1.clone.1 = s32[] select(%and.312.2.clone.1, %add.2957.2.clone.1, %select.1305.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1307.1.clone.1"}
  %compare.1649.2.clone.1 = pred[] compare(%select.1307.1.clone.1, %constant_1627_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1649.2.clone.1"}
  %add.2958.2.clone.1 = s32[] add(%select.1307.1.clone.1, %constant_1687_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.2958.2.clone.1"}
  %select.1308.1.clone.1 = s32[] select(%compare.1649.2.clone.1, %add.2958.2.clone.1, %select.1307.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1308.1.clone.1"}
  %dynamic-slice.1431.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_16.154, %constant_1627_75_clone_1, %select.1308.1.clone.1, %constant_1627_75_clone_1, %constant_1627_75_clone_1, /*index=5*/%constant_1627_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-slice.1431.1.clone.1"}
  ROOT %tuple.505 = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, /*index=5*/bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) tuple(%convert.3969.1, %add.2907.1.clone.1, %reduce.591.1.clone.1, %select.1317.1.clone.1, %convert.4055.1.clone.1.clone.1, /*index=5*/%dynamic-slice.1381.5.clone.1.clone.1, %dynamic-slice.1431.1.clone.1), metadata={scheduling_name="tuple.505"}
}

%fused_compare.11 (param_0_0.1: s32[16], param_0_1: u32[]) -> (pred[1], pred[1]) {
  %param_0_0.1 = s32[16]{0} parameter(0), metadata={scheduling_name="param_0_0.1"}
  %param_0_1 = u32[] parameter(1), metadata={scheduling_name="param_0_1"}
  %dynamic-slice.1377.184 = s32[1]{0} dynamic-slice(%param_0_0.1, %param_0_1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1377.184"}
  %constant_5000_79 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1655.2 = pred[1]{0} compare(%dynamic-slice.1377.184, %constant_5000_79), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="compare.1655.2"}
  %compare.1656.2 = pred[1]{0} compare(%dynamic-slice.1377.184, %constant_5000_79), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="compare.1656.2"}
  ROOT %tuple.649 = (pred[1]{0}, pred[1]{0}) tuple(%compare.1655.2, %compare.1656.2), metadata={scheduling_name="tuple.649"}
}

%async_computation.4 (param_0.6082: bf16[1,4,8,1,2048,6144]) -> bf16[1,4,8,1,2048,6144] {
  %param_0.6082 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6082"}
  ROOT %all-to-all.4.1 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6082), channel_id=221, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.4.1"}
}

%async_computation.5 (param_0.6083: bf16[1,4,6144,8,1,2048]) -> bf16[1,4,6144,8,1,2048] {
  %param_0.6083 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6083"}
  ROOT %all-to-all.5.1 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} all-to-all(%param_0.6083), channel_id=224, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.5.1"}
}

%async_computation.6 (param_0.6084: bf16[1,8,4,1,2048,6144]) -> bf16[1,8,4,1,2048,6144] {
  %param_0.6084 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6084"}
  ROOT %all-to-all.6.1 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} all-to-all(%param_0.6084), channel_id=229, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.6.1"}
}

%async_computation.7 (param_0.6085: bf16[1,1,8,4,2048,6144]) -> bf16[1,1,8,4,2048,6144] {
  %param_0.6085 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6085"}
  ROOT %all-to-all.7.1 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6085), channel_id=230, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.7.1"}
}

%async_computation.8 (param_0.6086: bf16[1,4,8,1,2048,6144]) -> bf16[1,4,8,1,2048,6144] {
  %param_0.6086 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6086"}
  ROOT %all-to-all.8.1 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6086), channel_id=264, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.8.1"}
}

%async_computation.9 (param_0.6087: bf16[1,1,8,4,2048,6144]) -> bf16[1,1,8,4,2048,6144] {
  %param_0.6087 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6087"}
  ROOT %all-to-all.9.1 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} all-to-all(%param_0.6087), channel_id=271, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.9.1"}
}

%async_computation.10 (param_0.6088: bf16[1,4,6144,8,1,2048]) -> bf16[1,4,6144,8,1,2048] {
  %param_0.6088 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6088"}
  ROOT %all-to-all.10.1 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} all-to-all(%param_0.6088), channel_id=286, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.10.1"}
}

%async_computation.11 (param_0.6089: bf16[1,8,4,1,2048,6144]) -> bf16[1,8,4,1,2048,6144] {
  %param_0.6089 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6089"}
  ROOT %all-to-all.11.1 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} all-to-all(%param_0.6089), channel_id=296, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.11.1"}
}

%add.2.clone (x.5: bf16[], y.5: bf16[]) -> bf16[] {
  %y.5 = bf16[] parameter(1), metadata={scheduling_name="y.5"}
  %x.5 = bf16[] parameter(0), metadata={scheduling_name="x.5"}
  ROOT %add.2755.0 = bf16[] add(%x.5, %y.5), metadata={scheduling_name="add.2755.0"}
}

%async_computation.12 (param_0.6090: bf16[6144,1,8], param_1.6477: bf16[6144,8,128,1], param_2.4749: bf16[6144,1,48,128], param_3.3961: bf16[6144,48,128,1], param_4.2930: bf16[6144,8,128,1], param_5.2711: bf16[6144,1,8], param_6.2539: bf16[6144,8,128,1], param_7.2415: bf16[6144,1,48,128], param_8.2281: bf16[6144,48,128,1], param_9.2255: bf16[6144,8,128,1]) -> (bf16[768,1,8], bf16[768,8,128,1], bf16[768,1,48,128], bf16[768,48,128,1], bf16[768,8,128,1], /*index=5*/bf16[768,1,8], bf16[768,8,128,1], bf16[768,1,48,128], bf16[768,48,128,1], bf16[768,8,128,1]) {
  %param_9.2255 = bf16[6144,8,128,1]{2,1,3,0} parameter(9), metadata={scheduling_name="param_9.2255"}
  %param_8.2281 = bf16[6144,48,128,1]{2,1,3,0} parameter(8), metadata={scheduling_name="param_8.2281"}
  %param_7.2415 = bf16[6144,1,48,128]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2415"}
  %param_6.2539 = bf16[6144,8,128,1]{2,1,3,0} parameter(6), metadata={scheduling_name="param_6.2539"}
  %param_5.2711 = bf16[6144,1,8]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2711"}
  %param_4.2930 = bf16[6144,8,128,1]{2,1,3,0} parameter(4), metadata={scheduling_name="param_4.2930"}
  %param_3.3961 = bf16[6144,48,128,1]{2,1,3,0} parameter(3), metadata={scheduling_name="param_3.3961"}
  %param_2.4749 = bf16[6144,1,48,128]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4749"}
  %param_1.6477 = bf16[6144,8,128,1]{2,1,3,0} parameter(1), metadata={scheduling_name="param_1.6477"}
  %param_0.6090 = bf16[6144,1,8]{2,1,0} parameter(0), metadata={scheduling_name="param_0.6090"}
  ROOT %reduce-scatter.15 = (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}) reduce-scatter(%param_0.6090, %param_1.6477, %param_2.4749, %param_3.3961, %param_4.2930, /*index=5*/%param_5.2711, %param_6.2539, %param_7.2415, %param_8.2281, %param_9.2255), channel_id=582, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, use_global_device_ids=true, dimensions={0}, to_apply=%add.2.clone, metadata={scheduling_name="reduce-scatter.15"}
}

%wrapped_convert_computation.2 (param_0.6107: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6107 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6107"}
  ROOT %convert.3900.1 = f32[32768,8]{1,0} convert(%param_0.6107), metadata={scheduling_name="convert.3900.1"}
}

%wrapped_iota_computation.5 () -> s32[32768,8] {
  ROOT %iota.368.1 = s32[32768,8]{1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="iota.368.1"}
}

%wrapped_slice_computation.2 (param_0.6108: s32[32768,8]) -> s32[32768,2] {
  %param_0.6108 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6108"}
  ROOT %slice.2380.1 = s32[32768,2]{1,0} slice(%param_0.6108), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2380.1"}
}

%wrapped_iota_computation.6 () -> s32[32768,2] {
  ROOT %iota.369.1 = s32[32768,2]{1,0} iota(), iota_dimension=1, metadata={scheduling_name="iota.369.1"}
}

%wrapped_convert_computation.3 (param_0.6109: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6109 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6109"}
  ROOT %convert.3888.1 = f32[32768,8]{1,0} convert(%param_0.6109), metadata={scheduling_name="convert.3888.1"}
}

%wrapped_slice_computation.3 (param_0.6110: s32[32768,8]) -> s32[32768,2] {
  %param_0.6110 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6110"}
  ROOT %slice.2378.1 = s32[32768,2]{1,0} slice(%param_0.6110), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2378.1"}
}

%region_30.3928_spmd (param.3: (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128])) -> (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128]) {
  %param.3 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) parameter(0), metadata={scheduling_name="param.3"}
  %constant_1625_0 = s32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218}
  %constant_1684_0 = s32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_1705_0 = u32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_4543_0 = s32[4]{0} constant({0, 1, 0, 0})
  %constant_4587_0 = s32[3]{0} constant({0, 1, 0})
  %constant_4554_0 = s32[5]{0} constant({0, 1, 0, 0, 0})
  %constant_1724_0 = s32[3]{0} constant({31, 8191, 7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_2101_0 = f32[0]{0} constant({})
  %constant_2088_0 = bf16[0]{0} constant({})
  %get-tuple-element.4608 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.3), index=23, metadata={scheduling_name="get-tuple-element.4608"}
  %collective-permute-start.3 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4608), channel_id=178, source_target_pairs={{8,0},{9,1},{10,2},{11,3},{12,4},{13,5},{14,6},{15,7}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %partition-id.3.0 = u32[] partition-id(), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="partition-id.3.0"}
  %loop_compare_fusion.10 = pred[1]{0} fusion(%constant_1625_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="loop_compare_fusion.10"}
  %loop_compare_fusion.9 = pred[1]{0} fusion(%constant_1625_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="loop_compare_fusion.9"}
  %loop_compare_fusion.11 = (pred[1]{0}, pred[1]{0}) fusion(%constant_1625_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.11, metadata={scheduling_name="loop_compare_fusion.11"}
  %loop_multiply_fusion.5 = s32[33]{0} fusion(), kind=kLoop, calls=%fused_multiply.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 deduplicated_name="loop_multiply_fusion.5" scheduling_name="loop_multiply_fusion.5"}
  %loop_power_fusion = f32[64]{0} fusion(), kind=kLoop, calls=%fused_power, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 deduplicated_name="loop_power_fusion" scheduling_name="loop_power_fusion"}
  %get-tuple-element.4585 = s32[] get-tuple-element(%param.3), index=0, metadata={scheduling_name="get-tuple-element.4585"}
  %copy.806 = s32[] copy(%get-tuple-element.4585), metadata={scheduling_name="copy.806"}
  %wrapped_iota.6 = s32[32768,2]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.6, metadata={scheduling_name="wrapped_iota.6"}
  %loop_add_fusion.1 = s32[] fusion(%copy.806), kind=kLoop, calls=%fused_add.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_add_fusion.1" scheduling_name="loop_add_fusion.1"}
  %get-tuple-element.4673 = s32[9]{0} get-tuple-element(%param.3), index=33, metadata={scheduling_name="get-tuple-element.4673"}
  %get-tuple-element.4586 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=1, metadata={scheduling_name="get-tuple-element.4586"}
  %get-tuple-element.4590 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=5, metadata={scheduling_name="get-tuple-element.4590"}
  %get-tuple-element.4591 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=6, metadata={scheduling_name="get-tuple-element.4591"}
  %get-tuple-element.4596 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=11, metadata={scheduling_name="get-tuple-element.4596"}
  %get-tuple-element.4600 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=15, metadata={scheduling_name="get-tuple-element.4600"}
  %get-tuple-element.4601 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=16, metadata={scheduling_name="get-tuple-element.4601"}
  %get-tuple-element.4675 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=35, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4675"}
  %get-tuple-element.4685 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=45, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4685"}
  %loop_dynamic_slice_fusion.19 = (bf16[1,1,6144]{2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, /*index=5*/bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}) fusion(%get-tuple-element.4600, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, /*index=5*/%get-tuple-element.4586, %get-tuple-element.4596, %get-tuple-element.4675, %get-tuple-element.4685, %get-tuple-element.4601, /*index=10*/%get-tuple-element.4590, %get-tuple-element.4591), kind=kLoop, calls=%fused_dynamic_slice.19, metadata={scheduling_name="loop_dynamic_slice_fusion.19"}
  %get-tuple-element.4592 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=7, metadata={scheduling_name="get-tuple-element.4592"}
  %get-tuple-element.4595 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=10, metadata={scheduling_name="get-tuple-element.4595"}
  %get-tuple-element.4602 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=17, metadata={scheduling_name="get-tuple-element.4602"}
  %get-tuple-element.4605 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=20, metadata={scheduling_name="get-tuple-element.4605"}
  %get-tuple-element.4681 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=41, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4681"}
  %get-tuple-element.4684 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=44, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4684"}
  %get-tuple-element.4691 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=51, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4691"}
  %get-tuple-element.4694 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=54, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4694"}
  %loop_dynamic_slice_fusion.21 = (bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}) fusion(%get-tuple-element.4602, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, /*index=5*/%get-tuple-element.4605, %get-tuple-element.4691, %get-tuple-element.4694, %get-tuple-element.4681, %get-tuple-element.4684, /*index=10*/%get-tuple-element.4592, %get-tuple-element.4595), kind=kLoop, calls=%fused_dynamic_slice.21, metadata={scheduling_name="loop_dynamic_slice_fusion.21"}
  %get-tuple-element.4593 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=8, metadata={scheduling_name="get-tuple-element.4593"}
  %get-tuple-element.4594 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=9, metadata={scheduling_name="get-tuple-element.4594"}
  %get-tuple-element.4603 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=18, metadata={scheduling_name="get-tuple-element.4603"}
  %get-tuple-element.4604 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=19, metadata={scheduling_name="get-tuple-element.4604"}
  %get-tuple-element.4682 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=42, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4682"}
  %get-tuple-element.4683 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=43, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4683"}
  %get-tuple-element.4692 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=52, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4692"}
  %get-tuple-element.4693 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=53, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4693"}
  %loop_dynamic_slice_fusion.16 = (bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}) fusion(%get-tuple-element.4603, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, /*index=5*/%get-tuple-element.4604, %get-tuple-element.4682, %get-tuple-element.4692, %get-tuple-element.4693, %get-tuple-element.4683, /*index=10*/%get-tuple-element.4593, %get-tuple-element.4594), kind=kLoop, calls=%fused_dynamic_slice.16, metadata={scheduling_name="loop_dynamic_slice_fusion.16"}
  %get-tuple-element.4669 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=29, metadata={scheduling_name="get-tuple-element.4669"}
  %input_reduce_fusion.8 = f32[4,8192]{1,0} fusion(%get-tuple-element.4669, %copy.806), kind=kInput, calls=%fused_reduce.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.6" scheduling_name="input_reduce_fusion.8"}
  %collective-permute-done.3 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-done.3"}
  %get-tuple-element.3924 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=4, metadata={scheduling_name="get-tuple-element.3924"}
  %bitcast.21432.0 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.3924), metadata={scheduling_name="bitcast.21432.0"}
  %get-tuple-element.3923 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=3, metadata={scheduling_name="get-tuple-element.3923"}
  %bitcast.21132.0 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.3923), metadata={scheduling_name="bitcast.21132.0"}
  %get-tuple-element.3914 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=5, metadata={scheduling_name="get-tuple-element.3914"}
  %bitcast.23238.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3914), metadata={scheduling_name="bitcast.23238.0"}
  %get-tuple-element.3913 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=4, metadata={scheduling_name="get-tuple-element.3913"}
  %bitcast.23186.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3913), metadata={scheduling_name="bitcast.23186.0"}
  %get-tuple-element.3912 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=3, metadata={scheduling_name="get-tuple-element.3912"}
  %bitcast.22229.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3912), metadata={scheduling_name="bitcast.22229.0"}
  %get-tuple-element.3911 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=2, metadata={scheduling_name="get-tuple-element.3911"}
  %bitcast.22175.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3911), metadata={scheduling_name="bitcast.22175.0"}
  %get-tuple-element.3988 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=5, metadata={scheduling_name="get-tuple-element.3988"}
  %bitcast.23134.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.3988), metadata={scheduling_name="bitcast.23134.0"}
  %get-tuple-element.3987 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=4, metadata={scheduling_name="get-tuple-element.3987"}
  %bitcast.22069.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.3987), metadata={scheduling_name="bitcast.22069.0"}
  %get-tuple-element.3986 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=3, metadata={scheduling_name="get-tuple-element.3986"}
  %bitcast.32022 = bf16[1,768,128,48]{2,3,0,1} bitcast(%get-tuple-element.3986), metadata={scheduling_name="bitcast.32022"}
  %get-tuple-element.3985 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=2, metadata={scheduling_name="get-tuple-element.3985"}
  %bitcast.32023 = bf16[1,768,128,48]{2,3,0,1} bitcast(%get-tuple-element.3985), metadata={scheduling_name="bitcast.32023"}
  %all-gather-start.1 = ((bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, /*index=5*/bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}), (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1})) all-gather-start(%bitcast.22069.0, %bitcast.22175.0, %bitcast.22229.0, %bitcast.32022, %bitcast.21432.0, /*index=5*/%bitcast.32023, %bitcast.21132.0, %bitcast.23134.0, %bitcast.23186.0, %bitcast.23238.0), channel_id=243, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15}}, dimensions={1}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.3 = bf16[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.3, metadata={deduplicated_name="loop_broadcast_fusion.3" scheduling_name="loop_broadcast_fusion.3"}
  %wrapped_iota.5 = s32[32768,8]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_iota.5"}
  %loop_rsqrt_fusion.5 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.8), kind=kLoop, calls=%fused_rsqrt.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.5"}
  %get-tuple-element.4672 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.3), index=32, metadata={scheduling_name="get-tuple-element.4672"}
  %loop_dynamic_slice_fusion.25 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4672, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.25, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.24" scheduling_name="loop_dynamic_slice_fusion.25"}
  %get-tuple-element.4690 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=50, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4690"}
  %get-tuple-element.4609 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=24, metadata={scheduling_name="get-tuple-element.4609"}
  %get-tuple-element.4607 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.3), index=22, metadata={scheduling_name="get-tuple-element.4607"}
  %loop_convert_dynamic_slice_fusion = (bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(%get-tuple-element.4669, %copy.806, %get-tuple-element.4690, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %loop_rsqrt_fusion.5, %collective-permute-done.3, %get-tuple-element.4609, %loop_compare_fusion.9, /*index=10*/%get-tuple-element.4607), kind=kLoop, calls=%fused_convert_dynamic_slice, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_convert_dynamic_slice_fusion"}
  %all-gather-done.1 = (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}) all-gather-done(%all-gather-start.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-done.1"}
  %get-tuple-element.4284 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done.1), index=3, metadata={scheduling_name="get-tuple-element.4284"}
  %bitcast.21368.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4284), metadata={scheduling_name="bitcast.21368.0"}
  %bitcast.23899.0 = bf16[32768,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.25), metadata={scheduling_name="bitcast.23899.0"}
  %get-tuple-element.3890 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3890"}
  %bitcast.21377.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3890), metadata={scheduling_name="bitcast.21377.0"}
  %cublas-lt-matmul.17 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23899.0, %bitcast.21368.0, %bitcast.21377.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.17"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_broadcast_fusion.4 = u32[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.4, metadata={deduplicated_name="loop_broadcast_fusion.4" scheduling_name="loop_broadcast_fusion.4"}
  %get-tuple-element.3756.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.17), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3756.0"}
  %input_reduce_fusion.11 = f32[4,8192]{1,0} fusion(%get-tuple-element.3756.0), kind=kInput, calls=%fused_reduce.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.11"}
  %loop_rsqrt_fusion.6 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.11), kind=kLoop, calls=%fused_rsqrt.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.6"}
  %get-tuple-element.4689 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=49, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4689"}
  %loop_convert_fusion.11 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%loop_rsqrt_fusion.6, %get-tuple-element.3756.0, %get-tuple-element.4689, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_convert.11, metadata={scheduling_name="loop_convert_fusion.11"}
  %get-tuple-element.4285 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done.1), index=4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4285"}
  %bitcast.21436.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4285), metadata={scheduling_name="bitcast.21436.0"}
  %bitcast.21423.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.21423.0"}
  %custom-call.1083 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21423.0, %bitcast.21436.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1083"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4671 = u32[9,2,4]{2,1,0} get-tuple-element(%param.3), index=31, metadata={scheduling_name="get-tuple-element.4671"}
  %loop_dynamic_slice_fusion.22 = u32[1,2,4]{2,1,0} fusion(%get-tuple-element.4671, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.22, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.22" scheduling_name="loop_dynamic_slice_fusion.22"}
  %get-tuple-element.3757.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1083), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3757.0"}
  %wrapped_convert.2 = f32[32768,8]{1,0} fusion(%get-tuple-element.3757.0), kind=kLoop, calls=%wrapped_convert_computation.2, metadata={scheduling_name="wrapped_convert.2"}
  %sort.15.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.2, %wrapped_iota.5), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.15.0"}
  %copy.699 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.699"}
  %get-tuple-element.1391.0 = s32[32768,8]{1,0} get-tuple-element(%sort.15.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1391.0"}
  %wrapped_slice.2 = s32[32768,2]{1,0} fusion(%get-tuple-element.1391.0), kind=kLoop, calls=%wrapped_slice_computation.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.2"}
  %get-tuple-element.3840.0 = f32[32768,8]{1,0} get-tuple-element(%sort.15.0), index=0, metadata={scheduling_name="get-tuple-element.3840.0"}
  %loop_convert_fusion.16 = f32[32768,2]{1,0} fusion(%get-tuple-element.3840.0), kind=kLoop, calls=%fused_convert.16, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.16"}
  %sort.19.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.16, %wrapped_slice.2, %wrapped_iota.6), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.19.0"}
  %copy.698 = u32[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.4), metadata={scheduling_name="copy.698"}
  %get-tuple-element.1294.0 = s32[32768,2]{1,0} get-tuple-element(%sort.19.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1294.0"}
  %loop_compare_fusion.7 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.1294.0), kind=kLoop, calls=%fused_compare.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.7" scheduling_name="loop_compare_fusion.7"}
  %loop_slice_fusion.2 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.7), kind=kLoop, calls=%fused_slice.2, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.2"}
  %loop_reduce_window_fusion.7 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.2), kind=kLoop, calls=%fused_reduce_window.7, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.7"}
  %loop_transpose_fusion.9 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) fusion(%get-tuple-element.1294.0, %constant_1705_0, %partition-id.3.0, %constant_1684_0), kind=kLoop, calls=%fused_transpose.14, metadata={scheduling_name="loop_transpose_fusion.9"}
  %loop_reduce_window_fusion.6 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.7), kind=kLoop, calls=%fused_reduce_window.6, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.6"}
  %get-tuple-element.3889 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.9), index=1, metadata={scheduling_name="get-tuple-element.3889"}
  %input_scatter_fusion.9 = u32[1,4,8192,8]{3,2,1,0} fusion(%copy.698, %get-tuple-element.3889, %constant_1625_0, %partition-id.3.0, %constant_1684_0), kind=kInput, calls=%fused_scatter.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.8" scheduling_name="input_scatter_fusion.9"}
  %loop_compare_fusion.5 = pred[1,4,8192,2]{3,2,1,0} fusion(%input_scatter_fusion.9, %get-tuple-element.1294.0, %constant_1705_0, %partition-id.3.0, %constant_1625_0, /*index=5*/%constant_1684_0), kind=kLoop, calls=%fused_compare.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_compare_fusion.5" scheduling_name="loop_compare_fusion.5"}
  %input_reduce_fusion.10 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.7, %loop_reduce_window_fusion.7, %loop_reduce_window_fusion.6), kind=kInput, calls=%fused_reduce.10, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.10"}
  %get-tuple-element.3842.0 = f32[32768,2]{1,0} get-tuple-element(%sort.19.0), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3842.0"}
  %input_scatter_fusion.7 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.699, %get-tuple-element.3889, %loop_compare_fusion.5, %get-tuple-element.3842.0), kind=kInput, calls=%fused_scatter.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.5" scheduling_name="input_scatter_fusion.7"}
  %get-tuple-element.3886 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.3886"}
  %get-tuple-element.3887 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.3887"}
  %input_multiply_transpose_fusion.3 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.3887, %get-tuple-element.3886, %input_scatter_fusion.7), kind=kInput, calls=%fused_multiply_transpose.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.3"}
  %get-tuple-element.4667 = u32[9,2,4]{2,1,0} get-tuple-element(%param.3), index=27, metadata={scheduling_name="get-tuple-element.4667"}
  %loop_dynamic_slice_fusion.23 = u32[1,2,4]{2,1,0} fusion(%get-tuple-element.4667, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.23, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.22" scheduling_name="loop_dynamic_slice_fusion.23"}
  %get-tuple-element.3884 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3884"}
  %get-tuple-element.3885 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3885"}
  %input_convert_transpose_fusion.3 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.3884, %get-tuple-element.3885), kind=kInput, calls=%fused_convert_transpose.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="input_convert_transpose_fusion.2" scheduling_name="input_convert_transpose_fusion.3"}
  %get-tuple-element.4665 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=25, metadata={scheduling_name="get-tuple-element.4665"}
  %input_reduce_fusion.6 = f32[4,8192]{1,0} fusion(%get-tuple-element.4665, %copy.806), kind=kInput, calls=%fused_reduce.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.6" scheduling_name="input_reduce_fusion.6"}
  %bitcast.21657.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.21657.0"}
  %get-tuple-element.3881 = bf16[1,4,8,2048,8192]{4,3,2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3881"}
  %bitcast.21649.0 = bf16[4,16384,8192]{2,1,0} bitcast(%get-tuple-element.3881), metadata={scheduling_name="bitcast.21649.0"}
  %custom-call.1084 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.21649.0, %bitcast.21657.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1084"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_rsqrt_fusion.4 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.6), kind=kLoop, calls=%fused_rsqrt.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.4"}
  %get-tuple-element.3758.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1084), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3758.0"}
  %loop_transpose_fusion.12 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3758.0), kind=kLoop, calls=%fused_transpose.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.12"}
  %copy.733 = bf16[1,2,4,8192,6144]{4,3,2,1,0} copy(%get-tuple-element.4609), metadata={scheduling_name="copy.733"}
  %bitcast.21664.0 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} bitcast(%loop_transpose_fusion.12), metadata={scheduling_name="bitcast.21664.0"}
  %all-to-all-start.4 = ((bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}), bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.21664.0), calls=%async_computation.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4670 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.3), index=30, metadata={scheduling_name="get-tuple-element.4670"}
  %loop_dynamic_slice_fusion.18 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%get-tuple-element.4670, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.17" scheduling_name="loop_dynamic_slice_fusion.18"}
  %get-tuple-element.4666 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.3), index=26, metadata={scheduling_name="get-tuple-element.4666"}
  %loop_dynamic_slice_fusion.17 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%get-tuple-element.4666, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.17" scheduling_name="loop_dynamic_slice_fusion.17"}
  %get-tuple-element.4668 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.3), index=28, metadata={scheduling_name="get-tuple-element.4668"}
  %loop_dynamic_slice_fusion.24 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4668, %copy.806), kind=kLoop, calls=%fused_dynamic_slice.24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.24" scheduling_name="loop_dynamic_slice_fusion.24"}
  %get-tuple-element.3908 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3908"}
  %bitcast.21702.0 = bf16[4,6144,8192]{1,2,0} bitcast(%get-tuple-element.3908), metadata={scheduling_name="bitcast.21702.0"}
  %get-tuple-element.3882 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3882"}
  %custom-call.1086 = (bf16[4,6144,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.21702.0, %get-tuple-element.3882), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1086"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"134217728","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4606 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=21, metadata={scheduling_name="get-tuple-element.4606"}
  %copy.731 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%get-tuple-element.4606), metadata={scheduling_name="copy.731"}
  %get-tuple-element.3760.0 = bf16[4,6144,16384]{2,1,0} get-tuple-element(%custom-call.1086), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3760.0"}
  %loop_transpose_fusion.11 = bf16[8,24576,2048]{2,1,0} fusion(%get-tuple-element.3760.0), kind=kLoop, calls=%fused_transpose.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion.7" scheduling_name="loop_transpose_fusion.11"}
  %all-to-all-done.4 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.4"}
  %bitcast.21714.0 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} bitcast(%loop_transpose_fusion.11), metadata={scheduling_name="bitcast.21714.0"}
  %all-to-all-start.5 = ((bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3}), bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3}) async-start(%bitcast.21714.0), calls=%async_computation.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_dynamic_update_slice_fusion.32 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%copy.733, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.32, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="loop_dynamic_update_slice_fusion.32"}
  %get-tuple-element.4587 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=2, metadata={scheduling_name="get-tuple-element.4587"}
  %get-tuple-element.4588 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=3, metadata={scheduling_name="get-tuple-element.4588"}
  %get-tuple-element.4589 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=4, metadata={scheduling_name="get-tuple-element.4589"}
  %get-tuple-element.4597 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=12, metadata={scheduling_name="get-tuple-element.4597"}
  %get-tuple-element.4598 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=13, metadata={scheduling_name="get-tuple-element.4598"}
  %get-tuple-element.4599 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=14, metadata={scheduling_name="get-tuple-element.4599"}
  %get-tuple-element.4676 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=36, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4676"}
  %get-tuple-element.4677 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=37, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4677"}
  %get-tuple-element.4678 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=38, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4678"}
  %get-tuple-element.4686 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=46, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4686"}
  %get-tuple-element.4687 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=47, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4687"}
  %get-tuple-element.4688 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=48, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4688"}
  %loop_dynamic_slice_fusion.20 = (bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=10*/bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}) fusion(%get-tuple-element.4686, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, /*index=5*/%get-tuple-element.4688, %get-tuple-element.4687, %get-tuple-element.4676, %get-tuple-element.4677, %get-tuple-element.4678, /*index=10*/%get-tuple-element.4587, %get-tuple-element.4588, %get-tuple-element.4589, %get-tuple-element.4597, %get-tuple-element.4598, /*index=15*/%get-tuple-element.4599), kind=kLoop, calls=%fused_dynamic_slice.20, metadata={scheduling_name="loop_dynamic_slice_fusion.20"}
  %loop_dynamic_update_slice_fusion.31 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%copy.731, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.31, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="loop_dynamic_update_slice_fusion.31"}
  %get-tuple-element.3993 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.3993"}
  %bitcast.21757.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3993), metadata={scheduling_name="bitcast.21757.0"}
  %bitcast.21753.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.4), metadata={scheduling_name="bitcast.21753.0"}
  %custom-call.1090 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21753.0, %bitcast.21757.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1090"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3991 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.3991"}
  %bitcast.21677.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3991), metadata={scheduling_name="bitcast.21677.0"}
  %custom-call.1085 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21753.0, %bitcast.21677.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1085"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.5 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} async-done(%all-to-all-start.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.5"}
  %input_transpose_fusion.5 = bf16[32,2048,6144]{2,1,0} fusion(%all-to-all-done.5), kind=kInput, calls=%fused_transpose.16, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion" scheduling_name="input_transpose_fusion.5"}
  %get-tuple-element.3992 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.3992"}
  %bitcast.21730.0 = bf16[6144,16384]{0,1} bitcast(%get-tuple-element.3992), metadata={scheduling_name="bitcast.21730.0"}
  %bitcast.23733.0 = bf16[65536,6144]{1,0} bitcast(%input_transpose_fusion.5), metadata={scheduling_name="bitcast.23733.0"}
  %custom-call.1087 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23733.0, %bitcast.21730.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1087"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %copy.706 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.706"}
  %get-tuple-element.3761.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1087), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3761.0"}
  %get-tuple-element.3762.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1090), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3762.0"}
  %get-tuple-element.3759.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1085), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3759.0"}
  %loop_convert_fusion.10 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) fusion(%get-tuple-element.3762.0, %get-tuple-element.3759.0, %get-tuple-element.3761.0), kind=kLoop, calls=%fused_convert.10, metadata={scheduling_name="loop_convert_fusion.10"}
  %copy.701 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.701"}
  %bitcast.21860.0 = bf16[16384,6144]{1,0} bitcast(%get-tuple-element.3992), metadata={scheduling_name="bitcast.21860.0"}
  %get-tuple-element.3877 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.3877"}
  %bitcast.21856.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3877), metadata={scheduling_name="bitcast.21856.0"}
  %custom-call.1092 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21856.0, %bitcast.21860.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1092"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %input_reduce_fusion.19 = pred[] fusion(%constant_4543_0, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kInput, calls=%fused_reduce.19, metadata={scheduling_name="input_reduce_fusion.19"}
  %get-tuple-element.3765.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1092), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3765.0"}
  %bitcast.21864.0 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} bitcast(%get-tuple-element.3765.0), metadata={scheduling_name="bitcast.21864.0"}
  %all-to-all-start.7 = ((bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}), bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.21864.0), calls=%async_computation.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_compare_reduce_fusion = (pred[], pred[], pred[]) fusion(%get-tuple-element.4673, %copy.806, %constant_4587_0, %constant_1625_0, %partition-id.3.0, /*index=5*/%constant_4554_0), kind=kLoop, calls=%fused_compare_reduce, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="loop_compare_reduce_fusion"}
  %get-tuple-element.4674 = s32[4,4,8192]{2,1,0} get-tuple-element(%param.3), index=34, metadata={scheduling_name="get-tuple-element.4674"}
  %loop_convert_fusion.14 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) fusion(%loop_power_fusion, %get-tuple-element.4674, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, /*index=5*/%copy.806), kind=kLoop, calls=%fused_convert.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="loop_convert_fusion.14"}
  %get-tuple-element.4283 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4283"}
  %bitcast.22233.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4283), metadata={scheduling_name="bitcast.22233.0"}
  %get-tuple-element.3891 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3891"}
  %bitcast.23973.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3891), metadata={scheduling_name="bitcast.23973.0"}
  %custom-call.1099 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23973.0, %bitcast.22233.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1099"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.21791.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3991), metadata={scheduling_name="bitcast.21791.0"}
  %get-tuple-element.3878 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.3878"}
  %bitcast.23675.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3878), metadata={scheduling_name="bitcast.23675.0"}
  %custom-call.1091 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23675.0, %bitcast.21791.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1091"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.21748.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3993), metadata={scheduling_name="bitcast.21748.0"}
  %get-tuple-element.3879 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=2, metadata={scheduling_name="get-tuple-element.3879"}
  %bitcast.23703.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3879), metadata={scheduling_name="bitcast.23703.0"}
  %get-tuple-element.3763.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1091), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3763.0"}
  %cublas-lt-matmul.18 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23703.0, %bitcast.21748.0, %get-tuple-element.3763.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="cublas-lt-matmul.18"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.7 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.7"}
  %input_transpose_fusion.4 = bf16[4,6144,8,2048]{3,2,1,0} fusion(%all-to-all-done.7), kind=kInput, calls=%fused_transpose.13, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion.2" scheduling_name="input_transpose_fusion.4"}
  %get-tuple-element.3764.0 = bf16[65536,6144]{1,0} get-tuple-element(%cublas-lt-matmul.18), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3764.0"}
  %bitcast.21797.0 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} bitcast(%get-tuple-element.3764.0), metadata={scheduling_name="bitcast.21797.0"}
  %all-to-all-start.6 = ((bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1}), bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1}) async-start(%bitcast.21797.0), calls=%async_computation.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.21847.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3908), metadata={scheduling_name="bitcast.21847.0"}
  %bitcast.21871.0 = bf16[4,6144,16384]{2,1,0} bitcast(%input_transpose_fusion.4), metadata={scheduling_name="bitcast.21871.0"}
  %custom-call.1093 = (bf16[4,8192,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.21847.0, %bitcast.21871.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1093"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4282 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4282"}
  %bitcast.22179.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4282), metadata={scheduling_name="bitcast.22179.0"}
  %custom-call.1096 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23973.0, %bitcast.22179.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1096"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3766.0 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%custom-call.1093), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3766.0"}
  %input_transpose_fusion.3 = bf16[4,16392,8192]{2,1,0} fusion(%get-tuple-element.3766.0), kind=kInput, calls=%fused_transpose.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 deduplicated_name="input_transpose_fusion.1" scheduling_name="input_transpose_fusion.3"}
  %input_reduce_fusion.14 = bf16[4,8,8192]{2,1,0} fusion(%get-tuple-element.3884, %input_transpose_fusion.3), kind=kInput, calls=%fused_reduce.14, metadata={deduplicated_name="input_reduce_fusion.13" scheduling_name="input_reduce_fusion.14"}
  %loop_select_fusion = bf16[1,4,8192,2]{3,2,1,0} fusion(%loop_compare_fusion.5, %get-tuple-element.1294.0, %get-tuple-element.3886, %input_reduce_fusion.14, %constant_1724_0, /*index=5*/%constant_1705_0, %partition-id.3.0, %constant_1684_0), kind=kLoop, calls=%fused_select, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_select_fusion" scheduling_name="loop_select_fusion"}
  %get-tuple-element.3888 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.9), index=0, metadata={scheduling_name="get-tuple-element.3888"}
  %input_scatter_fusion.6 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.701, %get-tuple-element.3888, %loop_select_fusion, %get-tuple-element.3842.0), kind=kInput, calls=%fused_scatter.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 deduplicated_name="input_scatter_fusion.4" scheduling_name="input_scatter_fusion.6"}
  %get-tuple-element.4281 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4281"}
  %bitcast.22073.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4281), metadata={scheduling_name="bitcast.22073.0"}
  %custom-call.1095 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23973.0, %bitcast.22073.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1095"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.21967.0 = bf16[8,6144]{0,1} bitcast(%get-tuple-element.4285), metadata={scheduling_name="bitcast.21967.0"}
  %bitcast.23639.0 = bf16[32768,8]{1,0} bitcast(%input_scatter_fusion.6), metadata={scheduling_name="bitcast.23639.0"}
  %custom-call.1094 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23639.0, %bitcast.21967.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1094"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"262144","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.6 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} async-done(%all-to-all-start.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.6"}
  %loop_transpose_fusion.10 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.6), kind=kLoop, calls=%fused_transpose.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.6" scheduling_name="loop_transpose_fusion.10"}
  %get-tuple-element.3883 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3883"}
  %get-tuple-element.3767.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1094), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3767.0"}
  %bitcast.21971.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3767.0), metadata={scheduling_name="bitcast.21971.0"}
  %bitcast.21804.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.10), metadata={scheduling_name="bitcast.21804.0"}
  %cublas-lt-matmul.19 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.3883, %bitcast.21804.0, %bitcast.21971.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="cublas-lt-matmul.19"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3873 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.14), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.3873"}
  %get-tuple-element.3872 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.14), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.3872"}
  %get-tuple-element.3770.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1096), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3770.0"}
  %input_concatenate_fusion.10 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3770.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.10"}
  %get-tuple-element.3768.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.19), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3768.0"}
  %input_reduce_fusion.9 = f32[4,8192]{1,0} fusion(%get-tuple-element.3768.0, %get-tuple-element.3756.0, %get-tuple-element.4689, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %copy.806), kind=kInput, calls=%fused_reduce.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="input_reduce_fusion.5" scheduling_name="input_reduce_fusion.9"}
  %loop_multiply_fusion.1 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.6, %input_reduce_fusion.9, %input_reduce_fusion.11), kind=kLoop, calls=%fused_multiply.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.1"}
  %get-tuple-element.4680 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=40, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4680"}
  %input_add_convert_dynamic_slice_reduce_select_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, /*index=5*/bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) fusion(%loop_multiply_fusion.1, %get-tuple-element.3756.0, %loop_rsqrt_fusion.6, %get-tuple-element.4689, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.3768.0, %collective-permute-done.3, %get-tuple-element.4609, %get-tuple-element.4673, /*index=10*/%copy.806, %loop_compare_fusion.9, %get-tuple-element.4607, %get-tuple-element.4680, %loop_rsqrt_fusion.4, /*index=15*/%get-tuple-element.4665, %get-tuple-element.4606), kind=kInput, calls=%fused_add_convert_dynamic_slice_reduce_select, metadata={scheduling_name="input_add_convert_dynamic_slice_reduce_select_fusion"}
  %get-tuple-element.3769.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1095), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3769.0"}
  %input_concatenate_fusion.6 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3769.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.6"}
  %bitcast.22271.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4284), metadata={scheduling_name="bitcast.22271.0"}
  %get-tuple-element.3874 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=0, metadata={scheduling_name="get-tuple-element.3874"}
  %bitcast.22267.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3874), metadata={scheduling_name="bitcast.22267.0"}
  %custom-call.1100 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22267.0, %bitcast.22271.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1100"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22258.0 = u32[2,4]{1,0} bitcast(%loop_dynamic_slice_fusion.22), metadata={scheduling_name="bitcast.22258.0"}
  %bitcast.22249.0 = f32[1,4,48,8192,1]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.18), metadata={scheduling_name="bitcast.22249.0"}
  %bitcast.22262.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.25), metadata={scheduling_name="bitcast.22262.0"}
  %get-tuple-element.3771.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1099), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3771.0"}
  %bitcast.22237.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3771.0), metadata={scheduling_name="bitcast.22237.0"}
  %get-tuple-element.3772.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1100), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3772.0"}
  %bitcast.22275.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%get-tuple-element.3772.0), metadata={scheduling_name="bitcast.22275.0"}
  %custom-call.988 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u8[1616904192]{0}) custom-call(%input_concatenate_fusion.6, %input_concatenate_fusion.10, %bitcast.22237.0, %constant_2088_0, %bitcast.22249.0, /*index=5*/%bitcast.22258.0, %bitcast.22262.0, %bitcast.22275.0, %loop_multiply_fusion.5, %loop_multiply_fusion.5, /*index=10*/%constant_2101_0, %constant_2101_0, %constant_2101_0, %constant_2101_0, %constant_2101_0, /*index=15*/%constant_2101_0), custom_call_target="te_fused_attn_backward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, s32[33]{0}, s32[33]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.988"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.23701.0 = bf16[6144,65536]{0,1} bitcast(%all-to-all-done.4), metadata={scheduling_name="bitcast.23701.0"}
  %custom-call.1136 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23701.0, %bitcast.23703.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1136"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1315.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1315.0"}
  %input_concatenate_fusion.4 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1315.0), kind=kInput, calls=%fused_concatenate.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.4" scheduling_name="input_concatenate_fusion.4"}
  %custom-call.1135 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23701.0, %bitcast.23675.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1135"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22377.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4281), metadata={scheduling_name="bitcast.22377.0"}
  %bitcast.22373.0 = bf16[32768,6144]{1,0} bitcast(%input_concatenate_fusion.4), metadata={scheduling_name="bitcast.22373.0"}
  %custom-call.1102 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22373.0, %bitcast.22377.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1102"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1314.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1314.0"}
  %input_concatenate_fusion.8 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1314.0), kind=kInput, calls=%fused_concatenate.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.8" scheduling_name="input_concatenate_fusion.8"}
  %get-tuple-element.4286 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done.1), index=5, metadata={scheduling_name="get-tuple-element.4286"}
  %bitcast.21053.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4286), metadata={scheduling_name="bitcast.21053.0"}
  %bitcast.23529.0 = bf16[32768,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.24), metadata={scheduling_name="bitcast.23529.0"}
  %get-tuple-element.3905 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=5, metadata={scheduling_name="get-tuple-element.3905"}
  %bitcast.21062.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3905), metadata={scheduling_name="bitcast.21062.0"}
  %cublas-lt-matmul.16 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23529.0, %bitcast.21053.0, %bitcast.21062.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.16"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22330.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4282), metadata={scheduling_name="bitcast.22330.0"}
  %bitcast.22326.0 = bf16[32768,1024]{1,0} bitcast(%input_concatenate_fusion.8), metadata={scheduling_name="bitcast.22326.0"}
  %custom-call.1101 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22326.0, %bitcast.22330.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1101"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3754.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.16), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3754.0"}
  %input_reduce_fusion.12 = f32[4,8192]{1,0} fusion(%get-tuple-element.3754.0), kind=kInput, calls=%fused_reduce.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.12"}
  %bitcast.22288.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4283), metadata={scheduling_name="bitcast.22288.0"}
  %get-tuple-element.1313.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1313.0"}
  %bitcast.22284.0 = bf16[32768,1024]{1,0} bitcast(%get-tuple-element.1313.0), metadata={scheduling_name="bitcast.22284.0"}
  %get-tuple-element.3773.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1101), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3773.0"}
  %cublas-lt-matmul.20 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22284.0, %bitcast.22288.0, %get-tuple-element.3773.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.20"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_rsqrt_fusion.7 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.12), kind=kLoop, calls=%fused_rsqrt.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.7"}
  %get-tuple-element.4679 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=39, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4679"}
  %get-tuple-element.3775.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1102), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3775.0"}
  %get-tuple-element.3774.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.20), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3774.0"}
  %input_convert_reduce_fusion.1 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(%get-tuple-element.4669, %copy.806, %get-tuple-element.4690, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %get-tuple-element.3775.0, %get-tuple-element.3774.0, %get-tuple-element.4679, %loop_rsqrt_fusion.7, /*index=10*/%get-tuple-element.3754.0), kind=kInput, calls=%fused_convert_reduce.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_convert_reduce_fusion.1"}
  %get-tuple-element.4287 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done.1), index=6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4287"}
  %bitcast.21136.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4287), metadata={scheduling_name="bitcast.21136.0"}
  %get-tuple-element.3907 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3907"}
  %bitcast.21123.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.21123.0"}
  %custom-call.1082 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21123.0, %bitcast.21136.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1082"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23731.0 = bf16[16384,65536]{0,1} bitcast(%get-tuple-element.3877), metadata={scheduling_name="bitcast.23731.0"}
  %custom-call.1137 = (bf16[16384,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23731.0, %bitcast.23733.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1137"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3755.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1082), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3755.0"}
  %wrapped_convert.3 = f32[32768,8]{1,0} fusion(%get-tuple-element.3755.0), kind=kLoop, calls=%wrapped_convert_computation.3, metadata={scheduling_name="wrapped_convert.3"}
  %sort.14.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.3, %wrapped_iota.5), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.14.0"}
  %get-tuple-element.3919 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3919"}
  %get-tuple-element.4002 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=11, metadata={scheduling_name="get-tuple-element.4002"}
  %get-tuple-element.3805.0 = bf16[16384,6144]{1,0} get-tuple-element(%custom-call.1137), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3805.0"}
  %loop_dynamic_update_slice_fusion.25 = bf16[2,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4599, %get-tuple-element.3805.0, %get-tuple-element.4002, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.25, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.19" scheduling_name="loop_dynamic_update_slice_fusion.25"}
  %get-tuple-element.1389.0 = s32[32768,8]{1,0} get-tuple-element(%sort.14.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1389.0"}
  %wrapped_slice.3 = s32[32768,2]{1,0} fusion(%get-tuple-element.1389.0), kind=kLoop, calls=%wrapped_slice_computation.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.3"}
  %get-tuple-element.3835.0 = f32[32768,8]{1,0} get-tuple-element(%sort.14.0), index=0, metadata={scheduling_name="get-tuple-element.3835.0"}
  %loop_convert_fusion.15 = f32[32768,2]{1,0} fusion(%get-tuple-element.3835.0), kind=kLoop, calls=%fused_convert.15, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.15"}
  %sort.18.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.15, %wrapped_slice.3, %wrapped_iota.6), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.18.0"}
  %get-tuple-element.4001 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=10, metadata={scheduling_name="get-tuple-element.4001"}
  %get-tuple-element.3804.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1136), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3804.0"}
  %loop_dynamic_update_slice_fusion.24 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4598, %get-tuple-element.4001, %get-tuple-element.3804.0, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.24"}
  %get-tuple-element.1277.0 = s32[32768,2]{1,0} get-tuple-element(%sort.18.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1277.0"}
  %loop_compare_fusion.8 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.1277.0), kind=kLoop, calls=%fused_compare.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.7" scheduling_name="loop_compare_fusion.8"}
  %loop_transpose_fusion.13 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) fusion(%get-tuple-element.1277.0, %constant_1705_0, %partition-id.3.0, %constant_1684_0), kind=kLoop, calls=%fused_transpose.19, metadata={scheduling_name="loop_transpose_fusion.13"}
  %get-tuple-element.3880 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=3, metadata={scheduling_name="get-tuple-element.3880"}
  %bitcast.24227.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3880), metadata={scheduling_name="bitcast.24227.0"}
  %collective-permute-start.6 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24227.0), channel_id=357, source_target_pairs={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_slice_fusion.3 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.8), kind=kLoop, calls=%fused_slice.3, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.3"}
  %loop_reduce_window_fusion.5 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.3), kind=kLoop, calls=%fused_reduce_window.5, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.5"}
  %loop_reduce_window_fusion.4 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.5), kind=kLoop, calls=%fused_reduce_window.4, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.4"}
  %get-tuple-element.3898 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.3898"}
  %input_scatter_fusion.8 = u32[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.4, %get-tuple-element.3898, %constant_1625_0, %partition-id.3.0, %constant_1684_0), kind=kInput, calls=%fused_scatter.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.8" scheduling_name="input_scatter_fusion.8"}
  %loop_compare_fusion.6 = pred[1,4,8192,2]{3,2,1,0} fusion(%input_scatter_fusion.8, %get-tuple-element.1277.0, %constant_1705_0, %partition-id.3.0, %constant_1625_0, /*index=5*/%constant_1684_0), kind=kLoop, calls=%fused_compare.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_compare_fusion.5" scheduling_name="loop_compare_fusion.6"}
  %input_reduce_fusion.7 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.8, %loop_reduce_window_fusion.5, %loop_reduce_window_fusion.4), kind=kInput, calls=%fused_reduce.7, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.7"}
  %get-tuple-element.3837.0 = f32[32768,2]{1,0} get-tuple-element(%sort.18.0), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3837.0"}
  %input_scatter_fusion.5 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.706, %get-tuple-element.3898, %loop_compare_fusion.6, %get-tuple-element.3837.0), kind=kInput, calls=%fused_scatter.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.5" scheduling_name="input_scatter_fusion.5"}
  %get-tuple-element.3894 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.3894"}
  %get-tuple-element.3895 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.3895"}
  %input_multiply_transpose_fusion.2 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.3895, %get-tuple-element.3894, %input_scatter_fusion.5), kind=kInput, calls=%fused_multiply_transpose.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.2"}
  %get-tuple-element.4000 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=9, metadata={scheduling_name="get-tuple-element.4000"}
  %get-tuple-element.3803.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1135), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3803.0"}
  %loop_dynamic_update_slice_fusion.23 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4597, %get-tuple-element.4000, %get-tuple-element.3803.0, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.23, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.23"}
  %get-tuple-element.3892 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3892"}
  %get-tuple-element.3893 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3893"}
  %input_convert_transpose_fusion.2 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.3892, %get-tuple-element.3893), kind=kInput, calls=%fused_convert_transpose.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="input_convert_transpose_fusion.2" scheduling_name="input_convert_transpose_fusion.2"}
  %bitcast.23637.0 = bf16[6144,32768]{0,1} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.23637.0"}
  %custom-call.1132 = (bf16[6144,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23637.0, %bitcast.23639.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1132"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"262144","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22598.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.22598.0"}
  %get-tuple-element.3866 = bf16[1,4,8,2048,8192]{4,3,2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3866"}
  %bitcast.22992.0 = bf16[4,16384,8192]{2,1,0} bitcast(%get-tuple-element.3866), metadata={scheduling_name="bitcast.22992.0"}
  %custom-call.1103 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.22992.0, %bitcast.22598.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1103"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3870 = f32[4,8192]{1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3870"}
  %loop_multiply_fusion.2 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.5, %get-tuple-element.3870, %input_reduce_fusion.8), kind=kLoop, calls=%fused_multiply.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.2"}
  %get-tuple-element.3776.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1103), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3776.0"}
  %loop_transpose_fusion.8 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3776.0), kind=kLoop, calls=%fused_transpose.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.8"}
  %collective-permute-done.6 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-done.6"}
  %bitcast.22605.0 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} bitcast(%loop_transpose_fusion.8), metadata={scheduling_name="bitcast.22605.0"}
  %all-to-all-start.8 = ((bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}), bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.22605.0), calls=%async_computation.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3875 = f32[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=1, metadata={scheduling_name="get-tuple-element.3875"}
  %get-tuple-element.3871 = bf16[32768,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3871"}
  %loop_convert_fusion.13 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3875, %loop_multiply_fusion.2, %loop_rsqrt_fusion.5, %get-tuple-element.3871, %get-tuple-element.4669, /*index=5*/%copy.806, %get-tuple-element.4690, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673), kind=kLoop, calls=%fused_convert.13, metadata={scheduling_name="loop_convert_fusion.13"}
  %get-tuple-element.4290 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4290"}
  %bitcast.23242.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4290), metadata={scheduling_name="bitcast.23242.0"}
  %get-tuple-element.3904 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=4, metadata={scheduling_name="get-tuple-element.3904"}
  %bitcast.23603.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3904), metadata={scheduling_name="bitcast.23603.0"}
  %custom-call.1122 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23603.0, %bitcast.23242.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1122"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22824.0 = bf16[4,6144,8192]{1,2,0} bitcast(%loop_convert_fusion.13), metadata={scheduling_name="bitcast.22824.0"}
  %get-tuple-element.3867 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3867"}
  %custom-call.1111 = (bf16[4,6144,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.22824.0, %get-tuple-element.3867), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1111"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"134217728","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4289 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4289"}
  %bitcast.23190.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4289), metadata={scheduling_name="bitcast.23190.0"}
  %custom-call.1121 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23603.0, %bitcast.23190.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1121"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3782.0 = bf16[4,6144,16384]{2,1,0} get-tuple-element(%custom-call.1111), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3782.0"}
  %loop_transpose_fusion.7 = bf16[8,24576,2048]{2,1,0} fusion(%get-tuple-element.3782.0), kind=kLoop, calls=%fused_transpose.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion.7" scheduling_name="loop_transpose_fusion.7"}
  %get-tuple-element.3876 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=2, metadata={scheduling_name="get-tuple-element.3876"}
  %input_reduce_fusion.16 = bf16[6144]{0} fusion(%get-tuple-element.3876), kind=kInput, calls=%fused_reduce.16, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.16"}
  %all-to-all-done.8 = bf16[1,4,8,1,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.8"}
  %bitcast.22836.0 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} bitcast(%loop_transpose_fusion.7), metadata={scheduling_name="bitcast.22836.0"}
  %all-to-all-start.10 = ((bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3}), bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3}) async-start(%bitcast.22836.0), calls=%async_computation.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.23897.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3874), metadata={scheduling_name="bitcast.23897.0"}
  %custom-call.1139 = (bf16[6144,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23897.0, %bitcast.23899.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1139"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4288 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4288"}
  %bitcast.23138.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4288), metadata={scheduling_name="bitcast.23138.0"}
  %custom-call.1120 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23603.0, %bitcast.23138.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1120"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23859.0 = bf16[1024,32768]{0,1} bitcast(%input_concatenate_fusion.8), metadata={scheduling_name="bitcast.23859.0"}
  %custom-call.1138 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23859.0, %bitcast.23973.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1138"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23971.0 = bf16[1024,32768]{0,1} bitcast(%get-tuple-element.1313.0), metadata={scheduling_name="bitcast.23971.0"}
  %custom-call.1141 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23971.0, %bitcast.23973.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1141"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23935.0 = bf16[6144,32768]{0,1} bitcast(%input_concatenate_fusion.4), metadata={scheduling_name="bitcast.23935.0"}
  %custom-call.1140 = (bf16[6144,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23935.0, %bitcast.23973.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1140"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.10 = bf16[1,4,6144,8,1,2048]{5,4,2,1,0,3} async-done(%all-to-all-start.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.10"}
  %get-tuple-element.3906 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=6, metadata={scheduling_name="get-tuple-element.3906"}
  %bitcast.24182.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3906), metadata={scheduling_name="bitcast.24182.0"}
  %collective-permute-start.4 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24182.0), channel_id=355, source_target_pairs={{8,0},{9,1},{10,2},{11,3},{12,4},{13,5},{14,6},{15,7}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/split" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3995 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=4, metadata={scheduling_name="get-tuple-element.3995"}
  %bitcast.22650.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3995), metadata={scheduling_name="bitcast.22650.0"}
  %bitcast.22641.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.8), metadata={scheduling_name="bitcast.22641.0"}
  %custom-call.1105 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22641.0, %bitcast.22650.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1105"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3994 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=3, metadata={scheduling_name="get-tuple-element.3994"}
  %bitcast.22618.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3994), metadata={scheduling_name="bitcast.22618.0"}
  %custom-call.1104 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22641.0, %bitcast.22618.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1104"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %input_transpose_fusion = bf16[32,2048,6144]{2,1,0} fusion(%all-to-all-done.10), kind=kInput, calls=%fused_transpose.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion" scheduling_name="input_transpose_fusion"}
  %get-tuple-element.3996 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=5, metadata={scheduling_name="get-tuple-element.3996"}
  %bitcast.22847.0 = bf16[6144,16384]{0,1} bitcast(%get-tuple-element.3996), metadata={scheduling_name="bitcast.22847.0"}
  %bitcast.22946.0 = bf16[65536,6144]{1,0} bitcast(%input_transpose_fusion), metadata={scheduling_name="bitcast.22946.0"}
  %custom-call.1112 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22946.0, %bitcast.22847.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1112"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3792.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1121), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3792.0"}
  %input_concatenate_fusion.11 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3792.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.11"}
  %get-tuple-element.3783.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1112), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3783.0"}
  %get-tuple-element.3778.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1105), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3778.0"}
  %get-tuple-element.3777.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1104), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3777.0"}
  %loop_convert_fusion.9 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) fusion(%get-tuple-element.3783.0, %get-tuple-element.3777.0, %get-tuple-element.3778.0), kind=kLoop, calls=%fused_convert.9, metadata={scheduling_name="loop_convert_fusion.9"}
  %get-tuple-element.3791.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1120), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3791.0"}
  %input_concatenate_fusion.7 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3791.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.7"}
  %bitcast.22668.0 = bf16[16384,6144]{1,0} bitcast(%get-tuple-element.3996), metadata={scheduling_name="bitcast.22668.0"}
  %get-tuple-element.3865 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=2, metadata={scheduling_name="get-tuple-element.3865"}
  %bitcast.22659.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3865), metadata={scheduling_name="bitcast.22659.0"}
  %custom-call.1108 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22659.0, %bitcast.22668.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1108"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.4 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/split" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-done.4"}
  %get-tuple-element.3779.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1108), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3779.0"}
  %bitcast.22672.0 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} bitcast(%get-tuple-element.3779.0), metadata={scheduling_name="bitcast.22672.0"}
  %all-to-all-start.9 = ((bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}), bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2}) async-start(%bitcast.22672.0), calls=%async_computation.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3918 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3918"}
  %get-tuple-element.3920 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=0, metadata={scheduling_name="get-tuple-element.3920"}
  %loop_dynamic_update_slice_fusion.15 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4600, %get-tuple-element.3920, %input_reduce_fusion.16, %get-tuple-element.3918, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.15"}
  %bitcast.22944.0 = bf16[16384,65536]{0,1} bitcast(%get-tuple-element.3865), metadata={scheduling_name="bitcast.22944.0"}
  %custom-call.1117 = (bf16[16384,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22944.0, %bitcast.22946.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1117"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22906.0 = bf16[6144,65536]{0,1} bitcast(%all-to-all-done.8), metadata={scheduling_name="bitcast.22906.0"}
  %get-tuple-element.3864 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=1, metadata={scheduling_name="get-tuple-element.3864"}
  %bitcast.23001.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3864), metadata={scheduling_name="bitcast.23001.0"}
  %custom-call.1113 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22906.0, %bitcast.23001.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1113"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23005.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3994), metadata={scheduling_name="bitcast.23005.0"}
  %custom-call.1118 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23001.0, %bitcast.23005.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1118"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22999.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3995), metadata={scheduling_name="bitcast.22999.0"}
  %get-tuple-element.3863 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=0, metadata={scheduling_name="get-tuple-element.3863"}
  %bitcast.22995.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3863), metadata={scheduling_name="bitcast.22995.0"}
  %get-tuple-element.3787.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1118), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3787.0"}
  %cublas-lt-matmul.21 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22995.0, %bitcast.22999.0, %get-tuple-element.3787.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="cublas-lt-matmul.21"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.9 = bf16[1,1,8,4,2048,6144]{5,4,3,1,0,2} async-done(%all-to-all-start.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.9"}
  %get-tuple-element.3788.0 = bf16[65536,6144]{1,0} get-tuple-element(%cublas-lt-matmul.21), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3788.0"}
  %bitcast.23011.0 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} bitcast(%get-tuple-element.3788.0), metadata={scheduling_name="bitcast.23011.0"}
  %all-to-all-start.11 = ((bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1}), bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1}) async-start(%bitcast.23011.0), calls=%async_computation.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.11"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %custom-call.1114 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22906.0, %bitcast.22995.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1114"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3999 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=8, metadata={scheduling_name="get-tuple-element.3999"}
  %get-tuple-element.3786.0 = bf16[16384,6144]{1,0} get-tuple-element(%custom-call.1117), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3786.0"}
  %loop_dynamic_update_slice_fusion.19 = bf16[2,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4589, %get-tuple-element.3786.0, %get-tuple-element.3999, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.19, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.19" scheduling_name="loop_dynamic_update_slice_fusion.19"}
  %input_transpose_fusion.2 = bf16[4,6144,8,2048]{3,2,1,0} fusion(%all-to-all-done.9), kind=kInput, calls=%fused_transpose.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion.2" scheduling_name="input_transpose_fusion.2"}
  %get-tuple-element.3997 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=6, metadata={scheduling_name="get-tuple-element.3997"}
  %get-tuple-element.3784.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1113), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3784.0"}
  %loop_dynamic_update_slice_fusion.17 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4587, %get-tuple-element.3997, %get-tuple-element.3784.0, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.17"}
  %bitcast.22428.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.13), metadata={scheduling_name="bitcast.22428.0"}
  %bitcast.22679.0 = bf16[4,6144,16384]{2,1,0} bitcast(%input_transpose_fusion.2), metadata={scheduling_name="bitcast.22679.0"}
  %custom-call.1109 = (bf16[4,8192,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.22428.0, %bitcast.22679.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1109"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3998 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=7, metadata={scheduling_name="get-tuple-element.3998"}
  %get-tuple-element.3785.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1114), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3785.0"}
  %loop_dynamic_update_slice_fusion.18 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4588, %get-tuple-element.3998, %get-tuple-element.3785.0, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.18"}
  %get-tuple-element.3780.0 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%custom-call.1109), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3780.0"}
  %input_transpose_fusion.1 = bf16[4,16392,8192]{2,1,0} fusion(%get-tuple-element.3780.0), kind=kInput, calls=%fused_transpose.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 deduplicated_name="input_transpose_fusion.1" scheduling_name="input_transpose_fusion.1"}
  %input_reduce_fusion.13 = bf16[4,8,8192]{2,1,0} fusion(%get-tuple-element.3892, %input_transpose_fusion.1), kind=kInput, calls=%fused_reduce.13, metadata={deduplicated_name="input_reduce_fusion.13" scheduling_name="input_reduce_fusion.13"}
  %all-to-all-done.11 = bf16[1,8,4,1,2048,6144]{5,4,3,2,0,1} async-done(%all-to-all-start.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.11"}
  %collective-permute-start.5 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24182.0), channel_id=356, source_target_pairs={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="collective-permute-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_select_fusion.1 = bf16[1,4,8192,2]{3,2,1,0} fusion(%loop_compare_fusion.6, %get-tuple-element.1277.0, %get-tuple-element.3894, %input_reduce_fusion.13, %constant_1724_0, /*index=5*/%constant_1705_0, %partition-id.3.0, %constant_1684_0), kind=kLoop, calls=%fused_select.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_select_fusion" scheduling_name="loop_select_fusion.1"}
  %get-tuple-element.3901 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.3901"}
  %input_scatter_fusion.4 = bf16[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.3, %get-tuple-element.3901, %loop_select_fusion.1, %get-tuple-element.3837.0), kind=kInput, calls=%fused_scatter.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 deduplicated_name="input_scatter_fusion.4" scheduling_name="input_scatter_fusion.4"}
  %loop_dynamic_update_slice_fusion.34 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.32, %collective-permute-done.6, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.34, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="loop_dynamic_update_slice_fusion.34"}
  %bitcast.23024.0 = bf16[8,6144]{0,1} bitcast(%get-tuple-element.4287), metadata={scheduling_name="bitcast.23024.0"}
  %bitcast.23020.0 = bf16[32768,8]{1,0} bitcast(%input_scatter_fusion.4), metadata={scheduling_name="bitcast.23020.0"}
  %custom-call.1119 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23020.0, %bitcast.23024.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1119"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"262144","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_transpose_fusion.6 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.11), kind=kLoop, calls=%fused_transpose.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.6" scheduling_name="loop_transpose_fusion.6"}
  %get-tuple-element.3868 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3868"}
  %get-tuple-element.3789.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1119), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3789.0"}
  %bitcast.23028.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3789.0), metadata={scheduling_name="bitcast.23028.0"}
  %bitcast.23018.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.6), metadata={scheduling_name="bitcast.23018.0"}
  %cublas-lt-matmul.22 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.3868, %bitcast.23018.0, %bitcast.23028.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="cublas-lt-matmul.22"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.5 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="collective-permute-done.5"}
  %get-tuple-element.4259 = pred[1]{0} get-tuple-element(%loop_compare_fusion.11), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="get-tuple-element.4259"}
  %get-tuple-element.4258 = pred[1]{0} get-tuple-element(%loop_compare_fusion.11), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="get-tuple-element.4258"}
  %loop_convert_fusion.12 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%collective-permute-done.5, %collective-permute-done.4, %get-tuple-element.4258, %get-tuple-element.4259), kind=kLoop, calls=%fused_convert.12, metadata={scheduling_name="loop_convert_fusion.12"}
  %get-tuple-element.3790.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.22), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3790.0"}
  %input_reduce_fusion.5 = f32[4,8192]{1,0} fusion(%get-tuple-element.3790.0, %get-tuple-element.3754.0, %get-tuple-element.4679, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %copy.806), kind=kInput, calls=%fused_reduce.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="input_reduce_fusion.5" scheduling_name="input_reduce_fusion.5"}
  %loop_multiply_fusion.3 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.7, %input_reduce_fusion.5, %input_reduce_fusion.12), kind=kLoop, calls=%fused_multiply.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.3"}
  %input_add_convert_reduce_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, f32[128,6144]{1,0}) fusion(%loop_multiply_fusion.3, %get-tuple-element.3754.0, %loop_rsqrt_fusion.7, %get-tuple-element.4679, %get-tuple-element.3790.0, /*index=5*/%get-tuple-element.3875, %loop_multiply_fusion.2, %get-tuple-element.4669, %loop_rsqrt_fusion.5, %get-tuple-element.4690, /*index=10*/%constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, %get-tuple-element.3871), kind=kInput, calls=%fused_add_convert_reduce, metadata={scheduling_name="input_add_convert_reduce_fusion"}
  %bitcast.21112.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.21112.0"}
  %custom-call.1110 = (bf16[6144,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21112.0, %bitcast.23020.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1110"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"262144","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23326.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4286), metadata={scheduling_name="bitcast.23326.0"}
  %get-tuple-element.3860 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=0, metadata={scheduling_name="get-tuple-element.3860"}
  %bitcast.23322.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3860), metadata={scheduling_name="bitcast.23322.0"}
  %custom-call.1123 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23322.0, %bitcast.23326.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1123"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23268.0 = u32[2,4]{1,0} bitcast(%loop_dynamic_slice_fusion.23), metadata={scheduling_name="bitcast.23268.0"}
  %bitcast.23259.0 = f32[1,4,48,8192,1]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.17), metadata={scheduling_name="bitcast.23259.0"}
  %bitcast.23272.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.24), metadata={scheduling_name="bitcast.23272.0"}
  %get-tuple-element.3793.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1122), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3793.0"}
  %bitcast.23246.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3793.0), metadata={scheduling_name="bitcast.23246.0"}
  %get-tuple-element.3794.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1123), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3794.0"}
  %bitcast.23330.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%get-tuple-element.3794.0), metadata={scheduling_name="bitcast.23330.0"}
  %custom-call.991 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u8[1616904192]{0}) custom-call(%input_concatenate_fusion.7, %input_concatenate_fusion.11, %bitcast.23246.0, %constant_2088_0, %bitcast.23259.0, /*index=5*/%bitcast.23268.0, %bitcast.23272.0, %bitcast.23330.0, %loop_multiply_fusion.5, %loop_multiply_fusion.5, /*index=10*/%constant_2101_0, %constant_2101_0, %constant_2101_0, %constant_2101_0, %constant_2101_0, /*index=15*/%constant_2101_0), custom_call_target="te_fused_attn_backward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, s32[33]{0}, s32[33]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.991"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.23527.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3860), metadata={scheduling_name="bitcast.23527.0"}
  %custom-call.1129 = (bf16[6144,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23527.0, %bitcast.23529.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1129"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1336.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1336.0"}
  %input_concatenate_fusion.9 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1336.0), kind=kInput, calls=%fused_concatenate.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.8" scheduling_name="input_concatenate_fusion.9"}
  %get-tuple-element.1337.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1337.0"}
  %input_concatenate_fusion.5 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1337.0), kind=kInput, calls=%fused_concatenate.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.4" scheduling_name="input_concatenate_fusion.5"}
  %bitcast.23488.0 = bf16[1024,32768]{0,1} bitcast(%input_concatenate_fusion.9), metadata={scheduling_name="bitcast.23488.0"}
  %custom-call.1128 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23488.0, %bitcast.23603.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1128"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1335.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1335.0"}
  %bitcast.23601.0 = bf16[1024,32768]{0,1} bitcast(%get-tuple-element.1335.0), metadata={scheduling_name="bitcast.23601.0"}
  %custom-call.1131 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23601.0, %bitcast.23603.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1131"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23384.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4289), metadata={scheduling_name="bitcast.23384.0"}
  %bitcast.23380.0 = bf16[32768,1024]{1,0} bitcast(%input_concatenate_fusion.9), metadata={scheduling_name="bitcast.23380.0"}
  %custom-call.1126 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23380.0, %bitcast.23384.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1126"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23431.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4288), metadata={scheduling_name="bitcast.23431.0"}
  %bitcast.23427.0 = bf16[32768,6144]{1,0} bitcast(%input_concatenate_fusion.5), metadata={scheduling_name="bitcast.23427.0"}
  %custom-call.1127 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23427.0, %bitcast.23431.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1127"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23342.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4290), metadata={scheduling_name="bitcast.23342.0"}
  %bitcast.23338.0 = bf16[32768,1024]{1,0} bitcast(%get-tuple-element.1335.0), metadata={scheduling_name="bitcast.23338.0"}
  %get-tuple-element.3795.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1126), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3795.0"}
  %cublas-lt-matmul.23 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23338.0, %bitcast.23342.0, %get-tuple-element.3795.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.23"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23565.0 = bf16[6144,32768]{0,1} bitcast(%input_concatenate_fusion.5), metadata={scheduling_name="bitcast.23565.0"}
  %custom-call.1130 = (bf16[6144,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23565.0, %bitcast.23603.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1130"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3797.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1127), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3797.0"}
  %get-tuple-element.3796.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.23), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3796.0"}
  %input_convert_reduce_fusion = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}) fusion(%get-tuple-element.4665, %copy.806, %get-tuple-element.4680, %constant_1625_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4673, %get-tuple-element.3797.0, %get-tuple-element.3796.0), kind=kInput, calls=%fused_convert_reduce, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_convert_reduce_fusion"}
  %get-tuple-element.3862 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=2, metadata={scheduling_name="get-tuple-element.3862"}
  %input_reduce_fusion.18 = bf16[6144]{0} fusion(%get-tuple-element.3862), kind=kInput, calls=%fused_reduce.18, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.18"}
  %get-tuple-element.3858 = f32[4,8192]{1,0} get-tuple-element(%input_convert_reduce_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3858"}
  %loop_multiply_fusion.4 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.4, %get-tuple-element.3858, %input_reduce_fusion.6), kind=kLoop, calls=%fused_multiply.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.4"}
  %get-tuple-element.3869 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=3, metadata={scheduling_name="get-tuple-element.3869"}
  %input_reduce_fusion.15 = bf16[6144]{0} fusion(%get-tuple-element.3869), kind=kInput, calls=%fused_reduce.15, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.15"}
  %get-tuple-element.3861 = f32[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=1, metadata={scheduling_name="get-tuple-element.3861"}
  %get-tuple-element.3859 = bf16[32768,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3859"}
  %input_convert_reduce_select_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}) fusion(%loop_compare_fusion.10, %get-tuple-element.3861, %loop_multiply_fusion.4, %get-tuple-element.4665, %loop_rsqrt_fusion.4, /*index=5*/%get-tuple-element.4680, %constant_1625_0, %partition-id.3.0, %get-tuple-element.4673, %copy.806, /*index=10*/%get-tuple-element.3859), kind=kInput, calls=%fused_convert_reduce_select, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="input_convert_reduce_select_fusion"}
  %get-tuple-element.3802.0 = bf16[6144,8]{1,0} get-tuple-element(%custom-call.1132), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3802.0"}
  %bitcast.32033 = bf16[6144,1,8]{2,1,0} bitcast(%get-tuple-element.3802.0), metadata={scheduling_name="bitcast.32033"}
  %get-tuple-element.3807.0 = bf16[6144,6144]{1,0} get-tuple-element(%custom-call.1139), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3807.0"}
  %bitcast.32035 = bf16[6144,1,48,128]{3,2,1,0} bitcast(%get-tuple-element.3807.0), metadata={scheduling_name="bitcast.32035"}
  %get-tuple-element.3806.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1138), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3806.0"}
  %bitcast.32034 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3806.0), metadata={scheduling_name="bitcast.32034"}
  %get-tuple-element.3809.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1141), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3809.0"}
  %bitcast.32037 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3809.0), metadata={scheduling_name="bitcast.32037"}
  %get-tuple-element.3808.0 = bf16[6144,6144]{0,1} get-tuple-element(%custom-call.1140), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3808.0"}
  %bitcast.32036 = bf16[6144,48,128,1]{2,1,3,0} bitcast(%get-tuple-element.3808.0), metadata={scheduling_name="bitcast.32036"}
  %get-tuple-element.3781.0 = bf16[6144,8]{1,0} get-tuple-element(%custom-call.1110), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3781.0"}
  %bitcast.32028 = bf16[6144,1,8]{2,1,0} bitcast(%get-tuple-element.3781.0), metadata={scheduling_name="bitcast.32028"}
  %get-tuple-element.3799.0 = bf16[6144,6144]{1,0} get-tuple-element(%custom-call.1129), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3799.0"}
  %bitcast.32030 = bf16[6144,1,48,128]{3,2,1,0} bitcast(%get-tuple-element.3799.0), metadata={scheduling_name="bitcast.32030"}
  %get-tuple-element.3798.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1128), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3798.0"}
  %bitcast.32029 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3798.0), metadata={scheduling_name="bitcast.32029"}
  %get-tuple-element.3801.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1131), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3801.0"}
  %bitcast.32032 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3801.0), metadata={scheduling_name="bitcast.32032"}
  %get-tuple-element.3800.0 = bf16[6144,6144]{0,1} get-tuple-element(%custom-call.1130), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3800.0"}
  %bitcast.32031 = bf16[6144,48,128,1]{2,1,3,0} bitcast(%get-tuple-element.3800.0), metadata={scheduling_name="bitcast.32031"}
  %reduce-scatter-start = ((bf16[6144,1,8]{2,1,0}, bf16[6144,8,128,1]{2,1,3,0}, bf16[6144,1,48,128]{3,2,1,0}, bf16[6144,48,128,1]{2,1,3,0}, bf16[6144,8,128,1]{2,1,3,0}, /*index=5*/bf16[6144,1,8]{2,1,0}, bf16[6144,8,128,1]{2,1,3,0}, bf16[6144,1,48,128]{3,2,1,0}, bf16[6144,48,128,1]{2,1,3,0}, bf16[6144,8,128,1]{2,1,3,0}), (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0})) async-start(%bitcast.32028, %bitcast.32029, %bitcast.32030, %bitcast.32031, %bitcast.32032, /*index=5*/%bitcast.32033, %bitcast.32034, %bitcast.32035, %bitcast.32036, %bitcast.32037), calls=%async_computation.12, metadata={scheduling_name="reduce-scatter-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3917 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3917"}
  %get-tuple-element.3856 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.3856"}
  %loop_dynamic_update_slice_fusion.35 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.34, %get-tuple-element.3856, %loop_compare_fusion.10, %get-tuple-element.3917, %get-tuple-element.4673, /*index=5*/%copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.35, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="loop_dynamic_update_slice_fusion.35"}
  %copy.855 = bf16[1,2,4,8192,6144]{4,3,2,1,0} copy(%loop_dynamic_update_slice_fusion.35), metadata={scheduling_name="copy.855"}
  %loop_dynamic_update_slice_fusion.33 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.31, %get-tuple-element.3856, %loop_compare_fusion.10, %get-tuple-element.3917, %get-tuple-element.4673, /*index=5*/%copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.33, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="loop_dynamic_update_slice_fusion.33"}
  %copy.852 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%loop_dynamic_update_slice_fusion.33), metadata={scheduling_name="copy.852"}
  %get-tuple-element.3857 = f32[128,6144]{1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.3857"}
  %input_reduce_fusion.17 = bf16[6144]{0} fusion(%get-tuple-element.3857), kind=kInput, calls=%fused_reduce.17, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.17"}
  %get-tuple-element.3926 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=6, metadata={scheduling_name="get-tuple-element.3926"}
  %loop_dynamic_update_slice_fusion.13 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4590, %get-tuple-element.3926, %input_reduce_fusion.18, %get-tuple-element.3918, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.13, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.13"}
  %get-tuple-element.3925 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=5, metadata={scheduling_name="get-tuple-element.3925"}
  %loop_dynamic_update_slice_fusion.16 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4601, %get-tuple-element.3925, %input_reduce_fusion.15, %get-tuple-element.3918, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.16, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.16"}
  %get-tuple-element.3927 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=7, metadata={scheduling_name="get-tuple-element.3927"}
  %loop_dynamic_update_slice_fusion.14 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4591, %get-tuple-element.3927, %input_reduce_fusion.17, %get-tuple-element.3918, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.14"}
  %reduce-scatter-done = (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}) async-done(%reduce-scatter-start), metadata={scheduling_name="reduce-scatter-done"}
  %get-tuple-element.3921 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=1, metadata={scheduling_name="get-tuple-element.3921"}
  %get-tuple-element.4386 = bf16[768,1,8]{2,1,0} get-tuple-element(%reduce-scatter-done), index=0, metadata={scheduling_name="get-tuple-element.4386"}
  %bitcast.32038 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.4386), metadata={scheduling_name="bitcast.32038"}
  %loop_dynamic_update_slice_fusion.29 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4586, %get-tuple-element.3921, %bitcast.32038, %input_reduce_fusion.19, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.29, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.29" scheduling_name="loop_dynamic_update_slice_fusion.29"}
  %get-tuple-element.3922 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=2, metadata={scheduling_name="get-tuple-element.3922"}
  %get-tuple-element.4391 = bf16[768,1,8]{2,1,0} get-tuple-element(%reduce-scatter-done), index=5, metadata={scheduling_name="get-tuple-element.4391"}
  %bitcast.32043 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.4391), metadata={scheduling_name="bitcast.32043"}
  %loop_dynamic_update_slice_fusion.30 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4596, %get-tuple-element.3922, %bitcast.32043, %input_reduce_fusion.19, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.30, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.29" scheduling_name="loop_dynamic_update_slice_fusion.30"}
  %get-tuple-element.3916 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=7, metadata={scheduling_name="get-tuple-element.3916"}
  %get-tuple-element.4390 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=4, metadata={scheduling_name="get-tuple-element.4390"}
  %bitcast.32042 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4390), metadata={scheduling_name="bitcast.32042"}
  %loop_dynamic_update_slice_fusion.22 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4595, %get-tuple-element.3916, %bitcast.32042, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.22, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.22"}
  %get-tuple-element.3990 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=7, metadata={scheduling_name="get-tuple-element.3990"}
  %get-tuple-element.4389 = bf16[768,48,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=3, metadata={scheduling_name="get-tuple-element.4389"}
  %bitcast.32041 = bf16[1,48,128,768]{2,1,0,3} bitcast(%get-tuple-element.4389), metadata={scheduling_name="bitcast.32041"}
  %loop_dynamic_update_slice_fusion.21 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4594, %get-tuple-element.3990, %bitcast.32041, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.21, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.21" scheduling_name="loop_dynamic_update_slice_fusion.21"}
  %get-tuple-element.3909 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=0, metadata={scheduling_name="get-tuple-element.3909"}
  %get-tuple-element.4392 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=6, metadata={scheduling_name="get-tuple-element.4392"}
  %bitcast.32044 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4392), metadata={scheduling_name="bitcast.32044"}
  %loop_dynamic_update_slice_fusion.26 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4602, %get-tuple-element.3909, %bitcast.32044, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.26, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.26"}
  %get-tuple-element.3989 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=6, metadata={scheduling_name="get-tuple-element.3989"}
  %get-tuple-element.4388 = bf16[768,1,48,128]{3,2,1,0} get-tuple-element(%reduce-scatter-done), index=2, metadata={scheduling_name="get-tuple-element.4388"}
  %bitcast.32040 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.4388), metadata={scheduling_name="bitcast.32040"}
  %loop_dynamic_update_slice_fusion.12 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4593, %get-tuple-element.3989, %bitcast.32040, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.11" scheduling_name="loop_dynamic_update_slice_fusion.12"}
  %get-tuple-element.3929 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.3929"}
  %get-tuple-element.4394 = bf16[768,48,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=8, metadata={scheduling_name="get-tuple-element.4394"}
  %bitcast.32046 = bf16[1,48,128,768]{2,1,0,3} bitcast(%get-tuple-element.4394), metadata={scheduling_name="bitcast.32046"}
  %loop_dynamic_update_slice_fusion.27 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4604, %get-tuple-element.3929, %bitcast.32046, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.27, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.21" scheduling_name="loop_dynamic_update_slice_fusion.27"}
  %get-tuple-element.3928 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.3928"}
  %get-tuple-element.4393 = bf16[768,1,48,128]{3,2,1,0} get-tuple-element(%reduce-scatter-done), index=7, metadata={scheduling_name="get-tuple-element.4393"}
  %bitcast.32045 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.4393), metadata={scheduling_name="bitcast.32045"}
  %loop_dynamic_update_slice_fusion.11 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4603, %get-tuple-element.3928, %bitcast.32045, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.11" scheduling_name="loop_dynamic_update_slice_fusion.11"}
  %get-tuple-element.3910 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=1, metadata={scheduling_name="get-tuple-element.3910"}
  %get-tuple-element.4395 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=9, metadata={scheduling_name="get-tuple-element.4395"}
  %bitcast.32047 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4395), metadata={scheduling_name="bitcast.32047"}
  %loop_dynamic_update_slice_fusion.28 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4605, %get-tuple-element.3910, %bitcast.32047, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.28, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.28"}
  %get-tuple-element.3915 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=6, metadata={scheduling_name="get-tuple-element.3915"}
  %get-tuple-element.4387 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=1, metadata={scheduling_name="get-tuple-element.4387"}
  %bitcast.32039 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4387), metadata={scheduling_name="bitcast.32039"}
  %loop_dynamic_update_slice_fusion.20 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4592, %get-tuple-element.3915, %bitcast.32039, %get-tuple-element.3919, %constant_1625_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4673, %copy.806), kind=kLoop, calls=%fused_dynamic_update_slice.20, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.20"}
  %bitcast.23549.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%loop_dynamic_update_slice_fusion.12), metadata={scheduling_name="bitcast.23549.0"}
  %bitcast.23919.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%loop_dynamic_update_slice_fusion.11), metadata={scheduling_name="bitcast.23919.0"}
  %get-tuple-element.4663 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.4663"}
  ROOT %tuple.667 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%loop_add_fusion.1, %loop_dynamic_update_slice_fusion.29, %loop_dynamic_update_slice_fusion.17, %loop_dynamic_update_slice_fusion.18, %loop_dynamic_update_slice_fusion.19, /*index=5*/%loop_dynamic_update_slice_fusion.13, %loop_dynamic_update_slice_fusion.14, %loop_dynamic_update_slice_fusion.20, %bitcast.23549.0, %loop_dynamic_update_slice_fusion.21, /*index=10*/%loop_dynamic_update_slice_fusion.22, %loop_dynamic_update_slice_fusion.30, %loop_dynamic_update_slice_fusion.23, %loop_dynamic_update_slice_fusion.24, %loop_dynamic_update_slice_fusion.25, /*index=15*/%loop_dynamic_update_slice_fusion.15, %loop_dynamic_update_slice_fusion.16, %loop_dynamic_update_slice_fusion.26, %bitcast.23919.0, %loop_dynamic_update_slice_fusion.27, /*index=20*/%loop_dynamic_update_slice_fusion.28, %copy.852, %loop_convert_fusion.12, %get-tuple-element.4663, %copy.855, /*index=25*/%get-tuple-element.4665, %get-tuple-element.4666, %get-tuple-element.4667, %get-tuple-element.4668, %get-tuple-element.4669, /*index=30*/%get-tuple-element.4670, %get-tuple-element.4671, %get-tuple-element.4672, %get-tuple-element.4673, %get-tuple-element.4674, /*index=35*/%get-tuple-element.4675, %get-tuple-element.4676, %get-tuple-element.4677, %get-tuple-element.4678, %get-tuple-element.4679, /*index=40*/%get-tuple-element.4680, %get-tuple-element.4681, %get-tuple-element.4682, %get-tuple-element.4683, %get-tuple-element.4684, /*index=45*/%get-tuple-element.4685, %get-tuple-element.4686, %get-tuple-element.4687, %get-tuple-element.4688, %get-tuple-element.4689, /*index=50*/%get-tuple-element.4690, %get-tuple-element.4691, %get-tuple-element.4692, %get-tuple-element.4693, %get-tuple-element.4694), metadata={scheduling_name="tuple.667"}
}

%fused_compare (param_0: s32[]) -> pred[] {
  %param_0 = s32[] parameter(0), metadata={scheduling_name="param_0"}
  %constant_1603_1 = s32[] constant(9)
  ROOT %compare.1580.1 = pred[] compare(%param_0, %constant_1603_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="compare.1580.1"}
}

%region_97.4035_spmd (param.2: (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128])) -> pred[] {
  %param.2 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) parameter(0), metadata={scheduling_name="param.2"}
  %get-tuple-element.1265.0 = s32[] get-tuple-element(%param.2), index=0, metadata={scheduling_name="get-tuple-element.1265.0"}
  ROOT %loop_compare_fusion = pred[] fusion(%get-tuple-element.1265.0), kind=kLoop, calls=%fused_compare, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_compare_fusion" scheduling_name="loop_compare_fusion"}
}

%fused_reduce.20 (param_0.5981: f32[768,32768]) -> f32[4096] {
  %param_0.5981 = f32[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5981"}
  %multiply.2984.1 = f32[768,32768]{1,0} multiply(%param_0.5981, %param_0.5981), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2984.1"}
  %bitcast.30063.1 = f32[4096,6144]{1,0} bitcast(%multiply.2984.1), metadata={scheduling_name="bitcast.30063.1"}
  %constant_2882_136 = f32[] constant(0)
  ROOT %reduce.701.1 = f32[4096]{0} reduce(%bitcast.30063.1, %constant_2882_136), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.701.1"}
}

%fused_convert_reduce.2 (param_0.5870: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5870 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5870"}
  %multiply.2979.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5870, %param_0.5870), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2979.1"}
  %bitcast.29977.1 = f32[12288]{0} bitcast(%multiply.2979.1), metadata={scheduling_name="bitcast.29977.1"}
  %constant_2882_25 = f32[] constant(0)
  %reduce.249.1 = f32[] reduce(%bitcast.29977.1, %constant_2882_25), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.249.1"}
  %convert.4800.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5870), metadata={scheduling_name="convert.4800.1"}
  ROOT %tuple.567 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.249.1, %convert.4800.1), metadata={scheduling_name="tuple.567"}
}

%fused_convert_reduce.3 (param_0.5869: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5869 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5869"}
  %multiply.2978.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5869, %param_0.5869), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2978.1"}
  %bitcast.29963.1 = f32[12288]{0} bitcast(%multiply.2978.1), metadata={scheduling_name="bitcast.29963.1"}
  %constant_2882_24 = f32[] constant(0)
  %reduce.248.1 = f32[] reduce(%bitcast.29963.1, %constant_2882_24), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.248.1"}
  %convert.4780.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5869), metadata={scheduling_name="convert.4780.1"}
  ROOT %tuple.571 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.248.1, %convert.4780.1), metadata={scheduling_name="tuple.571"}
}

%fused_reduce.21 (param_0.5858: f32[24576]) -> f32[128] {
  %param_0.5858 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5858"}
  %bitcast.29949.1 = f32[128,192]{1,0} bitcast(%param_0.5858), metadata={scheduling_name="bitcast.29949.1"}
  %constant_2882_13 = f32[] constant(0)
  ROOT %reduce.737.1 = f32[128]{0} reduce(%bitcast.29949.1, %constant_2882_13), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.737.1"}
}

%fused_reduce.22 (param_0.5856: f32[24576]) -> f32[128] {
  %param_0.5856 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5856"}
  %bitcast.29927.1 = f32[128,192]{1,0} bitcast(%param_0.5856), metadata={scheduling_name="bitcast.29927.1"}
  %constant_2882_11 = f32[] constant(0)
  ROOT %reduce.735.1 = f32[128]{0} reduce(%bitcast.29927.1, %constant_2882_11), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.735.1"}
}

%fused_reduce.23 (param_0.5855: f32[24576]) -> f32[128] {
  %param_0.5855 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5855"}
  %bitcast.29905.1 = f32[128,192]{1,0} bitcast(%param_0.5855), metadata={scheduling_name="bitcast.29905.1"}
  %constant_2882_10 = f32[] constant(0)
  ROOT %reduce.733.1 = f32[128]{0} reduce(%bitcast.29905.1, %constant_2882_10), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.733.1"}
}

%fused_convert_reduce.4 (param_0.5865: f32[2,1,768,8]) -> (f32[], bf16[2,1,768,8]) {
  %param_0.5865 = f32[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5865"}
  %multiply.2974.1 = f32[2,1,768,8]{3,2,1,0} multiply(%param_0.5865, %param_0.5865), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2974.1"}
  %bitcast.29883.1 = f32[12288]{0} bitcast(%multiply.2974.1), metadata={scheduling_name="bitcast.29883.1"}
  %constant_2882_20 = f32[] constant(0)
  %reduce.244.1 = f32[] reduce(%bitcast.29883.1, %constant_2882_20), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.244.1"}
  %convert.4682.1 = bf16[2,1,768,8]{3,2,1,0} convert(%param_0.5865), metadata={scheduling_name="convert.4682.1"}
  ROOT %tuple.584 = (f32[], bf16[2,1,768,8]{3,2,1,0}) tuple(%reduce.244.1, %convert.4682.1), metadata={scheduling_name="tuple.584"}
}

%fused_convert_reduce.5 (param_0.5854: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5854 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5854"}
  %multiply.2969.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5854, %param_0.5854), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2969.1"}
  %bitcast.29797.1 = f32[12288]{0} bitcast(%multiply.2969.1), metadata={scheduling_name="bitcast.29797.1"}
  %constant_2882_9 = f32[] constant(0)
  %reduce.239.1 = f32[] reduce(%bitcast.29797.1, %constant_2882_9), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.239.1"}
  %convert.4552.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5854), metadata={scheduling_name="convert.4552.1"}
  ROOT %tuple.601 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.239.1, %convert.4552.1), metadata={scheduling_name="tuple.601"}
}

%fused_convert_reduce.6 (param_0.5857: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5857 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5857"}
  %multiply.2968.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5857, %param_0.5857), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2968.1"}
  %bitcast.29783.1 = f32[12288]{0} bitcast(%multiply.2968.1), metadata={scheduling_name="bitcast.29783.1"}
  %constant_2882_12 = f32[] constant(0)
  %reduce.238.1 = f32[] reduce(%bitcast.29783.1, %constant_2882_12), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.238.1"}
  %convert.4532.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5857), metadata={scheduling_name="convert.4532.1"}
  ROOT %tuple.605 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.238.1, %convert.4532.1), metadata={scheduling_name="tuple.605"}
}

%fused_reduce.24 (param_0.5853: f32[24576]) -> f32[128] {
  %param_0.5853 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5853"}
  %bitcast.29769.1 = f32[128,192]{1,0} bitcast(%param_0.5853), metadata={scheduling_name="bitcast.29769.1"}
  %constant_2882_8 = f32[] constant(0)
  ROOT %reduce.731.1 = f32[128]{0} reduce(%bitcast.29769.1, %constant_2882_8), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.731.1"}
}

%fused_reduce.25 (param_0.5846: f32[24576]) -> f32[128] {
  %param_0.5846 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5846"}
  %bitcast.29747.1 = f32[128,192]{1,0} bitcast(%param_0.5846), metadata={scheduling_name="bitcast.29747.1"}
  %constant_2882_1 = f32[] constant(0)
  ROOT %reduce.729.1 = f32[128]{0} reduce(%bitcast.29747.1, %constant_2882_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.729.1"}
}

%fused_reduce.26 (param_0.5849: f32[24576]) -> f32[128] {
  %param_0.5849 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5849"}
  %bitcast.29725.1 = f32[128,192]{1,0} bitcast(%param_0.5849), metadata={scheduling_name="bitcast.29725.1"}
  %constant_2882_4 = f32[] constant(0)
  ROOT %reduce.727.1 = f32[128]{0} reduce(%bitcast.29725.1, %constant_2882_4), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.727.1"}
}

%fused_convert_reduce.7 (param_0.5929: f32[2,1,768,8]) -> (f32[], bf16[2,1,768,8]) {
  %param_0.5929 = f32[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5929"}
  %multiply.2963.1 = f32[2,1,768,8]{3,2,1,0} multiply(%param_0.5929, %param_0.5929), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2963.1"}
  %bitcast.29703.1 = f32[12288]{0} bitcast(%multiply.2963.1), metadata={scheduling_name="bitcast.29703.1"}
  %constant_2882_84 = f32[] constant(0)
  %reduce.234.1 = f32[] reduce(%bitcast.29703.1, %constant_2882_84), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.234.1"}
  %convert.4452.1 = bf16[2,1,768,8]{3,2,1,0} convert(%param_0.5929), metadata={scheduling_name="convert.4452.1"}
  ROOT %tuple.618 = (f32[], bf16[2,1,768,8]{3,2,1,0}) tuple(%reduce.234.1, %convert.4452.1), metadata={scheduling_name="tuple.618"}
}

%fused_reduce.27 (param_0.5965: f32[8,8192], param_1.6344: f32[65536], param_2.4504: f32[8,8192], param_3.3677: s32[8,8192]) -> f32[256] {
  %param_3.3677 = s32[8,8192]{1,0} parameter(3), metadata={scheduling_name="param_3.3677"}
  %constant_2840_3 = s32[] constant(0)
  %broadcast.5760.5 = s32[8,8192]{1,0} broadcast(%constant_2840_3), dimensions={}, metadata={scheduling_name="broadcast.5760.5"}
  %compare.1723.5 = pred[8,8192]{1,0} compare(%param_3.3677, %broadcast.5760.5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.5"}
  %param_2.4504 = f32[8,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.4504"}
  %negate.230.3 = f32[8,8192]{1,0} negate(%param_2.4504), metadata={op_name="jit(train_step)/jit(main)/neg" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="negate.230.3"}
  %param_0.5965 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5965"}
  %param_1.6344 = f32[65536]{0} parameter(1), metadata={scheduling_name="param_1.6344"}
  %bitcast.26357.24 = f32[8,8192]{1,0} bitcast(%param_1.6344), metadata={scheduling_name="bitcast.26357.24"}
  %add.3013.7 = f32[8,8192]{1,0} add(%param_0.5965, %bitcast.26357.24), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="add.3013.7"}
  %multiply.2957.7 = f32[8,8192]{1,0} multiply(%add.3013.7, %add.3013.7), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=618 scheduling_name="multiply.2957.7"}
  %constant_2882_120 = f32[] constant(0)
  %broadcast.5762.14 = f32[8,8192]{1,0} broadcast(%constant_2882_120), dimensions={}, metadata={scheduling_name="broadcast.5762.14"}
  %multiply.2959.7 = f32[8,8192]{1,0} multiply(%multiply.2957.7, %broadcast.5762.14), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=618 scheduling_name="multiply.2959.7"}
  %add.3183.5 = f32[8,8192]{1,0} add(%negate.230.3, %multiply.2959.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=619 scheduling_name="add.3183.5"}
  %select.1388.3 = f32[8,8192]{1,0} select(%compare.1723.5, %add.3183.5, %broadcast.5762.14), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="select.1388.3"}
  %bitcast.29664.1 = f32[256,256]{1,0} bitcast(%select.1388.3), metadata={scheduling_name="bitcast.29664.1"}
  ROOT %reduce.669.1 = f32[256]{0} reduce(%bitcast.29664.1, %constant_2882_120), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="reduce.669.1"}
}

%fused_reduce.28 (param_0.5963: bf16[768,32768]) -> f32[4096] {
  %param_0.5963 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5963"}
  %convert.4890.4 = f32[768,32768]{1,0} convert(%param_0.5963), metadata={scheduling_name="convert.4890.4"}
  %multiply.2950.3 = f32[768,32768]{1,0} multiply(%convert.4890.4, %convert.4890.4), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2950.3"}
  %bitcast.29616.1 = f32[4096,6144]{1,0} bitcast(%multiply.2950.3), metadata={scheduling_name="bitcast.29616.1"}
  %constant_2882_118 = f32[] constant(0)
  ROOT %reduce.665.1 = f32[4096]{0} reduce(%bitcast.29616.1, %constant_2882_118), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.665.1"}
}

%fused_reduce.29 (param_0.5851: f32[24576]) -> f32[128] {
  %param_0.5851 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5851"}
  %bitcast.29509.1 = f32[128,192]{1,0} bitcast(%param_0.5851), metadata={scheduling_name="bitcast.29509.1"}
  %constant_2882_6 = f32[] constant(0)
  ROOT %reduce.725.1 = f32[128]{0} reduce(%bitcast.29509.1, %constant_2882_6), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.725.1"}
}

%fused_reduce.30 (param_0.5852: f32[24576]) -> f32[128] {
  %param_0.5852 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5852"}
  %bitcast.29488.1 = f32[128,192]{1,0} bitcast(%param_0.5852), metadata={scheduling_name="bitcast.29488.1"}
  %constant_2882_7 = f32[] constant(0)
  ROOT %reduce.723.1 = f32[128]{0} reduce(%bitcast.29488.1, %constant_2882_7), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.723.1"}
}

%fused_reduce.31 (param_0.5850: f32[24576]) -> f32[128] {
  %param_0.5850 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5850"}
  %bitcast.29467.1 = f32[128,192]{1,0} bitcast(%param_0.5850), metadata={scheduling_name="bitcast.29467.1"}
  %constant_2882_5 = f32[] constant(0)
  ROOT %reduce.721.1 = f32[128]{0} reduce(%bitcast.29467.1, %constant_2882_5), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.721.1"}
}

%fused_reduce.32 (param_0.5990: f32[24576]) -> f32[128] {
  %param_0.5990 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5990"}
  %bitcast.29339.1 = f32[128,192]{1,0} bitcast(%param_0.5990), metadata={scheduling_name="bitcast.29339.1"}
  %constant_2882_145 = f32[] constant(0)
  ROOT %reduce.719.1 = f32[128]{0} reduce(%bitcast.29339.1, %constant_2882_145), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.719.1"}
}

%fused_reduce.33 (param_0.5989: f32[24576]) -> f32[128] {
  %param_0.5989 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5989"}
  %bitcast.29318.1 = f32[128,192]{1,0} bitcast(%param_0.5989), metadata={scheduling_name="bitcast.29318.1"}
  %constant_2882_144 = f32[] constant(0)
  ROOT %reduce.717.1 = f32[128]{0} reduce(%bitcast.29318.1, %constant_2882_144), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.717.1"}
}

%fused_reduce.34 (param_0.5988: f32[24576]) -> f32[128] {
  %param_0.5988 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5988"}
  %bitcast.29297.1 = f32[128,192]{1,0} bitcast(%param_0.5988), metadata={scheduling_name="bitcast.29297.1"}
  %constant_2882_143 = f32[] constant(0)
  ROOT %reduce.715.1 = f32[128]{0} reduce(%bitcast.29297.1, %constant_2882_143), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.715.1"}
}

%fused_transpose.20 (param_0.4851: f32[], param_1.5171: bf16[2,1,48,128,768], param_2.3699: pred[]) -> bf16[2,1,48,128,768] {
  %param_2.3699 = pred[] parameter(2), metadata={scheduling_name="param_2.3699"}
  %broadcast.5887.1 = pred[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_2.3699), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5887.1"}
  %param_1.5171 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(1), metadata={scheduling_name="param_1.5171"}
  %bitcast.28773.3 = bf16[2,768,6144]{2,1,0} bitcast(%param_1.5171), metadata={scheduling_name="bitcast.28773.3"}
  %transpose.775.3 = bf16[2,6144,768]{2,1,0} transpose(%bitcast.28773.3), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="transpose.775.3"}
  %bitcast.28778.1 = bf16[2,1,48,128,768]{4,3,2,1,0} bitcast(%transpose.775.3), metadata={scheduling_name="bitcast.28778.1"}
  %convert.4823.5 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%bitcast.28778.1), metadata={scheduling_name="convert.4823.5"}
  %param_0.4851 = f32[] parameter(0), metadata={scheduling_name="param_0.4851"}
  %broadcast.6196.10 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_0.4851), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6196.10"}
  %divide.535.5 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%convert.4823.5, %broadcast.6196.10), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.535.5"}
  %convert.4825.3 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%divide.535.5), metadata={scheduling_name="convert.4825.3"}
  ROOT %select.1382.1 = bf16[2,1,48,128,768]{4,3,2,1,0} select(%broadcast.5887.1, %bitcast.28778.1, %convert.4825.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1382.1"}
}

%fused_transpose.21 (param_0.4852: f32[], param_1.5172: bf16[2,1,48,128,768], param_2.3700: pred[]) -> bf16[2,1,48,128,768] {
  %param_2.3700 = pred[] parameter(2), metadata={scheduling_name="param_2.3700"}
  %broadcast.5887.2 = pred[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_2.3700), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5887.2"}
  %param_1.5172 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(1), metadata={scheduling_name="param_1.5172"}
  %bitcast.27940.3 = bf16[2,768,6144]{2,1,0} bitcast(%param_1.5172), metadata={scheduling_name="bitcast.27940.3"}
  %transpose.774.3 = bf16[2,6144,768]{2,1,0} transpose(%bitcast.27940.3), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="transpose.774.3"}
  %bitcast.27945.1 = bf16[2,1,48,128,768]{4,3,2,1,0} bitcast(%transpose.774.3), metadata={scheduling_name="bitcast.27945.1"}
  %convert.4575.5 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%bitcast.27945.1), metadata={scheduling_name="convert.4575.5"}
  %param_0.4852 = f32[] parameter(0), metadata={scheduling_name="param_0.4852"}
  %broadcast.6196.8 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_0.4852), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6196.8"}
  %divide.505.5 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%convert.4575.5, %broadcast.6196.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.505.5"}
  %convert.4577.3 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%divide.505.5), metadata={scheduling_name="convert.4577.3"}
  ROOT %select.1372.1 = bf16[2,1,48,128,768]{4,3,2,1,0} select(%broadcast.5887.2, %bitcast.27945.1, %convert.4577.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1372.1"}
}

%fused_reduce.35 (param_0.5947: bf16[32768,768]) -> f32[4096] {
  %param_0.5947 = bf16[32768,768]{0,1} parameter(0), metadata={scheduling_name="param_0.5947"}
  %bitcast.27125.10 = bf16[768,32768]{1,0} bitcast(%param_0.5947), metadata={scheduling_name="bitcast.27125.10"}
  %convert.4388.9 = f32[768,32768]{1,0} convert(%bitcast.27125.10), metadata={scheduling_name="convert.4388.9"}
  %multiply.2764.3 = f32[768,32768]{1,0} multiply(%convert.4388.9, %convert.4388.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2764.3"}
  %bitcast.27135.1 = f32[4096,6144]{1,0} bitcast(%multiply.2764.3), metadata={scheduling_name="bitcast.27135.1"}
  %constant_2882_102 = f32[] constant(0)
  ROOT %reduce.633.1 = f32[4096]{0} reduce(%bitcast.27135.1, %constant_2882_102), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.633.1"}
}

%fused_reduce.36 (param_0.5946: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5946 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5946"}
  %convert.4386.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5946), metadata={scheduling_name="convert.4386.4"}
  %multiply.2763.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4386.4, %convert.4386.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2763.3"}
  %bitcast.27093.1 = f32[1024,1536]{1,0} bitcast(%multiply.2763.3), metadata={scheduling_name="bitcast.27093.1"}
  %constant_2882_101 = f32[] constant(0)
  ROOT %reduce.631.1 = f32[1024]{0} reduce(%bitcast.27093.1, %constant_2882_101), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.631.1"}
}

%fused_reduce.37 (param_0.5945: bf16[2,1,768,48,128]) -> f32[2048] {
  %param_0.5945 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5945"}
  %convert.4384.6 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.5945), metadata={scheduling_name="convert.4384.6"}
  %multiply.2762.3 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4384.6, %convert.4384.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2762.3"}
  %bitcast.27071.1 = f32[2048,4608]{1,0} bitcast(%multiply.2762.3), metadata={scheduling_name="bitcast.27071.1"}
  %constant_2882_100 = f32[] constant(0)
  ROOT %reduce.629.1 = f32[2048]{0} reduce(%bitcast.27071.1, %constant_2882_100), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.629.1"}
}

%fused_reduce.38 (param_0.5944: bf16[2,1,48,128,768]) -> f32[2048] {
  %param_0.5944 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.5944"}
  %bitcast.27037.3 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.5944), metadata={scheduling_name="bitcast.27037.3"}
  %convert.4382.3 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%bitcast.27037.3), metadata={scheduling_name="convert.4382.3"}
  %multiply.2761.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4382.3, %convert.4382.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2761.1"}
  %bitcast.27049.1 = f32[2048,4608]{1,0} bitcast(%multiply.2761.1), metadata={scheduling_name="bitcast.27049.1"}
  %constant_2882_99 = f32[] constant(0)
  ROOT %reduce.627.1 = f32[2048]{0} reduce(%bitcast.27049.1, %constant_2882_99), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.627.1"}
}

%fused_reduce.39 (param_0.5943: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5943 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5943"}
  %convert.4380.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5943), metadata={scheduling_name="convert.4380.4"}
  %multiply.2760.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4380.4, %convert.4380.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2760.3"}
  %bitcast.27025.1 = f32[1024,1536]{1,0} bitcast(%multiply.2760.3), metadata={scheduling_name="bitcast.27025.1"}
  %constant_2882_98 = f32[] constant(0)
  ROOT %reduce.625.1 = f32[1024]{0} reduce(%bitcast.27025.1, %constant_2882_98), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.625.1"}
}

%fused_reduce.40 (param_0.5893: bf16[2,1,6144]) -> f32[] {
  %param_0.5893 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5893"}
  %convert.4378.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5893), metadata={scheduling_name="convert.4378.4"}
  %multiply.2759.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4378.4, %convert.4378.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2759.3"}
  %bitcast.27005.1 = f32[12288]{0} bitcast(%multiply.2759.3), metadata={scheduling_name="bitcast.27005.1"}
  %constant_2882_48 = f32[] constant(0)
  ROOT %reduce.201.1 = f32[] reduce(%bitcast.27005.1, %constant_2882_48), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.201.1"}
}

%fused_reduce.41 (param_0.5892: bf16[2,1,6144]) -> f32[] {
  %param_0.5892 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5892"}
  %convert.4376.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5892), metadata={scheduling_name="convert.4376.4"}
  %multiply.2758.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4376.4, %convert.4376.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2758.3"}
  %bitcast.26985.1 = f32[12288]{0} bitcast(%multiply.2758.3), metadata={scheduling_name="bitcast.26985.1"}
  %constant_2882_47 = f32[] constant(0)
  ROOT %reduce.200.1 = f32[] reduce(%bitcast.26985.1, %constant_2882_47), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.200.1"}
}

%fused_reduce.42 (param_0.5987: f32[24576]) -> f32[128] {
  %param_0.5987 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5987"}
  %bitcast.26965.1 = f32[128,192]{1,0} bitcast(%param_0.5987), metadata={scheduling_name="bitcast.26965.1"}
  %constant_2882_142 = f32[] constant(0)
  ROOT %reduce.713.1 = f32[128]{0} reduce(%bitcast.26965.1, %constant_2882_142), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.713.1"}
}

%fused_reduce.43 (param_0.5942: bf16[2,1,1,16384,6144]) -> f32[24576] {
  %param_0.5942 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5942"}
  %convert.4374.6 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.5942), metadata={scheduling_name="convert.4374.6"}
  %multiply.2757.3 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4374.6, %convert.4374.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2757.3"}
  %bitcast.26959.1 = f32[24576,8192]{1,0} bitcast(%multiply.2757.3), metadata={scheduling_name="bitcast.26959.1"}
  %constant_2882_97 = f32[] constant(0)
  ROOT %reduce.623.1 = f32[24576]{0} reduce(%bitcast.26959.1, %constant_2882_97), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.623.1"}
}

%fused_reduce.44 (param_0.5986: f32[24576]) -> f32[128] {
  %param_0.5986 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5986"}
  %bitcast.26939.1 = f32[128,192]{1,0} bitcast(%param_0.5986), metadata={scheduling_name="bitcast.26939.1"}
  %constant_2882_141 = f32[] constant(0)
  ROOT %reduce.711.1 = f32[128]{0} reduce(%bitcast.26939.1, %constant_2882_141), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.711.1"}
}

%fused_reduce.45 (param_0.5941: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5941 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5941"}
  %convert.4372.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5941), metadata={scheduling_name="convert.4372.6"}
  %multiply.2756.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4372.6, %convert.4372.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2756.3"}
  %bitcast.26933.1 = f32[24576,8192]{1,0} bitcast(%multiply.2756.3), metadata={scheduling_name="bitcast.26933.1"}
  %constant_2882_96 = f32[] constant(0)
  ROOT %reduce.621.1 = f32[24576]{0} reduce(%bitcast.26933.1, %constant_2882_96), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.621.1"}
}

%fused_reduce.46 (param_0.5985: f32[24576]) -> f32[128] {
  %param_0.5985 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5985"}
  %bitcast.26913.1 = f32[128,192]{1,0} bitcast(%param_0.5985), metadata={scheduling_name="bitcast.26913.1"}
  %constant_2882_140 = f32[] constant(0)
  ROOT %reduce.709.1 = f32[128]{0} reduce(%bitcast.26913.1, %constant_2882_140), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.709.1"}
}

%fused_reduce.47 (param_0.5940: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5940 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5940"}
  %convert.4370.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5940), metadata={scheduling_name="convert.4370.6"}
  %multiply.2755.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4370.6, %convert.4370.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2755.3"}
  %bitcast.26907.1 = f32[24576,8192]{1,0} bitcast(%multiply.2755.3), metadata={scheduling_name="bitcast.26907.1"}
  %constant_2882_95 = f32[] constant(0)
  ROOT %reduce.619.1 = f32[24576]{0} reduce(%bitcast.26907.1, %constant_2882_95), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.619.1"}
}

%fused_reduce.48 (param_0.5888: bf16[2,1,768,8]) -> f32[] {
  %param_0.5888 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5888"}
  %convert.4368.4 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5888), metadata={scheduling_name="convert.4368.4"}
  %multiply.2754.3 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4368.4, %convert.4368.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2754.3"}
  %bitcast.26887.1 = f32[12288]{0} bitcast(%multiply.2754.3), metadata={scheduling_name="bitcast.26887.1"}
  %constant_2882_43 = f32[] constant(0)
  ROOT %reduce.196.1 = f32[] reduce(%bitcast.26887.1, %constant_2882_43), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.196.1"}
}

%fused_reduce.49 (param_0.5939: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5939 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5939"}
  %convert.4366.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5939), metadata={scheduling_name="convert.4366.4"}
  %multiply.2753.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4366.4, %convert.4366.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2753.3"}
  %bitcast.26867.1 = f32[1024,1536]{1,0} bitcast(%multiply.2753.3), metadata={scheduling_name="bitcast.26867.1"}
  %constant_2882_94 = f32[] constant(0)
  ROOT %reduce.617.1 = f32[1024]{0} reduce(%bitcast.26867.1, %constant_2882_94), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.617.1"}
}

%fused_reduce.50 (param_0.5938: bf16[2,1,768,48,128]) -> f32[2048] {
  %param_0.5938 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5938"}
  %convert.4364.6 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.5938), metadata={scheduling_name="convert.4364.6"}
  %multiply.2752.3 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4364.6, %convert.4364.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2752.3"}
  %bitcast.26845.1 = f32[2048,4608]{1,0} bitcast(%multiply.2752.3), metadata={scheduling_name="bitcast.26845.1"}
  %constant_2882_93 = f32[] constant(0)
  ROOT %reduce.615.1 = f32[2048]{0} reduce(%bitcast.26845.1, %constant_2882_93), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.615.1"}
}

%fused_reduce.51 (param_0.5937: bf16[2,1,48,128,768]) -> f32[2048] {
  %param_0.5937 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.5937"}
  %bitcast.26811.3 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.5937), metadata={scheduling_name="bitcast.26811.3"}
  %convert.4362.3 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%bitcast.26811.3), metadata={scheduling_name="convert.4362.3"}
  %multiply.2751.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4362.3, %convert.4362.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2751.1"}
  %bitcast.26823.1 = f32[2048,4608]{1,0} bitcast(%multiply.2751.1), metadata={scheduling_name="bitcast.26823.1"}
  %constant_2882_92 = f32[] constant(0)
  ROOT %reduce.613.1 = f32[2048]{0} reduce(%bitcast.26823.1, %constant_2882_92), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.613.1"}
}

%fused_reduce.52 (param_0.5936: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5936 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5936"}
  %convert.4360.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5936), metadata={scheduling_name="convert.4360.4"}
  %multiply.2750.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4360.4, %convert.4360.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2750.3"}
  %bitcast.26799.1 = f32[1024,1536]{1,0} bitcast(%multiply.2750.3), metadata={scheduling_name="bitcast.26799.1"}
  %constant_2882_91 = f32[] constant(0)
  ROOT %reduce.611.1 = f32[1024]{0} reduce(%bitcast.26799.1, %constant_2882_91), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.611.1"}
}

%fused_reduce.53 (param_0.5883: bf16[2,1,6144]) -> f32[] {
  %param_0.5883 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5883"}
  %convert.4358.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5883), metadata={scheduling_name="convert.4358.4"}
  %multiply.2749.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4358.4, %convert.4358.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2749.3"}
  %bitcast.26779.1 = f32[12288]{0} bitcast(%multiply.2749.3), metadata={scheduling_name="bitcast.26779.1"}
  %constant_2882_38 = f32[] constant(0)
  ROOT %reduce.191.1 = f32[] reduce(%bitcast.26779.1, %constant_2882_38), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.191.1"}
}

%fused_reduce.54 (param_0.5882: bf16[2,1,6144]) -> f32[] {
  %param_0.5882 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5882"}
  %convert.4356.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5882), metadata={scheduling_name="convert.4356.4"}
  %multiply.2748.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4356.4, %convert.4356.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2748.3"}
  %bitcast.26759.1 = f32[12288]{0} bitcast(%multiply.2748.3), metadata={scheduling_name="bitcast.26759.1"}
  %constant_2882_37 = f32[] constant(0)
  ROOT %reduce.190.1 = f32[] reduce(%bitcast.26759.1, %constant_2882_37), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.190.1"}
}

%fused_reduce.55 (param_0.5984: f32[24576]) -> f32[128] {
  %param_0.5984 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5984"}
  %bitcast.26739.1 = f32[128,192]{1,0} bitcast(%param_0.5984), metadata={scheduling_name="bitcast.26739.1"}
  %constant_2882_139 = f32[] constant(0)
  ROOT %reduce.707.1 = f32[128]{0} reduce(%bitcast.26739.1, %constant_2882_139), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.707.1"}
}

%fused_reduce.56 (param_0.5935: bf16[2,1,1,16384,6144]) -> f32[24576] {
  %param_0.5935 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5935"}
  %convert.4354.6 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.5935), metadata={scheduling_name="convert.4354.6"}
  %multiply.2747.3 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4354.6, %convert.4354.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2747.3"}
  %bitcast.26733.1 = f32[24576,8192]{1,0} bitcast(%multiply.2747.3), metadata={scheduling_name="bitcast.26733.1"}
  %constant_2882_90 = f32[] constant(0)
  ROOT %reduce.609.1 = f32[24576]{0} reduce(%bitcast.26733.1, %constant_2882_90), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.609.1"}
}

%fused_reduce.57 (param_0.5983: f32[24576]) -> f32[128] {
  %param_0.5983 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5983"}
  %bitcast.26713.1 = f32[128,192]{1,0} bitcast(%param_0.5983), metadata={scheduling_name="bitcast.26713.1"}
  %constant_2882_138 = f32[] constant(0)
  ROOT %reduce.705.1 = f32[128]{0} reduce(%bitcast.26713.1, %constant_2882_138), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.705.1"}
}

%fused_reduce.58 (param_0.5934: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5934 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5934"}
  %convert.4352.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5934), metadata={scheduling_name="convert.4352.6"}
  %multiply.2746.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4352.6, %convert.4352.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2746.3"}
  %bitcast.26707.1 = f32[24576,8192]{1,0} bitcast(%multiply.2746.3), metadata={scheduling_name="bitcast.26707.1"}
  %constant_2882_89 = f32[] constant(0)
  ROOT %reduce.607.1 = f32[24576]{0} reduce(%bitcast.26707.1, %constant_2882_89), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.607.1"}
}

%fused_reduce.59 (param_0.5982: f32[24576]) -> f32[128] {
  %param_0.5982 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5982"}
  %bitcast.26687.1 = f32[128,192]{1,0} bitcast(%param_0.5982), metadata={scheduling_name="bitcast.26687.1"}
  %constant_2882_137 = f32[] constant(0)
  ROOT %reduce.703.1 = f32[128]{0} reduce(%bitcast.26687.1, %constant_2882_137), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.703.1"}
}

%fused_reduce.60 (param_0.5933: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5933 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5933"}
  %convert.4350.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5933), metadata={scheduling_name="convert.4350.6"}
  %multiply.2745.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4350.6, %convert.4350.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2745.3"}
  %bitcast.26681.1 = f32[24576,8192]{1,0} bitcast(%multiply.2745.3), metadata={scheduling_name="bitcast.26681.1"}
  %constant_2882_88 = f32[] constant(0)
  ROOT %reduce.605.1 = f32[24576]{0} reduce(%bitcast.26681.1, %constant_2882_88), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.605.1"}
}

%fused_reduce.61 (param_0.5878: bf16[2,1,768,8]) -> f32[] {
  %param_0.5878 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5878"}
  %convert.4348.4 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5878), metadata={scheduling_name="convert.4348.4"}
  %multiply.2744.3 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4348.4, %convert.4348.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2744.3"}
  %bitcast.26663.1 = f32[12288]{0} bitcast(%multiply.2744.3), metadata={scheduling_name="bitcast.26663.1"}
  %constant_2882_33 = f32[] constant(0)
  ROOT %reduce.186.1 = f32[] reduce(%bitcast.26663.1, %constant_2882_33), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.186.1"}
}

%fused_scatter.10 (param_0.3548: bf16[2,1,4,8192,6144], param_1.3718: s32[2,1], param_2.2812: bf16[1,2,1,4,8192,6144]) -> bf16[2,1,4,8192,6144] {
  %param_0.3548 = bf16[2,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3548"}
  %param_1.3718 = s32[2,1]{1,0} parameter(1), metadata={scheduling_name="param_1.3718"}
  %param_2.2812 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} parameter(2), metadata={scheduling_name="param_2.2812"}
  %bitcast.26584.1 = bf16[2,1,1,4,8192,6144]{5,4,3,2,1,0} bitcast(%param_2.2812), metadata={scheduling_name="bitcast.26584.1"}
  ROOT %scatter.221.1 = bf16[2,1,4,8192,6144]{4,3,2,1,0} scatter(%param_0.3548, %param_1.3718, %bitcast.26584.1), update_window_dims={1,2,3,4,5}, inserted_window_dims={}, scatter_dims_to_operand_dims={0}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="scatter.221.1"}
}

%fused_reduce.62 (param_0.5932: bf16[768,32768]) -> f32[4096] {
  %param_0.5932 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5932"}
  %convert.4343.6 = f32[768,32768]{1,0} convert(%param_0.5932), metadata={scheduling_name="convert.4343.6"}
  %multiply.2736.3 = f32[768,32768]{1,0} multiply(%convert.4343.6, %convert.4343.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2736.3"}
  %bitcast.26449.1 = f32[4096,6144]{1,0} bitcast(%multiply.2736.3), metadata={scheduling_name="bitcast.26449.1"}
  %constant_2882_87 = f32[] constant(0)
  ROOT %reduce.603.1 = f32[4096]{0} reduce(%bitcast.26449.1, %constant_2882_87), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.603.1"}
}

%fused_reduce.63 (param_0.5931: f32[65536], param_1.6329: bf16[65536,32768]) -> f32[8,8192,128] {
  %param_1.6329 = bf16[65536,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6329"}
  %convert.4332.8 = f32[65536,32768]{1,0} convert(%param_1.6329), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4332.8"}
  %bitcast.26346.7 = f32[8,8192,32768]{2,1,0} bitcast(%convert.4332.8), metadata={scheduling_name="bitcast.26346.7"}
  %param_0.5931 = f32[65536]{0} parameter(0), metadata={scheduling_name="param_0.5931"}
  %bitcast.26357.10 = f32[8,8192]{1,0} bitcast(%param_0.5931), metadata={scheduling_name="bitcast.26357.10"}
  %broadcast.5765.9 = f32[8,8192,32768]{2,1,0} broadcast(%bitcast.26357.10), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="broadcast.5765.9"}
  %subtract.270.7 = f32[8,8192,32768]{2,1,0} subtract(%bitcast.26346.7, %broadcast.5765.9), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="subtract.270.7"}
  %exponential.99.3 = f32[8,8192,32768]{2,1,0} exponential(%subtract.270.7), metadata={op_name="jit(train_step)/jit(main)/exp" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=612 scheduling_name="exponential.99.3"}
  %bitcast.26363.1 = f32[8,8192,128,256]{3,2,1,0} bitcast(%exponential.99.3), metadata={scheduling_name="bitcast.26363.1"}
  %constant_2882_86 = f32[] constant(0)
  ROOT %reduce.599.1 = f32[8,8192,128]{2,1,0} reduce(%bitcast.26363.1, %constant_2882_86), dimensions={3}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="reduce.599.1"}
}

%fused_reduce.64 (param_0.5996: bf16[65536,32768]) -> f32[65536,128] {
  %param_0.5996 = bf16[65536,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5996"}
  %convert.4332.1 = f32[65536,32768]{1,0} convert(%param_0.5996), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4332.1"}
  %bitcast.26351.1 = f32[65536,128,256]{2,1,0} bitcast(%convert.4332.1), metadata={scheduling_name="bitcast.26351.1"}
  %constant_2983_1 = f32[] constant(-inf)
  ROOT %reduce.597.1 = f32[65536,128]{1,0} reduce(%bitcast.26351.1, %constant_2983_1), dimensions={2}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="reduce.597.1"}
}

%fused_reduce.65 (param_0.5830: s32[8,8192]) -> s32[256] {
  %param_0.5830 = s32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5830"}
  %constant_2840_5 = s32[] constant(0)
  %broadcast.5760.7 = s32[8,8192]{1,0} broadcast(%constant_2840_5), dimensions={}, metadata={scheduling_name="broadcast.5760.7"}
  %compare.1723.7 = pred[8,8192]{1,0} compare(%param_0.5830, %broadcast.5760.7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.7"}
  %convert.4327.1 = s32[8,8192]{1,0} convert(%compare.1723.7), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="convert.4327.1"}
  %bitcast.26310.1 = s32[256,256]{1,0} bitcast(%convert.4327.1), metadata={scheduling_name="bitcast.26310.1"}
  ROOT %reduce.595.1 = s32[256]{0} reduce(%bitcast.26310.1, %constant_2840_5), dimensions={1}, to_apply=%region_7.620, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="reduce.595.1"}
}

%fused_rsqrt.8 (param_0.5994: f32[8,8192]) -> f32[1,8,8192] {
  %param_0.5994 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5994"}
  %constant_2975_1 = f32[] constant(0.000162760422)
  %broadcast.5757.7 = f32[8,8192]{1,0} broadcast(%constant_2975_1), dimensions={}, metadata={scheduling_name="broadcast.5757.7"}
  %multiply.2728.7 = f32[8,8192]{1,0} multiply(%param_0.5994, %broadcast.5757.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2728.7"}
  %constant_2976_1 = f32[] constant(1e-05)
  %broadcast.5758.5 = f32[8,8192]{1,0} broadcast(%constant_2976_1), dimensions={}, metadata={scheduling_name="broadcast.5758.5"}
  %add.3010.5 = f32[8,8192]{1,0} add(%multiply.2728.7, %broadcast.5758.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3010.5"}
  %bitcast.26289.1 = f32[1,8,8192]{2,1,0} bitcast(%add.3010.5), metadata={scheduling_name="bitcast.26289.1"}
  ROOT %rsqrt.103.1 = f32[1,8,8192]{2,1,0} rsqrt(%bitcast.26289.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.103.1"}
}

%fused_broadcast.5 (param_0.3578: pred[1]) -> pred[1,4,8192,6144] {
  %param_0.3578 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.3578"}
  %bitcast.26255.1 = pred[] bitcast(%param_0.3578), metadata={scheduling_name="bitcast.26255.1"}
  ROOT %broadcast.5756.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.26255.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5756.1"}
}

%fused_transpose.22 (param_0.3580: bf16[2,1,48,128,768]) -> bf16[2,768,6144] {
  %param_0.3580 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3580"}
  %bitcast.26226.1 = bf16[2,6144,768]{2,1,0} bitcast(%param_0.3580), metadata={scheduling_name="bitcast.26226.1"}
  ROOT %transpose.773.1 = bf16[2,768,6144]{2,1,0} transpose(%bitcast.26226.1), dimensions={0,2,1}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="transpose.773.1"}
}

%fused_transpose.23 (param_0.3584: bf16[2,1,48,128,768]) -> bf16[2,768,6144] {
  %param_0.3584 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3584"}
  %bitcast.26153.1 = bf16[2,6144,768]{2,1,0} bitcast(%param_0.3584), metadata={scheduling_name="bitcast.26153.1"}
  ROOT %transpose.772.1 = bf16[2,768,6144]{2,1,0} transpose(%bitcast.26153.1), dimensions={0,2,1}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="transpose.772.1"}
}

%fused_dynamic_slice.26 (param_0.5831: s32[128,8192], param_1.6445: u32[16], param_2.4630: u32[]) -> s32[4,4,8192] {
  %param_0.5831 = s32[128,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5831"}
  %bitcast.26112.1 = s32[4,32,8192]{2,1,0} bitcast(%param_0.5831), metadata={scheduling_name="bitcast.26112.1"}
  %constant_2840_6 = s32[] constant(0)
  %constant_5026_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %param_1.6445 = u32[16]{0} parameter(1), metadata={scheduling_name="param_1.6445"}
  %param_2.4630 = u32[] parameter(2), metadata={scheduling_name="param_2.4630"}
  %dynamic-slice.1460.1 = u32[1]{0} dynamic-slice(%param_1.6445, %param_2.4630), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="dynamic-slice.1460.1"}
  %constant_5027_1 = u32[1]{0} constant({7}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %clamp.28.1 = u32[1]{0} clamp(%constant_5026_1, %dynamic-slice.1460.1, %constant_5027_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="clamp.28.1"}
  %convert.4321.1 = s32[1]{0} convert(%clamp.28.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="convert.4321.1"}
  %constant_5024_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2721.1 = s32[1]{0} multiply(%convert.4321.1, %constant_5024_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="multiply.2721.1"}
  %bitcast.26128.1 = s32[] bitcast(%multiply.2721.1), metadata={scheduling_name="bitcast.26128.1"}
  ROOT %dynamic-slice.1461.1 = s32[4,4,8192]{2,1,0} dynamic-slice(%bitcast.26112.1, %constant_2840_6, %bitcast.26128.1, %constant_2840_6), dynamic_slice_sizes={4,4,8192}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="dynamic-slice.1461.1"}
}

%fused_broadcast.6 (param_0.3588: pred[1]) -> pred[1,4,8192,6144] {
  %param_0.3588 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.3588"}
  %bitcast.26097.1 = pred[] bitcast(%param_0.3588), metadata={scheduling_name="bitcast.26097.1"}
  ROOT %broadcast.5747.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.26097.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5747.1"}
}

%fused_gather (param_0.3594: s32[2,1], param_1.3738: bf16[1,2,4,8192,6144]) -> bf16[2,1,1,4,8192,6144] {
  %param_1.3738 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3738"}
  %bitcast.26261.1 = bf16[2,1,4,8192,6144]{4,3,2,0,1} bitcast(%param_1.3738), metadata={scheduling_name="bitcast.26261.1"}
  %param_0.3594 = s32[2,1]{1,0} parameter(0), metadata={scheduling_name="param_0.3594"}
  ROOT %gather.350.1 = bf16[2,1,1,4,8192,6144]{5,4,3,0,2,1} gather(%bitcast.26261.1, %param_0.3594), offset_dims={1,2,3,4,5}, collapsed_slice_dims={}, start_index_map={0}, index_vector_dim=1, slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="gather.350.1"}
}

%fused_convert_reduce.8 (param_0.3623: f32[8,8192], param_1.3779: f32[8,8192], param_2.2844: f32[65536], param_3.2320: bf16[65536,32768], param_4.1941: f32[8,8192], param_5.1742: s32[8,8192], param_6.2538: f32[8,8192]) -> (bf16[8,8192,32768], f32[8,8192,128]) {
  %param_0.3623 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3623"}
  %broadcast.5763.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_0.3623), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5763.3"}
  %param_4.1941 = f32[8,8192]{1,0} parameter(4), metadata={scheduling_name="param_4.1941"}
  %broadcast.5768.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_4.1941), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5768.3"}
  %param_3.2320 = bf16[65536,32768]{1,0} parameter(3), metadata={scheduling_name="param_3.2320"}
  %convert.4332.14 = f32[65536,32768]{1,0} convert(%param_3.2320), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4332.14"}
  %bitcast.26346.13 = f32[8,8192,32768]{2,1,0} bitcast(%convert.4332.14), metadata={scheduling_name="bitcast.26346.13"}
  %param_2.2844 = f32[65536]{0} parameter(2), metadata={scheduling_name="param_2.2844"}
  %bitcast.26357.16 = f32[8,8192]{1,0} bitcast(%param_2.2844), metadata={scheduling_name="bitcast.26357.16"}
  %broadcast.5765.15 = f32[8,8192,32768]{2,1,0} broadcast(%bitcast.26357.16), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="broadcast.5765.15"}
  %subtract.270.13 = f32[8,8192,32768]{2,1,0} subtract(%bitcast.26346.13, %broadcast.5765.15), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="subtract.270.13"}
  %exponential.99.9 = f32[8,8192,32768]{2,1,0} exponential(%subtract.270.13), metadata={op_name="jit(train_step)/jit(main)/exp" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=612 scheduling_name="exponential.99.9"}
  %multiply.2732.5 = f32[8,8192,32768]{2,1,0} multiply(%broadcast.5768.3, %exponential.99.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2732.5"}
  %param_1.3779 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.3779"}
  %broadcast.5769.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_1.3779), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5769.3"}
  %divide.476.3 = f32[8,8192,32768]{2,1,0} divide(%multiply.2732.5, %broadcast.5769.3), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="divide.476.3"}
  %param_5.1742 = s32[8,8192]{1,0} parameter(5), metadata={scheduling_name="param_5.1742"}
  %broadcast.5770.5 = s32[8,8192,32768]{2,1,0} broadcast(%param_5.1742), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="broadcast.5770.5"}
  %iota.404.5 = s32[8,8192,32768]{2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="iota.404.5"}
  %compare.1724.5 = pred[8,8192,32768]{2,1,0} compare(%broadcast.5770.5, %iota.404.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="compare.1724.5"}
  %convert.4333.1 = f32[8,8192,32768]{2,1,0} convert(%compare.1724.5), metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="convert.4333.1"}
  %subtract.271.1 = f32[8,8192,32768]{2,1,0} subtract(%divide.476.3, %convert.4333.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="subtract.271.1"}
  %multiply.2733.3 = f32[8,8192,32768]{2,1,0} multiply(%broadcast.5763.3, %subtract.271.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2733.3"}
  %convert.4334.1 = bf16[8,8192,32768]{2,1,0} convert(%multiply.2733.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4334.1"}
  %param_6.2538 = f32[8,8192]{1,0} parameter(6), metadata={scheduling_name="param_6.2538"}
  %broadcast.5980.3.clone.1 = f32[8,8192,32768]{2,1,0} broadcast(%param_6.2538), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=614 scheduling_name="broadcast.5980.3.clone.1"}
  %subtract.274.3.clone.1 = f32[8,8192,32768]{2,1,0} subtract(%subtract.270.13, %broadcast.5980.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=614 scheduling_name="subtract.274.3.clone.1"}
  %constant_2882_119_clone_1 = f32[] constant(0)
  %broadcast.5981.1.clone.1 = f32[8,8192,32768]{2,1,0} broadcast(%constant_2882_119_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5981.1.clone.1"}
  %select.1387.1.clone.1 = f32[8,8192,32768]{2,1,0} select(%compare.1724.5, %subtract.274.3.clone.1, %broadcast.5981.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="select.1387.1.clone.1"}
  %bitcast.29643.1.clone.1 = f32[8,8192,128,256]{3,2,1,0} bitcast(%select.1387.1.clone.1), metadata={scheduling_name="bitcast.29643.1.clone.1"}
  %reduce.667.1.clone.1 = f32[8,8192,128]{2,1,0} reduce(%bitcast.29643.1.clone.1, %constant_2882_119_clone_1), dimensions={3}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="reduce.667.1.clone.1"}
  ROOT %tuple.644 = (bf16[8,8192,32768]{2,1,0}, f32[8,8192,128]{2,1,0}) tuple(%convert.4334.1, %reduce.667.1.clone.1), metadata={scheduling_name="tuple.644"}
}

%fused_convert.17 (param_0.3658: s32[8,8192]) -> bf16[8,8192,32768] {
  %param_0.3658 = s32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3658"}
  %broadcast.5736.3 = s32[8,8192,32768]{2,1,0} broadcast(%param_0.3658), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="broadcast.5736.3"}
  %iota.395.3 = s32[8,8192,32768]{2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="iota.395.3"}
  %compare.1720.3 = pred[8,8192,32768]{2,1,0} compare(%broadcast.5736.3, %iota.395.3), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="compare.1720.3"}
  ROOT %convert.4319.1 = bf16[8,8192,32768]{2,1,0} convert(%compare.1720.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="convert.4319.1"}
}

%region_6.604.clone.10 (Arg_0.179: f32[], Arg_1.179: f32[]) -> f32[] {
  %Arg_1.179 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.179"}
  %Arg_0.179 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.179"}
  ROOT %add.2996.0 = f32[] add(%Arg_0.179, %Arg_1.179), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2996.0"}
}

%fused_convert_reduce.9 (param_0.3731: f32[1,8,8192], param_1.4683: bf16[65536,6144], param_2.3427: bf16[1,1,1,8,8192,6144], param_3.2798: f32[1,8,8192], param_4.2234: bf16[6144], param_5.2710: f32[]) -> (bf16[8,8192,6144], f32[256,6144]) {
  %param_1.4683 = bf16[65536,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.4683"}
  %bitcast.26399.15 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.4683), metadata={scheduling_name="bitcast.26399.15"}
  %convert.4335.15 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26399.15), metadata={scheduling_name="convert.4335.15"}
  %param_4.2234 = bf16[6144]{0} parameter(4), metadata={scheduling_name="param_4.2234"}
  %convert.4313.2 = f32[6144]{0} convert(%param_4.2234), metadata={scheduling_name="convert.4313.2"}
  %broadcast.6028.10 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4313.2), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.10"}
  %multiply.2737.9 = f32[8,8192,6144]{2,1,0} multiply(%convert.4335.15, %broadcast.6028.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2737.9"}
  %param_0.3731 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.3731"}
  %bitcast.26292.15 = f32[8,8192]{1,0} bitcast(%param_0.3731), metadata={scheduling_name="bitcast.26292.15"}
  %broadcast.5759.15 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26292.15), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5759.15"}
  %multiply.2738.5 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2737.9, %broadcast.5759.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2738.5"}
  %param_2.3427 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3427"}
  %bitcast.26273.19 = bf16[8,8192,6144]{2,1,0} bitcast(%param_2.3427), metadata={scheduling_name="bitcast.26273.19"}
  %convert.4326.19 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26273.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4326.19"}
  %param_3.2798 = f32[1,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.2798"}
  %bitcast.26570.3 = f32[8,8192]{1,0} bitcast(%param_3.2798), metadata={scheduling_name="bitcast.26570.3"}
  %broadcast.5797.3 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26570.3), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5797.3"}
  %multiply.2743.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4326.19, %broadcast.5797.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2743.3"}
  %add.3016.3 = f32[8,8192,6144]{2,1,0} add(%multiply.2738.5, %multiply.2743.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3016.3"}
  %convert.4347.1 = bf16[8,8192,6144]{2,1,0} convert(%add.3016.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4347.1"}
  %multiply.2729.11.clone.1 = f32[8,8192,6144]{2,1,0} multiply(%convert.4326.19, %broadcast.5759.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2729.11.clone.1"}
  %multiply.2734.5.clone.1 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2729.11.clone.1, %convert.4335.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2734.5.clone.1"}
  %convert.4336.3.clone.1 = bf16[8,8192,6144]{2,1,0} convert(%multiply.2734.5.clone.1), metadata={scheduling_name="convert.4336.3.clone.1"}
  %bitcast.26406.3.clone.1 = bf16[256,256,6144]{2,1,0} bitcast(%convert.4336.3.clone.1), metadata={scheduling_name="bitcast.26406.3.clone.1"}
  %convert.4337.3.clone.1 = f32[256,256,6144]{2,1,0} convert(%bitcast.26406.3.clone.1), metadata={scheduling_name="convert.4337.3.clone.1"}
  %param_5.2710 = f32[] parameter(5), metadata={scheduling_name="param_5.2710"}
  %reduce.601.1.clone.1 = f32[256,6144]{1,0} reduce(%convert.4337.3.clone.1, %param_5.2710), dimensions={1}, to_apply=%region_6.604.clone.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.601.1.clone.1"}
  ROOT %tuple.643 = (bf16[8,8192,6144]{2,1,0}, f32[256,6144]{1,0}) tuple(%convert.4347.1, %reduce.601.1.clone.1), metadata={scheduling_name="tuple.643"}
}

%fused_convert.18 (param_0.4440: f32[1,8,8192], param_1.4686: bf16[1,1,1,8,8192,6144], param_2.3428: bf16[6144]) -> bf16[8,8192,6144] {
  %param_1.4686 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.4686"}
  %bitcast.26273.17 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.4686), metadata={scheduling_name="bitcast.26273.17"}
  %convert.4326.17 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26273.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4326.17"}
  %param_0.4440 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.4440"}
  %bitcast.26292.17 = f32[8,8192]{1,0} bitcast(%param_0.4440), metadata={scheduling_name="bitcast.26292.17"}
  %broadcast.5759.17 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26292.17), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5759.17"}
  %multiply.2729.9 = f32[8,8192,6144]{2,1,0} multiply(%convert.4326.17, %broadcast.5759.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2729.9"}
  %param_2.3428 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.3428"}
  %convert.4313.4 = f32[6144]{0} convert(%param_2.3428), metadata={scheduling_name="convert.4313.4"}
  %broadcast.6028.12 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4313.4), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.12"}
  %multiply.2730.3 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2729.9, %broadcast.6028.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2730.3"}
  ROOT %convert.4331.1 = bf16[8,8192,6144]{2,1,0} convert(%multiply.2730.3), metadata={scheduling_name="convert.4331.1"}
}

%fused_reduce.66 (param_0.5871: bf16[1,1,1,8,8192,6144]) -> f32[8,8192] {
  %param_0.5871 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5871"}
  %bitcast.26273.21 = bf16[8,8192,6144]{2,1,0} bitcast(%param_0.5871), metadata={scheduling_name="bitcast.26273.21"}
  %convert.4326.21 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26273.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4326.21"}
  %multiply.2727.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4326.21, %convert.4326.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2727.3"}
  %constant_2882_26 = f32[] constant(0)
  ROOT %reduce.178.1 = f32[8,8192]{1,0} reduce(%multiply.2727.3, %constant_2882_26), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.178.1"}
}

%fused_reduce.67 (param_0.5877: bf16[65536,6144], param_1.6289: bf16[1,1,1,8,8192,6144], param_2.4488: bf16[6144]) -> f32[8,8192] {
  %param_1.6289 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6289"}
  %bitcast.26273.23 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.6289), metadata={scheduling_name="bitcast.26273.23"}
  %convert.4326.23 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26273.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4326.23"}
  %param_0.5877 = bf16[65536,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.5877"}
  %bitcast.26399.17 = bf16[8,8192,6144]{2,1,0} bitcast(%param_0.5877), metadata={scheduling_name="bitcast.26399.17"}
  %convert.4335.17 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26399.17), metadata={scheduling_name="convert.4335.17"}
  %param_2.4488 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.4488"}
  %convert.4313.5 = f32[6144]{0} convert(%param_2.4488), metadata={scheduling_name="convert.4313.5"}
  %broadcast.6028.14 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4313.5), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.14"}
  %multiply.2737.11 = f32[8,8192,6144]{2,1,0} multiply(%convert.4335.17, %broadcast.6028.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2737.11"}
  %multiply.2739.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4326.23, %multiply.2737.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2739.3"}
  %constant_2882_32 = f32[] constant(0)
  ROOT %reduce.185.1 = f32[8,8192]{1,0} reduce(%multiply.2739.3, %constant_2882_32), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.185.1"}
}

%fused_convert_reduce.10 (param_0.4171: bf16[2,1,1,6144,16384], param_1.4534: f32[], param_2.3313: bf16[2,1,1,6144,16384], param_3.2710: f32[], param_4.2202: bf16[2,1,1,6144,16384], param_5.2454: bf16[2,1,1,6144,16384], param_6.2215: f32[], param_7.2027: pred[], param_8.1869: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4171 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4171"}
  %convert.4453.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4171), metadata={scheduling_name="convert.4453.12"}
  %param_8.1869 = f32[] parameter(8), metadata={scheduling_name="param_8.1869"}
  %broadcast.6090.16 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1869), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6090.16"}
  %param_7.2027 = pred[] parameter(7), metadata={scheduling_name="param_7.2027"}
  %broadcast.5831.40 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2027), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5831.40"}
  %param_5.2454 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2454"}
  %convert.4350.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2454), metadata={scheduling_name="convert.4350.20"}
  %param_6.2215 = f32[] parameter(6), metadata={scheduling_name="param_6.2215"}
  %broadcast.6092.56 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2215), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6092.56"}
  %divide.487.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4350.20, %broadcast.6092.56), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.487.17"}
  %convert.4457.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.487.17), metadata={scheduling_name="convert.4457.15"}
  %select.1366.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5831.40, %param_5.2454, %convert.4457.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1366.13"}
  %convert.4458.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1366.13), metadata={scheduling_name="convert.4458.26"}
  %constant_3096_21 = bf16[] constant(0.1001)
  %convert.5015.26 = f32[] convert(%constant_3096_21), metadata={scheduling_name="convert.5015.26"}
  %broadcast.6094.48 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5015.26), dimensions={}, metadata={scheduling_name="broadcast.6094.48"}
  %multiply.2789.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4458.26, %broadcast.6094.48), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2789.11"}
  %param_4.2202 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2202"}
  %convert.4460.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2202), metadata={scheduling_name="convert.4460.9"}
  %constant_3097_20 = bf16[] constant(0.8984)
  %convert.5016.10 = f32[] convert(%constant_3097_20), metadata={scheduling_name="convert.5016.10"}
  %broadcast.6096.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5016.10), dimensions={}, metadata={scheduling_name="broadcast.6096.32"}
  %multiply.2790.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4460.9, %broadcast.6096.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2790.11"}
  %add.3055.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2789.11, %multiply.2790.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3055.9"}
  %param_3.2710 = f32[] parameter(3), metadata={scheduling_name="param_3.2710"}
  %broadcast.6098.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2710), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6098.32"}
  %multiply.2791.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4458.26, %convert.4458.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2791.15"}
  %constant_3103_20 = bf16[] constant(0.05005)
  %convert.5018.10 = f32[] convert(%constant_3103_20), metadata={scheduling_name="convert.5018.10"}
  %broadcast.6100.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.10), dimensions={}, metadata={scheduling_name="broadcast.6100.32"}
  %multiply.2792.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2791.15, %broadcast.6100.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2792.11"}
  %param_2.3313 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3313"}
  %convert.4466.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3313), metadata={scheduling_name="convert.4466.11"}
  %constant_3104_20 = bf16[] constant(0.9492)
  %convert.5020.10 = f32[] convert(%constant_3104_20), metadata={scheduling_name="convert.5020.10"}
  %broadcast.6102.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5020.10), dimensions={}, metadata={scheduling_name="broadcast.6102.32"}
  %multiply.2793.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4466.11, %broadcast.6102.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2793.11"}
  %add.3056.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2792.11, %multiply.2793.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3056.9"}
  %param_1.4534 = f32[] parameter(1), metadata={scheduling_name="param_1.4534"}
  %broadcast.6104.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4534), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6104.32"}
  %divide.488.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3056.9, %broadcast.6104.32), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.488.11"}
  %sqrt.85.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.488.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.85.9"}
  %constant_3107_20 = bf16[] constant(1.001e-08)
  %convert.5023.10 = f32[] convert(%constant_3107_20), metadata={scheduling_name="convert.5023.10"}
  %broadcast.6106.16 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.10), dimensions={}, metadata={scheduling_name="broadcast.6106.16"}
  %add.3057.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.85.9, %broadcast.6106.16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3057.7"}
  %multiply.2794.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6098.32, %add.3057.7), metadata={scheduling_name="multiply.2794.11"}
  %divide.489.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3055.9, %multiply.2794.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.489.9"}
  %multiply.2795.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4453.12, %broadcast.6094.48), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2795.7"}
  %add.3058.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.489.9, %multiply.2795.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3058.7"}
  %multiply.2796.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6090.16, %add.3058.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2796.7"}
  %add.3059.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4453.12, %multiply.2796.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3059.5"}
  %convert.4472.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3059.5), metadata={scheduling_name="convert.4472.1"}
  %convert.4917.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3055.9), metadata={scheduling_name="convert.4917.1.clone.1"}
  %multiply.2964.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3059.5, %add.3059.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2964.1.clone.1"}
  %bitcast.29719.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2964.1.clone.1), metadata={scheduling_name="bitcast.29719.1.clone.1"}
  %constant_2882_122_clone_1 = f32[] constant(0)
  %reduce.673.1.clone.1 = f32[24576]{0} reduce(%bitcast.29719.1.clone.1, %constant_2882_122_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.673.1.clone.1"}
  %convert.4952.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3056.9), metadata={scheduling_name="convert.4952.1.clone.1"}
  %bitcast.29291.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2791.15), metadata={scheduling_name="bitcast.29291.1.clone.1"}
  %reduce.637.1.clone.1 = f32[24576]{0} reduce(%bitcast.29291.1.clone.1, %constant_2882_122_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.637.1.clone.1"}
  ROOT %tuple.628 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4472.1, %convert.4917.1.clone.1, %reduce.673.1.clone.1, %convert.4952.1.clone.1, %reduce.637.1.clone.1), metadata={scheduling_name="tuple.628"}
}

%fused_convert_reduce.11 (param_0.4176: bf16[2,1,1,6144,16384], param_1.4535: f32[], param_2.3314: bf16[2,1,1,6144,16384], param_3.2711: f32[], param_4.2203: bf16[2,1,1,6144,16384], param_5.2455: bf16[2,1,1,6144,16384], param_6.2216: f32[], param_7.2028: pred[], param_8.1870: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4176 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4176"}
  %convert.4473.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4176), metadata={scheduling_name="convert.4473.12"}
  %param_8.1870 = f32[] parameter(8), metadata={scheduling_name="param_8.1870"}
  %broadcast.6090.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1870), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6090.20"}
  %param_7.2028 = pred[] parameter(7), metadata={scheduling_name="param_7.2028"}
  %broadcast.5831.44 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2028), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5831.44"}
  %param_5.2455 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2455"}
  %convert.4352.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2455), metadata={scheduling_name="convert.4352.20"}
  %param_6.2216 = f32[] parameter(6), metadata={scheduling_name="param_6.2216"}
  %broadcast.6092.60 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2216), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6092.60"}
  %divide.490.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4352.20, %broadcast.6092.60), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.490.17"}
  %convert.4477.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.490.17), metadata={scheduling_name="convert.4477.15"}
  %select.1367.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5831.44, %param_5.2455, %convert.4477.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1367.13"}
  %convert.4478.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1367.13), metadata={scheduling_name="convert.4478.26"}
  %constant_3096_23 = bf16[] constant(0.1001)
  %convert.5015.30 = f32[] convert(%constant_3096_23), metadata={scheduling_name="convert.5015.30"}
  %broadcast.6094.56 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5015.30), dimensions={}, metadata={scheduling_name="broadcast.6094.56"}
  %multiply.2797.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4478.26, %broadcast.6094.56), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2797.11"}
  %param_4.2203 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2203"}
  %convert.4480.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2203), metadata={scheduling_name="convert.4480.9"}
  %constant_3097_21 = bf16[] constant(0.8984)
  %convert.5016.11 = f32[] convert(%constant_3097_21), metadata={scheduling_name="convert.5016.11"}
  %broadcast.6096.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5016.11), dimensions={}, metadata={scheduling_name="broadcast.6096.36"}
  %multiply.2798.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4480.9, %broadcast.6096.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2798.11"}
  %add.3060.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2797.11, %multiply.2798.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3060.9"}
  %param_3.2711 = f32[] parameter(3), metadata={scheduling_name="param_3.2711"}
  %broadcast.6098.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2711), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6098.36"}
  %multiply.2799.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4478.26, %convert.4478.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2799.15"}
  %constant_3103_21 = bf16[] constant(0.05005)
  %convert.5018.11 = f32[] convert(%constant_3103_21), metadata={scheduling_name="convert.5018.11"}
  %broadcast.6100.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.11), dimensions={}, metadata={scheduling_name="broadcast.6100.36"}
  %multiply.2800.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2799.15, %broadcast.6100.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2800.11"}
  %param_2.3314 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3314"}
  %convert.4486.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3314), metadata={scheduling_name="convert.4486.11"}
  %constant_3104_21 = bf16[] constant(0.9492)
  %convert.5020.11 = f32[] convert(%constant_3104_21), metadata={scheduling_name="convert.5020.11"}
  %broadcast.6102.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5020.11), dimensions={}, metadata={scheduling_name="broadcast.6102.36"}
  %multiply.2801.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4486.11, %broadcast.6102.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2801.11"}
  %add.3061.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2800.11, %multiply.2801.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3061.9"}
  %param_1.4535 = f32[] parameter(1), metadata={scheduling_name="param_1.4535"}
  %broadcast.6104.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4535), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6104.36"}
  %divide.491.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3061.9, %broadcast.6104.36), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.491.11"}
  %sqrt.86.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.491.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.86.9"}
  %constant_3107_21 = bf16[] constant(1.001e-08)
  %convert.5023.11 = f32[] convert(%constant_3107_21), metadata={scheduling_name="convert.5023.11"}
  %broadcast.6106.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.11), dimensions={}, metadata={scheduling_name="broadcast.6106.20"}
  %add.3063.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.86.9, %broadcast.6106.20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3063.7"}
  %multiply.2802.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6098.36, %add.3063.7), metadata={scheduling_name="multiply.2802.11"}
  %divide.492.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3060.9, %multiply.2802.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.492.9"}
  %multiply.2803.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4473.12, %broadcast.6094.56), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2803.7"}
  %add.3064.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.492.9, %multiply.2803.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3064.7"}
  %multiply.2804.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6090.20, %add.3064.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2804.7"}
  %add.3066.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4473.12, %multiply.2804.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3066.5"}
  %convert.4492.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3066.5), metadata={scheduling_name="convert.4492.1"}
  %convert.4919.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3060.9), metadata={scheduling_name="convert.4919.1.clone.1"}
  %multiply.2965.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3066.5, %add.3066.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2965.1.clone.1"}
  %bitcast.29741.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2965.1.clone.1), metadata={scheduling_name="bitcast.29741.1.clone.1"}
  %constant_2882_123_clone_1 = f32[] constant(0)
  %reduce.675.1.clone.1 = f32[24576]{0} reduce(%bitcast.29741.1.clone.1, %constant_2882_123_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.675.1.clone.1"}
  %convert.4953.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3061.9), metadata={scheduling_name="convert.4953.1.clone.1"}
  %bitcast.29312.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2799.15), metadata={scheduling_name="bitcast.29312.1.clone.1"}
  %reduce.639.1.clone.1 = f32[24576]{0} reduce(%bitcast.29312.1.clone.1, %constant_2882_123_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.639.1.clone.1"}
  ROOT %tuple.629 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4492.1, %convert.4919.1.clone.1, %reduce.675.1.clone.1, %convert.4953.1.clone.1, %reduce.639.1.clone.1), metadata={scheduling_name="tuple.629"}
}

%fused_convert_reduce.12 (param_0.4181: bf16[2,1,1,16384,6144], param_1.4537: f32[], param_2.3316: bf16[2,1,1,16384,6144], param_3.2713: f32[], param_4.2205: bf16[2,1,1,16384,6144], param_5.2457: bf16[2,1,1,16384,6144], param_6.2218: f32[], param_7.2030: pred[], param_8.1872: f32[]) -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144], f32[24576], bf16[2,1,1,16384,6144], f32[24576]) {
  %param_0.4181 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4181"}
  %convert.4493.12 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.4181), metadata={scheduling_name="convert.4493.12"}
  %param_8.1872 = f32[] parameter(8), metadata={scheduling_name="param_8.1872"}
  %broadcast.6122.10 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_8.1872), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6122.10"}
  %param_7.2030 = pred[] parameter(7), metadata={scheduling_name="param_7.2030"}
  %broadcast.5848.22 = pred[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_7.2030), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5848.22"}
  %param_5.2457 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2457"}
  %convert.4354.20 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_5.2457), metadata={scheduling_name="convert.4354.20"}
  %param_6.2218 = f32[] parameter(6), metadata={scheduling_name="param_6.2218"}
  %broadcast.6124.30 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_6.2218), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6124.30"}
  %divide.493.17 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%convert.4354.20, %broadcast.6124.30), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.493.17"}
  %convert.4497.15 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%divide.493.17), metadata={scheduling_name="convert.4497.15"}
  %select.1368.13 = bf16[2,1,1,16384,6144]{4,3,2,1,0} select(%broadcast.5848.22, %param_5.2457, %convert.4497.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1368.13"}
  %convert.4498.26 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%select.1368.13), metadata={scheduling_name="convert.4498.26"}
  %constant_3096_28 = bf16[] constant(0.1001)
  %convert.5015.34 = f32[] convert(%constant_3096_28), metadata={scheduling_name="convert.5015.34"}
  %broadcast.6126.28 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5015.34), dimensions={}, metadata={scheduling_name="broadcast.6126.28"}
  %multiply.2805.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4498.26, %broadcast.6126.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2805.11"}
  %param_4.2205 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2205"}
  %convert.4500.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_4.2205), metadata={scheduling_name="convert.4500.9"}
  %constant_3097_23 = bf16[] constant(0.8984)
  %convert.5016.13 = f32[] convert(%constant_3097_23), metadata={scheduling_name="convert.5016.13"}
  %broadcast.6128.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5016.13), dimensions={}, metadata={scheduling_name="broadcast.6128.18"}
  %multiply.2806.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4500.9, %broadcast.6128.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2806.11"}
  %add.3067.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2805.11, %multiply.2806.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3067.9"}
  %param_3.2713 = f32[] parameter(3), metadata={scheduling_name="param_3.2713"}
  %broadcast.6130.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_3.2713), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6130.18"}
  %multiply.2807.15 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4498.26, %convert.4498.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2807.15"}
  %constant_3103_23 = bf16[] constant(0.05005)
  %convert.5018.13 = f32[] convert(%constant_3103_23), metadata={scheduling_name="convert.5018.13"}
  %broadcast.6132.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5018.13), dimensions={}, metadata={scheduling_name="broadcast.6132.18"}
  %multiply.2808.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%multiply.2807.15, %broadcast.6132.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2808.11"}
  %param_2.3316 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3316"}
  %convert.4506.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.3316), metadata={scheduling_name="convert.4506.11"}
  %constant_3104_23 = bf16[] constant(0.9492)
  %convert.5020.13 = f32[] convert(%constant_3104_23), metadata={scheduling_name="convert.5020.13"}
  %broadcast.6134.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5020.13), dimensions={}, metadata={scheduling_name="broadcast.6134.18"}
  %multiply.2809.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4506.11, %broadcast.6134.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2809.11"}
  %add.3069.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2808.11, %multiply.2809.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3069.9"}
  %param_1.4537 = f32[] parameter(1), metadata={scheduling_name="param_1.4537"}
  %broadcast.6136.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_1.4537), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6136.18"}
  %divide.494.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3069.9, %broadcast.6136.18), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.494.11"}
  %sqrt.87.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} sqrt(%divide.494.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.87.9"}
  %constant_3107_23 = bf16[] constant(1.001e-08)
  %convert.5023.13 = f32[] convert(%constant_3107_23), metadata={scheduling_name="convert.5023.13"}
  %broadcast.6138.10 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5023.13), dimensions={}, metadata={scheduling_name="broadcast.6138.10"}
  %add.3070.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%sqrt.87.9, %broadcast.6138.10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3070.7"}
  %multiply.2810.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6130.18, %add.3070.7), metadata={scheduling_name="multiply.2810.11"}
  %divide.495.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3067.9, %multiply.2810.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.495.9"}
  %multiply.2811.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4493.12, %broadcast.6126.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2811.7"}
  %add.3071.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%divide.495.9, %multiply.2811.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3071.7"}
  %multiply.2812.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6122.10, %add.3071.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2812.7"}
  %add.3072.5 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%convert.4493.12, %multiply.2812.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3072.5"}
  %convert.4512.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3072.5), metadata={scheduling_name="convert.4512.1"}
  %convert.4920.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3067.9), metadata={scheduling_name="convert.4920.1.clone.1"}
  %multiply.2966.1.clone.1 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%add.3072.5, %add.3072.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2966.1.clone.1"}
  %bitcast.29763.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2966.1.clone.1), metadata={scheduling_name="bitcast.29763.1.clone.1"}
  %constant_2882_124_clone_1 = f32[] constant(0)
  %reduce.677.1.clone.1 = f32[24576]{0} reduce(%bitcast.29763.1.clone.1, %constant_2882_124_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.677.1.clone.1"}
  %convert.4954.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3069.9), metadata={scheduling_name="convert.4954.1.clone.1"}
  %bitcast.29333.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2807.15), metadata={scheduling_name="bitcast.29333.1.clone.1"}
  %reduce.641.1.clone.1 = f32[24576]{0} reduce(%bitcast.29333.1.clone.1, %constant_2882_124_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.641.1.clone.1"}
  ROOT %tuple.630 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4512.1, %convert.4920.1.clone.1, %reduce.677.1.clone.1, %convert.4954.1.clone.1, %reduce.641.1.clone.1), metadata={scheduling_name="tuple.630"}
}

%fused_convert_reduce.13 (param_0.4186: bf16[2,1,1,6144,16384], param_1.4536: f32[], param_2.3315: bf16[2,1,1,6144,16384], param_3.2712: f32[], param_4.2204: bf16[2,1,1,6144,16384], param_5.2456: bf16[2,1,1,6144,16384], param_6.2217: f32[], param_7.2029: pred[], param_8.1871: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4186 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4186"}
  %convert.4683.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4186), metadata={scheduling_name="convert.4683.12"}
  %param_8.1871 = f32[] parameter(8), metadata={scheduling_name="param_8.1871"}
  %broadcast.6090.24 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1871), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6090.24"}
  %param_7.2029 = pred[] parameter(7), metadata={scheduling_name="param_7.2029"}
  %broadcast.5831.48 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2029), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5831.48"}
  %param_5.2456 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2456"}
  %convert.4370.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2456), metadata={scheduling_name="convert.4370.20"}
  %param_6.2217 = f32[] parameter(6), metadata={scheduling_name="param_6.2217"}
  %broadcast.6092.64 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2217), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6092.64"}
  %divide.517.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4370.20, %broadcast.6092.64), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.517.17"}
  %convert.4689.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.517.17), metadata={scheduling_name="convert.4689.15"}
  %select.1376.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5831.48, %param_5.2456, %convert.4689.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1376.13"}
  %convert.4691.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1376.13), metadata={scheduling_name="convert.4691.26"}
  %constant_3096_25 = bf16[] constant(0.1001)
  %convert.5015.38 = f32[] convert(%constant_3096_25), metadata={scheduling_name="convert.5015.38"}
  %broadcast.6094.64 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5015.38), dimensions={}, metadata={scheduling_name="broadcast.6094.64"}
  %multiply.2869.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4691.26, %broadcast.6094.64), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2869.11"}
  %param_4.2204 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2204"}
  %convert.4694.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2204), metadata={scheduling_name="convert.4694.9"}
  %constant_3097_22 = bf16[] constant(0.8984)
  %convert.5016.12 = f32[] convert(%constant_3097_22), metadata={scheduling_name="convert.5016.12"}
  %broadcast.6096.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5016.12), dimensions={}, metadata={scheduling_name="broadcast.6096.40"}
  %multiply.2870.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4694.9, %broadcast.6096.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2870.11"}
  %add.3109.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2869.11, %multiply.2870.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3109.9"}
  %param_3.2712 = f32[] parameter(3), metadata={scheduling_name="param_3.2712"}
  %broadcast.6098.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2712), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6098.40"}
  %multiply.2871.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4691.26, %convert.4691.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2871.15"}
  %constant_3103_22 = bf16[] constant(0.05005)
  %convert.5018.12 = f32[] convert(%constant_3103_22), metadata={scheduling_name="convert.5018.12"}
  %broadcast.6100.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.12), dimensions={}, metadata={scheduling_name="broadcast.6100.40"}
  %multiply.2872.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2871.15, %broadcast.6100.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2872.11"}
  %param_2.3315 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3315"}
  %convert.4703.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3315), metadata={scheduling_name="convert.4703.11"}
  %constant_3104_22 = bf16[] constant(0.9492)
  %convert.5020.12 = f32[] convert(%constant_3104_22), metadata={scheduling_name="convert.5020.12"}
  %broadcast.6102.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5020.12), dimensions={}, metadata={scheduling_name="broadcast.6102.40"}
  %multiply.2873.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4703.11, %broadcast.6102.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2873.11"}
  %add.3110.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2872.11, %multiply.2873.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3110.9"}
  %param_1.4536 = f32[] parameter(1), metadata={scheduling_name="param_1.4536"}
  %broadcast.6104.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4536), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6104.40"}
  %divide.518.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3110.9, %broadcast.6104.40), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.518.11"}
  %sqrt.95.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.518.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.95.9"}
  %constant_3107_22 = bf16[] constant(1.001e-08)
  %convert.5023.12 = f32[] convert(%constant_3107_22), metadata={scheduling_name="convert.5023.12"}
  %broadcast.6106.24 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.12), dimensions={}, metadata={scheduling_name="broadcast.6106.24"}
  %add.3111.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.95.9, %broadcast.6106.24), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3111.7"}
  %multiply.2874.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6098.40, %add.3111.7), metadata={scheduling_name="multiply.2874.11"}
  %divide.519.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3109.9, %multiply.2874.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.519.9"}
  %multiply.2875.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4683.12, %broadcast.6094.64), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2875.7"}
  %add.3112.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.519.9, %multiply.2875.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3112.7"}
  %multiply.2876.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6090.24, %add.3112.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2876.7"}
  %add.3113.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4683.12, %multiply.2876.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3113.5"}
  %convert.4712.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3113.5), metadata={scheduling_name="convert.4712.1"}
  %convert.4932.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3109.9), metadata={scheduling_name="convert.4932.1.clone.1"}
  %multiply.2975.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3113.5, %add.3113.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2975.1.clone.1"}
  %bitcast.29899.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2975.1.clone.1), metadata={scheduling_name="bitcast.29899.1.clone.1"}
  %constant_2882_129_clone_1 = f32[] constant(0)
  %reduce.687.1.clone.1 = f32[24576]{0} reduce(%bitcast.29899.1.clone.1, %constant_2882_129_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.687.1.clone.1"}
  %convert.4962.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3110.9), metadata={scheduling_name="convert.4962.1.clone.1"}
  %bitcast.29461.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2871.15), metadata={scheduling_name="bitcast.29461.1.clone.1"}
  %reduce.651.1.clone.1 = f32[24576]{0} reduce(%bitcast.29461.1.clone.1, %constant_2882_129_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.651.1.clone.1"}
  ROOT %tuple.634 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4712.1, %convert.4932.1.clone.1, %reduce.687.1.clone.1, %convert.4962.1.clone.1, %reduce.651.1.clone.1), metadata={scheduling_name="tuple.634"}
}

%fused_convert_reduce.14 (param_0.4191: bf16[2,1,1,6144,16384], param_1.4532: f32[], param_2.3311: bf16[2,1,1,6144,16384], param_3.2708: f32[], param_4.2200: bf16[2,1,1,6144,16384], param_5.2448: bf16[2,1,1,6144,16384], param_6.2209: f32[], param_7.2021: pred[], param_8.1863: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4191 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4191"}
  %convert.4713.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4191), metadata={scheduling_name="convert.4713.12"}
  %param_8.1863 = f32[] parameter(8), metadata={scheduling_name="param_8.1863"}
  %broadcast.6090.28 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1863), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6090.28"}
  %param_7.2021 = pred[] parameter(7), metadata={scheduling_name="param_7.2021"}
  %broadcast.5831.52 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2021), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5831.52"}
  %param_5.2448 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2448"}
  %convert.4372.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2448), metadata={scheduling_name="convert.4372.20"}
  %param_6.2209 = f32[] parameter(6), metadata={scheduling_name="param_6.2209"}
  %broadcast.6092.68 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2209), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6092.68"}
  %divide.520.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4372.20, %broadcast.6092.68), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.520.17"}
  %convert.4719.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.520.17), metadata={scheduling_name="convert.4719.15"}
  %select.1377.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5831.52, %param_5.2448, %convert.4719.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1377.13"}
  %convert.4721.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1377.13), metadata={scheduling_name="convert.4721.26"}
  %constant_3096_14 = bf16[] constant(0.1001)
  %convert.5015.42 = f32[] convert(%constant_3096_14), metadata={scheduling_name="convert.5015.42"}
  %broadcast.6094.72 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5015.42), dimensions={}, metadata={scheduling_name="broadcast.6094.72"}
  %multiply.2877.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4721.26, %broadcast.6094.72), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2877.11"}
  %param_4.2200 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2200"}
  %convert.4724.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2200), metadata={scheduling_name="convert.4724.9"}
  %constant_3097_14 = bf16[] constant(0.8984)
  %convert.5016.4 = f32[] convert(%constant_3097_14), metadata={scheduling_name="convert.5016.4"}
  %broadcast.6096.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5016.4), dimensions={}, metadata={scheduling_name="broadcast.6096.44"}
  %multiply.2878.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4724.9, %broadcast.6096.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2878.11"}
  %add.3114.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2877.11, %multiply.2878.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3114.9"}
  %param_3.2708 = f32[] parameter(3), metadata={scheduling_name="param_3.2708"}
  %broadcast.6098.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2708), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6098.44"}
  %multiply.2879.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4721.26, %convert.4721.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2879.15"}
  %constant_3103_14 = bf16[] constant(0.05005)
  %convert.5018.4 = f32[] convert(%constant_3103_14), metadata={scheduling_name="convert.5018.4"}
  %broadcast.6100.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.4), dimensions={}, metadata={scheduling_name="broadcast.6100.44"}
  %multiply.2880.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2879.15, %broadcast.6100.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2880.11"}
  %param_2.3311 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3311"}
  %convert.4733.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3311), metadata={scheduling_name="convert.4733.11"}
  %constant_3104_14 = bf16[] constant(0.9492)
  %convert.5020.4 = f32[] convert(%constant_3104_14), metadata={scheduling_name="convert.5020.4"}
  %broadcast.6102.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5020.4), dimensions={}, metadata={scheduling_name="broadcast.6102.44"}
  %multiply.2881.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4733.11, %broadcast.6102.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2881.11"}
  %add.3115.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2880.11, %multiply.2881.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3115.9"}
  %param_1.4532 = f32[] parameter(1), metadata={scheduling_name="param_1.4532"}
  %broadcast.6104.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4532), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6104.44"}
  %divide.521.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3115.9, %broadcast.6104.44), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.521.11"}
  %sqrt.96.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.521.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.96.9"}
  %constant_3107_14 = bf16[] constant(1.001e-08)
  %convert.5023.4 = f32[] convert(%constant_3107_14), metadata={scheduling_name="convert.5023.4"}
  %broadcast.6106.28 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.4), dimensions={}, metadata={scheduling_name="broadcast.6106.28"}
  %add.3116.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.96.9, %broadcast.6106.28), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3116.7"}
  %multiply.2882.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6098.44, %add.3116.7), metadata={scheduling_name="multiply.2882.11"}
  %divide.522.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3114.9, %multiply.2882.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.522.9"}
  %multiply.2883.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4713.12, %broadcast.6094.72), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2883.7"}
  %add.3117.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.522.9, %multiply.2883.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3117.7"}
  %multiply.2884.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6090.28, %add.3117.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2884.7"}
  %add.3118.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4713.12, %multiply.2884.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3118.5"}
  %convert.4740.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3118.5), metadata={scheduling_name="convert.4740.1"}
  %convert.4934.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3114.9), metadata={scheduling_name="convert.4934.1.clone.1"}
  %multiply.2976.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3118.5, %add.3118.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2976.1.clone.1"}
  %bitcast.29921.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2976.1.clone.1), metadata={scheduling_name="bitcast.29921.1.clone.1"}
  %constant_2882_130_clone_1 = f32[] constant(0)
  %reduce.689.1.clone.1 = f32[24576]{0} reduce(%bitcast.29921.1.clone.1, %constant_2882_130_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.689.1.clone.1"}
  %convert.4963.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3115.9), metadata={scheduling_name="convert.4963.1.clone.1"}
  %bitcast.29482.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2879.15), metadata={scheduling_name="bitcast.29482.1.clone.1"}
  %reduce.653.1.clone.1 = f32[24576]{0} reduce(%bitcast.29482.1.clone.1, %constant_2882_130_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.653.1.clone.1"}
  ROOT %tuple.635 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4740.1, %convert.4934.1.clone.1, %reduce.689.1.clone.1, %convert.4963.1.clone.1, %reduce.653.1.clone.1), metadata={scheduling_name="tuple.635"}
}

%fused_convert_reduce.15 (param_0.4196: bf16[2,1,1,16384,6144], param_1.4533: f32[], param_2.3312: bf16[2,1,1,16384,6144], param_3.2709: f32[], param_4.2201: bf16[2,1,1,16384,6144], param_5.2449: bf16[2,1,1,16384,6144], param_6.2210: f32[], param_7.2022: pred[], param_8.1864: f32[]) -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144], f32[24576], bf16[2,1,1,16384,6144], f32[24576]) {
  %param_0.4196 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4196"}
  %convert.4741.12 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.4196), metadata={scheduling_name="convert.4741.12"}
  %param_8.1864 = f32[] parameter(8), metadata={scheduling_name="param_8.1864"}
  %broadcast.6122.14 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_8.1864), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6122.14"}
  %param_7.2022 = pred[] parameter(7), metadata={scheduling_name="param_7.2022"}
  %broadcast.5848.26 = pred[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_7.2022), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5848.26"}
  %param_5.2449 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2449"}
  %convert.4374.20 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_5.2449), metadata={scheduling_name="convert.4374.20"}
  %param_6.2210 = f32[] parameter(6), metadata={scheduling_name="param_6.2210"}
  %broadcast.6124.34 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_6.2210), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6124.34"}
  %divide.523.17 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%convert.4374.20, %broadcast.6124.34), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.523.17"}
  %convert.4745.15 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%divide.523.17), metadata={scheduling_name="convert.4745.15"}
  %select.1378.13 = bf16[2,1,1,16384,6144]{4,3,2,1,0} select(%broadcast.5848.26, %param_5.2449, %convert.4745.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1378.13"}
  %convert.4746.26 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%select.1378.13), metadata={scheduling_name="convert.4746.26"}
  %constant_3096_15 = bf16[] constant(0.1001)
  %convert.5015.46 = f32[] convert(%constant_3096_15), metadata={scheduling_name="convert.5015.46"}
  %broadcast.6126.36 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5015.46), dimensions={}, metadata={scheduling_name="broadcast.6126.36"}
  %multiply.2885.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4746.26, %broadcast.6126.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2885.11"}
  %param_4.2201 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2201"}
  %convert.4748.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_4.2201), metadata={scheduling_name="convert.4748.9"}
  %constant_3097_15 = bf16[] constant(0.8984)
  %convert.5016.5 = f32[] convert(%constant_3097_15), metadata={scheduling_name="convert.5016.5"}
  %broadcast.6128.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5016.5), dimensions={}, metadata={scheduling_name="broadcast.6128.22"}
  %multiply.2886.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4748.9, %broadcast.6128.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2886.11"}
  %add.3119.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2885.11, %multiply.2886.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3119.9"}
  %param_3.2709 = f32[] parameter(3), metadata={scheduling_name="param_3.2709"}
  %broadcast.6130.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_3.2709), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6130.22"}
  %multiply.2887.15 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4746.26, %convert.4746.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2887.15"}
  %constant_3103_15 = bf16[] constant(0.05005)
  %convert.5018.5 = f32[] convert(%constant_3103_15), metadata={scheduling_name="convert.5018.5"}
  %broadcast.6132.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5018.5), dimensions={}, metadata={scheduling_name="broadcast.6132.22"}
  %multiply.2888.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%multiply.2887.15, %broadcast.6132.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2888.11"}
  %param_2.3312 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3312"}
  %convert.4754.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.3312), metadata={scheduling_name="convert.4754.11"}
  %constant_3104_15 = bf16[] constant(0.9492)
  %convert.5020.5 = f32[] convert(%constant_3104_15), metadata={scheduling_name="convert.5020.5"}
  %broadcast.6134.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5020.5), dimensions={}, metadata={scheduling_name="broadcast.6134.22"}
  %multiply.2889.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4754.11, %broadcast.6134.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2889.11"}
  %add.3120.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2888.11, %multiply.2889.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3120.9"}
  %param_1.4533 = f32[] parameter(1), metadata={scheduling_name="param_1.4533"}
  %broadcast.6136.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_1.4533), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6136.22"}
  %divide.524.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3120.9, %broadcast.6136.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.524.11"}
  %sqrt.97.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} sqrt(%divide.524.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.97.9"}
  %constant_3107_15 = bf16[] constant(1.001e-08)
  %convert.5023.5 = f32[] convert(%constant_3107_15), metadata={scheduling_name="convert.5023.5"}
  %broadcast.6138.14 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5023.5), dimensions={}, metadata={scheduling_name="broadcast.6138.14"}
  %add.3121.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%sqrt.97.9, %broadcast.6138.14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3121.7"}
  %multiply.2890.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6130.22, %add.3121.7), metadata={scheduling_name="multiply.2890.11"}
  %divide.525.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3119.9, %multiply.2890.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.525.9"}
  %multiply.2891.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4741.12, %broadcast.6126.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2891.7"}
  %add.3122.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%divide.525.9, %multiply.2891.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3122.7"}
  %multiply.2892.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6122.14, %add.3122.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2892.7"}
  %add.3123.5 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%convert.4741.12, %multiply.2892.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3123.5"}
  %convert.4760.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3123.5), metadata={scheduling_name="convert.4760.1"}
  %convert.4935.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3119.9), metadata={scheduling_name="convert.4935.1.clone.1"}
  %multiply.2977.1.clone.1 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%add.3123.5, %add.3123.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2977.1.clone.1"}
  %bitcast.29943.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2977.1.clone.1), metadata={scheduling_name="bitcast.29943.1.clone.1"}
  %constant_2882_131_clone_1 = f32[] constant(0)
  %reduce.691.1.clone.1 = f32[24576]{0} reduce(%bitcast.29943.1.clone.1, %constant_2882_131_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.691.1.clone.1"}
  %convert.4964.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3120.9), metadata={scheduling_name="convert.4964.1.clone.1"}
  %bitcast.29503.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2887.15), metadata={scheduling_name="bitcast.29503.1.clone.1"}
  %reduce.655.1.clone.1 = f32[24576]{0} reduce(%bitcast.29503.1.clone.1, %constant_2882_131_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.655.1.clone.1"}
  ROOT %tuple.636 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4760.1, %convert.4935.1.clone.1, %reduce.691.1.clone.1, %convert.4964.1.clone.1, %reduce.655.1.clone.1), metadata={scheduling_name="tuple.636"}
}

%fused_transpose.24 (param_0.4343: bf16[768,32768], param_1.6369: f32[], param_2.4603: f32[], param_3.3774: f32[], param_4.2757: bf16[768,32768], param_5.2529: bf16[768,32768], param_6.2291: bf16[32768,768]) -> f32[768,32768] {
  %param_0.4343 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.4343"}
  %convert.4883.1 = f32[768,32768]{1,0} convert(%param_0.4343), metadata={scheduling_name="convert.4883.1"}
  %param_1.6369 = f32[] parameter(1), metadata={scheduling_name="param_1.6369"}
  %broadcast.6050.4 = f32[768,32768]{1,0} broadcast(%param_1.6369), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6050.4"}
  %param_5.2529 = bf16[768,32768]{1,0} parameter(5), metadata={scheduling_name="param_5.2529"}
  %convert.4890.14 = f32[768,32768]{1,0} convert(%param_5.2529), metadata={scheduling_name="convert.4890.14"}
  %constant_3096_12 = bf16[] constant(0.1001)
  %convert.5015.70 = f32[] convert(%constant_3096_12), metadata={scheduling_name="convert.5015.70"}
  %broadcast.6054.28 = f32[768,32768]{1,0} broadcast(%convert.5015.70), dimensions={}, metadata={scheduling_name="broadcast.6054.28"}
  %multiply.2947.7 = f32[768,32768]{1,0} multiply(%convert.4890.14, %broadcast.6054.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2947.7"}
  %param_4.2757 = bf16[768,32768]{1,0} parameter(4), metadata={scheduling_name="param_4.2757"}
  %convert.4893.5 = f32[768,32768]{1,0} convert(%param_4.2757), metadata={scheduling_name="convert.4893.5"}
  %constant_3097_12 = bf16[] constant(0.8984)
  %convert.5016.41 = f32[] convert(%constant_3097_12), metadata={scheduling_name="convert.5016.41"}
  %broadcast.6056.17 = f32[768,32768]{1,0} broadcast(%convert.5016.41), dimensions={}, metadata={scheduling_name="broadcast.6056.17"}
  %multiply.2948.7 = f32[768,32768]{1,0} multiply(%convert.4893.5, %broadcast.6056.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2948.7"}
  %add.3155.5 = f32[768,32768]{1,0} add(%multiply.2947.7, %multiply.2948.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3155.5"}
  %param_3.3774 = f32[] parameter(3), metadata={scheduling_name="param_3.3774"}
  %broadcast.6058.10 = f32[768,32768]{1,0} broadcast(%param_3.3774), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6058.10"}
  %multiply.2950.11 = f32[768,32768]{1,0} multiply(%convert.4890.14, %convert.4890.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2950.11"}
  %constant_3103_12 = bf16[] constant(0.05005)
  %convert.5018.41 = f32[] convert(%constant_3103_12), metadata={scheduling_name="convert.5018.41"}
  %broadcast.6060.17 = f32[768,32768]{1,0} broadcast(%convert.5018.41), dimensions={}, metadata={scheduling_name="broadcast.6060.17"}
  %multiply.2951.7 = f32[768,32768]{1,0} multiply(%multiply.2950.11, %broadcast.6060.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2951.7"}
  %param_6.2291 = bf16[32768,768]{1,0} parameter(6), metadata={scheduling_name="param_6.2291"}
  %transpose.777.1 = bf16[768,32768]{1,0} transpose(%param_6.2291), dimensions={1,0}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.777.1"}
  %convert.4902.5 = f32[768,32768]{1,0} convert(%transpose.777.1), metadata={scheduling_name="convert.4902.5"}
  %constant_3104_12 = bf16[] constant(0.9492)
  %convert.5020.41 = f32[] convert(%constant_3104_12), metadata={scheduling_name="convert.5020.41"}
  %broadcast.6062.17 = f32[768,32768]{1,0} broadcast(%convert.5020.41), dimensions={}, metadata={scheduling_name="broadcast.6062.17"}
  %multiply.2952.7 = f32[768,32768]{1,0} multiply(%convert.4902.5, %broadcast.6062.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2952.7"}
  %add.3156.5 = f32[768,32768]{1,0} add(%multiply.2951.7, %multiply.2952.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3156.5"}
  %param_2.4603 = f32[] parameter(2), metadata={scheduling_name="param_2.4603"}
  %broadcast.6064.18 = f32[768,32768]{1,0} broadcast(%param_2.4603), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6064.18"}
  %divide.545.9 = f32[768,32768]{1,0} divide(%add.3156.5, %broadcast.6064.18), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.545.9"}
  %sqrt.104.7 = f32[768,32768]{1,0} sqrt(%divide.545.9), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.104.7"}
  %constant_3107_12 = bf16[] constant(1.001e-08)
  %convert.5023.28 = f32[] convert(%constant_3107_12), metadata={scheduling_name="convert.5023.28"}
  %broadcast.6066.10 = f32[768,32768]{1,0} broadcast(%convert.5023.28), dimensions={}, metadata={scheduling_name="broadcast.6066.10"}
  %add.3157.5 = f32[768,32768]{1,0} add(%sqrt.104.7, %broadcast.6066.10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3157.5"}
  %multiply.2954.5 = f32[768,32768]{1,0} multiply(%broadcast.6058.10, %add.3157.5), metadata={scheduling_name="multiply.2954.5"}
  %divide.546.3 = f32[768,32768]{1,0} divide(%add.3155.5, %multiply.2954.5), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.546.3"}
  %multiply.2955.7 = f32[768,32768]{1,0} multiply(%convert.4883.1, %broadcast.6054.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2955.7"}
  %add.3158.5 = f32[768,32768]{1,0} add(%divide.546.3, %multiply.2955.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3158.5"}
  %multiply.2956.3 = f32[768,32768]{1,0} multiply(%broadcast.6050.4, %add.3158.5), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2956.3"}
  ROOT %add.3159.1 = f32[768,32768]{1,0} add(%convert.4883.1, %multiply.2956.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3159.1"}
}

%fused_select_transpose (param_0.6069: bf16[32768,768], param_1.6468: bf16[768,32768], param_2.4743: f32[], param_3.3956: bf16[32768,768], param_4.2923: pred[]) -> (bf16[32768,768], bf16[32768,768], bf16[768,32768]) {
  %param_4.2923 = pred[] parameter(4), metadata={scheduling_name="param_4.2923"}
  %broadcast.5809.1.clone.1 = pred[768,32768]{1,0} broadcast(%param_4.2923), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5809.1.clone.1"}
  %param_3.3956 = bf16[32768,768]{0,1} parameter(3), metadata={scheduling_name="param_3.3956"}
  %bitcast.27125.2.clone.1 = bf16[768,32768]{1,0} bitcast(%param_3.3956), metadata={scheduling_name="bitcast.27125.2.clone.1"}
  %convert.4388.11.clone.1 = f32[768,32768]{1,0} convert(%bitcast.27125.2.clone.1), metadata={scheduling_name="convert.4388.11.clone.1"}
  %param_2.4743 = f32[] parameter(2), metadata={scheduling_name="param_2.4743"}
  %broadcast.6052.10.clone.1 = f32[768,32768]{1,0} broadcast(%param_2.4743), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6052.10.clone.1"}
  %divide.544.5.clone.1 = f32[768,32768]{1,0} divide(%convert.4388.11.clone.1, %broadcast.6052.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.544.5.clone.1"}
  %convert.4889.3.clone.1 = bf16[768,32768]{1,0} convert(%divide.544.5.clone.1), metadata={scheduling_name="convert.4889.3.clone.1"}
  %select.1385.1.clone.1 = bf16[768,32768]{1,0} select(%broadcast.5809.1.clone.1, %bitcast.27125.2.clone.1, %convert.4889.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1385.1.clone.1"}
  %convert.4890.20 = f32[768,32768]{1,0} convert(%select.1385.1.clone.1), metadata={scheduling_name="convert.4890.20"}
  %multiply.2950.13 = f32[768,32768]{1,0} multiply(%convert.4890.20, %convert.4890.20), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2950.13"}
  %constant_3103_37 = bf16[] constant(0.05005)
  %convert.5018.51 = f32[] convert(%constant_3103_37), metadata={scheduling_name="convert.5018.51"}
  %broadcast.6060.19 = f32[768,32768]{1,0} broadcast(%convert.5018.51), dimensions={}, metadata={scheduling_name="broadcast.6060.19"}
  %multiply.2951.9 = f32[768,32768]{1,0} multiply(%multiply.2950.13, %broadcast.6060.19), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2951.9"}
  %param_0.6069 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6069"}
  %transpose.777.2 = bf16[768,32768]{1,0} transpose(%param_0.6069), dimensions={1,0}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.777.2"}
  %convert.4902.7 = f32[768,32768]{1,0} convert(%transpose.777.2), metadata={scheduling_name="convert.4902.7"}
  %constant_3104_37 = bf16[] constant(0.9492)
  %convert.5020.51 = f32[] convert(%constant_3104_37), metadata={scheduling_name="convert.5020.51"}
  %broadcast.6062.19 = f32[768,32768]{1,0} broadcast(%convert.5020.51), dimensions={}, metadata={scheduling_name="broadcast.6062.19"}
  %multiply.2952.9 = f32[768,32768]{1,0} multiply(%convert.4902.7, %broadcast.6062.19), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2952.9"}
  %add.3156.7 = f32[768,32768]{1,0} add(%multiply.2951.9, %multiply.2952.9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3156.7"}
  %convert.4971.3 = bf16[768,32768]{1,0} convert(%add.3156.7), metadata={scheduling_name="convert.4971.3"}
  %transpose.780.1 = bf16[32768,768]{1,0} transpose(%convert.4971.3), dimensions={1,0}, metadata={scheduling_name="transpose.780.1"}
  %constant_3096_3_clone_1 = bf16[] constant(0.1001)
  %convert.5015.88.clone.1 = f32[] convert(%constant_3096_3_clone_1), metadata={scheduling_name="convert.5015.88.clone.1"}
  %broadcast.6054.30.clone.1 = f32[768,32768]{1,0} broadcast(%convert.5015.88.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6054.30.clone.1"}
  %multiply.2947.9.clone.1 = f32[768,32768]{1,0} multiply(%convert.4890.20, %broadcast.6054.30.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2947.9.clone.1"}
  %param_1.6468 = bf16[768,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6468"}
  %convert.4893.7.clone.1 = f32[768,32768]{1,0} convert(%param_1.6468), metadata={scheduling_name="convert.4893.7.clone.1"}
  %constant_3097_37_clone_1 = bf16[] constant(0.8984)
  %convert.5016.51.clone.1 = f32[] convert(%constant_3097_37_clone_1), metadata={scheduling_name="convert.5016.51.clone.1"}
  %broadcast.6056.19.clone.1 = f32[768,32768]{1,0} broadcast(%convert.5016.51.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6056.19.clone.1"}
  %multiply.2948.9.clone.1 = f32[768,32768]{1,0} multiply(%convert.4893.7.clone.1, %broadcast.6056.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2948.9.clone.1"}
  %add.3155.7.clone.1 = f32[768,32768]{1,0} add(%multiply.2947.9.clone.1, %multiply.2948.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3155.7.clone.1"}
  %convert.4946.3.clone.1 = bf16[768,32768]{1,0} convert(%add.3155.7.clone.1), metadata={scheduling_name="convert.4946.3.clone.1"}
  %transpose.779.1.clone.1 = bf16[32768,768]{1,0} transpose(%convert.4946.3.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.779.1.clone.1"}
  ROOT %tuple.553 = (bf16[32768,768]{1,0}, bf16[32768,768]{1,0}, bf16[768,32768]{1,0}) tuple(%transpose.780.1, %transpose.779.1.clone.1, %select.1385.1.clone.1), metadata={scheduling_name="tuple.553"}
}

%fused_transpose.25 (param_0.4509: f32[768,32768]) -> bf16[32768,768] {
  %param_0.4509 = f32[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.4509"}
  %convert.4911.1 = bf16[768,32768]{1,0} convert(%param_0.4509), metadata={scheduling_name="convert.4911.1"}
  ROOT %transpose.778.1 = bf16[32768,768]{1,0} transpose(%convert.4911.1), dimensions={1,0}, metadata={scheduling_name="transpose.778.1"}
}

%fused_convert_reduce.16 (param_0.6002: bf16[768,32768], param_1.6423: f32[], param_2.4602: bf16[768,32768], param_3.3773: f32[], param_4.2755: bf16[768,32768], param_5.2527: bf16[768,32768], param_6.2289: f32[], param_7.2122: pred[], param_8.1959: f32[]) -> (bf16[768,32768], bf16[768,32768], f32[4096], bf16[768,32768], f32[4096]) {
  %param_0.6002 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.6002"}
  %convert.4413.16 = f32[768,32768]{1,0} convert(%param_0.6002), metadata={scheduling_name="convert.4413.16"}
  %param_8.1959 = f32[] parameter(8), metadata={scheduling_name="param_8.1959"}
  %broadcast.6050.10 = f32[768,32768]{1,0} broadcast(%param_8.1959), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6050.10"}
  %param_7.2122 = pred[] parameter(7), metadata={scheduling_name="param_7.2122"}
  %broadcast.5809.14 = pred[768,32768]{1,0} broadcast(%param_7.2122), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5809.14"}
  %param_5.2527 = bf16[768,32768]{1,0} parameter(5), metadata={scheduling_name="param_5.2527"}
  %convert.4343.20 = f32[768,32768]{1,0} convert(%param_5.2527), metadata={scheduling_name="convert.4343.20"}
  %param_6.2289 = f32[] parameter(6), metadata={scheduling_name="param_6.2289"}
  %broadcast.6052.22 = f32[768,32768]{1,0} broadcast(%param_6.2289), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6052.22"}
  %divide.481.17 = f32[768,32768]{1,0} divide(%convert.4343.20, %broadcast.6052.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.481.17"}
  %convert.4417.15 = bf16[768,32768]{1,0} convert(%divide.481.17), metadata={scheduling_name="convert.4417.15"}
  %select.1364.13 = bf16[768,32768]{1,0} select(%broadcast.5809.14, %param_5.2527, %convert.4417.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1364.13"}
  %convert.4418.26 = f32[768,32768]{1,0} convert(%select.1364.13), metadata={scheduling_name="convert.4418.26"}
  %constant_3096_31 = bf16[] constant(0.1001)
  %convert.5015.144 = f32[] convert(%constant_3096_31), metadata={scheduling_name="convert.5015.144"}
  %broadcast.6054.38 = f32[768,32768]{1,0} broadcast(%convert.5015.144), dimensions={}, metadata={scheduling_name="broadcast.6054.38"}
  %multiply.2773.11 = f32[768,32768]{1,0} multiply(%convert.4418.26, %broadcast.6054.38), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2773.11"}
  %param_4.2755 = bf16[768,32768]{1,0} parameter(4), metadata={scheduling_name="param_4.2755"}
  %convert.4420.9 = f32[768,32768]{1,0} convert(%param_4.2755), metadata={scheduling_name="convert.4420.9"}
  %constant_3097_35 = bf16[] constant(0.8984)
  %convert.5016.79 = f32[] convert(%constant_3097_35), metadata={scheduling_name="convert.5016.79"}
  %broadcast.6056.23 = f32[768,32768]{1,0} broadcast(%convert.5016.79), dimensions={}, metadata={scheduling_name="broadcast.6056.23"}
  %multiply.2774.11 = f32[768,32768]{1,0} multiply(%convert.4420.9, %broadcast.6056.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2774.11"}
  %add.3045.9 = f32[768,32768]{1,0} add(%multiply.2773.11, %multiply.2774.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3045.9"}
  %param_3.3773 = f32[] parameter(3), metadata={scheduling_name="param_3.3773"}
  %broadcast.6058.14 = f32[768,32768]{1,0} broadcast(%param_3.3773), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6058.14"}
  %multiply.2775.15 = f32[768,32768]{1,0} multiply(%convert.4418.26, %convert.4418.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2775.15"}
  %constant_3103_35 = bf16[] constant(0.05005)
  %convert.5018.79 = f32[] convert(%constant_3103_35), metadata={scheduling_name="convert.5018.79"}
  %broadcast.6060.23 = f32[768,32768]{1,0} broadcast(%convert.5018.79), dimensions={}, metadata={scheduling_name="broadcast.6060.23"}
  %multiply.2776.11 = f32[768,32768]{1,0} multiply(%multiply.2775.15, %broadcast.6060.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2776.11"}
  %param_2.4602 = bf16[768,32768]{1,0} parameter(2), metadata={scheduling_name="param_2.4602"}
  %convert.4426.9 = f32[768,32768]{1,0} convert(%param_2.4602), metadata={scheduling_name="convert.4426.9"}
  %constant_3104_35 = bf16[] constant(0.9492)
  %convert.5020.79 = f32[] convert(%constant_3104_35), metadata={scheduling_name="convert.5020.79"}
  %broadcast.6062.23 = f32[768,32768]{1,0} broadcast(%convert.5020.79), dimensions={}, metadata={scheduling_name="broadcast.6062.23"}
  %multiply.2777.11 = f32[768,32768]{1,0} multiply(%convert.4426.9, %broadcast.6062.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2777.11"}
  %add.3046.9 = f32[768,32768]{1,0} add(%multiply.2776.11, %multiply.2777.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3046.9"}
  %param_1.6423 = f32[] parameter(1), metadata={scheduling_name="param_1.6423"}
  %broadcast.6064.22 = f32[768,32768]{1,0} broadcast(%param_1.6423), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6064.22"}
  %divide.482.13 = f32[768,32768]{1,0} divide(%add.3046.9, %broadcast.6064.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.482.13"}
  %sqrt.83.11 = f32[768,32768]{1,0} sqrt(%divide.482.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.83.11"}
  %constant_3107_3 = bf16[] constant(1.001e-08)
  %convert.5023.56 = f32[] convert(%constant_3107_3), metadata={scheduling_name="convert.5023.56"}
  %broadcast.6066.14 = f32[768,32768]{1,0} broadcast(%convert.5023.56), dimensions={}, metadata={scheduling_name="broadcast.6066.14"}
  %add.3047.9 = f32[768,32768]{1,0} add(%sqrt.83.11, %broadcast.6066.14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3047.9"}
  %multiply.2778.9 = f32[768,32768]{1,0} multiply(%broadcast.6058.14, %add.3047.9), metadata={scheduling_name="multiply.2778.9"}
  %divide.483.7 = f32[768,32768]{1,0} divide(%add.3045.9, %multiply.2778.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.483.7"}
  %multiply.2779.11 = f32[768,32768]{1,0} multiply(%convert.4413.16, %broadcast.6054.38), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2779.11"}
  %add.3048.9 = f32[768,32768]{1,0} add(%divide.483.7, %multiply.2779.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3048.9"}
  %multiply.2780.7 = f32[768,32768]{1,0} multiply(%broadcast.6050.10, %add.3048.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2780.7"}
  %add.3049.5 = f32[768,32768]{1,0} add(%convert.4413.16, %multiply.2780.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3049.5"}
  %convert.4432.1 = bf16[768,32768]{1,0} convert(%add.3049.5), metadata={scheduling_name="convert.4432.1"}
  %convert.4914.1.clone.1 = bf16[768,32768]{1,0} convert(%add.3045.9), metadata={scheduling_name="convert.4914.1.clone.1"}
  %multiply.2961.1.clone.1 = f32[768,32768]{1,0} multiply(%add.3049.5, %add.3049.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2961.1.clone.1"}
  %bitcast.29687.1.clone.1 = f32[4096,6144]{1,0} bitcast(%multiply.2961.1.clone.1), metadata={scheduling_name="bitcast.29687.1.clone.1"}
  %constant_2882_121_clone_1 = f32[] constant(0)
  %reduce.671.1.clone.1 = f32[4096]{0} reduce(%bitcast.29687.1.clone.1, %constant_2882_121_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.671.1.clone.1"}
  %convert.4949.1.clone.1 = bf16[768,32768]{1,0} convert(%add.3046.9), metadata={scheduling_name="convert.4949.1.clone.1"}
  %bitcast.29261.1.clone.1 = f32[4096,6144]{1,0} bitcast(%multiply.2775.15), metadata={scheduling_name="bitcast.29261.1.clone.1"}
  %reduce.635.1.clone.1 = f32[4096]{0} reduce(%bitcast.29261.1.clone.1, %constant_2882_121_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.635.1.clone.1"}
  ROOT %tuple.627 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}, f32[4096]{0}, bf16[768,32768]{1,0}, f32[4096]{0}) tuple(%convert.4432.1, %convert.4914.1.clone.1, %reduce.671.1.clone.1, %convert.4949.1.clone.1, %reduce.635.1.clone.1), metadata={scheduling_name="tuple.627"}
}

%fused_convert_reduce.17 (param_0.6004: bf16[2,1,48,128,768], param_1.6428: f32[], param_2.4610: bf16[2,1,48,128,768], param_3.3781: bf16[2,1,48,128,768], param_4.2764: f32[], param_5.2536: bf16[2,1,48,128,768], param_6.2298: f32[]) -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768], f32[2048], bf16[2,1,48,128,768], f32[2048]) {
  %param_0.6004 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6004"}
  %convert.4573.16 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.6004), metadata={scheduling_name="convert.4573.16"}
  %param_6.2298 = f32[] parameter(6), metadata={scheduling_name="param_6.2298"}
  %broadcast.6194.10 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_6.2298), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.10"}
  %param_3.3781 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(3), metadata={scheduling_name="param_3.3781"}
  %convert.4578.26 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_3.3781), metadata={scheduling_name="convert.4578.26"}
  %constant_3096_42 = bf16[] constant(0.1001)
  %convert.5015.168 = f32[] convert(%constant_3096_42), metadata={scheduling_name="convert.5015.168"}
  %broadcast.6198.41 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5015.168), dimensions={}, metadata={scheduling_name="broadcast.6198.41"}
  %multiply.2837.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4578.26, %broadcast.6198.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2837.11"}
  %param_5.2536 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2536"}
  %convert.4580.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_5.2536), metadata={scheduling_name="convert.4580.9"}
  %constant_3097_39 = bf16[] constant(0.8984)
  %convert.5016.91 = f32[] convert(%constant_3097_39), metadata={scheduling_name="convert.5016.91"}
  %broadcast.6200.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5016.91), dimensions={}, metadata={scheduling_name="broadcast.6200.21"}
  %multiply.2838.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4580.9, %broadcast.6200.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2838.11"}
  %add.3089.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2837.11, %multiply.2838.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3089.9"}
  %param_4.2764 = f32[] parameter(4), metadata={scheduling_name="param_4.2764"}
  %broadcast.6202.14 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_4.2764), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6202.14"}
  %multiply.2839.15 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4578.26, %convert.4578.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2839.15"}
  %constant_3103_39 = bf16[] constant(0.05005)
  %convert.5018.91 = f32[] convert(%constant_3103_39), metadata={scheduling_name="convert.5018.91"}
  %broadcast.6204.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5018.91), dimensions={}, metadata={scheduling_name="broadcast.6204.21"}
  %multiply.2840.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%multiply.2839.15, %broadcast.6204.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2840.11"}
  %param_2.4610 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4610"}
  %convert.4586.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_2.4610), metadata={scheduling_name="convert.4586.9"}
  %constant_3104_39 = bf16[] constant(0.9492)
  %convert.5020.91 = f32[] convert(%constant_3104_39), metadata={scheduling_name="convert.5020.91"}
  %broadcast.6206.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5020.91), dimensions={}, metadata={scheduling_name="broadcast.6206.21"}
  %multiply.2841.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4586.9, %broadcast.6206.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2841.11"}
  %add.3090.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2840.11, %multiply.2841.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3090.9"}
  %param_1.6428 = f32[] parameter(1), metadata={scheduling_name="param_1.6428"}
  %broadcast.6208.22 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_1.6428), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6208.22"}
  %divide.506.13 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3090.9, %broadcast.6208.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.506.13"}
  %sqrt.91.11 = f32[2,1,48,128,768]{4,3,2,1,0} sqrt(%divide.506.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.91.11"}
  %constant_3107_31 = bf16[] constant(1.001e-08)
  %convert.5023.68 = f32[] convert(%constant_3107_31), metadata={scheduling_name="convert.5023.68"}
  %broadcast.6210.17 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5023.68), dimensions={}, metadata={scheduling_name="broadcast.6210.17"}
  %add.3091.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%sqrt.91.11, %broadcast.6210.17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3091.9"}
  %multiply.2842.9 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6202.14, %add.3091.9), metadata={scheduling_name="multiply.2842.9"}
  %divide.507.7 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3089.9, %multiply.2842.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.507.7"}
  %multiply.2843.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4573.16, %broadcast.6198.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2843.11"}
  %add.3092.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%divide.507.7, %multiply.2843.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3092.9"}
  %multiply.2844.7 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6194.10, %add.3092.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2844.7"}
  %add.3093.5 = f32[2,1,48,128,768]{4,3,2,1,0} add(%convert.4573.16, %multiply.2844.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3093.5"}
  %convert.4592.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3093.5), metadata={scheduling_name="convert.4592.1"}
  %convert.4926.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3089.9), metadata={scheduling_name="convert.4926.1.clone.1"}
  %multiply.2971.1.clone.1 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%add.3093.5, %add.3093.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2971.1.clone.1"}
  %bitcast.29831.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2971.1.clone.1), metadata={scheduling_name="bitcast.29831.1.clone.1"}
  %constant_2882_126_clone_1 = f32[] constant(0)
  %reduce.681.1.clone.1 = f32[2048]{0} reduce(%bitcast.29831.1.clone.1, %constant_2882_126_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.681.1.clone.1"}
  %convert.4958.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3090.9), metadata={scheduling_name="convert.4958.1.clone.1"}
  %bitcast.29397.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2839.15), metadata={scheduling_name="bitcast.29397.1.clone.1"}
  %reduce.645.1.clone.1 = f32[2048]{0} reduce(%bitcast.29397.1.clone.1, %constant_2882_126_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.645.1.clone.1"}
  ROOT %tuple.597 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4592.1, %convert.4926.1.clone.1, %reduce.681.1.clone.1, %convert.4958.1.clone.1, %reduce.645.1.clone.1), metadata={scheduling_name="tuple.597"}
}

%fused_convert_reduce.18 (param_0.6000: bf16[2,1,48,128,768], param_1.6425: f32[], param_2.4607: bf16[2,1,48,128,768], param_3.3778: bf16[2,1,48,128,768], param_4.2761: f32[], param_5.2533: bf16[2,1,48,128,768], param_6.2295: f32[]) -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768], f32[2048], bf16[2,1,48,128,768], f32[2048]) {
  %param_0.6000 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6000"}
  %convert.4821.16 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.6000), metadata={scheduling_name="convert.4821.16"}
  %param_6.2295 = f32[] parameter(6), metadata={scheduling_name="param_6.2295"}
  %broadcast.6194.14 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_6.2295), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.14"}
  %param_3.3778 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(3), metadata={scheduling_name="param_3.3778"}
  %convert.4826.26 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_3.3778), metadata={scheduling_name="convert.4826.26"}
  %constant_3096_18 = bf16[] constant(0.1001)
  %convert.5015.176 = f32[] convert(%constant_3096_18), metadata={scheduling_name="convert.5015.176"}
  %broadcast.6198.49 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5015.176), dimensions={}, metadata={scheduling_name="broadcast.6198.49"}
  %multiply.2922.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4826.26, %broadcast.6198.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2922.11"}
  %param_5.2533 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2533"}
  %convert.4828.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_5.2533), metadata={scheduling_name="convert.4828.9"}
  %constant_3097_18 = bf16[] constant(0.8984)
  %convert.5016.95 = f32[] convert(%constant_3097_18), metadata={scheduling_name="convert.5016.95"}
  %broadcast.6200.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5016.95), dimensions={}, metadata={scheduling_name="broadcast.6200.25"}
  %multiply.2923.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4828.9, %broadcast.6200.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2923.11"}
  %add.3139.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2922.11, %multiply.2923.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3139.9"}
  %param_4.2761 = f32[] parameter(4), metadata={scheduling_name="param_4.2761"}
  %broadcast.6202.18 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_4.2761), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6202.18"}
  %multiply.2924.15 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4826.26, %convert.4826.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2924.15"}
  %constant_3103_18 = bf16[] constant(0.05005)
  %convert.5018.95 = f32[] convert(%constant_3103_18), metadata={scheduling_name="convert.5018.95"}
  %broadcast.6204.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5018.95), dimensions={}, metadata={scheduling_name="broadcast.6204.25"}
  %multiply.2925.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%multiply.2924.15, %broadcast.6204.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2925.11"}
  %param_2.4607 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4607"}
  %convert.4834.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_2.4607), metadata={scheduling_name="convert.4834.9"}
  %constant_3104_18 = bf16[] constant(0.9492)
  %convert.5020.95 = f32[] convert(%constant_3104_18), metadata={scheduling_name="convert.5020.95"}
  %broadcast.6206.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5020.95), dimensions={}, metadata={scheduling_name="broadcast.6206.25"}
  %multiply.2926.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4834.9, %broadcast.6206.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2926.11"}
  %add.3140.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2925.11, %multiply.2926.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3140.9"}
  %param_1.6425 = f32[] parameter(1), metadata={scheduling_name="param_1.6425"}
  %broadcast.6208.26 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_1.6425), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6208.26"}
  %divide.536.13 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3140.9, %broadcast.6208.26), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.536.13"}
  %sqrt.101.11 = f32[2,1,48,128,768]{4,3,2,1,0} sqrt(%divide.536.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.101.11"}
  %constant_3107_18 = bf16[] constant(1.001e-08)
  %convert.5023.72 = f32[] convert(%constant_3107_18), metadata={scheduling_name="convert.5023.72"}
  %broadcast.6210.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5023.72), dimensions={}, metadata={scheduling_name="broadcast.6210.21"}
  %add.3141.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%sqrt.101.11, %broadcast.6210.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3141.9"}
  %multiply.2928.9 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6202.18, %add.3141.9), metadata={scheduling_name="multiply.2928.9"}
  %divide.537.7 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3139.9, %multiply.2928.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.537.7"}
  %multiply.2929.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4821.16, %broadcast.6198.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2929.11"}
  %add.3143.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%divide.537.7, %multiply.2929.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3143.9"}
  %multiply.2930.7 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6194.14, %add.3143.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2930.7"}
  %add.3144.5 = f32[2,1,48,128,768]{4,3,2,1,0} add(%convert.4821.16, %multiply.2930.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3144.5"}
  %convert.4840.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3144.5), metadata={scheduling_name="convert.4840.1"}
  %convert.4941.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3139.9), metadata={scheduling_name="convert.4941.1.clone.1"}
  %multiply.2981.1.clone.1 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%add.3144.5, %add.3144.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2981.1.clone.1"}
  %bitcast.30011.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2981.1.clone.1), metadata={scheduling_name="bitcast.30011.1.clone.1"}
  %constant_2882_133_clone_1 = f32[] constant(0)
  %reduce.695.1.clone.1 = f32[2048]{0} reduce(%bitcast.30011.1.clone.1, %constant_2882_133_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.695.1.clone.1"}
  %convert.4968.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3140.9), metadata={scheduling_name="convert.4968.1.clone.1"}
  %bitcast.29567.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2924.15), metadata={scheduling_name="bitcast.29567.1.clone.1"}
  %reduce.659.1.clone.1 = f32[2048]{0} reduce(%bitcast.29567.1.clone.1, %constant_2882_133_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.659.1.clone.1"}
  ROOT %tuple.563 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4840.1, %convert.4941.1.clone.1, %reduce.695.1.clone.1, %convert.4968.1.clone.1, %reduce.659.1.clone.1), metadata={scheduling_name="tuple.563"}
}

%fused_convert_reduce.19 (param_0.6003: bf16[2,1,768,48,128], param_1.6427: f32[], param_2.4609: bf16[2,1,768,48,128], param_3.3780: f32[], param_4.2763: bf16[2,1,768,48,128], param_5.2535: bf16[2,1,768,48,128], param_6.2297: f32[], param_7.2126: pred[], param_8.1963: f32[]) -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128], f32[2048], bf16[2,1,768,48,128], f32[2048]) {
  %param_0.6003 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6003"}
  %convert.4593.16 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.6003), metadata={scheduling_name="convert.4593.16"}
  %param_8.1963 = f32[] parameter(8), metadata={scheduling_name="param_8.1963"}
  %broadcast.6214.10 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_8.1963), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6214.10"}
  %param_7.2126 = pred[] parameter(7), metadata={scheduling_name="param_7.2126"}
  %broadcast.5898.22 = pred[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_7.2126), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5898.22"}
  %param_5.2535 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2535"}
  %convert.4364.20 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_5.2535), metadata={scheduling_name="convert.4364.20"}
  %param_6.2297 = f32[] parameter(6), metadata={scheduling_name="param_6.2297"}
  %broadcast.6216.30 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_6.2297), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6216.30"}
  %divide.508.17 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%convert.4364.20, %broadcast.6216.30), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.508.17"}
  %convert.4599.15 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%divide.508.17), metadata={scheduling_name="convert.4599.15"}
  %select.1373.13 = bf16[2,1,768,48,128]{4,3,2,1,0} select(%broadcast.5898.22, %param_5.2535, %convert.4599.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1373.13"}
  %convert.4601.26 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%select.1373.13), metadata={scheduling_name="convert.4601.26"}
  %constant_3096_39 = bf16[] constant(0.1001)
  %convert.5015.184 = f32[] convert(%constant_3096_39), metadata={scheduling_name="convert.5015.184"}
  %broadcast.6218.41 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5015.184), dimensions={}, metadata={scheduling_name="broadcast.6218.41"}
  %multiply.2845.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4601.26, %broadcast.6218.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2845.11"}
  %param_4.2763 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2763"}
  %convert.4604.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_4.2763), metadata={scheduling_name="convert.4604.9"}
  %constant_3097_38 = bf16[] constant(0.8984)
  %convert.5016.99 = f32[] convert(%constant_3097_38), metadata={scheduling_name="convert.5016.99"}
  %broadcast.6220.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5016.99), dimensions={}, metadata={scheduling_name="broadcast.6220.21"}
  %multiply.2846.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4604.9, %broadcast.6220.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2846.11"}
  %add.3094.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2845.11, %multiply.2846.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3094.9"}
  %param_3.3780 = f32[] parameter(3), metadata={scheduling_name="param_3.3780"}
  %broadcast.6222.14 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_3.3780), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6222.14"}
  %multiply.2847.15 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4601.26, %convert.4601.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2847.15"}
  %constant_3103_38 = bf16[] constant(0.05005)
  %convert.5018.99 = f32[] convert(%constant_3103_38), metadata={scheduling_name="convert.5018.99"}
  %broadcast.6224.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5018.99), dimensions={}, metadata={scheduling_name="broadcast.6224.21"}
  %multiply.2848.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%multiply.2847.15, %broadcast.6224.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2848.11"}
  %param_2.4609 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4609"}
  %convert.4613.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_2.4609), metadata={scheduling_name="convert.4613.9"}
  %constant_3104_38 = bf16[] constant(0.9492)
  %convert.5020.99 = f32[] convert(%constant_3104_38), metadata={scheduling_name="convert.5020.99"}
  %broadcast.6226.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5020.99), dimensions={}, metadata={scheduling_name="broadcast.6226.21"}
  %multiply.2849.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4613.9, %broadcast.6226.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2849.11"}
  %add.3095.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2848.11, %multiply.2849.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3095.9"}
  %param_1.6427 = f32[] parameter(1), metadata={scheduling_name="param_1.6427"}
  %broadcast.6228.22 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_1.6427), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6228.22"}
  %divide.509.13 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3095.9, %broadcast.6228.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.509.13"}
  %sqrt.92.11 = f32[2,1,768,48,128]{4,3,2,1,0} sqrt(%divide.509.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.92.11"}
  %constant_3107_30 = bf16[] constant(1.001e-08)
  %convert.5023.76 = f32[] convert(%constant_3107_30), metadata={scheduling_name="convert.5023.76"}
  %broadcast.6230.17 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5023.76), dimensions={}, metadata={scheduling_name="broadcast.6230.17"}
  %add.3096.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%sqrt.92.11, %broadcast.6230.17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3096.9"}
  %multiply.2850.9 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6222.14, %add.3096.9), metadata={scheduling_name="multiply.2850.9"}
  %divide.510.7 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3094.9, %multiply.2850.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.510.7"}
  %multiply.2851.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4593.16, %broadcast.6218.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2851.11"}
  %add.3097.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%divide.510.7, %multiply.2851.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3097.9"}
  %multiply.2852.7 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6214.10, %add.3097.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2852.7"}
  %add.3098.5 = f32[2,1,768,48,128]{4,3,2,1,0} add(%convert.4593.16, %multiply.2852.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3098.5"}
  %convert.4622.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3098.5), metadata={scheduling_name="convert.4622.1"}
  %convert.4928.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3094.9), metadata={scheduling_name="convert.4928.1.clone.1"}
  %multiply.2972.1.clone.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%add.3098.5, %add.3098.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2972.1.clone.1"}
  %bitcast.29849.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2972.1.clone.1), metadata={scheduling_name="bitcast.29849.1.clone.1"}
  %constant_2882_127_clone_1 = f32[] constant(0)
  %reduce.683.1.clone.1 = f32[2048]{0} reduce(%bitcast.29849.1.clone.1, %constant_2882_127_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.683.1.clone.1"}
  %convert.4959.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3095.9), metadata={scheduling_name="convert.4959.1.clone.1"}
  %bitcast.29414.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2847.15), metadata={scheduling_name="bitcast.29414.1.clone.1"}
  %reduce.647.1.clone.1 = f32[2048]{0} reduce(%bitcast.29414.1.clone.1, %constant_2882_127_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.647.1.clone.1"}
  ROOT %tuple.632 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4622.1, %convert.4928.1.clone.1, %reduce.683.1.clone.1, %convert.4959.1.clone.1, %reduce.647.1.clone.1), metadata={scheduling_name="tuple.632"}
}

%fused_convert_reduce.20 (param_0.6001: bf16[2,1,768,48,128], param_1.6426: f32[], param_2.4608: bf16[2,1,768,48,128], param_3.3779: f32[], param_4.2762: bf16[2,1,768,48,128], param_5.2534: bf16[2,1,768,48,128], param_6.2296: f32[], param_7.2125: pred[], param_8.1962: f32[]) -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128], f32[2048], bf16[2,1,768,48,128], f32[2048]) {
  %param_0.6001 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6001"}
  %convert.4841.16 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.6001), metadata={scheduling_name="convert.4841.16"}
  %param_8.1962 = f32[] parameter(8), metadata={scheduling_name="param_8.1962"}
  %broadcast.6214.14 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_8.1962), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6214.14"}
  %param_7.2125 = pred[] parameter(7), metadata={scheduling_name="param_7.2125"}
  %broadcast.5898.26 = pred[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_7.2125), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5898.26"}
  %param_5.2534 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2534"}
  %convert.4384.20 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_5.2534), metadata={scheduling_name="convert.4384.20"}
  %param_6.2296 = f32[] parameter(6), metadata={scheduling_name="param_6.2296"}
  %broadcast.6216.34 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_6.2296), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6216.34"}
  %divide.538.17 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%convert.4384.20, %broadcast.6216.34), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.538.17"}
  %convert.4845.15 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%divide.538.17), metadata={scheduling_name="convert.4845.15"}
  %select.1383.13 = bf16[2,1,768,48,128]{4,3,2,1,0} select(%broadcast.5898.26, %param_5.2534, %convert.4845.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1383.13"}
  %convert.4846.26 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%select.1383.13), metadata={scheduling_name="convert.4846.26"}
  %constant_3096_19 = bf16[] constant(0.1001)
  %convert.5015.192 = f32[] convert(%constant_3096_19), metadata={scheduling_name="convert.5015.192"}
  %broadcast.6218.49 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5015.192), dimensions={}, metadata={scheduling_name="broadcast.6218.49"}
  %multiply.2931.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4846.26, %broadcast.6218.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2931.11"}
  %param_4.2762 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2762"}
  %convert.4848.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_4.2762), metadata={scheduling_name="convert.4848.9"}
  %constant_3097_19 = bf16[] constant(0.8984)
  %convert.5016.103 = f32[] convert(%constant_3097_19), metadata={scheduling_name="convert.5016.103"}
  %broadcast.6220.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5016.103), dimensions={}, metadata={scheduling_name="broadcast.6220.25"}
  %multiply.2932.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4848.9, %broadcast.6220.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2932.11"}
  %add.3145.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2931.11, %multiply.2932.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3145.9"}
  %param_3.3779 = f32[] parameter(3), metadata={scheduling_name="param_3.3779"}
  %broadcast.6222.18 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_3.3779), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6222.18"}
  %multiply.2933.15 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4846.26, %convert.4846.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2933.15"}
  %constant_3103_19 = bf16[] constant(0.05005)
  %convert.5018.103 = f32[] convert(%constant_3103_19), metadata={scheduling_name="convert.5018.103"}
  %broadcast.6224.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5018.103), dimensions={}, metadata={scheduling_name="broadcast.6224.25"}
  %multiply.2934.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%multiply.2933.15, %broadcast.6224.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2934.11"}
  %param_2.4608 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4608"}
  %convert.4854.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_2.4608), metadata={scheduling_name="convert.4854.9"}
  %constant_3104_19 = bf16[] constant(0.9492)
  %convert.5020.103 = f32[] convert(%constant_3104_19), metadata={scheduling_name="convert.5020.103"}
  %broadcast.6226.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5020.103), dimensions={}, metadata={scheduling_name="broadcast.6226.25"}
  %multiply.2935.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4854.9, %broadcast.6226.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2935.11"}
  %add.3146.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2934.11, %multiply.2935.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3146.9"}
  %param_1.6426 = f32[] parameter(1), metadata={scheduling_name="param_1.6426"}
  %broadcast.6228.26 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_1.6426), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6228.26"}
  %divide.539.13 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3146.9, %broadcast.6228.26), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.539.13"}
  %sqrt.102.11 = f32[2,1,768,48,128]{4,3,2,1,0} sqrt(%divide.539.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.102.11"}
  %constant_3107_19 = bf16[] constant(1.001e-08)
  %convert.5023.80 = f32[] convert(%constant_3107_19), metadata={scheduling_name="convert.5023.80"}
  %broadcast.6230.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5023.80), dimensions={}, metadata={scheduling_name="broadcast.6230.21"}
  %add.3147.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%sqrt.102.11, %broadcast.6230.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3147.9"}
  %multiply.2936.9 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6222.18, %add.3147.9), metadata={scheduling_name="multiply.2936.9"}
  %divide.540.7 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3145.9, %multiply.2936.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.540.7"}
  %multiply.2937.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4841.16, %broadcast.6218.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2937.11"}
  %add.3148.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%divide.540.7, %multiply.2937.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3148.9"}
  %multiply.2938.7 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6214.14, %add.3148.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2938.7"}
  %add.3149.5 = f32[2,1,768,48,128]{4,3,2,1,0} add(%convert.4841.16, %multiply.2938.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3149.5"}
  %convert.4860.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3149.5), metadata={scheduling_name="convert.4860.1"}
  %convert.4943.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3145.9), metadata={scheduling_name="convert.4943.1.clone.1"}
  %multiply.2982.1.clone.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%add.3149.5, %add.3149.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2982.1.clone.1"}
  %bitcast.30029.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2982.1.clone.1), metadata={scheduling_name="bitcast.30029.1.clone.1"}
  %constant_2882_134_clone_1 = f32[] constant(0)
  %reduce.697.1.clone.1 = f32[2048]{0} reduce(%bitcast.30029.1.clone.1, %constant_2882_134_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.697.1.clone.1"}
  %convert.4969.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3146.9), metadata={scheduling_name="convert.4969.1.clone.1"}
  %bitcast.29584.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2933.15), metadata={scheduling_name="bitcast.29584.1.clone.1"}
  %reduce.661.1.clone.1 = f32[2048]{0} reduce(%bitcast.29584.1.clone.1, %constant_2882_134_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.661.1.clone.1"}
  ROOT %tuple.638 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4860.1, %convert.4943.1.clone.1, %reduce.697.1.clone.1, %convert.4969.1.clone.1, %reduce.661.1.clone.1), metadata={scheduling_name="tuple.638"}
}

%fused_select.2 (param_0.5995: s32[], param_1.6363: s32[8,8192]) -> f32[8,8192] {
  %param_1.6363 = s32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6363"}
  %constant_2840_7 = s32[] constant(0)
  %broadcast.5760.3 = s32[8,8192]{1,0} broadcast(%constant_2840_7), dimensions={}, metadata={scheduling_name="broadcast.5760.3"}
  %compare.1723.3 = pred[8,8192]{1,0} compare(%param_1.6363, %broadcast.5760.3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.3"}
  %constant_2838_4 = f32[] constant(1)
  %param_0.5995 = s32[] parameter(0), metadata={scheduling_name="param_0.5995"}
  %convert.4328.7 = f32[] convert(%param_0.5995), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="convert.4328.7"}
  %constant_2980_1 = f32[] constant(1e-08)
  %add.3012.7 = f32[] add(%convert.4328.7, %constant_2980_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="add.3012.7"}
  %divide.475.3 = f32[] divide(%constant_2838_4, %add.3012.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="divide.475.3"}
  %broadcast.5761.1 = f32[8,8192]{1,0} broadcast(%divide.475.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="broadcast.5761.1"}
  %constant_2882_146 = f32[] constant(0)
  %broadcast.5762.1 = f32[8,8192]{1,0} broadcast(%constant_2882_146), dimensions={}, metadata={scheduling_name="broadcast.5762.1"}
  ROOT %select.1361.1 = f32[8,8192]{1,0} select(%compare.1723.3, %broadcast.5761.1, %broadcast.5762.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="select.1361.1"}
}

%fused_multiply.6 (param_0.5998: f32[1,8,8192], param_1.6367: f32[8,8192], param_2.4525: f32[8,8192]) -> f32[1,8,8192] {
  %param_1.6367 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6367"}
  %bitcast.26556.3 = f32[1,8,8192]{2,1,0} bitcast(%param_1.6367), metadata={scheduling_name="bitcast.26556.3"}
  %param_0.5998 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5998"}
  %param_2.4525 = f32[8,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.4525"}
  %constant_2975_2 = f32[] constant(0.000162760422)
  %broadcast.5757.5 = f32[8,8192]{1,0} broadcast(%constant_2975_2), dimensions={}, metadata={scheduling_name="broadcast.5757.5"}
  %multiply.2728.5 = f32[8,8192]{1,0} multiply(%param_2.4525, %broadcast.5757.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2728.5"}
  %constant_2976_2 = f32[] constant(1e-05)
  %broadcast.5758.3 = f32[8,8192]{1,0} broadcast(%constant_2976_2), dimensions={}, metadata={scheduling_name="broadcast.5758.3"}
  %add.3010.3 = f32[8,8192]{1,0} add(%multiply.2728.5, %broadcast.5758.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3010.3"}
  %bitcast.26289.6 = f32[1,8,8192]{2,1,0} bitcast(%add.3010.3), metadata={scheduling_name="bitcast.26289.6"}
  %divide.477.5 = f32[1,8,8192]{2,1,0} divide(%param_0.5998, %bitcast.26289.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.477.5"}
  %constant_3011_1 = f32[] constant(-0.5)
  %broadcast.5795.5 = f32[1,8,8192]{2,1,0} broadcast(%constant_3011_1), dimensions={}, metadata={scheduling_name="broadcast.5795.5"}
  %multiply.2740.5 = f32[1,8,8192]{2,1,0} multiply(%divide.477.5, %broadcast.5795.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2740.5"}
  %multiply.2741.3 = f32[1,8,8192]{2,1,0} multiply(%bitcast.26556.3, %multiply.2740.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2741.3"}
  %constant_3012_1 = f32[] constant(0.000325520843)
  %broadcast.5796.1 = f32[1,8,8192]{2,1,0} broadcast(%constant_3012_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5796.1"}
  ROOT %multiply.2742.1 = f32[1,8,8192]{2,1,0} multiply(%multiply.2741.3, %broadcast.5796.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2742.1"}
}

%fused_add_log (param_0.6073: f32[65536], param_1.6472: f32[8,8192]) -> (f32[8,8192], f32[8,8192]) {
  %param_1.6472 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6472"}
  %log.6.1 = f32[8,8192]{1,0} log(%param_1.6472), metadata={op_name="jit(train_step)/jit(main)/log" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="log.6.1"}
  %param_0.6073 = f32[65536]{0} parameter(0), metadata={scheduling_name="param_0.6073"}
  %bitcast.26357.22 = f32[8,8192]{1,0} bitcast(%param_0.6073), metadata={scheduling_name="bitcast.26357.22"}
  %add.3013.5 = f32[8,8192]{1,0} add(%log.6.1, %bitcast.26357.22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="add.3013.5"}
  %constant_2882_3 = f32[] constant(0)
  %broadcast.5762.10 = f32[8,8192]{1,0} broadcast(%constant_2882_3), dimensions={}, metadata={scheduling_name="broadcast.5762.10"}
  %multiply.2731.3 = f32[8,8192]{1,0} multiply(%add.3013.5, %broadcast.5762.10), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2731.3"}
  %constant_2838_5 = f32[] constant(1)
  %broadcast.5767.1 = f32[8,8192]{1,0} broadcast(%constant_2838_5), dimensions={}, metadata={scheduling_name="broadcast.5767.1"}
  %add.3014.1 = f32[8,8192]{1,0} add(%multiply.2731.3, %broadcast.5767.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="add.3014.1"}
  ROOT %tuple.645 = (f32[8,8192]{1,0}, f32[8,8192]{1,0}) tuple(%add.3014.1, %log.6.1), metadata={scheduling_name="tuple.645"}
}

%fused_reduce.68 (param_0.5875: bf16[6144]) -> f32[] {
  %param_0.5875 = bf16[6144]{0} parameter(0), metadata={scheduling_name="param_0.5875"}
  %convert.4341.4 = f32[6144]{0} convert(%param_0.5875), metadata={scheduling_name="convert.4341.4"}
  %multiply.2735.3 = f32[6144]{0} multiply(%convert.4341.4, %convert.4341.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2735.3"}
  %constant_2882_30 = f32[] constant(0)
  ROOT %reduce.183.1 = f32[] reduce(%multiply.2735.3, %constant_2882_30), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.183.1"}
}

%fused_convert_reduce.21 (param_0.5927: f32[6144]) -> (f32[], bf16[6144]) {
  %param_0.5927 = f32[6144]{0} parameter(0), metadata={scheduling_name="param_0.5927"}
  %multiply.2960.1 = f32[6144]{0} multiply(%param_0.5927, %param_0.5927), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2960.1"}
  %constant_2882_82 = f32[] constant(0)
  %reduce.232.1 = f32[] reduce(%multiply.2960.1, %constant_2882_82), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.232.1"}
  %convert.4412.1 = bf16[6144]{0} convert(%param_0.5927), metadata={scheduling_name="convert.4412.1"}
  ROOT %tuple.625 = (f32[], bf16[6144]{0}) tuple(%reduce.232.1, %convert.4412.1), metadata={scheduling_name="tuple.625"}
}

%fused_add_convert_reduce.1 (param_0.5506: bf16[2,1,6144], param_1.5942: f32[], param_2.4605: f32[], param_3.3776: f32[], param_4.2759: bf16[2,1,6144], param_5.2531: bf16[2,1,6144], param_6.2293: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5506 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5506"}
  %convert.4781.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5506), metadata={scheduling_name="convert.4781.1"}
  %param_1.5942 = f32[] parameter(1), metadata={scheduling_name="param_1.5942"}
  %broadcast.6142.6 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5942), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.6"}
  %param_5.2531 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2531"}
  %convert.4786.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2531), metadata={scheduling_name="convert.4786.14"}
  %constant_3096_16 = bf16[] constant(0.1001)
  %convert.5015.328 = f32[] convert(%constant_3096_16), metadata={scheduling_name="convert.5015.328"}
  %broadcast.6146.57 = f32[2,1,6144]{2,1,0} broadcast(%convert.5015.328), dimensions={}, metadata={scheduling_name="broadcast.6146.57"}
  %multiply.2903.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4786.14, %broadcast.6146.57), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2903.7"}
  %param_4.2759 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2759"}
  %convert.4788.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2759), metadata={scheduling_name="convert.4788.5"}
  %constant_3097_16 = bf16[] constant(0.8984)
  %convert.5016.169 = f32[] convert(%constant_3097_16), metadata={scheduling_name="convert.5016.169"}
  %broadcast.6148.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5016.169), dimensions={}, metadata={scheduling_name="broadcast.6148.33"}
  %multiply.2904.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4788.5, %broadcast.6148.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2904.7"}
  %add.3129.5 = f32[2,1,6144]{2,1,0} add(%multiply.2903.7, %multiply.2904.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3129.5"}
  %param_2.4605 = f32[] parameter(2), metadata={scheduling_name="param_2.4605"}
  %broadcast.6150.6 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4605), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6150.6"}
  %multiply.2905.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4786.14, %convert.4786.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2905.11"}
  %constant_3103_16 = bf16[] constant(0.05005)
  %convert.5018.169 = f32[] convert(%constant_3103_16), metadata={scheduling_name="convert.5018.169"}
  %broadcast.6152.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.169), dimensions={}, metadata={scheduling_name="broadcast.6152.33"}
  %multiply.2906.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2905.11, %broadcast.6152.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2906.7"}
  %param_6.2293 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2293"}
  %convert.4794.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2293), metadata={scheduling_name="convert.4794.5"}
  %constant_3104_16 = bf16[] constant(0.9492)
  %convert.5020.171 = f32[] convert(%constant_3104_16), metadata={scheduling_name="convert.5020.171"}
  %broadcast.6154.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5020.171), dimensions={}, metadata={scheduling_name="broadcast.6154.33"}
  %multiply.2907.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4794.5, %broadcast.6154.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2907.7"}
  %add.3130.5 = f32[2,1,6144]{2,1,0} add(%multiply.2906.7, %multiply.2907.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3130.5"}
  %param_3.3776 = f32[] parameter(3), metadata={scheduling_name="param_3.3776"}
  %broadcast.6156.8 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3776), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6156.8"}
  %divide.530.5 = f32[2,1,6144]{2,1,0} divide(%add.3130.5, %broadcast.6156.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.530.5"}
  %sqrt.99.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.530.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.99.3"}
  %constant_3107_16 = bf16[] constant(1.001e-08)
  %convert.5023.146 = f32[] convert(%constant_3107_16), metadata={scheduling_name="convert.5023.146"}
  %broadcast.6158.35 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.146), dimensions={}, metadata={scheduling_name="broadcast.6158.35"}
  %add.3131.9 = f32[2,1,6144]{2,1,0} add(%sqrt.99.3, %broadcast.6158.35), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3131.9"}
  %multiply.2909.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6150.6, %add.3131.9), metadata={scheduling_name="multiply.2909.7"}
  %divide.531.5 = f32[2,1,6144]{2,1,0} divide(%add.3129.5, %multiply.2909.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.531.5"}
  %multiply.2910.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4781.1, %broadcast.6146.57), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2910.5"}
  %add.3132.3 = f32[2,1,6144]{2,1,0} add(%divide.531.5, %multiply.2910.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3132.3"}
  %multiply.2911.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6142.6, %add.3132.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2911.3"}
  %add.3133.1 = f32[2,1,6144]{2,1,0} add(%convert.4781.1, %multiply.2911.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3133.1"}
  %convert.4966.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3130.5), metadata={scheduling_name="convert.4966.1.clone.1"}
  %convert.4938.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3129.5), metadata={scheduling_name="convert.4938.1.clone.1"}
  %bitcast.29535.1.clone.1 = f32[12288]{0} bitcast(%multiply.2905.11), metadata={scheduling_name="bitcast.29535.1.clone.1"}
  %constant_2882_71_clone_1 = f32[] constant(0)
  %reduce.224.1.clone.1 = f32[] reduce(%bitcast.29535.1.clone.1, %constant_2882_71_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.224.1.clone.1"}
  ROOT %tuple.570 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3133.1, %convert.4966.1.clone.1, %convert.4938.1.clone.1, %reduce.224.1.clone.1), metadata={scheduling_name="tuple.570"}
}

%fused_add_convert_reduce.2 (param_0.5509: bf16[2,1,6144], param_1.5947: f32[], param_2.4621: f32[], param_3.3792: f32[], param_4.2775: bf16[2,1,6144], param_5.2547: bf16[2,1,6144], param_6.2309: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5509 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5509"}
  %convert.4761.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5509), metadata={scheduling_name="convert.4761.1"}
  %param_1.5947 = f32[] parameter(1), metadata={scheduling_name="param_1.5947"}
  %broadcast.6142.8 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5947), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.8"}
  %param_5.2547 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2547"}
  %convert.4766.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2547), metadata={scheduling_name="convert.4766.14"}
  %constant_3096_61 = bf16[] constant(0.1001)
  %convert.5015.324 = f32[] convert(%constant_3096_61), metadata={scheduling_name="convert.5015.324"}
  %broadcast.6146.53 = f32[2,1,6144]{2,1,0} broadcast(%convert.5015.324), dimensions={}, metadata={scheduling_name="broadcast.6146.53"}
  %multiply.2893.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4766.14, %broadcast.6146.53), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2893.7"}
  %param_4.2775 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2775"}
  %convert.4768.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2775), metadata={scheduling_name="convert.4768.5"}
  %constant_3097_58 = bf16[] constant(0.8984)
  %convert.5016.165 = f32[] convert(%constant_3097_58), metadata={scheduling_name="convert.5016.165"}
  %broadcast.6148.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5016.165), dimensions={}, metadata={scheduling_name="broadcast.6148.29"}
  %multiply.2894.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4768.5, %broadcast.6148.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2894.7"}
  %add.3124.5 = f32[2,1,6144]{2,1,0} add(%multiply.2893.7, %multiply.2894.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3124.5"}
  %param_2.4621 = f32[] parameter(2), metadata={scheduling_name="param_2.4621"}
  %broadcast.6150.8 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4621), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6150.8"}
  %multiply.2895.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4766.14, %convert.4766.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2895.11"}
  %constant_3103_58 = bf16[] constant(0.05005)
  %convert.5018.165 = f32[] convert(%constant_3103_58), metadata={scheduling_name="convert.5018.165"}
  %broadcast.6152.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.165), dimensions={}, metadata={scheduling_name="broadcast.6152.29"}
  %multiply.2896.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2895.11, %broadcast.6152.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2896.7"}
  %param_6.2309 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2309"}
  %convert.4774.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2309), metadata={scheduling_name="convert.4774.5"}
  %constant_3104_58 = bf16[] constant(0.9492)
  %convert.5020.167 = f32[] convert(%constant_3104_58), metadata={scheduling_name="convert.5020.167"}
  %broadcast.6154.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5020.167), dimensions={}, metadata={scheduling_name="broadcast.6154.29"}
  %multiply.2897.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4774.5, %broadcast.6154.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2897.7"}
  %add.3125.5 = f32[2,1,6144]{2,1,0} add(%multiply.2896.7, %multiply.2897.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3125.5"}
  %param_3.3792 = f32[] parameter(3), metadata={scheduling_name="param_3.3792"}
  %broadcast.6156.12 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3792), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6156.12"}
  %divide.527.5 = f32[2,1,6144]{2,1,0} divide(%add.3125.5, %broadcast.6156.12), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.527.5"}
  %sqrt.98.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.527.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.98.3"}
  %constant_3107_42 = bf16[] constant(1.001e-08)
  %convert.5023.148 = f32[] convert(%constant_3107_42), metadata={scheduling_name="convert.5023.148"}
  %broadcast.6158.37 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.148), dimensions={}, metadata={scheduling_name="broadcast.6158.37"}
  %add.3126.9 = f32[2,1,6144]{2,1,0} add(%sqrt.98.3, %broadcast.6158.37), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3126.9"}
  %multiply.2898.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6150.8, %add.3126.9), metadata={scheduling_name="multiply.2898.7"}
  %divide.528.5 = f32[2,1,6144]{2,1,0} divide(%add.3124.5, %multiply.2898.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.528.5"}
  %multiply.2899.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4761.1, %broadcast.6146.53), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2899.5"}
  %add.3127.3 = f32[2,1,6144]{2,1,0} add(%divide.528.5, %multiply.2899.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3127.3"}
  %multiply.2902.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6142.8, %add.3127.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2902.3"}
  %add.3128.1 = f32[2,1,6144]{2,1,0} add(%convert.4761.1, %multiply.2902.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3128.1"}
  %convert.4965.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3125.5), metadata={scheduling_name="convert.4965.1.clone.1"}
  %convert.4937.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3124.5), metadata={scheduling_name="convert.4937.1.clone.1"}
  %bitcast.29522.1.clone.1 = f32[12288]{0} bitcast(%multiply.2895.11), metadata={scheduling_name="bitcast.29522.1.clone.1"}
  %constant_2882_70_clone_1 = f32[] constant(0)
  %reduce.223.1.clone.1 = f32[] reduce(%bitcast.29522.1.clone.1, %constant_2882_70_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.223.1.clone.1"}
  ROOT %tuple.574 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3128.1, %convert.4965.1.clone.1, %convert.4937.1.clone.1, %reduce.223.1.clone.1), metadata={scheduling_name="tuple.574"}
}

%fused_add_convert_reduce.3 (param_0.5526: bf16[2,1,768,8], param_1.5974: f32[], param_2.4604: f32[], param_3.3775: f32[], param_4.2758: bf16[2,1,768,8], param_5.2530: bf16[2,1,768,8], param_6.2292: bf16[2,1,768,8]) -> (f32[2,1,768,8], bf16[2,1,768,8], bf16[2,1,768,8], f32[]) {
  %param_0.5526 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5526"}
  %convert.4653.1 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5526), metadata={scheduling_name="convert.4653.1"}
  %param_1.5974 = f32[] parameter(1), metadata={scheduling_name="param_1.5974"}
  %broadcast.6070.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.5974), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6070.4"}
  %param_5.2530 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2530"}
  %convert.4661.14 = f32[2,1,768,8]{3,2,1,0} convert(%param_5.2530), metadata={scheduling_name="convert.4661.14"}
  %constant_3096_13 = bf16[] constant(0.1001)
  %convert.5015.336 = f32[] convert(%constant_3096_13), metadata={scheduling_name="convert.5015.336"}
  %broadcast.6074.29 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5015.336), dimensions={}, metadata={scheduling_name="broadcast.6074.29"}
  %multiply.2861.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4661.14, %broadcast.6074.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2861.7"}
  %param_4.2758 = bf16[2,1,768,8]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2758"}
  %convert.4664.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_4.2758), metadata={scheduling_name="convert.4664.5"}
  %constant_3097_13 = bf16[] constant(0.8984)
  %convert.5016.177 = f32[] convert(%constant_3097_13), metadata={scheduling_name="convert.5016.177"}
  %broadcast.6076.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5016.177), dimensions={}, metadata={scheduling_name="broadcast.6076.17"}
  %multiply.2862.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4664.5, %broadcast.6076.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2862.7"}
  %add.3104.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2861.7, %multiply.2862.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3104.5"}
  %param_2.4604 = f32[] parameter(2), metadata={scheduling_name="param_2.4604"}
  %broadcast.6078.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_2.4604), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6078.4"}
  %multiply.2863.11 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4661.14, %convert.4661.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2863.11"}
  %constant_3103_13 = bf16[] constant(0.05005)
  %convert.5018.177 = f32[] convert(%constant_3103_13), metadata={scheduling_name="convert.5018.177"}
  %broadcast.6080.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5018.177), dimensions={}, metadata={scheduling_name="broadcast.6080.17"}
  %multiply.2864.7 = f32[2,1,768,8]{3,2,1,0} multiply(%multiply.2863.11, %broadcast.6080.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2864.7"}
  %param_6.2292 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2292"}
  %convert.4673.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_6.2292), metadata={scheduling_name="convert.4673.5"}
  %constant_3104_13 = bf16[] constant(0.9492)
  %convert.5020.179 = f32[] convert(%constant_3104_13), metadata={scheduling_name="convert.5020.179"}
  %broadcast.6082.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5020.179), dimensions={}, metadata={scheduling_name="broadcast.6082.17"}
  %multiply.2865.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4673.5, %broadcast.6082.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2865.7"}
  %add.3105.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2864.7, %multiply.2865.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3105.5"}
  %param_3.3775 = f32[] parameter(3), metadata={scheduling_name="param_3.3775"}
  %broadcast.6084.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_3.3775), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6084.6"}
  %divide.515.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3105.5, %broadcast.6084.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.515.5"}
  %sqrt.94.3 = f32[2,1,768,8]{3,2,1,0} sqrt(%divide.515.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.94.3"}
  %constant_3107_13 = bf16[] constant(1.001e-08)
  %convert.5023.154 = f32[] convert(%constant_3107_13), metadata={scheduling_name="convert.5023.154"}
  %broadcast.6086.19 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5023.154), dimensions={}, metadata={scheduling_name="broadcast.6086.19"}
  %add.3106.9 = f32[2,1,768,8]{3,2,1,0} add(%sqrt.94.3, %broadcast.6086.19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3106.9"}
  %multiply.2866.7 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6078.4, %add.3106.9), metadata={scheduling_name="multiply.2866.7"}
  %divide.516.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3104.5, %multiply.2866.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.516.5"}
  %multiply.2867.5 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4653.1, %broadcast.6074.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2867.5"}
  %add.3107.3 = f32[2,1,768,8]{3,2,1,0} add(%divide.516.5, %multiply.2867.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3107.3"}
  %multiply.2868.3 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6070.4, %add.3107.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2868.3"}
  %add.3108.1 = f32[2,1,768,8]{3,2,1,0} add(%convert.4653.1, %multiply.2868.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3108.1"}
  %convert.4961.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3105.5), metadata={scheduling_name="convert.4961.1.clone.1"}
  %convert.4931.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3104.5), metadata={scheduling_name="convert.4931.1.clone.1"}
  %bitcast.29446.1.clone.1 = f32[12288]{0} bitcast(%multiply.2863.11), metadata={scheduling_name="bitcast.29446.1.clone.1"}
  %constant_2882_66_clone_1 = f32[] constant(0)
  %reduce.219.1.clone.1 = f32[] reduce(%bitcast.29446.1.clone.1, %constant_2882_66_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.219.1.clone.1"}
  ROOT %tuple.587 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) tuple(%add.3108.1, %convert.4961.1.clone.1, %convert.4931.1.clone.1, %reduce.219.1.clone.1), metadata={scheduling_name="tuple.587"}
}

%fused_add_convert_reduce.4 (param_0.5512: bf16[2,1,6144], param_1.5952: f32[], param_2.4620: f32[], param_3.3791: f32[], param_4.2774: bf16[2,1,6144], param_5.2546: bf16[2,1,6144], param_6.2308: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5512 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5512"}
  %convert.4533.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5512), metadata={scheduling_name="convert.4533.1"}
  %param_1.5952 = f32[] parameter(1), metadata={scheduling_name="param_1.5952"}
  %broadcast.6142.10 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5952), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.10"}
  %param_5.2546 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2546"}
  %convert.4538.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2546), metadata={scheduling_name="convert.4538.14"}
  %constant_3096_59 = bf16[] constant(0.1001)
  %convert.5015.320 = f32[] convert(%constant_3096_59), metadata={scheduling_name="convert.5015.320"}
  %broadcast.6146.49 = f32[2,1,6144]{2,1,0} broadcast(%convert.5015.320), dimensions={}, metadata={scheduling_name="broadcast.6146.49"}
  %multiply.2821.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4538.14, %broadcast.6146.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2821.7"}
  %param_4.2774 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2774"}
  %convert.4540.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2774), metadata={scheduling_name="convert.4540.5"}
  %constant_3097_57 = bf16[] constant(0.8984)
  %convert.5016.161 = f32[] convert(%constant_3097_57), metadata={scheduling_name="convert.5016.161"}
  %broadcast.6148.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5016.161), dimensions={}, metadata={scheduling_name="broadcast.6148.25"}
  %multiply.2822.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4540.5, %broadcast.6148.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2822.7"}
  %add.3078.5 = f32[2,1,6144]{2,1,0} add(%multiply.2821.7, %multiply.2822.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3078.5"}
  %param_2.4620 = f32[] parameter(2), metadata={scheduling_name="param_2.4620"}
  %broadcast.6150.10 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4620), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6150.10"}
  %multiply.2823.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4538.14, %convert.4538.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2823.11"}
  %constant_3103_57 = bf16[] constant(0.05005)
  %convert.5018.161 = f32[] convert(%constant_3103_57), metadata={scheduling_name="convert.5018.161"}
  %broadcast.6152.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.161), dimensions={}, metadata={scheduling_name="broadcast.6152.25"}
  %multiply.2824.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2823.11, %broadcast.6152.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2824.7"}
  %param_6.2308 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2308"}
  %convert.4546.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2308), metadata={scheduling_name="convert.4546.5"}
  %constant_3104_57 = bf16[] constant(0.9492)
  %convert.5020.163 = f32[] convert(%constant_3104_57), metadata={scheduling_name="convert.5020.163"}
  %broadcast.6154.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5020.163), dimensions={}, metadata={scheduling_name="broadcast.6154.25"}
  %multiply.2825.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4546.5, %broadcast.6154.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2825.7"}
  %add.3079.5 = f32[2,1,6144]{2,1,0} add(%multiply.2824.7, %multiply.2825.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3079.5"}
  %param_3.3791 = f32[] parameter(3), metadata={scheduling_name="param_3.3791"}
  %broadcast.6156.16 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3791), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6156.16"}
  %divide.500.5 = f32[2,1,6144]{2,1,0} divide(%add.3079.5, %broadcast.6156.16), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.500.5"}
  %sqrt.89.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.500.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.89.3"}
  %constant_3107_41 = bf16[] constant(1.001e-08)
  %convert.5023.150 = f32[] convert(%constant_3107_41), metadata={scheduling_name="convert.5023.150"}
  %broadcast.6158.39 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.150), dimensions={}, metadata={scheduling_name="broadcast.6158.39"}
  %add.3080.9 = f32[2,1,6144]{2,1,0} add(%sqrt.89.3, %broadcast.6158.39), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3080.9"}
  %multiply.2826.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6150.10, %add.3080.9), metadata={scheduling_name="multiply.2826.7"}
  %divide.501.5 = f32[2,1,6144]{2,1,0} divide(%add.3078.5, %multiply.2826.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.501.5"}
  %multiply.2827.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4533.1, %broadcast.6146.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2827.5"}
  %add.3081.3 = f32[2,1,6144]{2,1,0} add(%divide.501.5, %multiply.2827.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3081.3"}
  %multiply.2828.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6142.10, %add.3081.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2828.3"}
  %add.3082.1 = f32[2,1,6144]{2,1,0} add(%convert.4533.1, %multiply.2828.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3082.1"}
  %convert.4956.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3079.5), metadata={scheduling_name="convert.4956.1.clone.1"}
  %convert.4923.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3078.5), metadata={scheduling_name="convert.4923.1.clone.1"}
  %bitcast.29365.1.clone.1 = f32[12288]{0} bitcast(%multiply.2823.11), metadata={scheduling_name="bitcast.29365.1.clone.1"}
  %constant_2882_61_clone_1 = f32[] constant(0)
  %reduce.214.1.clone.1 = f32[] reduce(%bitcast.29365.1.clone.1, %constant_2882_61_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.214.1.clone.1"}
  ROOT %tuple.604 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3082.1, %convert.4956.1.clone.1, %convert.4923.1.clone.1, %reduce.214.1.clone.1), metadata={scheduling_name="tuple.604"}
}

%fused_add_convert_reduce.5 (param_0.5515: bf16[2,1,6144], param_1.5957: f32[], param_2.4619: f32[], param_3.3790: f32[], param_4.2773: bf16[2,1,6144], param_5.2545: bf16[2,1,6144], param_6.2307: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5515 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5515"}
  %convert.4513.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5515), metadata={scheduling_name="convert.4513.1"}
  %param_1.5957 = f32[] parameter(1), metadata={scheduling_name="param_1.5957"}
  %broadcast.6142.12 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5957), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.12"}
  %param_5.2545 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2545"}
  %convert.4518.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2545), metadata={scheduling_name="convert.4518.14"}
  %constant_3096_57 = bf16[] constant(0.1001)
  %convert.5015.316 = f32[] convert(%constant_3096_57), metadata={scheduling_name="convert.5015.316"}
  %broadcast.6146.45 = f32[2,1,6144]{2,1,0} broadcast(%convert.5015.316), dimensions={}, metadata={scheduling_name="broadcast.6146.45"}
  %multiply.2813.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4518.14, %broadcast.6146.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2813.7"}
  %param_4.2773 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2773"}
  %convert.4520.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2773), metadata={scheduling_name="convert.4520.5"}
  %constant_3097_56 = bf16[] constant(0.8984)
  %convert.5016.157 = f32[] convert(%constant_3097_56), metadata={scheduling_name="convert.5016.157"}
  %broadcast.6148.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5016.157), dimensions={}, metadata={scheduling_name="broadcast.6148.21"}
  %multiply.2814.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4520.5, %broadcast.6148.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2814.7"}
  %add.3073.5 = f32[2,1,6144]{2,1,0} add(%multiply.2813.7, %multiply.2814.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3073.5"}
  %param_2.4619 = f32[] parameter(2), metadata={scheduling_name="param_2.4619"}
  %broadcast.6150.12 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4619), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6150.12"}
  %multiply.2815.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4518.14, %convert.4518.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2815.11"}
  %constant_3103_56 = bf16[] constant(0.05005)
  %convert.5018.157 = f32[] convert(%constant_3103_56), metadata={scheduling_name="convert.5018.157"}
  %broadcast.6152.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.157), dimensions={}, metadata={scheduling_name="broadcast.6152.21"}
  %multiply.2816.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2815.11, %broadcast.6152.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2816.7"}
  %param_6.2307 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2307"}
  %convert.4526.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2307), metadata={scheduling_name="convert.4526.5"}
  %constant_3104_56 = bf16[] constant(0.9492)
  %convert.5020.159 = f32[] convert(%constant_3104_56), metadata={scheduling_name="convert.5020.159"}
  %broadcast.6154.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5020.159), dimensions={}, metadata={scheduling_name="broadcast.6154.21"}
  %multiply.2817.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4526.5, %broadcast.6154.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2817.7"}
  %add.3074.5 = f32[2,1,6144]{2,1,0} add(%multiply.2816.7, %multiply.2817.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3074.5"}
  %param_3.3790 = f32[] parameter(3), metadata={scheduling_name="param_3.3790"}
  %broadcast.6156.20 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3790), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6156.20"}
  %divide.497.5 = f32[2,1,6144]{2,1,0} divide(%add.3074.5, %broadcast.6156.20), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.497.5"}
  %sqrt.88.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.497.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.88.3"}
  %constant_3107_40 = bf16[] constant(1.001e-08)
  %convert.5023.152 = f32[] convert(%constant_3107_40), metadata={scheduling_name="convert.5023.152"}
  %broadcast.6158.41 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.152), dimensions={}, metadata={scheduling_name="broadcast.6158.41"}
  %add.3075.9 = f32[2,1,6144]{2,1,0} add(%sqrt.88.3, %broadcast.6158.41), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3075.9"}
  %multiply.2818.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6150.12, %add.3075.9), metadata={scheduling_name="multiply.2818.7"}
  %divide.498.5 = f32[2,1,6144]{2,1,0} divide(%add.3073.5, %multiply.2818.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.498.5"}
  %multiply.2819.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4513.1, %broadcast.6146.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2819.5"}
  %add.3076.3 = f32[2,1,6144]{2,1,0} add(%divide.498.5, %multiply.2819.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3076.3"}
  %multiply.2820.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6142.12, %add.3076.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2820.3"}
  %add.3077.1 = f32[2,1,6144]{2,1,0} add(%convert.4513.1, %multiply.2820.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3077.1"}
  %convert.4955.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3074.5), metadata={scheduling_name="convert.4955.1.clone.1"}
  %convert.4922.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3073.5), metadata={scheduling_name="convert.4922.1.clone.1"}
  %bitcast.29352.1.clone.1 = f32[12288]{0} bitcast(%multiply.2815.11), metadata={scheduling_name="bitcast.29352.1.clone.1"}
  %constant_2882_60_clone_1 = f32[] constant(0)
  %reduce.213.1.clone.1 = f32[] reduce(%bitcast.29352.1.clone.1, %constant_2882_60_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.213.1.clone.1"}
  ROOT %tuple.608 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3077.1, %convert.4955.1.clone.1, %convert.4922.1.clone.1, %reduce.213.1.clone.1), metadata={scheduling_name="tuple.608"}
}

%fused_add_convert_reduce.6 (param_0.5529: bf16[2,1,768,8], param_1.5979: f32[], param_2.4622: f32[], param_3.3793: f32[], param_4.2776: bf16[2,1,768,8], param_5.2548: bf16[2,1,768,8], param_6.2310: bf16[2,1,768,8]) -> (f32[2,1,768,8], bf16[2,1,768,8], bf16[2,1,768,8], f32[]) {
  %param_0.5529 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5529"}
  %convert.4433.1 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5529), metadata={scheduling_name="convert.4433.1"}
  %param_1.5979 = f32[] parameter(1), metadata={scheduling_name="param_1.5979"}
  %broadcast.6070.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.5979), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6070.6"}
  %param_5.2548 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2548"}
  %convert.4438.14 = f32[2,1,768,8]{3,2,1,0} convert(%param_5.2548), metadata={scheduling_name="convert.4438.14"}
  %constant_3096_64 = bf16[] constant(0.1001)
  %convert.5015.332 = f32[] convert(%constant_3096_64), metadata={scheduling_name="convert.5015.332"}
  %broadcast.6074.25 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5015.332), dimensions={}, metadata={scheduling_name="broadcast.6074.25"}
  %multiply.2781.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4438.14, %broadcast.6074.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2781.7"}
  %param_4.2776 = bf16[2,1,768,8]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2776"}
  %convert.4440.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_4.2776), metadata={scheduling_name="convert.4440.5"}
  %constant_3097_59 = bf16[] constant(0.8984)
  %convert.5016.173 = f32[] convert(%constant_3097_59), metadata={scheduling_name="convert.5016.173"}
  %broadcast.6076.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5016.173), dimensions={}, metadata={scheduling_name="broadcast.6076.13"}
  %multiply.2782.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4440.5, %broadcast.6076.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2782.7"}
  %add.3050.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2781.7, %multiply.2782.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3050.5"}
  %param_2.4622 = f32[] parameter(2), metadata={scheduling_name="param_2.4622"}
  %broadcast.6078.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_2.4622), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6078.6"}
  %multiply.2783.11 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4438.14, %convert.4438.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2783.11"}
  %constant_3103_59 = bf16[] constant(0.05005)
  %convert.5018.173 = f32[] convert(%constant_3103_59), metadata={scheduling_name="convert.5018.173"}
  %broadcast.6080.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5018.173), dimensions={}, metadata={scheduling_name="broadcast.6080.13"}
  %multiply.2784.7 = f32[2,1,768,8]{3,2,1,0} multiply(%multiply.2783.11, %broadcast.6080.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2784.7"}
  %param_6.2310 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2310"}
  %convert.4446.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_6.2310), metadata={scheduling_name="convert.4446.5"}
  %constant_3104_59 = bf16[] constant(0.9492)
  %convert.5020.175 = f32[] convert(%constant_3104_59), metadata={scheduling_name="convert.5020.175"}
  %broadcast.6082.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5020.175), dimensions={}, metadata={scheduling_name="broadcast.6082.13"}
  %multiply.2785.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4446.5, %broadcast.6082.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2785.7"}
  %add.3051.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2784.7, %multiply.2785.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3051.5"}
  %param_3.3793 = f32[] parameter(3), metadata={scheduling_name="param_3.3793"}
  %broadcast.6084.10 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_3.3793), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6084.10"}
  %divide.485.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3051.5, %broadcast.6084.10), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.485.5"}
  %sqrt.84.3 = f32[2,1,768,8]{3,2,1,0} sqrt(%divide.485.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.84.3"}
  %constant_3107_43 = bf16[] constant(1.001e-08)
  %convert.5023.156 = f32[] convert(%constant_3107_43), metadata={scheduling_name="convert.5023.156"}
  %broadcast.6086.21 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5023.156), dimensions={}, metadata={scheduling_name="broadcast.6086.21"}
  %add.3052.9 = f32[2,1,768,8]{3,2,1,0} add(%sqrt.84.3, %broadcast.6086.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3052.9"}
  %multiply.2786.7 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6078.6, %add.3052.9), metadata={scheduling_name="multiply.2786.7"}
  %divide.486.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3050.5, %multiply.2786.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.486.5"}
  %multiply.2787.5 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4433.1, %broadcast.6074.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2787.5"}
  %add.3053.3 = f32[2,1,768,8]{3,2,1,0} add(%divide.486.5, %multiply.2787.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3053.3"}
  %multiply.2788.3 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6070.6, %add.3053.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2788.3"}
  %add.3054.1 = f32[2,1,768,8]{3,2,1,0} add(%convert.4433.1, %multiply.2788.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3054.1"}
  %convert.4950.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3051.5), metadata={scheduling_name="convert.4950.1.clone.1"}
  %convert.4916.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3050.5), metadata={scheduling_name="convert.4916.1.clone.1"}
  %bitcast.29276.1.clone.1 = f32[12288]{0} bitcast(%multiply.2783.11), metadata={scheduling_name="bitcast.29276.1.clone.1"}
  %constant_2882_56_clone_1 = f32[] constant(0)
  %reduce.209.1.clone.1 = f32[] reduce(%bitcast.29276.1.clone.1, %constant_2882_56_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.209.1.clone.1"}
  ROOT %tuple.621 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) tuple(%add.3054.1, %convert.4950.1.clone.1, %convert.4916.1.clone.1, %reduce.209.1.clone.1), metadata={scheduling_name="tuple.621"}
}

%region_6.604.clone.11 (Arg_0.180: f32[], Arg_1.180: f32[]) -> f32[] {
  %Arg_1.180 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.180"}
  %Arg_0.180 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.180"}
  ROOT %add.2997.0 = f32[] add(%Arg_0.180, %Arg_1.180), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2997.0"}
}

%fused_reduce.69 (param_0.5595: f32[256,6144], param_1.6052: f32[]) -> bf16[6144] {
  %param_0.5595 = f32[256,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.5595"}
  %param_1.6052 = f32[] parameter(1), metadata={scheduling_name="param_1.6052"}
  %reduce.182.1 = f32[6144]{0} reduce(%param_0.5595, %param_1.6052), dimensions={0}, to_apply=%region_6.604.clone.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.182.1"}
  ROOT %convert.4340.1 = bf16[6144]{0} convert(%reduce.182.1), metadata={scheduling_name="convert.4340.1"}
}

%fused_select.3 (param_0.5735: bf16[2,1,6144], param_1.6150: f32[], param_2.4361: pred[]) -> bf16[2,1,6144] {
  %param_2.4361 = pred[] parameter(2), metadata={scheduling_name="param_2.4361"}
  %broadcast.5859.4 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4361), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5859.4"}
  %param_0.5735 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5735"}
  %convert.4378.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5735), metadata={scheduling_name="convert.4378.8"}
  %param_1.6150 = f32[] parameter(1), metadata={scheduling_name="param_1.6150"}
  %broadcast.6144.6 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6150), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6144.6"}
  %divide.529.5 = f32[2,1,6144]{2,1,0} divide(%convert.4378.8, %broadcast.6144.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.529.5"}
  %convert.4785.3 = bf16[2,1,6144]{2,1,0} convert(%divide.529.5), metadata={scheduling_name="convert.4785.3"}
  ROOT %select.1380.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5859.4, %param_0.5735, %convert.4785.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1380.1"}
}

%fused_select.4 (param_0.5734: bf16[2,1,6144], param_1.6149: f32[], param_2.4360: pred[]) -> bf16[2,1,6144] {
  %param_2.4360 = pred[] parameter(2), metadata={scheduling_name="param_2.4360"}
  %broadcast.5859.3 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4360), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5859.3"}
  %param_0.5734 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5734"}
  %convert.4376.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5734), metadata={scheduling_name="convert.4376.8"}
  %param_1.6149 = f32[] parameter(1), metadata={scheduling_name="param_1.6149"}
  %broadcast.6144.8 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6149), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6144.8"}
  %divide.526.5 = f32[2,1,6144]{2,1,0} divide(%convert.4376.8, %broadcast.6144.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.526.5"}
  %convert.4765.3 = bf16[2,1,6144]{2,1,0} convert(%divide.526.5), metadata={scheduling_name="convert.4765.3"}
  ROOT %select.1379.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5859.3, %param_0.5734, %convert.4765.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1379.1"}
}

%fused_select.5 (param_0.5736: bf16[2,1,768,8], param_1.6151: f32[], param_2.4362: pred[]) -> bf16[2,1,768,8] {
  %param_2.4362 = pred[] parameter(2), metadata={scheduling_name="param_2.4362"}
  %broadcast.5820.1 = pred[2,1,768,8]{3,2,1,0} broadcast(%param_2.4362), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5820.1"}
  %param_0.5736 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5736"}
  %convert.4368.8 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5736), metadata={scheduling_name="convert.4368.8"}
  %param_1.6151 = f32[] parameter(1), metadata={scheduling_name="param_1.6151"}
  %broadcast.6072.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.6151), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6072.4"}
  %divide.514.5 = f32[2,1,768,8]{3,2,1,0} divide(%convert.4368.8, %broadcast.6072.4), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.514.5"}
  %convert.4659.3 = bf16[2,1,768,8]{3,2,1,0} convert(%divide.514.5), metadata={scheduling_name="convert.4659.3"}
  ROOT %select.1375.1 = bf16[2,1,768,8]{3,2,1,0} select(%broadcast.5820.1, %param_0.5736, %convert.4659.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1375.1"}
}

%fused_select.6 (param_0.5732: bf16[2,1,6144], param_1.6147: f32[], param_2.4358: pred[]) -> bf16[2,1,6144] {
  %param_2.4358 = pred[] parameter(2), metadata={scheduling_name="param_2.4358"}
  %broadcast.5859.1 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4358), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5859.1"}
  %param_0.5732 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5732"}
  %convert.4358.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5732), metadata={scheduling_name="convert.4358.8"}
  %param_1.6147 = f32[] parameter(1), metadata={scheduling_name="param_1.6147"}
  %broadcast.6144.10 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6147), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6144.10"}
  %divide.499.5 = f32[2,1,6144]{2,1,0} divide(%convert.4358.8, %broadcast.6144.10), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.499.5"}
  %convert.4537.3 = bf16[2,1,6144]{2,1,0} convert(%divide.499.5), metadata={scheduling_name="convert.4537.3"}
  ROOT %select.1370.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5859.1, %param_0.5732, %convert.4537.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1370.1"}
}

%fused_select.7 (param_0.5733: bf16[2,1,6144], param_1.6148: f32[], param_2.4359: pred[]) -> bf16[2,1,6144] {
  %param_2.4359 = pred[] parameter(2), metadata={scheduling_name="param_2.4359"}
  %broadcast.5859.2 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4359), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5859.2"}
  %param_0.5733 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5733"}
  %convert.4356.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5733), metadata={scheduling_name="convert.4356.8"}
  %param_1.6148 = f32[] parameter(1), metadata={scheduling_name="param_1.6148"}
  %broadcast.6144.12 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6148), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6144.12"}
  %divide.496.5 = f32[2,1,6144]{2,1,0} divide(%convert.4356.8, %broadcast.6144.12), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.496.5"}
  %convert.4517.3 = bf16[2,1,6144]{2,1,0} convert(%divide.496.5), metadata={scheduling_name="convert.4517.3"}
  ROOT %select.1369.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5859.2, %param_0.5733, %convert.4517.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1369.1"}
}

%fused_select.8 (param_0.5737: bf16[2,1,768,8], param_1.6152: f32[], param_2.4363: pred[]) -> bf16[2,1,768,8] {
  %param_2.4363 = pred[] parameter(2), metadata={scheduling_name="param_2.4363"}
  %broadcast.5820.2 = pred[2,1,768,8]{3,2,1,0} broadcast(%param_2.4363), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5820.2"}
  %param_0.5737 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5737"}
  %convert.4348.8 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5737), metadata={scheduling_name="convert.4348.8"}
  %param_1.6152 = f32[] parameter(1), metadata={scheduling_name="param_1.6152"}
  %broadcast.6072.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.6152), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6072.6"}
  %divide.484.5 = f32[2,1,768,8]{3,2,1,0} divide(%convert.4348.8, %broadcast.6072.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.484.5"}
  %convert.4437.3 = bf16[2,1,768,8]{3,2,1,0} convert(%divide.484.5), metadata={scheduling_name="convert.4437.3"}
  ROOT %select.1365.1 = bf16[2,1,768,8]{3,2,1,0} select(%broadcast.5820.2, %param_0.5737, %convert.4437.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1365.1"}
}

%fused_power.1 () -> f32[64] {
  %constant_2909_1 = f32[] constant(1e+06)
  %broadcast.5748.1 = f32[64]{0} broadcast(%constant_2909_1), dimensions={}, metadata={scheduling_name="broadcast.5748.1"}
  %iota.398.1 = s32[64]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/iota" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="iota.398.1"}
  %constant_2910_1 = s32[] constant(2)
  %broadcast.5749.1 = s32[64]{0} broadcast(%constant_2910_1), dimensions={}, metadata={scheduling_name="broadcast.5749.1"}
  %multiply.2722.3 = s32[64]{0} multiply(%iota.398.1, %broadcast.5749.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2722.3"}
  %convert.4322.3 = f32[64]{0} convert(%multiply.2722.3), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="convert.4322.3"}
  %constant_2911_1 = f32[] constant(0.0078125)
  %broadcast.5750.1 = f32[64]{0} broadcast(%constant_2911_1), dimensions={}, metadata={scheduling_name="broadcast.5750.1"}
  %multiply.2723.1 = f32[64]{0} multiply(%convert.4322.3, %broadcast.5750.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2723.1"}
  ROOT %power.23.1 = f32[64]{0} power(%broadcast.5748.1, %multiply.2723.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 scheduling_name="power.23.1"}
}

%fused_add_convert_reduce.7 (param_0.6033: bf16[6144], param_1.6404: bf16[6144], param_2.4576: f32[], param_3.3738: pred[], param_4.2929: bf16[6144], param_5.2708: f32[], param_6.2527: f32[], param_7.2403: f32[], param_8.2274: bf16[6144]) -> (bf16[6144], bf16[6144], f32[6144], f32[]) {
  %param_3.3738 = pred[] parameter(3), metadata={scheduling_name="param_3.3738"}
  %broadcast.5798.9 = pred[6144]{0} broadcast(%param_3.3738), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5798.9"}
  %param_1.6404 = bf16[6144]{0} parameter(1), metadata={scheduling_name="param_1.6404"}
  %convert.4341.16 = f32[6144]{0} convert(%param_1.6404), metadata={scheduling_name="convert.4341.16"}
  %param_2.4576 = f32[] parameter(2), metadata={scheduling_name="param_2.4576"}
  %broadcast.6032.11 = f32[6144]{0} broadcast(%param_2.4576), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6032.11"}
  %divide.478.13 = f32[6144]{0} divide(%convert.4341.16, %broadcast.6032.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.478.13"}
  %convert.4394.11 = bf16[6144]{0} convert(%divide.478.13), metadata={scheduling_name="convert.4394.11"}
  %select.1362.9 = bf16[6144]{0} select(%broadcast.5798.9, %param_1.6404, %convert.4394.11), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1362.9"}
  %convert.4395.12 = f32[6144]{0} convert(%select.1362.9), metadata={scheduling_name="convert.4395.12"}
  %constant_3096_66 = bf16[] constant(0.1001)
  %convert.5015.338 = f32[] convert(%constant_3096_66), metadata={scheduling_name="convert.5015.338"}
  %broadcast.6034.15 = f32[6144]{0} broadcast(%convert.5015.338), dimensions={}, metadata={scheduling_name="broadcast.6034.15"}
  %multiply.2765.5 = f32[6144]{0} multiply(%convert.4395.12, %broadcast.6034.15), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2765.5"}
  %param_0.6033 = bf16[6144]{0} parameter(0), metadata={scheduling_name="param_0.6033"}
  %convert.4397.3 = f32[6144]{0} convert(%param_0.6033), metadata={scheduling_name="convert.4397.3"}
  %constant_3097_66 = bf16[] constant(0.8984)
  %convert.5016.179 = f32[] convert(%constant_3097_66), metadata={scheduling_name="convert.5016.179"}
  %broadcast.6036.5 = f32[6144]{0} broadcast(%convert.5016.179), dimensions={}, metadata={scheduling_name="broadcast.6036.5"}
  %multiply.2766.3 = f32[6144]{0} multiply(%convert.4397.3, %broadcast.6036.5), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2766.3"}
  %add.3039.3 = f32[6144]{0} add(%multiply.2765.5, %multiply.2766.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3039.3"}
  %convert.4913.1 = bf16[6144]{0} convert(%add.3039.3), metadata={scheduling_name="convert.4913.1"}
  %multiply.2767.9.clone.1 = f32[6144]{0} multiply(%convert.4395.12, %convert.4395.12), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2767.9.clone.1"}
  %constant_3103_66_clone_1 = bf16[] constant(0.05005)
  %convert.5018.179.clone.1 = f32[] convert(%constant_3103_66_clone_1), metadata={scheduling_name="convert.5018.179.clone.1"}
  %broadcast.6040.5.clone.1 = f32[6144]{0} broadcast(%convert.5018.179.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6040.5.clone.1"}
  %multiply.2768.5.clone.1 = f32[6144]{0} multiply(%multiply.2767.9.clone.1, %broadcast.6040.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2768.5.clone.1"}
  %param_4.2929 = bf16[6144]{0} parameter(4), metadata={scheduling_name="param_4.2929"}
  %convert.4405.3.clone.1 = f32[6144]{0} convert(%param_4.2929), metadata={scheduling_name="convert.4405.3.clone.1"}
  %constant_3104_66_clone_1 = bf16[] constant(0.9492)
  %convert.5020.181.clone.1 = f32[] convert(%constant_3104_66_clone_1), metadata={scheduling_name="convert.5020.181.clone.1"}
  %broadcast.6042.7.clone.1 = f32[6144]{0} broadcast(%convert.5020.181.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6042.7.clone.1"}
  %multiply.2769.5.clone.1 = f32[6144]{0} multiply(%convert.4405.3.clone.1, %broadcast.6042.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2769.5.clone.1"}
  %add.3041.3.clone.1 = f32[6144]{0} add(%multiply.2768.5.clone.1, %multiply.2769.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3041.3.clone.1"}
  %convert.4947.1.clone.1 = bf16[6144]{0} convert(%add.3041.3.clone.1), metadata={scheduling_name="convert.4947.1.clone.1"}
  %param_8.2274 = bf16[6144]{0} parameter(8), metadata={scheduling_name="param_8.2274"}
  %convert.4313.1.clone.1 = f32[6144]{0} convert(%param_8.2274), metadata={scheduling_name="convert.4313.1.clone.1"}
  %param_7.2403 = f32[] parameter(7), metadata={scheduling_name="param_7.2403"}
  %broadcast.6025.1.clone.1 = f32[6144]{0} broadcast(%param_7.2403), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6025.1.clone.1"}
  %param_6.2527 = f32[] parameter(6), metadata={scheduling_name="param_6.2527"}
  %broadcast.6038.1.clone.1 = f32[6144]{0} broadcast(%param_6.2527), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6038.1.clone.1"}
  %param_5.2708 = f32[] parameter(5), metadata={scheduling_name="param_5.2708"}
  %broadcast.6044.3.clone.1 = f32[6144]{0} broadcast(%param_5.2708), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6044.3.clone.1"}
  %divide.479.3.clone.1 = f32[6144]{0} divide(%add.3041.3.clone.1, %broadcast.6044.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.479.3.clone.1"}
  %sqrt.82.7.clone.1 = f32[6144]{0} sqrt(%divide.479.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.82.7.clone.1"}
  %constant_3107_11_clone_1 = bf16[] constant(1.001e-08)
  %convert.5023.158.clone.1 = f32[] convert(%constant_3107_11_clone_1), metadata={scheduling_name="convert.5023.158.clone.1"}
  %broadcast.6046.3.clone.1 = f32[6144]{0} broadcast(%convert.5023.158.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6046.3.clone.1"}
  %add.3042.7.clone.1 = f32[6144]{0} add(%sqrt.82.7.clone.1, %broadcast.6046.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3042.7.clone.1"}
  %multiply.2770.5.clone.1 = f32[6144]{0} multiply(%broadcast.6038.1.clone.1, %add.3042.7.clone.1), metadata={scheduling_name="multiply.2770.5.clone.1"}
  %divide.480.3.clone.1 = f32[6144]{0} divide(%add.3039.3, %multiply.2770.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.480.3.clone.1"}
  %multiply.2771.7.clone.1 = f32[6144]{0} multiply(%convert.4313.1.clone.1, %broadcast.6034.15), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2771.7.clone.1"}
  %add.3043.5.clone.1 = f32[6144]{0} add(%divide.480.3.clone.1, %multiply.2771.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3043.5.clone.1"}
  %multiply.2772.3.clone.1 = f32[6144]{0} multiply(%broadcast.6025.1.clone.1, %add.3043.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2772.3.clone.1"}
  %add.3044.1.clone.1 = f32[6144]{0} add(%convert.4313.1.clone.1, %multiply.2772.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3044.1.clone.1"}
  %constant_2882_54_clone_1 = f32[] constant(0)
  %reduce.207.1.clone.1 = f32[] reduce(%multiply.2767.9.clone.1, %constant_2882_54_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.207.1.clone.1"}
  ROOT %tuple.642 = (bf16[6144]{0}, bf16[6144]{0}, f32[6144]{0}, f32[]) tuple(%convert.4913.1, %convert.4947.1.clone.1, %add.3044.1.clone.1, %reduce.207.1.clone.1), metadata={scheduling_name="tuple.642"}
}

%fused_subtract (param_0.6054: s32[]) -> f32[] {
  %constant_2838_1 = f32[] constant(1)
  %constant_3106_1 = f32[] constant(0.95)
  %param_0.6054 = s32[] parameter(0), metadata={scheduling_name="param_0.6054"}
  %convert.4399.1 = f32[] convert(%param_0.6054), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4399.1"}
  %power.25.1 = f32[] power(%constant_3106_1, %convert.4399.1), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="power.25.1"}
  ROOT %subtract.273.1 = f32[] subtract(%constant_2838_1, %power.25.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.273.1"}
}

%fused_select_subtract (param_0.6077: s32[]) -> (f32[], s32[]) {
  %constant_2838_2 = f32[] constant(1)
  %constant_3099_1 = f32[] constant(0.9)
  %param_0.6077 = s32[] parameter(0), metadata={scheduling_name="param_0.6077"}
  %constant_3100_2_clone_1 = s32[] constant(2147483647)
  %compare.1726.1.clone.1 = pred[] compare(%param_0.6077, %constant_3100_2_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1726.1.clone.1"}
  %constant_2836_4_clone_1 = s32[] constant(1)
  %add.3040.1.clone.1 = s32[] add(%param_0.6077, %constant_2836_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3040.1.clone.1"}
  %select.1363.1.clone.1 = s32[] select(%compare.1726.1.clone.1, %add.3040.1.clone.1, %constant_3100_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1363.1.clone.1"}
  %convert.4399.2 = f32[] convert(%select.1363.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4399.2"}
  %power.24.1 = f32[] power(%constant_3099_1, %convert.4399.2), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="power.24.1"}
  %subtract.272.1 = f32[] subtract(%constant_2838_2, %power.24.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.272.1"}
  ROOT %tuple.647 = (f32[], s32[]) tuple(%subtract.272.1, %select.1363.1.clone.1), metadata={scheduling_name="tuple.647"}
}

%fused_compare_sqrt (param_0.6072: f32[], param_1.6471: f32[], param_2.4746: f32[], param_3.3959: f32[], param_4.2926: f32[], param_5.2699: f32[], param_6.2514: f32[], param_7.2396: f32[], param_8.2266: f32[], param_9.2175: f32[], param_10.1826: f32[], param_11.1654: f32[], param_12.1336: f32[], param_13.1002: f32[], param_14.781: f32[], param_15.560: f32[], param_16.256: f32[], param_17.111: f32[], param_18.86: f32[], param_19.69: f32[], param_20.47: f32[], param_21.24: f32[], param_22.23: f32[]) -> (pred[], f32[]) {
  %param_21.24 = f32[] parameter(21), metadata={scheduling_name="param_21.24"}
  %param_22.23 = f32[] parameter(22), metadata={scheduling_name="param_22.23"}
  %add.3015.1.clone.1 = f32[] add(%param_21.24, %param_22.23), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3015.1.clone.1"}
  %param_20.47 = f32[] parameter(20), metadata={scheduling_name="param_20.47"}
  %add.3017.1.clone.1 = f32[] add(%add.3015.1.clone.1, %param_20.47), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3017.1.clone.1"}
  %param_19.69 = f32[] parameter(19), metadata={scheduling_name="param_19.69"}
  %add.3019.1.clone.1 = f32[] add(%add.3017.1.clone.1, %param_19.69), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3019.1.clone.1"}
  %param_18.86 = f32[] parameter(18), metadata={scheduling_name="param_18.86"}
  %add.3020.1.clone.1 = f32[] add(%add.3019.1.clone.1, %param_18.86), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3020.1.clone.1"}
  %param_17.111 = f32[] parameter(17), metadata={scheduling_name="param_17.111"}
  %add.3021.1.clone.1 = f32[] add(%add.3020.1.clone.1, %param_17.111), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3021.1.clone.1"}
  %param_16.256 = f32[] parameter(16), metadata={scheduling_name="param_16.256"}
  %add.3022.1.clone.1 = f32[] add(%add.3021.1.clone.1, %param_16.256), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3022.1.clone.1"}
  %param_15.560 = f32[] parameter(15), metadata={scheduling_name="param_15.560"}
  %add.3023.1.clone.1 = f32[] add(%add.3022.1.clone.1, %param_15.560), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3023.1.clone.1"}
  %param_14.781 = f32[] parameter(14), metadata={scheduling_name="param_14.781"}
  %add.3024.1.clone.1 = f32[] add(%add.3023.1.clone.1, %param_14.781), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3024.1.clone.1"}
  %param_13.1002 = f32[] parameter(13), metadata={scheduling_name="param_13.1002"}
  %add.3025.1.clone.1 = f32[] add(%add.3024.1.clone.1, %param_13.1002), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3025.1.clone.1"}
  %param_12.1336 = f32[] parameter(12), metadata={scheduling_name="param_12.1336"}
  %add.3026.1.clone.1 = f32[] add(%add.3025.1.clone.1, %param_12.1336), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3026.1.clone.1"}
  %param_11.1654 = f32[] parameter(11), metadata={scheduling_name="param_11.1654"}
  %add.3027.1.clone.1 = f32[] add(%add.3026.1.clone.1, %param_11.1654), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3027.1.clone.1"}
  %param_10.1826 = f32[] parameter(10), metadata={scheduling_name="param_10.1826"}
  %add.3028.1.clone.1 = f32[] add(%add.3027.1.clone.1, %param_10.1826), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3028.1.clone.1"}
  %param_9.2175 = f32[] parameter(9), metadata={scheduling_name="param_9.2175"}
  %add.3029.1.clone.1 = f32[] add(%add.3028.1.clone.1, %param_9.2175), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3029.1.clone.1"}
  %param_8.2266 = f32[] parameter(8), metadata={scheduling_name="param_8.2266"}
  %add.3030.1.clone.1 = f32[] add(%add.3029.1.clone.1, %param_8.2266), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3030.1.clone.1"}
  %param_7.2396 = f32[] parameter(7), metadata={scheduling_name="param_7.2396"}
  %add.3031.1.clone.1 = f32[] add(%add.3030.1.clone.1, %param_7.2396), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3031.1.clone.1"}
  %param_6.2514 = f32[] parameter(6), metadata={scheduling_name="param_6.2514"}
  %add.3032.1.clone.1 = f32[] add(%add.3031.1.clone.1, %param_6.2514), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3032.1.clone.1"}
  %param_5.2699 = f32[] parameter(5), metadata={scheduling_name="param_5.2699"}
  %add.3033.1.clone.1 = f32[] add(%add.3032.1.clone.1, %param_5.2699), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3033.1.clone.1"}
  %param_4.2926 = f32[] parameter(4), metadata={scheduling_name="param_4.2926"}
  %add.3034.1.clone.1 = f32[] add(%add.3033.1.clone.1, %param_4.2926), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3034.1.clone.1"}
  %param_3.3959 = f32[] parameter(3), metadata={scheduling_name="param_3.3959"}
  %add.3035.1.clone.1 = f32[] add(%add.3034.1.clone.1, %param_3.3959), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3035.1.clone.1"}
  %param_2.4746 = f32[] parameter(2), metadata={scheduling_name="param_2.4746"}
  %add.3036.1.clone.1 = f32[] add(%add.3035.1.clone.1, %param_2.4746), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3036.1.clone.1"}
  %param_1.6471 = f32[] parameter(1), metadata={scheduling_name="param_1.6471"}
  %add.3037.1.clone.1 = f32[] add(%add.3036.1.clone.1, %param_1.6471), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3037.1.clone.1"}
  %param_0.6072 = f32[] parameter(0), metadata={scheduling_name="param_0.6072"}
  %add.3038.1.clone.1 = f32[] add(%add.3037.1.clone.1, %param_0.6072), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3038.1.clone.1"}
  %sqrt.81.1.clone.1 = f32[] sqrt(%add.3038.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="sqrt.81.1.clone.1"}
  %constant_3095_1 = bf16[] constant(1)
  %convert.4390.1 = f32[] convert(%constant_3095_1), metadata={scheduling_name="convert.4390.1"}
  %compare.1725.1 = pred[] compare(%sqrt.81.1.clone.1, %convert.4390.1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="compare.1725.1"}
  ROOT %tuple.626 = (pred[], f32[]) tuple(%compare.1725.1, %sqrt.81.1.clone.1), metadata={scheduling_name="tuple.626"}
}

%fused_multiply.7 (param_0.5832: s32[]) -> f32[] {
  %param_0.5832 = s32[] parameter(0), metadata={scheduling_name="param_0.5832"}
  %constant_2836_3 = s32[] constant(1)
  %compare.1719.1 = pred[] compare(%param_0.5832, %constant_2836_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1719.1"}
  %constant_2838_3 = f32[] constant(1)
  %constant_2840_2 = s32[] constant(0)
  %maximum.49.1 = s32[] maximum(%constant_2840_2, %param_0.5832), metadata={op_name="jit(train_step)/jit(main)/jit(clip)/max" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="maximum.49.1"}
  %minimum.4.1 = s32[] minimum(%constant_2836_3, %maximum.49.1), metadata={op_name="jit(train_step)/jit(main)/jit(clip)/min" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="minimum.4.1"}
  %convert.4315.1 = f32[] convert(%minimum.4.1), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4315.1"}
  %subtract.268.1 = f32[] subtract(%constant_2838_3, %convert.4315.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.268.1"}
  %constant_2841_1 = f32[] constant(-3e-05)
  %multiply.2714.1 = f32[] multiply(%subtract.268.1, %constant_2841_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2714.1"}
  %constant_2842_1 = f32[] constant(3e-05)
  %add.2999.1 = f32[] add(%multiply.2714.1, %constant_2842_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.2999.1"}
  %constant_2843_1 = s32[] constant(-1)
  %add.3000.1 = s32[] add(%param_0.5832, %constant_2843_1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3000.1"}
  %convert.4316.1 = f32[] convert(%add.3000.1), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1260 scheduling_name="convert.4316.1"}
  %constant_2844_1 = f32[] constant(0.224399492)
  %multiply.2715.1 = f32[] multiply(%convert.4316.1, %constant_2844_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="multiply.2715.1"}
  %cosine.72.1 = f32[] cosine(%multiply.2715.1), metadata={op_name="jit(train_step)/jit(main)/cos" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="cosine.72.1"}
  %add.3001.1 = f32[] add(%cosine.72.1, %constant_2838_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="add.3001.1"}
  %constant_2846_1 = f32[] constant(1.5e-05)
  %multiply.2716.1 = f32[] multiply(%add.3001.1, %constant_2846_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="multiply.2716.1"}
  %constant_2848_1 = f32[] constant(0.5)
  %multiply.2717.1 = f32[] multiply(%add.3001.1, %constant_2848_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="multiply.2717.1"}
  %subtract.269.1 = f32[] subtract(%constant_2838_3, %multiply.2717.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="subtract.269.1"}
  %constant_2849_1 = f32[] constant(3e-06)
  %multiply.2718.1 = f32[] multiply(%subtract.269.1, %constant_2849_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="multiply.2718.1"}
  %add.3002.1 = f32[] add(%multiply.2716.1, %multiply.2718.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="add.3002.1"}
  %select.1360.1 = f32[] select(%compare.1719.1, %add.2999.1, %add.3002.1), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1360.1"}
  %constant_2850_1 = f32[] constant(-1)
  ROOT %multiply.2719.1 = f32[] multiply(%select.1360.1, %constant_2850_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2719.1"}
}

%fused_convert_reduce.22 (param_0.6006: bf16[2,1,768,8,128], param_1.6430: f32[], param_2.4612: bf16[2,1,768,8,128], param_3.3783: f32[], param_4.2766: bf16[2,1,768,8,128], param_5.2538: bf16[2,1,768,8,128], param_6.2300: f32[], param_7.2128: pred[], param_8.1965: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6006 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6006"}
  %convert.4553.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6006), metadata={scheduling_name="convert.4553.16"}
  %param_8.1965 = f32[] parameter(8), metadata={scheduling_name="param_8.1965"}
  %broadcast.6174.16 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1965), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.16"}
  %param_7.2128 = pred[] parameter(7), metadata={scheduling_name="param_7.2128"}
  %broadcast.5876.40 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2128), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5876.40"}
  %param_5.2538 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2538"}
  %convert.4360.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2538), metadata={scheduling_name="convert.4360.20"}
  %param_6.2300 = f32[] parameter(6), metadata={scheduling_name="param_6.2300"}
  %broadcast.6176.56 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2300), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6176.56"}
  %divide.502.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4360.20, %broadcast.6176.56), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.502.17"}
  %convert.4557.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.502.17), metadata={scheduling_name="convert.4557.15"}
  %select.1371.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5876.40, %param_5.2538, %convert.4557.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1371.13"}
  %convert.4558.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1371.13), metadata={scheduling_name="convert.4558.26"}
  %constant_3096_46 = bf16[] constant(0.1001)
  %convert.5015.348 = f32[] convert(%constant_3096_46), metadata={scheduling_name="convert.5015.348"}
  %broadcast.6178.73 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5015.348), dimensions={}, metadata={scheduling_name="broadcast.6178.73"}
  %multiply.2829.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4558.26, %broadcast.6178.73), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2829.11"}
  %param_4.2766 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2766"}
  %convert.4560.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2766), metadata={scheduling_name="convert.4560.9"}
  %constant_3097_45 = bf16[] constant(0.8984)
  %convert.5016.185 = f32[] convert(%constant_3097_45), metadata={scheduling_name="convert.5016.185"}
  %broadcast.6180.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5016.185), dimensions={}, metadata={scheduling_name="broadcast.6180.37"}
  %multiply.2830.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4560.9, %broadcast.6180.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2830.11"}
  %add.3083.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2829.11, %multiply.2830.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3083.9"}
  %param_3.3783 = f32[] parameter(3), metadata={scheduling_name="param_3.3783"}
  %broadcast.6182.24 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3783), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6182.24"}
  %multiply.2831.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4558.26, %convert.4558.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2831.15"}
  %constant_3103_45 = bf16[] constant(0.05005)
  %convert.5018.185 = f32[] convert(%constant_3103_45), metadata={scheduling_name="convert.5018.185"}
  %broadcast.6184.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.185), dimensions={}, metadata={scheduling_name="broadcast.6184.37"}
  %multiply.2832.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2831.15, %broadcast.6184.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2832.11"}
  %param_2.4612 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4612"}
  %convert.4566.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4612), metadata={scheduling_name="convert.4566.9"}
  %constant_3104_45 = bf16[] constant(0.9492)
  %convert.5020.187 = f32[] convert(%constant_3104_45), metadata={scheduling_name="convert.5020.187"}
  %broadcast.6186.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5020.187), dimensions={}, metadata={scheduling_name="broadcast.6186.37"}
  %multiply.2833.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4566.9, %broadcast.6186.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2833.11"}
  %add.3085.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2832.11, %multiply.2833.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3085.9"}
  %param_1.6430 = f32[] parameter(1), metadata={scheduling_name="param_1.6430"}
  %broadcast.6188.40 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6430), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6188.40"}
  %divide.503.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3085.9, %broadcast.6188.40), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.503.13"}
  %sqrt.90.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.503.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.90.11"}
  %constant_3107_33 = bf16[] constant(1.001e-08)
  %convert.5023.162 = f32[] convert(%constant_3107_33), metadata={scheduling_name="convert.5023.162"}
  %broadcast.6190.29 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.162), dimensions={}, metadata={scheduling_name="broadcast.6190.29"}
  %add.3086.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.90.11, %broadcast.6190.29), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3086.9"}
  %multiply.2834.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6182.24, %add.3086.9), metadata={scheduling_name="multiply.2834.9"}
  %divide.504.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3083.9, %multiply.2834.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.504.7"}
  %multiply.2835.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4553.16, %broadcast.6178.73), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2835.11"}
  %add.3087.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.504.7, %multiply.2835.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3087.9"}
  %multiply.2836.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6174.16, %add.3087.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2836.7"}
  %add.3088.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4553.16, %multiply.2836.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3088.5"}
  %convert.4572.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3088.5), metadata={scheduling_name="convert.4572.1"}
  %convert.4925.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3083.9), metadata={scheduling_name="convert.4925.1.clone.1"}
  %multiply.2970.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3088.5, %add.3088.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2970.1.clone.1"}
  %bitcast.29813.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2970.1.clone.1), metadata={scheduling_name="bitcast.29813.1.clone.1"}
  %constant_2882_125_clone_1 = f32[] constant(0)
  %reduce.679.1.clone.1 = f32[1024]{0} reduce(%bitcast.29813.1.clone.1, %constant_2882_125_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.679.1.clone.1"}
  %convert.4957.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3085.9), metadata={scheduling_name="convert.4957.1.clone.1"}
  %bitcast.29380.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2831.15), metadata={scheduling_name="bitcast.29380.1.clone.1"}
  %reduce.643.1.clone.1 = f32[1024]{0} reduce(%bitcast.29380.1.clone.1, %constant_2882_125_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.643.1.clone.1"}
  ROOT %tuple.631 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4572.1, %convert.4925.1.clone.1, %reduce.679.1.clone.1, %convert.4957.1.clone.1, %reduce.643.1.clone.1), metadata={scheduling_name="tuple.631"}
}

%fused_convert_reduce.23 (param_0.6007: bf16[2,1,768,8,128], param_1.6431: f32[], param_2.4613: bf16[2,1,768,8,128], param_3.3784: f32[], param_4.2767: bf16[2,1,768,8,128], param_5.2539: bf16[2,1,768,8,128], param_6.2301: f32[], param_7.2129: pred[], param_8.1966: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6007 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6007"}
  %convert.4623.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6007), metadata={scheduling_name="convert.4623.16"}
  %param_8.1966 = f32[] parameter(8), metadata={scheduling_name="param_8.1966"}
  %broadcast.6174.20 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1966), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.20"}
  %param_7.2129 = pred[] parameter(7), metadata={scheduling_name="param_7.2129"}
  %broadcast.5876.44 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2129), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5876.44"}
  %param_5.2539 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2539"}
  %convert.4366.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2539), metadata={scheduling_name="convert.4366.20"}
  %param_6.2301 = f32[] parameter(6), metadata={scheduling_name="param_6.2301"}
  %broadcast.6176.60 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2301), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6176.60"}
  %divide.511.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4366.20, %broadcast.6176.60), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.511.17"}
  %convert.4629.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.511.17), metadata={scheduling_name="convert.4629.15"}
  %select.1374.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5876.44, %param_5.2539, %convert.4629.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1374.13"}
  %convert.4631.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1374.13), metadata={scheduling_name="convert.4631.26"}
  %constant_3096_48 = bf16[] constant(0.1001)
  %convert.5015.356 = f32[] convert(%constant_3096_48), metadata={scheduling_name="convert.5015.356"}
  %broadcast.6178.81 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5015.356), dimensions={}, metadata={scheduling_name="broadcast.6178.81"}
  %multiply.2853.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4631.26, %broadcast.6178.81), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2853.11"}
  %param_4.2767 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2767"}
  %convert.4634.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2767), metadata={scheduling_name="convert.4634.9"}
  %constant_3097_46 = bf16[] constant(0.8984)
  %convert.5016.189 = f32[] convert(%constant_3097_46), metadata={scheduling_name="convert.5016.189"}
  %broadcast.6180.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5016.189), dimensions={}, metadata={scheduling_name="broadcast.6180.41"}
  %multiply.2854.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4634.9, %broadcast.6180.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2854.11"}
  %add.3099.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2853.11, %multiply.2854.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3099.9"}
  %param_3.3784 = f32[] parameter(3), metadata={scheduling_name="param_3.3784"}
  %broadcast.6182.28 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3784), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6182.28"}
  %multiply.2855.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4631.26, %convert.4631.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2855.15"}
  %constant_3103_46 = bf16[] constant(0.05005)
  %convert.5018.189 = f32[] convert(%constant_3103_46), metadata={scheduling_name="convert.5018.189"}
  %broadcast.6184.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.189), dimensions={}, metadata={scheduling_name="broadcast.6184.41"}
  %multiply.2856.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2855.15, %broadcast.6184.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2856.11"}
  %param_2.4613 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4613"}
  %convert.4643.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4613), metadata={scheduling_name="convert.4643.9"}
  %constant_3104_46 = bf16[] constant(0.9492)
  %convert.5020.191 = f32[] convert(%constant_3104_46), metadata={scheduling_name="convert.5020.191"}
  %broadcast.6186.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5020.191), dimensions={}, metadata={scheduling_name="broadcast.6186.41"}
  %multiply.2857.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4643.9, %broadcast.6186.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2857.11"}
  %add.3100.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2856.11, %multiply.2857.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3100.9"}
  %param_1.6431 = f32[] parameter(1), metadata={scheduling_name="param_1.6431"}
  %broadcast.6188.44 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6431), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6188.44"}
  %divide.512.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3100.9, %broadcast.6188.44), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.512.13"}
  %sqrt.93.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.512.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.93.11"}
  %constant_3107_34 = bf16[] constant(1.001e-08)
  %convert.5023.166 = f32[] convert(%constant_3107_34), metadata={scheduling_name="convert.5023.166"}
  %broadcast.6190.33 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.166), dimensions={}, metadata={scheduling_name="broadcast.6190.33"}
  %add.3101.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.93.11, %broadcast.6190.33), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3101.9"}
  %multiply.2858.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6182.28, %add.3101.9), metadata={scheduling_name="multiply.2858.9"}
  %divide.513.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3099.9, %multiply.2858.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.513.7"}
  %multiply.2859.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4623.16, %broadcast.6178.81), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2859.11"}
  %add.3102.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.513.7, %multiply.2859.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3102.9"}
  %multiply.2860.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6174.20, %add.3102.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2860.7"}
  %add.3103.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4623.16, %multiply.2860.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3103.5"}
  %convert.4652.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3103.5), metadata={scheduling_name="convert.4652.1"}
  %convert.4929.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3099.9), metadata={scheduling_name="convert.4929.1.clone.1"}
  %multiply.2973.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3103.5, %add.3103.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2973.1.clone.1"}
  %bitcast.29867.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2973.1.clone.1), metadata={scheduling_name="bitcast.29867.1.clone.1"}
  %constant_2882_128_clone_1 = f32[] constant(0)
  %reduce.685.1.clone.1 = f32[1024]{0} reduce(%bitcast.29867.1.clone.1, %constant_2882_128_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.685.1.clone.1"}
  %convert.4960.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3100.9), metadata={scheduling_name="convert.4960.1.clone.1"}
  %bitcast.29431.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2855.15), metadata={scheduling_name="bitcast.29431.1.clone.1"}
  %reduce.649.1.clone.1 = f32[1024]{0} reduce(%bitcast.29431.1.clone.1, %constant_2882_128_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.649.1.clone.1"}
  ROOT %tuple.633 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4652.1, %convert.4929.1.clone.1, %reduce.685.1.clone.1, %convert.4960.1.clone.1, %reduce.649.1.clone.1), metadata={scheduling_name="tuple.633"}
}

%fused_convert_reduce.24 (param_0.6008: bf16[2,1,768,8,128], param_1.6432: f32[], param_2.4614: bf16[2,1,768,8,128], param_3.3785: f32[], param_4.2768: bf16[2,1,768,8,128], param_5.2540: bf16[2,1,768,8,128], param_6.2302: f32[], param_7.2130: pred[], param_8.1967: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6008 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6008"}
  %convert.4801.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6008), metadata={scheduling_name="convert.4801.16"}
  %param_8.1967 = f32[] parameter(8), metadata={scheduling_name="param_8.1967"}
  %broadcast.6174.24 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1967), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.24"}
  %param_7.2130 = pred[] parameter(7), metadata={scheduling_name="param_7.2130"}
  %broadcast.5876.48 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2130), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5876.48"}
  %param_5.2540 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2540"}
  %convert.4380.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2540), metadata={scheduling_name="convert.4380.20"}
  %param_6.2302 = f32[] parameter(6), metadata={scheduling_name="param_6.2302"}
  %broadcast.6176.64 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2302), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6176.64"}
  %divide.532.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4380.20, %broadcast.6176.64), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.532.17"}
  %convert.4805.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.532.17), metadata={scheduling_name="convert.4805.15"}
  %select.1381.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5876.48, %param_5.2540, %convert.4805.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1381.13"}
  %convert.4806.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1381.13), metadata={scheduling_name="convert.4806.26"}
  %constant_3096_50 = bf16[] constant(0.1001)
  %convert.5015.364 = f32[] convert(%constant_3096_50), metadata={scheduling_name="convert.5015.364"}
  %broadcast.6178.89 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5015.364), dimensions={}, metadata={scheduling_name="broadcast.6178.89"}
  %multiply.2913.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4806.26, %broadcast.6178.89), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2913.11"}
  %param_4.2768 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2768"}
  %convert.4808.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2768), metadata={scheduling_name="convert.4808.9"}
  %constant_3097_47 = bf16[] constant(0.8984)
  %convert.5016.193 = f32[] convert(%constant_3097_47), metadata={scheduling_name="convert.5016.193"}
  %broadcast.6180.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5016.193), dimensions={}, metadata={scheduling_name="broadcast.6180.45"}
  %multiply.2914.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4808.9, %broadcast.6180.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2914.11"}
  %add.3134.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2913.11, %multiply.2914.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3134.9"}
  %param_3.3785 = f32[] parameter(3), metadata={scheduling_name="param_3.3785"}
  %broadcast.6182.32 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3785), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6182.32"}
  %multiply.2915.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4806.26, %convert.4806.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2915.15"}
  %constant_3103_47 = bf16[] constant(0.05005)
  %convert.5018.193 = f32[] convert(%constant_3103_47), metadata={scheduling_name="convert.5018.193"}
  %broadcast.6184.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.193), dimensions={}, metadata={scheduling_name="broadcast.6184.45"}
  %multiply.2916.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2915.15, %broadcast.6184.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2916.11"}
  %param_2.4614 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4614"}
  %convert.4814.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4614), metadata={scheduling_name="convert.4814.9"}
  %constant_3104_47 = bf16[] constant(0.9492)
  %convert.5020.195 = f32[] convert(%constant_3104_47), metadata={scheduling_name="convert.5020.195"}
  %broadcast.6186.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5020.195), dimensions={}, metadata={scheduling_name="broadcast.6186.45"}
  %multiply.2917.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4814.9, %broadcast.6186.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2917.11"}
  %add.3135.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2916.11, %multiply.2917.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3135.9"}
  %param_1.6432 = f32[] parameter(1), metadata={scheduling_name="param_1.6432"}
  %broadcast.6188.48 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6432), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6188.48"}
  %divide.533.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3135.9, %broadcast.6188.48), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.533.13"}
  %sqrt.100.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.533.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.100.11"}
  %constant_3107_35 = bf16[] constant(1.001e-08)
  %convert.5023.170 = f32[] convert(%constant_3107_35), metadata={scheduling_name="convert.5023.170"}
  %broadcast.6190.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.170), dimensions={}, metadata={scheduling_name="broadcast.6190.37"}
  %add.3136.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.100.11, %broadcast.6190.37), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3136.9"}
  %multiply.2919.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6182.32, %add.3136.9), metadata={scheduling_name="multiply.2919.9"}
  %divide.534.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3134.9, %multiply.2919.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.534.7"}
  %multiply.2920.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4801.16, %broadcast.6178.89), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2920.11"}
  %add.3137.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.534.7, %multiply.2920.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3137.9"}
  %multiply.2921.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6174.24, %add.3137.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2921.7"}
  %add.3138.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4801.16, %multiply.2921.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3138.5"}
  %convert.4820.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3138.5), metadata={scheduling_name="convert.4820.1"}
  %convert.4940.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3134.9), metadata={scheduling_name="convert.4940.1.clone.1"}
  %multiply.2980.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3138.5, %add.3138.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2980.1.clone.1"}
  %bitcast.29993.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2980.1.clone.1), metadata={scheduling_name="bitcast.29993.1.clone.1"}
  %constant_2882_132_clone_1 = f32[] constant(0)
  %reduce.693.1.clone.1 = f32[1024]{0} reduce(%bitcast.29993.1.clone.1, %constant_2882_132_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.693.1.clone.1"}
  %convert.4967.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3135.9), metadata={scheduling_name="convert.4967.1.clone.1"}
  %bitcast.29550.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2915.15), metadata={scheduling_name="bitcast.29550.1.clone.1"}
  %reduce.657.1.clone.1 = f32[1024]{0} reduce(%bitcast.29550.1.clone.1, %constant_2882_132_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.657.1.clone.1"}
  ROOT %tuple.637 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4820.1, %convert.4940.1.clone.1, %reduce.693.1.clone.1, %convert.4967.1.clone.1, %reduce.657.1.clone.1), metadata={scheduling_name="tuple.637"}
}

%fused_convert_reduce.25 (param_0.5999: bf16[2,1,768,8,128], param_1.6424: f32[], param_2.4606: bf16[2,1,768,8,128], param_3.3777: f32[], param_4.2760: bf16[2,1,768,8,128], param_5.2532: bf16[2,1,768,8,128], param_6.2294: f32[], param_7.2124: pred[], param_8.1961: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.5999 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5999"}
  %convert.4862.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5999), metadata={scheduling_name="convert.4862.16"}
  %param_8.1961 = f32[] parameter(8), metadata={scheduling_name="param_8.1961"}
  %broadcast.6174.28 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1961), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.28"}
  %param_7.2124 = pred[] parameter(7), metadata={scheduling_name="param_7.2124"}
  %broadcast.5876.52 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2124), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5876.52"}
  %param_5.2532 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2532"}
  %convert.4386.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2532), metadata={scheduling_name="convert.4386.20"}
  %param_6.2294 = f32[] parameter(6), metadata={scheduling_name="param_6.2294"}
  %broadcast.6176.68 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2294), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6176.68"}
  %divide.541.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4386.20, %broadcast.6176.68), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.541.17"}
  %convert.4866.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.541.17), metadata={scheduling_name="convert.4866.15"}
  %select.1384.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5876.52, %param_5.2532, %convert.4866.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1384.13"}
  %convert.4867.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1384.13), metadata={scheduling_name="convert.4867.26"}
  %constant_3096_17 = bf16[] constant(0.1001)
  %convert.5015.372 = f32[] convert(%constant_3096_17), metadata={scheduling_name="convert.5015.372"}
  %broadcast.6178.97 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5015.372), dimensions={}, metadata={scheduling_name="broadcast.6178.97"}
  %multiply.2939.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4867.26, %broadcast.6178.97), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2939.11"}
  %param_4.2760 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2760"}
  %convert.4870.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2760), metadata={scheduling_name="convert.4870.9"}
  %constant_3097_17 = bf16[] constant(0.8984)
  %convert.5016.197 = f32[] convert(%constant_3097_17), metadata={scheduling_name="convert.5016.197"}
  %broadcast.6180.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5016.197), dimensions={}, metadata={scheduling_name="broadcast.6180.49"}
  %multiply.2940.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4870.9, %broadcast.6180.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2940.11"}
  %add.3150.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2939.11, %multiply.2940.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3150.9"}
  %param_3.3777 = f32[] parameter(3), metadata={scheduling_name="param_3.3777"}
  %broadcast.6182.36 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3777), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6182.36"}
  %multiply.2941.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4867.26, %convert.4867.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2941.15"}
  %constant_3103_17 = bf16[] constant(0.05005)
  %convert.5018.197 = f32[] convert(%constant_3103_17), metadata={scheduling_name="convert.5018.197"}
  %broadcast.6184.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.197), dimensions={}, metadata={scheduling_name="broadcast.6184.49"}
  %multiply.2942.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2941.15, %broadcast.6184.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2942.11"}
  %param_2.4606 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4606"}
  %convert.4876.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4606), metadata={scheduling_name="convert.4876.9"}
  %constant_3104_17 = bf16[] constant(0.9492)
  %convert.5020.199 = f32[] convert(%constant_3104_17), metadata={scheduling_name="convert.5020.199"}
  %broadcast.6186.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5020.199), dimensions={}, metadata={scheduling_name="broadcast.6186.49"}
  %multiply.2943.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4876.9, %broadcast.6186.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2943.11"}
  %add.3151.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2942.11, %multiply.2943.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3151.9"}
  %param_1.6424 = f32[] parameter(1), metadata={scheduling_name="param_1.6424"}
  %broadcast.6188.52 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6424), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6188.52"}
  %divide.542.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3151.9, %broadcast.6188.52), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.542.13"}
  %sqrt.103.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.542.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.103.11"}
  %constant_3107_17 = bf16[] constant(1.001e-08)
  %convert.5023.174 = f32[] convert(%constant_3107_17), metadata={scheduling_name="convert.5023.174"}
  %broadcast.6190.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.174), dimensions={}, metadata={scheduling_name="broadcast.6190.41"}
  %add.3152.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.103.11, %broadcast.6190.41), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3152.9"}
  %multiply.2944.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6182.36, %add.3152.9), metadata={scheduling_name="multiply.2944.9"}
  %divide.543.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3150.9, %multiply.2944.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.543.7"}
  %multiply.2945.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4862.16, %broadcast.6178.97), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2945.11"}
  %add.3153.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.543.7, %multiply.2945.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3153.9"}
  %multiply.2946.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6174.28, %add.3153.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2946.7"}
  %add.3154.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4862.16, %multiply.2946.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3154.5"}
  %convert.4882.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3154.5), metadata={scheduling_name="convert.4882.1"}
  %convert.4944.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3150.9), metadata={scheduling_name="convert.4944.1.clone.1"}
  %multiply.2983.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3154.5, %add.3154.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2983.1.clone.1"}
  %bitcast.30047.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2983.1.clone.1), metadata={scheduling_name="bitcast.30047.1.clone.1"}
  %constant_2882_135_clone_1 = f32[] constant(0)
  %reduce.699.1.clone.1 = f32[1024]{0} reduce(%bitcast.30047.1.clone.1, %constant_2882_135_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.699.1.clone.1"}
  %convert.4970.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3151.9), metadata={scheduling_name="convert.4970.1.clone.1"}
  %bitcast.29601.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2941.15), metadata={scheduling_name="bitcast.29601.1.clone.1"}
  %reduce.663.1.clone.1 = f32[1024]{0} reduce(%bitcast.29601.1.clone.1, %constant_2882_135_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.663.1.clone.1"}
  ROOT %tuple.639 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4882.1, %convert.4944.1.clone.1, %reduce.699.1.clone.1, %convert.4970.1.clone.1, %reduce.663.1.clone.1), metadata={scheduling_name="tuple.639"}
}

%fused_reduce.70 (param_0.5829: s32[256]) -> s32[] {
  %param_0.5829 = s32[256]{0} parameter(0), metadata={scheduling_name="param_0.5829"}
  %constant_2840_4 = s32[] constant(0)
  ROOT %reduce.179.1 = s32[] reduce(%param_0.5829, %constant_2840_4), dimensions={0}, to_apply=%region_7.620, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="reduce.179.1"}
}

%fused_broadcast.7 () -> (bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144]) {
  %constant_2852_1 = bf16[] constant(0)
  %broadcast.5734.1 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_2852_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=97 scheduling_name="broadcast.5734.1"}
  %copy.1013 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5734.1), metadata={scheduling_name="copy.1013"}
  %copy.1014 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5734.1), metadata={scheduling_name="copy.1014"}
  %copy.1015 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5734.1), metadata={scheduling_name="copy.1015"}
  ROOT %tuple.671 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%broadcast.5734.1, %copy.1013, %copy.1014, %copy.1015), metadata={scheduling_name="tuple.671"}
}

%fused_broadcast.8 () -> (bf16[1,4,4,8192,6144], bf16[1,4,4,8192,6144]) {
  %constant_2852_2 = bf16[] constant(0)
  %broadcast.5733.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2852_2), dimensions={}, metadata={scheduling_name="broadcast.5733.1"}
  %copy.1012 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%broadcast.5733.1), metadata={scheduling_name="copy.1012"}
  ROOT %tuple.670 = (bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}) tuple(%broadcast.5733.1, %copy.1012), metadata={scheduling_name="tuple.670"}
}

%fused_broadcast.9 () -> bf16[2,1,4,8192,6144] {
  %constant_2852_3 = bf16[] constant(0)
  ROOT %broadcast.5794.1 = bf16[2,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2852_3), dimensions={}, metadata={scheduling_name="broadcast.5794.1"}
}

%fused_broadcast.10 () -> (bf16[9,1,4,8192,6144], bf16[9,1,4,8192,6144]) {
  %constant_2852_4 = bf16[] constant(0)
  %broadcast.5737.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2852_4), dimensions={}, metadata={scheduling_name="broadcast.5737.1"}
  %copy.1016 = bf16[9,1,4,8192,6144]{4,3,2,1,0} copy(%broadcast.5737.1), metadata={scheduling_name="copy.1016"}
  ROOT %tuple.672 = (bf16[9,1,4,8192,6144]{4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}) tuple(%broadcast.5737.1, %copy.1016), metadata={scheduling_name="tuple.672"}
}

%fused_broadcast.11 () -> (bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,48,128]) {
  %constant_2852_5 = bf16[] constant(0)
  %broadcast.5740.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} broadcast(%constant_2852_5), dimensions={}, metadata={scheduling_name="broadcast.5740.1"}
  %copy.1018 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} copy(%broadcast.5740.1), metadata={scheduling_name="copy.1018"}
  ROOT %tuple.674 = (bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}) tuple(%broadcast.5740.1, %copy.1018), metadata={scheduling_name="tuple.674"}
}

%fused_broadcast.12 () -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128]) {
  %constant_2852_7 = bf16[] constant(0)
  %broadcast.5779.1 = bf16[2,1,768,48,128]{4,3,2,1,0} broadcast(%constant_2852_7), dimensions={}, metadata={scheduling_name="broadcast.5779.1"}
  %copy.1027 = bf16[2,1,768,48,128]{4,3,2,1,0} copy(%broadcast.5779.1), metadata={scheduling_name="copy.1027"}
  ROOT %tuple.679 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}) tuple(%broadcast.5779.1, %copy.1027), metadata={scheduling_name="tuple.679"}
}

%fused_convert.19 () -> f32[] {
  %constant_2852_8 = bf16[] constant(0)
  ROOT %convert.4338.1 = f32[] convert(%constant_2852_8), metadata={scheduling_name="convert.4338.1"}
}

%fused_broadcast.13 () -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], bf16[2,1,768,8,128], bf16[2,1,768,8,128]) {
  %constant_2852_9 = bf16[] constant(0)
  %broadcast.5777.1 = bf16[2,1,768,8,128]{4,3,2,1,0} broadcast(%constant_2852_9), dimensions={}, metadata={scheduling_name="broadcast.5777.1"}
  %copy.1023 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5777.1), metadata={scheduling_name="copy.1023"}
  %copy.1024 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5777.1), metadata={scheduling_name="copy.1024"}
  %copy.1025 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5777.1), metadata={scheduling_name="copy.1025"}
  ROOT %tuple.677 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%broadcast.5777.1, %copy.1023, %copy.1024, %copy.1025), metadata={scheduling_name="tuple.677"}
}

%fused_broadcast.14 () -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384]) {
  %constant_2852_11 = bf16[] constant(0)
  %broadcast.5772.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%constant_2852_11), dimensions={}, metadata={scheduling_name="broadcast.5772.1"}
  %copy.1019 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5772.1), metadata={scheduling_name="copy.1019"}
  %copy.1020 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5772.1), metadata={scheduling_name="copy.1020"}
  %copy.1021 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5772.1), metadata={scheduling_name="copy.1021"}
  ROOT %tuple.675 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}) tuple(%broadcast.5772.1, %copy.1019, %copy.1020, %copy.1021), metadata={scheduling_name="tuple.675"}
}

%fused_broadcast.15 () -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768]) {
  %constant_2852_12 = bf16[] constant(0)
  %broadcast.6029.1 = bf16[2,1,48,128,768]{3,2,4,1,0} broadcast(%constant_2852_12), dimensions={}, metadata={scheduling_name="broadcast.6029.1"}
  %copy.1026 = bf16[2,1,48,128,768]{3,2,4,1,0} copy(%broadcast.6029.1), metadata={scheduling_name="copy.1026"}
  ROOT %tuple.678 = (bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}) tuple(%broadcast.6029.1, %copy.1026), metadata={scheduling_name="tuple.678"}
}

%fused_broadcast.16 () -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144]) {
  %constant_2852_13 = bf16[] constant(0)
  %broadcast.5774.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%constant_2852_13), dimensions={}, metadata={scheduling_name="broadcast.5774.1"}
  %copy.1022 = bf16[2,1,1,16384,6144]{4,3,2,1,0} copy(%broadcast.5774.1), metadata={scheduling_name="copy.1022"}
  ROOT %tuple.676 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}) tuple(%broadcast.5774.1, %copy.1022), metadata={scheduling_name="tuple.676"}
}

%fused_broadcast.17 () -> (f32[9,1,4,48,8192,1], f32[9,1,4,48,8192,1]) {
  %constant_2882_2 = f32[] constant(0)
  %broadcast.6026.1 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} broadcast(%constant_2882_2), dimensions={}, metadata={scheduling_name="broadcast.6026.1"}
  %copy.1017 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} copy(%broadcast.6026.1), metadata={scheduling_name="copy.1017"}
  ROOT %tuple.673 = (f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}) tuple(%broadcast.6026.1, %copy.1017), metadata={scheduling_name="tuple.673"}
}

%fused_reduce.71 (param_0.5859: f32[128]) -> f32[] {
  %param_0.5859 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5859"}
  %constant_2882_14 = f32[] constant(0)
  ROOT %reduce.237.1 = f32[] reduce(%param_0.5859, %constant_2882_14), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.237.1"}
}

%fused_reduce.72 (param_0.5860: f32[128]) -> f32[] {
  %param_0.5860 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5860"}
  %constant_2882_15 = f32[] constant(0)
  ROOT %reduce.236.1 = f32[] reduce(%param_0.5860, %constant_2882_15), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.236.1"}
}

%fused_reduce.73 (param_0.5861: f32[1024]) -> f32[] {
  %param_0.5861 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5861"}
  %constant_2882_16 = f32[] constant(0)
  ROOT %reduce.240.1 = f32[] reduce(%param_0.5861, %constant_2882_16), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.240.1"}
}

%fused_reduce.74 (param_0.5862: f32[128]) -> f32[] {
  %param_0.5862 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5862"}
  %constant_2882_17 = f32[] constant(0)
  ROOT %reduce.246.1 = f32[] reduce(%param_0.5862, %constant_2882_17), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.246.1"}
}

%fused_reduce.75 (param_0.5863: f32[128]) -> f32[] {
  %param_0.5863 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5863"}
  %constant_2882_18 = f32[] constant(0)
  ROOT %reduce.247.1 = f32[] reduce(%param_0.5863, %constant_2882_18), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.247.1"}
}

%fused_reduce.76 (param_0.5864: f32[128]) -> f32[] {
  %param_0.5864 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5864"}
  %constant_2882_19 = f32[] constant(0)
  ROOT %reduce.245.1 = f32[] reduce(%param_0.5864, %constant_2882_19), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.245.1"}
}

%fused_reduce.77 (param_0.5866: f32[1024]) -> f32[] {
  %param_0.5866 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5866"}
  %constant_2882_21 = f32[] constant(0)
  ROOT %reduce.243.1 = f32[] reduce(%param_0.5866, %constant_2882_21), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.243.1"}
}

%fused_reduce.78 (param_0.5867: f32[2048]) -> f32[] {
  %param_0.5867 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5867"}
  %constant_2882_22 = f32[] constant(0)
  ROOT %reduce.242.1 = f32[] reduce(%param_0.5867, %constant_2882_22), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.242.1"}
}

%fused_reduce.79 (param_0.5868: f32[2048]) -> f32[] {
  %param_0.5868 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5868"}
  %constant_2882_23 = f32[] constant(0)
  ROOT %reduce.241.1 = f32[] reduce(%param_0.5868, %constant_2882_23), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.241.1"}
}

%fused_reduce.80 (param_0.5872: f32[1024]) -> f32[] {
  %param_0.5872 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5872"}
  %constant_2882_27 = f32[] constant(0)
  ROOT %reduce.250.1 = f32[] reduce(%param_0.5872, %constant_2882_27), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.250.1"}
}

%fused_reduce.81 (param_0.5873: f32[8,8192,128]) -> f32[8,8192] {
  %param_0.5873 = f32[8,8192,128]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5873"}
  %constant_2882_28 = f32[] constant(0)
  ROOT %reduce.181.1 = f32[8,8192]{1,0} reduce(%param_0.5873, %constant_2882_28), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="reduce.181.1"}
}

%fused_reduce.82 (param_0.5874: f32[2048]) -> f32[] {
  %param_0.5874 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5874"}
  %constant_2882_29 = f32[] constant(0)
  ROOT %reduce.252.1 = f32[] reduce(%param_0.5874, %constant_2882_29), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.252.1"}
}

%fused_reduce.83 (param_0.5876: f32[4096]) -> f32[] {
  %param_0.5876 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5876"}
  %constant_2882_31 = f32[] constant(0)
  ROOT %reduce.184.1 = f32[] reduce(%param_0.5876, %constant_2882_31), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.184.1"}
}

%fused_reduce.84 (param_0.5879: f32[128]) -> f32[] {
  %param_0.5879 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5879"}
  %constant_2882_34 = f32[] constant(0)
  ROOT %reduce.187.1 = f32[] reduce(%param_0.5879, %constant_2882_34), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.187.1"}
}

%fused_reduce.85 (param_0.5880: f32[128]) -> f32[] {
  %param_0.5880 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5880"}
  %constant_2882_35 = f32[] constant(0)
  ROOT %reduce.188.1 = f32[] reduce(%param_0.5880, %constant_2882_35), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.188.1"}
}

%fused_reduce.86 (param_0.5881: f32[128]) -> f32[] {
  %param_0.5881 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5881"}
  %constant_2882_36 = f32[] constant(0)
  ROOT %reduce.189.1 = f32[] reduce(%param_0.5881, %constant_2882_36), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.189.1"}
}

%fused_reduce.87 (param_0.5884: f32[1024]) -> f32[] {
  %param_0.5884 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5884"}
  %constant_2882_39 = f32[] constant(0)
  ROOT %reduce.192.1 = f32[] reduce(%param_0.5884, %constant_2882_39), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.192.1"}
}

%fused_reduce.88 (param_0.5885: f32[2048]) -> f32[] {
  %param_0.5885 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5885"}
  %constant_2882_40 = f32[] constant(0)
  ROOT %reduce.193.1 = f32[] reduce(%param_0.5885, %constant_2882_40), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.193.1"}
}

%fused_reduce.89 (param_0.5886: f32[2048]) -> f32[] {
  %param_0.5886 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5886"}
  %constant_2882_41 = f32[] constant(0)
  ROOT %reduce.194.1 = f32[] reduce(%param_0.5886, %constant_2882_41), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.194.1"}
}

%fused_reduce.90 (param_0.5887: f32[1024]) -> f32[] {
  %param_0.5887 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5887"}
  %constant_2882_42 = f32[] constant(0)
  ROOT %reduce.195.1 = f32[] reduce(%param_0.5887, %constant_2882_42), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.195.1"}
}

%fused_reduce.91 (param_0.5889: f32[128]) -> f32[] {
  %param_0.5889 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5889"}
  %constant_2882_44 = f32[] constant(0)
  ROOT %reduce.197.1 = f32[] reduce(%param_0.5889, %constant_2882_44), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.197.1"}
}

%fused_reduce.92 (param_0.5890: f32[128]) -> f32[] {
  %param_0.5890 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5890"}
  %constant_2882_45 = f32[] constant(0)
  ROOT %reduce.198.1 = f32[] reduce(%param_0.5890, %constant_2882_45), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.198.1"}
}

%fused_reduce.93 (param_0.5891: f32[128]) -> f32[] {
  %param_0.5891 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5891"}
  %constant_2882_46 = f32[] constant(0)
  ROOT %reduce.199.1 = f32[] reduce(%param_0.5891, %constant_2882_46), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.199.1"}
}

%fused_reduce.94 (param_0.5894: f32[1024]) -> f32[] {
  %param_0.5894 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5894"}
  %constant_2882_49 = f32[] constant(0)
  ROOT %reduce.202.1 = f32[] reduce(%param_0.5894, %constant_2882_49), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.202.1"}
}

%fused_reduce.95 (param_0.5895: f32[2048]) -> f32[] {
  %param_0.5895 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5895"}
  %constant_2882_50 = f32[] constant(0)
  ROOT %reduce.203.1 = f32[] reduce(%param_0.5895, %constant_2882_50), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.203.1"}
}

%fused_reduce.96 (param_0.5896: f32[2048]) -> f32[] {
  %param_0.5896 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5896"}
  %constant_2882_51 = f32[] constant(0)
  ROOT %reduce.204.1 = f32[] reduce(%param_0.5896, %constant_2882_51), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.204.1"}
}

%fused_reduce.97 (param_0.5897: f32[1024]) -> f32[] {
  %param_0.5897 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5897"}
  %constant_2882_52 = f32[] constant(0)
  ROOT %reduce.205.1 = f32[] reduce(%param_0.5897, %constant_2882_52), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.205.1"}
}

%fused_reduce.98 (param_0.5898: f32[4096]) -> f32[] {
  %param_0.5898 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5898"}
  %constant_2882_53 = f32[] constant(0)
  ROOT %reduce.206.1 = f32[] reduce(%param_0.5898, %constant_2882_53), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.206.1"}
}

%fused_reduce.99 (param_0.5900: f32[4096]) -> f32[] {
  %param_0.5900 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5900"}
  %constant_2882_55 = f32[] constant(0)
  ROOT %reduce.208.1 = f32[] reduce(%param_0.5900, %constant_2882_55), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.208.1"}
}

%fused_reduce.100 (param_0.5902: f32[128]) -> f32[] {
  %param_0.5902 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5902"}
  %constant_2882_57 = f32[] constant(0)
  ROOT %reduce.210.1 = f32[] reduce(%param_0.5902, %constant_2882_57), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.210.1"}
}

%fused_reduce.101 (param_0.5903: f32[128]) -> f32[] {
  %param_0.5903 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5903"}
  %constant_2882_58 = f32[] constant(0)
  ROOT %reduce.211.1 = f32[] reduce(%param_0.5903, %constant_2882_58), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.211.1"}
}

%fused_reduce.102 (param_0.5904: f32[128]) -> f32[] {
  %param_0.5904 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5904"}
  %constant_2882_59 = f32[] constant(0)
  ROOT %reduce.212.1 = f32[] reduce(%param_0.5904, %constant_2882_59), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.212.1"}
}

%fused_reduce.103 (param_0.5907: f32[1024]) -> f32[] {
  %param_0.5907 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5907"}
  %constant_2882_62 = f32[] constant(0)
  ROOT %reduce.215.1 = f32[] reduce(%param_0.5907, %constant_2882_62), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.215.1"}
}

%fused_reduce.104 (param_0.5908: f32[2048]) -> f32[] {
  %param_0.5908 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5908"}
  %constant_2882_63 = f32[] constant(0)
  ROOT %reduce.216.1 = f32[] reduce(%param_0.5908, %constant_2882_63), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.216.1"}
}

%fused_reduce.105 (param_0.5909: f32[2048]) -> f32[] {
  %param_0.5909 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5909"}
  %constant_2882_64 = f32[] constant(0)
  ROOT %reduce.217.1 = f32[] reduce(%param_0.5909, %constant_2882_64), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.217.1"}
}

%fused_reduce.106 (param_0.5910: f32[1024]) -> f32[] {
  %param_0.5910 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5910"}
  %constant_2882_65 = f32[] constant(0)
  ROOT %reduce.218.1 = f32[] reduce(%param_0.5910, %constant_2882_65), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.218.1"}
}

%fused_reduce.107 (param_0.5912: f32[128]) -> f32[] {
  %param_0.5912 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5912"}
  %constant_2882_67 = f32[] constant(0)
  ROOT %reduce.220.1 = f32[] reduce(%param_0.5912, %constant_2882_67), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.220.1"}
}

%fused_reduce.108 (param_0.5913: f32[128]) -> f32[] {
  %param_0.5913 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5913"}
  %constant_2882_68 = f32[] constant(0)
  ROOT %reduce.221.1 = f32[] reduce(%param_0.5913, %constant_2882_68), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.221.1"}
}

%fused_reduce.109 (param_0.5914: f32[128]) -> f32[] {
  %param_0.5914 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5914"}
  %constant_2882_69 = f32[] constant(0)
  ROOT %reduce.222.1 = f32[] reduce(%param_0.5914, %constant_2882_69), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.222.1"}
}

%fused_reduce.110 (param_0.5917: f32[1024]) -> f32[] {
  %param_0.5917 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5917"}
  %constant_2882_72 = f32[] constant(0)
  ROOT %reduce.225.1 = f32[] reduce(%param_0.5917, %constant_2882_72), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.225.1"}
}

%fused_reduce.111 (param_0.5918: f32[2048]) -> f32[] {
  %param_0.5918 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5918"}
  %constant_2882_73 = f32[] constant(0)
  ROOT %reduce.226.1 = f32[] reduce(%param_0.5918, %constant_2882_73), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.226.1"}
}

%fused_reduce.112 (param_0.5919: f32[2048]) -> f32[] {
  %param_0.5919 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5919"}
  %constant_2882_74 = f32[] constant(0)
  ROOT %reduce.227.1 = f32[] reduce(%param_0.5919, %constant_2882_74), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.227.1"}
}

%fused_reduce.113 (param_0.5920: f32[1024]) -> f32[] {
  %param_0.5920 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5920"}
  %constant_2882_75 = f32[] constant(0)
  ROOT %reduce.228.1 = f32[] reduce(%param_0.5920, %constant_2882_75), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.228.1"}
}

%fused_reduce.114 (param_0.5921: f32[4096]) -> f32[] {
  %param_0.5921 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5921"}
  %constant_2882_76 = f32[] constant(0)
  ROOT %reduce.229.1 = f32[] reduce(%param_0.5921, %constant_2882_76), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.229.1"}
}

%fused_reduce.115 (param_0.5922: f32[2048]) -> f32[] {
  %param_0.5922 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5922"}
  %constant_2882_77 = f32[] constant(0)
  ROOT %reduce.251.1 = f32[] reduce(%param_0.5922, %constant_2882_77), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.251.1"}
}

%fused_reduce.116 (param_0.5923: f32[8,8192,128]) -> f32[8,8192] {
  %param_0.5923 = f32[8,8192,128]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5923"}
  %constant_2882_78 = f32[] constant(0)
  ROOT %reduce.230.1 = f32[8,8192]{1,0} reduce(%param_0.5923, %constant_2882_78), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="reduce.230.1"}
}

%fused_reduce.117 (param_0.5924: f32[1024]) -> f32[] {
  %param_0.5924 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5924"}
  %constant_2882_79 = f32[] constant(0)
  ROOT %reduce.253.1 = f32[] reduce(%param_0.5924, %constant_2882_79), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.253.1"}
}

%fused_reduce.118 (param_0.5925: f32[4096]) -> f32[] {
  %param_0.5925 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5925"}
  %constant_2882_80 = f32[] constant(0)
  ROOT %reduce.254.1 = f32[] reduce(%param_0.5925, %constant_2882_80), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.254.1"}
}

%fused_reduce.119 (param_0.5926: f32[256]) -> f32[] {
  %param_0.5926 = f32[256]{0} parameter(0), metadata={scheduling_name="param_0.5926"}
  %constant_2882_81 = f32[] constant(0)
  ROOT %reduce.231.1 = f32[] reduce(%param_0.5926, %constant_2882_81), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="reduce.231.1"}
}

%fused_reduce.120 (param_0.5928: f32[4096]) -> f32[] {
  %param_0.5928 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5928"}
  %constant_2882_83 = f32[] constant(0)
  ROOT %reduce.233.1 = f32[] reduce(%param_0.5928, %constant_2882_83), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.233.1"}
}

%fused_reduce.121 (param_0.5930: f32[128]) -> f32[] {
  %param_0.5930 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5930"}
  %constant_2882_85 = f32[] constant(0)
  ROOT %reduce.235.1 = f32[] reduce(%param_0.5930, %constant_2882_85), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.235.1"}
}

%fused_reduce.122 (param_0.5997: f32[65536,128]) -> f32[65536] {
  %param_0.5997 = f32[65536,128]{1,0} parameter(0), metadata={scheduling_name="param_0.5997"}
  %constant_2983_2 = f32[] constant(-inf)
  ROOT %reduce.330.1 = f32[65536]{0} reduce(%param_0.5997, %constant_2983_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="reduce.330.1"}
}

%fused_compare_dynamic_slice (param_0.6074: s32[16], param_1.6473: u32[]) -> (pred[1], s32[1]) {
  %param_0.6074 = s32[16]{0} parameter(0), metadata={scheduling_name="param_0.6074"}
  %param_1.6473 = u32[] parameter(1), metadata={scheduling_name="param_1.6473"}
  %dynamic-slice.1459.1 = s32[1]{0} dynamic-slice(%param_0.6074, %param_1.6473), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="dynamic-slice.1459.1"}
  %constant_5025_1 = s32[1]{0} constant({0})
  %compare.1721.1 = pred[1]{0} compare(%dynamic-slice.1459.1, %constant_5025_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="compare.1721.1"}
  ROOT %tuple.646 = (pred[1]{0}, s32[1]{0}) tuple(%compare.1721.1, %dynamic-slice.1459.1), metadata={scheduling_name="tuple.646"}
}

%fused_compare.12 (param_0.6057: s32[1]) -> pred[1] {
  %param_0.6057 = s32[1]{0} parameter(0), metadata={scheduling_name="param_0.6057"}
  %constant_5028_1 = s32[1]{0} constant({1})
  ROOT %compare.1722.1 = pred[1]{0} compare(%param_0.6057, %constant_5028_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="compare.1722.1"}
}

%fused_add_select (param_0_0.2: s32[], param_1_0.2: s32[]) -> (s32[], s32[]) {
  %param_0_0.2 = s32[] parameter(0), metadata={scheduling_name="param_0_0.2"}
  %constant_2836_5 = s32[] constant(1)
  %add.2998.2 = s32[] add(%param_0_0.2, %constant_2836_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.2998.2"}
  %param_1_0.2 = s32[] parameter(1), metadata={scheduling_name="param_1_0.2"}
  %constant_3100_3 = s32[] constant(2147483647)
  %compare.1727.2 = pred[] compare(%param_1_0.2, %constant_3100_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1727.2"}
  %add.3160.2 = s32[] add(%param_1_0.2, %constant_2836_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3160.2"}
  %select.1386.2 = s32[] select(%compare.1727.2, %add.3160.2, %constant_3100_3), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1386.2"}
  ROOT %tuple.650 = (s32[], s32[]) tuple(%add.2998.2, %select.1386.2), metadata={scheduling_name="tuple.650"}
}

%fused_convert.20 (param_0_0.3: f32[], param_0_1.1: f32[], param_0_2: f32[], param_0_3: f32[], param_0_4: f32[], param_0_5: f32[], param_0_6: f32[], param_0_7: f32[], param_0_8: f32[], param_0_9: f32[], param_0_10: f32[], param_0_11: f32[], param_0_12: f32[], param_0_13: f32[], param_0_14: f32[], param_0_15: f32[], param_0_16: f32[], param_0_17: f32[], param_0_18: f32[], param_0_19: f32[], param_0_20: f32[], param_0_21: f32[], param_0_22: f32[], param_1_0.3: f32[], param_1_1.1: f32[], param_1_2: f32[], param_1_3: f32[], param_1_4: f32[], param_1_5: f32[], param_1_6: f32[], param_1_7: f32[], param_1_8: f32[], param_1_9: f32[], param_1_10: f32[], param_1_11: f32[], param_1_12: f32[], param_1_13: f32[], param_1_14: f32[], param_1_15: f32[], param_1_16: f32[], param_1_17: f32[], param_1_18: f32[], param_1_19: f32[], param_1_20: f32[], param_1_21: f32[], param_1_22: f32[], param_2_0: f32[], param_2_1: f32[], param_2_2: f32[], param_2_3: f32[], param_2_4: f32[], param_2_5: f32[], param_2_6: f32[], param_2_7: f32[], param_2_8: f32[], param_2_9: f32[], param_2_10: f32[], param_2_11: f32[], param_2_12: f32[], param_2_13: f32[], param_2_14: f32[], param_2_15: f32[], param_2_16: f32[], param_2_17: f32[], param_2_18: f32[], param_2_19: f32[], param_2_20: f32[], param_2_21: f32[], param_2_22: f32[]) -> (bf16[], bf16[], bf16[]) {
  %param_0_21 = f32[] parameter(21), metadata={scheduling_name="param_0_21"}
  %param_0_22 = f32[] parameter(22), metadata={scheduling_name="param_0_22"}
  %add.3207.2 = f32[] add(%param_0_21, %param_0_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3207.2"}
  %param_0_20 = f32[] parameter(20), metadata={scheduling_name="param_0_20"}
  %add.3208.2 = f32[] add(%add.3207.2, %param_0_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3208.2"}
  %param_0_19 = f32[] parameter(19), metadata={scheduling_name="param_0_19"}
  %add.3209.2 = f32[] add(%add.3208.2, %param_0_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3209.2"}
  %param_0_18 = f32[] parameter(18), metadata={scheduling_name="param_0_18"}
  %add.3210.2 = f32[] add(%add.3209.2, %param_0_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3210.2"}
  %param_0_17 = f32[] parameter(17), metadata={scheduling_name="param_0_17"}
  %add.3211.2 = f32[] add(%add.3210.2, %param_0_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3211.2"}
  %param_0_16 = f32[] parameter(16), metadata={scheduling_name="param_0_16"}
  %add.3212.2 = f32[] add(%add.3211.2, %param_0_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3212.2"}
  %param_0_15 = f32[] parameter(15), metadata={scheduling_name="param_0_15"}
  %add.3213.2 = f32[] add(%add.3212.2, %param_0_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3213.2"}
  %param_0_14 = f32[] parameter(14), metadata={scheduling_name="param_0_14"}
  %add.3214.2 = f32[] add(%add.3213.2, %param_0_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3214.2"}
  %param_0_13 = f32[] parameter(13), metadata={scheduling_name="param_0_13"}
  %add.3215.2 = f32[] add(%add.3214.2, %param_0_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3215.2"}
  %param_0_12 = f32[] parameter(12), metadata={scheduling_name="param_0_12"}
  %add.3216.2 = f32[] add(%add.3215.2, %param_0_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3216.2"}
  %param_0_11 = f32[] parameter(11), metadata={scheduling_name="param_0_11"}
  %add.3217.2 = f32[] add(%add.3216.2, %param_0_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3217.2"}
  %param_0_10 = f32[] parameter(10), metadata={scheduling_name="param_0_10"}
  %add.3218.2 = f32[] add(%add.3217.2, %param_0_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3218.2"}
  %param_0_9 = f32[] parameter(9), metadata={scheduling_name="param_0_9"}
  %add.3219.2 = f32[] add(%add.3218.2, %param_0_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3219.2"}
  %param_0_8 = f32[] parameter(8), metadata={scheduling_name="param_0_8"}
  %add.3220.2 = f32[] add(%add.3219.2, %param_0_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3220.2"}
  %param_0_7 = f32[] parameter(7), metadata={scheduling_name="param_0_7"}
  %add.3221.2 = f32[] add(%add.3220.2, %param_0_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3221.2"}
  %param_0_6 = f32[] parameter(6), metadata={scheduling_name="param_0_6"}
  %add.3222.2 = f32[] add(%add.3221.2, %param_0_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3222.2"}
  %param_0_5 = f32[] parameter(5), metadata={scheduling_name="param_0_5"}
  %add.3223.2 = f32[] add(%add.3222.2, %param_0_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3223.2"}
  %param_0_4 = f32[] parameter(4), metadata={scheduling_name="param_0_4"}
  %add.3224.2 = f32[] add(%add.3223.2, %param_0_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3224.2"}
  %param_0_3 = f32[] parameter(3), metadata={scheduling_name="param_0_3"}
  %add.3225.2 = f32[] add(%add.3224.2, %param_0_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3225.2"}
  %param_0_2 = f32[] parameter(2), metadata={scheduling_name="param_0_2"}
  %add.3226.2 = f32[] add(%add.3225.2, %param_0_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3226.2"}
  %param_0_1.1 = f32[] parameter(1), metadata={scheduling_name="param_0_1.1"}
  %add.3227.2 = f32[] add(%add.3226.2, %param_0_1.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3227.2"}
  %param_0_0.3 = f32[] parameter(0), metadata={scheduling_name="param_0_0.3"}
  %add.3228.2 = f32[] add(%add.3227.2, %param_0_0.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3228.2"}
  %sqrt.107.2 = f32[] sqrt(%add.3228.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.107.2"}
  %convert.4974.2 = bf16[] convert(%sqrt.107.2), metadata={scheduling_name="convert.4974.2"}
  %param_1_21 = f32[] parameter(44), metadata={scheduling_name="param_1_21"}
  %param_1_22 = f32[] parameter(45), metadata={scheduling_name="param_1_22"}
  %add.3184.2 = f32[] add(%param_1_21, %param_1_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3184.2"}
  %param_1_20 = f32[] parameter(43), metadata={scheduling_name="param_1_20"}
  %add.3185.2 = f32[] add(%add.3184.2, %param_1_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3185.2"}
  %param_1_19 = f32[] parameter(42), metadata={scheduling_name="param_1_19"}
  %add.3186.2 = f32[] add(%add.3185.2, %param_1_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3186.2"}
  %param_1_18 = f32[] parameter(41), metadata={scheduling_name="param_1_18"}
  %add.3187.2 = f32[] add(%add.3186.2, %param_1_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3187.2"}
  %param_1_17 = f32[] parameter(40), metadata={scheduling_name="param_1_17"}
  %add.3188.2 = f32[] add(%add.3187.2, %param_1_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3188.2"}
  %param_1_16 = f32[] parameter(39), metadata={scheduling_name="param_1_16"}
  %add.3189.2 = f32[] add(%add.3188.2, %param_1_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3189.2"}
  %param_1_15 = f32[] parameter(38), metadata={scheduling_name="param_1_15"}
  %add.3190.2 = f32[] add(%add.3189.2, %param_1_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3190.2"}
  %param_1_14 = f32[] parameter(37), metadata={scheduling_name="param_1_14"}
  %add.3191.2 = f32[] add(%add.3190.2, %param_1_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3191.2"}
  %param_1_13 = f32[] parameter(36), metadata={scheduling_name="param_1_13"}
  %add.3192.2 = f32[] add(%add.3191.2, %param_1_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3192.2"}
  %param_1_12 = f32[] parameter(35), metadata={scheduling_name="param_1_12"}
  %add.3193.2 = f32[] add(%add.3192.2, %param_1_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3193.2"}
  %param_1_11 = f32[] parameter(34), metadata={scheduling_name="param_1_11"}
  %add.3194.2 = f32[] add(%add.3193.2, %param_1_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3194.2"}
  %param_1_10 = f32[] parameter(33), metadata={scheduling_name="param_1_10"}
  %add.3195.2 = f32[] add(%add.3194.2, %param_1_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3195.2"}
  %param_1_9 = f32[] parameter(32), metadata={scheduling_name="param_1_9"}
  %add.3196.2 = f32[] add(%add.3195.2, %param_1_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3196.2"}
  %param_1_8 = f32[] parameter(31), metadata={scheduling_name="param_1_8"}
  %add.3197.2 = f32[] add(%add.3196.2, %param_1_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3197.2"}
  %param_1_7 = f32[] parameter(30), metadata={scheduling_name="param_1_7"}
  %add.3198.2 = f32[] add(%add.3197.2, %param_1_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3198.2"}
  %param_1_6 = f32[] parameter(29), metadata={scheduling_name="param_1_6"}
  %add.3199.2 = f32[] add(%add.3198.2, %param_1_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3199.2"}
  %param_1_5 = f32[] parameter(28), metadata={scheduling_name="param_1_5"}
  %add.3201.2 = f32[] add(%add.3199.2, %param_1_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3201.2"}
  %param_1_4 = f32[] parameter(27), metadata={scheduling_name="param_1_4"}
  %add.3202.2 = f32[] add(%add.3201.2, %param_1_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3202.2"}
  %param_1_3 = f32[] parameter(26), metadata={scheduling_name="param_1_3"}
  %add.3203.2 = f32[] add(%add.3202.2, %param_1_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3203.2"}
  %param_1_2 = f32[] parameter(25), metadata={scheduling_name="param_1_2"}
  %add.3204.2 = f32[] add(%add.3203.2, %param_1_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3204.2"}
  %param_1_1.1 = f32[] parameter(24), metadata={scheduling_name="param_1_1.1"}
  %add.3205.2 = f32[] add(%add.3204.2, %param_1_1.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3205.2"}
  %param_1_0.3 = f32[] parameter(23), metadata={scheduling_name="param_1_0.3"}
  %add.3206.2 = f32[] add(%add.3205.2, %param_1_0.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3206.2"}
  %sqrt.106.2 = f32[] sqrt(%add.3206.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.106.2"}
  %convert.4973.2 = bf16[] convert(%sqrt.106.2), metadata={scheduling_name="convert.4973.2"}
  %param_2_21 = f32[] parameter(67), metadata={scheduling_name="param_2_21"}
  %param_2_22 = f32[] parameter(68), metadata={scheduling_name="param_2_22"}
  %add.3161.2 = f32[] add(%param_2_21, %param_2_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3161.2"}
  %param_2_20 = f32[] parameter(66), metadata={scheduling_name="param_2_20"}
  %add.3162.2 = f32[] add(%add.3161.2, %param_2_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3162.2"}
  %param_2_19 = f32[] parameter(65), metadata={scheduling_name="param_2_19"}
  %add.3163.2 = f32[] add(%add.3162.2, %param_2_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3163.2"}
  %param_2_18 = f32[] parameter(64), metadata={scheduling_name="param_2_18"}
  %add.3164.2 = f32[] add(%add.3163.2, %param_2_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3164.2"}
  %param_2_17 = f32[] parameter(63), metadata={scheduling_name="param_2_17"}
  %add.3165.2 = f32[] add(%add.3164.2, %param_2_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3165.2"}
  %param_2_16 = f32[] parameter(62), metadata={scheduling_name="param_2_16"}
  %add.3166.2 = f32[] add(%add.3165.2, %param_2_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3166.2"}
  %param_2_15 = f32[] parameter(61), metadata={scheduling_name="param_2_15"}
  %add.3167.2 = f32[] add(%add.3166.2, %param_2_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3167.2"}
  %param_2_14 = f32[] parameter(60), metadata={scheduling_name="param_2_14"}
  %add.3168.2 = f32[] add(%add.3167.2, %param_2_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3168.2"}
  %param_2_13 = f32[] parameter(59), metadata={scheduling_name="param_2_13"}
  %add.3169.2 = f32[] add(%add.3168.2, %param_2_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3169.2"}
  %param_2_12 = f32[] parameter(58), metadata={scheduling_name="param_2_12"}
  %add.3170.2 = f32[] add(%add.3169.2, %param_2_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3170.2"}
  %param_2_11 = f32[] parameter(57), metadata={scheduling_name="param_2_11"}
  %add.3171.2 = f32[] add(%add.3170.2, %param_2_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3171.2"}
  %param_2_10 = f32[] parameter(56), metadata={scheduling_name="param_2_10"}
  %add.3172.2 = f32[] add(%add.3171.2, %param_2_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3172.2"}
  %param_2_9 = f32[] parameter(55), metadata={scheduling_name="param_2_9"}
  %add.3173.2 = f32[] add(%add.3172.2, %param_2_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3173.2"}
  %param_2_8 = f32[] parameter(54), metadata={scheduling_name="param_2_8"}
  %add.3174.2 = f32[] add(%add.3173.2, %param_2_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3174.2"}
  %param_2_7 = f32[] parameter(53), metadata={scheduling_name="param_2_7"}
  %add.3175.2 = f32[] add(%add.3174.2, %param_2_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3175.2"}
  %param_2_6 = f32[] parameter(52), metadata={scheduling_name="param_2_6"}
  %add.3176.2 = f32[] add(%add.3175.2, %param_2_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3176.2"}
  %param_2_5 = f32[] parameter(51), metadata={scheduling_name="param_2_5"}
  %add.3177.2 = f32[] add(%add.3176.2, %param_2_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3177.2"}
  %param_2_4 = f32[] parameter(50), metadata={scheduling_name="param_2_4"}
  %add.3178.2 = f32[] add(%add.3177.2, %param_2_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3178.2"}
  %param_2_3 = f32[] parameter(49), metadata={scheduling_name="param_2_3"}
  %add.3179.2 = f32[] add(%add.3178.2, %param_2_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3179.2"}
  %param_2_2 = f32[] parameter(48), metadata={scheduling_name="param_2_2"}
  %add.3180.2 = f32[] add(%add.3179.2, %param_2_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3180.2"}
  %param_2_1 = f32[] parameter(47), metadata={scheduling_name="param_2_1"}
  %add.3181.2 = f32[] add(%add.3180.2, %param_2_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3181.2"}
  %param_2_0 = f32[] parameter(46), metadata={scheduling_name="param_2_0"}
  %add.3182.2 = f32[] add(%add.3181.2, %param_2_0), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3182.2"}
  %sqrt.105.2 = f32[] sqrt(%add.3182.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.105.2"}
  %convert.4972.2 = bf16[] convert(%sqrt.105.2), metadata={scheduling_name="convert.4972.2"}
  ROOT %tuple.651 = (bf16[], bf16[], bf16[]) tuple(%convert.4974.2, %convert.4973.2, %convert.4972.2), metadata={scheduling_name="tuple.651"}
}

%fused_slice.4 () -> (bf16[12288], bf16[12288]) {
  %constant_2852_14 = bf16[] constant(0)
  %broadcast.5775.2 = bf16[2,1,6144]{2,1,0} broadcast(%constant_2852_14), dimensions={}, metadata={scheduling_name="broadcast.5775.2"}
  %reshape.8410 = bf16[12288]{0} reshape(%broadcast.5775.2), metadata={scheduling_name="reshape.8410"}
  %broadcast.5771.2 = bf16[2,1,768,8]{3,2,1,0} broadcast(%constant_2852_14), dimensions={}, metadata={scheduling_name="broadcast.5771.2"}
  %reshape.8411 = bf16[12288]{0} reshape(%broadcast.5771.2), metadata={scheduling_name="reshape.8411"}
  %concatenate.725 = bf16[24576]{0} concatenate(%reshape.8410, %reshape.8411), dimensions={0}, metadata={scheduling_name="concatenate.725"}
  %slice.2442 = bf16[12288]{0} slice(%concatenate.725), slice={[0:12288]}, metadata={scheduling_name="slice.2442"}
  %slice.2443 = bf16[12288]{0} slice(%concatenate.725), slice={[12288:24576]}, metadata={scheduling_name="slice.2443"}
  ROOT %tuple.652 = (bf16[12288]{0}, bf16[12288]{0}) tuple(%slice.2442, %slice.2443), metadata={scheduling_name="tuple.652"}
}

%fused_slice.5 (param_1_0.4: s32[16], param_1_1.2: u32[]) -> (s32[9], s32[65536]) {
  %constant_2840_8 = s32[] constant(0)
  %broadcast.5745.2 = s32[9]{0} broadcast(%constant_2840_8), dimensions={}, metadata={scheduling_name="broadcast.5745.2"}
  %iota.396.2 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.396.2"}
  %param_1_0.4 = s32[16]{0} parameter(0), metadata={scheduling_name="param_1_0.4"}
  %param_1_1.2 = u32[] parameter(1), metadata={scheduling_name="param_1_1.2"}
  %dynamic-slice.1458.6 = s32[1]{0} dynamic-slice(%param_1_0.4, %param_1_1.2), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1458.6"}
  %constant_5024_4 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2720.6 = s32[1]{0} multiply(%dynamic-slice.1458.6, %constant_5024_4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2720.6"}
  %bitcast.26082.7 = s32[] bitcast(%multiply.2720.6), metadata={scheduling_name="bitcast.26082.7"}
  %broadcast.5746.4 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.26082.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5746.4"}
  %add.3004.2 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.396.2, %broadcast.5746.4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3004.2"}
  %reshape.8412 = s32[65536]{0} reshape(%add.3004.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reshape.8412"}
  %concatenate.726 = s32[65545]{0} concatenate(%broadcast.5745.2, %reshape.8412), dimensions={0}, metadata={scheduling_name="concatenate.726"}
  %slice.2444 = s32[9]{0} slice(%concatenate.726), slice={[0:9]}, metadata={scheduling_name="slice.2444"}
  %slice.2445 = s32[65536]{0} slice(%concatenate.726), slice={[9:65545]}, metadata={scheduling_name="slice.2445"}
  ROOT %tuple.653 = (s32[9]{0}, s32[65536]{0}) tuple(%slice.2444, %slice.2445), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="tuple.653"}
}

%fused_slice.6 (param_1_0.5: s32[1], param_1_1.3: s32[16], param_1_2.1: u32[]) -> (u32[72], u32[65536]) {
  %constant_2883_2 = u32[] constant(0)
  %broadcast.5739.2 = u32[9,2,4]{2,1,0} broadcast(%constant_2883_2), dimensions={}, metadata={scheduling_name="broadcast.5739.2"}
  %reshape.8413 = u32[72]{0} reshape(%broadcast.5739.2), metadata={scheduling_name="reshape.8413"}
  %iota.399.8 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.399.8"}
  %iota.400.6 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.400.6"}
  %constant_2913_2 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5751.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_2913_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5751.6"}
  %multiply.2724.6 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.400.6, %broadcast.5751.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2724.6"}
  %add.3005.8 = u32[1,4,8192,2]{3,2,1,0} add(%iota.399.8, %multiply.2724.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3005.8"}
  %iota.401.6 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.401.6"}
  %param_1_1.3 = s32[16]{0} parameter(1), metadata={scheduling_name="param_1_1.3"}
  %param_1_2.1 = u32[] parameter(2), metadata={scheduling_name="param_1_2.1"}
  %dynamic-slice.1458.7 = s32[1]{0} dynamic-slice(%param_1_1.3, %param_1_2.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1458.7"}
  %constant_5024_5 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2720.7 = s32[1]{0} multiply(%dynamic-slice.1458.7, %constant_5024_5), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2720.7"}
  %bitcast.26082.8 = s32[] bitcast(%multiply.2720.7), metadata={scheduling_name="bitcast.26082.8"}
  %convert.4324.4 = u32[] convert(%bitcast.26082.8), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4324.4"}
  %broadcast.5752.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.4324.4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5752.6"}
  %add.3006.6 = u32[1,4,8192,2]{3,2,1,0} add(%iota.401.6, %broadcast.5752.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3006.6"}
  %constant_2919_2 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5753.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_2919_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5753.6"}
  %multiply.2725.6 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.3006.6, %broadcast.5753.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2725.6"}
  %add.3007.6 = u32[1,4,8192,2]{3,2,1,0} add(%add.3005.8, %multiply.2725.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3007.6"}
  %param_1_0.5 = s32[1]{0} parameter(0), metadata={scheduling_name="param_1_0.5"}
  %convert.4325.4 = u32[1]{0} convert(%param_1_0.5), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4325.4"}
  %constant_5192_2 = u32[1]{0} constant({524288}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2726.4 = u32[1]{0} multiply(%convert.4325.4, %constant_5192_2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2726.4"}
  %bitcast.26187.6 = u32[] bitcast(%multiply.2726.4), metadata={scheduling_name="bitcast.26187.6"}
  %broadcast.5754.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.26187.6), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5754.6"}
  %add.3008.4 = u32[1,4,8192,2]{3,2,1,0} add(%add.3007.6, %broadcast.5754.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3008.4"}
  %constant_2926_2 = u32[] constant(1)
  %broadcast.5755.2 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_2926_2), dimensions={}, metadata={scheduling_name="broadcast.5755.2"}
  %add.3009.2 = u32[1,4,8192,2]{3,2,1,0} add(%add.3008.4, %broadcast.5755.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3009.2"}
  %reshape.8414 = u32[65536]{0} reshape(%add.3009.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reshape.8414"}
  %concatenate.727 = u32[65608]{0} concatenate(%reshape.8413, %reshape.8414), dimensions={0}, metadata={scheduling_name="concatenate.727"}
  %slice.2446 = u32[72]{0} slice(%concatenate.727), slice={[0:72]}, metadata={scheduling_name="slice.2446"}
  %slice.2447 = u32[65536]{0} slice(%concatenate.727), slice={[72:65608]}, metadata={scheduling_name="slice.2447"}
  ROOT %tuple.654 = (u32[72]{0}, u32[65536]{0}) tuple(%slice.2446, %slice.2447), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="tuple.654"}
}

%async_computation.13 (param_0.6091: bf16[1,1,1,2,4,8192,6144]) -> bf16[1,1,1,2,4,8192,6144] {
  %param_0.6091 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6091"}
  ROOT %all-to-all.12.1 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6091), channel_id=2, replica_groups={{0,4},{1,5},{2,6},{3,7},{8,12},{9,13},{10,14},{11,15}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all.12.1"}
}

%region_24.1883.clone (Arg_0.3: s32[], Arg_1.3: s32[]) -> s32[] {
  %Arg_1.3 = s32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.3"}
  %Arg_0.3 = s32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.3"}
  ROOT %add.2750.0 = s32[] add(%Arg_0.3, %Arg_1.3), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="add.2750.0"}
}

%region_25.1918.clone (Arg_0.4: bf16[], Arg_1.4: bf16[]) -> bf16[] {
  %Arg_1.4 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" scheduling_name="Arg_1.4"}
  %Arg_0.4 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" scheduling_name="Arg_0.4"}
  ROOT %add.2751.0 = bf16[] add(%Arg_0.4, %Arg_1.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="add.2751.0"}
}

%add.1.clone (x.3: bf16[], y.3: bf16[]) -> bf16[] {
  %y.3 = bf16[] parameter(1), metadata={scheduling_name="y.3"}
  %x.3 = bf16[] parameter(0), metadata={scheduling_name="x.3"}
  ROOT %add.2753.0 = bf16[] add(%x.3, %y.3), metadata={scheduling_name="add.2753.0"}
}

%async_computation.14 (param_0.6092: bf16[1,1,1,2,4,8192,6144]) -> bf16[1,1,1,2,4,8192,6144] {
  %param_0.6092 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6092"}
  ROOT %all-to-all.14.1 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6092), channel_id=146, replica_groups={{0,4},{1,5},{2,6},{3,7},{8,12},{9,13},{10,14},{11,15}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all.14.1"}
}

%async_computation.15 (param_0.6093: bf16[1,2,1,1,4,8192,6144]) -> bf16[1,2,1,1,4,8192,6144] {
  %param_0.6093 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6093"}
  ROOT %all-to-all.15.1 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} all-to-all(%param_0.6093), channel_id=394, replica_groups={{0,1},{2,3},{4,5},{6,7},{8,9},{10,11},{12,13},{14,15}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all.15.1"}
}

%add.13.clone (x.27: bf16[], y.27: bf16[]) -> bf16[] {
  %y.27 = bf16[] parameter(1), metadata={scheduling_name="y.27"}
  %x.27 = bf16[] parameter(0), metadata={scheduling_name="x.27"}
  ROOT %add.2794.0 = bf16[] add(%x.27, %y.27), metadata={scheduling_name="add.2794.0"}
}

%async_computation.16 (param_0.6094: bf16[1,2,1,1,4,8192,6144]) -> bf16[1,2,1,1,4,8192,6144] {
  %param_0.6094 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6094"}
  ROOT %all-to-all.44.1 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} all-to-all(%param_0.6094), channel_id=128, replica_groups={{0,1},{2,3},{4,5},{6,7},{8,9},{10,11},{12,13},{14,15}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all.44.1"}
}

%add.12.clone (x.25: bf16[], y.25: bf16[]) -> bf16[] {
  %y.25 = bf16[] parameter(1), metadata={scheduling_name="y.25"}
  %x.25 = bf16[] parameter(0), metadata={scheduling_name="x.25"}
  ROOT %add.2793.0 = bf16[] add(%x.25, %y.25), metadata={scheduling_name="add.2793.0"}
}

%async_computation.17 (param_0.6095: bf16[6144,32768], param_1.6478: bf16[6144,32768]) -> (bf16[768,32768], bf16[768,32768]) {
  %param_1.6478 = bf16[6144,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6478"}
  %param_0.6095 = bf16[6144,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.6095"}
  ROOT %reduce-scatter.16 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}) reduce-scatter(%param_0.6095, %param_1.6478), channel_id=593, replica_groups=[2,8]<=[16], use_global_device_ids=true, dimensions={0}, to_apply=%add.12.clone, metadata={scheduling_name="reduce-scatter.16"}
}

%region_120.4324.clone (Arg_0.53: f32[], Arg_1.53: f32[]) -> f32[] {
  %Arg_1.53 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.53"}
  %Arg_0.53 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.53"}
  ROOT %add.2795.0 = f32[] add(%Arg_0.53, %Arg_1.53), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2795.0"}
}

%region_119.4315.clone (Arg_0.50: f32[], Arg_1.50: f32[]) -> f32[] {
  %Arg_1.50 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.50"}
  %Arg_0.50 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.50"}
  ROOT %add.2791.0 = f32[] add(%Arg_0.50, %Arg_1.50), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2791.0"}
}

%region_59.2325.clone (Arg_0.12: bf16[], Arg_1.12: bf16[]) -> bf16[] {
  %Arg_1.12 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_1.12"}
  %Arg_0.12 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_0.12"}
  ROOT %add.2765.0 = bf16[] add(%Arg_0.12, %Arg_1.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="add.2765.0"}
}

%region_115.4279.clone (Arg_0.42: f32[], Arg_1.42: f32[]) -> f32[] {
  %Arg_1.42 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.42"}
  %Arg_0.42 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.42"}
  ROOT %add.2787.0 = f32[] add(%Arg_0.42, %Arg_1.42), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2787.0"}
}

%region_189.5599.clone (Arg_0.130: f32[], Arg_1.130: f32[]) -> f32[] {
  %Arg_1.130 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.130"}
  %Arg_0.130 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.130"}
  ROOT %add.2844.0 = f32[] add(%Arg_0.130, %Arg_1.130), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2844.0"}
}

%region_188.5590.clone (Arg_0.128: f32[], Arg_1.128: f32[]) -> f32[] {
  %Arg_1.128 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.128"}
  %Arg_0.128 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.128"}
  ROOT %add.2843.0 = f32[] add(%Arg_0.128, %Arg_1.128), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2843.0"}
}

%region_184.5554.clone (Arg_0.121: f32[], Arg_1.121: f32[]) -> f32[] {
  %Arg_1.121 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.121"}
  %Arg_0.121 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.121"}
  ROOT %add.2839.0 = f32[] add(%Arg_0.121, %Arg_1.121), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2839.0"}
}

%copy_horizontally_fused_computation (param_0_0.4: f32[], param_1.6479: f32[], param_2.4750: s32[]) -> (f32[], f32[], f32[]) {
  %param_0_0.4 = f32[] parameter(0), metadata={scheduling_name="param_0_0.4"}
  %copy.1030 = f32[] copy(%param_0_0.4), metadata={scheduling_name="copy.1030"}
  %copy.1031 = f32[] copy(%param_0_0.4), metadata={scheduling_name="copy.1031"}
  %param_1.6479 = f32[] parameter(1), metadata={scheduling_name="param_1.6479"}
  %param_2.4750 = s32[] parameter(2), metadata={scheduling_name="param_2.4750"}
  %convert.4328.8 = f32[] convert(%param_2.4750), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="convert.4328.8"}
  %constant_2980_3 = f32[] constant(1e-08)
  %add.3012.8 = f32[] add(%convert.4328.8, %constant_2980_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="add.3012.8"}
  %divide.547.2 = f32[] divide(%param_1.6479, %add.3012.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="divide.547.2"}
  ROOT %tuple.680 = (f32[], f32[], f32[]) tuple(%copy.1030, %copy.1031, %divide.547.2), metadata={scheduling_name="tuple.680"}
}

%copy_horizontally_fused_computation.1 (param_0_0.5: bf16[2,1,6144]) -> (bf16[2,1,6144], bf16[2,1,6144]) {
  %param_0_0.5 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0_0.5"}
  %copy.1034 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.5), metadata={scheduling_name="copy.1034"}
  %copy.1035 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.5), metadata={scheduling_name="copy.1035"}
  ROOT %tuple.681 = (bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}) tuple(%copy.1034, %copy.1035), metadata={scheduling_name="tuple.681"}
}

%copy_horizontally_fused_computation.2 (param_0_0.6: bf16[2,1,6144], param_1_0.8: bf16[2,1,768,8]) -> (bf16[12288], bf16[12288]) {
  %param_0_0.6 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0_0.6"}
  %copy.1038 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.6), metadata={scheduling_name="copy.1038"}
  %reshape.8415 = bf16[12288]{0} reshape(%copy.1038), metadata={scheduling_name="reshape.8415"}
  %param_1_0.8 = bf16[2,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1_0.8"}
  %copy.1039 = bf16[2,1,768,8]{3,2,1,0} copy(%param_1_0.8), metadata={scheduling_name="copy.1039"}
  %reshape.8416 = bf16[12288]{0} reshape(%copy.1039), metadata={scheduling_name="reshape.8416"}
  %concatenate.735 = bf16[24576]{0} concatenate(%reshape.8415, %reshape.8416), dimensions={0}, metadata={scheduling_name="concatenate.735"}
  %slice.2541 = bf16[12288]{0} slice(%concatenate.735), slice={[0:12288]}, metadata={scheduling_name="slice.2541"}
  %slice.2542 = bf16[12288]{0} slice(%concatenate.735), slice={[12288:24576]}, metadata={scheduling_name="slice.2542"}
  ROOT %tuple.682 = (bf16[12288]{0}, bf16[12288]{0}) tuple(%slice.2541, %slice.2542), metadata={scheduling_name="tuple.682"}
}

%wrapped_transpose_computation (param_0.6102: bf16[32768,768]) -> bf16[768,32768] {
  %param_0.6102 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6102"}
  ROOT %transpose.771.1 = bf16[768,32768]{1,0} transpose(%param_0.6102), dimensions={1,0}, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.771.1"}
}

%wrapped_iota_computation () -> s32[1,1,4,8192,2] {
  ROOT %iota.397.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.397.1"}
}

%wrapped_iota_computation.1 () -> s32[1,1,1,1,8] {
  ROOT %iota.402.1 = s32[1,1,1,1,8]{4,3,2,1,0} iota(), iota_dimension=4, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.402.1"}
}

%wrapped_iota_computation.2 () -> s32[1,1,1,1,2049] {
  ROOT %iota.403.1 = s32[1,1,1,1,2049]{4,3,2,1,0} iota(), iota_dimension=4, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.403.1"}
}

%wrapped_concatenate_computation (param_0.6111: f32[1], param_1.6480: f32[1], param_2.4751: f32[1], param_3.3962: f32[1]) -> f32[4] {
  %param_0.6111 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6111"}
  %param_1.6480 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6480"}
  %param_2.4751 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4751"}
  %param_3.3962 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3962"}
  ROOT %concatenate.736 = f32[4]{0} concatenate(%param_0.6111, %param_1.6480, %param_2.4751, %param_3.3962), dimensions={0}, metadata={scheduling_name="concatenate.736"}
}

%wrapped_slice_computation.4 (param_0.6112: f32[4]) -> f32[1] {
  %param_0.6112 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6112"}
  ROOT %slice.2543 = f32[1]{0} slice(%param_0.6112), slice={[0:1]}, metadata={scheduling_name="slice.2543"}
}

%wrapped_concatenate_computation.1 (param_0.6113: f32[1], param_1.6481: f32[1], param_2.4752: f32[1], param_3.3963: f32[1], param_4.2931: f32[1], param_5.2712: f32[1], param_6.2540: f32[1], param_7.2416: f32[1], param_8.2282: f32[1], param_9.2256: f32[1], param_10.1895: f32[1], param_11.1680: f32[1], param_12.1344: f32[1], param_13.1009: f32[1], param_14.782: f32[1], param_15.561: f32[1], param_16.257: f32[1], param_17.112: f32[1], param_18.87: f32[1], param_19.70: f32[1], param_20.48: f32[1], param_21.25: f32[1], param_22.24: f32[1], param_23.10: f32[1], param_24.4: f32[1], param_25: f32[1], param_26: f32[1], param_27: f32[1], param_28: f32[1], param_29: f32[1], param_30: f32[1], param_31: f32[1]) -> f32[32] {
  %param_0.6113 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6113"}
  %param_1.6481 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6481"}
  %param_2.4752 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4752"}
  %param_3.3963 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3963"}
  %param_4.2931 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2931"}
  %param_5.2712 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2712"}
  %param_6.2540 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2540"}
  %param_7.2416 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2416"}
  %param_8.2282 = f32[1]{0} parameter(8), metadata={scheduling_name="param_8.2282"}
  %param_9.2256 = f32[1]{0} parameter(9), metadata={scheduling_name="param_9.2256"}
  %param_10.1895 = f32[1]{0} parameter(10), metadata={scheduling_name="param_10.1895"}
  %param_11.1680 = f32[1]{0} parameter(11), metadata={scheduling_name="param_11.1680"}
  %param_12.1344 = f32[1]{0} parameter(12), metadata={scheduling_name="param_12.1344"}
  %param_13.1009 = f32[1]{0} parameter(13), metadata={scheduling_name="param_13.1009"}
  %param_14.782 = f32[1]{0} parameter(14), metadata={scheduling_name="param_14.782"}
  %param_15.561 = f32[1]{0} parameter(15), metadata={scheduling_name="param_15.561"}
  %param_16.257 = f32[1]{0} parameter(16), metadata={scheduling_name="param_16.257"}
  %param_17.112 = f32[1]{0} parameter(17), metadata={scheduling_name="param_17.112"}
  %param_18.87 = f32[1]{0} parameter(18), metadata={scheduling_name="param_18.87"}
  %param_19.70 = f32[1]{0} parameter(19), metadata={scheduling_name="param_19.70"}
  %param_20.48 = f32[1]{0} parameter(20), metadata={scheduling_name="param_20.48"}
  %param_21.25 = f32[1]{0} parameter(21), metadata={scheduling_name="param_21.25"}
  %param_22.24 = f32[1]{0} parameter(22), metadata={scheduling_name="param_22.24"}
  %param_23.10 = f32[1]{0} parameter(23), metadata={scheduling_name="param_23.10"}
  %param_24.4 = f32[1]{0} parameter(24), metadata={scheduling_name="param_24.4"}
  %param_25 = f32[1]{0} parameter(25), metadata={scheduling_name="param_25"}
  %param_26 = f32[1]{0} parameter(26), metadata={scheduling_name="param_26"}
  %param_27 = f32[1]{0} parameter(27), metadata={scheduling_name="param_27"}
  %param_28 = f32[1]{0} parameter(28), metadata={scheduling_name="param_28"}
  %param_29 = f32[1]{0} parameter(29), metadata={scheduling_name="param_29"}
  %param_30 = f32[1]{0} parameter(30), metadata={scheduling_name="param_30"}
  %param_31 = f32[1]{0} parameter(31), metadata={scheduling_name="param_31"}
  ROOT %concatenate.737 = f32[32]{0} concatenate(%param_0.6113, %param_1.6481, %param_2.4752, %param_3.3963, %param_4.2931, /*index=5*/%param_5.2712, %param_6.2540, %param_7.2416, %param_8.2282, %param_9.2256, /*index=10*/%param_10.1895, %param_11.1680, %param_12.1344, %param_13.1009, %param_14.782, /*index=15*/%param_15.561, %param_16.257, %param_17.112, %param_18.87, %param_19.70, /*index=20*/%param_20.48, %param_21.25, %param_22.24, %param_23.10, %param_24.4, /*index=25*/%param_25, %param_26, %param_27, %param_28, %param_29, /*index=30*/%param_30, %param_31), dimensions={0}, metadata={scheduling_name="concatenate.737"}
}

%wrapped_slice_computation.5 (param_0.6114: f32[32]) -> f32[1] {
  %param_0.6114 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6114"}
  ROOT %slice.2544 = f32[1]{0} slice(%param_0.6114), slice={[0:1]}, metadata={scheduling_name="slice.2544"}
}

%wrapped_slice_computation.6 (param_0.6115: f32[32]) -> f32[1] {
  %param_0.6115 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6115"}
  ROOT %slice.2545 = f32[1]{0} slice(%param_0.6115), slice={[1:2]}, metadata={scheduling_name="slice.2545"}
}

%wrapped_slice_computation.7 (param_0.6116: f32[32]) -> f32[1] {
  %param_0.6116 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6116"}
  ROOT %slice.2546 = f32[1]{0} slice(%param_0.6116), slice={[2:3]}, metadata={scheduling_name="slice.2546"}
}

%wrapped_slice_computation.8 (param_0.6117: f32[32]) -> f32[1] {
  %param_0.6117 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6117"}
  ROOT %slice.2547 = f32[1]{0} slice(%param_0.6117), slice={[3:4]}, metadata={scheduling_name="slice.2547"}
}

%wrapped_concatenate_computation.2 (param_0.6118: bf16[12288], param_1.6482: bf16[12288], param_2.4753: bf16[12288], param_3.3964: bf16[12288]) -> bf16[49152] {
  %param_0.6118 = bf16[12288]{0} parameter(0), metadata={scheduling_name="param_0.6118"}
  %param_1.6482 = bf16[12288]{0} parameter(1), metadata={scheduling_name="param_1.6482"}
  %param_2.4753 = bf16[12288]{0} parameter(2), metadata={scheduling_name="param_2.4753"}
  %param_3.3964 = bf16[12288]{0} parameter(3), metadata={scheduling_name="param_3.3964"}
  ROOT %concatenate.738 = bf16[49152]{0} concatenate(%param_0.6118, %param_1.6482, %param_2.4753, %param_3.3964), dimensions={0}, metadata={scheduling_name="concatenate.738"}
}

%wrapped_slice_computation.9 (param_0.6119: bf16[49152]) -> bf16[12288] {
  %param_0.6119 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6119"}
  ROOT %slice.2548 = bf16[12288]{0} slice(%param_0.6119), slice={[0:12288]}, metadata={scheduling_name="slice.2548"}
}

%wrapped_slice_computation.10 (param_0.6120: bf16[49152]) -> bf16[12288] {
  %param_0.6120 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6120"}
  ROOT %slice.2549 = bf16[12288]{0} slice(%param_0.6120), slice={[12288:24576]}, metadata={scheduling_name="slice.2549"}
}

%wrapped_slice_computation.11 (param_0.6121: bf16[49152]) -> bf16[12288] {
  %param_0.6121 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6121"}
  ROOT %slice.2550 = bf16[12288]{0} slice(%param_0.6121), slice={[24576:36864]}, metadata={scheduling_name="slice.2550"}
}

%wrapped_slice_computation.12 (param_0.6122: bf16[49152]) -> bf16[12288] {
  %param_0.6122 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6122"}
  ROOT %slice.2551 = bf16[12288]{0} slice(%param_0.6122), slice={[36864:49152]}, metadata={scheduling_name="slice.2551"}
}

%wrapped_concatenate_computation.3 (param_0.6123: f32[1], param_1.6483: f32[1], param_2.4754: f32[1], param_3.3965: f32[1], param_4.2932: f32[1], param_5.2713: f32[1], param_6.2541: f32[1], param_7.2417: f32[1]) -> f32[8] {
  %param_0.6123 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6123"}
  %param_1.6483 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6483"}
  %param_2.4754 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4754"}
  %param_3.3965 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3965"}
  %param_4.2932 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2932"}
  %param_5.2713 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2713"}
  %param_6.2541 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2541"}
  %param_7.2417 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2417"}
  ROOT %concatenate.739 = f32[8]{0} concatenate(%param_0.6123, %param_1.6483, %param_2.4754, %param_3.3965, %param_4.2932, /*index=5*/%param_5.2713, %param_6.2541, %param_7.2417), dimensions={0}, metadata={scheduling_name="concatenate.739"}
}

%wrapped_slice_computation.13 (param_0.6124: f32[8]) -> f32[1] {
  %param_0.6124 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6124"}
  ROOT %slice.2552 = f32[1]{0} slice(%param_0.6124), slice={[0:1]}, metadata={scheduling_name="slice.2552"}
}

%wrapped_slice_computation.14 (param_0.6125: f32[8]) -> f32[1] {
  %param_0.6125 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6125"}
  ROOT %slice.2553 = f32[1]{0} slice(%param_0.6125), slice={[1:2]}, metadata={scheduling_name="slice.2553"}
}

%wrapped_slice_computation.15 (param_0.6126: f32[32]) -> f32[1] {
  %param_0.6126 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6126"}
  ROOT %slice.2554 = f32[1]{0} slice(%param_0.6126), slice={[4:5]}, metadata={scheduling_name="slice.2554"}
}

%wrapped_slice_computation.16 (param_0.6127: f32[32]) -> f32[1] {
  %param_0.6127 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6127"}
  ROOT %slice.2555 = f32[1]{0} slice(%param_0.6127), slice={[5:6]}, metadata={scheduling_name="slice.2555"}
}

%wrapped_slice_computation.17 (param_0.6128: f32[32]) -> f32[1] {
  %param_0.6128 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6128"}
  ROOT %slice.2556 = f32[1]{0} slice(%param_0.6128), slice={[6:7]}, metadata={scheduling_name="slice.2556"}
}

%wrapped_slice_computation.18 (param_0.6129: f32[32]) -> f32[1] {
  %param_0.6129 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6129"}
  ROOT %slice.2557 = f32[1]{0} slice(%param_0.6129), slice={[7:8]}, metadata={scheduling_name="slice.2557"}
}

%wrapped_slice_computation.19 (param_0.6130: f32[32]) -> f32[1] {
  %param_0.6130 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6130"}
  ROOT %slice.2558 = f32[1]{0} slice(%param_0.6130), slice={[8:9]}, metadata={scheduling_name="slice.2558"}
}

%wrapped_slice_computation.20 (param_0.6131: f32[32]) -> f32[1] {
  %param_0.6131 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6131"}
  ROOT %slice.2559 = f32[1]{0} slice(%param_0.6131), slice={[9:10]}, metadata={scheduling_name="slice.2559"}
}

%wrapped_slice_computation.21 (param_0.6132: f32[32]) -> f32[1] {
  %param_0.6132 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6132"}
  ROOT %slice.2560 = f32[1]{0} slice(%param_0.6132), slice={[10:11]}, metadata={scheduling_name="slice.2560"}
}

%wrapped_slice_computation.22 (param_0.6133: f32[32]) -> f32[1] {
  %param_0.6133 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6133"}
  ROOT %slice.2561 = f32[1]{0} slice(%param_0.6133), slice={[11:12]}, metadata={scheduling_name="slice.2561"}
}

%wrapped_slice_computation.23 (param_0.6134: f32[8]) -> f32[1] {
  %param_0.6134 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6134"}
  ROOT %slice.2562 = f32[1]{0} slice(%param_0.6134), slice={[2:3]}, metadata={scheduling_name="slice.2562"}
}

%wrapped_slice_computation.24 (param_0.6135: f32[8]) -> f32[1] {
  %param_0.6135 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6135"}
  ROOT %slice.2563 = f32[1]{0} slice(%param_0.6135), slice={[3:4]}, metadata={scheduling_name="slice.2563"}
}

%wrapped_slice_computation.25 (param_0.6136: f32[32]) -> f32[1] {
  %param_0.6136 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6136"}
  ROOT %slice.2564 = f32[1]{0} slice(%param_0.6136), slice={[12:13]}, metadata={scheduling_name="slice.2564"}
}

%wrapped_slice_computation.26 (param_0.6137: f32[32]) -> f32[1] {
  %param_0.6137 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6137"}
  ROOT %slice.2565 = f32[1]{0} slice(%param_0.6137), slice={[13:14]}, metadata={scheduling_name="slice.2565"}
}

%wrapped_slice_computation.27 (param_0.6138: f32[32]) -> f32[1] {
  %param_0.6138 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6138"}
  ROOT %slice.2566 = f32[1]{0} slice(%param_0.6138), slice={[14:15]}, metadata={scheduling_name="slice.2566"}
}

%wrapped_slice_computation.28 (param_0.6139: f32[32]) -> f32[1] {
  %param_0.6139 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6139"}
  ROOT %slice.2567 = f32[1]{0} slice(%param_0.6139), slice={[15:16]}, metadata={scheduling_name="slice.2567"}
}

%wrapped_slice_computation.29 (param_0.6140: f32[4]) -> f32[1] {
  %param_0.6140 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6140"}
  ROOT %slice.2568 = f32[1]{0} slice(%param_0.6140), slice={[1:2]}, metadata={scheduling_name="slice.2568"}
}

%wrapped_transpose_computation.1 (param_0.6141: bf16[32768,768]) -> bf16[768,32768] {
  %param_0.6141 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6141"}
  ROOT %transpose.776.1 = bf16[768,32768]{1,0} transpose(%param_0.6141), dimensions={1,0}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.776.1"}
}

%wrapped_slice_computation.30 (param_0.6142: f32[4]) -> f32[1] {
  %param_0.6142 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6142"}
  ROOT %slice.2569 = f32[1]{0} slice(%param_0.6142), slice={[2:3]}, metadata={scheduling_name="slice.2569"}
}

%wrapped_slice_computation.31 (param_0.6143: f32[32]) -> f32[1] {
  %param_0.6143 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6143"}
  ROOT %slice.2570 = f32[1]{0} slice(%param_0.6143), slice={[16:17]}, metadata={scheduling_name="slice.2570"}
}

%wrapped_slice_computation.32 (param_0.6144: f32[32]) -> f32[1] {
  %param_0.6144 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6144"}
  ROOT %slice.2571 = f32[1]{0} slice(%param_0.6144), slice={[17:18]}, metadata={scheduling_name="slice.2571"}
}

%wrapped_slice_computation.33 (param_0.6145: f32[32]) -> f32[1] {
  %param_0.6145 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6145"}
  ROOT %slice.2572 = f32[1]{0} slice(%param_0.6145), slice={[18:19]}, metadata={scheduling_name="slice.2572"}
}

%wrapped_slice_computation.34 (param_0.6146: f32[32]) -> f32[1] {
  %param_0.6146 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6146"}
  ROOT %slice.2573 = f32[1]{0} slice(%param_0.6146), slice={[19:20]}, metadata={scheduling_name="slice.2573"}
}

%wrapped_slice_computation.35 (param_0.6147: f32[8]) -> f32[1] {
  %param_0.6147 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6147"}
  ROOT %slice.2574 = f32[1]{0} slice(%param_0.6147), slice={[4:5]}, metadata={scheduling_name="slice.2574"}
}

%wrapped_slice_computation.36 (param_0.6148: f32[8]) -> f32[1] {
  %param_0.6148 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6148"}
  ROOT %slice.2575 = f32[1]{0} slice(%param_0.6148), slice={[5:6]}, metadata={scheduling_name="slice.2575"}
}

%wrapped_slice_computation.37 (param_0.6149: f32[32]) -> f32[1] {
  %param_0.6149 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6149"}
  ROOT %slice.2576 = f32[1]{0} slice(%param_0.6149), slice={[20:21]}, metadata={scheduling_name="slice.2576"}
}

%wrapped_slice_computation.38 (param_0.6150: f32[32]) -> f32[1] {
  %param_0.6150 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6150"}
  ROOT %slice.2577 = f32[1]{0} slice(%param_0.6150), slice={[21:22]}, metadata={scheduling_name="slice.2577"}
}

%wrapped_slice_computation.39 (param_0.6151: f32[32]) -> f32[1] {
  %param_0.6151 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6151"}
  ROOT %slice.2578 = f32[1]{0} slice(%param_0.6151), slice={[22:23]}, metadata={scheduling_name="slice.2578"}
}

%wrapped_slice_computation.40 (param_0.6152: f32[32]) -> f32[1] {
  %param_0.6152 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6152"}
  ROOT %slice.2579 = f32[1]{0} slice(%param_0.6152), slice={[23:24]}, metadata={scheduling_name="slice.2579"}
}

%wrapped_slice_computation.41 (param_0.6153: f32[32]) -> f32[1] {
  %param_0.6153 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6153"}
  ROOT %slice.2580 = f32[1]{0} slice(%param_0.6153), slice={[24:25]}, metadata={scheduling_name="slice.2580"}
}

%wrapped_slice_computation.42 (param_0.6154: f32[32]) -> f32[1] {
  %param_0.6154 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6154"}
  ROOT %slice.2581 = f32[1]{0} slice(%param_0.6154), slice={[25:26]}, metadata={scheduling_name="slice.2581"}
}

%wrapped_slice_computation.43 (param_0.6155: f32[32]) -> f32[1] {
  %param_0.6155 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6155"}
  ROOT %slice.2582 = f32[1]{0} slice(%param_0.6155), slice={[26:27]}, metadata={scheduling_name="slice.2582"}
}

%wrapped_slice_computation.44 (param_0.6156: f32[32]) -> f32[1] {
  %param_0.6156 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6156"}
  ROOT %slice.2583 = f32[1]{0} slice(%param_0.6156), slice={[27:28]}, metadata={scheduling_name="slice.2583"}
}

%wrapped_slice_computation.45 (param_0.6157: f32[8]) -> f32[1] {
  %param_0.6157 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6157"}
  ROOT %slice.2584 = f32[1]{0} slice(%param_0.6157), slice={[6:7]}, metadata={scheduling_name="slice.2584"}
}

%wrapped_slice_computation.46 (param_0.6158: f32[8]) -> f32[1] {
  %param_0.6158 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6158"}
  ROOT %slice.2585 = f32[1]{0} slice(%param_0.6158), slice={[7:8]}, metadata={scheduling_name="slice.2585"}
}

%wrapped_slice_computation.47 (param_0.6159: f32[32]) -> f32[1] {
  %param_0.6159 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6159"}
  ROOT %slice.2586 = f32[1]{0} slice(%param_0.6159), slice={[28:29]}, metadata={scheduling_name="slice.2586"}
}

%wrapped_slice_computation.48 (param_0.6160: f32[32]) -> f32[1] {
  %param_0.6160 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6160"}
  ROOT %slice.2587 = f32[1]{0} slice(%param_0.6160), slice={[29:30]}, metadata={scheduling_name="slice.2587"}
}

%wrapped_slice_computation.49 (param_0.6161: f32[32]) -> f32[1] {
  %param_0.6161 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6161"}
  ROOT %slice.2588 = f32[1]{0} slice(%param_0.6161), slice={[30:31]}, metadata={scheduling_name="slice.2588"}
}

%wrapped_slice_computation.50 (param_0.6162: f32[32]) -> f32[1] {
  %param_0.6162 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6162"}
  ROOT %slice.2589 = f32[1]{0} slice(%param_0.6162), slice={[31:32]}, metadata={scheduling_name="slice.2589"}
}

%wrapped_slice_computation.51 (param_0.6163: f32[4]) -> f32[1] {
  %param_0.6163 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6163"}
  ROOT %slice.2590 = f32[1]{0} slice(%param_0.6163), slice={[3:4]}, metadata={scheduling_name="slice.2590"}
}

%wrapped_concatenate_computation.4 (param_0.6164: f32[1], param_1.6484: f32[1], param_2.4755: f32[1], param_3.3966: f32[1]) -> f32[4] {
  %param_0.6164 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6164"}
  %param_1.6484 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6484"}
  %param_2.4755 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4755"}
  %param_3.3966 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3966"}
  ROOT %concatenate.740 = f32[4]{0} concatenate(%param_0.6164, %param_1.6484, %param_2.4755, %param_3.3966), dimensions={0}, metadata={scheduling_name="concatenate.740"}
}

%wrapped_slice_computation.52 (param_0.6165: f32[4]) -> f32[1] {
  %param_0.6165 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6165"}
  ROOT %slice.2591 = f32[1]{0} slice(%param_0.6165), slice={[0:1]}, metadata={scheduling_name="slice.2591"}
}

%wrapped_concatenate_computation.5 (param_0.6166: f32[1], param_1.6485: f32[1], param_2.4756: f32[1], param_3.3967: f32[1], param_4.2933: f32[1], param_5.2714: f32[1], param_6.2542: f32[1], param_7.2418: f32[1], param_8.2283: f32[1], param_9.2257: f32[1], param_10.1896: f32[1], param_11.1681: f32[1], param_12.1345: f32[1], param_13.1010: f32[1], param_14.783: f32[1], param_15.562: f32[1], param_16.258: f32[1], param_17.113: f32[1], param_18.88: f32[1], param_19.71: f32[1], param_20.49: f32[1], param_21.26: f32[1], param_22.25: f32[1], param_23.11: f32[1], param_24.5: f32[1], param_25.1: f32[1], param_26.1: f32[1], param_27.1: f32[1], param_28.1: f32[1], param_29.1: f32[1], param_30.1: f32[1], param_31.1: f32[1], param_32: f32[1]) -> f32[33] {
  %param_0.6166 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6166"}
  %param_1.6485 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6485"}
  %param_2.4756 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4756"}
  %param_3.3967 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3967"}
  %param_4.2933 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2933"}
  %param_5.2714 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2714"}
  %param_6.2542 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2542"}
  %param_7.2418 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2418"}
  %param_8.2283 = f32[1]{0} parameter(8), metadata={scheduling_name="param_8.2283"}
  %param_9.2257 = f32[1]{0} parameter(9), metadata={scheduling_name="param_9.2257"}
  %param_10.1896 = f32[1]{0} parameter(10), metadata={scheduling_name="param_10.1896"}
  %param_11.1681 = f32[1]{0} parameter(11), metadata={scheduling_name="param_11.1681"}
  %param_12.1345 = f32[1]{0} parameter(12), metadata={scheduling_name="param_12.1345"}
  %param_13.1010 = f32[1]{0} parameter(13), metadata={scheduling_name="param_13.1010"}
  %param_14.783 = f32[1]{0} parameter(14), metadata={scheduling_name="param_14.783"}
  %param_15.562 = f32[1]{0} parameter(15), metadata={scheduling_name="param_15.562"}
  %param_16.258 = f32[1]{0} parameter(16), metadata={scheduling_name="param_16.258"}
  %param_17.113 = f32[1]{0} parameter(17), metadata={scheduling_name="param_17.113"}
  %param_18.88 = f32[1]{0} parameter(18), metadata={scheduling_name="param_18.88"}
  %param_19.71 = f32[1]{0} parameter(19), metadata={scheduling_name="param_19.71"}
  %param_20.49 = f32[1]{0} parameter(20), metadata={scheduling_name="param_20.49"}
  %param_21.26 = f32[1]{0} parameter(21), metadata={scheduling_name="param_21.26"}
  %param_22.25 = f32[1]{0} parameter(22), metadata={scheduling_name="param_22.25"}
  %param_23.11 = f32[1]{0} parameter(23), metadata={scheduling_name="param_23.11"}
  %param_24.5 = f32[1]{0} parameter(24), metadata={scheduling_name="param_24.5"}
  %param_25.1 = f32[1]{0} parameter(25), metadata={scheduling_name="param_25.1"}
  %param_26.1 = f32[1]{0} parameter(26), metadata={scheduling_name="param_26.1"}
  %param_27.1 = f32[1]{0} parameter(27), metadata={scheduling_name="param_27.1"}
  %param_28.1 = f32[1]{0} parameter(28), metadata={scheduling_name="param_28.1"}
  %param_29.1 = f32[1]{0} parameter(29), metadata={scheduling_name="param_29.1"}
  %param_30.1 = f32[1]{0} parameter(30), metadata={scheduling_name="param_30.1"}
  %param_31.1 = f32[1]{0} parameter(31), metadata={scheduling_name="param_31.1"}
  %param_32 = f32[1]{0} parameter(32), metadata={scheduling_name="param_32"}
  ROOT %concatenate.741 = f32[33]{0} concatenate(%param_0.6166, %param_1.6485, %param_2.4756, %param_3.3967, %param_4.2933, /*index=5*/%param_5.2714, %param_6.2542, %param_7.2418, %param_8.2283, %param_9.2257, /*index=10*/%param_10.1896, %param_11.1681, %param_12.1345, %param_13.1010, %param_14.783, /*index=15*/%param_15.562, %param_16.258, %param_17.113, %param_18.88, %param_19.71, /*index=20*/%param_20.49, %param_21.26, %param_22.25, %param_23.11, %param_24.5, /*index=25*/%param_25.1, %param_26.1, %param_27.1, %param_28.1, %param_29.1, /*index=30*/%param_30.1, %param_31.1, %param_32), dimensions={0}, metadata={scheduling_name="concatenate.741"}
}

%wrapped_slice_computation.53 (param_0.6167: f32[33]) -> f32[1] {
  %param_0.6167 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6167"}
  ROOT %slice.2592 = f32[1]{0} slice(%param_0.6167), slice={[0:1]}, metadata={scheduling_name="slice.2592"}
}

%wrapped_slice_computation.54 (param_0.6168: f32[33]) -> f32[1] {
  %param_0.6168 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6168"}
  ROOT %slice.2593 = f32[1]{0} slice(%param_0.6168), slice={[1:2]}, metadata={scheduling_name="slice.2593"}
}

%wrapped_slice_computation.55 (param_0.6169: f32[33]) -> f32[1] {
  %param_0.6169 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6169"}
  ROOT %slice.2594 = f32[1]{0} slice(%param_0.6169), slice={[2:3]}, metadata={scheduling_name="slice.2594"}
}

%wrapped_slice_computation.56 (param_0.6170: f32[33]) -> f32[1] {
  %param_0.6170 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6170"}
  ROOT %slice.2595 = f32[1]{0} slice(%param_0.6170), slice={[3:4]}, metadata={scheduling_name="slice.2595"}
}

%wrapped_concatenate_computation.6 (param_0.6171: f32[1], param_1.6486: f32[1], param_2.4757: f32[1], param_3.3968: f32[1], param_4.2934: f32[1], param_5.2715: f32[1], param_6.2543: f32[1], param_7.2419: f32[1]) -> f32[8] {
  %param_0.6171 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6171"}
  %param_1.6486 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6486"}
  %param_2.4757 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4757"}
  %param_3.3968 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3968"}
  %param_4.2934 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2934"}
  %param_5.2715 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2715"}
  %param_6.2543 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2543"}
  %param_7.2419 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2419"}
  ROOT %concatenate.742 = f32[8]{0} concatenate(%param_0.6171, %param_1.6486, %param_2.4757, %param_3.3968, %param_4.2934, /*index=5*/%param_5.2715, %param_6.2543, %param_7.2419), dimensions={0}, metadata={scheduling_name="concatenate.742"}
}

%wrapped_slice_computation.57 (param_0.6172: f32[8]) -> f32[1] {
  %param_0.6172 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6172"}
  ROOT %slice.2596 = f32[1]{0} slice(%param_0.6172), slice={[0:1]}, metadata={scheduling_name="slice.2596"}
}

%wrapped_slice_computation.58 (param_0.6173: f32[8]) -> f32[1] {
  %param_0.6173 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6173"}
  ROOT %slice.2597 = f32[1]{0} slice(%param_0.6173), slice={[1:2]}, metadata={scheduling_name="slice.2597"}
}

%wrapped_slice_computation.59 (param_0.6174: f32[33]) -> f32[1] {
  %param_0.6174 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6174"}
  ROOT %slice.2598 = f32[1]{0} slice(%param_0.6174), slice={[4:5]}, metadata={scheduling_name="slice.2598"}
}

%wrapped_slice_computation.60 (param_0.6175: f32[33]) -> f32[1] {
  %param_0.6175 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6175"}
  ROOT %slice.2599 = f32[1]{0} slice(%param_0.6175), slice={[5:6]}, metadata={scheduling_name="slice.2599"}
}

%wrapped_slice_computation.61 (param_0.6176: f32[33]) -> f32[1] {
  %param_0.6176 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6176"}
  ROOT %slice.2600 = f32[1]{0} slice(%param_0.6176), slice={[6:7]}, metadata={scheduling_name="slice.2600"}
}

%wrapped_slice_computation.62 (param_0.6177: f32[33]) -> f32[1] {
  %param_0.6177 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6177"}
  ROOT %slice.2601 = f32[1]{0} slice(%param_0.6177), slice={[7:8]}, metadata={scheduling_name="slice.2601"}
}

%wrapped_slice_computation.63 (param_0.6178: f32[33]) -> f32[1] {
  %param_0.6178 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6178"}
  ROOT %slice.2602 = f32[1]{0} slice(%param_0.6178), slice={[8:9]}, metadata={scheduling_name="slice.2602"}
}

%wrapped_slice_computation.64 (param_0.6179: f32[33]) -> f32[1] {
  %param_0.6179 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6179"}
  ROOT %slice.2603 = f32[1]{0} slice(%param_0.6179), slice={[9:10]}, metadata={scheduling_name="slice.2603"}
}

%wrapped_slice_computation.65 (param_0.6180: f32[33]) -> f32[1] {
  %param_0.6180 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6180"}
  ROOT %slice.2604 = f32[1]{0} slice(%param_0.6180), slice={[10:11]}, metadata={scheduling_name="slice.2604"}
}

%wrapped_slice_computation.66 (param_0.6181: f32[33]) -> f32[1] {
  %param_0.6181 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6181"}
  ROOT %slice.2605 = f32[1]{0} slice(%param_0.6181), slice={[11:12]}, metadata={scheduling_name="slice.2605"}
}

%wrapped_slice_computation.67 (param_0.6182: f32[8]) -> f32[1] {
  %param_0.6182 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6182"}
  ROOT %slice.2606 = f32[1]{0} slice(%param_0.6182), slice={[2:3]}, metadata={scheduling_name="slice.2606"}
}

%wrapped_slice_computation.68 (param_0.6183: f32[8]) -> f32[1] {
  %param_0.6183 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6183"}
  ROOT %slice.2607 = f32[1]{0} slice(%param_0.6183), slice={[3:4]}, metadata={scheduling_name="slice.2607"}
}

%wrapped_slice_computation.69 (param_0.6184: f32[33]) -> f32[1] {
  %param_0.6184 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6184"}
  ROOT %slice.2608 = f32[1]{0} slice(%param_0.6184), slice={[12:13]}, metadata={scheduling_name="slice.2608"}
}

%wrapped_slice_computation.70 (param_0.6185: f32[33]) -> f32[1] {
  %param_0.6185 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6185"}
  ROOT %slice.2609 = f32[1]{0} slice(%param_0.6185), slice={[13:14]}, metadata={scheduling_name="slice.2609"}
}

%wrapped_slice_computation.71 (param_0.6186: f32[33]) -> f32[1] {
  %param_0.6186 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6186"}
  ROOT %slice.2610 = f32[1]{0} slice(%param_0.6186), slice={[14:15]}, metadata={scheduling_name="slice.2610"}
}

%wrapped_slice_computation.72 (param_0.6187: f32[33]) -> f32[1] {
  %param_0.6187 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6187"}
  ROOT %slice.2611 = f32[1]{0} slice(%param_0.6187), slice={[15:16]}, metadata={scheduling_name="slice.2611"}
}

%wrapped_slice_computation.73 (param_0.6188: f32[4]) -> f32[1] {
  %param_0.6188 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6188"}
  ROOT %slice.2612 = f32[1]{0} slice(%param_0.6188), slice={[1:2]}, metadata={scheduling_name="slice.2612"}
}

%wrapped_slice_computation.74 (param_0.6189: f32[4]) -> f32[1] {
  %param_0.6189 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6189"}
  ROOT %slice.2613 = f32[1]{0} slice(%param_0.6189), slice={[2:3]}, metadata={scheduling_name="slice.2613"}
}

%wrapped_slice_computation.75 (param_0.6190: f32[33]) -> f32[1] {
  %param_0.6190 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6190"}
  ROOT %slice.2614 = f32[1]{0} slice(%param_0.6190), slice={[16:17]}, metadata={scheduling_name="slice.2614"}
}

%wrapped_slice_computation.76 (param_0.6191: f32[33]) -> f32[1] {
  %param_0.6191 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6191"}
  ROOT %slice.2615 = f32[1]{0} slice(%param_0.6191), slice={[17:18]}, metadata={scheduling_name="slice.2615"}
}

%wrapped_slice_computation.77 (param_0.6192: f32[33]) -> f32[1] {
  %param_0.6192 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6192"}
  ROOT %slice.2616 = f32[1]{0} slice(%param_0.6192), slice={[18:19]}, metadata={scheduling_name="slice.2616"}
}

%wrapped_slice_computation.78 (param_0.6193: f32[33]) -> f32[1] {
  %param_0.6193 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6193"}
  ROOT %slice.2617 = f32[1]{0} slice(%param_0.6193), slice={[19:20]}, metadata={scheduling_name="slice.2617"}
}

%wrapped_slice_computation.79 (param_0.6194: f32[8]) -> f32[1] {
  %param_0.6194 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6194"}
  ROOT %slice.2618 = f32[1]{0} slice(%param_0.6194), slice={[4:5]}, metadata={scheduling_name="slice.2618"}
}

%wrapped_slice_computation.80 (param_0.6195: f32[8]) -> f32[1] {
  %param_0.6195 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6195"}
  ROOT %slice.2619 = f32[1]{0} slice(%param_0.6195), slice={[5:6]}, metadata={scheduling_name="slice.2619"}
}

%wrapped_slice_computation.81 (param_0.6196: f32[33]) -> f32[1] {
  %param_0.6196 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6196"}
  ROOT %slice.2620 = f32[1]{0} slice(%param_0.6196), slice={[20:21]}, metadata={scheduling_name="slice.2620"}
}

%wrapped_slice_computation.82 (param_0.6197: f32[33]) -> f32[1] {
  %param_0.6197 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6197"}
  ROOT %slice.2621 = f32[1]{0} slice(%param_0.6197), slice={[21:22]}, metadata={scheduling_name="slice.2621"}
}

%wrapped_slice_computation.83 (param_0.6198: f32[33]) -> f32[1] {
  %param_0.6198 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6198"}
  ROOT %slice.2622 = f32[1]{0} slice(%param_0.6198), slice={[22:23]}, metadata={scheduling_name="slice.2622"}
}

%wrapped_slice_computation.84 (param_0.6199: f32[33]) -> f32[1] {
  %param_0.6199 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6199"}
  ROOT %slice.2623 = f32[1]{0} slice(%param_0.6199), slice={[23:24]}, metadata={scheduling_name="slice.2623"}
}

%wrapped_slice_computation.85 (param_0.6200: f32[33]) -> f32[1] {
  %param_0.6200 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6200"}
  ROOT %slice.2624 = f32[1]{0} slice(%param_0.6200), slice={[24:25]}, metadata={scheduling_name="slice.2624"}
}

%wrapped_slice_computation.86 (param_0.6201: f32[33]) -> f32[1] {
  %param_0.6201 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6201"}
  ROOT %slice.2625 = f32[1]{0} slice(%param_0.6201), slice={[25:26]}, metadata={scheduling_name="slice.2625"}
}

%wrapped_slice_computation.87 (param_0.6202: f32[33]) -> f32[1] {
  %param_0.6202 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6202"}
  ROOT %slice.2626 = f32[1]{0} slice(%param_0.6202), slice={[26:27]}, metadata={scheduling_name="slice.2626"}
}

%wrapped_slice_computation.88 (param_0.6203: f32[33]) -> f32[1] {
  %param_0.6203 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6203"}
  ROOT %slice.2627 = f32[1]{0} slice(%param_0.6203), slice={[27:28]}, metadata={scheduling_name="slice.2627"}
}

%wrapped_slice_computation.89 (param_0.6204: f32[8]) -> f32[1] {
  %param_0.6204 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6204"}
  ROOT %slice.2628 = f32[1]{0} slice(%param_0.6204), slice={[6:7]}, metadata={scheduling_name="slice.2628"}
}

%wrapped_slice_computation.90 (param_0.6205: f32[8]) -> f32[1] {
  %param_0.6205 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6205"}
  ROOT %slice.2629 = f32[1]{0} slice(%param_0.6205), slice={[7:8]}, metadata={scheduling_name="slice.2629"}
}

%wrapped_slice_computation.91 (param_0.6206: f32[33]) -> f32[1] {
  %param_0.6206 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6206"}
  ROOT %slice.2630 = f32[1]{0} slice(%param_0.6206), slice={[28:29]}, metadata={scheduling_name="slice.2630"}
}

%wrapped_slice_computation.92 (param_0.6207: f32[33]) -> f32[1] {
  %param_0.6207 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6207"}
  ROOT %slice.2631 = f32[1]{0} slice(%param_0.6207), slice={[29:30]}, metadata={scheduling_name="slice.2631"}
}

%wrapped_slice_computation.93 (param_0.6208: f32[33]) -> f32[1] {
  %param_0.6208 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6208"}
  ROOT %slice.2632 = f32[1]{0} slice(%param_0.6208), slice={[30:31]}, metadata={scheduling_name="slice.2632"}
}

%wrapped_slice_computation.94 (param_0.6209: f32[33]) -> f32[1] {
  %param_0.6209 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6209"}
  ROOT %slice.2633 = f32[1]{0} slice(%param_0.6209), slice={[31:32]}, metadata={scheduling_name="slice.2633"}
}

%wrapped_slice_computation.95 (param_0.6210: f32[4]) -> f32[1] {
  %param_0.6210 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6210"}
  ROOT %slice.2634 = f32[1]{0} slice(%param_0.6210), slice={[3:4]}, metadata={scheduling_name="slice.2634"}
}

%wrapped_slice_computation.96 (param_0.6211: f32[33]) -> f32[1] {
  %param_0.6211 = f32[33]{0} parameter(0), metadata={scheduling_name="param_0.6211"}
  ROOT %slice.2635 = f32[1]{0} slice(%param_0.6211), slice={[32:33]}, metadata={scheduling_name="slice.2635"}
}

ENTRY %main.5687_spmd (param.4: s32[], param.5: bf16[6144], param.31: bf16[768,32768], param.16: bf16[2,1,768,8], param.17: bf16[2,1,1,6144,16384], param.18: bf16[2,1,1,6144,16384], param.19: bf16[2,1,1,16384,6144], param.15: bf16[2,1,6144], param.9: bf16[2,1,6144], param.12: bf16[2,1,768,8,128], param.14: bf16[2,1,48,128,768], param.10: bf16[2,1,768,48,128], param.13: bf16[2,1,768,8,128], param.26: bf16[2,1,768,8], param.27: bf16[2,1,1,6144,16384], param.28: bf16[2,1,1,6144,16384], param.29: bf16[2,1,1,16384,6144], param.25: bf16[2,1,6144], param.20: bf16[2,1,6144], param.22: bf16[2,1,768,8,128], param.24: bf16[2,1,48,128,768], param.21: bf16[2,1,768,48,128], param.23: bf16[2,1,768,8,128], param.8: bf16[32768,768], param.34: s32[], param.33: bf16[6144], param.36: bf16[768,32768], param.38: bf16[2,1,768,8], param.40: bf16[2,1,1,6144,16384], param.42: bf16[2,1,1,6144,16384], param.44: bf16[2,1,1,16384,6144], param.46: bf16[2,1,6144], param.48: bf16[2,1,6144], param.50: bf16[2,1,768,8,128], param.52: bf16[2,1,48,128,768], param.54: bf16[2,1,768,48,128], param.56: bf16[2,1,768,8,128], param.58: bf16[2,1,768,8], param.60: bf16[2,1,1,6144,16384], param.62: bf16[2,1,1,6144,16384], param.64: bf16[2,1,1,16384,6144], param.66: bf16[2,1,6144], param.68: bf16[2,1,6144], param.70: bf16[2,1,768,8,128], param.72: bf16[2,1,48,128,768], param.74: bf16[2,1,768,48,128], param.76: bf16[2,1,768,8,128], param.78: bf16[32768,768], param.35: bf16[6144], param.37: bf16[768,32768], param.39: bf16[2,1,768,8], param.41: bf16[2,1,1,6144,16384], param.43: bf16[2,1,1,6144,16384], param.45: bf16[2,1,1,16384,6144], param.47: bf16[2,1,6144], param.49: bf16[2,1,6144], param.51: bf16[2,1,768,8,128], param.53: bf16[2,1,48,128,768], param.55: bf16[2,1,768,48,128], param.57: bf16[2,1,768,8,128], param.59: bf16[2,1,768,8], param.61: bf16[2,1,1,6144,16384], param.63: bf16[2,1,1,6144,16384], param.65: bf16[2,1,1,16384,6144], param.67: bf16[2,1,6144], param.69: bf16[2,1,6144], param.71: bf16[2,1,768,8,128], param.73: bf16[2,1,48,128,768], param.75: bf16[2,1,768,48,128], param.77: bf16[2,1,768,8,128], param.79: bf16[32768,768], param.6: s32[], param.7: s32[8,8192], param.11: s32[8,8192], param.32: s32[8,8192], param.30: s32[8,8192]) -> (s32[], bf16[6144], bf16[768,32768], bf16[2,1,768,8], bf16[2,1,1,6144,16384], /*index=5*/bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], /*index=10*/bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], /*index=15*/bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], /*index=20*/bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[32768,768], s32[], /*index=25*/bf16[6144], bf16[768,32768], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], /*index=30*/bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], /*index=35*/bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], /*index=40*/bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], /*index=45*/bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[32768,768], bf16[6144], bf16[768,32768], /*index=50*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=55*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=60*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=65*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=70*/bf16[32768,768], s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[]) {
  %param.8 = bf16[32768,768]{1,0} parameter(23), sharding={devices=[1,8,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.8"}
  %param.31 = bf16[768,32768]{1,0} parameter(2), sharding={devices=[8,1,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.31"}
  %param.7 = s32[8,8192]{1,0} parameter(72), sharding={devices=[16,1]<=[16]}, metadata={op_name="data[\'inputs\']" scheduling_name="param.7"}
  %constant_2898_0 = s32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193}
  %constant_2840_0 = s32[] constant(0)
  %constant_2887_0 = s32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param.14 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(10), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.14"}
  %param.11 = s32[8,8192]{1,0} parameter(73), sharding={devices=[16,1]<=[16]}, metadata={op_name="data[\'inputs_position\']" scheduling_name="param.11"}
  %param.24 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(20), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.24"}
  %constant_2903_0 = u32[16]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %param.9 = bf16[2,1,6144]{2,1,0} parameter(8), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.9"}
  %param.10 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(11), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.10"}
  %param.12 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(9), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.12"}
  %param.13 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(12), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.13"}
  %param.15 = bf16[2,1,6144]{2,1,0} parameter(7), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.15"}
  %param.16 = bf16[2,1,768,8]{3,2,1,0} parameter(3), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.16"}
  %param.17 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.17"}
  %param.18 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.18"}
  %param.19 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(6), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.19"}
  %param.20 = bf16[2,1,6144]{2,1,0} parameter(18), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.20"}
  %param.21 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(21), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.21"}
  %param.22 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(19), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.22"}
  %param.23 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(22), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.23"}
  %param.25 = bf16[2,1,6144]{2,1,0} parameter(17), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.25"}
  %param.26 = bf16[2,1,768,8]{3,2,1,0} parameter(13), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.26"}
  %param.27 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(14), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.27"}
  %param.28 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(15), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.28"}
  %param.29 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(16), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.29"}
  %constant_2945_0 = s32[2,1]{1,0} constant({ {1}, {0} })
  %param.30 = s32[8,8192]{1,0} parameter(75), sharding={devices=[16,1]<=[16]}, metadata={op_name="data[\'targets_segmentation\']" scheduling_name="param.30"}
  %param.5 = bf16[6144]{0} parameter(1), sharding={replicated}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.5"}
  %param.32 = s32[8,8192]{1,0} parameter(74), sharding={devices=[16,1]<=[16]}, metadata={op_name="data[\'targets\']" scheduling_name="param.32"}
  %param.6 = s32[] parameter(71), sharding={replicated}, metadata={op_name="state.opt_state[2].count" scheduling_name="param.6"}
  %param.4 = s32[] parameter(0), sharding={replicated}, metadata={op_name="state.step" scheduling_name="param.4"}
  %param.34 = s32[] parameter(24), sharding={replicated}, metadata={op_name="state.opt_state[0].count" scheduling_name="param.34"}
  %param.78 = bf16[32768,768]{1,0} parameter(47), sharding={devices=[1,8,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.78"}
  %param.79 = bf16[32768,768]{1,0} parameter(70), sharding={devices=[1,8,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.79"}
  %param.35 = bf16[6144]{0} parameter(48), sharding={replicated}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.35"}
  %param.33 = bf16[6144]{0} parameter(25), sharding={replicated}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.33"}
  %param.39 = bf16[2,1,768,8]{3,2,1,0} parameter(50), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.39"}
  %param.38 = bf16[2,1,768,8]{3,2,1,0} parameter(27), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.38"}
  %param.67 = bf16[2,1,6144]{2,1,0} parameter(64), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.67"}
  %param.66 = bf16[2,1,6144]{2,1,0} parameter(41), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.66"}
  %param.69 = bf16[2,1,6144]{2,1,0} parameter(65), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.69"}
  %param.68 = bf16[2,1,6144]{2,1,0} parameter(42), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.68"}
  %param.47 = bf16[2,1,6144]{2,1,0} parameter(54), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.47"}
  %param.46 = bf16[2,1,6144]{2,1,0} parameter(31), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.46"}
  %param.49 = bf16[2,1,6144]{2,1,0} parameter(55), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.49"}
  %param.48 = bf16[2,1,6144]{2,1,0} parameter(32), sharding={devices=[1,2,1,8]<=[16] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.48"}
  %param.59 = bf16[2,1,768,8]{3,2,1,0} parameter(60), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.59"}
  %param.58 = bf16[2,1,768,8]{3,2,1,0} parameter(37), sharding={devices=[1,2,8,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.58"}
  %param.71 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(66), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.71"}
  %param.70 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(43), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.70"}
  %param.57 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(59), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.57"}
  %param.56 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(36), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.56"}
  %param.77 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(69), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.77"}
  %param.76 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(46), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.76"}
  %param.51 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(56), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.51"}
  %param.50 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(33), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.50"}
  %param.53 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(57), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.53"}
  %param.52 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(34), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.52"}
  %param.73 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(67), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.73"}
  %param.72 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(44), sharding={devices=[1,2,1,1,8]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.72"}
  %param.55 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(58), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.55"}
  %param.54 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(35), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.54"}
  %param.75 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(68), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.75"}
  %param.74 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(45), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.74"}
  %param.37 = bf16[768,32768]{1,0} parameter(49), sharding={devices=[8,1,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.37"}
  %param.36 = bf16[768,32768]{1,0} parameter(26), sharding={devices=[8,1,2]<=[2,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.36"}
  %param.41 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(51), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.41"}
  %param.40 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(28), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.40"}
  %param.43 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(52), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.43"}
  %param.42 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(29), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.42"}
  %param.61 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(61), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.61"}
  %param.60 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(38), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.60"}
  %param.45 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(53), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.45"}
  %param.44 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(30), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.44"}
  %param.65 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(63), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.65"}
  %param.64 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(40), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.64"}
  %param.63 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(62), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.63"}
  %param.62 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(39), sharding={devices=[1,2,8,1,1]<=[16]}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.62"}
  %constant_2882_0 = f32[] constant(0)
  %wrapped_transpose = bf16[768,32768]{1,0} fusion(%param.8), kind=kInput, calls=%wrapped_transpose_computation, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="wrapped_transpose"}
  %all-gather-start.3 = ((bf16[768,32768]{1,0}, bf16[768,32768]{1,0}), (bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0})) all-gather-start(%wrapped_transpose, %param.31), channel_id=1, replica_groups=[2,8]<=[16], dimensions={0}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-gather-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_convert_fusion.17 = bf16[8,8192,32768]{2,1,0} fusion(%param.7), kind=kLoop, calls=%fused_convert.17, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="loop_convert_fusion.17"}
  %all-gather-done.3 = (bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0}) all-gather-done(%all-gather-start.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-gather-done.3"}
  %get-tuple-element.4291 = bf16[6144,32768]{1,0} get-tuple-element(%all-gather-done.3), index=0, metadata={scheduling_name="get-tuple-element.4291"}
  %bitcast.32027 = bf16[32768,6144]{0,1} bitcast(%get-tuple-element.4291), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="bitcast.32027"}
  %bitcast.26030.0 = bf16[65536,32768]{1,0} bitcast(%loop_convert_fusion.17), metadata={scheduling_name="bitcast.26030.0"}
  %custom-call.1188 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26030.0, %bitcast.32027), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="custom-call.1188"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3830.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1188), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="get-tuple-element.3830.0"}
  %bitcast.26041.0 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3830.0), metadata={scheduling_name="bitcast.26041.0"}
  %all-to-all-start.12 = ((bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26041.0), calls=%async_computation.13, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all-start.12"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %partition-id.4.0 = u32[] partition-id(), metadata={scheduling_name="partition-id.4.0"}
  %loop_compare_dynamic_slice_fusion = (pred[1]{0}, s32[1]{0}) fusion(%constant_2898_0, %partition-id.4.0), kind=kLoop, calls=%fused_compare_dynamic_slice, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="loop_compare_dynamic_slice_fusion"}
  %copy.1040 = s32[] copy(%constant_2840_0)
  %input_slice_fusion.1 = (s32[9]{0}, s32[65536]{0}) fusion(%constant_2887_0, %partition-id.4.0), kind=kInput, calls=%fused_slice.5, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="input_slice_fusion.1"}
  %get-tuple-element.4416 = s32[1]{0} get-tuple-element(%loop_compare_dynamic_slice_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="get-tuple-element.4416"}
  %input_slice_fusion.2 = (u32[72]{0}, u32[65536]{0}) fusion(%get-tuple-element.4416, %constant_2887_0, %partition-id.4.0), kind=kInput, calls=%fused_slice.6, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="input_slice_fusion.2"}
  %copy.736 = s32[] copy(%copy.1040), metadata={scheduling_name="copy.736"}
  %get-tuple-element.4269 = u32[72]{0} get-tuple-element(%input_slice_fusion.2), index=0, metadata={scheduling_name="get-tuple-element.4269"}
  %bitcast.32016 = u32[9,2,4]{2,1,0} bitcast(%get-tuple-element.4269), metadata={scheduling_name="bitcast.32016"}
  %copy.747 = u32[9,2,4]{2,1,0} copy(%bitcast.32016), metadata={scheduling_name="copy.747"}
  %input_transpose_fusion.9 = bf16[2,768,6144]{2,1,0} fusion(%param.14), kind=kInput, calls=%fused_transpose.23, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" deduplicated_name="input_transpose_fusion.8" scheduling_name="input_transpose_fusion.9"}
  %loop_compare_fusion.12 = pred[1]{0} fusion(%get-tuple-element.4416), kind=kLoop, calls=%fused_compare.12, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="loop_compare_fusion.12"}
  %wrapped_iota.1 = s32[1,1,1,1,8]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="wrapped_iota.1"}
  %loop_power_fusion.1 = f32[64]{0} fusion(), kind=kLoop, calls=%fused_power.1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 deduplicated_name="loop_power_fusion" scheduling_name="loop_power_fusion.1"}
  %all-to-all-done.12 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all-done.12"}
  %all-gather-start.2 = (s32[8,8192]{1,0}, s32[128,8192]{1,0}) all-gather-start(%param.11), channel_id=4, replica_groups=[1,16]<=[16], dimensions={0}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=641 scheduling_name="all-gather-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_iota.2 = s32[1,1,1,1,2049]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="wrapped_iota.2"}
  %wrapped_iota = s32[1,1,4,8192,2]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="wrapped_iota"}
  %loop_broadcast_fusion.17 = (f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.17, metadata={scheduling_name="loop_broadcast_fusion.17"}
  %loop_broadcast_fusion.7 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=97 scheduling_name="loop_broadcast_fusion.7"}
  %loop_broadcast_fusion.8 = (bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.8, metadata={scheduling_name="loop_broadcast_fusion.8"}
  %input_transpose_fusion.8 = bf16[2,768,6144]{2,1,0} fusion(%param.24), kind=kInput, calls=%fused_transpose.22, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" deduplicated_name="input_transpose_fusion.8" scheduling_name="input_transpose_fusion.8"}
  %all-gather-done.2 = s32[128,8192]{1,0} all-gather-done(%all-gather-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=641 scheduling_name="all-gather-done.2"}
  %bitcast.26045.0 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} bitcast(%all-to-all-done.12), metadata={scheduling_name="bitcast.26045.0"}
  %collective-permute-start.7 = (bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}, bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}) collective-permute-start(%bitcast.26045.0), channel_id=3, source_target_pairs={{0,0},{4,1},{1,2},{5,3},{2,4},{6,5},{3,6},{7,7},{8,8},{12,9},{9,10},{13,11},{10,12},{14,13},{11,14},{15,15}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="collective-permute-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.11 = (bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.11, metadata={scheduling_name="loop_broadcast_fusion.11"}
  %loop_broadcast_fusion.10 = (bf16[9,1,4,8192,6144]{4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.10, metadata={scheduling_name="loop_broadcast_fusion.10"}
  %get-tuple-element.4252 = pred[1]{0} get-tuple-element(%loop_compare_dynamic_slice_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="get-tuple-element.4252"}
  %loop_broadcast_fusion.6 = pred[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.4252), kind=kLoop, calls=%fused_broadcast.6, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 deduplicated_name="loop_broadcast_fusion.5" scheduling_name="loop_broadcast_fusion.6"}
  %loop_broadcast_fusion.5 = pred[1,4,8192,6144]{3,2,1,0} fusion(%loop_compare_fusion.12), kind=kLoop, calls=%fused_broadcast.5, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 deduplicated_name="loop_broadcast_fusion.5" scheduling_name="loop_broadcast_fusion.5"}
  %loop_dynamic_slice_fusion.26 = s32[4,4,8192]{2,1,0} fusion(%all-gather-done.2, %constant_2903_0, %partition-id.4.0), kind=kLoop, calls=%fused_dynamic_slice.26, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="loop_dynamic_slice_fusion.26"}
  %collective-permute-done.7 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} collective-permute-done(%collective-permute-start.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="collective-permute-done.7"}
  %bitcast.26103.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.9), metadata={scheduling_name="bitcast.26103.0"}
  %bitcast.26107.0 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param.10), metadata={scheduling_name="bitcast.26107.0"}
  %bitcast.26146.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.12), metadata={scheduling_name="bitcast.26146.0"}
  %bitcast.26150.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.13), metadata={scheduling_name="bitcast.26150.0"}
  %bitcast.26161.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.15), metadata={scheduling_name="bitcast.26161.0"}
  %bitcast.26165.0 = bf16[1,2,768,8]{3,2,1,0} bitcast(%param.16), metadata={scheduling_name="bitcast.26165.0"}
  %bitcast.26199.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.17), metadata={scheduling_name="bitcast.26199.0"}
  %bitcast.26203.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.18), metadata={scheduling_name="bitcast.26203.0"}
  %bitcast.26207.0 = bf16[1,2,1,16384,6144]{4,3,2,1,0} bitcast(%param.19), metadata={scheduling_name="bitcast.26207.0"}
  %bitcast.26211.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.20), metadata={scheduling_name="bitcast.26211.0"}
  %bitcast.26215.0 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param.21), metadata={scheduling_name="bitcast.26215.0"}
  %bitcast.26219.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.22), metadata={scheduling_name="bitcast.26219.0"}
  %bitcast.26223.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.23), metadata={scheduling_name="bitcast.26223.0"}
  %bitcast.26234.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.25), metadata={scheduling_name="bitcast.26234.0"}
  %bitcast.26238.0 = bf16[1,2,768,8]{3,2,1,0} bitcast(%param.26), metadata={scheduling_name="bitcast.26238.0"}
  %bitcast.26242.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.27), metadata={scheduling_name="bitcast.26242.0"}
  %bitcast.26246.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.28), metadata={scheduling_name="bitcast.26246.0"}
  %bitcast.26250.0 = bf16[1,2,1,16384,6144]{4,3,2,1,0} bitcast(%param.29), metadata={scheduling_name="bitcast.26250.0"}
  %bitcast.26142.0 = f32[1,1,1,1,64]{4,3,2,1,0} bitcast(%loop_power_fusion.1), metadata={scheduling_name="bitcast.26142.0"}
  %bitcast.26090.0 = s32[1,4,8192,2,1]{3,2,1,4,0} bitcast(%wrapped_iota), metadata={scheduling_name="bitcast.26090.0"}
  %get-tuple-element.4411 = s32[9]{0} get-tuple-element(%input_slice_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4411"}
  %get-tuple-element.4268 = s32[65536]{0} get-tuple-element(%input_slice_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4268"}
  %bitcast.26087.0 = s32[1,4,8192,2,1]{3,2,1,4,0} bitcast(%get-tuple-element.4268), metadata={scheduling_name="bitcast.26087.0"}
  %get-tuple-element.4270 = u32[65536]{0} get-tuple-element(%input_slice_fusion.2), index=1, metadata={scheduling_name="get-tuple-element.4270"}
  %bitcast.32017 = u32[1,4,8192,2]{3,2,1,0} bitcast(%get-tuple-element.4270), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="bitcast.32017"}
  %bitcast.26157.0 = bf16[1,2,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.9), metadata={scheduling_name="bitcast.26157.0"}
  %bitcast.26230.0 = bf16[1,2,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.8), metadata={scheduling_name="bitcast.26230.0"}
  %get-tuple-element.4861 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%loop_broadcast_fusion.17), index=0, metadata={scheduling_name="get-tuple-element.4861"}
  %get-tuple-element.4862 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%loop_broadcast_fusion.17), index=1, metadata={scheduling_name="get-tuple-element.4862"}
  %get-tuple-element.4858 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=3, metadata={scheduling_name="get-tuple-element.4858"}
  %get-tuple-element.4856 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.4856"}
  %get-tuple-element.4854 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.8), index=1, metadata={scheduling_name="get-tuple-element.4854"}
  %bitcast.26049.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} bitcast(%collective-permute-done.7), metadata={scheduling_name="bitcast.26049.0"}
  %get-tuple-element.4863 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.11), index=0, metadata={scheduling_name="get-tuple-element.4863"}
  %get-tuple-element.4864 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.11), index=1, metadata={scheduling_name="get-tuple-element.4864"}
  %get-tuple-element.4859 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.4859"}
  %get-tuple-element.4860 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.4860"}
  %tuple.662 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) tuple(%copy.736, %get-tuple-element.4854, %get-tuple-element.4858, %get-tuple-element.4856, %bitcast.26049.0, /*index=5*/%get-tuple-element.4859, %get-tuple-element.4861, %bitcast.32016, %get-tuple-element.4863, %get-tuple-element.4860, /*index=10*/%get-tuple-element.4862, %copy.747, %get-tuple-element.4864, %get-tuple-element.4411, %bitcast.26087.0, /*index=15*/%bitcast.26090.0, %loop_broadcast_fusion.6, %bitcast.26103.0, %get-tuple-element.4416, %bitcast.26107.0, /*index=20*/%loop_dynamic_slice_fusion.26, %bitcast.26142.0, %bitcast.26146.0, %bitcast.26150.0, %bitcast.26157.0, /*index=25*/%bitcast.26161.0, %bitcast.26165.0, %bitcast.32017, %wrapped_iota.1, %wrapped_iota.2, /*index=30*/%bitcast.26199.0, %bitcast.26203.0, %bitcast.26207.0, %bitcast.26211.0, %bitcast.26215.0, /*index=35*/%bitcast.26219.0, %bitcast.26223.0, %bitcast.26230.0, %bitcast.26234.0, %bitcast.26238.0, /*index=40*/%bitcast.26242.0, %bitcast.26246.0, %bitcast.26250.0, %loop_broadcast_fusion.5), metadata={scheduling_name="tuple.662"}
  %while.74 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) while(%tuple.662), condition=%region_18.1706.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone, body=%region_0.1585.sunk.clone.sunk.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="while.74"}, backend_config={"known_trip_count":{"n":"9"},"known_init_step":{"init":"0","step":"1"},"known_induction_variable":{"tuple_index":"0"}}
  %get-tuple-element.1353.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1353.0"}
  %loop_gather_fusion = bf16[2,1,1,4,8192,6144]{5,4,3,0,2,1} fusion(%constant_2945_0, %get-tuple-element.1353.0), kind=kLoop, calls=%fused_gather, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="loop_gather_fusion"}
  %bitcast.26266.0 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} bitcast(%loop_gather_fusion), metadata={scheduling_name="bitcast.26266.0"}
  %all-to-all-start.15 = ((bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}), bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}) async-start(%bitcast.26266.0), calls=%async_computation.16, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all-start.15"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-to-all-done.15 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} async-done(%all-to-all-start.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all-done.15"}
  %bitcast.26270.0 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} bitcast(%all-to-all-done.15), metadata={scheduling_name="bitcast.26270.0"}
  %collective-permute-start.10 = (bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}, bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}) collective-permute-start(%bitcast.26270.0), channel_id=129, source_target_pairs={{0,0},{2,1},{4,2},{6,3},{1,4},{3,5},{5,6},{7,7},{8,8},{10,9},{12,10},{14,11},{9,12},{11,13},{13,14},{15,15}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="collective-permute-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_reduce_fusion.65 = s32[256]{0} fusion(%param.30), kind=kInput, calls=%fused_reduce.65, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="input_reduce_fusion.65"}
  %input_reduce_fusion.70 = s32[] fusion(%input_reduce_fusion.65), kind=kInput, calls=%fused_reduce.70, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="input_reduce_fusion.70"}
  %collective-permute-done.10 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} collective-permute-done(%collective-permute-start.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="collective-permute-done.10"}
  %all-reduce-start = s32[] all-reduce-start(%input_reduce_fusion.70), channel_id=130, replica_groups=[1,16]<=[16], use_global_device_ids=true, to_apply=%region_24.1883.clone, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="all-reduce-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_reduce_fusion.66 = f32[8,8192]{1,0} fusion(%collective-permute-done.10), kind=kInput, calls=%fused_reduce.66, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_reduce_fusion.66"}
  %loop_rsqrt_fusion.8 = f32[1,8,8192]{2,1,0} fusion(%input_reduce_fusion.66), kind=kLoop, calls=%fused_rsqrt.8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="loop_rsqrt_fusion.8"}
  %loop_convert_fusion.18 = bf16[8,8192,6144]{2,1,0} fusion(%loop_rsqrt_fusion.8, %collective-permute-done.10, %param.5), kind=kLoop, calls=%fused_convert.18, metadata={scheduling_name="loop_convert_fusion.18"}
  %get-tuple-element.4292 = bf16[6144,32768]{1,0} get-tuple-element(%all-gather-done.3), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4292"}
  %bitcast.26338.0 = bf16[65536,6144]{1,0} bitcast(%loop_convert_fusion.18), metadata={scheduling_name="bitcast.26338.0"}
  %custom-call.1189 = (bf16[65536,32768]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26338.0, %get-tuple-element.4292), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1189"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3831.0 = bf16[65536,32768]{1,0} get-tuple-element(%custom-call.1189), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3831.0"}
  %input_reduce_fusion.64 = f32[65536,128]{1,0} fusion(%get-tuple-element.3831.0), kind=kInput, calls=%fused_reduce.64, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="input_reduce_fusion.64"}
  %input_reduce_fusion.122 = f32[65536]{0} fusion(%input_reduce_fusion.64), kind=kInput, calls=%fused_reduce.122, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="input_reduce_fusion.122"}
  %input_reduce_fusion.63 = f32[8,8192,128]{2,1,0} fusion(%input_reduce_fusion.122, %get-tuple-element.3831.0), kind=kInput, calls=%fused_reduce.63, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="input_reduce_fusion.63"}
  %input_reduce_fusion.81 = f32[8,8192]{1,0} fusion(%input_reduce_fusion.63), kind=kInput, calls=%fused_reduce.81, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 deduplicated_name="input_reduce_fusion.81" scheduling_name="input_reduce_fusion.81"}
  %loop_add_log_fusion = (f32[8,8192]{1,0}, f32[8,8192]{1,0}) fusion(%input_reduce_fusion.122, %input_reduce_fusion.81), kind=kLoop, calls=%fused_add_log, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="loop_add_log_fusion"}
  %all-reduce-done = s32[] all-reduce-done(%all-reduce-start), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="all-reduce-done"}
  %loop_select_fusion.2 = f32[8,8192]{1,0} fusion(%all-reduce-done, %param.30), kind=kLoop, calls=%fused_select.2, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="loop_select_fusion.2"}
  %get-tuple-element.4251 = f32[8,8192]{1,0} get-tuple-element(%loop_add_log_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="get-tuple-element.4251"}
  %get-tuple-element.4250 = f32[8,8192]{1,0} get-tuple-element(%loop_add_log_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="get-tuple-element.4250"}
  %input_convert_reduce_fusion.8 = (bf16[8,8192,32768]{2,1,0}, f32[8,8192,128]{2,1,0}) fusion(%loop_select_fusion.2, %input_reduce_fusion.81, %input_reduce_fusion.122, %get-tuple-element.3831.0, %get-tuple-element.4250, /*index=5*/%param.32, %get-tuple-element.4251), kind=kInput, calls=%fused_convert_reduce.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="input_convert_reduce_fusion.8"}
  %get-tuple-element.4248 = bf16[8,8192,32768]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.8), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="get-tuple-element.4248"}
  %bitcast.26434.0 = bf16[65536,32768]{1,0} bitcast(%get-tuple-element.4248), metadata={scheduling_name="bitcast.26434.0"}
  %custom-call.1190 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26434.0, %get-tuple-element.4292), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1190"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_convert_fusion.19 = f32[] fusion(), kind=kLoop, calls=%fused_convert.19, metadata={scheduling_name="loop_convert_fusion.19"}
  %get-tuple-element.3832.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1190), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3832.0"}
  %input_reduce_fusion.67 = f32[8,8192]{1,0} fusion(%get-tuple-element.3832.0, %collective-permute-done.10, %param.5), kind=kInput, calls=%fused_reduce.67, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_reduce_fusion.67"}
  %loop_multiply_fusion.6 = f32[1,8,8192]{2,1,0} fusion(%loop_rsqrt_fusion.8, %input_reduce_fusion.67, %input_reduce_fusion.66), kind=kLoop, calls=%fused_multiply.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="loop_multiply_fusion.6"}
  %input_convert_reduce_fusion.9 = (bf16[8,8192,6144]{2,1,0}, f32[256,6144]{1,0}) fusion(%loop_rsqrt_fusion.8, %get-tuple-element.3832.0, %collective-permute-done.10, %loop_multiply_fusion.6, %param.5, /*index=5*/%loop_convert_fusion.19), kind=kInput, calls=%fused_convert_reduce.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="input_convert_reduce_fusion.9"}
  %get-tuple-element.4246 = bf16[8,8192,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.9), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="get-tuple-element.4246"}
  %bitcast.26577.0 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.4246), metadata={scheduling_name="bitcast.26577.0"}
  %all-to-all-start.13 = ((bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26577.0), calls=%async_computation.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all-start.13"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_slice_fusion = (bf16[12288]{0}, bf16[12288]{0}) fusion(), kind=kInput, calls=%fused_slice.4, metadata={scheduling_name="input_slice_fusion"}
  %get-tuple-element.4265 = bf16[12288]{0} get-tuple-element(%input_slice_fusion), index=0, metadata={scheduling_name="get-tuple-element.4265"}
  %bitcast.32013 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4265), metadata={scheduling_name="bitcast.32013"}
  %get-tuple-element.4266 = bf16[12288]{0} get-tuple-element(%input_slice_fusion), index=1, metadata={scheduling_name="get-tuple-element.4266"}
  %bitcast.32014 = bf16[2,1,768,8]{3,2,1,0} bitcast(%get-tuple-element.4266), metadata={scheduling_name="bitcast.32014"}
  %copy_fusion.2 = (bf16[12288]{0}, bf16[12288]{0}) fusion(%bitcast.32013, %bitcast.32014), kind=kInput, calls=%copy_horizontally_fused_computation.2, metadata={scheduling_name="copy_fusion.2"}
  %copy_fusion.1 = (bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}) fusion(%bitcast.32013), kind=kLoop, calls=%copy_horizontally_fused_computation.1, metadata={scheduling_name="copy_fusion.1"}
  %loop_broadcast_fusion.13 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.13, metadata={scheduling_name="loop_broadcast_fusion.13"}
  %all-to-all-done.13 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all-done.13"}
  %bitcast.26581.0 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} bitcast(%all-to-all-done.13), metadata={scheduling_name="bitcast.26581.0"}
  %collective-permute-start.8 = (bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}, bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}) collective-permute-start(%bitcast.26581.0), channel_id=147, source_target_pairs={{0,0},{4,1},{1,2},{5,3},{2,4},{6,5},{3,6},{7,7},{8,8},{12,9},{9,10},{13,11},{10,12},{14,13},{11,14},{15,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="collective-permute-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.15 = (bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.15, metadata={scheduling_name="loop_broadcast_fusion.15"}
  %loop_broadcast_fusion.12 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.12, metadata={scheduling_name="loop_broadcast_fusion.12"}
  %loop_broadcast_fusion.9 = bf16[2,1,4,8192,6144]{4,3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.9, metadata={scheduling_name="loop_broadcast_fusion.9"}
  %loop_broadcast_fusion.16 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.16, metadata={scheduling_name="loop_broadcast_fusion.16"}
  %loop_broadcast_fusion.14 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.14, metadata={scheduling_name="loop_broadcast_fusion.14"}
  %get-tuple-element.4247 = f32[256,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion.9), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="get-tuple-element.4247"}
  %input_reduce_fusion.69 = bf16[6144]{0} fusion(%get-tuple-element.4247, %loop_convert_fusion.19), kind=kInput, calls=%fused_reduce.69, metadata={scheduling_name="input_reduce_fusion.69"}
  %collective-permute-done.8 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} collective-permute-done(%collective-permute-start.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="collective-permute-done.8"}
  %input_scatter_fusion.10 = bf16[2,1,4,8192,6144]{4,3,2,1,0} fusion(%loop_broadcast_fusion.9, %constant_2945_0, %collective-permute-done.8), kind=kInput, calls=%fused_scatter.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="input_scatter_fusion.10"}
  %get-tuple-element.4884 = bf16[12288]{0} get-tuple-element(%copy_fusion.2), index=0, metadata={scheduling_name="get-tuple-element.4884"}
  %bitcast.32263 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4884), metadata={scheduling_name="bitcast.32263"}
  %get-tuple-element.4885 = bf16[12288]{0} get-tuple-element(%copy_fusion.2), index=1, metadata={scheduling_name="get-tuple-element.4885"}
  %bitcast.32264 = bf16[2,1,768,8]{3,2,1,0} bitcast(%get-tuple-element.4885), metadata={scheduling_name="bitcast.32264"}
  %get-tuple-element.4882 = bf16[2,1,6144]{2,1,0} get-tuple-element(%copy_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4882"}
  %bitcast.32261 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4882), metadata={scheduling_name="bitcast.32261"}
  %get-tuple-element.4883 = bf16[2,1,6144]{2,1,0} get-tuple-element(%copy_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4883"}
  %bitcast.32262 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4883), metadata={scheduling_name="bitcast.32262"}
  %get-tuple-element.4874 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=3, metadata={scheduling_name="get-tuple-element.4874"}
  %get-tuple-element.4873 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=2, metadata={scheduling_name="get-tuple-element.4873"}
  %get-tuple-element.4871 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.4871"}
  %get-tuple-element.4872 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.4872"}
  %bitcast.26626.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.9), metadata={scheduling_name="bitcast.26626.0"}
  %bitcast.26648.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.8), metadata={scheduling_name="bitcast.26648.0"}
  %get-tuple-element.4875 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%loop_broadcast_fusion.15), index=0, metadata={scheduling_name="get-tuple-element.4875"}
  %get-tuple-element.4876 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%loop_broadcast_fusion.15), index=1, metadata={scheduling_name="get-tuple-element.4876"}
  %get-tuple-element.4877 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.12), index=0, metadata={scheduling_name="get-tuple-element.4877"}
  %get-tuple-element.4878 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.12), index=1, metadata={scheduling_name="get-tuple-element.4878"}
  %get-tuple-element.4869 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.4869"}
  %get-tuple-element.4870 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.4870"}
  %get-tuple-element.4868 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=3, metadata={scheduling_name="get-tuple-element.4868"}
  %get-tuple-element.4867 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=2, metadata={scheduling_name="get-tuple-element.4867"}
  %get-tuple-element.4865 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=0, metadata={scheduling_name="get-tuple-element.4865"}
  %get-tuple-element.4866 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=1, metadata={scheduling_name="get-tuple-element.4866"}
  %get-tuple-element.4855 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.4855"}
  %get-tuple-element.4857 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=2, metadata={scheduling_name="get-tuple-element.4857"}
  %get-tuple-element.4853 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.8), index=0, metadata={scheduling_name="get-tuple-element.4853"}
  %get-tuple-element.4559 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4559"}
  %get-tuple-element.4558 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%while.74), index=8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4558"}
  %get-tuple-element.4557 = u32[9,2,4]{2,1,0} get-tuple-element(%while.74), index=7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4557"}
  %get-tuple-element.4556 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%while.74), index=6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4556"}
  %get-tuple-element.4555 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4555"}
  %get-tuple-element.4563 = s32[9]{0} get-tuple-element(%while.74), index=13, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4563"}
  %get-tuple-element.4562 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%while.74), index=12, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4562"}
  %get-tuple-element.4561 = u32[9,2,4]{2,1,0} get-tuple-element(%while.74), index=11, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4561"}
  %get-tuple-element.4560 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%while.74), index=10, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4560"}
  %bitcast.26588.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} bitcast(%input_scatter_fusion.10), metadata={scheduling_name="bitcast.26588.0"}
  %tuple.665 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%copy.1040, %bitcast.32014, %get-tuple-element.4865, %get-tuple-element.4867, %get-tuple-element.4869, /*index=5*/%bitcast.32013, %bitcast.32263, %get-tuple-element.4871, %get-tuple-element.4875, %get-tuple-element.4877, /*index=10*/%get-tuple-element.4873, %bitcast.32264, %get-tuple-element.4868, %get-tuple-element.4866, %get-tuple-element.4870, /*index=15*/%bitcast.32261, %bitcast.32262, %get-tuple-element.4874, %get-tuple-element.4876, %get-tuple-element.4878, /*index=20*/%get-tuple-element.4872, %get-tuple-element.4853, %get-tuple-element.4855, %get-tuple-element.4857, %bitcast.26588.0, /*index=25*/%get-tuple-element.4555, %get-tuple-element.4556, %get-tuple-element.4557, %get-tuple-element.4558, %get-tuple-element.4559, /*index=30*/%get-tuple-element.4560, %get-tuple-element.4561, %get-tuple-element.4562, %get-tuple-element.4563, %loop_dynamic_slice_fusion.26, /*index=35*/%param.16, %param.17, %param.18, %param.19, %param.15, /*index=40*/%param.9, %param.12, %bitcast.26626.0, %param.10, %param.13, /*index=45*/%param.26, %param.27, %param.28, %param.29, %param.25, /*index=50*/%param.20, %param.22, %bitcast.26648.0, %param.21, %param.23), metadata={scheduling_name="tuple.665"}
  %while.75 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) while(%tuple.665), condition=%region_97.4035_spmd, body=%region_30.3928_spmd, metadata={scheduling_name="while.75"}, backend_config={"known_trip_count":{"n":"9"},"known_init_step":{"init":"0","step":"1"},"known_induction_variable":{"tuple_index":"0"}}
  %all-reduce-start.1 = bf16[6144]{0} all-reduce-start(%input_reduce_fusion.69), channel_id=132, replica_groups=[1,16]<=[16], use_global_device_ids=true, to_apply=%region_25.1918.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="all-reduce-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3564.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=16, metadata={scheduling_name="get-tuple-element.3564.0"}
  %bitcast.32122 = bf16[12288]{0} bitcast(%get-tuple-element.3564.0), metadata={scheduling_name="bitcast.32122"}
  %get-tuple-element.3563.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=15, metadata={scheduling_name="get-tuple-element.3563.0"}
  %bitcast.32123 = bf16[12288]{0} bitcast(%get-tuple-element.3563.0), metadata={scheduling_name="bitcast.32123"}
  %get-tuple-element.3561.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=5, metadata={scheduling_name="get-tuple-element.3561.0"}
  %bitcast.32125 = bf16[12288]{0} bitcast(%get-tuple-element.3561.0), metadata={scheduling_name="bitcast.32125"}
  %get-tuple-element.3562.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=6, metadata={scheduling_name="get-tuple-element.3562.0"}
  %bitcast.32124 = bf16[12288]{0} bitcast(%get-tuple-element.3562.0), metadata={scheduling_name="bitcast.32124"}
  %wrapped_concatenate.2 = bf16[49152]{0} fusion(%bitcast.32122, %bitcast.32123, %bitcast.32124, %bitcast.32125), kind=kLoop, calls=%wrapped_concatenate_computation.2, metadata={scheduling_name="wrapped_concatenate.2"}
  %all-reduce-done.1 = bf16[6144]{0} all-reduce-done(%all-reduce-start.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="all-reduce-done.1"}
  %all-reduce-start.6 = bf16[49152]{0} all-reduce-start(%wrapped_concatenate.2), channel_id=581, replica_groups=[2,8]<=[16], use_global_device_ids=true, to_apply=%region_59.2325.clone, metadata={scheduling_name="all-reduce-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_multiply_fusion.7 = f32[] fusion(%param.6), kind=kLoop, calls=%fused_multiply.7, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_multiply_fusion.7"}
  %all-reduce-done.6 = bf16[49152]{0} all-reduce-done(%all-reduce-start.6), metadata={scheduling_name="all-reduce-done.6"}
  %get-tuple-element.1383.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1383.0"}
  %bitcast.27110.0 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} bitcast(%get-tuple-element.1383.0), metadata={scheduling_name="bitcast.27110.0"}
  %all-to-all-start.14 = ((bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}), bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}) async-start(%bitcast.27110.0), calls=%async_computation.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all-start.14"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_add_select_fusion = (s32[], s32[]) fusion(%param.4, %param.6), kind=kLoop, calls=%fused_add_select, metadata={scheduling_name="loop_add_select_fusion"}
  %loop_select_subtract_fusion = (f32[], s32[]) fusion(%param.34), kind=kLoop, calls=%fused_select_subtract, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_select_subtract_fusion"}
  %wrapped_transpose.1 = bf16[768,32768]{1,0} fusion(%param.78), kind=kInput, calls=%wrapped_transpose_computation.1, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="wrapped_transpose.1"}
  %copy.935 = bf16[32768,768]{1,0} copy(%param.79), metadata={scheduling_name="copy.935"}
  %get-tuple-element.4798 = s32[] get-tuple-element(%loop_select_subtract_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4798"}
  %loop_subtract_fusion = f32[] fusion(%get-tuple-element.4798), kind=kLoop, calls=%fused_subtract, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_subtract_fusion"}
  %get-tuple-element.4249 = f32[8,8192,128]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.8), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="get-tuple-element.4249"}
  %input_reduce_fusion.116 = f32[8,8192]{1,0} fusion(%get-tuple-element.4249), kind=kInput, calls=%fused_reduce.116, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 deduplicated_name="input_reduce_fusion.81" scheduling_name="input_reduce_fusion.116"}
  %input_reduce_fusion.27 = f32[256]{0} fusion(%get-tuple-element.4251, %input_reduce_fusion.122, %input_reduce_fusion.116, %param.30), kind=kInput, calls=%fused_reduce.27, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="input_reduce_fusion.27"}
  %bitcast.26432.0 = bf16[6144,65536]{0,1} bitcast(%loop_convert_fusion.18), metadata={scheduling_name="bitcast.26432.0"}
  %custom-call.1191 = (bf16[6144,32768]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26432.0, %bitcast.26434.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1191"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"2147483648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1373.0 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%while.75), index=11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1373.0"}
  %input_reduce_fusion.48 = f32[] fusion(%get-tuple-element.1373.0), kind=kInput, calls=%fused_reduce.48, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.48" scheduling_name="input_reduce_fusion.48"}
  %get-tuple-element.1363.0 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%while.75), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1363.0"}
  %input_reduce_fusion.61 = f32[] fusion(%get-tuple-element.1363.0), kind=kInput, calls=%fused_reduce.61, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.48" scheduling_name="input_reduce_fusion.61"}
  %get-tuple-element.1369.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1369.0"}
  %input_reduce_fusion.52 = f32[1024]{0} fusion(%get-tuple-element.1369.0), kind=kInput, calls=%fused_reduce.52, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.52"}
  %input_reduce_fusion.87 = f32[] fusion(%input_reduce_fusion.52), kind=kInput, calls=%fused_reduce.87, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.87"}
  %get-tuple-element.1372.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1372.0"}
  %input_reduce_fusion.49 = f32[1024]{0} fusion(%get-tuple-element.1372.0), kind=kInput, calls=%fused_reduce.49, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.49"}
  %input_reduce_fusion.90 = f32[] fusion(%input_reduce_fusion.49), kind=kInput, calls=%fused_reduce.90, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.90"}
  %get-tuple-element.1379.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1379.0"}
  %input_reduce_fusion.39 = f32[1024]{0} fusion(%get-tuple-element.1379.0), kind=kInput, calls=%fused_reduce.39, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.39"}
  %input_reduce_fusion.94 = f32[] fusion(%input_reduce_fusion.39), kind=kInput, calls=%fused_reduce.94, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.94"}
  %get-tuple-element.1382.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=20, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1382.0"}
  %input_reduce_fusion.36 = f32[1024]{0} fusion(%get-tuple-element.1382.0), kind=kInput, calls=%fused_reduce.36, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.36"}
  %input_reduce_fusion.97 = f32[] fusion(%input_reduce_fusion.36), kind=kInput, calls=%fused_reduce.97, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.97"}
  %get-tuple-element.1370.0 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%while.75), index=8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1370.0"}
  %input_reduce_fusion.51 = f32[2048]{0} fusion(%get-tuple-element.1370.0), kind=kInput, calls=%fused_reduce.51, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.38" scheduling_name="input_reduce_fusion.51"}
  %input_reduce_fusion.88 = f32[] fusion(%input_reduce_fusion.51), kind=kInput, calls=%fused_reduce.88, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.88"}
  %get-tuple-element.1371.0 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%while.75), index=9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1371.0"}
  %input_reduce_fusion.50 = f32[2048]{0} fusion(%get-tuple-element.1371.0), kind=kInput, calls=%fused_reduce.50, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.37" scheduling_name="input_reduce_fusion.50"}
  %input_reduce_fusion.89 = f32[] fusion(%input_reduce_fusion.50), kind=kInput, calls=%fused_reduce.89, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.89"}
  %get-tuple-element.1380.0 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%while.75), index=18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1380.0"}
  %input_reduce_fusion.38 = f32[2048]{0} fusion(%get-tuple-element.1380.0), kind=kInput, calls=%fused_reduce.38, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.38" scheduling_name="input_reduce_fusion.38"}
  %input_reduce_fusion.95 = f32[] fusion(%input_reduce_fusion.38), kind=kInput, calls=%fused_reduce.95, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.95"}
  %get-tuple-element.1381.0 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%while.75), index=19, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1381.0"}
  %input_reduce_fusion.37 = f32[2048]{0} fusion(%get-tuple-element.1381.0), kind=kInput, calls=%fused_reduce.37, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.37" scheduling_name="input_reduce_fusion.37"}
  %input_reduce_fusion.96 = f32[] fusion(%input_reduce_fusion.37), kind=kInput, calls=%fused_reduce.96, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.96"}
  %get-tuple-element.1364.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1364.0"}
  %input_reduce_fusion.60 = f32[24576]{0} fusion(%get-tuple-element.1364.0), kind=kInput, calls=%fused_reduce.60, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.60"}
  %input_reduce_fusion.59 = f32[128]{0} fusion(%input_reduce_fusion.60), kind=kInput, calls=%fused_reduce.59, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.59"}
  %input_reduce_fusion.84 = f32[] fusion(%input_reduce_fusion.59), kind=kInput, calls=%fused_reduce.84, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.84"}
  %get-tuple-element.1365.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1365.0"}
  %input_reduce_fusion.58 = f32[24576]{0} fusion(%get-tuple-element.1365.0), kind=kInput, calls=%fused_reduce.58, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.58"}
  %input_reduce_fusion.57 = f32[128]{0} fusion(%input_reduce_fusion.58), kind=kInput, calls=%fused_reduce.57, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.57"}
  %input_reduce_fusion.85 = f32[] fusion(%input_reduce_fusion.57), kind=kInput, calls=%fused_reduce.85, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.85"}
  %get-tuple-element.1366.0 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1366.0"}
  %input_reduce_fusion.56 = f32[24576]{0} fusion(%get-tuple-element.1366.0), kind=kInput, calls=%fused_reduce.56, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.43" scheduling_name="input_reduce_fusion.56"}
  %input_reduce_fusion.55 = f32[128]{0} fusion(%input_reduce_fusion.56), kind=kInput, calls=%fused_reduce.55, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.55"}
  %input_reduce_fusion.86 = f32[] fusion(%input_reduce_fusion.55), kind=kInput, calls=%fused_reduce.86, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.86"}
  %get-tuple-element.1374.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1374.0"}
  %input_reduce_fusion.47 = f32[24576]{0} fusion(%get-tuple-element.1374.0), kind=kInput, calls=%fused_reduce.47, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.47"}
  %input_reduce_fusion.46 = f32[128]{0} fusion(%input_reduce_fusion.47), kind=kInput, calls=%fused_reduce.46, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.46"}
  %input_reduce_fusion.91 = f32[] fusion(%input_reduce_fusion.46), kind=kInput, calls=%fused_reduce.91, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.91"}
  %get-tuple-element.1375.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=13, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1375.0"}
  %input_reduce_fusion.45 = f32[24576]{0} fusion(%get-tuple-element.1375.0), kind=kInput, calls=%fused_reduce.45, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.45"}
  %input_reduce_fusion.44 = f32[128]{0} fusion(%input_reduce_fusion.45), kind=kInput, calls=%fused_reduce.44, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.44"}
  %input_reduce_fusion.92 = f32[] fusion(%input_reduce_fusion.44), kind=kInput, calls=%fused_reduce.92, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.92"}
  %get-tuple-element.1376.0 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1376.0"}
  %input_reduce_fusion.43 = f32[24576]{0} fusion(%get-tuple-element.1376.0), kind=kInput, calls=%fused_reduce.43, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.43" scheduling_name="input_reduce_fusion.43"}
  %input_reduce_fusion.42 = f32[128]{0} fusion(%input_reduce_fusion.43), kind=kInput, calls=%fused_reduce.42, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.42"}
  %input_reduce_fusion.93 = f32[] fusion(%input_reduce_fusion.42), kind=kInput, calls=%fused_reduce.93, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.93"}
  %input_reduce_fusion.119 = f32[] fusion(%input_reduce_fusion.27), kind=kInput, calls=%fused_reduce.119, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="input_reduce_fusion.119"}
  %bitcast.32065 = f32[1]{0} bitcast(%input_reduce_fusion.48), metadata={scheduling_name="bitcast.32065"}
  %bitcast.32081 = f32[1]{0} bitcast(%input_reduce_fusion.48), metadata={scheduling_name="bitcast.32081"}
  %bitcast.32073 = f32[1]{0} bitcast(%input_reduce_fusion.61), metadata={scheduling_name="bitcast.32073"}
  %bitcast.32089 = f32[1]{0} bitcast(%input_reduce_fusion.61), metadata={scheduling_name="bitcast.32089"}
  %bitcast.32069 = f32[1]{0} bitcast(%input_reduce_fusion.87), metadata={scheduling_name="bitcast.32069"}
  %bitcast.32085 = f32[1]{0} bitcast(%input_reduce_fusion.87), metadata={scheduling_name="bitcast.32085"}
  %bitcast.32066 = f32[1]{0} bitcast(%input_reduce_fusion.90), metadata={scheduling_name="bitcast.32066"}
  %bitcast.32082 = f32[1]{0} bitcast(%input_reduce_fusion.90), metadata={scheduling_name="bitcast.32082"}
  %bitcast.32061 = f32[1]{0} bitcast(%input_reduce_fusion.94), metadata={scheduling_name="bitcast.32061"}
  %bitcast.32077 = f32[1]{0} bitcast(%input_reduce_fusion.94), metadata={scheduling_name="bitcast.32077"}
  %bitcast.32058 = f32[1]{0} bitcast(%input_reduce_fusion.97), metadata={scheduling_name="bitcast.32058"}
  %bitcast.32074 = f32[1]{0} bitcast(%input_reduce_fusion.97), metadata={scheduling_name="bitcast.32074"}
  %bitcast.32068 = f32[1]{0} bitcast(%input_reduce_fusion.88), metadata={scheduling_name="bitcast.32068"}
  %bitcast.32084 = f32[1]{0} bitcast(%input_reduce_fusion.88), metadata={scheduling_name="bitcast.32084"}
  %bitcast.32067 = f32[1]{0} bitcast(%input_reduce_fusion.89), metadata={scheduling_name="bitcast.32067"}
  %bitcast.32083 = f32[1]{0} bitcast(%input_reduce_fusion.89), metadata={scheduling_name="bitcast.32083"}
  %bitcast.32060 = f32[1]{0} bitcast(%input_reduce_fusion.95), metadata={scheduling_name="bitcast.32060"}
  %bitcast.32076 = f32[1]{0} bitcast(%input_reduce_fusion.95), metadata={scheduling_name="bitcast.32076"}
  %bitcast.32059 = f32[1]{0} bitcast(%input_reduce_fusion.96), metadata={scheduling_name="bitcast.32059"}
  %bitcast.32075 = f32[1]{0} bitcast(%input_reduce_fusion.96), metadata={scheduling_name="bitcast.32075"}
  %bitcast.32072 = f32[1]{0} bitcast(%input_reduce_fusion.84), metadata={scheduling_name="bitcast.32072"}
  %bitcast.32088 = f32[1]{0} bitcast(%input_reduce_fusion.84), metadata={scheduling_name="bitcast.32088"}
  %bitcast.32071 = f32[1]{0} bitcast(%input_reduce_fusion.85), metadata={scheduling_name="bitcast.32071"}
  %bitcast.32087 = f32[1]{0} bitcast(%input_reduce_fusion.85), metadata={scheduling_name="bitcast.32087"}
  %bitcast.32070 = f32[1]{0} bitcast(%input_reduce_fusion.86), metadata={scheduling_name="bitcast.32070"}
  %bitcast.32086 = f32[1]{0} bitcast(%input_reduce_fusion.86), metadata={scheduling_name="bitcast.32086"}
  %bitcast.32064 = f32[1]{0} bitcast(%input_reduce_fusion.91), metadata={scheduling_name="bitcast.32064"}
  %bitcast.32080 = f32[1]{0} bitcast(%input_reduce_fusion.91), metadata={scheduling_name="bitcast.32080"}
  %bitcast.32063 = f32[1]{0} bitcast(%input_reduce_fusion.92), metadata={scheduling_name="bitcast.32063"}
  %bitcast.32079 = f32[1]{0} bitcast(%input_reduce_fusion.92), metadata={scheduling_name="bitcast.32079"}
  %bitcast.32062 = f32[1]{0} bitcast(%input_reduce_fusion.93), metadata={scheduling_name="bitcast.32062"}
  %bitcast.32078 = f32[1]{0} bitcast(%input_reduce_fusion.93), metadata={scheduling_name="bitcast.32078"}
  %wrapped_concatenate.1 = f32[32]{0} fusion(%bitcast.32058, %bitcast.32059, %bitcast.32060, %bitcast.32061, %bitcast.32062, /*index=5*/%bitcast.32063, %bitcast.32064, %bitcast.32065, %bitcast.32066, %bitcast.32067, /*index=10*/%bitcast.32068, %bitcast.32069, %bitcast.32070, %bitcast.32071, %bitcast.32072, /*index=15*/%bitcast.32073, %bitcast.32074, %bitcast.32075, %bitcast.32076, %bitcast.32077, /*index=20*/%bitcast.32078, %bitcast.32079, %bitcast.32080, %bitcast.32081, %bitcast.32082, /*index=25*/%bitcast.32083, %bitcast.32084, %bitcast.32085, %bitcast.32086, %bitcast.32087, /*index=30*/%bitcast.32088, %bitcast.32089), kind=kLoop, calls=%wrapped_concatenate_computation.1, metadata={scheduling_name="wrapped_concatenate.1"}
  %all-to-all-done.14 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} async-done(%all-to-all-start.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all-done.14"}
  %all-reduce-start.5 = f32[32]{0} all-reduce-start(%wrapped_concatenate.1), channel_id=529, replica_groups={{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}}, use_global_device_ids=true, to_apply=%region_119.4315.clone, metadata={scheduling_name="all-reduce-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.12 = bf16[12288]{0} fusion(%all-reduce-done.6), kind=kLoop, calls=%wrapped_slice_computation.12, metadata={scheduling_name="wrapped_slice.12"}
  %wrapped_slice.11 = bf16[12288]{0} fusion(%all-reduce-done.6), kind=kLoop, calls=%wrapped_slice_computation.11, metadata={scheduling_name="wrapped_slice.11"}
  %wrapped_slice.10 = bf16[12288]{0} fusion(%all-reduce-done.6), kind=kLoop, calls=%wrapped_slice_computation.10, metadata={scheduling_name="wrapped_slice.10"}
  %wrapped_slice.9 = bf16[12288]{0} fusion(%all-reduce-done.6), kind=kLoop, calls=%wrapped_slice_computation.9, metadata={scheduling_name="wrapped_slice.9"}
  %bitcast.32129 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32129"}
  %input_reduce_fusion.54 = f32[] fusion(%bitcast.32129), kind=kInput, calls=%fused_reduce.54, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.54"}
  %bitcast.32128 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32128"}
  %input_reduce_fusion.53 = f32[] fusion(%bitcast.32128), kind=kInput, calls=%fused_reduce.53, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.53"}
  %bitcast.32126 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32126"}
  %input_reduce_fusion.40 = f32[] fusion(%bitcast.32126), kind=kInput, calls=%fused_reduce.40, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.40"}
  %bitcast.32127 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32127"}
  %input_reduce_fusion.41 = f32[] fusion(%bitcast.32127), kind=kInput, calls=%fused_reduce.41, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.41"}
  %input_reduce_fusion.68 = f32[] fusion(%all-reduce-done.1), kind=kInput, calls=%fused_reduce.68, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="input_reduce_fusion.68"}
  %bitcast.32133 = f32[1]{0} bitcast(%input_reduce_fusion.54), metadata={scheduling_name="bitcast.32133"}
  %bitcast.32137 = f32[1]{0} bitcast(%input_reduce_fusion.54), metadata={scheduling_name="bitcast.32137"}
  %bitcast.32132 = f32[1]{0} bitcast(%input_reduce_fusion.53), metadata={scheduling_name="bitcast.32132"}
  %bitcast.32136 = f32[1]{0} bitcast(%input_reduce_fusion.53), metadata={scheduling_name="bitcast.32136"}
  %bitcast.32130 = f32[1]{0} bitcast(%input_reduce_fusion.40), metadata={scheduling_name="bitcast.32130"}
  %bitcast.32134 = f32[1]{0} bitcast(%input_reduce_fusion.40), metadata={scheduling_name="bitcast.32134"}
  %bitcast.32131 = f32[1]{0} bitcast(%input_reduce_fusion.41), metadata={scheduling_name="bitcast.32131"}
  %bitcast.32135 = f32[1]{0} bitcast(%input_reduce_fusion.41), metadata={scheduling_name="bitcast.32135"}
  %wrapped_concatenate.3 = f32[8]{0} fusion(%bitcast.32130, %bitcast.32131, %bitcast.32132, %bitcast.32133, %bitcast.32134, /*index=5*/%bitcast.32135, %bitcast.32136, %bitcast.32137), kind=kLoop, calls=%wrapped_concatenate_computation.3, metadata={scheduling_name="wrapped_concatenate.3"}
  %all-reduce-done.5 = f32[32]{0} all-reduce-done(%all-reduce-start.5), metadata={scheduling_name="all-reduce-done.5"}
  %bitcast.27114.0 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} bitcast(%all-to-all-done.14), metadata={scheduling_name="bitcast.27114.0"}
  %collective-permute-start.9 = (bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}, bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}) collective-permute-start(%bitcast.27114.0), channel_id=395, source_target_pairs={{0,0},{2,1},{4,2},{6,3},{1,4},{3,5},{5,6},{7,7},{8,8},{10,9},{12,10},{14,11},{9,12},{11,13},{13,14},{15,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="collective-permute-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.50 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.50, metadata={scheduling_name="wrapped_slice.50"}
  %wrapped_slice.49 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.49, metadata={scheduling_name="wrapped_slice.49"}
  %wrapped_slice.48 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.48, metadata={scheduling_name="wrapped_slice.48"}
  %wrapped_slice.47 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.47, metadata={scheduling_name="wrapped_slice.47"}
  %wrapped_slice.44 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.44, metadata={scheduling_name="wrapped_slice.44"}
  %wrapped_slice.43 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.43, metadata={scheduling_name="wrapped_slice.43"}
  %wrapped_slice.42 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.42, metadata={scheduling_name="wrapped_slice.42"}
  %wrapped_slice.41 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.41, metadata={scheduling_name="wrapped_slice.41"}
  %wrapped_slice.40 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.40, metadata={scheduling_name="wrapped_slice.40"}
  %wrapped_slice.39 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.39, metadata={scheduling_name="wrapped_slice.39"}
  %wrapped_slice.38 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.38, metadata={scheduling_name="wrapped_slice.38"}
  %collective-permute-done.9 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} collective-permute-done(%collective-permute-start.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="collective-permute-done.9"}
  %bitcast.27106.0 = bf16[32768,65536]{0,1} bitcast(%loop_convert_fusion.17), metadata={scheduling_name="bitcast.27106.0"}
  %bitcast.27118.0 = bf16[65536,6144]{1,0} bitcast(%collective-permute-done.9), metadata={scheduling_name="bitcast.27118.0"}
  %custom-call.1192 = (bf16[32768,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.27106.0, %bitcast.27118.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="custom-call.1192"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %wrapped_slice.37 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.37, metadata={scheduling_name="wrapped_slice.37"}
  %get-tuple-element.3833.0 = bf16[6144,32768]{1,0} get-tuple-element(%custom-call.1191), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3833.0"}
  %get-tuple-element.3834.0 = bf16[32768,6144]{0,1} get-tuple-element(%custom-call.1192), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="get-tuple-element.3834.0"}
  %bitcast.32048 = bf16[6144,32768]{1,0} bitcast(%get-tuple-element.3834.0), metadata={scheduling_name="bitcast.32048"}
  %reduce-scatter-start.1 = ((bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0}), (bf16[768,32768]{1,0}, bf16[768,32768]{1,0})) async-start(%bitcast.32048, %get-tuple-element.3833.0), calls=%async_computation.17, metadata={scheduling_name="reduce-scatter-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.34 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.34, metadata={scheduling_name="wrapped_slice.34"}
  %wrapped_slice.33 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.33, metadata={scheduling_name="wrapped_slice.33"}
  %wrapped_slice.32 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.32, metadata={scheduling_name="wrapped_slice.32"}
  %wrapped_slice.31 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.31, metadata={scheduling_name="wrapped_slice.31"}
  %wrapped_slice.28 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.28, metadata={scheduling_name="wrapped_slice.28"}
  %reduce-scatter-done.1 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}) async-done(%reduce-scatter-start.1), metadata={scheduling_name="reduce-scatter-done.1"}
  %get-tuple-element.4396 = bf16[768,32768]{1,0} get-tuple-element(%reduce-scatter-done.1), index=0, metadata={scheduling_name="get-tuple-element.4396"}
  %bitcast.32049 = bf16[32768,768]{0,1} bitcast(%get-tuple-element.4396), metadata={scheduling_name="bitcast.32049"}
  %all-reduce-start.3 = bf16[32768,768]{0,1} all-reduce-start(%bitcast.32049), channel_id=397, replica_groups=[8,2]<=[2,8]T(1,0), use_global_device_ids=true, to_apply=%add.13.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-reduce-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.27 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.27, metadata={scheduling_name="wrapped_slice.27"}
  %wrapped_slice.26 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.26, metadata={scheduling_name="wrapped_slice.26"}
  %wrapped_slice.25 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.25, metadata={scheduling_name="wrapped_slice.25"}
  %wrapped_slice.22 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.22, metadata={scheduling_name="wrapped_slice.22"}
  %wrapped_slice.21 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.21, metadata={scheduling_name="wrapped_slice.21"}
  %all-reduce-done.3 = bf16[32768,768]{0,1} all-reduce-done(%all-reduce-start.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-reduce-done.3"}
  %get-tuple-element.4397 = bf16[768,32768]{1,0} get-tuple-element(%reduce-scatter-done.1), index=1, metadata={scheduling_name="get-tuple-element.4397"}
  %all-reduce-start.2 = bf16[768,32768]{1,0} all-reduce-start(%get-tuple-element.4397), channel_id=134, replica_groups=[8,2]<=[2,8]T(1,0), use_global_device_ids=true, to_apply=%add.1.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-reduce-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.20 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.20, metadata={scheduling_name="wrapped_slice.20"}
  %wrapped_slice.19 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.19, metadata={scheduling_name="wrapped_slice.19"}
  %wrapped_slice.18 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.18, metadata={scheduling_name="wrapped_slice.18"}
  %wrapped_slice.17 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.17, metadata={scheduling_name="wrapped_slice.17"}
  %wrapped_slice.16 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.16, metadata={scheduling_name="wrapped_slice.16"}
  %all-reduce-done.2 = bf16[768,32768]{1,0} all-reduce-done(%all-reduce-start.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-reduce-done.2"}
  %all-reduce-start.7 = f32[8]{0} all-reduce-start(%wrapped_concatenate.3), channel_id=385, replica_groups=[8,2]<=[2,8]T(1,0), use_global_device_ids=true, to_apply=%region_115.4279.clone, metadata={scheduling_name="all-reduce-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.15 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.15, metadata={scheduling_name="wrapped_slice.15"}
  %wrapped_slice.8 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.8, metadata={scheduling_name="wrapped_slice.8"}
  %wrapped_slice.7 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.7, metadata={scheduling_name="wrapped_slice.7"}
  %wrapped_slice.6 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.6, metadata={scheduling_name="wrapped_slice.6"}
  %wrapped_slice.5 = f32[1]{0} fusion(%all-reduce-done.5), kind=kLoop, calls=%wrapped_slice_computation.5, metadata={scheduling_name="wrapped_slice.5"}
  %input_reduce_fusion.35 = f32[4096]{0} fusion(%all-reduce-done.3), kind=kInput, calls=%fused_reduce.35, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="input_reduce_fusion.35"}
  %input_reduce_fusion.98 = f32[] fusion(%input_reduce_fusion.35), kind=kInput, calls=%fused_reduce.98, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.98"}
  %input_reduce_fusion.62 = f32[4096]{0} fusion(%all-reduce-done.2), kind=kInput, calls=%fused_reduce.62, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.28" scheduling_name="input_reduce_fusion.62"}
  %input_reduce_fusion.83 = f32[] fusion(%input_reduce_fusion.62), kind=kInput, calls=%fused_reduce.83, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.83"}
  %all-reduce-done.7 = f32[8]{0} all-reduce-done(%all-reduce-start.7), metadata={scheduling_name="all-reduce-done.7"}
  %wrapped_slice.46 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.46, metadata={scheduling_name="wrapped_slice.46"}
  %bitcast.32050 = f32[1]{0} bitcast(%input_reduce_fusion.98), metadata={scheduling_name="bitcast.32050"}
  %bitcast.32052 = f32[1]{0} bitcast(%input_reduce_fusion.98), metadata={scheduling_name="bitcast.32052"}
  %bitcast.32051 = f32[1]{0} bitcast(%input_reduce_fusion.83), metadata={scheduling_name="bitcast.32051"}
  %bitcast.32053 = f32[1]{0} bitcast(%input_reduce_fusion.83), metadata={scheduling_name="bitcast.32053"}
  %wrapped_concatenate = f32[4]{0} fusion(%bitcast.32050, %bitcast.32051, %bitcast.32052, %bitcast.32053), kind=kLoop, calls=%wrapped_concatenate_computation, metadata={scheduling_name="wrapped_concatenate"}
  %all-reduce-start.4 = f32[4]{0} all-reduce-start(%wrapped_concatenate), channel_id=398, replica_groups=[2,8]<=[16], use_global_device_ids=true, to_apply=%region_120.4324.clone, metadata={scheduling_name="all-reduce-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.45 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.45, metadata={scheduling_name="wrapped_slice.45"}
  %wrapped_slice.24 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.24, metadata={scheduling_name="wrapped_slice.24"}
  %wrapped_slice.23 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.23, metadata={scheduling_name="wrapped_slice.23"}
  %wrapped_slice.14 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.14, metadata={scheduling_name="wrapped_slice.14"}
  %wrapped_slice.13 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.13, metadata={scheduling_name="wrapped_slice.13"}
  %all-reduce-done.4 = f32[4]{0} all-reduce-done(%all-reduce-start.4), metadata={scheduling_name="all-reduce-done.4"}
  %wrapped_slice.29 = f32[1]{0} fusion(%all-reduce-done.4), kind=kLoop, calls=%wrapped_slice_computation.29, metadata={scheduling_name="wrapped_slice.29"}
  %wrapped_slice.4 = f32[1]{0} fusion(%all-reduce-done.4), kind=kLoop, calls=%wrapped_slice_computation.4, metadata={scheduling_name="wrapped_slice.4"}
  %wrapped_slice.36 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.36, metadata={scheduling_name="wrapped_slice.36"}
  %bitcast.32141 = f32[] bitcast(%wrapped_slice.24), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32141"}
  %bitcast.32140 = f32[] bitcast(%wrapped_slice.23), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32140"}
  %bitcast.32139 = f32[] bitcast(%wrapped_slice.14), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32139"}
  %bitcast.32138 = f32[] bitcast(%wrapped_slice.13), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32138"}
  %bitcast.32105 = f32[] bitcast(%wrapped_slice.28), metadata={scheduling_name="bitcast.32105"}
  %bitcast.32104 = f32[] bitcast(%wrapped_slice.27), metadata={scheduling_name="bitcast.32104"}
  %bitcast.32103 = f32[] bitcast(%wrapped_slice.26), metadata={scheduling_name="bitcast.32103"}
  %bitcast.32102 = f32[] bitcast(%wrapped_slice.25), metadata={scheduling_name="bitcast.32102"}
  %bitcast.32101 = f32[] bitcast(%wrapped_slice.22), metadata={scheduling_name="bitcast.32101"}
  %bitcast.32100 = f32[] bitcast(%wrapped_slice.21), metadata={scheduling_name="bitcast.32100"}
  %bitcast.32099 = f32[] bitcast(%wrapped_slice.20), metadata={scheduling_name="bitcast.32099"}
  %bitcast.32098 = f32[] bitcast(%wrapped_slice.19), metadata={scheduling_name="bitcast.32098"}
  %bitcast.32097 = f32[] bitcast(%wrapped_slice.18), metadata={scheduling_name="bitcast.32097"}
  %bitcast.32096 = f32[] bitcast(%wrapped_slice.17), metadata={scheduling_name="bitcast.32096"}
  %bitcast.32095 = f32[] bitcast(%wrapped_slice.16), metadata={scheduling_name="bitcast.32095"}
  %bitcast.32094 = f32[] bitcast(%wrapped_slice.15), metadata={scheduling_name="bitcast.32094"}
  %bitcast.32093 = f32[] bitcast(%wrapped_slice.8), metadata={scheduling_name="bitcast.32093"}
  %bitcast.32092 = f32[] bitcast(%wrapped_slice.7), metadata={scheduling_name="bitcast.32092"}
  %bitcast.32091 = f32[] bitcast(%wrapped_slice.6), metadata={scheduling_name="bitcast.32091"}
  %bitcast.32090 = f32[] bitcast(%wrapped_slice.5), metadata={scheduling_name="bitcast.32090"}
  %bitcast.32055 = f32[] bitcast(%wrapped_slice.29), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32055"}
  %bitcast.32054 = f32[] bitcast(%wrapped_slice.4), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32054"}
  %loop_compare_sqrt_fusion = (pred[], f32[]) fusion(%bitcast.32054, %bitcast.32090, %bitcast.32091, %bitcast.32092, %bitcast.32093, /*index=5*/%bitcast.32138, %bitcast.32139, %bitcast.32094, %bitcast.32095, %bitcast.32096, /*index=10*/%bitcast.32097, %bitcast.32098, %bitcast.32099, %bitcast.32100, %bitcast.32101, /*index=15*/%bitcast.32140, %bitcast.32141, %bitcast.32102, %bitcast.32103, %bitcast.32104, /*index=20*/%bitcast.32105, %input_reduce_fusion.68, %bitcast.32055), kind=kLoop, calls=%fused_compare_sqrt, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="loop_compare_sqrt_fusion"}
  %wrapped_slice.35 = f32[1]{0} fusion(%all-reduce-done.7), kind=kLoop, calls=%wrapped_slice_computation.35, metadata={scheduling_name="wrapped_slice.35"}
  %get-tuple-element.4228 = f32[] get-tuple-element(%loop_compare_sqrt_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="get-tuple-element.4228"}
  %get-tuple-element.4227 = pred[] get-tuple-element(%loop_compare_sqrt_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="get-tuple-element.4227"}
  %loop_select_fusion.6 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32128, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.6, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.6"}
  %input_transpose_fusion.6 = bf16[2,1,48,128,768]{4,3,2,1,0} fusion(%get-tuple-element.4228, %get-tuple-element.1380.0, %get-tuple-element.4227), kind=kInput, calls=%fused_transpose.20, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_transpose_fusion.6" scheduling_name="input_transpose_fusion.6"}
  %loop_select_fusion.7 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32129, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.7, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.7"}
  %loop_select_fusion.3 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32126, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.3, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.3"}
  %loop_select_fusion.4 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32127, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.4, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.4"}
  %loop_select_fusion.8 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.1363.0, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.8, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.5" scheduling_name="loop_select_fusion.8"}
  %input_select_transpose_fusion = (bf16[32768,768]{1,0}, bf16[32768,768]{1,0}, bf16[768,32768]{1,0}) fusion(%copy.935, %wrapped_transpose.1, %get-tuple-element.4228, %all-reduce-done.3, %get-tuple-element.4227), kind=kInput, calls=%fused_select_transpose, metadata={scheduling_name="input_select_transpose_fusion"}
  %input_transpose_fusion.7 = bf16[2,1,48,128,768]{4,3,2,1,0} fusion(%get-tuple-element.4228, %get-tuple-element.1370.0, %get-tuple-element.4227), kind=kInput, calls=%fused_transpose.21, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_transpose_fusion.6" scheduling_name="input_transpose_fusion.7"}
  %get-tuple-element.4126 = bf16[768,32768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=2, metadata={scheduling_name="get-tuple-element.4126"}
  %input_reduce_fusion.28 = f32[4096]{0} fusion(%get-tuple-element.4126), kind=kInput, calls=%fused_reduce.28, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.28" scheduling_name="input_reduce_fusion.28"}
  %get-tuple-element.4254 = f32[] get-tuple-element(%loop_select_subtract_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4254"}
  %input_transpose_fusion.10 = f32[768,32768]{1,0} fusion(%wrapped_transpose, %loop_multiply_fusion.7, %loop_subtract_fusion, %get-tuple-element.4254, %wrapped_transpose.1, /*index=5*/%get-tuple-element.4126, %copy.935), kind=kInput, calls=%fused_transpose.24, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="input_transpose_fusion.10"}
  %input_add_convert_reduce_fusion.7 = (bf16[6144]{0}, bf16[6144]{0}, f32[6144]{0}, f32[]) fusion(%param.33, %all-reduce-done.1, %get-tuple-element.4228, %get-tuple-element.4227, %param.35, /*index=5*/%loop_subtract_fusion, %get-tuple-element.4254, %loop_multiply_fusion.7, %param.5), kind=kInput, calls=%fused_add_convert_reduce.7, metadata={scheduling_name="input_add_convert_reduce_fusion.7"}
  %input_add_convert_reduce_fusion.6 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) fusion(%param.16, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.38, /*index=5*/%loop_select_fusion.8, %param.39), kind=kInput, calls=%fused_add_convert_reduce.6, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.3" scheduling_name="input_add_convert_reduce_fusion.6"}
  %get-tuple-element.4244 = f32[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=2, metadata={scheduling_name="get-tuple-element.4244"}
  %input_convert_reduce_fusion.21 = (f32[], bf16[6144]{0}) fusion(%get-tuple-element.4244), kind=kInput, calls=%fused_convert_reduce.21, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="input_convert_reduce_fusion.21"}
  %get-tuple-element.4217 = f32[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4217"}
  %input_convert_reduce_fusion.7 = (f32[], bf16[2,1,768,8]{3,2,1,0}) fusion(%get-tuple-element.4217), kind=kInput, calls=%fused_convert_reduce.7, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.4" scheduling_name="input_convert_reduce_fusion.7"}
  %input_add_convert_reduce_fusion.2 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.25, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.66, /*index=5*/%loop_select_fusion.4, %param.67), kind=kInput, calls=%fused_add_convert_reduce.2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.2"}
  %input_add_convert_reduce_fusion.1 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.20, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.68, /*index=5*/%loop_select_fusion.3, %param.69), kind=kInput, calls=%fused_add_convert_reduce.1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.1"}
  %get-tuple-element.4152 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4152"}
  %input_convert_reduce_fusion.3 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4152), kind=kInput, calls=%fused_convert_reduce.3, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.3"}
  %get-tuple-element.4146 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4146"}
  %input_convert_reduce_fusion.2 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4146), kind=kInput, calls=%fused_convert_reduce.2, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.2"}
  %input_add_convert_reduce_fusion.5 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.15, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.46, /*index=5*/%loop_select_fusion.7, %param.47), kind=kInput, calls=%fused_add_convert_reduce.5, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.5"}
  %input_add_convert_reduce_fusion.4 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.9, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.48, /*index=5*/%loop_select_fusion.6, %param.49), kind=kInput, calls=%fused_add_convert_reduce.4, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.4"}
  %get-tuple-element.4199 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4199"}
  %input_convert_reduce_fusion.6 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4199), kind=kInput, calls=%fused_convert_reduce.6, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.6"}
  %get-tuple-element.4193 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4193"}
  %input_convert_reduce_fusion.5 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4193), kind=kInput, calls=%fused_convert_reduce.5, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.5"}
  %get-tuple-element.4155 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.2), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4155"}
  %bitcast.32225 = f32[1]{0} bitcast(%get-tuple-element.4155), metadata={scheduling_name="bitcast.32225"}
  %get-tuple-element.4150 = f32[] get-tuple-element(%input_convert_reduce_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4150"}
  %bitcast.32221 = f32[1]{0} bitcast(%get-tuple-element.4150), metadata={scheduling_name="bitcast.32221"}
  %get-tuple-element.4149 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.1), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4149"}
  %bitcast.32224 = f32[1]{0} bitcast(%get-tuple-element.4149), metadata={scheduling_name="bitcast.32224"}
  %get-tuple-element.4144 = f32[] get-tuple-element(%input_convert_reduce_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4144"}
  %bitcast.32220 = f32[1]{0} bitcast(%get-tuple-element.4144), metadata={scheduling_name="bitcast.32220"}
  %get-tuple-element.4202 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.5), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4202"}
  %bitcast.32227 = f32[1]{0} bitcast(%get-tuple-element.4202), metadata={scheduling_name="bitcast.32227"}
  %get-tuple-element.4197 = f32[] get-tuple-element(%input_convert_reduce_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4197"}
  %bitcast.32223 = f32[1]{0} bitcast(%get-tuple-element.4197), metadata={scheduling_name="bitcast.32223"}
  %get-tuple-element.4196 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.4), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4196"}
  %bitcast.32226 = f32[1]{0} bitcast(%get-tuple-element.4196), metadata={scheduling_name="bitcast.32226"}
  %get-tuple-element.4191 = f32[] get-tuple-element(%input_convert_reduce_fusion.5), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4191"}
  %bitcast.32222 = f32[1]{0} bitcast(%get-tuple-element.4191), metadata={scheduling_name="bitcast.32222"}
  %wrapped_concatenate.6 = f32[8]{0} fusion(%bitcast.32220, %bitcast.32221, %bitcast.32222, %bitcast.32223, %bitcast.32224, /*index=5*/%bitcast.32225, %bitcast.32226, %bitcast.32227), kind=kLoop, calls=%wrapped_concatenate_computation.6, metadata={scheduling_name="wrapped_concatenate.6"}
  %all-reduce-start.10 = f32[8]{0} all-reduce-start(%wrapped_concatenate.6), channel_id=466, replica_groups=[8,2]<=[2,8]T(1,0), use_global_device_ids=true, to_apply=%region_184.5554.clone, metadata={scheduling_name="all-reduce-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_select_fusion.5 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.1373.0, %get-tuple-element.4228, %get-tuple-element.4227), kind=kLoop, calls=%fused_select.5, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.5" scheduling_name="loop_select_fusion.5"}
  %input_add_convert_reduce_fusion.3 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) fusion(%param.26, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.58, /*index=5*/%loop_select_fusion.5, %param.59), kind=kInput, calls=%fused_add_convert_reduce.3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.3" scheduling_name="input_add_convert_reduce_fusion.3"}
  %input_convert_reduce_fusion.24 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.22, %loop_subtract_fusion, %param.71, %get-tuple-element.4254, %param.70, /*index=5*/%get-tuple-element.1379.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.24, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.24"}
  %get-tuple-element.4170 = f32[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4170"}
  %input_convert_reduce_fusion.4 = (f32[], bf16[2,1,768,8]{3,2,1,0}) fusion(%get-tuple-element.4170), kind=kInput, calls=%fused_convert_reduce.4, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.4" scheduling_name="input_convert_reduce_fusion.4"}
  %get-tuple-element.4239 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.24), index=4, metadata={scheduling_name="get-tuple-element.4239"}
  %input_reduce_fusion.110 = f32[] fusion(%get-tuple-element.4239), kind=kInput, calls=%fused_reduce.110, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.110"}
  %input_convert_reduce_fusion.23 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.13, %loop_subtract_fusion, %param.57, %get-tuple-element.4254, %param.56, /*index=5*/%get-tuple-element.1372.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.23, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.23"}
  %get-tuple-element.4142 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.24), index=2, metadata={scheduling_name="get-tuple-element.4142"}
  %input_reduce_fusion.80 = f32[] fusion(%get-tuple-element.4142), kind=kInput, calls=%fused_reduce.80, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.80"}
  %get-tuple-element.4235 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.23), index=4, metadata={scheduling_name="get-tuple-element.4235"}
  %input_reduce_fusion.106 = f32[] fusion(%get-tuple-element.4235), kind=kInput, calls=%fused_reduce.106, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.106"}
  %input_convert_reduce_fusion.25 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.23, %loop_subtract_fusion, %param.77, %get-tuple-element.4254, %param.76, /*index=5*/%get-tuple-element.1382.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.25, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.25"}
  %get-tuple-element.4176 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.23), index=2, metadata={scheduling_name="get-tuple-element.4176"}
  %input_reduce_fusion.77 = f32[] fusion(%get-tuple-element.4176), kind=kInput, calls=%fused_reduce.77, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.77"}
  %get-tuple-element.4241 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.25), index=4, metadata={scheduling_name="get-tuple-element.4241"}
  %input_reduce_fusion.113 = f32[] fusion(%get-tuple-element.4241), kind=kInput, calls=%fused_reduce.113, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.113"}
  %input_convert_reduce_fusion.22 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.12, %loop_subtract_fusion, %param.51, %get-tuple-element.4254, %param.50, /*index=5*/%get-tuple-element.1369.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.22, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.22"}
  %get-tuple-element.4129 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.25), index=2, metadata={scheduling_name="get-tuple-element.4129"}
  %input_reduce_fusion.117 = f32[] fusion(%get-tuple-element.4129), kind=kInput, calls=%fused_reduce.117, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.117"}
  %get-tuple-element.4233 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.22), index=4, metadata={scheduling_name="get-tuple-element.4233"}
  %input_reduce_fusion.103 = f32[] fusion(%get-tuple-element.4233), kind=kInput, calls=%fused_reduce.103, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.103"}
  %input_convert_reduce_fusion.17 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.14, %loop_subtract_fusion, %param.53, %input_transpose_fusion.7, %get-tuple-element.4254, /*index=5*/%param.52, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.17, metadata={deduplicated_name="input_convert_reduce_fusion.17" scheduling_name="input_convert_reduce_fusion.17"}
  %get-tuple-element.4189 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.22), index=2, metadata={scheduling_name="get-tuple-element.4189"}
  %input_reduce_fusion.73 = f32[] fusion(%get-tuple-element.4189), kind=kInput, calls=%fused_reduce.73, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.73"}
  %get-tuple-element.4186 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.17), index=4, metadata={scheduling_name="get-tuple-element.4186"}
  %input_reduce_fusion.104 = f32[] fusion(%get-tuple-element.4186), kind=kInput, calls=%fused_reduce.104, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.104"}
  %input_convert_reduce_fusion.18 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.24, %loop_subtract_fusion, %param.73, %input_transpose_fusion.6, %get-tuple-element.4254, /*index=5*/%param.72, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.18, metadata={deduplicated_name="input_convert_reduce_fusion.17" scheduling_name="input_convert_reduce_fusion.18"}
  %get-tuple-element.4184 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.17), index=2, metadata={scheduling_name="get-tuple-element.4184"}
  %input_reduce_fusion.79 = f32[] fusion(%get-tuple-element.4184), kind=kInput, calls=%fused_reduce.79, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.79"}
  %get-tuple-element.4139 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.18), index=4, metadata={scheduling_name="get-tuple-element.4139"}
  %input_reduce_fusion.111 = f32[] fusion(%get-tuple-element.4139), kind=kInput, calls=%fused_reduce.111, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.111"}
  %input_convert_reduce_fusion.19 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.10, %loop_subtract_fusion, %param.55, %get-tuple-element.4254, %param.54, /*index=5*/%get-tuple-element.1371.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.19, metadata={deduplicated_name="input_convert_reduce_fusion.19" scheduling_name="input_convert_reduce_fusion.19"}
  %get-tuple-element.4137 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.18), index=2, metadata={scheduling_name="get-tuple-element.4137"}
  %input_reduce_fusion.115 = f32[] fusion(%get-tuple-element.4137), kind=kInput, calls=%fused_reduce.115, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.115"}
  %get-tuple-element.4234 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.19), index=4, metadata={scheduling_name="get-tuple-element.4234"}
  %input_reduce_fusion.105 = f32[] fusion(%get-tuple-element.4234), kind=kInput, calls=%fused_reduce.105, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.105"}
  %input_convert_reduce_fusion.20 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.21, %loop_subtract_fusion, %param.75, %get-tuple-element.4254, %param.74, /*index=5*/%get-tuple-element.1381.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.20, metadata={deduplicated_name="input_convert_reduce_fusion.19" scheduling_name="input_convert_reduce_fusion.20"}
  %get-tuple-element.4180 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.19), index=2, metadata={scheduling_name="get-tuple-element.4180"}
  %input_reduce_fusion.78 = f32[] fusion(%get-tuple-element.4180), kind=kInput, calls=%fused_reduce.78, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.78"}
  %get-tuple-element.4240 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.20), index=4, metadata={scheduling_name="get-tuple-element.4240"}
  %input_reduce_fusion.112 = f32[] fusion(%get-tuple-element.4240), kind=kInput, calls=%fused_reduce.112, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.112"}
  %get-tuple-element.4133 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.4133"}
  %input_reduce_fusion.82 = f32[] fusion(%get-tuple-element.4133), kind=kInput, calls=%fused_reduce.82, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.82"}
  %input_reduce_fusion.20 = f32[4096]{0} fusion(%input_transpose_fusion.10), kind=kInput, calls=%fused_reduce.20, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="input_reduce_fusion.20"}
  %input_reduce_fusion.118 = f32[] fusion(%input_reduce_fusion.20), kind=kInput, calls=%fused_reduce.118, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.118"}
  %input_convert_reduce_fusion.16 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}, f32[4096]{0}, bf16[768,32768]{1,0}, f32[4096]{0}) fusion(%param.31, %loop_subtract_fusion, %param.37, %get-tuple-element.4254, %param.36, /*index=5*/%all-reduce-done.2, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.16, metadata={scheduling_name="input_convert_reduce_fusion.16"}
  %input_reduce_fusion.114 = f32[] fusion(%input_reduce_fusion.28), kind=kInput, calls=%fused_reduce.114, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.114"}
  %get-tuple-element.4229 = f32[4096]{0} get-tuple-element(%input_convert_reduce_fusion.16), index=4, metadata={scheduling_name="get-tuple-element.4229"}
  %input_reduce_fusion.99 = f32[] fusion(%get-tuple-element.4229), kind=kInput, calls=%fused_reduce.99, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.99"}
  %input_convert_reduce_fusion.10 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.17, %loop_subtract_fusion, %param.41, %get-tuple-element.4254, %param.40, /*index=5*/%get-tuple-element.1364.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.10, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.10"}
  %get-tuple-element.4223 = f32[4096]{0} get-tuple-element(%input_convert_reduce_fusion.16), index=2, metadata={scheduling_name="get-tuple-element.4223"}
  %input_reduce_fusion.120 = f32[] fusion(%get-tuple-element.4223), kind=kInput, calls=%fused_reduce.120, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.120"}
  %get-tuple-element.4213 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.10), index=2, metadata={scheduling_name="get-tuple-element.4213"}
  %input_reduce_fusion.26 = f32[128]{0} fusion(%get-tuple-element.4213), kind=kInput, calls=%fused_reduce.26, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.26"}
  %input_reduce_fusion.121 = f32[] fusion(%input_reduce_fusion.26), kind=kInput, calls=%fused_reduce.121, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.121"}
  %get-tuple-element.4230 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.10), index=4, metadata={scheduling_name="get-tuple-element.4230"}
  %input_reduce_fusion.34 = f32[128]{0} fusion(%get-tuple-element.4230), kind=kInput, calls=%fused_reduce.34, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.34"}
  %input_convert_reduce_fusion.11 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.18, %loop_subtract_fusion, %param.43, %get-tuple-element.4254, %param.42, /*index=5*/%get-tuple-element.1365.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.11, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.11"}
  %input_reduce_fusion.100 = f32[] fusion(%input_reduce_fusion.34), kind=kInput, calls=%fused_reduce.100, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.100"}
  %get-tuple-element.4209 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.11), index=2, metadata={scheduling_name="get-tuple-element.4209"}
  %input_reduce_fusion.25 = f32[128]{0} fusion(%get-tuple-element.4209), kind=kInput, calls=%fused_reduce.25, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.25"}
  %input_reduce_fusion.72 = f32[] fusion(%input_reduce_fusion.25), kind=kInput, calls=%fused_reduce.72, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.72"}
  %get-tuple-element.4231 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.11), index=4, metadata={scheduling_name="get-tuple-element.4231"}
  %input_reduce_fusion.33 = f32[128]{0} fusion(%get-tuple-element.4231), kind=kInput, calls=%fused_reduce.33, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.33"}
  %input_convert_reduce_fusion.13 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.27, %loop_subtract_fusion, %param.61, %get-tuple-element.4254, %param.60, /*index=5*/%get-tuple-element.1374.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.13, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.13"}
  %input_reduce_fusion.101 = f32[] fusion(%input_reduce_fusion.33), kind=kInput, calls=%fused_reduce.101, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.101"}
  %get-tuple-element.4166 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.13), index=2, metadata={scheduling_name="get-tuple-element.4166"}
  %input_reduce_fusion.23 = f32[128]{0} fusion(%get-tuple-element.4166), kind=kInput, calls=%fused_reduce.23, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.23"}
  %input_reduce_fusion.76 = f32[] fusion(%input_reduce_fusion.23), kind=kInput, calls=%fused_reduce.76, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.76"}
  %get-tuple-element.4236 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.13), index=4, metadata={scheduling_name="get-tuple-element.4236"}
  %input_reduce_fusion.31 = f32[128]{0} fusion(%get-tuple-element.4236), kind=kInput, calls=%fused_reduce.31, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.31"}
  %input_convert_reduce_fusion.12 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.19, %loop_subtract_fusion, %param.45, %get-tuple-element.4254, %param.44, /*index=5*/%get-tuple-element.1366.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.12, metadata={deduplicated_name="input_convert_reduce_fusion.12" scheduling_name="input_convert_reduce_fusion.12"}
  %input_reduce_fusion.107 = f32[] fusion(%input_reduce_fusion.31), kind=kInput, calls=%fused_reduce.107, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.107"}
  %get-tuple-element.4205 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.12), index=2, metadata={scheduling_name="get-tuple-element.4205"}
  %input_reduce_fusion.24 = f32[128]{0} fusion(%get-tuple-element.4205), kind=kInput, calls=%fused_reduce.24, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.24"}
  %input_reduce_fusion.71 = f32[] fusion(%input_reduce_fusion.24), kind=kInput, calls=%fused_reduce.71, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.71"}
  %get-tuple-element.4232 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.12), index=4, metadata={scheduling_name="get-tuple-element.4232"}
  %input_reduce_fusion.32 = f32[128]{0} fusion(%get-tuple-element.4232), kind=kInput, calls=%fused_reduce.32, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.32"}
  %input_convert_reduce_fusion.15 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.29, %loop_subtract_fusion, %param.65, %get-tuple-element.4254, %param.64, /*index=5*/%get-tuple-element.1376.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.15, metadata={deduplicated_name="input_convert_reduce_fusion.12" scheduling_name="input_convert_reduce_fusion.15"}
  %input_reduce_fusion.102 = f32[] fusion(%input_reduce_fusion.32), kind=kInput, calls=%fused_reduce.102, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.102"}
  %get-tuple-element.4158 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.15), index=2, metadata={scheduling_name="get-tuple-element.4158"}
  %input_reduce_fusion.21 = f32[128]{0} fusion(%get-tuple-element.4158), kind=kInput, calls=%fused_reduce.21, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.21"}
  %input_reduce_fusion.75 = f32[] fusion(%input_reduce_fusion.21), kind=kInput, calls=%fused_reduce.75, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.75"}
  %get-tuple-element.4238 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.15), index=4, metadata={scheduling_name="get-tuple-element.4238"}
  %input_reduce_fusion.29 = f32[128]{0} fusion(%get-tuple-element.4238), kind=kInput, calls=%fused_reduce.29, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.29"}
  %input_convert_reduce_fusion.14 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.28, %loop_subtract_fusion, %param.63, %get-tuple-element.4254, %param.62, /*index=5*/%get-tuple-element.1375.0, %get-tuple-element.4228, %get-tuple-element.4227, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.14, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.14"}
  %input_reduce_fusion.109 = f32[] fusion(%input_reduce_fusion.29), kind=kInput, calls=%fused_reduce.109, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.109"}
  %get-tuple-element.4162 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.14), index=2, metadata={scheduling_name="get-tuple-element.4162"}
  %input_reduce_fusion.22 = f32[128]{0} fusion(%get-tuple-element.4162), kind=kInput, calls=%fused_reduce.22, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.22"}
  %input_reduce_fusion.74 = f32[] fusion(%input_reduce_fusion.22), kind=kInput, calls=%fused_reduce.74, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.74"}
  %bitcast.32146 = f32[1]{0} bitcast(%input_reduce_fusion.118), metadata={scheduling_name="bitcast.32146"}
  %bitcast.32148 = f32[1]{0} bitcast(%input_reduce_fusion.114), metadata={scheduling_name="bitcast.32148"}
  %bitcast.32149 = f32[1]{0} bitcast(%input_reduce_fusion.99), metadata={scheduling_name="bitcast.32149"}
  %bitcast.32147 = f32[1]{0} bitcast(%input_reduce_fusion.120), metadata={scheduling_name="bitcast.32147"}
  %wrapped_concatenate.4 = f32[4]{0} fusion(%bitcast.32146, %bitcast.32147, %bitcast.32148, %bitcast.32149), kind=kLoop, calls=%wrapped_concatenate_computation.4, metadata={scheduling_name="wrapped_concatenate.4"}
  %get-tuple-element.4237 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.14), index=4, metadata={scheduling_name="get-tuple-element.4237"}
  %input_reduce_fusion.30 = f32[128]{0} fusion(%get-tuple-element.4237), kind=kInput, calls=%fused_reduce.30, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.30"}
  %input_reduce_fusion.108 = f32[] fusion(%input_reduce_fusion.30), kind=kInput, calls=%fused_reduce.108, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.108"}
  %bitcast.32186 = f32[1]{0} bitcast(%input_reduce_fusion.119), metadata={scheduling_name="bitcast.32186"}
  %get-tuple-element.4220 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.6), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4220"}
  %bitcast.32185 = f32[1]{0} bitcast(%get-tuple-element.4220), metadata={scheduling_name="bitcast.32185"}
  %get-tuple-element.4215 = f32[] get-tuple-element(%input_convert_reduce_fusion.7), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4215"}
  %bitcast.32169 = f32[1]{0} bitcast(%get-tuple-element.4215), metadata={scheduling_name="bitcast.32169"}
  %get-tuple-element.4173 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.3), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4173"}
  %bitcast.32177 = f32[1]{0} bitcast(%get-tuple-element.4173), metadata={scheduling_name="bitcast.32177"}
  %get-tuple-element.4168 = f32[] get-tuple-element(%input_convert_reduce_fusion.4), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4168"}
  %bitcast.32161 = f32[1]{0} bitcast(%get-tuple-element.4168), metadata={scheduling_name="bitcast.32161"}
  %bitcast.32173 = f32[1]{0} bitcast(%input_reduce_fusion.110), metadata={scheduling_name="bitcast.32173"}
  %bitcast.32157 = f32[1]{0} bitcast(%input_reduce_fusion.80), metadata={scheduling_name="bitcast.32157"}
  %bitcast.32178 = f32[1]{0} bitcast(%input_reduce_fusion.106), metadata={scheduling_name="bitcast.32178"}
  %bitcast.32162 = f32[1]{0} bitcast(%input_reduce_fusion.77), metadata={scheduling_name="bitcast.32162"}
  %bitcast.32170 = f32[1]{0} bitcast(%input_reduce_fusion.113), metadata={scheduling_name="bitcast.32170"}
  %bitcast.32154 = f32[1]{0} bitcast(%input_reduce_fusion.117), metadata={scheduling_name="bitcast.32154"}
  %bitcast.32181 = f32[1]{0} bitcast(%input_reduce_fusion.103), metadata={scheduling_name="bitcast.32181"}
  %bitcast.32165 = f32[1]{0} bitcast(%input_reduce_fusion.73), metadata={scheduling_name="bitcast.32165"}
  %bitcast.32180 = f32[1]{0} bitcast(%input_reduce_fusion.104), metadata={scheduling_name="bitcast.32180"}
  %bitcast.32164 = f32[1]{0} bitcast(%input_reduce_fusion.79), metadata={scheduling_name="bitcast.32164"}
  %bitcast.32172 = f32[1]{0} bitcast(%input_reduce_fusion.111), metadata={scheduling_name="bitcast.32172"}
  %bitcast.32156 = f32[1]{0} bitcast(%input_reduce_fusion.115), metadata={scheduling_name="bitcast.32156"}
  %bitcast.32179 = f32[1]{0} bitcast(%input_reduce_fusion.105), metadata={scheduling_name="bitcast.32179"}
  %bitcast.32163 = f32[1]{0} bitcast(%input_reduce_fusion.78), metadata={scheduling_name="bitcast.32163"}
  %bitcast.32171 = f32[1]{0} bitcast(%input_reduce_fusion.112), metadata={scheduling_name="bitcast.32171"}
  %bitcast.32155 = f32[1]{0} bitcast(%input_reduce_fusion.82), metadata={scheduling_name="bitcast.32155"}
  %bitcast.32168 = f32[1]{0} bitcast(%input_reduce_fusion.121), metadata={scheduling_name="bitcast.32168"}
  %bitcast.32184 = f32[1]{0} bitcast(%input_reduce_fusion.100), metadata={scheduling_name="bitcast.32184"}
  %bitcast.32167 = f32[1]{0} bitcast(%input_reduce_fusion.72), metadata={scheduling_name="bitcast.32167"}
  %bitcast.32183 = f32[1]{0} bitcast(%input_reduce_fusion.101), metadata={scheduling_name="bitcast.32183"}
  %bitcast.32160 = f32[1]{0} bitcast(%input_reduce_fusion.76), metadata={scheduling_name="bitcast.32160"}
  %bitcast.32176 = f32[1]{0} bitcast(%input_reduce_fusion.107), metadata={scheduling_name="bitcast.32176"}
  %bitcast.32166 = f32[1]{0} bitcast(%input_reduce_fusion.71), metadata={scheduling_name="bitcast.32166"}
  %bitcast.32182 = f32[1]{0} bitcast(%input_reduce_fusion.102), metadata={scheduling_name="bitcast.32182"}
  %bitcast.32158 = f32[1]{0} bitcast(%input_reduce_fusion.75), metadata={scheduling_name="bitcast.32158"}
  %bitcast.32174 = f32[1]{0} bitcast(%input_reduce_fusion.109), metadata={scheduling_name="bitcast.32174"}
  %bitcast.32159 = f32[1]{0} bitcast(%input_reduce_fusion.74), metadata={scheduling_name="bitcast.32159"}
  %bitcast.32175 = f32[1]{0} bitcast(%input_reduce_fusion.108), metadata={scheduling_name="bitcast.32175"}
  %wrapped_concatenate.5 = f32[33]{0} fusion(%bitcast.32154, %bitcast.32155, %bitcast.32156, %bitcast.32157, %bitcast.32158, /*index=5*/%bitcast.32159, %bitcast.32160, %bitcast.32161, %bitcast.32162, %bitcast.32163, /*index=10*/%bitcast.32164, %bitcast.32165, %bitcast.32166, %bitcast.32167, %bitcast.32168, /*index=15*/%bitcast.32169, %bitcast.32170, %bitcast.32171, %bitcast.32172, %bitcast.32173, /*index=20*/%bitcast.32174, %bitcast.32175, %bitcast.32176, %bitcast.32177, %bitcast.32178, /*index=25*/%bitcast.32179, %bitcast.32180, %bitcast.32181, %bitcast.32182, %bitcast.32183, /*index=30*/%bitcast.32184, %bitcast.32185, %bitcast.32186), kind=kLoop, calls=%wrapped_concatenate_computation.5, metadata={scheduling_name="wrapped_concatenate.5"}
  %wrapped_slice.51 = f32[1]{0} fusion(%all-reduce-done.4), kind=kLoop, calls=%wrapped_slice_computation.51, metadata={scheduling_name="wrapped_slice.51"}
  %wrapped_slice.30 = f32[1]{0} fusion(%all-reduce-done.4), kind=kLoop, calls=%wrapped_slice_computation.30, metadata={scheduling_name="wrapped_slice.30"}
  %all-reduce-done.10 = f32[8]{0} all-reduce-done(%all-reduce-start.10), metadata={scheduling_name="all-reduce-done.10"}
  %all-reduce-start.8 = f32[4]{0} all-reduce-start(%wrapped_concatenate.4), channel_id=475, replica_groups=[2,8]<=[16], use_global_device_ids=true, to_apply=%region_189.5599.clone, metadata={scheduling_name="all-reduce-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.90 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.90, metadata={scheduling_name="wrapped_slice.90"}
  %wrapped_slice.89 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.89, metadata={scheduling_name="wrapped_slice.89"}
  %wrapped_slice.80 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.80, metadata={scheduling_name="wrapped_slice.80"}
  %wrapped_slice.79 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.79, metadata={scheduling_name="wrapped_slice.79"}
  %wrapped_slice.68 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.68, metadata={scheduling_name="wrapped_slice.68"}
  %wrapped_slice.67 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.67, metadata={scheduling_name="wrapped_slice.67"}
  %wrapped_slice.58 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.58, metadata={scheduling_name="wrapped_slice.58"}
  %all-reduce-done.8 = f32[4]{0} all-reduce-done(%all-reduce-start.8), metadata={scheduling_name="all-reduce-done.8"}
  %all-reduce-start.9 = f32[33]{0} all-reduce-start(%wrapped_concatenate.5), channel_id=561, replica_groups={{0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}}, use_global_device_ids=true, to_apply=%region_188.5590.clone, metadata={scheduling_name="all-reduce-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.57 = f32[1]{0} fusion(%all-reduce-done.10), kind=kLoop, calls=%wrapped_slice_computation.57, metadata={scheduling_name="wrapped_slice.57"}
  %wrapped_slice.95 = f32[1]{0} fusion(%all-reduce-done.8), kind=kLoop, calls=%wrapped_slice_computation.95, metadata={scheduling_name="wrapped_slice.95"}
  %wrapped_slice.74 = f32[1]{0} fusion(%all-reduce-done.8), kind=kLoop, calls=%wrapped_slice_computation.74, metadata={scheduling_name="wrapped_slice.74"}
  %wrapped_slice.73 = f32[1]{0} fusion(%all-reduce-done.8), kind=kLoop, calls=%wrapped_slice_computation.73, metadata={scheduling_name="wrapped_slice.73"}
  %wrapped_slice.52 = f32[1]{0} fusion(%all-reduce-done.8), kind=kLoop, calls=%wrapped_slice_computation.52, metadata={scheduling_name="wrapped_slice.52"}
  %all-reduce-done.9 = f32[33]{0} all-reduce-done(%all-reduce-start.9), metadata={scheduling_name="all-reduce-done.9"}
  %wrapped_slice.94 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.94, metadata={scheduling_name="wrapped_slice.94"}
  %wrapped_slice.93 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.93, metadata={scheduling_name="wrapped_slice.93"}
  %wrapped_slice.92 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.92, metadata={scheduling_name="wrapped_slice.92"}
  %wrapped_slice.91 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.91, metadata={scheduling_name="wrapped_slice.91"}
  %wrapped_slice.88 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.88, metadata={scheduling_name="wrapped_slice.88"}
  %wrapped_slice.87 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.87, metadata={scheduling_name="wrapped_slice.87"}
  %wrapped_slice.86 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.86, metadata={scheduling_name="wrapped_slice.86"}
  %wrapped_slice.85 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.85, metadata={scheduling_name="wrapped_slice.85"}
  %wrapped_slice.84 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.84, metadata={scheduling_name="wrapped_slice.84"}
  %wrapped_slice.83 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.83, metadata={scheduling_name="wrapped_slice.83"}
  %wrapped_slice.82 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.82, metadata={scheduling_name="wrapped_slice.82"}
  %wrapped_slice.81 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.81, metadata={scheduling_name="wrapped_slice.81"}
  %wrapped_slice.78 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.78, metadata={scheduling_name="wrapped_slice.78"}
  %wrapped_slice.77 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.77, metadata={scheduling_name="wrapped_slice.77"}
  %wrapped_slice.76 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.76, metadata={scheduling_name="wrapped_slice.76"}
  %wrapped_slice.75 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.75, metadata={scheduling_name="wrapped_slice.75"}
  %wrapped_slice.72 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.72, metadata={scheduling_name="wrapped_slice.72"}
  %wrapped_slice.71 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.71, metadata={scheduling_name="wrapped_slice.71"}
  %wrapped_slice.70 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.70, metadata={scheduling_name="wrapped_slice.70"}
  %wrapped_slice.69 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.69, metadata={scheduling_name="wrapped_slice.69"}
  %wrapped_slice.66 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.66, metadata={scheduling_name="wrapped_slice.66"}
  %wrapped_slice.65 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.65, metadata={scheduling_name="wrapped_slice.65"}
  %wrapped_slice.64 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.64, metadata={scheduling_name="wrapped_slice.64"}
  %wrapped_slice.63 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.63, metadata={scheduling_name="wrapped_slice.63"}
  %wrapped_slice.62 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.62, metadata={scheduling_name="wrapped_slice.62"}
  %wrapped_slice.61 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.61, metadata={scheduling_name="wrapped_slice.61"}
  %wrapped_slice.60 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.60, metadata={scheduling_name="wrapped_slice.60"}
  %wrapped_slice.59 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.59, metadata={scheduling_name="wrapped_slice.59"}
  %wrapped_slice.56 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.56, metadata={scheduling_name="wrapped_slice.56"}
  %wrapped_slice.55 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.55, metadata={scheduling_name="wrapped_slice.55"}
  %wrapped_slice.54 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.54, metadata={scheduling_name="wrapped_slice.54"}
  %wrapped_slice.53 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.53, metadata={scheduling_name="wrapped_slice.53"}
  %wrapped_slice.96 = f32[1]{0} fusion(%all-reduce-done.9), kind=kLoop, calls=%wrapped_slice_computation.96, metadata={scheduling_name="wrapped_slice.96"}
  %bitcast.32145 = f32[] bitcast(%wrapped_slice.46), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32145"}
  %bitcast.32144 = f32[] bitcast(%wrapped_slice.45), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32144"}
  %bitcast.32143 = f32[] bitcast(%wrapped_slice.36), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32143"}
  %bitcast.32142 = f32[] bitcast(%wrapped_slice.35), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32142"}
  %bitcast.32121 = f32[] bitcast(%wrapped_slice.50), metadata={scheduling_name="bitcast.32121"}
  %bitcast.32120 = f32[] bitcast(%wrapped_slice.49), metadata={scheduling_name="bitcast.32120"}
  %bitcast.32119 = f32[] bitcast(%wrapped_slice.48), metadata={scheduling_name="bitcast.32119"}
  %bitcast.32118 = f32[] bitcast(%wrapped_slice.47), metadata={scheduling_name="bitcast.32118"}
  %bitcast.32117 = f32[] bitcast(%wrapped_slice.44), metadata={scheduling_name="bitcast.32117"}
  %bitcast.32116 = f32[] bitcast(%wrapped_slice.43), metadata={scheduling_name="bitcast.32116"}
  %bitcast.32115 = f32[] bitcast(%wrapped_slice.42), metadata={scheduling_name="bitcast.32115"}
  %bitcast.32114 = f32[] bitcast(%wrapped_slice.41), metadata={scheduling_name="bitcast.32114"}
  %bitcast.32113 = f32[] bitcast(%wrapped_slice.40), metadata={scheduling_name="bitcast.32113"}
  %bitcast.32112 = f32[] bitcast(%wrapped_slice.39), metadata={scheduling_name="bitcast.32112"}
  %bitcast.32111 = f32[] bitcast(%wrapped_slice.38), metadata={scheduling_name="bitcast.32111"}
  %bitcast.32110 = f32[] bitcast(%wrapped_slice.37), metadata={scheduling_name="bitcast.32110"}
  %bitcast.32109 = f32[] bitcast(%wrapped_slice.34), metadata={scheduling_name="bitcast.32109"}
  %bitcast.32108 = f32[] bitcast(%wrapped_slice.33), metadata={scheduling_name="bitcast.32108"}
  %bitcast.32107 = f32[] bitcast(%wrapped_slice.32), metadata={scheduling_name="bitcast.32107"}
  %bitcast.32106 = f32[] bitcast(%wrapped_slice.31), metadata={scheduling_name="bitcast.32106"}
  %bitcast.32057 = f32[] bitcast(%wrapped_slice.51), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32057"}
  %bitcast.32056 = f32[] bitcast(%wrapped_slice.30), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32056"}
  %get-tuple-element.4245 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.7), index=3, metadata={scheduling_name="get-tuple-element.4245"}
  %get-tuple-element.4225 = f32[] get-tuple-element(%input_convert_reduce_fusion.21), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4225"}
  %bitcast.32235 = f32[] bitcast(%wrapped_slice.90), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32235"}
  %bitcast.32234 = f32[] bitcast(%wrapped_slice.89), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32234"}
  %bitcast.32233 = f32[] bitcast(%wrapped_slice.80), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32233"}
  %bitcast.32232 = f32[] bitcast(%wrapped_slice.79), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32232"}
  %bitcast.32231 = f32[] bitcast(%wrapped_slice.68), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32231"}
  %bitcast.32230 = f32[] bitcast(%wrapped_slice.67), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32230"}
  %bitcast.32229 = f32[] bitcast(%wrapped_slice.58), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32229"}
  %bitcast.32228 = f32[] bitcast(%wrapped_slice.57), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32228"}
  %bitcast.32153 = f32[] bitcast(%wrapped_slice.95), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32153"}
  %bitcast.32152 = f32[] bitcast(%wrapped_slice.74), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32152"}
  %bitcast.32151 = f32[] bitcast(%wrapped_slice.73), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32151"}
  %bitcast.32150 = f32[] bitcast(%wrapped_slice.52), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32150"}
  %bitcast.32218 = f32[] bitcast(%wrapped_slice.94), metadata={scheduling_name="bitcast.32218"}
  %bitcast.32217 = f32[] bitcast(%wrapped_slice.93), metadata={scheduling_name="bitcast.32217"}
  %bitcast.32216 = f32[] bitcast(%wrapped_slice.92), metadata={scheduling_name="bitcast.32216"}
  %bitcast.32215 = f32[] bitcast(%wrapped_slice.91), metadata={scheduling_name="bitcast.32215"}
  %bitcast.32214 = f32[] bitcast(%wrapped_slice.88), metadata={scheduling_name="bitcast.32214"}
  %bitcast.32213 = f32[] bitcast(%wrapped_slice.87), metadata={scheduling_name="bitcast.32213"}
  %bitcast.32212 = f32[] bitcast(%wrapped_slice.86), metadata={scheduling_name="bitcast.32212"}
  %bitcast.32211 = f32[] bitcast(%wrapped_slice.85), metadata={scheduling_name="bitcast.32211"}
  %bitcast.32210 = f32[] bitcast(%wrapped_slice.84), metadata={scheduling_name="bitcast.32210"}
  %bitcast.32209 = f32[] bitcast(%wrapped_slice.83), metadata={scheduling_name="bitcast.32209"}
  %bitcast.32208 = f32[] bitcast(%wrapped_slice.82), metadata={scheduling_name="bitcast.32208"}
  %bitcast.32207 = f32[] bitcast(%wrapped_slice.81), metadata={scheduling_name="bitcast.32207"}
  %bitcast.32206 = f32[] bitcast(%wrapped_slice.78), metadata={scheduling_name="bitcast.32206"}
  %bitcast.32205 = f32[] bitcast(%wrapped_slice.77), metadata={scheduling_name="bitcast.32205"}
  %bitcast.32204 = f32[] bitcast(%wrapped_slice.76), metadata={scheduling_name="bitcast.32204"}
  %bitcast.32203 = f32[] bitcast(%wrapped_slice.75), metadata={scheduling_name="bitcast.32203"}
  %bitcast.32202 = f32[] bitcast(%wrapped_slice.72), metadata={scheduling_name="bitcast.32202"}
  %bitcast.32201 = f32[] bitcast(%wrapped_slice.71), metadata={scheduling_name="bitcast.32201"}
  %bitcast.32200 = f32[] bitcast(%wrapped_slice.70), metadata={scheduling_name="bitcast.32200"}
  %bitcast.32199 = f32[] bitcast(%wrapped_slice.69), metadata={scheduling_name="bitcast.32199"}
  %bitcast.32198 = f32[] bitcast(%wrapped_slice.66), metadata={scheduling_name="bitcast.32198"}
  %bitcast.32197 = f32[] bitcast(%wrapped_slice.65), metadata={scheduling_name="bitcast.32197"}
  %bitcast.32196 = f32[] bitcast(%wrapped_slice.64), metadata={scheduling_name="bitcast.32196"}
  %bitcast.32195 = f32[] bitcast(%wrapped_slice.63), metadata={scheduling_name="bitcast.32195"}
  %bitcast.32194 = f32[] bitcast(%wrapped_slice.62), metadata={scheduling_name="bitcast.32194"}
  %bitcast.32193 = f32[] bitcast(%wrapped_slice.61), metadata={scheduling_name="bitcast.32193"}
  %bitcast.32192 = f32[] bitcast(%wrapped_slice.60), metadata={scheduling_name="bitcast.32192"}
  %bitcast.32191 = f32[] bitcast(%wrapped_slice.59), metadata={scheduling_name="bitcast.32191"}
  %bitcast.32190 = f32[] bitcast(%wrapped_slice.56), metadata={scheduling_name="bitcast.32190"}
  %bitcast.32189 = f32[] bitcast(%wrapped_slice.55), metadata={scheduling_name="bitcast.32189"}
  %bitcast.32188 = f32[] bitcast(%wrapped_slice.54), metadata={scheduling_name="bitcast.32188"}
  %bitcast.32187 = f32[] bitcast(%wrapped_slice.53), metadata={scheduling_name="bitcast.32187"}
  %loop_convert_fusion.20 = (bf16[], bf16[], bf16[]) fusion(%bitcast.32056, %bitcast.32106, %bitcast.32107, %bitcast.32108, %bitcast.32109, /*index=5*/%bitcast.32142, %bitcast.32143, %bitcast.32110, %bitcast.32111, %bitcast.32112, /*index=10*/%bitcast.32113, %bitcast.32114, %bitcast.32115, %bitcast.32116, %bitcast.32117, /*index=15*/%bitcast.32144, %bitcast.32145, %bitcast.32118, %bitcast.32119, %bitcast.32120, /*index=20*/%bitcast.32121, %input_reduce_fusion.68, %bitcast.32057, %bitcast.32150, %bitcast.32187, /*index=25*/%bitcast.32188, %bitcast.32189, %bitcast.32190, %bitcast.32228, %bitcast.32229, /*index=30*/%bitcast.32191, %bitcast.32192, %bitcast.32193, %bitcast.32194, %bitcast.32195, /*index=35*/%bitcast.32196, %bitcast.32197, %bitcast.32198, %bitcast.32230, %bitcast.32231, /*index=40*/%bitcast.32199, %bitcast.32200, %bitcast.32201, %bitcast.32202, %get-tuple-element.4225, /*index=45*/%bitcast.32151, %bitcast.32152, %bitcast.32203, %bitcast.32204, %bitcast.32205, /*index=50*/%bitcast.32206, %bitcast.32232, %bitcast.32233, %bitcast.32207, %bitcast.32208, /*index=55*/%bitcast.32209, %bitcast.32210, %bitcast.32211, %bitcast.32212, %bitcast.32213, /*index=60*/%bitcast.32214, %bitcast.32234, %bitcast.32235, %bitcast.32215, %bitcast.32216, /*index=65*/%bitcast.32217, %bitcast.32218, %get-tuple-element.4245, %bitcast.32153), kind=kLoop, calls=%fused_convert.20, metadata={scheduling_name="loop_convert_fusion.20"}
  %bitcast.32219 = f32[] bitcast(%wrapped_slice.96), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="bitcast.32219"}
  %copy_fusion = (f32[], f32[], f32[]) fusion(%constant_2882_0, %bitcast.32219, %all-reduce-done), kind=kLoop, calls=%copy_horizontally_fused_computation, metadata={scheduling_name="copy_fusion"}
  %input_transpose_fusion.11 = bf16[32768,768]{1,0} fusion(%input_transpose_fusion.10), kind=kInput, calls=%fused_transpose.25, metadata={scheduling_name="input_transpose_fusion.11"}
  %get-tuple-element.4845 = s32[] get-tuple-element(%loop_add_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4845"}
  %get-tuple-element.4774 = s32[] get-tuple-element(%loop_add_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4774"}
  %get-tuple-element.4822 = bf16[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.4822"}
  %get-tuple-element.4799 = bf16[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.4799"}
  %get-tuple-element.4775 = bf16[6144]{0} get-tuple-element(%input_convert_reduce_fusion.21), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4775"}
  %get-tuple-element.4801 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4801"}
  %get-tuple-element.4824 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4824"}
  %get-tuple-element.4777 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.7), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4777"}
  %get-tuple-element.4815 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4815"}
  %get-tuple-element.4838 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4838"}
  %get-tuple-element.4791 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4791"}
  %get-tuple-element.4816 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4816"}
  %get-tuple-element.4839 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4839"}
  %get-tuple-element.4792 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4792"}
  %get-tuple-element.4811 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4811"}
  %get-tuple-element.4834 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4834"}
  %get-tuple-element.4787 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4787"}
  %get-tuple-element.4805 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4805"}
  %get-tuple-element.4828 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4828"}
  %get-tuple-element.4781 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4781"}
  %get-tuple-element.4806 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4806"}
  %get-tuple-element.4829 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4829"}
  %get-tuple-element.4782 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.5), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4782"}
  %get-tuple-element.4840 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=3, metadata={scheduling_name="get-tuple-element.4840"}
  %get-tuple-element.4817 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=1, metadata={scheduling_name="get-tuple-element.4817"}
  %get-tuple-element.4793 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=0, metadata={scheduling_name="get-tuple-element.4793"}
  %get-tuple-element.4833 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=3, metadata={scheduling_name="get-tuple-element.4833"}
  %get-tuple-element.4810 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=1, metadata={scheduling_name="get-tuple-element.4810"}
  %get-tuple-element.4786 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=0, metadata={scheduling_name="get-tuple-element.4786"}
  %get-tuple-element.4843 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=3, metadata={scheduling_name="get-tuple-element.4843"}
  %get-tuple-element.4820 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=1, metadata={scheduling_name="get-tuple-element.4820"}
  %get-tuple-element.4796 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=0, metadata={scheduling_name="get-tuple-element.4796"}
  %get-tuple-element.4830 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=3, metadata={scheduling_name="get-tuple-element.4830"}
  %get-tuple-element.4807 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=1, metadata={scheduling_name="get-tuple-element.4807"}
  %get-tuple-element.4783 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=0, metadata={scheduling_name="get-tuple-element.4783"}
  %get-tuple-element.4831 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=3, metadata={scheduling_name="get-tuple-element.4831"}
  %get-tuple-element.4808 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=1, metadata={scheduling_name="get-tuple-element.4808"}
  %get-tuple-element.4784 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=0, metadata={scheduling_name="get-tuple-element.4784"}
  %get-tuple-element.4841 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=3, metadata={scheduling_name="get-tuple-element.4841"}
  %get-tuple-element.4818 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=1, metadata={scheduling_name="get-tuple-element.4818"}
  %get-tuple-element.4794 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=0, metadata={scheduling_name="get-tuple-element.4794"}
  %get-tuple-element.4832 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=3, metadata={scheduling_name="get-tuple-element.4832"}
  %get-tuple-element.4809 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=1, metadata={scheduling_name="get-tuple-element.4809"}
  %get-tuple-element.4785 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=0, metadata={scheduling_name="get-tuple-element.4785"}
  %get-tuple-element.4842 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=3, metadata={scheduling_name="get-tuple-element.4842"}
  %get-tuple-element.4819 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.4819"}
  %get-tuple-element.4795 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.4795"}
  %get-tuple-element.4821 = bf16[32768,768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=1, metadata={scheduling_name="get-tuple-element.4821"}
  %get-tuple-element.4844 = bf16[32768,768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=0, metadata={scheduling_name="get-tuple-element.4844"}
  %get-tuple-element.4823 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=3, metadata={scheduling_name="get-tuple-element.4823"}
  %get-tuple-element.4800 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.4800"}
  %get-tuple-element.4776 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.4776"}
  %get-tuple-element.4825 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=3, metadata={scheduling_name="get-tuple-element.4825"}
  %get-tuple-element.4802 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.4802"}
  %get-tuple-element.4778 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.4778"}
  %get-tuple-element.4826 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=3, metadata={scheduling_name="get-tuple-element.4826"}
  %get-tuple-element.4803 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=1, metadata={scheduling_name="get-tuple-element.4803"}
  %get-tuple-element.4779 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=0, metadata={scheduling_name="get-tuple-element.4779"}
  %get-tuple-element.4835 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=3, metadata={scheduling_name="get-tuple-element.4835"}
  %get-tuple-element.4812 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.4812"}
  %get-tuple-element.4788 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.4788"}
  %get-tuple-element.4827 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=3, metadata={scheduling_name="get-tuple-element.4827"}
  %get-tuple-element.4804 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=1, metadata={scheduling_name="get-tuple-element.4804"}
  %get-tuple-element.4780 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=0, metadata={scheduling_name="get-tuple-element.4780"}
  %get-tuple-element.4837 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=3, metadata={scheduling_name="get-tuple-element.4837"}
  %get-tuple-element.4814 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=1, metadata={scheduling_name="get-tuple-element.4814"}
  %get-tuple-element.4790 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=0, metadata={scheduling_name="get-tuple-element.4790"}
  %get-tuple-element.4836 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=3, metadata={scheduling_name="get-tuple-element.4836"}
  %get-tuple-element.4813 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=1, metadata={scheduling_name="get-tuple-element.4813"}
  %get-tuple-element.4789 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=0, metadata={scheduling_name="get-tuple-element.4789"}
  %get-tuple-element.4846 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.4846"}
  %get-tuple-element.4850 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.4850"}
  %get-tuple-element.4851 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.4851"}
  %get-tuple-element.4881 = f32[] get-tuple-element(%copy_fusion), index=2, metadata={scheduling_name="get-tuple-element.4881"}
  %bitcast.32260 = f32[] bitcast(%get-tuple-element.4881), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="bitcast.32260"}
  %get-tuple-element.4880 = f32[] get-tuple-element(%copy_fusion), index=1, metadata={scheduling_name="get-tuple-element.4880"}
  %bitcast.32259 = f32[] bitcast(%get-tuple-element.4880), metadata={scheduling_name="bitcast.32259"}
  %get-tuple-element.4879 = f32[] get-tuple-element(%copy_fusion), index=0, metadata={scheduling_name="get-tuple-element.4879"}
  %bitcast.32258 = f32[] bitcast(%get-tuple-element.4879), metadata={scheduling_name="bitcast.32258"}
  ROOT %tuple.669 = (s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[]) tuple(%get-tuple-element.4774, %get-tuple-element.4775, %get-tuple-element.4776, %get-tuple-element.4777, %get-tuple-element.4778, /*index=5*/%get-tuple-element.4779, %get-tuple-element.4780, %get-tuple-element.4781, %get-tuple-element.4782, %get-tuple-element.4783, /*index=10*/%get-tuple-element.4784, %get-tuple-element.4785, %get-tuple-element.4786, %get-tuple-element.4787, %get-tuple-element.4788, /*index=15*/%get-tuple-element.4789, %get-tuple-element.4790, %get-tuple-element.4791, %get-tuple-element.4792, %get-tuple-element.4793, /*index=20*/%get-tuple-element.4794, %get-tuple-element.4795, %get-tuple-element.4796, %input_transpose_fusion.11, %get-tuple-element.4798, /*index=25*/%get-tuple-element.4799, %get-tuple-element.4800, %get-tuple-element.4801, %get-tuple-element.4802, %get-tuple-element.4803, /*index=30*/%get-tuple-element.4804, %get-tuple-element.4805, %get-tuple-element.4806, %get-tuple-element.4807, %get-tuple-element.4808, /*index=35*/%get-tuple-element.4809, %get-tuple-element.4810, %get-tuple-element.4811, %get-tuple-element.4812, %get-tuple-element.4813, /*index=40*/%get-tuple-element.4814, %get-tuple-element.4815, %get-tuple-element.4816, %get-tuple-element.4817, %get-tuple-element.4818, /*index=45*/%get-tuple-element.4819, %get-tuple-element.4820, %get-tuple-element.4821, %get-tuple-element.4822, %get-tuple-element.4823, /*index=50*/%get-tuple-element.4824, %get-tuple-element.4825, %get-tuple-element.4826, %get-tuple-element.4827, %get-tuple-element.4828, /*index=55*/%get-tuple-element.4829, %get-tuple-element.4830, %get-tuple-element.4831, %get-tuple-element.4832, %get-tuple-element.4833, /*index=60*/%get-tuple-element.4834, %get-tuple-element.4835, %get-tuple-element.4836, %get-tuple-element.4837, %get-tuple-element.4838, /*index=65*/%get-tuple-element.4839, %get-tuple-element.4840, %get-tuple-element.4841, %get-tuple-element.4842, %get-tuple-element.4843, /*index=70*/%get-tuple-element.4844, %get-tuple-element.4845, %get-tuple-element.4846, %bitcast.32260, %bitcast.32258, /*index=75*/%bitcast.32259, %get-tuple-element.4850, %get-tuple-element.4851, %all-reduce-done), metadata={scheduling_name="tuple.669"}
}

