HloModule jit_train_step, is_scheduled=true, input_output_alias={ {0}: (0, {}, may-alias), {1}: (1, {}, may-alias), {2}: (2, {}, may-alias), {3}: (3, {}, may-alias), {4}: (4, {}, may-alias), {5}: (5, {}, may-alias), {6}: (6, {}, may-alias), {7}: (7, {}, may-alias), {8}: (8, {}, may-alias), {9}: (9, {}, may-alias), {10}: (10, {}, may-alias), {11}: (11, {}, may-alias), {12}: (12, {}, may-alias), {13}: (13, {}, may-alias), {14}: (14, {}, may-alias), {15}: (15, {}, may-alias), {16}: (16, {}, may-alias), {17}: (17, {}, may-alias), {18}: (18, {}, may-alias), {19}: (19, {}, may-alias), {20}: (20, {}, may-alias), {21}: (21, {}, may-alias), {22}: (22, {}, may-alias), {23}: (23, {}, may-alias), {24}: (24, {}, may-alias), {25}: (25, {}, may-alias), {26}: (26, {}, may-alias), {27}: (27, {}, may-alias), {28}: (28, {}, may-alias), {29}: (29, {}, may-alias), {30}: (30, {}, may-alias), {31}: (31, {}, may-alias), {32}: (32, {}, may-alias), {33}: (33, {}, may-alias), {34}: (34, {}, may-alias), {35}: (35, {}, may-alias), {36}: (36, {}, may-alias), {37}: (37, {}, may-alias), {38}: (38, {}, may-alias), {39}: (39, {}, may-alias), {40}: (40, {}, may-alias), {41}: (41, {}, may-alias), {42}: (42, {}, may-alias), {43}: (43, {}, may-alias), {44}: (44, {}, may-alias), {45}: (45, {}, may-alias), {46}: (46, {}, may-alias), {47}: (47, {}, may-alias), {48}: (48, {}, may-alias), {49}: (49, {}, may-alias), {50}: (50, {}, may-alias), {51}: (51, {}, may-alias), {52}: (52, {}, may-alias), {53}: (53, {}, may-alias), {54}: (54, {}, may-alias), {55}: (55, {}, may-alias), {56}: (56, {}, may-alias), {57}: (57, {}, may-alias), {58}: (58, {}, may-alias), {59}: (59, {}, may-alias), {60}: (60, {}, may-alias), {61}: (61, {}, may-alias), {62}: (62, {}, may-alias), {63}: (63, {}, may-alias), {64}: (64, {}, may-alias), {65}: (65, {}, may-alias), {66}: (66, {}, may-alias), {67}: (67, {}, may-alias), {68}: (68, {}, may-alias), {69}: (69, {}, may-alias), {70}: (70, {}, may-alias), {71}: (71, {}, may-alias) }, entry_computation_layout={(s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], s32[8,8192]{1,0}, s32[8,8192]{1,0}, s32[8,8192]{1,0}, /*index=75*/s32[8,8192]{1,0})->(s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[])}, allow_spmd_sharding_propagation_to_parameters={false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false}, allow_spmd_sharding_propagation_to_output={false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true}, num_partitions=32, frontend_attributes={fingerprint_before_lhs="02b20ea3b1eb04a913291971bfe39182"}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.2 (p.0.lhs.34: f32[], p.0.rhs.34: f32[], p.1.lhs.34: s32[], p.1.rhs.34: s32[]) -> pred[] {
  %constant_5508_0 = s32[] constant(2147483647)
  %constant_5507_0 = s32[] constant(0)
  %p.1.rhs.34 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.34"}
  %p.1.lhs.34 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.34"}
  %p.0.rhs.34 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.34"}
  %p.0.lhs.34 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.34"}
  %compare.1662.0 = pred[] compare(%p.1.lhs.34, %p.1.rhs.34), direction=LT, metadata={scheduling_name="compare.1662.0"}
  %bitcast-convert.73.0 = s32[] bitcast-convert(%p.0.rhs.34), metadata={scheduling_name="bitcast-convert.73.0"}
  %compare.1658.0 = pred[] compare(%bitcast-convert.73.0, %constant_5507_0), direction=LT, metadata={scheduling_name="compare.1658.0"}
  %xor.73.0 = s32[] xor(%constant_5508_0, %bitcast-convert.73.0), metadata={scheduling_name="xor.73.0"}
  %select.1326.0 = s32[] select(%compare.1658.0, %xor.73.0, %bitcast-convert.73.0), metadata={scheduling_name="select.1326.0"}
  %bitcast-convert.72.0 = s32[] bitcast-convert(%p.0.lhs.34), metadata={scheduling_name="bitcast-convert.72.0"}
  %compare.1657.0 = pred[] compare(%bitcast-convert.72.0, %constant_5507_0), direction=LT, metadata={scheduling_name="compare.1657.0"}
  %xor.72.0 = s32[] xor(%constant_5508_0, %bitcast-convert.72.0), metadata={scheduling_name="xor.72.0"}
  %select.1325.0 = s32[] select(%compare.1657.0, %xor.72.0, %bitcast-convert.72.0), metadata={scheduling_name="select.1325.0"}
  %compare.1659.0 = pred[] compare(%select.1325.0, %select.1326.0), direction=GT, metadata={scheduling_name="compare.1659.0"}
  %compare.1660.0 = pred[] compare(%select.1326.0, %select.1325.0), direction=GT, metadata={scheduling_name="compare.1660.0"}
  %compare.1661.0 = pred[] compare(%compare.1659.0, %compare.1660.0), direction=EQ, metadata={scheduling_name="compare.1661.0"}
  ROOT %select.1327.0 = pred[] select(%compare.1661.0, %compare.1662.0, %compare.1659.0), metadata={scheduling_name="select.1327.0"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.3 (p.0.lhs.36: f32[], p.0.rhs.36: f32[], p.1.lhs.36: s32[], p.1.rhs.36: s32[]) -> pred[] {
  %constant_5512_0 = s32[] constant(2147483647)
  %constant_5511_0 = s32[] constant(0)
  %p.1.rhs.36 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.36"}
  %p.1.lhs.36 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.36"}
  %p.0.rhs.36 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.36"}
  %p.0.lhs.36 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.36"}
  %compare.1678.0 = pred[] compare(%p.1.lhs.36, %p.1.rhs.36), direction=LT, metadata={scheduling_name="compare.1678.0"}
  %bitcast-convert.77.0 = s32[] bitcast-convert(%p.0.rhs.36), metadata={scheduling_name="bitcast-convert.77.0"}
  %compare.1674.0 = pred[] compare(%bitcast-convert.77.0, %constant_5511_0), direction=LT, metadata={scheduling_name="compare.1674.0"}
  %xor.77.0 = s32[] xor(%constant_5512_0, %bitcast-convert.77.0), metadata={scheduling_name="xor.77.0"}
  %select.1334.0 = s32[] select(%compare.1674.0, %xor.77.0, %bitcast-convert.77.0), metadata={scheduling_name="select.1334.0"}
  %bitcast-convert.76.0 = s32[] bitcast-convert(%p.0.lhs.36), metadata={scheduling_name="bitcast-convert.76.0"}
  %compare.1673.0 = pred[] compare(%bitcast-convert.76.0, %constant_5511_0), direction=LT, metadata={scheduling_name="compare.1673.0"}
  %xor.76.0 = s32[] xor(%constant_5512_0, %bitcast-convert.76.0), metadata={scheduling_name="xor.76.0"}
  %select.1333.0 = s32[] select(%compare.1673.0, %xor.76.0, %bitcast-convert.76.0), metadata={scheduling_name="select.1333.0"}
  %compare.1675.0 = pred[] compare(%select.1333.0, %select.1334.0), direction=GT, metadata={scheduling_name="compare.1675.0"}
  %compare.1676.0 = pred[] compare(%select.1334.0, %select.1333.0), direction=GT, metadata={scheduling_name="compare.1676.0"}
  %compare.1677.0 = pred[] compare(%compare.1675.0, %compare.1676.0), direction=EQ, metadata={scheduling_name="compare.1677.0"}
  ROOT %select.1335.0 = pred[] select(%compare.1677.0, %compare.1678.0, %compare.1675.0), metadata={scheduling_name="select.1335.0"}
}

%compare-value-and-index.9.clone.clone.2 (p.0.lhs.35: f32[], p.0.rhs.35: f32[], p.1.lhs.35: s32[], p.1.rhs.35: s32[], p.2.lhs.clone.6: s32[], p.2.rhs.clone.6: s32[]) -> pred[] {
  %constant_5510_0 = s32[] constant(2147483647)
  %constant_5509_0 = s32[] constant(0)
  %p.2.rhs.clone.6 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.6"}
  %p.2.lhs.clone.6 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.6"}
  %p.1.rhs.35 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.35"}
  %p.1.lhs.35 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.35"}
  %p.0.rhs.35 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.35"}
  %p.0.lhs.35 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.35"}
  %compare.1672.0 = pred[] compare(%p.2.lhs.clone.6, %p.2.rhs.clone.6), direction=LT, metadata={scheduling_name="compare.1672.0"}
  %compare.1669.0 = pred[] compare(%p.1.rhs.35, %p.1.lhs.35), direction=LT, metadata={scheduling_name="compare.1669.0"}
  %compare.1666.0 = pred[] compare(%p.1.lhs.35, %p.1.rhs.35), direction=LT, metadata={scheduling_name="compare.1666.0"}
  %bitcast-convert.75.0 = s32[] bitcast-convert(%p.0.rhs.35), metadata={scheduling_name="bitcast-convert.75.0"}
  %compare.1664.0 = pred[] compare(%bitcast-convert.75.0, %constant_5509_0), direction=LT, metadata={scheduling_name="compare.1664.0"}
  %xor.75.0 = s32[] xor(%constant_5510_0, %bitcast-convert.75.0), metadata={scheduling_name="xor.75.0"}
  %select.1329.0 = s32[] select(%compare.1664.0, %xor.75.0, %bitcast-convert.75.0), metadata={scheduling_name="select.1329.0"}
  %compare.1670.0 = pred[] compare(%p.0.rhs.35, %p.0.lhs.35), direction=GT, metadata={scheduling_name="compare.1670.0"}
  %compare.1667.0 = pred[] compare(%p.0.lhs.35, %p.0.rhs.35), direction=GT, metadata={scheduling_name="compare.1667.0"}
  %bitcast-convert.74.0 = s32[] bitcast-convert(%p.0.lhs.35), metadata={scheduling_name="bitcast-convert.74.0"}
  %compare.1663.0 = pred[] compare(%bitcast-convert.74.0, %constant_5509_0), direction=LT, metadata={scheduling_name="compare.1663.0"}
  %xor.74.0 = s32[] xor(%constant_5510_0, %bitcast-convert.74.0), metadata={scheduling_name="xor.74.0"}
  %select.1328.0 = s32[] select(%compare.1663.0, %xor.74.0, %bitcast-convert.74.0), metadata={scheduling_name="select.1328.0"}
  %compare.1665.0 = pred[] compare(%select.1328.0, %select.1329.0), direction=EQ, metadata={scheduling_name="compare.1665.0"}
  %select.1330.0 = pred[] select(%compare.1665.0, %compare.1666.0, %compare.1667.0), metadata={scheduling_name="select.1330.0"}
  %compare.1668.0 = pred[] compare(%select.1329.0, %select.1328.0), direction=EQ, metadata={scheduling_name="compare.1668.0"}
  %select.1331.0 = pred[] select(%compare.1668.0, %compare.1669.0, %compare.1670.0), metadata={scheduling_name="select.1331.0"}
  %compare.1671.0 = pred[] compare(%select.1330.0, %select.1331.0), direction=EQ, metadata={scheduling_name="compare.1671.0"}
  ROOT %select.1332.0 = pred[] select(%compare.1671.0, %compare.1672.0, %select.1330.0), metadata={scheduling_name="select.1332.0"}
}

%compare-value-and-index.9.clone.clone.3 (p.0.lhs.37: f32[], p.0.rhs.37: f32[], p.1.lhs.37: s32[], p.1.rhs.37: s32[], p.2.lhs.clone.7: s32[], p.2.rhs.clone.7: s32[]) -> pred[] {
  %constant_5514_0 = s32[] constant(2147483647)
  %constant_5513_0 = s32[] constant(0)
  %p.2.rhs.clone.7 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.7"}
  %p.2.lhs.clone.7 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.7"}
  %p.1.rhs.37 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.37"}
  %p.1.lhs.37 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.37"}
  %p.0.rhs.37 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.37"}
  %p.0.lhs.37 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.37"}
  %compare.1688.0 = pred[] compare(%p.2.lhs.clone.7, %p.2.rhs.clone.7), direction=LT, metadata={scheduling_name="compare.1688.0"}
  %compare.1685.0 = pred[] compare(%p.1.rhs.37, %p.1.lhs.37), direction=LT, metadata={scheduling_name="compare.1685.0"}
  %compare.1682.0 = pred[] compare(%p.1.lhs.37, %p.1.rhs.37), direction=LT, metadata={scheduling_name="compare.1682.0"}
  %bitcast-convert.79.0 = s32[] bitcast-convert(%p.0.rhs.37), metadata={scheduling_name="bitcast-convert.79.0"}
  %compare.1680.0 = pred[] compare(%bitcast-convert.79.0, %constant_5513_0), direction=LT, metadata={scheduling_name="compare.1680.0"}
  %xor.79.0 = s32[] xor(%constant_5514_0, %bitcast-convert.79.0), metadata={scheduling_name="xor.79.0"}
  %select.1337.0 = s32[] select(%compare.1680.0, %xor.79.0, %bitcast-convert.79.0), metadata={scheduling_name="select.1337.0"}
  %compare.1686.0 = pred[] compare(%p.0.rhs.37, %p.0.lhs.37), direction=GT, metadata={scheduling_name="compare.1686.0"}
  %compare.1683.0 = pred[] compare(%p.0.lhs.37, %p.0.rhs.37), direction=GT, metadata={scheduling_name="compare.1683.0"}
  %bitcast-convert.78.0 = s32[] bitcast-convert(%p.0.lhs.37), metadata={scheduling_name="bitcast-convert.78.0"}
  %compare.1679.0 = pred[] compare(%bitcast-convert.78.0, %constant_5513_0), direction=LT, metadata={scheduling_name="compare.1679.0"}
  %xor.78.0 = s32[] xor(%constant_5514_0, %bitcast-convert.78.0), metadata={scheduling_name="xor.78.0"}
  %select.1336.0 = s32[] select(%compare.1679.0, %xor.78.0, %bitcast-convert.78.0), metadata={scheduling_name="select.1336.0"}
  %compare.1681.0 = pred[] compare(%select.1336.0, %select.1337.0), direction=EQ, metadata={scheduling_name="compare.1681.0"}
  %select.1338.0 = pred[] select(%compare.1681.0, %compare.1682.0, %compare.1683.0), metadata={scheduling_name="select.1338.0"}
  %compare.1684.0 = pred[] compare(%select.1337.0, %select.1336.0), direction=EQ, metadata={scheduling_name="compare.1684.0"}
  %select.1339.0 = pred[] select(%compare.1684.0, %compare.1685.0, %compare.1686.0), metadata={scheduling_name="select.1339.0"}
  %compare.1687.0 = pred[] compare(%select.1338.0, %select.1339.0), direction=EQ, metadata={scheduling_name="compare.1687.0"}
  ROOT %select.1340.0 = pred[] select(%compare.1687.0, %compare.1688.0, %select.1338.0), metadata={scheduling_name="select.1340.0"}
}

%fused_dynamic_update_slice (param_0.2416: bf16[9,1,4,8192,6144], param_1.2626: s32[], param_2.2726: bf16[4,8192,6144]) -> bf16[9,1,4,8192,6144] {
  %param_0.2416 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2416"}
  %param_2.2726 = bf16[4,8192,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2726"}
  %bitcast.26147.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_2.2726), metadata={scheduling_name="bitcast.26147.1"}
  %param_1.2626 = s32[] parameter(1), metadata={scheduling_name="param_1.2626"}
  %constant_5429_31 = s32[] constant(0)
  ROOT %dynamic-update-slice.425.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2416, %bitcast.26147.1, %param_1.2626, %constant_5429_31, %constant_5429_31, /*index=5*/%constant_5429_31, %constant_5429_31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.425.1"}
}

%fused_dynamic_update_slice.1 (param_0.2417: bf16[9,1,4,8192,48,128], param_1.2628: s32[], param_2.2702: bf16[1,4,8192,48,128]) -> bf16[9,1,4,8192,48,128] {
  %param_0.2417 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2417"}
  %param_2.2702 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2702"}
  %bitcast.26184.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} bitcast(%param_2.2702), metadata={scheduling_name="bitcast.26184.1"}
  %param_1.2628 = s32[] parameter(1), metadata={scheduling_name="param_1.2628"}
  %constant_5429_2 = s32[] constant(0)
  ROOT %dynamic-update-slice.428.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-update-slice(%param_0.2417, %bitcast.26184.1, %param_1.2628, %constant_5429_2, %constant_5429_2, /*index=5*/%constant_5429_2, %constant_5429_2, %constant_5429_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.428.1"}
}

%fused_dynamic_update_slice.2 (param_0.2418: u32[9,2,4], param_1.2630: s32[], param_2.2711: u32[2,4]) -> u32[9,2,4] {
  %param_0.2418 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2418"}
  %param_2.2711 = u32[2,4]{1,0} parameter(2), metadata={scheduling_name="param_2.2711"}
  %bitcast.26173.1 = u32[1,2,4]{2,1,0} bitcast(%param_2.2711), metadata={scheduling_name="bitcast.26173.1"}
  %param_1.2630 = s32[] parameter(1), metadata={scheduling_name="param_1.2630"}
  %constant_5429_16 = s32[] constant(0)
  ROOT %dynamic-update-slice.427.1 = u32[9,2,4]{2,1,0} dynamic-update-slice(%param_0.2418, %bitcast.26173.1, %param_1.2630, %constant_5429_16, %constant_5429_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.427.1"}
}

%fused_dynamic_update_slice.3 (param_0.2420: s32[], param_1.3491: f32[1,4,48,8192,1], param_2.2715: f32[9,1,4,48,8192,1]) -> f32[9,1,1,4,48,8192] {
  %param_2.2715 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(2), metadata={scheduling_name="param_2.2715"}
  %bitcast.26156.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_2.2715), metadata={scheduling_name="bitcast.26156.1"}
  %param_1.3491 = f32[1,4,48,8192,1]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3491"}
  %bitcast.26160.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_1.3491), metadata={scheduling_name="bitcast.26160.1"}
  %param_0.2420 = s32[] parameter(0), metadata={scheduling_name="param_0.2420"}
  %constant_5429_20 = s32[] constant(0)
  ROOT %dynamic-update-slice.426.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-update-slice(%bitcast.26156.1, %bitcast.26160.1, %param_0.2420, %constant_5429_20, %constant_5429_20, /*index=5*/%constant_5429_20, %constant_5429_20, %constant_5429_20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.426.1"}
}

%fused_dynamic_update_slice.4 (param_0.2421: bf16[9,1,4,8192,48,128], param_1.2635: s32[], param_2.2725: bf16[1,4,8192,48,128]) -> bf16[9,1,4,8192,48,128] {
  %param_0.2421 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2421"}
  %param_2.2725 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2725"}
  %bitcast.26136.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} bitcast(%param_2.2725), metadata={scheduling_name="bitcast.26136.1"}
  %param_1.2635 = s32[] parameter(1), metadata={scheduling_name="param_1.2635"}
  %constant_5429_30 = s32[] constant(0)
  ROOT %dynamic-update-slice.424.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-update-slice(%param_0.2421, %bitcast.26136.1, %param_1.2635, %constant_5429_30, %constant_5429_30, /*index=5*/%constant_5429_30, %constant_5429_30, %constant_5429_30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.424.1"}
}

%fused_dynamic_update_slice.5 (param_0.2422: u32[9,2,4], param_1.2637: s32[], param_2.2722: u32[2,4]) -> u32[9,2,4] {
  %param_0.2422 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2422"}
  %param_2.2722 = u32[2,4]{1,0} parameter(2), metadata={scheduling_name="param_2.2722"}
  %bitcast.26125.1 = u32[1,2,4]{2,1,0} bitcast(%param_2.2722), metadata={scheduling_name="bitcast.26125.1"}
  %param_1.2637 = s32[] parameter(1), metadata={scheduling_name="param_1.2637"}
  %constant_5429_27 = s32[] constant(0)
  ROOT %dynamic-update-slice.423.1 = u32[9,2,4]{2,1,0} dynamic-update-slice(%param_0.2422, %bitcast.26125.1, %param_1.2637, %constant_5429_27, %constant_5429_27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.423.1"}
}

%fused_dynamic_update_slice.6 (param_0.2424: s32[], param_1.3499: f32[1,4,48,8192,1], param_2.2724: f32[9,1,4,48,8192,1]) -> f32[9,1,1,4,48,8192] {
  %param_2.2724 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(2), metadata={scheduling_name="param_2.2724"}
  %bitcast.26108.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_2.2724), metadata={scheduling_name="bitcast.26108.1"}
  %param_1.3499 = f32[1,4,48,8192,1]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3499"}
  %bitcast.26112.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_1.3499), metadata={scheduling_name="bitcast.26112.1"}
  %param_0.2424 = s32[] parameter(0), metadata={scheduling_name="param_0.2424"}
  %constant_5429_29 = s32[] constant(0)
  ROOT %dynamic-update-slice.422.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-update-slice(%bitcast.26108.1, %bitcast.26112.1, %param_0.2424, %constant_5429_29, %constant_5429_29, /*index=5*/%constant_5429_29, %constant_5429_29, %constant_5429_29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.422.1"}
}

%fused_dynamic_update_slice.7 (param_0.2425: bf16[9,1,4,8192,6144], param_1.2642: s32[], param_2.2727: bf16[1,4,8192,6144]) -> bf16[9,1,4,8192,6144] {
  %param_0.2425 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2425"}
  %param_2.2727 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2727"}
  %bitcast.26099.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_2.2727), metadata={scheduling_name="bitcast.26099.1"}
  %param_1.2642 = s32[] parameter(1), metadata={scheduling_name="param_1.2642"}
  %constant_5429_32 = s32[] constant(0)
  ROOT %dynamic-update-slice.421.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2425, %bitcast.26099.1, %param_1.2642, %constant_5429_32, %constant_5429_32, /*index=5*/%constant_5429_32, %constant_5429_32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.421.1"}
}

%fused_dynamic_update_slice.8 (param_0.2426: bf16[1,2,4,8192,6144], param_1.3497: pred[1,4,8192,6144], param_2.2721: bf16[1,4,8192,6144], param_3.2211: bf16[4,8192,6144], param_4.1847: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.2426 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2426"}
  %param_1.3497 = pred[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3497"}
  %param_3.2211 = bf16[4,8192,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.2211"}
  %bitcast.26080.3 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_3.2211), metadata={scheduling_name="bitcast.26080.3"}
  %param_2.2721 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2721"}
  %select.1365.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%param_1.3497, %bitcast.26080.3, %param_2.2721), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1365.3"}
  %bitcast.26088.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1365.3), metadata={scheduling_name="bitcast.26088.1"}
  %constant_5429_26 = s32[] constant(0)
  %param_4.1847 = s32[] parameter(4), metadata={scheduling_name="param_4.1847"}
  %compare.1694.1 = pred[] compare(%param_4.1847, %constant_5429_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1694.1"}
  %negate.227.1 = s32[] negate(%param_4.1847), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.227.1"}
  %select.1345.3 = s32[] select(%compare.1694.1, %negate.227.1, %param_4.1847), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1345.3"}
  %constant_5427_3 = s32[] constant(1)
  %and.317.1 = s32[] and(%select.1345.3, %constant_5427_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.317.1"}
  %negate.228.1 = s32[] negate(%and.317.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.228.1"}
  %select.1346.3 = s32[] select(%compare.1694.1, %negate.228.1, %and.317.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1346.3"}
  %compare.1695.1 = pred[] compare(%select.1346.3, %constant_5429_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1695.1"}
  %compare.1696.1 = pred[] compare(%select.1346.3, %constant_5429_26), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1696.1"}
  %and.318.3 = pred[] and(%compare.1695.1, %compare.1696.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.318.3"}
  %constant_5433_2 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.3074.3 = s32[] add(%select.1346.3, %constant_5433_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3074.3"}
  %select.1347.2 = s32[] select(%and.318.3, %add.3074.3, %select.1346.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1347.2"}
  %compare.1697.2 = pred[] compare(%select.1347.2, %constant_5429_26), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="compare.1697.2"}
  %add.3075.2 = s32[] add(%select.1347.2, %constant_5433_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.3075.2"}
  %select.1348.1 = s32[] select(%compare.1697.2, %add.3075.2, %select.1347.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="select.1348.1"}
  ROOT %dynamic-update-slice.420.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2426, %bitcast.26088.1, %constant_5429_26, %select.1348.1, %constant_5429_26, /*index=5*/%constant_5429_26, %constant_5429_26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-update-slice.420.1"}
}

%fused_transpose (param_0.2429: bf16[1,1,1,8,4,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.2429 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.2429"}
  %bitcast.26062.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.2429), metadata={scheduling_name="bitcast.26062.1"}
  ROOT %transpose.764.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.26062.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.764.1"}
}

%fused_transpose.1 (param_0.2435: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.2435 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2435"}
  %bitcast.26004.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.2435), metadata={scheduling_name="bitcast.26004.1"}
  ROOT %transpose.763.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.26004.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.763.1"}
}

%fused_convert_transpose (param_0.3014: s32[1,1,1,1,2049], param_1.3111: s32[1,4,8,8192], param_2.2323: bf16[1,4,8,8192]) -> (bf16[4,16384,8192], bf16[4,8192,16384]) {
  %param_2.2323 = bf16[1,4,8,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2323"}
  %bitcast.25951.8 = bf16[4,8,8192]{2,1,0} bitcast(%param_2.2323), metadata={scheduling_name="bitcast.25951.8"}
  %convert.5011.5 = f32[4,8,8192]{2,1,0} convert(%bitcast.25951.8), metadata={scheduling_name="convert.5011.5"}
  %broadcast.6065.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.5011.5), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6065.11"}
  %param_1.3111 = s32[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3111"}
  %bitcast.25973.9 = s32[4,8,8192]{2,1,0} bitcast(%param_1.3111), metadata={scheduling_name="bitcast.25973.9"}
  %broadcast.5774.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25973.9), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5774.9"}
  %param_0.3014 = s32[1,1,1,1,2049]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3014"}
  %bitcast.25431.15 = s32[2049]{0} bitcast(%param_0.3014), metadata={scheduling_name="bitcast.25431.15"}
  %broadcast.5750.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25431.15), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5750.15"}
  %compare.1717.7 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5774.9, %broadcast.5750.15), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1717.7"}
  %convert.4304.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1717.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4304.9"}
  %convert.4306.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4304.9), metadata={scheduling_name="convert.4306.9"}
  %multiply.2736.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6065.11, %convert.4306.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2736.11"}
  %convert.4307.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2736.11), metadata={scheduling_name="convert.4307.9"}
  %slice.2441.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4307.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2441.7"}
  %convert.4308.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2441.7), metadata={scheduling_name="convert.4308.3"}
  %constant_5432_5 = bf16[] constant(0)
  %convert.5007.1 = f32[] convert(%constant_5432_5), metadata={scheduling_name="convert.5007.1"}
  %broadcast.6062.4 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.5007.1), dimensions={}, metadata={scheduling_name="broadcast.6062.4"}
  %compare.1718.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4308.3, %broadcast.6062.4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1718.3"}
  %bitcast.25995.1 = pred[4,16384,8192]{2,1,0} bitcast(%compare.1718.3), metadata={scheduling_name="bitcast.25995.1"}
  %convert.4310.1 = bf16[4,16384,8192]{2,1,0} convert(%bitcast.25995.1), metadata={scheduling_name="convert.4310.1"}
  %bitcast.25984.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2441.7), metadata={scheduling_name="bitcast.25984.1.clone.1"}
  %transpose.762.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.25984.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.762.1.clone.1"}
  ROOT %tuple.543 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4310.1, %transpose.762.1.clone.1), metadata={scheduling_name="tuple.543"}
}

%fused_multiply_transpose (param_0.2454: s32[4,8,8192], param_1.2653: s32[4,8,8192], param_2.4739: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.2454 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2454"}
  %bitcast.25968.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.2454), metadata={scheduling_name="bitcast.25968.1"}
  %param_1.2653 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2653"}
  %bitcast.25946.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.2653), metadata={scheduling_name="bitcast.25946.2"}
  %multiply.2735.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.25968.1, %bitcast.25946.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2735.1"}
  %param_2.4739 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4739"}
  %bitcast.25865.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4739), metadata={scheduling_name="bitcast.25865.3.clone.1"}
  %transpose.761.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.25865.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.761.3.clone.1"}
  %bitcast.25868.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.761.3.clone.1), metadata={scheduling_name="bitcast.25868.5.clone.1"}
  %convert.4298.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25868.5.clone.1), metadata={scheduling_name="convert.4298.5.clone.1"}
  %convert.4300.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25946.2), metadata={scheduling_name="convert.4300.3.clone.1"}
  %multiply.2733.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4298.5.clone.1, %convert.4300.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2733.3.clone.1"}
  %convert.4301.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2733.3.clone.1), metadata={scheduling_name="convert.4301.1.clone.1"}
  ROOT %tuple.544 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2735.1, %convert.4301.1.clone.1), metadata={scheduling_name="tuple.544"}
}

%region_7.620 (Arg_0.621: s32[], Arg_1.622: s32[]) -> s32[] {
  %Arg_1.622 = s32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" scheduling_name="Arg_1.622"}
  %Arg_0.621 = s32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" scheduling_name="Arg_0.621"}
  ROOT %add.2837.0 = s32[] add(%Arg_0.621, %Arg_1.622), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2837.0"}
}

%fused_reduce (param_0.3340: pred[1,4,8,8192,2], param_1.3516: s32[1,4,8,64,16], param_2.2745: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.3340 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3340"}
  %convert.4299.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3340), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4299.17"}
  %bitcast.25880.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4299.17), metadata={scheduling_name="bitcast.25880.11"}
  %constant_5429_24 = s32[] constant(0)
  %reduce-window.172.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25880.11, %constant_5429_24), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.172.11"}
  %param_1.3516 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3516"}
  %param_2.2745 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2745"}
  %slice.2437.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.2745), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2437.7"}
  %bitcast.25904.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2437.7), metadata={scheduling_name="bitcast.25904.9"}
  %reduce-window.175.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.25904.9, %constant_5429_24), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.175.9"}
  %slice.2438.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.175.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2438.7"}
  %bitcast.25910.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2438.7), metadata={scheduling_name="bitcast.25910.9"}
  %broadcast.5768.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.25910.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5768.9"}
  %add.3096.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.2745, %broadcast.5768.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3096.7"}
  %bitcast.25914.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.3096.7), metadata={scheduling_name="bitcast.25914.7"}
  %pad.362.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.25914.7, %constant_5429_24), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.362.7"}
  %slice.2439.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.362.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2439.5"}
  %bitcast.25918.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2439.5), metadata={scheduling_name="bitcast.25918.9"}
  %broadcast.5769.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.25918.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5769.9"}
  %add.3097.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.3516, %broadcast.5769.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3097.7"}
  %bitcast.25922.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.3097.7), metadata={scheduling_name="bitcast.25922.5"}
  %pad.363.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.25922.5, %constant_5429_24), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.363.5"}
  %slice.2440.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.363.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2440.1"}
  %bitcast.25926.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2440.1), metadata={scheduling_name="bitcast.25926.9"}
  %broadcast.5770.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.25926.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5770.9"}
  %add.3098.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.172.11, %broadcast.5770.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3098.7"}
  %bitcast.25930.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.3098.7), metadata={scheduling_name="bitcast.25930.6"}
  %constant_5444_1 = s32[] constant(2048)
  %broadcast.5746.6 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_5444_1), dimensions={}, metadata={scheduling_name="broadcast.5746.6"}
  %compare.1716.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.25930.6, %broadcast.5746.6), direction=LE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1716.3"}
  %bitcast.25936.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1716.3), metadata={scheduling_name="bitcast.25936.3"}
  %broadcast.5747.6 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_5429_24), dimensions={}, metadata={scheduling_name="broadcast.5747.6"}
  %select.1364.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.25936.3, %convert.4299.17, %broadcast.5747.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1364.3"}
  %bitcast.25943.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1364.3), metadata={scheduling_name="bitcast.25943.1"}
  %reduce.507.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25943.1, %constant_5429_24), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.507.1"}
  %bitcast.25957.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.4299.17), metadata={scheduling_name="bitcast.25957.3.clone.1"}
  %multiply.2734.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.25957.3.clone.1, %bitcast.25930.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2734.3.clone.1"}
  %bitcast.25963.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2734.3.clone.1), metadata={scheduling_name="bitcast.25963.1.clone.1"}
  %reduce.508.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25963.1.clone.1, %constant_5429_24), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.508.1.clone.1"}
  ROOT %tuple.545 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.507.1, %reduce.508.1.clone.1), metadata={scheduling_name="tuple.545"}
}

%fused_reduce_window (param_0.3341: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.3341 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3341"}
  %slice.2436.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.3341), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2436.1"}
  %bitcast.25896.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2436.1), metadata={scheduling_name="bitcast.25896.1"}
  %constant_5429_33 = s32[] constant(0)
  ROOT %reduce-window.174.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.25896.1, %constant_5429_33), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.174.1"}
}

%fused_reduce_window.1 (param_0.3343: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.3343 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3343"}
  %bitcast.25888.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.3343), metadata={scheduling_name="bitcast.25888.1"}
  %constant_5429_38 = s32[] constant(0)
  ROOT %reduce-window.173.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.25888.1, %constant_5429_38), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.173.1"}
}

%region_6.604 (Arg_0.605: bf16[], Arg_1.606: bf16[]) -> bf16[] {
  %Arg_1.606 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.606"}
  %Arg_0.605 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.605"}
  %convert.3884.0 = f32[] convert(%Arg_1.606), metadata={scheduling_name="convert.3884.0"}
  %convert.3883.0 = f32[] convert(%Arg_0.605), metadata={scheduling_name="convert.3883.0"}
  %add.2835.0 = f32[] add(%convert.3883.0, %convert.3884.0), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2835.0"}
  ROOT %convert.3885.0 = bf16[] convert(%add.2835.0), metadata={scheduling_name="convert.3885.0"}
}

%region_1.585 (Arg_0.586: f32[], Arg_1.587: f32[]) -> f32[] {
  %Arg_1.587 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_1.587"}
  %Arg_0.586 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_0.586"}
  ROOT %add.2834.0 = f32[] add(%Arg_0.586, %Arg_1.587), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.2834.0"}
}

%region_3.593 (Arg_0.594: f32[], Arg_1.595: f32[]) -> f32[] {
  %Arg_1.595 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" scheduling_name="Arg_1.595"}
  %Arg_0.594 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" scheduling_name="Arg_0.594"}
  ROOT %maximum.46.0 = f32[] maximum(%Arg_0.594, %Arg_1.595), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="maximum.46.0"}
}

%fused_scatter (param_0.2486: bf16[1,4,8192,8], param_1.2673: s32[65536,4], param_2.2515: u32[1,4,8192,2], param_3.1984: u32[1,4,8192,8], param_4.1845: s32[1,4,8192,2,1], param_5.1646: s32[1,4,8192,2,1], param_6.1582: s32[32768,2], param_7.1501: f32[32768,2], param_8.1330: u32[32], param_9.1000: u32[]) -> bf16[1,4,8192,8] {
  %param_0.2486 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2486"}
  %param_1.2673 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2673"}
  %param_2.2515 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2515"}
  %param_3.1984 = u32[1,4,8192,8]{3,2,1,0} parameter(3), metadata={scheduling_name="param_3.1984"}
  %param_5.1646 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(5), metadata={scheduling_name="param_5.1646"}
  %bitcast.24755.26 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_5.1646), metadata={scheduling_name="bitcast.24755.26"}
  %param_4.1845 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(4), metadata={scheduling_name="param_4.1845"}
  %bitcast.24757.26 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_4.1845), metadata={scheduling_name="bitcast.24757.26"}
  %param_6.1582 = s32[32768,2]{1,0} parameter(6), metadata={scheduling_name="param_6.1582"}
  %bitcast.25792.19 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_6.1582), metadata={scheduling_name="bitcast.25792.19"}
  %constant_5429_52 = s32[] constant(0)
  %broadcast.5734.14 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5429_52), dimensions={}, metadata={scheduling_name="broadcast.5734.14"}
  %compare.1713.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25792.19, %broadcast.5734.14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1713.7"}
  %constant_5441_1 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5735.14 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5441_1), dimensions={}, metadata={scheduling_name="broadcast.5735.14"}
  %add.3095.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25792.19, %broadcast.5735.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3095.7"}
  %select.1362.5 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1713.7, %add.3095.7, %bitcast.25792.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1362.5"}
  %bitcast.25805.13 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1362.5), metadata={scheduling_name="bitcast.25805.13"}
  %concatenate.724.13 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24755.26, %bitcast.24757.26, %bitcast.25805.13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.724.13"}
  %constant_5453_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_8.1330 = u32[32]{0} parameter(8), metadata={scheduling_name="param_8.1330"}
  %param_9.1000 = u32[] parameter(9), metadata={scheduling_name="param_9.1000"}
  %dynamic-slice.1552.9 = u32[1]{0} dynamic-slice(%param_8.1330, %param_9.1000), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1552.9"}
  %constant_5454_1 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.9 = u32[1]{0} clamp(%constant_5453_1, %dynamic-slice.1552.9, %constant_5454_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.9"}
  %convert.4238.9 = s32[1]{0} convert(%clamp.27.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4238.9"}
  %constant_5452_2 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2711.9 = s32[1]{0} multiply(%convert.4238.9, %constant_5452_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2711.9"}
  %constant_5440_6 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.3 = s32[3]{0} concatenate(%multiply.2711.9, %constant_5440_6, %constant_5440_6), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.3"}
  %broadcast.5736.22 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5736.22"}
  %subtract.266.11 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.724.13, %broadcast.5736.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.266.11"}
  %pad.361.8 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.266.11, %constant_5429_52), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.361.8"}
  %bitcast.25826.7 = s32[65536,4]{0,1} bitcast(%pad.361.8), metadata={scheduling_name="bitcast.25826.7"}
  %gather.364.7 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_3.1984, %bitcast.25826.7), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.364.7"}
  %bitcast.25829.5 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.364.7), metadata={scheduling_name="bitcast.25829.5"}
  %compare.1714.5 = pred[1,4,8192,2]{3,2,1,0} compare(%param_2.2515, %bitcast.25829.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1714.5"}
  %param_7.1501 = f32[32768,2]{1,0} parameter(7), metadata={scheduling_name="param_7.1501"}
  %bitcast.25834.9 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_7.1501), metadata={scheduling_name="bitcast.25834.9"}
  %constant_5443_1 = f32[] constant(-inf)
  %reduce.399.1 = f32[32768]{0} reduce(%param_7.1501, %constant_5443_1), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.399.1"}
  %bitcast.25842.9 = f32[4,8192]{1,0} bitcast(%reduce.399.1), metadata={scheduling_name="bitcast.25842.9"}
  %broadcast.5764.9 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.25842.9), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5764.9"}
  %subtract.267.9 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.25834.9, %broadcast.5764.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.267.9"}
  %exponential.98.7 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.267.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.98.7"}
  %bitcast.25850.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.98.7), metadata={scheduling_name="bitcast.25850.3"}
  %constant_5434_3 = f32[] constant(0)
  %reduce.434.3 = f32[4,8192]{1,0} reduce(%bitcast.25850.3, %constant_5434_3), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.434.3"}
  %broadcast.5765.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.434.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5765.5"}
  %divide.474.5 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.98.7, %broadcast.5765.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.474.5"}
  %convert.4297.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.474.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4297.3"}
  %constant_5432_3 = bf16[] constant(0)
  %broadcast.5740.2 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_5432_3), dimensions={}, metadata={scheduling_name="broadcast.5740.2"}
  %select.1363.3 = bf16[1,4,8192,2]{3,2,1,0} select(%compare.1714.5, %convert.4297.3, %broadcast.5740.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1363.3"}
  %bitcast.25862.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1363.3), metadata={scheduling_name="bitcast.25862.1"}
  ROOT %scatter.220.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.2486, %param_1.2673, %bitcast.25862.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.220.1"}
}

%fused_transpose.2 (param_0.3336: s32[1,4,8192,2,1], param_1.3485: s32[1,4,8192,2,1], param_2.2708: s32[32768,2], param_3.2306: u32[32], param_4.1933: u32[]) -> s32[65536,4] {
  %param_1.3485 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(1), metadata={scheduling_name="param_1.3485"}
  %bitcast.24755.10 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_1.3485), metadata={scheduling_name="bitcast.24755.10"}
  %param_0.3336 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(0), metadata={scheduling_name="param_0.3336"}
  %bitcast.24757.10 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.3336), metadata={scheduling_name="bitcast.24757.10"}
  %param_2.2708 = s32[32768,2]{1,0} parameter(2), metadata={scheduling_name="param_2.2708"}
  %bitcast.25792.13 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_2.2708), metadata={scheduling_name="bitcast.25792.13"}
  %constant_5429_13 = s32[] constant(0)
  %broadcast.5734.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5429_13), dimensions={}, metadata={scheduling_name="broadcast.5734.12"}
  %compare.1713.5 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25792.13, %broadcast.5734.12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1713.5"}
  %constant_5441_4 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5735.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5441_4), dimensions={}, metadata={scheduling_name="broadcast.5735.12"}
  %add.3095.5 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25792.13, %broadcast.5735.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3095.5"}
  %select.1362.3 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1713.5, %add.3095.5, %bitcast.25792.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1362.3"}
  %bitcast.25805.7 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1362.3), metadata={scheduling_name="bitcast.25805.7"}
  %concatenate.724.7 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24755.10, %bitcast.24757.10, %bitcast.25805.7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.724.7"}
  %constant_5453_4 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_3.2306 = u32[32]{0} parameter(3), metadata={scheduling_name="param_3.2306"}
  %param_4.1933 = u32[] parameter(4), metadata={scheduling_name="param_4.1933"}
  %dynamic-slice.1552.7 = u32[1]{0} dynamic-slice(%param_3.2306, %param_4.1933), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1552.7"}
  %constant_5454_4 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.7 = u32[1]{0} clamp(%constant_5453_4, %dynamic-slice.1552.7, %constant_5454_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.7"}
  %convert.4238.7 = s32[1]{0} convert(%clamp.27.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4238.7"}
  %constant_5452_6 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2711.7 = s32[1]{0} multiply(%convert.4238.7, %constant_5452_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2711.7"}
  %constant_5440_8 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.2 = s32[3]{0} concatenate(%multiply.2711.7, %constant_5440_8, %constant_5440_8), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.2"}
  %broadcast.5736.6 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.2), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5736.6"}
  %subtract.266.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.724.7, %broadcast.5736.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.266.5"}
  %pad.361.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.266.5, %constant_5429_13), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.361.1"}
  %bitcast.25810.1 = s32[4,65536]{1,0} bitcast(%pad.361.1), metadata={scheduling_name="bitcast.25810.1"}
  ROOT %transpose.760.1 = s32[65536,4]{1,0} transpose(%bitcast.25810.1), dimensions={1,0}, metadata={scheduling_name="transpose.760.1"}
}

%fused_reduce.1 (param_0.3352: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.3352 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.3352"}
  %bitcast.25722.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3352), metadata={scheduling_name="bitcast.25722.9"}
  %convert.4289.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25722.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4289.9"}
  %multiply.2729.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4289.9, %convert.4289.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2729.3"}
  %bitcast.25729.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2729.3), metadata={scheduling_name="bitcast.25729.1"}
  %constant_5434_2 = f32[] constant(0)
  ROOT %reduce.433.1 = f32[4,8192]{1,0} reduce(%bitcast.25729.1, %constant_5434_2), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.433.1"}
}

%fused_dynamic_slice (param_0.3339: bf16[1,2,48,128,768], param_1.3540: s32[1], param_2.2801: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.3339 = bf16[1,2,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3339"}
  %bitcast.25703.1 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param_0.3339), metadata={scheduling_name="bitcast.25703.1"}
  %constant_5429_21 = s32[] constant(0)
  %constant_5451_15 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2801 = s32[] parameter(2), metadata={scheduling_name="param_2.2801"}
  %bitcast.24889.38 = s32[1]{0} bitcast(%param_2.2801), metadata={scheduling_name="bitcast.24889.38"}
  %param_1.3540 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3540"}
  %subtract.259.37 = s32[1]{0} subtract(%bitcast.24889.38, %param_1.3540), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.37"}
  %constant_5440_21 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.31 = s32[1]{0} maximum(%subtract.259.37, %constant_5440_21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.31"}
  %sign.28.30 = s32[1]{0} sign(%maximum.48.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.30"}
  %constant_5447_16 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.30 = pred[1]{0} compare(%sign.28.30, %constant_5447_16), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.30"}
  %constant_5448_17 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.31 = s32[1]{0} and(%maximum.48.31, %constant_5448_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.31"}
  %compare.1703.31 = pred[1]{0} compare(%and.321.31, %constant_5440_21), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.31"}
  %and.322.30 = pred[1]{0} and(%compare.1702.30, %compare.1703.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.30"}
  %constant_5449_16 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.30 = s32[1]{0} shift-right-logical(%maximum.48.31, %constant_5449_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.30"}
  %constant_5450_16 = s32[1]{0} constant({-1})
  %add.3079.30 = s32[1]{0} add(%shift-right-logical.21.30, %constant_5450_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.30"}
  %select.1355.30 = s32[1]{0} select(%and.322.30, %add.3079.30, %shift-right-logical.21.30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.30"}
  %compare.1704.30 = pred[1]{0} compare(%select.1355.30, %constant_5440_21), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.30"}
  %add.3080.30 = s32[1]{0} add(%select.1355.30, %constant_5449_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.30"}
  %select.1356.30 = s32[1]{0} select(%compare.1704.30, %add.3080.30, %select.1355.30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.30"}
  %bitcast.24921.37 = s32[1,1]{1,0} bitcast(%select.1356.30), metadata={scheduling_name="bitcast.24921.37"}
  %concatenate.716.27 = s32[1,5]{1,0} concatenate(%constant_5451_15, %bitcast.24921.37, %constant_5451_15, %constant_5451_15, %constant_5451_15), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.27"}
  %bitcast.24949.25 = s32[5]{0} bitcast(%concatenate.716.27), metadata={scheduling_name="bitcast.24949.25"}
  %slice.2414.25 = s32[1]{0} slice(%bitcast.24949.25), slice={[1:2]}, metadata={scheduling_name="slice.2414.25"}
  %bitcast.26052.11 = s32[] bitcast(%slice.2414.25), metadata={scheduling_name="bitcast.26052.11"}
  ROOT %dynamic-slice.1560.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.25703.1, %constant_5429_21, %bitcast.26052.11, %constant_5429_21, %constant_5429_21, /*index=5*/%constant_5429_21), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1560.1"}
}

%fused_reduce.2 (param_0.3351: bf16[4,8192,6144]) -> f32[4,8192] {
  %param_0.3351 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.3351"}
  %bitcast.25529.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3351), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/reduce_precision" source_file="/workspace/maxtext/MaxText/layers/mixtral.py" source_line=64 scheduling_name="bitcast.25529.9"}
  %convert.4259.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25529.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4259.9"}
  %multiply.2717.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4259.9, %convert.4259.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2717.3"}
  %bitcast.25537.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2717.3), metadata={scheduling_name="bitcast.25537.1"}
  %constant_5434_1 = f32[] constant(0)
  ROOT %reduce.432.1 = f32[4,8192]{1,0} reduce(%bitcast.25537.1, %constant_5434_1), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.432.1"}
}

%fused_transpose.3 (param_0.2538: bf16[1,1,1,8,4,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.2538 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.2538"}
  %bitcast.25518.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.2538), metadata={scheduling_name="bitcast.25518.1"}
  ROOT %transpose.759.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.25518.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.759.1"}
}

%fused_transpose.4 (param_0.2544: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.2544 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2544"}
  %bitcast.25460.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.2544), metadata={scheduling_name="bitcast.25460.1"}
  ROOT %transpose.758.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.25460.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.758.1"}
}

%fused_convert_transpose.1 (param_0.3015: s32[1,1,1,1,2049], param_1.3112: s32[1,4,8,8192], param_2.2324: bf16[1,4,8,8192]) -> (bf16[4,16384,8192], bf16[4,8192,16384]) {
  %param_2.2324 = bf16[1,4,8,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2324"}
  %bitcast.25404.8 = bf16[4,8,8192]{2,1,0} bitcast(%param_2.2324), metadata={scheduling_name="bitcast.25404.8"}
  %convert.5006.5 = f32[4,8,8192]{2,1,0} convert(%bitcast.25404.8), metadata={scheduling_name="convert.5006.5"}
  %broadcast.6060.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.5006.5), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6060.11"}
  %param_1.3112 = s32[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3112"}
  %bitcast.25426.9 = s32[4,8,8192]{2,1,0} bitcast(%param_1.3112), metadata={scheduling_name="bitcast.25426.9"}
  %broadcast.5749.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25426.9), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5749.9"}
  %param_0.3015 = s32[1,1,1,1,2049]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3015"}
  %bitcast.25431.17 = s32[2049]{0} bitcast(%param_0.3015), metadata={scheduling_name="bitcast.25431.17"}
  %broadcast.5750.17 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.25431.17), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5750.17"}
  %compare.1711.7 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5749.9, %broadcast.5750.17), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1711.7"}
  %convert.4247.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1711.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4247.9"}
  %convert.4249.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4247.9), metadata={scheduling_name="convert.4249.9"}
  %multiply.2715.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6060.11, %convert.4249.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2715.11"}
  %convert.4250.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2715.11), metadata={scheduling_name="convert.4250.9"}
  %slice.2428.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4250.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2428.7"}
  %convert.4252.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2428.7), metadata={scheduling_name="convert.4252.3"}
  %constant_5432_1 = bf16[] constant(0)
  %convert.5007.2 = f32[] convert(%constant_5432_1), metadata={scheduling_name="convert.5007.2"}
  %broadcast.6062.6 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.5007.2), dimensions={}, metadata={scheduling_name="broadcast.6062.6"}
  %compare.1712.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4252.3, %broadcast.6062.6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1712.3"}
  %bitcast.25451.1 = pred[4,16384,8192]{2,1,0} bitcast(%compare.1712.3), metadata={scheduling_name="bitcast.25451.1"}
  %convert.4254.1 = bf16[4,16384,8192]{2,1,0} convert(%bitcast.25451.1), metadata={scheduling_name="convert.4254.1"}
  %bitcast.25440.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2428.7), metadata={scheduling_name="bitcast.25440.1.clone.1"}
  %transpose.757.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.25440.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.757.1.clone.1"}
  ROOT %tuple.546 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4254.1, %transpose.757.1.clone.1), metadata={scheduling_name="tuple.546"}
}

%fused_multiply_transpose.1 (param_0.2565: s32[4,8,8192], param_1.2704: s32[4,8,8192], param_2.4745: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.2565 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2565"}
  %bitcast.25421.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.2565), metadata={scheduling_name="bitcast.25421.1"}
  %param_1.2704 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2704"}
  %bitcast.25399.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.2704), metadata={scheduling_name="bitcast.25399.2"}
  %multiply.2714.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.25421.1, %bitcast.25399.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2714.1"}
  %param_2.4745 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4745"}
  %bitcast.25316.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4745), metadata={scheduling_name="bitcast.25316.3.clone.1"}
  %transpose.756.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.25316.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.756.3.clone.1"}
  %bitcast.25319.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.756.3.clone.1), metadata={scheduling_name="bitcast.25319.5.clone.1"}
  %convert.4241.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25319.5.clone.1), metadata={scheduling_name="convert.4241.5.clone.1"}
  %convert.4244.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.25399.2), metadata={scheduling_name="convert.4244.3.clone.1"}
  %multiply.2712.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4241.5.clone.1, %convert.4244.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2712.3.clone.1"}
  %convert.4245.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2712.3.clone.1), metadata={scheduling_name="convert.4245.1.clone.1"}
  ROOT %tuple.547 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2714.1, %convert.4245.1.clone.1), metadata={scheduling_name="tuple.547"}
}

%fused_reduce.3 (param_0.3348: pred[1,4,8,8192,2], param_1.3517: s32[1,4,8,64,16], param_2.2746: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.3348 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3348"}
  %convert.4243.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3348), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4243.17"}
  %bitcast.25334.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4243.17), metadata={scheduling_name="bitcast.25334.11"}
  %constant_5429_49 = s32[] constant(0)
  %reduce-window.168.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25334.11, %constant_5429_49), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.168.11"}
  %param_1.3517 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3517"}
  %param_2.2746 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2746"}
  %slice.2424.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.2746), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2424.7"}
  %bitcast.25358.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2424.7), metadata={scheduling_name="bitcast.25358.9"}
  %reduce-window.171.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.25358.9, %constant_5429_49), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.171.9"}
  %slice.2425.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.171.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2425.7"}
  %bitcast.25364.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2425.7), metadata={scheduling_name="bitcast.25364.9"}
  %broadcast.5743.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.25364.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5743.9"}
  %add.3088.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.2746, %broadcast.5743.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3088.7"}
  %bitcast.25368.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.3088.7), metadata={scheduling_name="bitcast.25368.7"}
  %pad.359.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.25368.7, %constant_5429_49), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.359.7"}
  %slice.2426.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.359.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2426.5"}
  %bitcast.25372.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2426.5), metadata={scheduling_name="bitcast.25372.9"}
  %broadcast.5744.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.25372.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5744.9"}
  %add.3089.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.3517, %broadcast.5744.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3089.7"}
  %bitcast.25376.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.3089.7), metadata={scheduling_name="bitcast.25376.5"}
  %pad.360.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.25376.5, %constant_5429_49), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.360.5"}
  %slice.2427.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.360.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2427.1"}
  %bitcast.25380.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2427.1), metadata={scheduling_name="bitcast.25380.9"}
  %broadcast.5745.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.25380.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5745.9"}
  %add.3090.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.168.11, %broadcast.5745.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3090.7"}
  %bitcast.25384.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.3090.7), metadata={scheduling_name="bitcast.25384.6"}
  %constant_5444_2 = s32[] constant(2048)
  %broadcast.5746.4 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_5444_2), dimensions={}, metadata={scheduling_name="broadcast.5746.4"}
  %compare.1710.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.25384.6, %broadcast.5746.4), direction=LE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1710.3"}
  %bitcast.25389.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1710.3), metadata={scheduling_name="bitcast.25389.3"}
  %broadcast.5747.4 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_5429_49), dimensions={}, metadata={scheduling_name="broadcast.5747.4"}
  %select.1361.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.25389.3, %convert.4243.17, %broadcast.5747.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1361.3"}
  %bitcast.25396.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1361.3), metadata={scheduling_name="bitcast.25396.1"}
  %reduce.505.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25396.1, %constant_5429_49), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.505.1"}
  %bitcast.25410.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.4243.17), metadata={scheduling_name="bitcast.25410.3.clone.1"}
  %multiply.2713.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.25410.3.clone.1, %bitcast.25384.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2713.3.clone.1"}
  %bitcast.25416.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2713.3.clone.1), metadata={scheduling_name="bitcast.25416.1.clone.1"}
  %reduce.506.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.25416.1.clone.1, %constant_5429_49), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.506.1.clone.1"}
  ROOT %tuple.548 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.505.1, %reduce.506.1.clone.1), metadata={scheduling_name="tuple.548"}
}

%fused_reduce_window.2 (param_0.3342: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.3342 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3342"}
  %slice.2423.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.3342), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2423.1"}
  %bitcast.25350.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2423.1), metadata={scheduling_name="bitcast.25350.1"}
  %constant_5429_36 = s32[] constant(0)
  ROOT %reduce-window.170.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.25350.1, %constant_5429_36), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.170.1"}
}

%fused_reduce_window.3 (param_0.3344: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.3344 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3344"}
  %bitcast.25342.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.3344), metadata={scheduling_name="bitcast.25342.1"}
  %constant_5429_40 = s32[] constant(0)
  ROOT %reduce-window.169.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.25342.1, %constant_5429_40), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.169.1"}
}

%fused_scatter.1 (param_0.2599: bf16[1,4,8192,8], param_1.2724: s32[65536,4], param_2.2518: u32[1,4,8192,2], param_3.1985: u32[1,4,8192,8], param_4.1846: s32[1,4,8192,2,1], param_5.1647: s32[1,4,8192,2,1], param_6.1583: s32[32768,2], param_7.1502: f32[32768,2], param_8.1331: u32[32], param_9.1001: u32[]) -> bf16[1,4,8192,8] {
  %param_0.2599 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2599"}
  %param_1.2724 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2724"}
  %param_2.2518 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2518"}
  %param_3.1985 = u32[1,4,8192,8]{3,2,1,0} parameter(3), metadata={scheduling_name="param_3.1985"}
  %param_5.1647 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(5), metadata={scheduling_name="param_5.1647"}
  %bitcast.24755.22 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_5.1647), metadata={scheduling_name="bitcast.24755.22"}
  %param_4.1846 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(4), metadata={scheduling_name="param_4.1846"}
  %bitcast.24757.22 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_4.1846), metadata={scheduling_name="bitcast.24757.22"}
  %param_6.1583 = s32[32768,2]{1,0} parameter(6), metadata={scheduling_name="param_6.1583"}
  %bitcast.25228.19 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_6.1583), metadata={scheduling_name="bitcast.25228.19"}
  %constant_5429_53 = s32[] constant(0)
  %broadcast.5734.8 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5429_53), dimensions={}, metadata={scheduling_name="broadcast.5734.8"}
  %compare.1707.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25228.19, %broadcast.5734.8), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1707.7"}
  %constant_5441_2 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5735.10 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5441_2), dimensions={}, metadata={scheduling_name="broadcast.5735.10"}
  %add.3087.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25228.19, %broadcast.5735.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3087.7"}
  %select.1359.5 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1707.7, %add.3087.7, %bitcast.25228.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1359.5"}
  %bitcast.25240.13 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1359.5), metadata={scheduling_name="bitcast.25240.13"}
  %concatenate.720.13 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24755.22, %bitcast.24757.22, %bitcast.25240.13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.720.13"}
  %constant_5453_2 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_8.1331 = u32[32]{0} parameter(8), metadata={scheduling_name="param_8.1331"}
  %param_9.1001 = u32[] parameter(9), metadata={scheduling_name="param_9.1001"}
  %dynamic-slice.1552.3 = u32[1]{0} dynamic-slice(%param_8.1331, %param_9.1001), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1552.3"}
  %constant_5454_2 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.3 = u32[1]{0} clamp(%constant_5453_2, %dynamic-slice.1552.3, %constant_5454_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.3"}
  %convert.4238.3 = s32[1]{0} convert(%clamp.27.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4238.3"}
  %constant_5452_4 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2711.3 = s32[1]{0} multiply(%convert.4238.3, %constant_5452_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2711.3"}
  %constant_5440_5 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.4 = s32[3]{0} concatenate(%multiply.2711.3, %constant_5440_5, %constant_5440_5), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.4"}
  %broadcast.5736.18 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5736.18"}
  %subtract.262.11 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.720.13, %broadcast.5736.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.262.11"}
  %pad.358.8 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.262.11, %constant_5429_53), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.358.8"}
  %bitcast.25278.7 = s32[65536,4]{0,1} bitcast(%pad.358.8), metadata={scheduling_name="bitcast.25278.7"}
  %gather.363.7 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_3.1985, %bitcast.25278.7), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.363.7"}
  %bitcast.25281.5 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.363.7), metadata={scheduling_name="bitcast.25281.5"}
  %compare.1708.5 = pred[1,4,8192,2]{3,2,1,0} compare(%param_2.2518, %bitcast.25281.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1708.5"}
  %param_7.1502 = f32[32768,2]{1,0} parameter(7), metadata={scheduling_name="param_7.1502"}
  %bitcast.25286.9 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_7.1502), metadata={scheduling_name="bitcast.25286.9"}
  %constant_5443_2 = f32[] constant(-inf)
  %reduce.393.1 = f32[32768]{0} reduce(%param_7.1502, %constant_5443_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.393.1"}
  %bitcast.25293.9 = f32[4,8192]{1,0} bitcast(%reduce.393.1), metadata={scheduling_name="bitcast.25293.9"}
  %broadcast.5738.9 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.25293.9), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5738.9"}
  %subtract.263.9 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.25286.9, %broadcast.5738.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.263.9"}
  %exponential.97.7 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.263.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.97.7"}
  %bitcast.25301.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.97.7), metadata={scheduling_name="bitcast.25301.3"}
  %constant_5434_6 = f32[] constant(0)
  %reduce.429.3 = f32[4,8192]{1,0} reduce(%bitcast.25301.3, %constant_5434_6), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.429.3"}
  %broadcast.5739.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.429.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5739.5"}
  %divide.473.5 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.97.7, %broadcast.5739.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.473.5"}
  %convert.4240.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.473.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4240.3"}
  %constant_5432_6 = bf16[] constant(0)
  %broadcast.5740.1 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_5432_6), dimensions={}, metadata={scheduling_name="broadcast.5740.1"}
  %select.1360.3 = bf16[1,4,8192,2]{3,2,1,0} select(%compare.1708.5, %convert.4240.3, %broadcast.5740.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1360.3"}
  %bitcast.25313.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1360.3), metadata={scheduling_name="bitcast.25313.1"}
  ROOT %scatter.218.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.2599, %param_1.2724, %bitcast.25313.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.218.1"}
}

%region_5.601 (Arg_0.602: u32[], Arg_1.603: u32[]) -> u32[] {
  ROOT %Arg_1.603 = u32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" scheduling_name="Arg_1.603"}
  %Arg_0.602 = u32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" scheduling_name="Arg_0.602"}
}

%fused_scatter.2 (param_0.2608: u32[1,4,8192,8], param_1.2733: s32[65536,4], param_2.2088: u32[1,4,8192,2]) -> u32[1,4,8192,8] {
  %param_0.2608 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2608"}
  %param_1.2733 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2733"}
  %param_2.2088 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2088"}
  %bitcast.25272.1 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%param_2.2088), metadata={scheduling_name="bitcast.25272.1"}
  ROOT %scatter.217.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.2608, %param_1.2733, %bitcast.25272.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.217.1"}
}

%fused_scatter.3 (param_0.2609: u32[1,4,8192,8], param_1.2734: s32[65536,4], param_2.2090: u32[1,4,8192,2]) -> u32[1,4,8192,8] {
  %param_0.2609 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2609"}
  %param_1.2734 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.2734"}
  %param_2.2090 = u32[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2090"}
  %bitcast.25272.2 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%param_2.2090), metadata={scheduling_name="bitcast.25272.2"}
  ROOT %scatter.219.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.2609, %param_1.2734, %bitcast.25272.2), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.219.1"}
}

%fused_transpose.5 (param_0.3337: s32[1,4,8192,2,1], param_1.3486: s32[1,4,8192,2,1], param_2.2709: s32[32768,2], param_3.2305: u32[32], param_4.1932: u32[]) -> s32[65536,4] {
  %param_1.3486 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(1), metadata={scheduling_name="param_1.3486"}
  %bitcast.24755.14 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_1.3486), metadata={scheduling_name="bitcast.24755.14"}
  %param_0.3337 = s32[1,4,8192,2,1]{3,2,1,4,0} parameter(0), metadata={scheduling_name="param_0.3337"}
  %bitcast.24757.14 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.3337), metadata={scheduling_name="bitcast.24757.14"}
  %param_2.2709 = s32[32768,2]{1,0} parameter(2), metadata={scheduling_name="param_2.2709"}
  %bitcast.25228.13 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_2.2709), metadata={scheduling_name="bitcast.25228.13"}
  %constant_5429_14 = s32[] constant(0)
  %broadcast.5734.6 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5429_14), dimensions={}, metadata={scheduling_name="broadcast.5734.6"}
  %compare.1707.5 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.25228.13, %broadcast.5734.6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1707.5"}
  %constant_5441_3 = s32[] constant(8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %broadcast.5735.8 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_5441_3), dimensions={}, metadata={scheduling_name="broadcast.5735.8"}
  %add.3087.5 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.25228.13, %broadcast.5735.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3087.5"}
  %select.1359.3 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1707.5, %add.3087.5, %bitcast.25228.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1359.3"}
  %bitcast.25240.7 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1359.3), metadata={scheduling_name="bitcast.25240.7"}
  %concatenate.720.7 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%bitcast.24755.14, %bitcast.24757.14, %bitcast.25240.7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.720.7"}
  %constant_5453_3 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param_3.2305 = u32[32]{0} parameter(3), metadata={scheduling_name="param_3.2305"}
  %param_4.1932 = u32[] parameter(4), metadata={scheduling_name="param_4.1932"}
  %dynamic-slice.1552.5 = u32[1]{0} dynamic-slice(%param_3.2305, %param_4.1932), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1552.5"}
  %constant_5454_3 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.27.5 = u32[1]{0} clamp(%constant_5453_3, %dynamic-slice.1552.5, %constant_5454_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.27.5"}
  %convert.4238.5 = s32[1]{0} convert(%clamp.27.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4238.5"}
  %constant_5452_5 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %multiply.2711.5 = s32[1]{0} multiply(%convert.4238.5, %constant_5452_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2711.5"}
  %constant_5440_7 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.721.1 = s32[3]{0} concatenate(%multiply.2711.5, %constant_5440_7, %constant_5440_7), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.721.1"}
  %broadcast.5736.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.721.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5736.10"}
  %subtract.262.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.720.7, %broadcast.5736.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.262.5"}
  %pad.358.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.262.5, %constant_5429_14), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.358.1"}
  %bitcast.25260.1 = s32[4,65536]{1,0} bitcast(%pad.358.1), metadata={scheduling_name="bitcast.25260.1"}
  ROOT %transpose.755.1 = s32[65536,4]{1,0} transpose(%bitcast.25260.1), dimensions={1,0}, metadata={scheduling_name="transpose.755.1"}
}

%fused_dynamic_slice.1 (param_0.2618: bf16[1,2,768,8], param_1.3526: s32[1], param_2.2787: s32[]) -> bf16[1,1,768,8] {
  %param_0.2618 = bf16[1,2,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2618"}
  %constant_5429_3 = s32[] constant(0)
  %constant_5451_1 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2787 = s32[] parameter(2), metadata={scheduling_name="param_2.2787"}
  %bitcast.24889.12 = s32[1]{0} bitcast(%param_2.2787), metadata={scheduling_name="bitcast.24889.12"}
  %param_1.3526 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3526"}
  %subtract.259.11 = s32[1]{0} subtract(%bitcast.24889.12, %param_1.3526), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.11"}
  %constant_5440_2 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.4 = s32[1]{0} maximum(%subtract.259.11, %constant_5440_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.4"}
  %sign.28.3 = s32[1]{0} sign(%maximum.48.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.3"}
  %constant_5447_3 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.2 = pred[1]{0} compare(%sign.28.3, %constant_5447_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.2"}
  %constant_5448_5 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.4 = s32[1]{0} and(%maximum.48.4, %constant_5448_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.4"}
  %compare.1703.3 = pred[1]{0} compare(%and.321.4, %constant_5440_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.3"}
  %and.322.1 = pred[1]{0} and(%compare.1702.2, %compare.1703.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.1"}
  %constant_5449_4 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.1 = s32[1]{0} shift-right-logical(%maximum.48.4, %constant_5449_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.1"}
  %constant_5450_2 = s32[1]{0} constant({-1})
  %add.3079.1 = s32[1]{0} add(%shift-right-logical.21.1, %constant_5450_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.1"}
  %select.1355.4 = s32[1]{0} select(%and.322.1, %add.3079.1, %shift-right-logical.21.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.4"}
  %compare.1704.2 = pred[1]{0} compare(%select.1355.4, %constant_5440_2), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.2"}
  %add.3080.2 = s32[1]{0} add(%select.1355.4, %constant_5449_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.2"}
  %select.1356.1 = s32[1]{0} select(%compare.1704.2, %add.3080.2, %select.1355.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.1"}
  %bitcast.24921.9 = s32[1,1]{1,0} bitcast(%select.1356.1), metadata={scheduling_name="bitcast.24921.9"}
  %concatenate.719.7 = s32[1,4]{1,0} concatenate(%constant_5451_1, %bitcast.24921.9, %constant_5451_1, %constant_5451_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.719.7"}
  %bitcast.25201.5 = s32[4]{0} bitcast(%concatenate.719.7), metadata={scheduling_name="bitcast.25201.5"}
  %slice.2419.5 = s32[1]{0} slice(%bitcast.25201.5), slice={[1:2]}, metadata={scheduling_name="slice.2419.5"}
  %bitcast.25769.1 = s32[] bitcast(%slice.2419.5), metadata={scheduling_name="bitcast.25769.1"}
  ROOT %dynamic-slice.1551.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_0.2618, %constant_5429_3, %bitcast.25769.1, %constant_5429_3, %constant_5429_3), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1551.1"}
}

%fused_dynamic_slice.2 (param_0.2619: bf16[1,2,768,8], param_1.3528: s32[1], param_2.2789: s32[]) -> bf16[1,1,768,8] {
  %param_0.2619 = bf16[1,2,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2619"}
  %constant_5429_25 = s32[] constant(0)
  %constant_5451_3 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2789 = s32[] parameter(2), metadata={scheduling_name="param_2.2789"}
  %bitcast.24889.4 = s32[1]{0} bitcast(%param_2.2789), metadata={scheduling_name="bitcast.24889.4"}
  %param_1.3528 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3528"}
  %subtract.259.3 = s32[1]{0} subtract(%bitcast.24889.4, %param_1.3528), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.3"}
  %constant_5440_9 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.5 = s32[1]{0} maximum(%subtract.259.3, %constant_5440_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.5"}
  %sign.28.2 = s32[1]{0} sign(%maximum.48.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.2"}
  %constant_5447_2 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.1 = pred[1]{0} compare(%sign.28.2, %constant_5447_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.1"}
  %constant_5448_4 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.3 = s32[1]{0} and(%maximum.48.5, %constant_5448_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.3"}
  %compare.1703.2 = pred[1]{0} compare(%and.321.3, %constant_5440_9), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.2"}
  %and.322.4 = pred[1]{0} and(%compare.1702.1, %compare.1703.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.4"}
  %constant_5449_3 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.2 = s32[1]{0} shift-right-logical(%maximum.48.5, %constant_5449_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.2"}
  %constant_5450_1 = s32[1]{0} constant({-1})
  %add.3079.4 = s32[1]{0} add(%shift-right-logical.21.2, %constant_5450_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.4"}
  %select.1355.3 = s32[1]{0} select(%and.322.4, %add.3079.4, %shift-right-logical.21.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.3"}
  %compare.1704.1 = pred[1]{0} compare(%select.1355.3, %constant_5440_9), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.1"}
  %add.3080.1 = s32[1]{0} add(%select.1355.3, %constant_5449_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.1"}
  %select.1356.4 = s32[1]{0} select(%compare.1704.1, %add.3080.1, %select.1355.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.4"}
  %bitcast.24921.7 = s32[1,1]{1,0} bitcast(%select.1356.4), metadata={scheduling_name="bitcast.24921.7"}
  %concatenate.719.5 = s32[1,4]{1,0} concatenate(%constant_5451_3, %bitcast.24921.7, %constant_5451_3, %constant_5451_3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.719.5"}
  %bitcast.25201.3 = s32[4]{0} bitcast(%concatenate.719.5), metadata={scheduling_name="bitcast.25201.3"}
  %slice.2419.3 = s32[1]{0} slice(%bitcast.25201.3), slice={[1:2]}, metadata={scheduling_name="slice.2419.3"}
  %bitcast.25769.2 = s32[] bitcast(%slice.2419.3), metadata={scheduling_name="bitcast.25769.2"}
  ROOT %dynamic-slice.1562.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_0.2619, %constant_5429_25, %bitcast.25769.2, %constant_5429_25, %constant_5429_25), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1562.1"}
}

%fused_reduce.4 (param_0.3354: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.3354 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.3354"}
  %bitcast.25150.9 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.3354), metadata={scheduling_name="bitcast.25150.9"}
  %convert.4231.9 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25150.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4231.9"}
  %multiply.2707.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4231.9, %convert.4231.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2707.3"}
  %bitcast.25157.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2707.3), metadata={scheduling_name="bitcast.25157.1"}
  %constant_5434_5 = f32[] constant(0)
  ROOT %reduce.428.1 = f32[4,8192]{1,0} reduce(%bitcast.25157.1, %constant_5434_5), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.428.1"}
}

%fused_dynamic_slice.3 (param_0.3334: bf16[1,2,48,128,768], param_1.3533: s32[1], param_2.2794: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.3334 = bf16[1,2,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3334"}
  %bitcast.25131.1 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param_0.3334), metadata={scheduling_name="bitcast.25131.1"}
  %constant_5429_7 = s32[] constant(0)
  %constant_5451_8 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2794 = s32[] parameter(2), metadata={scheduling_name="param_2.2794"}
  %bitcast.24889.24 = s32[1]{0} bitcast(%param_2.2794), metadata={scheduling_name="bitcast.24889.24"}
  %param_1.3533 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3533"}
  %subtract.259.23 = s32[1]{0} subtract(%bitcast.24889.24, %param_1.3533), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.23"}
  %constant_5440_14 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.17 = s32[1]{0} maximum(%subtract.259.23, %constant_5440_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.17"}
  %sign.28.16 = s32[1]{0} sign(%maximum.48.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.16"}
  %constant_5447_9 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.16 = pred[1]{0} compare(%sign.28.16, %constant_5447_9), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.16"}
  %constant_5448_10 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.17 = s32[1]{0} and(%maximum.48.17, %constant_5448_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.17"}
  %compare.1703.17 = pred[1]{0} compare(%and.321.17, %constant_5440_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.17"}
  %and.322.16 = pred[1]{0} and(%compare.1702.16, %compare.1703.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.16"}
  %constant_5449_9 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.16 = s32[1]{0} shift-right-logical(%maximum.48.17, %constant_5449_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.16"}
  %constant_5450_9 = s32[1]{0} constant({-1})
  %add.3079.16 = s32[1]{0} add(%shift-right-logical.21.16, %constant_5450_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.16"}
  %select.1355.16 = s32[1]{0} select(%and.322.16, %add.3079.16, %shift-right-logical.21.16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.16"}
  %compare.1704.16 = pred[1]{0} compare(%select.1355.16, %constant_5440_14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.16"}
  %add.3080.16 = s32[1]{0} add(%select.1355.16, %constant_5449_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.16"}
  %select.1356.16 = s32[1]{0} select(%compare.1704.16, %add.3080.16, %select.1355.16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.16"}
  %bitcast.24921.23 = s32[1,1]{1,0} bitcast(%select.1356.16), metadata={scheduling_name="bitcast.24921.23"}
  %concatenate.716.13 = s32[1,5]{1,0} concatenate(%constant_5451_8, %bitcast.24921.23, %constant_5451_8, %constant_5451_8, %constant_5451_8), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.13"}
  %bitcast.24949.11 = s32[5]{0} bitcast(%concatenate.716.13), metadata={scheduling_name="bitcast.24949.11"}
  %slice.2414.11 = s32[1]{0} slice(%bitcast.24949.11), slice={[1:2]}, metadata={scheduling_name="slice.2414.11"}
  %bitcast.26052.4 = s32[] bitcast(%slice.2414.11), metadata={scheduling_name="bitcast.26052.4"}
  ROOT %dynamic-slice.1549.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.25131.1, %constant_5429_7, %bitcast.26052.4, %constant_5429_7, %constant_5429_7, /*index=5*/%constant_5429_7), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1549.1"}
}

%fused_dynamic_slice.4 (param_0.2661: bf16[1,2,768,48,128], param_1.3530: s32[1], param_2.2791: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.2661 = bf16[1,2,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2661"}
  %constant_5429_23 = s32[] constant(0)
  %constant_5451_5 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2791 = s32[] parameter(2), metadata={scheduling_name="param_2.2791"}
  %bitcast.24889.18 = s32[1]{0} bitcast(%param_2.2791), metadata={scheduling_name="bitcast.24889.18"}
  %param_1.3530 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3530"}
  %subtract.259.17 = s32[1]{0} subtract(%bitcast.24889.18, %param_1.3530), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.17"}
  %constant_5440_11 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.11 = s32[1]{0} maximum(%subtract.259.17, %constant_5440_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.11"}
  %sign.28.10 = s32[1]{0} sign(%maximum.48.11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.10"}
  %constant_5447_6 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.10 = pred[1]{0} compare(%sign.28.10, %constant_5447_6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.10"}
  %constant_5448_7 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.11 = s32[1]{0} and(%maximum.48.11, %constant_5448_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.11"}
  %compare.1703.11 = pred[1]{0} compare(%and.321.11, %constant_5440_11), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.11"}
  %and.322.10 = pred[1]{0} and(%compare.1702.10, %compare.1703.11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.10"}
  %constant_5449_6 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.10 = s32[1]{0} shift-right-logical(%maximum.48.11, %constant_5449_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.10"}
  %constant_5450_6 = s32[1]{0} constant({-1})
  %add.3079.10 = s32[1]{0} add(%shift-right-logical.21.10, %constant_5450_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.10"}
  %select.1355.10 = s32[1]{0} select(%and.322.10, %add.3079.10, %shift-right-logical.21.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.10"}
  %compare.1704.10 = pred[1]{0} compare(%select.1355.10, %constant_5440_11), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.10"}
  %add.3080.10 = s32[1]{0} add(%select.1355.10, %constant_5449_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.10"}
  %select.1356.10 = s32[1]{0} select(%compare.1704.10, %add.3080.10, %select.1355.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.10"}
  %bitcast.24921.17 = s32[1,1]{1,0} bitcast(%select.1356.10), metadata={scheduling_name="bitcast.24921.17"}
  %concatenate.716.7 = s32[1,5]{1,0} concatenate(%constant_5451_5, %bitcast.24921.17, %constant_5451_5, %constant_5451_5, %constant_5451_5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.7"}
  %bitcast.24949.5 = s32[5]{0} bitcast(%concatenate.716.7), metadata={scheduling_name="bitcast.24949.5"}
  %slice.2414.5 = s32[1]{0} slice(%bitcast.24949.5), slice={[1:2]}, metadata={scheduling_name="slice.2414.5"}
  %bitcast.26052.1 = s32[] bitcast(%slice.2414.5), metadata={scheduling_name="bitcast.26052.1"}
  ROOT %dynamic-slice.1545.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_0.2661, %constant_5429_23, %bitcast.26052.1, %constant_5429_23, %constant_5429_23, /*index=5*/%constant_5429_23), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1545.1"}
}

%fused_dynamic_slice.5 (param_0.2662: bf16[1,2,768,8,128], param_1.3531: s32[1], param_2.2792: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2662 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2662"}
  %constant_5429_9 = s32[] constant(0)
  %constant_5451_6 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2792 = s32[] parameter(2), metadata={scheduling_name="param_2.2792"}
  %bitcast.24889.20 = s32[1]{0} bitcast(%param_2.2792), metadata={scheduling_name="bitcast.24889.20"}
  %param_1.3531 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3531"}
  %subtract.259.19 = s32[1]{0} subtract(%bitcast.24889.20, %param_1.3531), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.19"}
  %constant_5440_12 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.13 = s32[1]{0} maximum(%subtract.259.19, %constant_5440_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.13"}
  %sign.28.12 = s32[1]{0} sign(%maximum.48.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.12"}
  %constant_5447_7 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.12 = pred[1]{0} compare(%sign.28.12, %constant_5447_7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.12"}
  %constant_5448_8 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.13 = s32[1]{0} and(%maximum.48.13, %constant_5448_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.13"}
  %compare.1703.13 = pred[1]{0} compare(%and.321.13, %constant_5440_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.13"}
  %and.322.12 = pred[1]{0} and(%compare.1702.12, %compare.1703.13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.12"}
  %constant_5449_7 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.12 = s32[1]{0} shift-right-logical(%maximum.48.13, %constant_5449_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.12"}
  %constant_5450_7 = s32[1]{0} constant({-1})
  %add.3079.12 = s32[1]{0} add(%shift-right-logical.21.12, %constant_5450_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.12"}
  %select.1355.12 = s32[1]{0} select(%and.322.12, %add.3079.12, %shift-right-logical.21.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.12"}
  %compare.1704.12 = pred[1]{0} compare(%select.1355.12, %constant_5440_12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.12"}
  %add.3080.12 = s32[1]{0} add(%select.1355.12, %constant_5449_7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.12"}
  %select.1356.12 = s32[1]{0} select(%compare.1704.12, %add.3080.12, %select.1355.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.12"}
  %bitcast.24921.19 = s32[1,1]{1,0} bitcast(%select.1356.12), metadata={scheduling_name="bitcast.24921.19"}
  %concatenate.716.9 = s32[1,5]{1,0} concatenate(%constant_5451_6, %bitcast.24921.19, %constant_5451_6, %constant_5451_6, %constant_5451_6), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.9"}
  %bitcast.24949.7 = s32[5]{0} bitcast(%concatenate.716.9), metadata={scheduling_name="bitcast.24949.7"}
  %slice.2414.7 = s32[1]{0} slice(%bitcast.24949.7), slice={[1:2]}, metadata={scheduling_name="slice.2414.7"}
  %bitcast.26052.2 = s32[] bitcast(%slice.2414.7), metadata={scheduling_name="bitcast.26052.2"}
  ROOT %dynamic-slice.1547.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2662, %constant_5429_9, %bitcast.26052.2, %constant_5429_9, %constant_5429_9, /*index=5*/%constant_5429_9), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1547.1"}
}

%fused_dynamic_slice.6 (param_0.2663: bf16[1,2,768,8,128], param_1.3532: s32[1], param_2.2793: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2663 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2663"}
  %constant_5429_4 = s32[] constant(0)
  %constant_5451_7 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2793 = s32[] parameter(2), metadata={scheduling_name="param_2.2793"}
  %bitcast.24889.22 = s32[1]{0} bitcast(%param_2.2793), metadata={scheduling_name="bitcast.24889.22"}
  %param_1.3532 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3532"}
  %subtract.259.21 = s32[1]{0} subtract(%bitcast.24889.22, %param_1.3532), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.21"}
  %constant_5440_13 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.15 = s32[1]{0} maximum(%subtract.259.21, %constant_5440_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.15"}
  %sign.28.14 = s32[1]{0} sign(%maximum.48.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.14"}
  %constant_5447_8 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.14 = pred[1]{0} compare(%sign.28.14, %constant_5447_8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.14"}
  %constant_5448_9 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.15 = s32[1]{0} and(%maximum.48.15, %constant_5448_9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.15"}
  %compare.1703.15 = pred[1]{0} compare(%and.321.15, %constant_5440_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.15"}
  %and.322.14 = pred[1]{0} and(%compare.1702.14, %compare.1703.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.14"}
  %constant_5449_8 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.14 = s32[1]{0} shift-right-logical(%maximum.48.15, %constant_5449_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.14"}
  %constant_5450_8 = s32[1]{0} constant({-1})
  %add.3079.14 = s32[1]{0} add(%shift-right-logical.21.14, %constant_5450_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.14"}
  %select.1355.14 = s32[1]{0} select(%and.322.14, %add.3079.14, %shift-right-logical.21.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.14"}
  %compare.1704.14 = pred[1]{0} compare(%select.1355.14, %constant_5440_13), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.14"}
  %add.3080.14 = s32[1]{0} add(%select.1355.14, %constant_5449_8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.14"}
  %select.1356.14 = s32[1]{0} select(%compare.1704.14, %add.3080.14, %select.1355.14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.14"}
  %bitcast.24921.21 = s32[1,1]{1,0} bitcast(%select.1356.14), metadata={scheduling_name="bitcast.24921.21"}
  %concatenate.716.11 = s32[1,5]{1,0} concatenate(%constant_5451_7, %bitcast.24921.21, %constant_5451_7, %constant_5451_7, %constant_5451_7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.11"}
  %bitcast.24949.9 = s32[5]{0} bitcast(%concatenate.716.11), metadata={scheduling_name="bitcast.24949.9"}
  %slice.2414.9 = s32[1]{0} slice(%bitcast.24949.9), slice={[1:2]}, metadata={scheduling_name="slice.2414.9"}
  %bitcast.26052.3 = s32[] bitcast(%slice.2414.9), metadata={scheduling_name="bitcast.26052.3"}
  ROOT %dynamic-slice.1548.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2663, %constant_5429_4, %bitcast.26052.3, %constant_5429_4, %constant_5429_4, /*index=5*/%constant_5429_4), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1548.1"}
}

%fused_dynamic_slice.7 (param_0.2664: bf16[1,2,1,6144,16384], param_1.3534: s32[1], param_2.2795: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2664 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2664"}
  %constant_5429_15 = s32[] constant(0)
  %constant_5451_9 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2795 = s32[] parameter(2), metadata={scheduling_name="param_2.2795"}
  %bitcast.24889.26 = s32[1]{0} bitcast(%param_2.2795), metadata={scheduling_name="bitcast.24889.26"}
  %param_1.3534 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3534"}
  %subtract.259.25 = s32[1]{0} subtract(%bitcast.24889.26, %param_1.3534), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.25"}
  %constant_5440_15 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.19 = s32[1]{0} maximum(%subtract.259.25, %constant_5440_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.19"}
  %sign.28.18 = s32[1]{0} sign(%maximum.48.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.18"}
  %constant_5447_10 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.18 = pred[1]{0} compare(%sign.28.18, %constant_5447_10), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.18"}
  %constant_5448_11 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.19 = s32[1]{0} and(%maximum.48.19, %constant_5448_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.19"}
  %compare.1703.19 = pred[1]{0} compare(%and.321.19, %constant_5440_15), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.19"}
  %and.322.18 = pred[1]{0} and(%compare.1702.18, %compare.1703.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.18"}
  %constant_5449_10 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.18 = s32[1]{0} shift-right-logical(%maximum.48.19, %constant_5449_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.18"}
  %constant_5450_10 = s32[1]{0} constant({-1})
  %add.3079.18 = s32[1]{0} add(%shift-right-logical.21.18, %constant_5450_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.18"}
  %select.1355.18 = s32[1]{0} select(%and.322.18, %add.3079.18, %shift-right-logical.21.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.18"}
  %compare.1704.18 = pred[1]{0} compare(%select.1355.18, %constant_5440_15), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.18"}
  %add.3080.18 = s32[1]{0} add(%select.1355.18, %constant_5449_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.18"}
  %select.1356.18 = s32[1]{0} select(%compare.1704.18, %add.3080.18, %select.1355.18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.18"}
  %bitcast.24921.25 = s32[1,1]{1,0} bitcast(%select.1356.18), metadata={scheduling_name="bitcast.24921.25"}
  %concatenate.716.15 = s32[1,5]{1,0} concatenate(%constant_5451_9, %bitcast.24921.25, %constant_5451_9, %constant_5451_9, %constant_5451_9), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.15"}
  %bitcast.24949.13 = s32[5]{0} bitcast(%concatenate.716.15), metadata={scheduling_name="bitcast.24949.13"}
  %slice.2414.13 = s32[1]{0} slice(%bitcast.24949.13), slice={[1:2]}, metadata={scheduling_name="slice.2414.13"}
  %bitcast.26052.5 = s32[] bitcast(%slice.2414.13), metadata={scheduling_name="bitcast.26052.5"}
  ROOT %dynamic-slice.1553.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2664, %constant_5429_15, %bitcast.26052.5, %constant_5429_15, %constant_5429_15, /*index=5*/%constant_5429_15), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1553.1"}
}

%fused_dynamic_slice.8 (param_0.2665: bf16[1,2,1,6144,16384], param_1.3535: s32[1], param_2.2796: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2665 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2665"}
  %constant_5429_17 = s32[] constant(0)
  %constant_5451_10 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2796 = s32[] parameter(2), metadata={scheduling_name="param_2.2796"}
  %bitcast.24889.28 = s32[1]{0} bitcast(%param_2.2796), metadata={scheduling_name="bitcast.24889.28"}
  %param_1.3535 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3535"}
  %subtract.259.27 = s32[1]{0} subtract(%bitcast.24889.28, %param_1.3535), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.27"}
  %constant_5440_16 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.21 = s32[1]{0} maximum(%subtract.259.27, %constant_5440_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.21"}
  %sign.28.20 = s32[1]{0} sign(%maximum.48.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.20"}
  %constant_5447_11 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.20 = pred[1]{0} compare(%sign.28.20, %constant_5447_11), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.20"}
  %constant_5448_12 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.21 = s32[1]{0} and(%maximum.48.21, %constant_5448_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.21"}
  %compare.1703.21 = pred[1]{0} compare(%and.321.21, %constant_5440_16), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.21"}
  %and.322.20 = pred[1]{0} and(%compare.1702.20, %compare.1703.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.20"}
  %constant_5449_11 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.20 = s32[1]{0} shift-right-logical(%maximum.48.21, %constant_5449_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.20"}
  %constant_5450_11 = s32[1]{0} constant({-1})
  %add.3079.20 = s32[1]{0} add(%shift-right-logical.21.20, %constant_5450_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.20"}
  %select.1355.20 = s32[1]{0} select(%and.322.20, %add.3079.20, %shift-right-logical.21.20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.20"}
  %compare.1704.20 = pred[1]{0} compare(%select.1355.20, %constant_5440_16), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.20"}
  %add.3080.20 = s32[1]{0} add(%select.1355.20, %constant_5449_11), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.20"}
  %select.1356.20 = s32[1]{0} select(%compare.1704.20, %add.3080.20, %select.1355.20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.20"}
  %bitcast.24921.27 = s32[1,1]{1,0} bitcast(%select.1356.20), metadata={scheduling_name="bitcast.24921.27"}
  %concatenate.716.17 = s32[1,5]{1,0} concatenate(%constant_5451_10, %bitcast.24921.27, %constant_5451_10, %constant_5451_10, %constant_5451_10), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.17"}
  %bitcast.24949.15 = s32[5]{0} bitcast(%concatenate.716.17), metadata={scheduling_name="bitcast.24949.15"}
  %slice.2414.15 = s32[1]{0} slice(%bitcast.24949.15), slice={[1:2]}, metadata={scheduling_name="slice.2414.15"}
  %bitcast.26052.6 = s32[] bitcast(%slice.2414.15), metadata={scheduling_name="bitcast.26052.6"}
  ROOT %dynamic-slice.1554.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2665, %constant_5429_17, %bitcast.26052.6, %constant_5429_17, %constant_5429_17, /*index=5*/%constant_5429_17), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1554.1"}
}

%fused_dynamic_slice.9 (param_0.2666: bf16[1,2,1,16384,6144], param_1.3536: s32[1], param_2.2797: s32[]) -> bf16[1,1,1,16384,6144] {
  %param_0.2666 = bf16[1,2,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2666"}
  %constant_5429_34 = s32[] constant(0)
  %constant_5451_11 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2797 = s32[] parameter(2), metadata={scheduling_name="param_2.2797"}
  %bitcast.24889.30 = s32[1]{0} bitcast(%param_2.2797), metadata={scheduling_name="bitcast.24889.30"}
  %param_1.3536 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3536"}
  %subtract.259.29 = s32[1]{0} subtract(%bitcast.24889.30, %param_1.3536), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.29"}
  %constant_5440_17 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.23 = s32[1]{0} maximum(%subtract.259.29, %constant_5440_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.23"}
  %sign.28.22 = s32[1]{0} sign(%maximum.48.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.22"}
  %constant_5447_12 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.22 = pred[1]{0} compare(%sign.28.22, %constant_5447_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.22"}
  %constant_5448_13 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.23 = s32[1]{0} and(%maximum.48.23, %constant_5448_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.23"}
  %compare.1703.23 = pred[1]{0} compare(%and.321.23, %constant_5440_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.23"}
  %and.322.22 = pred[1]{0} and(%compare.1702.22, %compare.1703.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.22"}
  %constant_5449_12 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.22 = s32[1]{0} shift-right-logical(%maximum.48.23, %constant_5449_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.22"}
  %constant_5450_12 = s32[1]{0} constant({-1})
  %add.3079.22 = s32[1]{0} add(%shift-right-logical.21.22, %constant_5450_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.22"}
  %select.1355.22 = s32[1]{0} select(%and.322.22, %add.3079.22, %shift-right-logical.21.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.22"}
  %compare.1704.22 = pred[1]{0} compare(%select.1355.22, %constant_5440_17), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.22"}
  %add.3080.22 = s32[1]{0} add(%select.1355.22, %constant_5449_12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.22"}
  %select.1356.22 = s32[1]{0} select(%compare.1704.22, %add.3080.22, %select.1355.22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.22"}
  %bitcast.24921.29 = s32[1,1]{1,0} bitcast(%select.1356.22), metadata={scheduling_name="bitcast.24921.29"}
  %concatenate.716.19 = s32[1,5]{1,0} concatenate(%constant_5451_11, %bitcast.24921.29, %constant_5451_11, %constant_5451_11, %constant_5451_11), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.19"}
  %bitcast.24949.17 = s32[5]{0} bitcast(%concatenate.716.19), metadata={scheduling_name="bitcast.24949.17"}
  %slice.2414.17 = s32[1]{0} slice(%bitcast.24949.17), slice={[1:2]}, metadata={scheduling_name="slice.2414.17"}
  %bitcast.26052.7 = s32[] bitcast(%slice.2414.17), metadata={scheduling_name="bitcast.26052.7"}
  ROOT %dynamic-slice.1555.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_0.2666, %constant_5429_34, %bitcast.26052.7, %constant_5429_34, %constant_5429_34, /*index=5*/%constant_5429_34), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1555.1"}
}

%fused_dynamic_slice.10 (param_0.2667: bf16[1,2,768,48,128], param_1.3537: s32[1], param_2.2798: s32[]) -> bf16[1,1,768,48,128] {
  %param_0.2667 = bf16[1,2,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2667"}
  %constant_5429_47 = s32[] constant(0)
  %constant_5451_12 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2798 = s32[] parameter(2), metadata={scheduling_name="param_2.2798"}
  %bitcast.24889.32 = s32[1]{0} bitcast(%param_2.2798), metadata={scheduling_name="bitcast.24889.32"}
  %param_1.3537 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3537"}
  %subtract.259.31 = s32[1]{0} subtract(%bitcast.24889.32, %param_1.3537), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.31"}
  %constant_5440_18 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.25 = s32[1]{0} maximum(%subtract.259.31, %constant_5440_18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.25"}
  %sign.28.24 = s32[1]{0} sign(%maximum.48.25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.24"}
  %constant_5447_13 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.24 = pred[1]{0} compare(%sign.28.24, %constant_5447_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.24"}
  %constant_5448_14 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.25 = s32[1]{0} and(%maximum.48.25, %constant_5448_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.25"}
  %compare.1703.25 = pred[1]{0} compare(%and.321.25, %constant_5440_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.25"}
  %and.322.24 = pred[1]{0} and(%compare.1702.24, %compare.1703.25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.24"}
  %constant_5449_13 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.24 = s32[1]{0} shift-right-logical(%maximum.48.25, %constant_5449_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.24"}
  %constant_5450_13 = s32[1]{0} constant({-1})
  %add.3079.24 = s32[1]{0} add(%shift-right-logical.21.24, %constant_5450_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.24"}
  %select.1355.24 = s32[1]{0} select(%and.322.24, %add.3079.24, %shift-right-logical.21.24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.24"}
  %compare.1704.24 = pred[1]{0} compare(%select.1355.24, %constant_5440_18), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.24"}
  %add.3080.24 = s32[1]{0} add(%select.1355.24, %constant_5449_13), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.24"}
  %select.1356.24 = s32[1]{0} select(%compare.1704.24, %add.3080.24, %select.1355.24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.24"}
  %bitcast.24921.31 = s32[1,1]{1,0} bitcast(%select.1356.24), metadata={scheduling_name="bitcast.24921.31"}
  %concatenate.716.21 = s32[1,5]{1,0} concatenate(%constant_5451_12, %bitcast.24921.31, %constant_5451_12, %constant_5451_12, %constant_5451_12), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.21"}
  %bitcast.24949.19 = s32[5]{0} bitcast(%concatenate.716.21), metadata={scheduling_name="bitcast.24949.19"}
  %slice.2414.19 = s32[1]{0} slice(%bitcast.24949.19), slice={[1:2]}, metadata={scheduling_name="slice.2414.19"}
  %bitcast.26052.8 = s32[] bitcast(%slice.2414.19), metadata={scheduling_name="bitcast.26052.8"}
  ROOT %dynamic-slice.1557.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_0.2667, %constant_5429_47, %bitcast.26052.8, %constant_5429_47, %constant_5429_47, /*index=5*/%constant_5429_47), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1557.1"}
}

%fused_dynamic_slice.11 (param_0.2668: bf16[1,2,768,8,128], param_1.3538: s32[1], param_2.2799: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2668 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2668"}
  %constant_5429_37 = s32[] constant(0)
  %constant_5451_13 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2799 = s32[] parameter(2), metadata={scheduling_name="param_2.2799"}
  %bitcast.24889.34 = s32[1]{0} bitcast(%param_2.2799), metadata={scheduling_name="bitcast.24889.34"}
  %param_1.3538 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3538"}
  %subtract.259.33 = s32[1]{0} subtract(%bitcast.24889.34, %param_1.3538), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.33"}
  %constant_5440_19 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.27 = s32[1]{0} maximum(%subtract.259.33, %constant_5440_19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.27"}
  %sign.28.26 = s32[1]{0} sign(%maximum.48.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.26"}
  %constant_5447_14 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.26 = pred[1]{0} compare(%sign.28.26, %constant_5447_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.26"}
  %constant_5448_15 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.27 = s32[1]{0} and(%maximum.48.27, %constant_5448_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.27"}
  %compare.1703.27 = pred[1]{0} compare(%and.321.27, %constant_5440_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.27"}
  %and.322.26 = pred[1]{0} and(%compare.1702.26, %compare.1703.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.26"}
  %constant_5449_14 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.26 = s32[1]{0} shift-right-logical(%maximum.48.27, %constant_5449_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.26"}
  %constant_5450_14 = s32[1]{0} constant({-1})
  %add.3079.26 = s32[1]{0} add(%shift-right-logical.21.26, %constant_5450_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.26"}
  %select.1355.26 = s32[1]{0} select(%and.322.26, %add.3079.26, %shift-right-logical.21.26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.26"}
  %compare.1704.26 = pred[1]{0} compare(%select.1355.26, %constant_5440_19), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.26"}
  %add.3080.26 = s32[1]{0} add(%select.1355.26, %constant_5449_14), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.26"}
  %select.1356.26 = s32[1]{0} select(%compare.1704.26, %add.3080.26, %select.1355.26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.26"}
  %bitcast.24921.33 = s32[1,1]{1,0} bitcast(%select.1356.26), metadata={scheduling_name="bitcast.24921.33"}
  %concatenate.716.23 = s32[1,5]{1,0} concatenate(%constant_5451_13, %bitcast.24921.33, %constant_5451_13, %constant_5451_13, %constant_5451_13), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.23"}
  %bitcast.24949.21 = s32[5]{0} bitcast(%concatenate.716.23), metadata={scheduling_name="bitcast.24949.21"}
  %slice.2414.21 = s32[1]{0} slice(%bitcast.24949.21), slice={[1:2]}, metadata={scheduling_name="slice.2414.21"}
  %bitcast.26052.9 = s32[] bitcast(%slice.2414.21), metadata={scheduling_name="bitcast.26052.9"}
  ROOT %dynamic-slice.1558.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2668, %constant_5429_37, %bitcast.26052.9, %constant_5429_37, %constant_5429_37, /*index=5*/%constant_5429_37), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1558.1"}
}

%fused_dynamic_slice.12 (param_0.2669: bf16[1,2,768,8,128], param_1.3539: s32[1], param_2.2800: s32[]) -> bf16[1,1,768,8,128] {
  %param_0.2669 = bf16[1,2,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2669"}
  %constant_5429_51 = s32[] constant(0)
  %constant_5451_14 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2800 = s32[] parameter(2), metadata={scheduling_name="param_2.2800"}
  %bitcast.24889.36 = s32[1]{0} bitcast(%param_2.2800), metadata={scheduling_name="bitcast.24889.36"}
  %param_1.3539 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3539"}
  %subtract.259.35 = s32[1]{0} subtract(%bitcast.24889.36, %param_1.3539), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.35"}
  %constant_5440_20 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.29 = s32[1]{0} maximum(%subtract.259.35, %constant_5440_20), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.29"}
  %sign.28.28 = s32[1]{0} sign(%maximum.48.29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.28"}
  %constant_5447_15 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.28 = pred[1]{0} compare(%sign.28.28, %constant_5447_15), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.28"}
  %constant_5448_16 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.29 = s32[1]{0} and(%maximum.48.29, %constant_5448_16), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.29"}
  %compare.1703.29 = pred[1]{0} compare(%and.321.29, %constant_5440_20), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.29"}
  %and.322.28 = pred[1]{0} and(%compare.1702.28, %compare.1703.29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.28"}
  %constant_5449_15 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.28 = s32[1]{0} shift-right-logical(%maximum.48.29, %constant_5449_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.28"}
  %constant_5450_15 = s32[1]{0} constant({-1})
  %add.3079.28 = s32[1]{0} add(%shift-right-logical.21.28, %constant_5450_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.28"}
  %select.1355.28 = s32[1]{0} select(%and.322.28, %add.3079.28, %shift-right-logical.21.28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.28"}
  %compare.1704.28 = pred[1]{0} compare(%select.1355.28, %constant_5440_20), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.28"}
  %add.3080.28 = s32[1]{0} add(%select.1355.28, %constant_5449_15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.28"}
  %select.1356.28 = s32[1]{0} select(%compare.1704.28, %add.3080.28, %select.1355.28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.28"}
  %bitcast.24921.35 = s32[1,1]{1,0} bitcast(%select.1356.28), metadata={scheduling_name="bitcast.24921.35"}
  %concatenate.716.25 = s32[1,5]{1,0} concatenate(%constant_5451_14, %bitcast.24921.35, %constant_5451_14, %constant_5451_14, %constant_5451_14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.25"}
  %bitcast.24949.23 = s32[5]{0} bitcast(%concatenate.716.25), metadata={scheduling_name="bitcast.24949.23"}
  %slice.2414.23 = s32[1]{0} slice(%bitcast.24949.23), slice={[1:2]}, metadata={scheduling_name="slice.2414.23"}
  %bitcast.26052.10 = s32[] bitcast(%slice.2414.23), metadata={scheduling_name="bitcast.26052.10"}
  ROOT %dynamic-slice.1559.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.2669, %constant_5429_51, %bitcast.26052.10, %constant_5429_51, %constant_5429_51, /*index=5*/%constant_5429_51), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1559.1"}
}

%fused_dynamic_slice.13 (param_0.2670: bf16[1,2,1,6144,16384], param_1.3541: s32[1], param_2.2802: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2670 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2670"}
  %constant_5429_18 = s32[] constant(0)
  %constant_5451_16 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2802 = s32[] parameter(2), metadata={scheduling_name="param_2.2802"}
  %bitcast.24889.40 = s32[1]{0} bitcast(%param_2.2802), metadata={scheduling_name="bitcast.24889.40"}
  %param_1.3541 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3541"}
  %subtract.259.39 = s32[1]{0} subtract(%bitcast.24889.40, %param_1.3541), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.39"}
  %constant_5440_22 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.33 = s32[1]{0} maximum(%subtract.259.39, %constant_5440_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.33"}
  %sign.28.32 = s32[1]{0} sign(%maximum.48.33), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.32"}
  %constant_5447_17 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.32 = pred[1]{0} compare(%sign.28.32, %constant_5447_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.32"}
  %constant_5448_18 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.33 = s32[1]{0} and(%maximum.48.33, %constant_5448_18), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.33"}
  %compare.1703.33 = pred[1]{0} compare(%and.321.33, %constant_5440_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.33"}
  %and.322.32 = pred[1]{0} and(%compare.1702.32, %compare.1703.33), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.32"}
  %constant_5449_17 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.32 = s32[1]{0} shift-right-logical(%maximum.48.33, %constant_5449_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.32"}
  %constant_5450_17 = s32[1]{0} constant({-1})
  %add.3079.32 = s32[1]{0} add(%shift-right-logical.21.32, %constant_5450_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.32"}
  %select.1355.32 = s32[1]{0} select(%and.322.32, %add.3079.32, %shift-right-logical.21.32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.32"}
  %compare.1704.32 = pred[1]{0} compare(%select.1355.32, %constant_5440_22), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.32"}
  %add.3080.32 = s32[1]{0} add(%select.1355.32, %constant_5449_17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.32"}
  %select.1356.32 = s32[1]{0} select(%compare.1704.32, %add.3080.32, %select.1355.32), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.32"}
  %bitcast.24921.39 = s32[1,1]{1,0} bitcast(%select.1356.32), metadata={scheduling_name="bitcast.24921.39"}
  %concatenate.716.29 = s32[1,5]{1,0} concatenate(%constant_5451_16, %bitcast.24921.39, %constant_5451_16, %constant_5451_16, %constant_5451_16), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.29"}
  %bitcast.24949.27 = s32[5]{0} bitcast(%concatenate.716.29), metadata={scheduling_name="bitcast.24949.27"}
  %slice.2414.27 = s32[1]{0} slice(%bitcast.24949.27), slice={[1:2]}, metadata={scheduling_name="slice.2414.27"}
  %bitcast.26052.12 = s32[] bitcast(%slice.2414.27), metadata={scheduling_name="bitcast.26052.12"}
  ROOT %dynamic-slice.1563.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2670, %constant_5429_18, %bitcast.26052.12, %constant_5429_18, %constant_5429_18, /*index=5*/%constant_5429_18), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1563.1"}
}

%fused_dynamic_slice.14 (param_0.2671: bf16[1,2,1,6144,16384], param_1.3527: s32[1], param_2.2788: s32[]) -> bf16[1,1,1,6144,16384] {
  %param_0.2671 = bf16[1,2,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2671"}
  %constant_5429_28 = s32[] constant(0)
  %constant_5451_2 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2788 = s32[] parameter(2), metadata={scheduling_name="param_2.2788"}
  %bitcast.24889.42 = s32[1]{0} bitcast(%param_2.2788), metadata={scheduling_name="bitcast.24889.42"}
  %param_1.3527 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3527"}
  %subtract.259.41 = s32[1]{0} subtract(%bitcast.24889.42, %param_1.3527), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.41"}
  %constant_5440_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.35 = s32[1]{0} maximum(%subtract.259.41, %constant_5440_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.35"}
  %sign.28.34 = s32[1]{0} sign(%maximum.48.35), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.34"}
  %constant_5447_4 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.34 = pred[1]{0} compare(%sign.28.34, %constant_5447_4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.34"}
  %constant_5448_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.35 = s32[1]{0} and(%maximum.48.35, %constant_5448_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.35"}
  %compare.1703.35 = pred[1]{0} compare(%and.321.35, %constant_5440_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.35"}
  %and.322.34 = pred[1]{0} and(%compare.1702.34, %compare.1703.35), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.34"}
  %constant_5449_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.34 = s32[1]{0} shift-right-logical(%maximum.48.35, %constant_5449_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.34"}
  %constant_5450_3 = s32[1]{0} constant({-1})
  %add.3079.34 = s32[1]{0} add(%shift-right-logical.21.34, %constant_5450_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.34"}
  %select.1355.34 = s32[1]{0} select(%and.322.34, %add.3079.34, %shift-right-logical.21.34), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.34"}
  %compare.1704.34 = pred[1]{0} compare(%select.1355.34, %constant_5440_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.34"}
  %add.3080.34 = s32[1]{0} add(%select.1355.34, %constant_5449_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.34"}
  %select.1356.34 = s32[1]{0} select(%compare.1704.34, %add.3080.34, %select.1355.34), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.34"}
  %bitcast.24921.41 = s32[1,1]{1,0} bitcast(%select.1356.34), metadata={scheduling_name="bitcast.24921.41"}
  %concatenate.716.31 = s32[1,5]{1,0} concatenate(%constant_5451_2, %bitcast.24921.41, %constant_5451_2, %constant_5451_2, %constant_5451_2), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.31"}
  %bitcast.24949.29 = s32[5]{0} bitcast(%concatenate.716.31), metadata={scheduling_name="bitcast.24949.29"}
  %slice.2414.29 = s32[1]{0} slice(%bitcast.24949.29), slice={[1:2]}, metadata={scheduling_name="slice.2414.29"}
  %bitcast.26052.13 = s32[] bitcast(%slice.2414.29), metadata={scheduling_name="bitcast.26052.13"}
  ROOT %dynamic-slice.1564.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.2671, %constant_5429_28, %bitcast.26052.13, %constant_5429_28, %constant_5429_28, /*index=5*/%constant_5429_28), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1564.1"}
}

%fused_dynamic_slice.15 (param_0.2672: bf16[1,2,1,16384,6144], param_1.3529: s32[1], param_2.2790: s32[]) -> bf16[1,1,1,16384,6144] {
  %param_0.2672 = bf16[1,2,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2672"}
  %constant_5429_44 = s32[] constant(0)
  %constant_5451_4 = s32[1,1]{1,0} constant({ {0} })
  %param_2.2790 = s32[] parameter(2), metadata={scheduling_name="param_2.2790"}
  %bitcast.24889.16 = s32[1]{0} bitcast(%param_2.2790), metadata={scheduling_name="bitcast.24889.16"}
  %param_1.3529 = s32[1]{0} parameter(1), metadata={scheduling_name="param_1.3529"}
  %subtract.259.15 = s32[1]{0} subtract(%bitcast.24889.16, %param_1.3529), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.15"}
  %constant_5440_10 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.9 = s32[1]{0} maximum(%subtract.259.15, %constant_5440_10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.9"}
  %sign.28.8 = s32[1]{0} sign(%maximum.48.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.8"}
  %constant_5447_5 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.8 = pred[1]{0} compare(%sign.28.8, %constant_5447_5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.8"}
  %constant_5448_6 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.9 = s32[1]{0} and(%maximum.48.9, %constant_5448_6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.9"}
  %compare.1703.9 = pred[1]{0} compare(%and.321.9, %constant_5440_10), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.9"}
  %and.322.8 = pred[1]{0} and(%compare.1702.8, %compare.1703.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.8"}
  %constant_5449_5 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.8 = s32[1]{0} shift-right-logical(%maximum.48.9, %constant_5449_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.8"}
  %constant_5450_5 = s32[1]{0} constant({-1})
  %add.3079.8 = s32[1]{0} add(%shift-right-logical.21.8, %constant_5450_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.8"}
  %select.1355.8 = s32[1]{0} select(%and.322.8, %add.3079.8, %shift-right-logical.21.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.8"}
  %compare.1704.8 = pred[1]{0} compare(%select.1355.8, %constant_5440_10), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.8"}
  %add.3080.8 = s32[1]{0} add(%select.1355.8, %constant_5449_5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.8"}
  %select.1356.8 = s32[1]{0} select(%compare.1704.8, %add.3080.8, %select.1355.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.8"}
  %bitcast.24921.15 = s32[1,1]{1,0} bitcast(%select.1356.8), metadata={scheduling_name="bitcast.24921.15"}
  %concatenate.716.5 = s32[1,5]{1,0} concatenate(%constant_5451_4, %bitcast.24921.15, %constant_5451_4, %constant_5451_4, %constant_5451_4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.716.5"}
  %bitcast.24949.3 = s32[5]{0} bitcast(%concatenate.716.5), metadata={scheduling_name="bitcast.24949.3"}
  %slice.2414.3 = s32[1]{0} slice(%bitcast.24949.3), slice={[1:2]}, metadata={scheduling_name="slice.2414.3"}
  %bitcast.26052.14 = s32[] bitcast(%slice.2414.3), metadata={scheduling_name="bitcast.26052.14"}
  ROOT %dynamic-slice.1565.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_0.2672, %constant_5429_44, %bitcast.26052.14, %constant_5429_44, %constant_5429_44, /*index=5*/%constant_5429_44), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1565.1"}
}

%fused_dynamic_update_slice.9 (param_0.2691: s32[9], param_1.2778: s32[]) -> s32[9] {
  %param_0.2691 = s32[9]{0} parameter(0), metadata={scheduling_name="param_0.2691"}
  %param_1.2778 = s32[] parameter(1), metadata={scheduling_name="param_1.2778"}
  %bitcast.24889.2 = s32[1]{0} bitcast(%param_1.2778), metadata={scheduling_name="bitcast.24889.2"}
  ROOT %dynamic-update-slice.429.1 = s32[9]{0} dynamic-update-slice(%param_0.2691, %bitcast.24889.2, %param_1.2778), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.429.1"}
}

%fused_dynamic_slice_reduce_select (param_0.6072: pred[1,4,8192,6144], param_1.6473: bf16[1,4,8192,6144], param_2.4749: bf16[1,4,8192,6144], param_3.3973: pred[], param_4.2911: bf16[1,4,4,8192,6144], param_5.2701: bf16[1,2,4,8192,6144], param_6.2512: s32[], param_7.2310: pred[]) -> (f32[4,8192], bf16[1,4,8192,6144], bf16[1,1,4,8192,6144]) {
  %param_0.6072 = pred[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6072"}
  %param_7.2310 = pred[] parameter(7), metadata={scheduling_name="param_7.2310"}
  %broadcast.5716.1.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%param_7.2310), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5716.1.clone.1"}
  %param_5.2701 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2701"}
  %constant_5429_41_clone_1 = s32[] constant(0)
  %param_6.2512 = s32[] parameter(6), metadata={scheduling_name="param_6.2512"}
  %compare.1694.2.clone.1 = pred[] compare(%param_6.2512, %constant_5429_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1694.2.clone.1"}
  %negate.227.2.clone.1 = s32[] negate(%param_6.2512), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.227.2.clone.1"}
  %select.1345.1.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.227.2.clone.1, %param_6.2512), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1345.1.clone.1"}
  %constant_5427_4_clone_1 = s32[] constant(1)
  %and.317.2.clone.1 = s32[] and(%select.1345.1.clone.1, %constant_5427_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.317.2.clone.1"}
  %negate.228.3.clone.1 = s32[] negate(%and.317.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.228.3.clone.1"}
  %select.1346.2.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.228.3.clone.1, %and.317.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1346.2.clone.1"}
  %compare.1695.2.clone.1 = pred[] compare(%select.1346.2.clone.1, %constant_5429_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1695.2.clone.1"}
  %compare.1696.2.clone.1 = pred[] compare(%select.1346.2.clone.1, %constant_5429_41_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1696.2.clone.1"}
  %and.318.1.clone.1 = pred[] and(%compare.1695.2.clone.1, %compare.1696.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.318.1.clone.1"}
  %constant_5433_3_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.3074.1.clone.1 = s32[] add(%select.1346.2.clone.1, %constant_5433_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3074.1.clone.1"}
  %select.1347.3.clone.1 = s32[] select(%and.318.1.clone.1, %add.3074.1.clone.1, %select.1346.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1347.3.clone.1"}
  %compare.1697.1.clone.1 = pred[] compare(%select.1347.3.clone.1, %constant_5429_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="compare.1697.1.clone.1"}
  %add.3075.1.clone.1 = s32[] add(%select.1347.3.clone.1, %constant_5433_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.3075.1.clone.1"}
  %select.1348.3.clone.1 = s32[] select(%compare.1697.1.clone.1, %add.3075.1.clone.1, %select.1347.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="select.1348.3.clone.1"}
  %dynamic-slice.1542.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_5.2701, %constant_5429_41_clone_1, %select.1348.3.clone.1, %constant_5429_41_clone_1, %constant_5429_41_clone_1, /*index=5*/%constant_5429_41_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="dynamic-slice.1542.1.clone.1"}
  %param_4.2911 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2911"}
  %constant_5430_1_clone_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %and.319.1.clone.1 = s32[] and(%select.1345.1.clone.1, %constant_5430_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.319.1.clone.1"}
  %negate.229.1.clone.1 = s32[] negate(%and.319.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.229.1.clone.1"}
  %select.1349.1.clone.1 = s32[] select(%compare.1694.2.clone.1, %negate.229.1.clone.1, %and.319.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1349.1.clone.1"}
  %compare.1698.1.clone.1 = pred[] compare(%select.1349.1.clone.1, %constant_5429_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1698.1.clone.1"}
  %compare.1699.1.clone.1 = pred[] compare(%select.1349.1.clone.1, %constant_5429_41_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1699.1.clone.1"}
  %and.320.1.clone.1 = pred[] and(%compare.1698.1.clone.1, %compare.1699.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.320.1.clone.1"}
  %constant_5431_2_clone_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.3076.1.clone.1 = s32[] add(%select.1349.1.clone.1, %constant_5431_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3076.1.clone.1"}
  %select.1350.1.clone.1 = s32[] select(%and.320.1.clone.1, %add.3076.1.clone.1, %select.1349.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1350.1.clone.1"}
  %compare.1700.1.clone.1 = pred[] compare(%select.1350.1.clone.1, %constant_5429_41_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="compare.1700.1.clone.1"}
  %add.3077.1.clone.1 = s32[] add(%select.1350.1.clone.1, %constant_5431_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.3077.1.clone.1"}
  %select.1351.1.clone.1 = s32[] select(%compare.1700.1.clone.1, %add.3077.1.clone.1, %select.1350.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="select.1351.1.clone.1"}
  %dynamic-slice.1543.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_4.2911, %constant_5429_41_clone_1, %select.1351.1.clone.1, %constant_5429_41_clone_1, %constant_5429_41_clone_1, /*index=5*/%constant_5429_41_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="dynamic-slice.1543.1.clone.1"}
  %select.1352.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5716.1.clone.1, %dynamic-slice.1542.1.clone.1, %dynamic-slice.1543.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1352.1.clone.1"}
  %bitcast.24844.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1352.1.clone.1), metadata={scheduling_name="bitcast.24844.1.clone.1"}
  %param_3.3973 = pred[] parameter(3), metadata={scheduling_name="param_3.3973"}
  %broadcast.5717.1.clone.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.3973), dimensions={}, metadata={scheduling_name="broadcast.5717.1.clone.1"}
  %param_1.6473 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6473"}
  %param_2.4749 = bf16[1,4,8192,6144]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4749"}
  %select.1353.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5717.1.clone.1, %param_1.6473, %param_2.4749), metadata={scheduling_name="select.1353.1.clone.1"}
  %select.1354.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%param_0.6072, %bitcast.24844.1.clone.1, %select.1353.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1354.1.clone.1"}
  %convert.4198.6 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1354.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4198.6"}
  %multiply.2694.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4198.6, %convert.4198.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2694.3"}
  %bitcast.24866.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2694.3), metadata={scheduling_name="bitcast.24866.1"}
  %constant_5434_4 = f32[] constant(0)
  %reduce.427.1 = f32[4,8192]{1,0} reduce(%bitcast.24866.1, %constant_5434_4), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.427.1"}
  ROOT %tuple.550 = (f32[4,8192]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) tuple(%reduce.427.1, %select.1354.1.clone.1, %dynamic-slice.1542.1.clone.1), metadata={scheduling_name="tuple.550"}
}

%fused_dynamic_update_slice.10 (param_0.2701: bf16[1,4,4,8192,6144], param_1.3503: bf16[1,4,8192,6144], param_2.2740: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.2701 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2701"}
  %param_1.3503 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3503"}
  %bitcast.24702.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_1.3503), metadata={scheduling_name="bitcast.24702.1"}
  %constant_5429_39 = s32[] constant(0)
  %param_2.2740 = s32[] parameter(2), metadata={scheduling_name="param_2.2740"}
  %constant_5428_1 = s32[] constant(-2)
  %add.3071.1 = s32[] add(%param_2.2740, %constant_5428_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.3071.1"}
  %compare.1689.1 = pred[] compare(%add.3071.1, %constant_5429_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1689.1"}
  %negate.225.1 = s32[] negate(%add.3071.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.225.1"}
  %select.1341.1 = s32[] select(%compare.1689.1, %negate.225.1, %add.3071.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1341.1"}
  %constant_5430_2 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %and.315.1 = s32[] and(%select.1341.1, %constant_5430_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.315.1"}
  %negate.226.1 = s32[] negate(%and.315.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.226.1"}
  %select.1342.1 = s32[] select(%compare.1689.1, %negate.226.1, %and.315.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1342.1"}
  %compare.1690.1 = pred[] compare(%select.1342.1, %constant_5429_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1690.1"}
  %compare.1691.1 = pred[] compare(%select.1342.1, %constant_5429_39), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1691.1"}
  %and.316.1 = pred[] and(%compare.1690.1, %compare.1691.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.316.1"}
  %constant_5431_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %add.3072.1 = s32[] add(%select.1342.1, %constant_5431_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3072.1"}
  %select.1343.1 = s32[] select(%and.316.1, %add.3072.1, %select.1342.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1343.1"}
  %compare.1692.1 = pred[] compare(%select.1343.1, %constant_5429_39), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1692.1"}
  %add.3073.1 = s32[] add(%select.1343.1, %constant_5431_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.3073.1"}
  %select.1344.1 = s32[] select(%compare.1692.1, %add.3073.1, %select.1343.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1344.1"}
  ROOT %dynamic-update-slice.419.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.2701, %bitcast.24702.1, %constant_5429_39, %select.1344.1, %constant_5429_39, /*index=5*/%constant_5429_39, %constant_5429_39), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-update-slice.419.1"}
}

%fused_convert (param_0.2713: bf16[65536,16384], param_1.2802: bf16[65536,16384]) -> bf16[1,1,32,2048,16384] {
  %param_0.2713 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.2713"}
  %bitcast.26024.5 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.2713), metadata={scheduling_name="bitcast.26024.5"}
  %convert.4312.5 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.26024.5), metadata={scheduling_name="convert.4312.5"}
  %param_1.2802 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.2802"}
  %bitcast.26040.3 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.2802), metadata={scheduling_name="bitcast.26040.3"}
  %convert.4313.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.26040.3), metadata={scheduling_name="convert.4313.3"}
  %multiply.2737.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4312.5, %convert.4313.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2737.3"}
  ROOT %convert.4315.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2737.3), metadata={scheduling_name="convert.4315.1"}
}

%fused_convert.1 (param_0.2719: bf16[65536,16384], param_1.2808: bf16[65536,16384]) -> bf16[1,1,32,2048,16384] {
  %param_0.2719 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.2719"}
  %bitcast.25480.5 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.2719), metadata={scheduling_name="bitcast.25480.5"}
  %convert.4255.5 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25480.5), metadata={scheduling_name="convert.4255.5"}
  %param_1.2808 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.2808"}
  %bitcast.25496.3 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.2808), metadata={scheduling_name="bitcast.25496.3"}
  %convert.4256.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.25496.3), metadata={scheduling_name="convert.4256.3"}
  %multiply.2716.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4255.5, %convert.4256.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2716.3"}
  ROOT %convert.4258.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2716.3), metadata={scheduling_name="convert.4258.1"}
}

%fused_convert.2 (param_0.2823: bf16[32768,6144], param_1.2900: f32[1,4,8192], param_2.2537: bf16[1,2,6144], param_3.2296: s32[1], param_4.1925: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2823 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2823"}
  %bitcast.25722.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2823), metadata={scheduling_name="bitcast.25722.7"}
  %convert.4289.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25722.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4289.7"}
  %param_1.2900 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2900"}
  %bitcast.25745.3 = f32[4,8192]{1,0} bitcast(%param_1.2900), metadata={scheduling_name="bitcast.25745.3"}
  %broadcast.5759.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.25745.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5759.3"}
  %multiply.2731.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4289.7, %broadcast.5759.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2731.3"}
  %param_2.2537 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2537"}
  %constant_5429_6 = s32[] constant(0)
  %param_4.1925 = s32[] parameter(4), metadata={scheduling_name="param_4.1925"}
  %bitcast.24889.58 = s32[1]{0} bitcast(%param_4.1925), metadata={scheduling_name="bitcast.24889.58"}
  %param_3.2296 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2296"}
  %subtract.259.57 = s32[1]{0} subtract(%bitcast.24889.58, %param_3.2296), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.57"}
  %constant_5440_28 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.51 = s32[1]{0} maximum(%subtract.259.57, %constant_5440_28), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.51"}
  %sign.28.46 = s32[1]{0} sign(%maximum.48.51), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.46"}
  %constant_5447_22 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.46 = pred[1]{0} compare(%sign.28.46, %constant_5447_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.46"}
  %constant_5448_24 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.51 = s32[1]{0} and(%maximum.48.51, %constant_5448_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.51"}
  %compare.1703.51 = pred[1]{0} compare(%and.321.51, %constant_5440_28), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.51"}
  %and.322.46 = pred[1]{0} and(%compare.1702.46, %compare.1703.51), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.46"}
  %constant_5449_22 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.46 = s32[1]{0} shift-right-logical(%maximum.48.51, %constant_5449_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.46"}
  %constant_5450_22 = s32[1]{0} constant({-1})
  %add.3079.46 = s32[1]{0} add(%shift-right-logical.21.46, %constant_5450_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.46"}
  %select.1355.46 = s32[1]{0} select(%and.322.46, %add.3079.46, %shift-right-logical.21.46), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.46"}
  %compare.1704.46 = pred[1]{0} compare(%select.1355.46, %constant_5440_28), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.46"}
  %add.3080.46 = s32[1]{0} add(%select.1355.46, %constant_5449_22), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.46"}
  %select.1356.46 = s32[1]{0} select(%compare.1704.46, %add.3080.46, %select.1355.46), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.46"}
  %bitcast.24921.53 = s32[1,1]{1,0} bitcast(%select.1356.46), metadata={scheduling_name="bitcast.24921.53"}
  %pad.356.15 = s32[1,2]{1,0} pad(%bitcast.24921.53, %constant_5429_6), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.15"}
  %pad.357.13 = s32[1,3]{1,0} pad(%pad.356.15, %constant_5429_6), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.13"}
  %bitcast.24927.11 = s32[3]{0} bitcast(%pad.357.13), metadata={scheduling_name="bitcast.24927.11"}
  %slice.2413.11 = s32[1]{0} slice(%bitcast.24927.11), slice={[1:2]}, metadata={scheduling_name="slice.2413.11"}
  %bitcast.25754.6 = s32[] bitcast(%slice.2413.11), metadata={scheduling_name="bitcast.25754.6"}
  %dynamic-slice.1561.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2537, %constant_5429_6, %bitcast.25754.6, %constant_5429_6), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1561.3"}
  %bitcast.25756.6 = bf16[6144]{0} bitcast(%dynamic-slice.1561.3), metadata={scheduling_name="bitcast.25756.6"}
  %convert.5009.3 = f32[6144]{0} convert(%bitcast.25756.6), metadata={scheduling_name="convert.5009.3"}
  %broadcast.6064.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5009.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6064.1"}
  %multiply.2732.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2731.3, %broadcast.6064.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2732.1"}
  ROOT %convert.4291.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2732.1), metadata={scheduling_name="convert.4291.1"}
}

%fused_convert.3 (param_0.2824: bf16[4,8192,6144], param_1.2901: f32[1,4,8192], param_2.2542: bf16[1,2,6144], param_3.2297: s32[1], param_4.1926: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2824 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2824"}
  %bitcast.25529.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2824), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/reduce_precision" source_file="/workspace/maxtext/MaxText/layers/mixtral.py" source_line=64 scheduling_name="bitcast.25529.7"}
  %convert.4259.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25529.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4259.7"}
  %param_1.2901 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2901"}
  %bitcast.25553.3 = f32[4,8192]{1,0} bitcast(%param_1.2901), metadata={scheduling_name="bitcast.25553.3"}
  %broadcast.5754.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.25553.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5754.3"}
  %multiply.2719.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4259.7, %broadcast.5754.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2719.3"}
  %param_2.2542 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2542"}
  %constant_5429_8 = s32[] constant(0)
  %param_4.1926 = s32[] parameter(4), metadata={scheduling_name="param_4.1926"}
  %bitcast.24889.60 = s32[1]{0} bitcast(%param_4.1926), metadata={scheduling_name="bitcast.24889.60"}
  %param_3.2297 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2297"}
  %subtract.259.59 = s32[1]{0} subtract(%bitcast.24889.60, %param_3.2297), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.59"}
  %constant_5440_29 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.53 = s32[1]{0} maximum(%subtract.259.59, %constant_5440_29), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.53"}
  %sign.28.48 = s32[1]{0} sign(%maximum.48.53), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.48"}
  %constant_5447_23 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.48 = pred[1]{0} compare(%sign.28.48, %constant_5447_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.48"}
  %constant_5448_25 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.53 = s32[1]{0} and(%maximum.48.53, %constant_5448_25), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.53"}
  %compare.1703.53 = pred[1]{0} compare(%and.321.53, %constant_5440_29), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.53"}
  %and.322.48 = pred[1]{0} and(%compare.1702.48, %compare.1703.53), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.48"}
  %constant_5449_23 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.48 = s32[1]{0} shift-right-logical(%maximum.48.53, %constant_5449_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.48"}
  %constant_5450_23 = s32[1]{0} constant({-1})
  %add.3079.48 = s32[1]{0} add(%shift-right-logical.21.48, %constant_5450_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.48"}
  %select.1355.48 = s32[1]{0} select(%and.322.48, %add.3079.48, %shift-right-logical.21.48), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.48"}
  %compare.1704.48 = pred[1]{0} compare(%select.1355.48, %constant_5440_29), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.48"}
  %add.3080.48 = s32[1]{0} add(%select.1355.48, %constant_5449_23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.48"}
  %select.1356.48 = s32[1]{0} select(%compare.1704.48, %add.3080.48, %select.1355.48), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.48"}
  %bitcast.24921.55 = s32[1,1]{1,0} bitcast(%select.1356.48), metadata={scheduling_name="bitcast.24921.55"}
  %pad.356.17 = s32[1,2]{1,0} pad(%bitcast.24921.55, %constant_5429_8), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.17"}
  %pad.357.15 = s32[1,3]{1,0} pad(%pad.356.17, %constant_5429_8), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.15"}
  %bitcast.24927.13 = s32[3]{0} bitcast(%pad.357.15), metadata={scheduling_name="bitcast.24927.13"}
  %slice.2413.13 = s32[1]{0} slice(%bitcast.24927.13), slice={[1:2]}, metadata={scheduling_name="slice.2413.13"}
  %bitcast.25754.10 = s32[] bitcast(%slice.2413.13), metadata={scheduling_name="bitcast.25754.10"}
  %dynamic-slice.1556.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2542, %constant_5429_8, %bitcast.25754.10, %constant_5429_8), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1556.3"}
  %bitcast.25564.6 = bf16[6144]{0} bitcast(%dynamic-slice.1556.3), metadata={scheduling_name="bitcast.25564.6"}
  %convert.5008.3 = f32[6144]{0} convert(%bitcast.25564.6), metadata={scheduling_name="convert.5008.3"}
  %broadcast.6063.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5008.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6063.1"}
  %multiply.2720.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2719.3, %broadcast.6063.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2720.1"}
  ROOT %convert.4262.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2720.1), metadata={scheduling_name="convert.4262.1"}
}

%fused_convert.4 (param_0.2825: bf16[32768,6144], param_1.2902: f32[1,4,8192], param_2.2547: bf16[1,2,6144], param_3.2298: s32[1], param_4.1927: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2825 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2825"}
  %bitcast.25150.7 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2825), metadata={scheduling_name="bitcast.25150.7"}
  %convert.4231.7 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.25150.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4231.7"}
  %param_1.2902 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2902"}
  %bitcast.25173.3 = f32[4,8192]{1,0} bitcast(%param_1.2902), metadata={scheduling_name="bitcast.25173.3"}
  %broadcast.5732.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.25173.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5732.3"}
  %multiply.2709.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4231.7, %broadcast.5732.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2709.3"}
  %param_2.2547 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2547"}
  %constant_5429_12 = s32[] constant(0)
  %param_4.1927 = s32[] parameter(4), metadata={scheduling_name="param_4.1927"}
  %bitcast.24889.62 = s32[1]{0} bitcast(%param_4.1927), metadata={scheduling_name="bitcast.24889.62"}
  %param_3.2298 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2298"}
  %subtract.259.61 = s32[1]{0} subtract(%bitcast.24889.62, %param_3.2298), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.61"}
  %constant_5440_30 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.55 = s32[1]{0} maximum(%subtract.259.61, %constant_5440_30), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.55"}
  %sign.28.50 = s32[1]{0} sign(%maximum.48.55), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.50"}
  %constant_5447_24 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.50 = pred[1]{0} compare(%sign.28.50, %constant_5447_24), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.50"}
  %constant_5448_26 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.55 = s32[1]{0} and(%maximum.48.55, %constant_5448_26), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.55"}
  %compare.1703.55 = pred[1]{0} compare(%and.321.55, %constant_5440_30), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.55"}
  %and.322.50 = pred[1]{0} and(%compare.1702.50, %compare.1703.55), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.50"}
  %constant_5449_24 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.50 = s32[1]{0} shift-right-logical(%maximum.48.55, %constant_5449_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.50"}
  %constant_5450_24 = s32[1]{0} constant({-1})
  %add.3079.50 = s32[1]{0} add(%shift-right-logical.21.50, %constant_5450_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.50"}
  %select.1355.50 = s32[1]{0} select(%and.322.50, %add.3079.50, %shift-right-logical.21.50), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.50"}
  %compare.1704.50 = pred[1]{0} compare(%select.1355.50, %constant_5440_30), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.50"}
  %add.3080.50 = s32[1]{0} add(%select.1355.50, %constant_5449_24), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.50"}
  %select.1356.50 = s32[1]{0} select(%compare.1704.50, %add.3080.50, %select.1355.50), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.50"}
  %bitcast.24921.57 = s32[1,1]{1,0} bitcast(%select.1356.50), metadata={scheduling_name="bitcast.24921.57"}
  %pad.356.19 = s32[1,2]{1,0} pad(%bitcast.24921.57, %constant_5429_12), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.19"}
  %pad.357.17 = s32[1,3]{1,0} pad(%pad.356.19, %constant_5429_12), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.17"}
  %bitcast.24927.15 = s32[3]{0} bitcast(%pad.357.17), metadata={scheduling_name="bitcast.24927.15"}
  %slice.2413.15 = s32[1]{0} slice(%bitcast.24927.15), slice={[1:2]}, metadata={scheduling_name="slice.2413.15"}
  %bitcast.25754.14 = s32[] bitcast(%slice.2413.15), metadata={scheduling_name="bitcast.25754.14"}
  %dynamic-slice.1550.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2547, %constant_5429_12, %bitcast.25754.14, %constant_5429_12), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1550.3"}
  %bitcast.25184.6 = bf16[6144]{0} bitcast(%dynamic-slice.1550.3), metadata={scheduling_name="bitcast.25184.6"}
  %convert.5005.3 = f32[6144]{0} convert(%bitcast.25184.6), metadata={scheduling_name="convert.5005.3"}
  %broadcast.6059.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.5005.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6059.1"}
  %multiply.2710.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2709.3, %broadcast.6059.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2710.1"}
  ROOT %convert.4234.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2710.1), metadata={scheduling_name="convert.4234.1"}
}

%fused_convert.5 (param_0.2826: bf16[1,4,8192,6144], param_1.2903: f32[1,4,8192], param_2.2552: bf16[1,2,6144], param_3.2282: s32[1], param_4.1924: s32[]) -> bf16[1,4,8192,6144] {
  %param_0.2826 = bf16[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2826"}
  %convert.4198.4 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_0.2826), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4198.4"}
  %param_1.2903 = f32[1,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2903"}
  %bitcast.24879.3 = f32[4,8192]{1,0} bitcast(%param_1.2903), metadata={scheduling_name="bitcast.24879.3"}
  %broadcast.5720.3 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24879.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5720.3"}
  %multiply.2696.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4198.4, %broadcast.5720.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2696.3"}
  %param_2.2552 = bf16[1,2,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.2552"}
  %constant_5429_10 = s32[] constant(0)
  %param_4.1924 = s32[] parameter(4), metadata={scheduling_name="param_4.1924"}
  %bitcast.24889.64 = s32[1]{0} bitcast(%param_4.1924), metadata={scheduling_name="bitcast.24889.64"}
  %param_3.2282 = s32[1]{0} parameter(3), metadata={scheduling_name="param_3.2282"}
  %subtract.259.63 = s32[1]{0} subtract(%bitcast.24889.64, %param_3.2282), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.63"}
  %constant_5440_4 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.57 = s32[1]{0} maximum(%subtract.259.63, %constant_5440_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.57"}
  %sign.28.52 = s32[1]{0} sign(%maximum.48.57), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.28.52"}
  %constant_5447_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1702.52 = pred[1]{0} compare(%sign.28.52, %constant_5447_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1702.52"}
  %constant_5448_3 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.57 = s32[1]{0} and(%maximum.48.57, %constant_5448_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.57"}
  %compare.1703.57 = pred[1]{0} compare(%and.321.57, %constant_5440_4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.57"}
  %and.322.52 = pred[1]{0} and(%compare.1702.52, %compare.1703.57), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.322.52"}
  %constant_5449_2 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.21.52 = s32[1]{0} shift-right-logical(%maximum.48.57, %constant_5449_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.21.52"}
  %constant_5450_4 = s32[1]{0} constant({-1})
  %add.3079.52 = s32[1]{0} add(%shift-right-logical.21.52, %constant_5450_4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.3079.52"}
  %select.1355.52 = s32[1]{0} select(%and.322.52, %add.3079.52, %shift-right-logical.21.52), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1355.52"}
  %compare.1704.52 = pred[1]{0} compare(%select.1355.52, %constant_5440_4), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1704.52"}
  %add.3080.52 = s32[1]{0} add(%select.1355.52, %constant_5449_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3080.52"}
  %select.1356.52 = s32[1]{0} select(%compare.1704.52, %add.3080.52, %select.1355.52), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1356.52"}
  %bitcast.24921.59 = s32[1,1]{1,0} bitcast(%select.1356.52), metadata={scheduling_name="bitcast.24921.59"}
  %pad.356.21 = s32[1,2]{1,0} pad(%bitcast.24921.59, %constant_5429_10), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.356.21"}
  %pad.357.19 = s32[1,3]{1,0} pad(%pad.356.21, %constant_5429_10), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.357.19"}
  %bitcast.24927.17 = s32[3]{0} bitcast(%pad.357.19), metadata={scheduling_name="bitcast.24927.17"}
  %slice.2413.17 = s32[1]{0} slice(%bitcast.24927.17), slice={[1:2]}, metadata={scheduling_name="slice.2413.17"}
  %bitcast.25754.18 = s32[] bitcast(%slice.2413.17), metadata={scheduling_name="bitcast.25754.18"}
  %dynamic-slice.1544.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.2552, %constant_5429_10, %bitcast.25754.18, %constant_5429_10), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1544.3"}
  %bitcast.24933.6 = bf16[6144]{0} bitcast(%dynamic-slice.1544.3), metadata={scheduling_name="bitcast.24933.6"}
  %convert.4998.3 = f32[6144]{0} convert(%bitcast.24933.6), metadata={scheduling_name="convert.4998.3"}
  %broadcast.6054.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4998.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6054.1"}
  %multiply.2697.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2696.3, %broadcast.6054.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2697.1"}
  ROOT %convert.4200.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2697.1), metadata={scheduling_name="convert.4200.1"}
}

%fused_concatenate (param_0.2951: bf16[1,1,4,8192,64], param_1.3021: bf16[32768,6144], param_2.2259: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.3021 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.3021"}
  %bitcast.24963.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.3021), metadata={scheduling_name="bitcast.24963.18"}
  %slice.2415.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.24963.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2415.9"}
  %convert.4201.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2415.9), metadata={scheduling_name="convert.4201.14"}
  %param_2.2259 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2259"}
  %bitcast.25006.19 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2259), metadata={scheduling_name="bitcast.25006.19"}
  %convert.4999.15 = f32[4,8192,64]{2,1,0} convert(%bitcast.25006.19), metadata={scheduling_name="convert.4999.15"}
  %broadcast.6055.8 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4999.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6055.8"}
  %multiply.2698.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4201.14, %broadcast.6055.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2698.7"}
  %slice.2416.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.24963.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2416.9"}
  %convert.4207.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2416.9), metadata={scheduling_name="convert.4207.10"}
  %param_0.2951 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2951"}
  %bitcast.25019.19 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.2951), metadata={scheduling_name="bitcast.25019.19"}
  %convert.5000.15 = f32[4,8192,64]{2,1,0} convert(%bitcast.25019.19), metadata={scheduling_name="convert.5000.15"}
  %broadcast.6056.8 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.5000.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6056.8"}
  %multiply.2699.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4207.10, %broadcast.6056.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2699.5"}
  %subtract.260.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2698.7, %multiply.2699.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.260.5"}
  %convert.4210.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.260.5), metadata={scheduling_name="convert.4210.3"}
  %multiply.2700.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4207.10, %broadcast.6055.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2700.5"}
  %multiply.2701.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4201.14, %broadcast.6056.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2701.7"}
  %add.3083.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2700.5, %multiply.2701.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3083.5"}
  %convert.4217.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3083.5), metadata={scheduling_name="convert.4217.3"}
  ROOT %concatenate.717.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4210.3, %convert.4217.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.717.1"}
}

%fused_concatenate.1 (param_0.2955: bf16[1,1,4,8192,64], param_1.3028: bf16[32768,6144], param_2.2266: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.3028 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.3028"}
  %bitcast.25587.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.3028), metadata={scheduling_name="bitcast.25587.18"}
  %slice.2429.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.25587.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2429.9"}
  %convert.4263.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2429.9), metadata={scheduling_name="convert.4263.14"}
  %param_2.2266 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2266"}
  %bitcast.25006.23 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2266), metadata={scheduling_name="bitcast.25006.23"}
  %convert.4999.19 = f32[4,8192,64]{2,1,0} convert(%bitcast.25006.23), metadata={scheduling_name="convert.4999.19"}
  %broadcast.6055.12 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4999.19), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6055.12"}
  %multiply.2721.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4263.14, %broadcast.6055.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2721.7"}
  %slice.2430.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.25587.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2430.9"}
  %convert.4265.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2430.9), metadata={scheduling_name="convert.4265.10"}
  %param_0.2955 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2955"}
  %bitcast.25019.23 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.2955), metadata={scheduling_name="bitcast.25019.23"}
  %convert.5000.19 = f32[4,8192,64]{2,1,0} convert(%bitcast.25019.23), metadata={scheduling_name="convert.5000.19"}
  %broadcast.6056.12 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.5000.19), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6056.12"}
  %multiply.2722.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4265.10, %broadcast.6056.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2722.5"}
  %subtract.264.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2721.7, %multiply.2722.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.264.5"}
  %convert.4268.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.264.5), metadata={scheduling_name="convert.4268.3"}
  %multiply.2723.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4265.10, %broadcast.6055.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2723.5"}
  %multiply.2724.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4263.14, %broadcast.6056.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2724.7"}
  %add.3092.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2723.5, %multiply.2724.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3092.5"}
  %convert.4274.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3092.5), metadata={scheduling_name="convert.4274.3"}
  ROOT %concatenate.722.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4268.3, %convert.4274.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.722.1"}
}

%fused_concatenate.2 (param_0.3036: bf16[1,1,4,8192,64], param_1.3123: bf16[32768,1024], param_2.2337: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.3123 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.3123"}
  %bitcast.25060.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.3123), metadata={scheduling_name="bitcast.25060.14"}
  %slice.2417.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25060.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2417.7"}
  %convert.4218.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2417.7), metadata={scheduling_name="convert.4218.10"}
  %param_2.2337 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2337"}
  %bitcast.25006.43 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2337), metadata={scheduling_name="bitcast.25006.43"}
  %convert.4999.37 = f32[4,8192,64]{2,1,0} convert(%bitcast.25006.43), metadata={scheduling_name="convert.4999.37"}
  %broadcast.6057.19 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4999.37), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6057.19"}
  %multiply.2702.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4218.10, %broadcast.6057.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2702.5"}
  %slice.2418.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25060.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2418.7"}
  %convert.4220.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2418.7), metadata={scheduling_name="convert.4220.10"}
  %param_0.3036 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3036"}
  %bitcast.25019.51 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.3036), metadata={scheduling_name="bitcast.25019.51"}
  %convert.5000.45 = f32[4,8192,64]{2,1,0} convert(%bitcast.25019.51), metadata={scheduling_name="convert.5000.45"}
  %broadcast.6058.27 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.5000.45), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6058.27"}
  %multiply.2703.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4220.10, %broadcast.6058.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2703.7"}
  %subtract.261.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2702.5, %multiply.2703.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.261.5"}
  %convert.4223.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.261.5), metadata={scheduling_name="convert.4223.3"}
  %multiply.2704.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4220.10, %broadcast.6057.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2704.5"}
  %multiply.2705.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4218.10, %broadcast.6058.27), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2705.7"}
  %add.3085.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2704.5, %multiply.2705.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3085.5"}
  %convert.4229.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3085.5), metadata={scheduling_name="convert.4229.3"}
  ROOT %concatenate.718.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4223.3, %convert.4229.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.718.1"}
}

%fused_concatenate.3 (param_0.3041: bf16[1,1,4,8192,64], param_1.3130: bf16[32768,1024], param_2.2344: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.3130 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.3130"}
  %bitcast.25639.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.3130), metadata={scheduling_name="bitcast.25639.14"}
  %slice.2431.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25639.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2431.7"}
  %convert.4276.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2431.7), metadata={scheduling_name="convert.4276.10"}
  %param_2.2344 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.2344"}
  %bitcast.25006.47 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.2344), metadata={scheduling_name="bitcast.25006.47"}
  %convert.4999.41 = f32[4,8192,64]{2,1,0} convert(%bitcast.25006.47), metadata={scheduling_name="convert.4999.41"}
  %broadcast.6057.23 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4999.41), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6057.23"}
  %multiply.2725.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4276.10, %broadcast.6057.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2725.5"}
  %slice.2432.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.25639.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2432.7"}
  %convert.4279.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2432.7), metadata={scheduling_name="convert.4279.10"}
  %param_0.3041 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3041"}
  %bitcast.25019.55 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.3041), metadata={scheduling_name="bitcast.25019.55"}
  %convert.5000.49 = f32[4,8192,64]{2,1,0} convert(%bitcast.25019.55), metadata={scheduling_name="convert.5000.49"}
  %broadcast.6058.31 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.5000.49), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6058.31"}
  %multiply.2726.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4279.10, %broadcast.6058.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2726.7"}
  %subtract.265.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2725.5, %multiply.2726.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.265.5"}
  %convert.4281.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.265.5), metadata={scheduling_name="convert.4281.3"}
  %multiply.2727.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4279.10, %broadcast.6057.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2727.5"}
  %multiply.2728.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4276.10, %broadcast.6058.31), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2728.7"}
  %add.3093.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2727.5, %multiply.2728.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3093.5"}
  %convert.4288.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3093.5), metadata={scheduling_name="convert.4288.3"}
  ROOT %concatenate.723.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4281.3, %convert.4288.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.723.1"}
}

%fused_convert.6 (param_0.3316: f32[1,1,1,1,64], param_1.3460: s32[4,4,8192], param_2.2803: s32[1], param_3.2299: s32[]) -> (bf16[1,1,4,8192,64], bf16[1,1,4,8192,64]) {
  %param_1.3460 = s32[4,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.3460"}
  %param_3.2299 = s32[] parameter(3), metadata={scheduling_name="param_3.2299"}
  %bitcast.24889.48 = s32[1]{0} bitcast(%param_3.2299), metadata={scheduling_name="bitcast.24889.48"}
  %param_2.2803 = s32[1]{0} parameter(2), metadata={scheduling_name="param_2.2803"}
  %subtract.259.47 = s32[1]{0} subtract(%bitcast.24889.48, %param_2.2803), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.259.47"}
  %constant_5440_3 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.48.41 = s32[1]{0} maximum(%subtract.259.47, %constant_5440_3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.48.41"}
  %constant_5448_2 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.321.41 = s32[1]{0} and(%maximum.48.41, %constant_5448_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.321.41"}
  %compare.1705.5 = pred[1]{0} compare(%and.321.41, %constant_5440_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="compare.1705.5"}
  %compare.1703.41 = pred[1]{0} compare(%and.321.41, %constant_5440_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1703.41"}
  %and.323.5 = pred[1]{0} and(%compare.1705.5, %compare.1703.41), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="and.323.5"}
  %constant_5452_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219}
  %add.3081.5 = s32[1]{0} add(%and.321.41, %constant_5452_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="add.3081.5"}
  %select.1357.5 = s32[1]{0} select(%and.323.5, %add.3081.5, %and.321.41), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="select.1357.5"}
  %compare.1706.5 = pred[1]{0} compare(%select.1357.5, %constant_5440_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="compare.1706.5"}
  %add.3082.5 = s32[1]{0} add(%select.1357.5, %constant_5452_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="add.3082.5"}
  %select.1358.5 = s32[1]{0} select(%compare.1706.5, %add.3082.5, %select.1357.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="select.1358.5"}
  %bitcast.24990.7 = s32[] bitcast(%select.1358.5), metadata={scheduling_name="bitcast.24990.7"}
  %constant_5429_50 = s32[] constant(0)
  %dynamic-slice.1546.7 = s32[1,4,8192]{2,1,0} dynamic-slice(%param_1.3460, %bitcast.24990.7, %constant_5429_50, %constant_5429_50), dynamic_slice_sizes={1,4,8192}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/squeeze" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="dynamic-slice.1546.7"}
  %convert.4202.5 = f32[1,4,8192]{2,1,0} convert(%dynamic-slice.1546.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="convert.4202.5"}
  %bitcast.24995.3 = f32[4,8192]{1,0} bitcast(%convert.4202.5), metadata={scheduling_name="bitcast.24995.3"}
  %broadcast.5722.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.24995.3), dimensions={2,3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5722.3"}
  %param_0.3316 = f32[1,1,1,1,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3316"}
  %bitcast.25000.3 = f32[64]{0} bitcast(%param_0.3316), metadata={scheduling_name="bitcast.25000.3"}
  %broadcast.5723.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.25000.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5723.3"}
  %divide.472.4 = f32[1,1,4,8192,64]{4,3,2,1,0} divide(%broadcast.5722.3, %broadcast.5723.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="divide.472.4"}
  %cosine.71.3 = f32[1,1,4,8192,64]{4,3,2,1,0} cosine(%divide.472.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/cos" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="cosine.71.3"}
  %convert.4204.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%cosine.71.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="convert.4204.1"}
  %sine.68.3.clone.1 = f32[1,1,4,8192,64]{4,3,2,1,0} sine(%divide.472.4), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sin" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="sine.68.3.clone.1"}
  %convert.4208.1.clone.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%sine.68.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="convert.4208.1.clone.1"}
  ROOT %tuple.551 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) tuple(%convert.4204.1, %convert.4208.1.clone.1), metadata={scheduling_name="tuple.551"}
}

%fused_compare.2 (param_0.3088: s32[1,1,1,1,8], param_1.3180: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_1.3180 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.3180"}
  %bitcast.25873.3 = s32[4,8192,2]{2,1,0} bitcast(%param_1.3180), metadata={scheduling_name="bitcast.25873.3"}
  %broadcast.5767.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25873.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5767.3"}
  %param_0.3088 = s32[1,1,1,1,8]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3088"}
  %bitcast.25329.3 = s32[8]{0} bitcast(%param_0.3088), metadata={scheduling_name="bitcast.25329.3"}
  %broadcast.5742.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25329.3), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5742.3"}
  ROOT %compare.1715.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5767.3, %broadcast.5742.3), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1715.1"}
}

%fused_compare.3 (param_0.3083: s32[1,1,1,1,8], param_1.3172: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_1.3172 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.3172"}
  %bitcast.25324.3 = s32[4,8192,2]{2,1,0} bitcast(%param_1.3172), metadata={scheduling_name="bitcast.25324.3"}
  %broadcast.5741.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25324.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5741.3"}
  %param_0.3083 = s32[1,1,1,1,8]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3083"}
  %bitcast.25329.5 = s32[8]{0} bitcast(%param_0.3083), metadata={scheduling_name="bitcast.25329.5"}
  %broadcast.5742.5 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.25329.5), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5742.5"}
  ROOT %compare.1709.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5741.3, %broadcast.5742.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1709.1"}
}

%fused_slice (param_0.3345: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.3345 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3345"}
  %convert.4243.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3345), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4243.9"}
  %bitcast.25334.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4243.9), metadata={scheduling_name="bitcast.25334.3"}
  %constant_5429_42 = s32[] constant(0)
  %reduce-window.168.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25334.3, %constant_5429_42), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.168.3"}
  ROOT %slice.2422.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.168.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2422.1"}
}

%fused_slice.1 (param_0.3346: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.3346 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3346"}
  %convert.4299.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.3346), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4299.9"}
  %bitcast.25880.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4299.9), metadata={scheduling_name="bitcast.25880.3"}
  %constant_5429_46 = s32[] constant(0)
  %reduce-window.172.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.25880.3, %constant_5429_46), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.172.3"}
  ROOT %slice.2435.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.172.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2435.1"}
}

%fused_rsqrt (param_0.3355: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3355 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3355"}
  %bitcast.25734.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3355), metadata={scheduling_name="bitcast.25734.3"}
  %constant_5435_1 = f32[] constant(0.000162760422)
  %broadcast.5718.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_5435_1), dimensions={}, metadata={scheduling_name="broadcast.5718.6"}
  %multiply.2730.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.25734.3, %broadcast.5718.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2730.3"}
  %constant_5436_1 = f32[] constant(1e-05)
  %broadcast.5719.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_5436_1), dimensions={}, metadata={scheduling_name="broadcast.5719.6"}
  %add.3094.3 = f32[1,4,8192]{2,1,0} add(%multiply.2730.3, %broadcast.5719.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3094.3"}
  ROOT %rsqrt.102.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.3094.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.102.1"}
}

%fused_rsqrt.1 (param_0.3358: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3358 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3358"}
  %bitcast.25542.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3358), metadata={scheduling_name="bitcast.25542.3"}
  %constant_5435_4 = f32[] constant(0.000162760422)
  %broadcast.5718.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_5435_4), dimensions={}, metadata={scheduling_name="broadcast.5718.8"}
  %multiply.2718.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.25542.3, %broadcast.5718.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2718.3"}
  %constant_5436_4 = f32[] constant(1e-05)
  %broadcast.5719.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_5436_4), dimensions={}, metadata={scheduling_name="broadcast.5719.8"}
  %add.3091.3 = f32[1,4,8192]{2,1,0} add(%multiply.2718.3, %broadcast.5719.8), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3091.3"}
  ROOT %rsqrt.101.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.3091.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.101.1"}
}

%fused_rsqrt.2 (param_0.3357: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3357 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3357"}
  %bitcast.25162.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3357), metadata={scheduling_name="bitcast.25162.3"}
  %constant_5435_3 = f32[] constant(0.000162760422)
  %broadcast.5718.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_5435_3), dimensions={}, metadata={scheduling_name="broadcast.5718.10"}
  %multiply.2708.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.25162.3, %broadcast.5718.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2708.3"}
  %constant_5436_3 = f32[] constant(1e-05)
  %broadcast.5719.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_5436_3), dimensions={}, metadata={scheduling_name="broadcast.5719.10"}
  %add.3086.3 = f32[1,4,8192]{2,1,0} add(%multiply.2708.3, %broadcast.5719.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3086.3"}
  ROOT %rsqrt.100.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.3086.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.100.1"}
}

%fused_rsqrt.3 (param_0.3356: f32[4,8192]) -> f32[1,4,8192] {
  %param_0.3356 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3356"}
  %bitcast.24870.3 = f32[1,4,8192]{2,1,0} bitcast(%param_0.3356), metadata={scheduling_name="bitcast.24870.3"}
  %constant_5435_2 = f32[] constant(0.000162760422)
  %broadcast.5718.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_5435_2), dimensions={}, metadata={scheduling_name="broadcast.5718.12"}
  %multiply.2695.3 = f32[1,4,8192]{2,1,0} multiply(%bitcast.24870.3, %broadcast.5718.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2695.3"}
  %constant_5436_2 = f32[] constant(1e-05)
  %broadcast.5719.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_5436_2), dimensions={}, metadata={scheduling_name="broadcast.5719.12"}
  %add.3078.3 = f32[1,4,8192]{2,1,0} add(%multiply.2695.3, %broadcast.5719.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3078.3"}
  ROOT %rsqrt.99.1 = f32[1,4,8192]{2,1,0} rsqrt(%add.3078.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.99.1"}
}

%fused_convert.7 (param_0.3250: f32[32768,8]) -> f32[32768,2] {
  %param_0.3250 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.3250"}
  %convert.4236.3 = bf16[32768,8]{1,0} convert(%param_0.3250), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.4236.3"}
  %slice.2420.3 = bf16[32768,2]{1,0} slice(%convert.4236.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2420.3"}
  ROOT %convert.4237.1 = f32[32768,2]{1,0} convert(%slice.2420.3), metadata={scheduling_name="convert.4237.1"}
}

%fused_convert.8 (param_0.3254: f32[32768,8]) -> f32[32768,2] {
  %param_0.3254 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.3254"}
  %convert.4294.3 = bf16[32768,8]{1,0} convert(%param_0.3254), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.4294.3"}
  %slice.2433.3 = bf16[32768,2]{1,0} slice(%convert.4294.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2433.3"}
  ROOT %convert.4295.1 = f32[32768,2]{1,0} convert(%slice.2433.3), metadata={scheduling_name="convert.4295.1"}
}

%fused_multiply () -> s32[65] {
  %iota.388.1 = s32[65]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="iota.388.1"}
  %constant_5455_1 = s32[] constant(8192), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %broadcast.5729.1 = s32[65]{0} broadcast(%constant_5455_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5729.1"}
  ROOT %multiply.2706.1 = s32[65]{0} multiply(%iota.388.1, %broadcast.5729.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="multiply.2706.1"}
}

%fused_add (param_0.3333: s32[]) -> s32[] {
  %param_0.3333 = s32[] parameter(0), metadata={scheduling_name="param_0.3333"}
  %constant_5427_2 = s32[] constant(1)
  ROOT %add.3070.1 = s32[] add(%param_0.3333, %constant_5427_2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="add.3070.1"}
}

%fused_broadcast () -> bf16[1,4,8192,8] {
  %constant_5432_2 = bf16[] constant(0)
  ROOT %broadcast.5714.1 = bf16[1,4,8192,8]{3,2,1,0} broadcast(%constant_5432_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5714.1"}
}

%fused_broadcast.1 () -> u32[1,4,8192,8] {
  %constant_5438_1 = u32[] constant(0)
  ROOT %broadcast.5737.1 = u32[1,4,8192,8]{3,2,1,0} broadcast(%constant_5438_1), dimensions={}, metadata={scheduling_name="broadcast.5737.1"}
}

%fused_broadcast.2 () -> u32[2] {
  %constant_5438_2 = u32[] constant(0)
  ROOT %broadcast.5728.1 = u32[2]{0} broadcast(%constant_5438_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5728.1"}
}

%fused_compare.4 (param_0_0: s32[]) -> (pred[], pred[]) {
  %param_0_0 = s32[] parameter(0), metadata={scheduling_name="param_0_0"}
  %constant_5429_54 = s32[] constant(0)
  %compare.1701.2 = pred[] compare(%param_0_0, %constant_5429_54), direction=EQ, metadata={scheduling_name="compare.1701.2"}
  %constant_5431_4 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168}
  %compare.1693.2 = pred[] compare(%param_0_0, %constant_5431_4), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="compare.1693.2"}
  ROOT %tuple.648 = (pred[], pred[]) tuple(%compare.1701.2, %compare.1693.2), metadata={scheduling_name="tuple.648"}
}

%async_computation (param_0.6082: bf16[1,1,4,8,1,2048,6144]) -> bf16[1,1,4,8,1,2048,6144] {
  %param_0.6082 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6082"}
  ROOT %all-to-all.40.1 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6082), channel_id=59, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.40.1"}
}

%async_computation.1 (param_0.6083: bf16[1,1,1,8,4,2048,6144]) -> bf16[1,1,1,8,4,2048,6144] {
  %param_0.6083 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6083"}
  ROOT %all-to-all.41.1 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6083), channel_id=66, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.41.1"}
}

%async_computation.2 (param_0.6084: bf16[1,1,4,8,1,2048,6144]) -> bf16[1,1,4,8,1,2048,6144] {
  %param_0.6084 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6084"}
  ROOT %all-to-all.42.1 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6084), channel_id=118, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.42.1"}
}

%async_computation.3 (param_0.6085: bf16[1,1,1,8,4,2048,6144]) -> bf16[1,1,1,8,4,2048,6144] {
  %param_0.6085 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6085"}
  ROOT %all-to-all.43.1 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6085), channel_id=125, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.43.1"}
}

%wrapped_convert_computation (param_0.6107: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6107 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6107"}
  ROOT %convert.4235.1 = f32[32768,8]{1,0} convert(%param_0.6107), metadata={scheduling_name="convert.4235.1"}
}

%wrapped_iota_computation.3 () -> s32[32768,8] {
  ROOT %iota.389.1 = s32[32768,8]{1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="iota.389.1"}
}

%wrapped_slice_computation (param_0.6108: s32[32768,8]) -> s32[32768,2] {
  %param_0.6108 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6108"}
  ROOT %slice.2421.1 = s32[32768,2]{1,0} slice(%param_0.6108), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2421.1"}
}

%wrapped_iota_computation.4 () -> s32[32768,2] {
  ROOT %iota.390.1 = s32[32768,2]{1,0} iota(), iota_dimension=1, metadata={scheduling_name="iota.390.1"}
}

%wrapped_convert_computation.1 (param_0.6109: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6109 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6109"}
  ROOT %convert.4292.1 = f32[32768,8]{1,0} convert(%param_0.6109), metadata={scheduling_name="convert.4292.1"}
}

%wrapped_slice_computation.1 (param_0.6110: s32[32768,8]) -> s32[32768,2] {
  %param_0.6110 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6110"}
  ROOT %slice.2434.1 = s32[32768,2]{1,0} slice(%param_0.6110), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2434.1"}
}

%region_0.1585.sunk.clone.sunk.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone (param.217: (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144])) -> (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144]) {
  %param.217 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) parameter(0), metadata={scheduling_name="param.217"}
  %constant_5439_0 = f32[0]{0} constant({})
  %constant_5437_0 = bf16[0]{0} constant({})
  %constant_5442_0 = u32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %get-tuple-element.4453 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=3, metadata={scheduling_name="get-tuple-element.4453"}
  %collective-permute-start.2 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4453), channel_id=126, source_target_pairs={{0,16},{1,17},{2,18},{3,19},{4,20},{5,21},{6,22},{7,23},{8,24},{9,25},{10,26},{11,27},{12,28},{13,29},{14,30},{15,31}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.2 = u32[2]{0} fusion(), kind=kLoop, calls=%fused_broadcast.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="loop_broadcast_fusion.2"}
  %loop_multiply_fusion = s32[65]{0} fusion(), kind=kLoop, calls=%fused_multiply, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 deduplicated_name="loop_multiply_fusion.5" scheduling_name="loop_multiply_fusion"}
  %get-tuple-element.4450 = s32[] get-tuple-element(%param.217), index=0, metadata={scheduling_name="get-tuple-element.4450"}
  %copy.748 = s32[] copy(%get-tuple-element.4450), metadata={scheduling_name="copy.748"}
  %loop_compare_fusion.4 = (pred[], pred[]) fusion(%copy.748), kind=kLoop, calls=%fused_compare.4, metadata={scheduling_name="loop_compare_fusion.4"}
  %get-tuple-element.4512 = s32[1]{0} get-tuple-element(%param.217), index=18, metadata={scheduling_name="get-tuple-element.4512"}
  %get-tuple-element.4533 = bf16[1,2,768,8]{3,2,1,0} get-tuple-element(%param.217), index=39, metadata={scheduling_name="get-tuple-element.4533"}
  %loop_dynamic_slice_fusion.2 = bf16[1,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4533, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.2, metadata={deduplicated_name="loop_dynamic_slice_fusion.1" scheduling_name="loop_dynamic_slice_fusion.2"}
  %get-tuple-element.4520 = bf16[1,2,768,8]{3,2,1,0} get-tuple-element(%param.217), index=26, metadata={scheduling_name="get-tuple-element.4520"}
  %loop_dynamic_slice_fusion.1 = bf16[1,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4520, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.1, metadata={deduplicated_name="loop_dynamic_slice_fusion.1" scheduling_name="loop_dynamic_slice_fusion.1"}
  %get-tuple-element.4530 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=36, metadata={scheduling_name="get-tuple-element.4530"}
  %loop_dynamic_slice_fusion.12 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4530, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.12, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.12"}
  %get-tuple-element.4529 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=35, metadata={scheduling_name="get-tuple-element.4529"}
  %loop_dynamic_slice_fusion.11 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4529, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.11, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.11"}
  %get-tuple-element.4517 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=23, metadata={scheduling_name="get-tuple-element.4517"}
  %loop_dynamic_slice_fusion.6 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4517, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.6, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.6"}
  %get-tuple-element.4516 = bf16[1,2,768,8,128]{4,3,2,1,0} get-tuple-element(%param.217), index=22, metadata={scheduling_name="get-tuple-element.4516"}
  %loop_dynamic_slice_fusion.5 = bf16[1,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4516, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.5, metadata={deduplicated_name="loop_dynamic_slice_fusion.5" scheduling_name="loop_dynamic_slice_fusion.5"}
  %get-tuple-element.4531 = bf16[1,2,48,128,768]{3,2,4,1,0} get-tuple-element(%param.217), index=37, metadata={scheduling_name="get-tuple-element.4531"}
  %loop_dynamic_slice_fusion = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4531, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice, metadata={deduplicated_name="loop_dynamic_slice_fusion" scheduling_name="loop_dynamic_slice_fusion"}
  %get-tuple-element.4528 = bf16[1,2,768,48,128]{4,3,2,1,0} get-tuple-element(%param.217), index=34, metadata={scheduling_name="get-tuple-element.4528"}
  %loop_dynamic_slice_fusion.10 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4528, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.10, metadata={deduplicated_name="loop_dynamic_slice_fusion.4" scheduling_name="loop_dynamic_slice_fusion.10"}
  %get-tuple-element.4518 = bf16[1,2,48,128,768]{3,2,4,1,0} get-tuple-element(%param.217), index=24, metadata={scheduling_name="get-tuple-element.4518"}
  %loop_dynamic_slice_fusion.3 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4518, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.3, metadata={deduplicated_name="loop_dynamic_slice_fusion" scheduling_name="loop_dynamic_slice_fusion.3"}
  %get-tuple-element.4513 = bf16[1,2,768,48,128]{4,3,2,1,0} get-tuple-element(%param.217), index=19, metadata={scheduling_name="get-tuple-element.4513"}
  %loop_dynamic_slice_fusion.4 = bf16[1,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4513, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.4, metadata={deduplicated_name="loop_dynamic_slice_fusion.4" scheduling_name="loop_dynamic_slice_fusion.4"}
  %collective-permute-done.2 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-done.2"}
  %bitcast.25772.0 = bf16[1,768,8]{2,0,1} bitcast(%loop_dynamic_slice_fusion.2), metadata={scheduling_name="bitcast.25772.0"}
  %bitcast.25208.0 = bf16[1,768,8]{2,0,1} bitcast(%loop_dynamic_slice_fusion.1), metadata={scheduling_name="bitcast.25208.0"}
  %bitcast.25684.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.12), metadata={scheduling_name="bitcast.25684.0"}
  %bitcast.25632.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.11), metadata={scheduling_name="bitcast.25632.0"}
  %bitcast.25107.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.6), metadata={scheduling_name="bitcast.25107.0"}
  %bitcast.25053.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.5), metadata={scheduling_name="bitcast.25053.0"}
  %bitcast.32287 = bf16[1,768,128,48]{2,3,0,1} bitcast(%loop_dynamic_slice_fusion), metadata={scheduling_name="bitcast.32287"}
  %bitcast.25580.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.10), metadata={scheduling_name="bitcast.25580.0"}
  %bitcast.32286 = bf16[1,768,128,48]{2,3,0,1} bitcast(%loop_dynamic_slice_fusion.3), metadata={scheduling_name="bitcast.32286"}
  %bitcast.24956.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%loop_dynamic_slice_fusion.4), metadata={scheduling_name="bitcast.24956.0"}
  %all-gather-start = ((bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, /*index=5*/bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}), (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1})) all-gather-start(%bitcast.24956.0, %bitcast.25053.0, %bitcast.25107.0, %bitcast.32286, %bitcast.25208.0, /*index=5*/%bitcast.25580.0, %bitcast.25632.0, %bitcast.25684.0, %bitcast.32287, %bitcast.25772.0), channel_id=8, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={1}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_iota.4 = s32[32768,2]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.4, metadata={scheduling_name="wrapped_iota.4"}
  %loop_broadcast_fusion = bf16[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_broadcast_fusion.3" scheduling_name="loop_broadcast_fusion"}
  %get-tuple-element.4451 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=1, metadata={scheduling_name="get-tuple-element.4451"}
  %get-tuple-element.4454 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=4, metadata={scheduling_name="get-tuple-element.4454"}
  %get-tuple-element.4510 = pred[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=16, metadata={scheduling_name="get-tuple-element.4510"}
  %get-tuple-element.4257 = pred[] get-tuple-element(%loop_compare_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.4257"}
  %get-tuple-element.4256 = pred[] get-tuple-element(%loop_compare_fusion.4), index=0, metadata={scheduling_name="get-tuple-element.4256"}
  %input_dynamic_slice_reduce_select_fusion = (f32[4,8192]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) fusion(%get-tuple-element.4510, %get-tuple-element.4453, %collective-permute-done.2, %get-tuple-element.4256, %get-tuple-element.4451, /*index=5*/%get-tuple-element.4454, %copy.748, %get-tuple-element.4257), kind=kInput, calls=%fused_dynamic_slice_reduce_select, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_dynamic_slice_reduce_select_fusion"}
  %get-tuple-element.4514 = s32[4,4,8192]{2,1,0} get-tuple-element(%param.217), index=20, metadata={scheduling_name="get-tuple-element.4514"}
  %get-tuple-element.4515 = f32[1,1,1,1,64]{4,3,2,1,0} get-tuple-element(%param.217), index=21, metadata={scheduling_name="get-tuple-element.4515"}
  %loop_convert_fusion.6 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) fusion(%get-tuple-element.4515, %get-tuple-element.4514, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_convert.6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="loop_convert_fusion.6"}
  %get-tuple-element.4094 = f32[4,8192]{1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4094"}
  %loop_rsqrt_fusion.3 = f32[1,4,8192]{2,1,0} fusion(%get-tuple-element.4094), kind=kLoop, calls=%fused_rsqrt.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.3"}
  %get-tuple-element.4511 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=17, metadata={scheduling_name="get-tuple-element.4511"}
  %get-tuple-element.4120 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4120"}
  %loop_convert_fusion.5 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.4120, %loop_rsqrt_fusion.3, %get-tuple-element.4511, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_convert.5, metadata={scheduling_name="loop_convert_fusion.5"}
  %all-gather-done = (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}) all-gather-done(%all-gather-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-done"}
  %get-tuple-element.4273 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4273"}
  %bitcast.25111.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4273), metadata={scheduling_name="bitcast.25111.0"}
  %bitcast.25098.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.5), metadata={scheduling_name="bitcast.25098.0"}
  %custom-call.1168 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25098.0, %bitcast.25111.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1168"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4271 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4271"}
  %bitcast.24960.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4271), metadata={scheduling_name="bitcast.24960.0"}
  %custom-call.1166 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25098.0, %bitcast.24960.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1166"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4272 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4272"}
  %bitcast.25057.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4272), metadata={scheduling_name="bitcast.25057.0"}
  %custom-call.1167 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25098.0, %bitcast.25057.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1167"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4123 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.4123"}
  %get-tuple-element.4122 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.4122"}
  %get-tuple-element.3810.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1166), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3810.0"}
  %input_concatenate_fusion = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3810.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion"}
  %get-tuple-element.3811.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1167), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3811.0"}
  %input_concatenate_fusion.2 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3811.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.2"}
  %get-tuple-element.3812.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1168), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3812.0"}
  %bitcast.25115.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3812.0), metadata={scheduling_name="bitcast.25115.0"}
  %custom-call.1006 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, u8[1]{0}) custom-call(%input_concatenate_fusion, %input_concatenate_fusion.2, %bitcast.25115.0, %constant_5437_0, %loop_broadcast_fusion.2, /*index=5*/%loop_multiply_fusion, %loop_multiply_fusion, %constant_5439_0, %constant_5439_0, %constant_5439_0, /*index=10*/%constant_5439_0, %constant_5439_0, %constant_5439_0), custom_call_target="te_fused_attn_forward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u32[2]{0}, s32[65]{0}, s32[65]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.1006"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.25147.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.4120), metadata={scheduling_name="bitcast.25147.0"}
  %copy.677 = bf16[32768,6144]{1,0} copy(%bitcast.25147.0), metadata={scheduling_name="copy.677"}
  %get-tuple-element.4274 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done), index=3, metadata={scheduling_name="get-tuple-element.4274"}
  %bitcast.25143.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4274), metadata={scheduling_name="bitcast.25143.0"}
  %get-tuple-element.3468.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.1006), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3468.0"}
  %bitcast.25128.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3468.0), metadata={scheduling_name="bitcast.25128.0"}
  %cublas-lt-matmul.36 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25128.0, %bitcast.25143.0, %copy.677), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.36"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %wrapped_iota.3 = s32[32768,8]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_iota.3"}
  %get-tuple-element.3813.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.36), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3813.0"}
  %input_reduce_fusion.4 = f32[4,8192]{1,0} fusion(%get-tuple-element.3813.0), kind=kInput, calls=%fused_reduce.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.4"}
  %loop_rsqrt_fusion.2 = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.4), kind=kLoop, calls=%fused_rsqrt.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.2"}
  %get-tuple-element.4519 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=25, metadata={scheduling_name="get-tuple-element.4519"}
  %loop_convert_fusion.4 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3813.0, %loop_rsqrt_fusion.2, %get-tuple-element.4519, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_convert.4, metadata={deduplicated_name="loop_convert_fusion.2" scheduling_name="loop_convert_fusion.4"}
  %get-tuple-element.4275 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done), index=4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4275"}
  %bitcast.25212.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4275), metadata={scheduling_name="bitcast.25212.0"}
  %bitcast.25191.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.4), metadata={scheduling_name="bitcast.25191.0"}
  %custom-call.1169 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25191.0, %bitcast.25212.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1169"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_broadcast_fusion.1 = u32[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.1, metadata={deduplicated_name="loop_broadcast_fusion.4" scheduling_name="loop_broadcast_fusion.1"}
  %partition-id.23.0 = u32[] partition-id(), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="partition-id.23.0"}
  %get-tuple-element.3814.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1169), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3814.0"}
  %wrapped_convert = f32[32768,8]{1,0} fusion(%get-tuple-element.3814.0), kind=kLoop, calls=%wrapped_convert_computation, metadata={scheduling_name="wrapped_convert"}
  %sort.44.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert, %wrapped_iota.3), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.44.0"}
  %copy.679 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion), metadata={scheduling_name="copy.679"}
  %get-tuple-element.3504.0 = s32[32768,8]{1,0} get-tuple-element(%sort.44.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3504.0"}
  %wrapped_slice = s32[32768,2]{1,0} fusion(%get-tuple-element.3504.0), kind=kLoop, calls=%wrapped_slice_computation, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice"}
  %get-tuple-element.3845.0 = f32[32768,8]{1,0} get-tuple-element(%sort.44.0), index=0, metadata={scheduling_name="get-tuple-element.3845.0"}
  %loop_convert_fusion.7 = f32[32768,2]{1,0} fusion(%get-tuple-element.3845.0), kind=kLoop, calls=%fused_convert.7, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.7"}
  %sort.46.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.7, %wrapped_slice, %wrapped_iota.4), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.46.0"}
  %copy.678 = u32[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.1), metadata={scheduling_name="copy.678"}
  %get-tuple-element.4522 = s32[1,1,1,1,8]{4,3,2,1,0} get-tuple-element(%param.217), index=28, metadata={scheduling_name="get-tuple-element.4522"}
  %get-tuple-element.3508.0 = s32[32768,2]{1,0} get-tuple-element(%sort.46.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3508.0"}
  %loop_compare_fusion.3 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.4522, %get-tuple-element.3508.0), kind=kLoop, calls=%fused_compare.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.2" scheduling_name="loop_compare_fusion.3"}
  %loop_slice_fusion = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.3), kind=kLoop, calls=%fused_slice, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion"}
  %loop_reduce_window_fusion.3 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion), kind=kLoop, calls=%fused_reduce_window.3, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.3"}
  %loop_reduce_window_fusion.2 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.3), kind=kLoop, calls=%fused_reduce_window.2, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.2"}
  %input_reduce_fusion.3 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.3, %loop_reduce_window_fusion.3, %loop_reduce_window_fusion.2), kind=kInput, calls=%fused_reduce.3, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.3"}
  %get-tuple-element.4508 = s32[1,4,8192,2,1]{3,2,1,4,0} get-tuple-element(%param.217), index=14, metadata={scheduling_name="get-tuple-element.4508"}
  %get-tuple-element.4509 = s32[1,4,8192,2,1]{3,2,1,4,0} get-tuple-element(%param.217), index=15, metadata={scheduling_name="get-tuple-element.4509"}
  %loop_transpose_fusion.5 = s32[65536,4]{1,0} fusion(%get-tuple-element.4509, %get-tuple-element.4508, %get-tuple-element.3508.0, %constant_5442_0, %partition-id.23.0), kind=kLoop, calls=%fused_transpose.5, metadata={deduplicated_name="loop_transpose_fusion.2" scheduling_name="loop_transpose_fusion.5"}
  %get-tuple-element.4521 = u32[1,4,8192,2]{3,2,1,0} get-tuple-element(%param.217), index=27, metadata={scheduling_name="get-tuple-element.4521"}
  %input_scatter_fusion.2 = u32[1,4,8192,8]{3,2,1,0} fusion(%copy.678, %loop_transpose_fusion.5, %get-tuple-element.4521), kind=kInput, calls=%fused_scatter.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.2" scheduling_name="input_scatter_fusion.2"}
  %get-tuple-element.3847.0 = f32[32768,2]{1,0} get-tuple-element(%sort.46.0), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3847.0"}
  %input_scatter_fusion.1 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.679, %loop_transpose_fusion.5, %get-tuple-element.4521, %input_scatter_fusion.2, %get-tuple-element.4509, /*index=5*/%get-tuple-element.4508, %get-tuple-element.3508.0, %get-tuple-element.3847.0, %constant_5442_0, %partition-id.23.0), kind=kInput, calls=%fused_scatter.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion" scheduling_name="input_scatter_fusion.1"}
  %get-tuple-element.4093 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.3), index=1, metadata={scheduling_name="get-tuple-element.4093"}
  %get-tuple-element.4092 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.3), index=0, metadata={scheduling_name="get-tuple-element.4092"}
  %input_multiply_transpose_fusion.1 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.4093, %get-tuple-element.4092, %input_scatter_fusion.1), kind=kInput, calls=%fused_multiply_transpose.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.1"}
  %get-tuple-element.4523 = s32[1,1,1,1,2049]{4,3,2,1,0} get-tuple-element(%param.217), index=29, metadata={scheduling_name="get-tuple-element.4523"}
  %get-tuple-element.4036 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4036"}
  %get-tuple-element.4035 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4035"}
  %input_convert_transpose_fusion.1 = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.4523, %get-tuple-element.4035, %get-tuple-element.4036), kind=kInput, calls=%fused_convert_transpose.1, metadata={deduplicated_name="input_convert_transpose_fusion" scheduling_name="input_convert_transpose_fusion.1"}
  %bitcast.25457.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.4), metadata={scheduling_name="bitcast.25457.0"}
  %get-tuple-element.4033 = bf16[4,16384,8192]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4033"}
  %custom-call.1170 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4033, %bitcast.25457.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1170"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3815.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1170), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3815.0"}
  %loop_transpose_fusion.4 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3815.0), kind=kLoop, calls=%fused_transpose.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.4"}
  %bitcast.25464.0 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} bitcast(%loop_transpose_fusion.4), metadata={scheduling_name="bitcast.25464.0"}
  %all-to-all-start = ((bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.25464.0), calls=%async_computation, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4525 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=31, metadata={scheduling_name="get-tuple-element.4525"}
  %loop_dynamic_slice_fusion.8 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4525, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.8, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.8"}
  %get-tuple-element.4524 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=30, metadata={scheduling_name="get-tuple-element.4524"}
  %loop_dynamic_slice_fusion.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4524, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.7, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.7"}
  %all-to-all-done = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done"}
  %bitcast.25493.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.8), metadata={scheduling_name="bitcast.25493.0"}
  %bitcast.25484.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done), metadata={scheduling_name="bitcast.25484.0"}
  %custom-call.1174 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25484.0, %bitcast.25493.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1174"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.25477.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.7), metadata={scheduling_name="bitcast.25477.0"}
  %cublas-lt-matmul.37 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25484.0, %bitcast.25477.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="cublas-lt-matmul.37"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"SILU","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4526 = bf16[1,2,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=32, metadata={scheduling_name="get-tuple-element.4526"}
  %loop_dynamic_slice_fusion.9 = bf16[1,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4526, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.9, metadata={deduplicated_name="loop_dynamic_slice_fusion.9" scheduling_name="loop_dynamic_slice_fusion.9"}
  %get-tuple-element.3817.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1174), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3817.0"}
  %get-tuple-element.3816.0 = bf16[65536,16384]{1,0} get-tuple-element(%cublas-lt-matmul.37), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3816.0"}
  %loop_convert_fusion.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} fusion(%get-tuple-element.3816.0, %get-tuple-element.3817.0), kind=kLoop, calls=%fused_convert.1, metadata={deduplicated_name="loop_convert_fusion" scheduling_name="loop_convert_fusion.1"}
  %bitcast.25511.0 = bf16[16384,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.9), metadata={scheduling_name="bitcast.25511.0"}
  %bitcast.25502.0 = bf16[65536,16384]{1,0} bitcast(%loop_convert_fusion.1), metadata={scheduling_name="bitcast.25502.0"}
  %custom-call.1175 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25502.0, %bitcast.25511.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1175"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3818.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1175), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3818.0"}
  %bitcast.25515.0 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3818.0), metadata={scheduling_name="bitcast.25515.0"}
  %all-to-all-start.1 = ((bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.25515.0), calls=%async_computation.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-to-all-done.1 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.1"}
  %loop_transpose_fusion.3 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.1), kind=kLoop, calls=%fused_transpose.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion" scheduling_name="loop_transpose_fusion.3"}
  %bitcast.25526.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3813.0), metadata={scheduling_name="bitcast.25526.0"}
  %get-tuple-element.4034 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4034"}
  %bitcast.25522.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.3), metadata={scheduling_name="bitcast.25522.0"}
  %cublas-lt-matmul.38 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4034, %bitcast.25522.0, %bitcast.25526.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="cublas-lt-matmul.38"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3819.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.38), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3819.0"}
  %input_reduce_fusion.2 = f32[4,8192]{1,0} fusion(%get-tuple-element.3819.0), kind=kInput, calls=%fused_reduce.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_reduce_fusion.2"}
  %loop_rsqrt_fusion.1 = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.2), kind=kLoop, calls=%fused_rsqrt.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion.1"}
  %get-tuple-element.4527 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=33, metadata={scheduling_name="get-tuple-element.4527"}
  %loop_convert_fusion.3 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3819.0, %loop_rsqrt_fusion.1, %get-tuple-element.4527, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_convert.3, metadata={scheduling_name="loop_convert_fusion.3"}
  %get-tuple-element.4278 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4278"}
  %bitcast.25688.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4278), metadata={scheduling_name="bitcast.25688.0"}
  %bitcast.25675.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.3), metadata={scheduling_name="bitcast.25675.0"}
  %custom-call.1178 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25675.0, %bitcast.25688.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1178"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4276 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4276"}
  %bitcast.25584.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4276), metadata={scheduling_name="bitcast.25584.0"}
  %custom-call.1176 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25675.0, %bitcast.25584.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1176"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4277 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done), index=6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4277"}
  %bitcast.25636.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4277), metadata={scheduling_name="bitcast.25636.0"}
  %custom-call.1177 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25675.0, %bitcast.25636.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1177"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3820.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1176), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3820.0"}
  %input_concatenate_fusion.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3820.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.1"}
  %get-tuple-element.3821.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1177), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3821.0"}
  %input_concatenate_fusion.3 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4123, %get-tuple-element.3821.0, %get-tuple-element.4122), kind=kInput, calls=%fused_concatenate.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.3"}
  %get-tuple-element.3822.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1178), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3822.0"}
  %bitcast.25692.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3822.0), metadata={scheduling_name="bitcast.25692.0"}
  %custom-call.1009 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, u8[1]{0}) custom-call(%input_concatenate_fusion.1, %input_concatenate_fusion.3, %bitcast.25692.0, %constant_5437_0, %loop_broadcast_fusion.2, /*index=5*/%loop_multiply_fusion, %loop_multiply_fusion, %constant_5439_0, %constant_5439_0, %constant_5439_0, /*index=10*/%constant_5439_0, %constant_5439_0, %constant_5439_0), custom_call_target="te_fused_attn_forward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u32[2]{0}, s32[65]{0}, s32[65]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.1009"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.25719.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3819.0), metadata={scheduling_name="bitcast.25719.0"}
  %copy.681 = bf16[32768,6144]{1,0} copy(%bitcast.25719.0), metadata={scheduling_name="copy.681"}
  %get-tuple-element.4279 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done), index=8, metadata={scheduling_name="get-tuple-element.4279"}
  %bitcast.25715.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4279), metadata={scheduling_name="bitcast.25715.0"}
  %get-tuple-element.3484.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.1009), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3484.0"}
  %bitcast.25700.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3484.0), metadata={scheduling_name="bitcast.25700.0"}
  %cublas-lt-matmul.39 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25700.0, %bitcast.25715.0, %copy.681), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.39"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3823.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.39), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3823.0"}
  %input_reduce_fusion.1 = f32[4,8192]{1,0} fusion(%get-tuple-element.3823.0), kind=kInput, calls=%fused_reduce.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.1"}
  %loop_rsqrt_fusion = f32[1,4,8192]{2,1,0} fusion(%input_reduce_fusion.1), kind=kLoop, calls=%fused_rsqrt, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion" scheduling_name="loop_rsqrt_fusion"}
  %get-tuple-element.4532 = bf16[1,2,6144]{2,1,0} get-tuple-element(%param.217), index=38, metadata={scheduling_name="get-tuple-element.4532"}
  %loop_convert_fusion.2 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3823.0, %loop_rsqrt_fusion, %get-tuple-element.4532, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_convert.2, metadata={deduplicated_name="loop_convert_fusion.2" scheduling_name="loop_convert_fusion.2"}
  %get-tuple-element.4280 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done), index=9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4280"}
  %bitcast.25776.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4280), metadata={scheduling_name="bitcast.25776.0"}
  %bitcast.25763.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.2), metadata={scheduling_name="bitcast.25763.0"}
  %custom-call.1179 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.25763.0, %bitcast.25776.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1179"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3824.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1179), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3824.0"}
  %wrapped_convert.1 = f32[32768,8]{1,0} fusion(%get-tuple-element.3824.0), kind=kLoop, calls=%wrapped_convert_computation.1, metadata={scheduling_name="wrapped_convert.1"}
  %sort.45.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.1, %wrapped_iota.3), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.45.0"}
  %get-tuple-element.3506.0 = s32[32768,8]{1,0} get-tuple-element(%sort.45.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3506.0"}
  %wrapped_slice.1 = s32[32768,2]{1,0} fusion(%get-tuple-element.3506.0), kind=kLoop, calls=%wrapped_slice_computation.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.1"}
  %get-tuple-element.3850.0 = f32[32768,8]{1,0} get-tuple-element(%sort.45.0), index=0, metadata={scheduling_name="get-tuple-element.3850.0"}
  %loop_convert_fusion.8 = f32[32768,2]{1,0} fusion(%get-tuple-element.3850.0), kind=kLoop, calls=%fused_convert.8, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.8"}
  %sort.47.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.8, %wrapped_slice.1, %wrapped_iota.4), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.47.0"}
  %get-tuple-element.3510.0 = s32[32768,2]{1,0} get-tuple-element(%sort.47.0), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.3510.0"}
  %loop_compare_fusion.2 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.4522, %get-tuple-element.3510.0), kind=kLoop, calls=%fused_compare.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.2" scheduling_name="loop_compare_fusion.2"}
  %loop_transpose_fusion.2 = s32[65536,4]{1,0} fusion(%get-tuple-element.4509, %get-tuple-element.4508, %get-tuple-element.3510.0, %constant_5442_0, %partition-id.23.0), kind=kLoop, calls=%fused_transpose.2, metadata={deduplicated_name="loop_transpose_fusion.2" scheduling_name="loop_transpose_fusion.2"}
  %loop_slice_fusion.1 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.2), kind=kLoop, calls=%fused_slice.1, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.1"}
  %loop_reduce_window_fusion.1 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.1), kind=kLoop, calls=%fused_reduce_window.1, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.1"}
  %loop_reduce_window_fusion = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.1), kind=kLoop, calls=%fused_reduce_window, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion"}
  %input_scatter_fusion.3 = u32[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.1, %loop_transpose_fusion.2, %get-tuple-element.4521), kind=kInput, calls=%fused_scatter.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.2" scheduling_name="input_scatter_fusion.3"}
  %input_reduce_fusion = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.2, %loop_reduce_window_fusion.1, %loop_reduce_window_fusion), kind=kInput, calls=%fused_reduce, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion"}
  %get-tuple-element.3852.0 = f32[32768,2]{1,0} get-tuple-element(%sort.47.0), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3852.0"}
  %input_scatter_fusion = bf16[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion, %loop_transpose_fusion.2, %get-tuple-element.4521, %input_scatter_fusion.3, %get-tuple-element.4509, /*index=5*/%get-tuple-element.4508, %get-tuple-element.3510.0, %get-tuple-element.3852.0, %constant_5442_0, %partition-id.23.0), kind=kInput, calls=%fused_scatter, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion" scheduling_name="input_scatter_fusion"}
  %get-tuple-element.4008 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion), index=1, metadata={scheduling_name="get-tuple-element.4008"}
  %get-tuple-element.4007 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion), index=0, metadata={scheduling_name="get-tuple-element.4007"}
  %input_multiply_transpose_fusion = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.4008, %get-tuple-element.4007, %input_scatter_fusion), kind=kInput, calls=%fused_multiply_transpose, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion"}
  %get-tuple-element.4006 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4006"}
  %get-tuple-element.4005 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.4005"}
  %input_convert_transpose_fusion = (bf16[4,16384,8192]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.4523, %get-tuple-element.4005, %get-tuple-element.4006), kind=kInput, calls=%fused_convert_transpose, metadata={deduplicated_name="input_convert_transpose_fusion" scheduling_name="input_convert_transpose_fusion"}
  %bitcast.26001.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.2), metadata={scheduling_name="bitcast.26001.0"}
  %get-tuple-element.4003 = bf16[4,16384,8192]{2,1,0} get-tuple-element(%input_convert_transpose_fusion), index=0, metadata={scheduling_name="get-tuple-element.4003"}
  %custom-call.1180 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4003, %bitcast.26001.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1180"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3825.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1180), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3825.0"}
  %loop_transpose_fusion.1 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3825.0), kind=kLoop, calls=%fused_transpose.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.1"}
  %get-tuple-element.4452 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=2, metadata={scheduling_name="get-tuple-element.4452"}
  %bitcast.26008.0 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} bitcast(%loop_transpose_fusion.1), metadata={scheduling_name="bitcast.26008.0"}
  %all-to-all-start.2 = ((bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26008.0), calls=%async_computation.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_add_fusion = s32[] fusion(%copy.748), kind=kLoop, calls=%fused_add, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_add_fusion.1" scheduling_name="loop_add_fusion"}
  %get-tuple-element.4463 = s32[9]{0} get-tuple-element(%param.217), index=13, metadata={scheduling_name="get-tuple-element.4463"}
  %loop_dynamic_update_slice_fusion.9 = s32[9]{0} fusion(%get-tuple-element.4463, %copy.748), kind=kLoop, calls=%fused_dynamic_update_slice.9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion.9"}
  %get-tuple-element.4536 = bf16[1,2,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=42, metadata={scheduling_name="get-tuple-element.4536"}
  %loop_dynamic_slice_fusion.15 = bf16[1,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4536, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.15, metadata={deduplicated_name="loop_dynamic_slice_fusion.9" scheduling_name="loop_dynamic_slice_fusion.15"}
  %get-tuple-element.4535 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=41, metadata={scheduling_name="get-tuple-element.4535"}
  %loop_dynamic_slice_fusion.14 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4535, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.14, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.14"}
  %get-tuple-element.4534 = bf16[1,2,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.217), index=40, metadata={scheduling_name="get-tuple-element.4534"}
  %loop_dynamic_slice_fusion.13 = bf16[1,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4534, %get-tuple-element.4512, %copy.748), kind=kLoop, calls=%fused_dynamic_slice.13, metadata={deduplicated_name="loop_dynamic_slice_fusion.7" scheduling_name="loop_dynamic_slice_fusion.13"}
  %all-to-all-done.2 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.2"}
  %collective-permute-start = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4452), channel_id=5, source_target_pairs={{0,16},{1,17},{2,18},{3,19},{4,20},{5,21},{6,22},{7,23},{8,24},{9,25},{10,26},{11,27},{12,28},{13,29},{14,30},{15,31},{16,0},{17,1},{18,2},{19,3},{20,4},{21,5},{22,6},{23,7},{24,8},{25,9},{26,10},{27,11},{28,12},{29,13},{30,14},{31,15}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.26037.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.14), metadata={scheduling_name="bitcast.26037.0"}
  %bitcast.26028.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.2), metadata={scheduling_name="bitcast.26028.0"}
  %custom-call.1181 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26028.0, %bitcast.26037.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1181"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.26021.0 = bf16[6144,16384]{1,0} bitcast(%loop_dynamic_slice_fusion.13), metadata={scheduling_name="bitcast.26021.0"}
  %cublas-lt-matmul.40 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26028.0, %bitcast.26021.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="cublas-lt-matmul.40"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"SILU","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3827.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1181), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3827.0"}
  %get-tuple-element.3826.0 = bf16[65536,16384]{1,0} get-tuple-element(%cublas-lt-matmul.40), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3826.0"}
  %loop_convert_fusion = bf16[1,1,32,2048,16384]{4,3,2,1,0} fusion(%get-tuple-element.3826.0, %get-tuple-element.3827.0), kind=kLoop, calls=%fused_convert, metadata={deduplicated_name="loop_convert_fusion" scheduling_name="loop_convert_fusion"}
  %get-tuple-element.4455 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=5, metadata={scheduling_name="get-tuple-element.4455"}
  %loop_dynamic_update_slice_fusion.7 = bf16[9,1,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4455, %copy.748, %get-tuple-element.4120), kind=kLoop, calls=%fused_dynamic_update_slice.7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion.7"}
  %bitcast.26055.0 = bf16[16384,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.15), metadata={scheduling_name="bitcast.26055.0"}
  %bitcast.26046.0 = bf16[65536,16384]{1,0} bitcast(%loop_convert_fusion), metadata={scheduling_name="bitcast.26046.0"}
  %custom-call.1182 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26046.0, %bitcast.26055.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1182"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-done"}
  %get-tuple-element.3828.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1182), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3828.0"}
  %bitcast.26059.0 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3828.0), metadata={scheduling_name="bitcast.26059.0"}
  %all-to-all-start.3 = ((bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26059.0), calls=%async_computation.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4458 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.217), index=8, metadata={scheduling_name="get-tuple-element.4458"}
  %loop_dynamic_update_slice_fusion.4 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4458, %copy.748, %get-tuple-element.3468.0), kind=kLoop, calls=%fused_dynamic_update_slice.4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.1" scheduling_name="loop_dynamic_update_slice_fusion.4"}
  %get-tuple-element.4457 = u32[9,2,4]{2,1,0} get-tuple-element(%param.217), index=7, metadata={scheduling_name="get-tuple-element.4457"}
  %get-tuple-element.3470.0 = u32[2,4]{1,0} get-tuple-element(%custom-call.1006), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3470.0"}
  %loop_dynamic_update_slice_fusion.5 = u32[9,2,4]{2,1,0} fusion(%get-tuple-element.4457, %copy.748, %get-tuple-element.3470.0), kind=kLoop, calls=%fused_dynamic_update_slice.5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.2" scheduling_name="loop_dynamic_update_slice_fusion.5"}
  %get-tuple-element.4456 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.217), index=6, metadata={scheduling_name="get-tuple-element.4456"}
  %get-tuple-element.3469.0 = f32[1,4,48,8192,1]{4,3,2,1,0} get-tuple-element(%custom-call.1006), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3469.0"}
  %loop_dynamic_update_slice_fusion.6 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%copy.748, %get-tuple-element.3469.0, %get-tuple-element.4456), kind=kLoop, calls=%fused_dynamic_update_slice.6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.3" scheduling_name="loop_dynamic_update_slice_fusion.6"}
  %loop_dynamic_update_slice_fusion.10 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4451, %collective-permute-done, %copy.748), kind=kLoop, calls=%fused_dynamic_update_slice.10, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="loop_dynamic_update_slice_fusion.10"}
  %get-tuple-element.4459 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.217), index=9, metadata={scheduling_name="get-tuple-element.4459"}
  %loop_dynamic_update_slice_fusion = bf16[9,1,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4459, %copy.748, %get-tuple-element.3819.0), kind=kLoop, calls=%fused_dynamic_update_slice, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_dynamic_update_slice_fusion"}
  %all-to-all-done.3 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.3"}
  %get-tuple-element.4121 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_dynamic_slice_reduce_select_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="get-tuple-element.4121"}
  %bitcast.26084.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.4121), metadata={scheduling_name="bitcast.26084.0"}
  %collective-permute-start.1 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.26084.0), channel_id=127, source_target_pairs={{16,0},{17,1},{18,2},{19,3},{20,4},{21,5},{22,6},{23,7},{24,8},{25,9},{26,10},{27,11},{28,12},{29,13},{30,14},{31,15}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4462 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.217), index=12, metadata={scheduling_name="get-tuple-element.4462"}
  %loop_dynamic_update_slice_fusion.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4462, %copy.748, %get-tuple-element.3484.0), kind=kLoop, calls=%fused_dynamic_update_slice.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.1" scheduling_name="loop_dynamic_update_slice_fusion.1"}
  %get-tuple-element.4461 = u32[9,2,4]{2,1,0} get-tuple-element(%param.217), index=11, metadata={scheduling_name="get-tuple-element.4461"}
  %get-tuple-element.3486.0 = u32[2,4]{1,0} get-tuple-element(%custom-call.1009), index=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3486.0"}
  %loop_dynamic_update_slice_fusion.2 = u32[9,2,4]{2,1,0} fusion(%get-tuple-element.4461, %copy.748, %get-tuple-element.3486.0), kind=kLoop, calls=%fused_dynamic_update_slice.2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.2" scheduling_name="loop_dynamic_update_slice_fusion.2"}
  %loop_transpose_fusion = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.3), kind=kLoop, calls=%fused_transpose, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion" scheduling_name="loop_transpose_fusion"}
  %get-tuple-element.4460 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.217), index=10, metadata={scheduling_name="get-tuple-element.4460"}
  %get-tuple-element.3485.0 = f32[1,4,48,8192,1]{4,3,2,1,0} get-tuple-element(%custom-call.1009), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.3485.0"}
  %loop_dynamic_update_slice_fusion.3 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%copy.748, %get-tuple-element.3485.0, %get-tuple-element.4460), kind=kLoop, calls=%fused_dynamic_update_slice.3, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.3" scheduling_name="loop_dynamic_update_slice_fusion.3"}
  %bitcast.26070.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3823.0), metadata={scheduling_name="bitcast.26070.0"}
  %get-tuple-element.4004 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion), index=1, metadata={scheduling_name="get-tuple-element.4004"}
  %bitcast.26066.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion), metadata={scheduling_name="bitcast.26066.0"}
  %cublas-lt-matmul.41 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.4004, %bitcast.26066.0, %bitcast.26070.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="cublas-lt-matmul.41"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.1 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_pad)/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-done.1"}
  %get-tuple-element.4537 = pred[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.217), index=43, metadata={scheduling_name="get-tuple-element.4537"}
  %get-tuple-element.3829.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.41), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3829.0"}
  %loop_dynamic_update_slice_fusion.8 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%get-tuple-element.4454, %get-tuple-element.4537, %collective-permute-done.1, %get-tuple-element.3829.0, %copy.748), kind=kLoop, calls=%fused_dynamic_update_slice.8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="loop_dynamic_update_slice_fusion.8"}
  %bitcast.26080.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3829.0), metadata={scheduling_name="bitcast.26080.0"}
  %copy.764 = bf16[1,4,8192,6144]{3,2,1,0} copy(%bitcast.26080.0), metadata={scheduling_name="copy.764"}
  %bitcast.26120.0 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} bitcast(%loop_dynamic_update_slice_fusion.6), metadata={scheduling_name="bitcast.26120.0"}
  %bitcast.26168.0 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} bitcast(%loop_dynamic_update_slice_fusion.3), metadata={scheduling_name="bitcast.26168.0"}
  ROOT %tuple.667 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) tuple(%loop_add_fusion, %loop_dynamic_update_slice_fusion.10, %copy.764, %bitcast.26080.0, %loop_dynamic_update_slice_fusion.8, /*index=5*/%loop_dynamic_update_slice_fusion.7, %bitcast.26120.0, %loop_dynamic_update_slice_fusion.5, %loop_dynamic_update_slice_fusion.4, %loop_dynamic_update_slice_fusion, /*index=10*/%bitcast.26168.0, %loop_dynamic_update_slice_fusion.2, %loop_dynamic_update_slice_fusion.1, %loop_dynamic_update_slice_fusion.9, %get-tuple-element.4508, /*index=15*/%get-tuple-element.4509, %get-tuple-element.4510, %get-tuple-element.4511, %get-tuple-element.4512, %get-tuple-element.4513, /*index=20*/%get-tuple-element.4514, %get-tuple-element.4515, %get-tuple-element.4516, %get-tuple-element.4517, %get-tuple-element.4518, /*index=25*/%get-tuple-element.4519, %get-tuple-element.4520, %get-tuple-element.4521, %get-tuple-element.4522, %get-tuple-element.4523, /*index=30*/%get-tuple-element.4524, %get-tuple-element.4525, %get-tuple-element.4526, %get-tuple-element.4527, %get-tuple-element.4528, /*index=35*/%get-tuple-element.4529, %get-tuple-element.4530, %get-tuple-element.4531, %get-tuple-element.4532, %get-tuple-element.4533, /*index=40*/%get-tuple-element.4534, %get-tuple-element.4535, %get-tuple-element.4536, %get-tuple-element.4537), metadata={scheduling_name="tuple.667"}
}

%fused_compare.1 (param_0.1: s32[]) -> pred[] {
  %param_0.1 = s32[] parameter(0), metadata={scheduling_name="param_0.1"}
  %constant_5426_1 = s32[] constant(9)
  ROOT %compare.1581.1 = pred[] compare(%param_0.1, %constant_5426_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="compare.1581.1"}
}

%region_18.1706.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone (param.216: (s32[], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=5*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=10*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[1,4,8192,2,1], /*index=15*/s32[1,4,8192,2,1], pred[1,4,8192,6144], bf16[1,2,6144], s32[1], bf16[1,2,768,48,128], /*index=20*/s32[4,4,8192], f32[1,1,1,1,64], bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], /*index=25*/bf16[1,2,6144], bf16[1,2,768,8], u32[1,4,8192,2], s32[1,1,1,1,8], s32[1,1,1,1,2049], /*index=30*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], bf16[1,2,6144], bf16[1,2,768,48,128], /*index=35*/bf16[1,2,768,8,128], bf16[1,2,768,8,128], bf16[1,2,48,128,768], bf16[1,2,6144], bf16[1,2,768,8], /*index=40*/bf16[1,2,1,6144,16384], bf16[1,2,1,6144,16384], bf16[1,2,1,16384,6144], pred[1,4,8192,6144])) -> pred[] {
  %param.216 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) parameter(0), metadata={scheduling_name="param.216"}
  %get-tuple-element.3451.0 = s32[] get-tuple-element(%param.216), index=0, metadata={scheduling_name="get-tuple-element.3451.0"}
  ROOT %loop_compare_fusion.1 = pred[] fusion(%get-tuple-element.3451.0), kind=kLoop, calls=%fused_compare.1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_compare_fusion" scheduling_name="loop_compare_fusion.1"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone (p.0.lhs.30: f32[], p.0.rhs.30: f32[], p.1.lhs.30: s32[], p.1.rhs.30: s32[]) -> pred[] {
  %constant_5500_0 = s32[] constant(2147483647)
  %constant_5499_0 = s32[] constant(0)
  %p.1.rhs.30 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.30"}
  %p.1.lhs.30 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.30"}
  %p.0.rhs.30 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.30"}
  %p.0.lhs.30 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.30"}
  %compare.1587.0 = pred[] compare(%p.1.lhs.30, %p.1.rhs.30), direction=LT, metadata={scheduling_name="compare.1587.0"}
  %bitcast-convert.65.0 = s32[] bitcast-convert(%p.0.rhs.30), metadata={scheduling_name="bitcast-convert.65.0"}
  %compare.1583.0 = pred[] compare(%bitcast-convert.65.0, %constant_5499_0), direction=LT, metadata={scheduling_name="compare.1583.0"}
  %xor.65.0 = s32[] xor(%constant_5500_0, %bitcast-convert.65.0), metadata={scheduling_name="xor.65.0"}
  %select.1254.0 = s32[] select(%compare.1583.0, %xor.65.0, %bitcast-convert.65.0), metadata={scheduling_name="select.1254.0"}
  %bitcast-convert.64.0 = s32[] bitcast-convert(%p.0.lhs.30), metadata={scheduling_name="bitcast-convert.64.0"}
  %compare.1582.0 = pred[] compare(%bitcast-convert.64.0, %constant_5499_0), direction=LT, metadata={scheduling_name="compare.1582.0"}
  %xor.64.0 = s32[] xor(%constant_5500_0, %bitcast-convert.64.0), metadata={scheduling_name="xor.64.0"}
  %select.1253.0 = s32[] select(%compare.1582.0, %xor.64.0, %bitcast-convert.64.0), metadata={scheduling_name="select.1253.0"}
  %compare.1584.0 = pred[] compare(%select.1253.0, %select.1254.0), direction=GT, metadata={scheduling_name="compare.1584.0"}
  %compare.1585.0 = pred[] compare(%select.1254.0, %select.1253.0), direction=GT, metadata={scheduling_name="compare.1585.0"}
  %compare.1586.0 = pred[] compare(%compare.1584.0, %compare.1585.0), direction=EQ, metadata={scheduling_name="compare.1586.0"}
  ROOT %select.1255.0 = pred[] select(%compare.1586.0, %compare.1587.0, %compare.1584.0), metadata={scheduling_name="select.1255.0"}
}

%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.1 (p.0.lhs.32: f32[], p.0.rhs.32: f32[], p.1.lhs.32: s32[], p.1.rhs.32: s32[]) -> pred[] {
  %constant_5504_0 = s32[] constant(2147483647)
  %constant_5503_0 = s32[] constant(0)
  %p.1.rhs.32 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.32"}
  %p.1.lhs.32 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.32"}
  %p.0.rhs.32 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.32"}
  %p.0.lhs.32 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.32"}
  %compare.1603.0 = pred[] compare(%p.1.lhs.32, %p.1.rhs.32), direction=LT, metadata={scheduling_name="compare.1603.0"}
  %bitcast-convert.69.0 = s32[] bitcast-convert(%p.0.rhs.32), metadata={scheduling_name="bitcast-convert.69.0"}
  %compare.1599.0 = pred[] compare(%bitcast-convert.69.0, %constant_5503_0), direction=LT, metadata={scheduling_name="compare.1599.0"}
  %xor.69.0 = s32[] xor(%constant_5504_0, %bitcast-convert.69.0), metadata={scheduling_name="xor.69.0"}
  %select.1262.0 = s32[] select(%compare.1599.0, %xor.69.0, %bitcast-convert.69.0), metadata={scheduling_name="select.1262.0"}
  %bitcast-convert.68.0 = s32[] bitcast-convert(%p.0.lhs.32), metadata={scheduling_name="bitcast-convert.68.0"}
  %compare.1598.0 = pred[] compare(%bitcast-convert.68.0, %constant_5503_0), direction=LT, metadata={scheduling_name="compare.1598.0"}
  %xor.68.0 = s32[] xor(%constant_5504_0, %bitcast-convert.68.0), metadata={scheduling_name="xor.68.0"}
  %select.1261.0 = s32[] select(%compare.1598.0, %xor.68.0, %bitcast-convert.68.0), metadata={scheduling_name="select.1261.0"}
  %compare.1600.0 = pred[] compare(%select.1261.0, %select.1262.0), direction=GT, metadata={scheduling_name="compare.1600.0"}
  %compare.1601.0 = pred[] compare(%select.1262.0, %select.1261.0), direction=GT, metadata={scheduling_name="compare.1601.0"}
  %compare.1602.0 = pred[] compare(%compare.1600.0, %compare.1601.0), direction=EQ, metadata={scheduling_name="compare.1602.0"}
  ROOT %select.1263.0 = pred[] select(%compare.1602.0, %compare.1603.0, %compare.1600.0), metadata={scheduling_name="select.1263.0"}
}

%compare-value-and-index.9.clone.clone (p.0.lhs.31: f32[], p.0.rhs.31: f32[], p.1.lhs.31: s32[], p.1.rhs.31: s32[], p.2.lhs.clone.4: s32[], p.2.rhs.clone.4: s32[]) -> pred[] {
  %constant_5502_0 = s32[] constant(2147483647)
  %constant_5501_0 = s32[] constant(0)
  %p.2.rhs.clone.4 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.4"}
  %p.2.lhs.clone.4 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.4"}
  %p.1.rhs.31 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.31"}
  %p.1.lhs.31 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.31"}
  %p.0.rhs.31 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.31"}
  %p.0.lhs.31 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.31"}
  %compare.1597.0 = pred[] compare(%p.2.lhs.clone.4, %p.2.rhs.clone.4), direction=LT, metadata={scheduling_name="compare.1597.0"}
  %compare.1594.0 = pred[] compare(%p.1.rhs.31, %p.1.lhs.31), direction=LT, metadata={scheduling_name="compare.1594.0"}
  %compare.1591.0 = pred[] compare(%p.1.lhs.31, %p.1.rhs.31), direction=LT, metadata={scheduling_name="compare.1591.0"}
  %bitcast-convert.67.0 = s32[] bitcast-convert(%p.0.rhs.31), metadata={scheduling_name="bitcast-convert.67.0"}
  %compare.1589.0 = pred[] compare(%bitcast-convert.67.0, %constant_5501_0), direction=LT, metadata={scheduling_name="compare.1589.0"}
  %xor.67.0 = s32[] xor(%constant_5502_0, %bitcast-convert.67.0), metadata={scheduling_name="xor.67.0"}
  %select.1257.0 = s32[] select(%compare.1589.0, %xor.67.0, %bitcast-convert.67.0), metadata={scheduling_name="select.1257.0"}
  %compare.1595.0 = pred[] compare(%p.0.rhs.31, %p.0.lhs.31), direction=GT, metadata={scheduling_name="compare.1595.0"}
  %compare.1592.0 = pred[] compare(%p.0.lhs.31, %p.0.rhs.31), direction=GT, metadata={scheduling_name="compare.1592.0"}
  %bitcast-convert.66.0 = s32[] bitcast-convert(%p.0.lhs.31), metadata={scheduling_name="bitcast-convert.66.0"}
  %compare.1588.0 = pred[] compare(%bitcast-convert.66.0, %constant_5501_0), direction=LT, metadata={scheduling_name="compare.1588.0"}
  %xor.66.0 = s32[] xor(%constant_5502_0, %bitcast-convert.66.0), metadata={scheduling_name="xor.66.0"}
  %select.1256.0 = s32[] select(%compare.1588.0, %xor.66.0, %bitcast-convert.66.0), metadata={scheduling_name="select.1256.0"}
  %compare.1590.0 = pred[] compare(%select.1256.0, %select.1257.0), direction=EQ, metadata={scheduling_name="compare.1590.0"}
  %select.1258.0 = pred[] select(%compare.1590.0, %compare.1591.0, %compare.1592.0), metadata={scheduling_name="select.1258.0"}
  %compare.1593.0 = pred[] compare(%select.1257.0, %select.1256.0), direction=EQ, metadata={scheduling_name="compare.1593.0"}
  %select.1259.0 = pred[] select(%compare.1593.0, %compare.1594.0, %compare.1595.0), metadata={scheduling_name="select.1259.0"}
  %compare.1596.0 = pred[] compare(%select.1258.0, %select.1259.0), direction=EQ, metadata={scheduling_name="compare.1596.0"}
  ROOT %select.1260.0 = pred[] select(%compare.1596.0, %compare.1597.0, %select.1258.0), metadata={scheduling_name="select.1260.0"}
}

%compare-value-and-index.9.clone.clone.1 (p.0.lhs.33: f32[], p.0.rhs.33: f32[], p.1.lhs.33: s32[], p.1.rhs.33: s32[], p.2.lhs.clone.5: s32[], p.2.rhs.clone.5: s32[]) -> pred[] {
  %constant_5506_0 = s32[] constant(2147483647)
  %constant_5505_0 = s32[] constant(0)
  %p.2.rhs.clone.5 = s32[] parameter(5), metadata={scheduling_name="p.2.rhs.clone.5"}
  %p.2.lhs.clone.5 = s32[] parameter(4), metadata={scheduling_name="p.2.lhs.clone.5"}
  %p.1.rhs.33 = s32[] parameter(3), metadata={scheduling_name="p.1.rhs.33"}
  %p.1.lhs.33 = s32[] parameter(2), metadata={scheduling_name="p.1.lhs.33"}
  %p.0.rhs.33 = f32[] parameter(1), metadata={scheduling_name="p.0.rhs.33"}
  %p.0.lhs.33 = f32[] parameter(0), metadata={scheduling_name="p.0.lhs.33"}
  %compare.1613.0 = pred[] compare(%p.2.lhs.clone.5, %p.2.rhs.clone.5), direction=LT, metadata={scheduling_name="compare.1613.0"}
  %compare.1610.0 = pred[] compare(%p.1.rhs.33, %p.1.lhs.33), direction=LT, metadata={scheduling_name="compare.1610.0"}
  %compare.1607.0 = pred[] compare(%p.1.lhs.33, %p.1.rhs.33), direction=LT, metadata={scheduling_name="compare.1607.0"}
  %bitcast-convert.71.0 = s32[] bitcast-convert(%p.0.rhs.33), metadata={scheduling_name="bitcast-convert.71.0"}
  %compare.1605.0 = pred[] compare(%bitcast-convert.71.0, %constant_5505_0), direction=LT, metadata={scheduling_name="compare.1605.0"}
  %xor.71.0 = s32[] xor(%constant_5506_0, %bitcast-convert.71.0), metadata={scheduling_name="xor.71.0"}
  %select.1265.0 = s32[] select(%compare.1605.0, %xor.71.0, %bitcast-convert.71.0), metadata={scheduling_name="select.1265.0"}
  %compare.1611.0 = pred[] compare(%p.0.rhs.33, %p.0.lhs.33), direction=GT, metadata={scheduling_name="compare.1611.0"}
  %compare.1608.0 = pred[] compare(%p.0.lhs.33, %p.0.rhs.33), direction=GT, metadata={scheduling_name="compare.1608.0"}
  %bitcast-convert.70.0 = s32[] bitcast-convert(%p.0.lhs.33), metadata={scheduling_name="bitcast-convert.70.0"}
  %compare.1604.0 = pred[] compare(%bitcast-convert.70.0, %constant_5505_0), direction=LT, metadata={scheduling_name="compare.1604.0"}
  %xor.70.0 = s32[] xor(%constant_5506_0, %bitcast-convert.70.0), metadata={scheduling_name="xor.70.0"}
  %select.1264.0 = s32[] select(%compare.1604.0, %xor.70.0, %bitcast-convert.70.0), metadata={scheduling_name="select.1264.0"}
  %compare.1606.0 = pred[] compare(%select.1264.0, %select.1265.0), direction=EQ, metadata={scheduling_name="compare.1606.0"}
  %select.1266.0 = pred[] select(%compare.1606.0, %compare.1607.0, %compare.1608.0), metadata={scheduling_name="select.1266.0"}
  %compare.1609.0 = pred[] compare(%select.1265.0, %select.1264.0), direction=EQ, metadata={scheduling_name="compare.1609.0"}
  %select.1267.0 = pred[] select(%compare.1609.0, %compare.1610.0, %compare.1611.0), metadata={scheduling_name="select.1267.0"}
  %compare.1612.0 = pred[] compare(%select.1266.0, %select.1267.0), direction=EQ, metadata={scheduling_name="compare.1612.0"}
  ROOT %select.1268.0 = pred[] select(%compare.1612.0, %compare.1613.0, %select.1266.0), metadata={scheduling_name="select.1268.0"}
}

%fused_convert_reduce (param_0.6064: bf16[9,1,4,8192,6144], param_1.6456: s32[], param_2.4647: bf16[2,1,6144], param_3.3829: s32[32], param_4.2804: u32[], param_5.2576: s32[9], param_6.2331: bf16[32768,6144], param_7.2154: bf16[32768,6144]) -> (f32[4,8192], bf16[32768,6144]) {
  %param_0.6064 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6064"}
  %constant_1660_25 = s32[] constant(8)
  %param_1.6456 = s32[] parameter(1), metadata={scheduling_name="param_1.6456"}
  %subtract.247.18 = s32[] subtract(%constant_1660_25, %param_1.6456), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.18"}
  %constant_1668_19 = s32[] constant(0)
  %dynamic-slice.1489.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.6064, %subtract.247.18, %constant_1668_19, %constant_1668_19, %constant_1668_19, /*index=5*/%constant_1668_19), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1489.3"}
  %bitcast.23330.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1489.3), metadata={scheduling_name="bitcast.23330.23"}
  %convert.4055.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23330.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4055.23"}
  %param_7.2154 = bf16[32768,6144]{1,0} parameter(7), metadata={scheduling_name="param_7.2154"}
  %convert.4091.1.clone.1 = f32[32768,6144]{1,0} convert(%param_7.2154), metadata={scheduling_name="convert.4091.1.clone.1"}
  %param_6.2331 = bf16[32768,6144]{1,0} parameter(6), metadata={scheduling_name="param_6.2331"}
  %convert.4102.1.clone.1 = f32[32768,6144]{1,0} convert(%param_6.2331), metadata={scheduling_name="convert.4102.1.clone.1"}
  %add.3040.1.clone.1 = f32[32768,6144]{1,0} add(%convert.4091.1.clone.1, %convert.4102.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/attentions.py" source_line=838 scheduling_name="add.3040.1.clone.1"}
  %convert.4103.1.clone.1 = bf16[32768,6144]{1,0} convert(%add.3040.1.clone.1), metadata={scheduling_name="convert.4103.1.clone.1"}
  %bitcast.23687.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%convert.4103.1.clone.1), metadata={scheduling_name="bitcast.23687.17"}
  %convert.4104.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23687.17), metadata={scheduling_name="convert.4104.17"}
  %param_2.4647 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4647"}
  %param_5.2576 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2576"}
  %dynamic-slice.1484.146 = s32[1]{0} dynamic-slice(%param_5.2576, %subtract.247.18), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.146"}
  %param_3.3829 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.3829"}
  %param_4.2804 = u32[] parameter(4), metadata={scheduling_name="param_4.2804"}
  %dynamic-slice.1485.141 = s32[1]{0} dynamic-slice(%param_3.3829, %param_4.2804), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.141"}
  %subtract.248.136 = s32[1]{0} subtract(%dynamic-slice.1484.146, %dynamic-slice.1485.141), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.136"}
  %constant_2166_73 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.136 = s32[1]{0} maximum(%subtract.248.136, %constant_2166_73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.136"}
  %sign.27.131 = s32[1]{0} sign(%maximum.47.136), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.131"}
  %constant_5144_67 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.131 = pred[1]{0} compare(%sign.27.131, %constant_5144_67), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.131"}
  %constant_5145_66 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.136 = s32[1]{0} and(%maximum.47.136, %constant_5145_66), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.136"}
  %compare.1615.136 = pred[1]{0} compare(%and.301.136, %constant_2166_73), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.136"}
  %and.302.131 = pred[1]{0} and(%compare.1614.131, %compare.1615.136), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.131"}
  %constant_5146_64 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.131 = s32[1]{0} shift-right-logical(%maximum.47.136, %constant_5146_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.131"}
  %constant_5147_64 = s32[1]{0} constant({-1})
  %add.2981.131 = s32[1]{0} add(%shift-right-logical.20.131, %constant_5147_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.131"}
  %select.1269.131 = s32[1]{0} select(%and.302.131, %add.2981.131, %shift-right-logical.20.131), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.131"}
  %compare.1616.131 = pred[1]{0} compare(%select.1269.131, %constant_2166_73), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.131"}
  %add.2982.131 = s32[1]{0} add(%select.1269.131, %constant_5146_64), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.131"}
  %select.1270.131 = s32[1]{0} select(%compare.1616.131, %add.2982.131, %select.1269.131), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.131"}
  %bitcast.21242.145 = s32[1,1]{1,0} bitcast(%select.1270.131), metadata={scheduling_name="bitcast.21242.145"}
  %pad.345.37 = s32[1,2]{1,0} pad(%bitcast.21242.145, %constant_1668_19), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.37"}
  %pad.346.35 = s32[1,3]{1,0} pad(%pad.345.37, %constant_1668_19), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.35"}
  %bitcast.21349.32 = s32[3]{0} bitcast(%pad.346.35), metadata={scheduling_name="bitcast.21349.32"}
  %slice.2376.27 = s32[1]{0} slice(%bitcast.21349.32), slice={[1:2]}, metadata={scheduling_name="slice.2376.27"}
  %bitcast.24050.14 = s32[] bitcast(%slice.2376.27), metadata={scheduling_name="bitcast.24050.14"}
  %dynamic-slice.1518.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4647, %bitcast.24050.14, %constant_1668_19, %constant_1668_19), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1518.3"}
  %bitcast.23368.10 = bf16[6144]{0} bitcast(%dynamic-slice.1518.3), metadata={scheduling_name="bitcast.23368.10"}
  %convert.4997.7 = f32[6144]{0} convert(%bitcast.23368.10), metadata={scheduling_name="convert.4997.7"}
  %broadcast.6053.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4997.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6053.14"}
  %multiply.2687.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4104.17, %broadcast.6053.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2687.11"}
  %multiply.2689.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4055.23, %multiply.2687.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2689.3"}
  %bitcast.24360.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2689.3), metadata={scheduling_name="bitcast.24360.1"}
  %constant_1694_3 = f32[] constant(0)
  %reduce.426.1 = f32[4,8192]{1,0} reduce(%bitcast.24360.1, %constant_1694_3), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.426.1"}
  ROOT %tuple.476 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}) tuple(%reduce.426.1, %convert.4103.1.clone.1), metadata={scheduling_name="tuple.476"}
}

%fused_dynamic_update_slice.11 (param_0.2388: bf16[2,1,48,128,768], param_1.2521: bf16[1,1,768,48,128], param_2.1865: bf16[1,768,48,128], param_3.1457: pred[], param_4.1433: s32[32], param_5.1310: u32[], param_6.1264: s32[9], param_7.1190: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.2388 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2388"}
  %bitcast.24134.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2388), metadata={scheduling_name="bitcast.24134.1"}
  %param_1.2521 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2521"}
  %convert.4166.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2521), metadata={scheduling_name="convert.4166.3"}
  %param_3.1457 = pred[] parameter(3), metadata={scheduling_name="param_3.1457"}
  %broadcast.5684.10 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1457), dimensions={}, metadata={scheduling_name="broadcast.5684.10"}
  %param_2.1865 = bf16[1,768,48,128]{3,2,0,1} parameter(2), metadata={scheduling_name="param_2.1865"}
  %bitcast.24156.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1865), metadata={scheduling_name="bitcast.24156.3"}
  %constant_1658_41 = bf16[] constant(0)
  %broadcast.5685.10 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1658_41), dimensions={}, metadata={scheduling_name="broadcast.5685.10"}
  %select.1308.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5684.10, %bitcast.24156.3, %broadcast.5685.10), metadata={scheduling_name="select.1308.3"}
  %bitcast.24162.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1308.3), metadata={scheduling_name="bitcast.24162.7"}
  %convert.4168.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.24162.7), metadata={scheduling_name="convert.4168.7"}
  %add.3053.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4166.3, %convert.4168.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3053.5"}
  %convert.4169.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.3053.5), metadata={scheduling_name="convert.4169.3"}
  %constant_5148_37 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1264 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1264"}
  %constant_1660_87 = s32[] constant(8)
  %param_7.1190 = s32[] parameter(7), metadata={scheduling_name="param_7.1190"}
  %subtract.247.131 = s32[] subtract(%constant_1660_87, %param_7.1190), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.131"}
  %dynamic-slice.1484.112 = s32[1]{0} dynamic-slice(%param_6.1264, %subtract.247.131), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.112"}
  %param_4.1433 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1433"}
  %param_5.1310 = u32[] parameter(5), metadata={scheduling_name="param_5.1310"}
  %dynamic-slice.1485.107 = s32[1]{0} dynamic-slice(%param_4.1433, %param_5.1310), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.107"}
  %subtract.248.102 = s32[1]{0} subtract(%dynamic-slice.1484.112, %dynamic-slice.1485.107), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.102"}
  %constant_2166_59 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.102 = s32[1]{0} maximum(%subtract.248.102, %constant_2166_59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.102"}
  %sign.27.101 = s32[1]{0} sign(%maximum.47.102), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.101"}
  %constant_5144_54 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.101 = pred[1]{0} compare(%sign.27.101, %constant_5144_54), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.101"}
  %constant_5145_52 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.102 = s32[1]{0} and(%maximum.47.102, %constant_5145_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.102"}
  %compare.1615.102 = pred[1]{0} compare(%and.301.102, %constant_2166_59), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.102"}
  %and.302.101 = pred[1]{0} and(%compare.1614.101, %compare.1615.102), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.101"}
  %constant_5146_51 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.101 = s32[1]{0} shift-right-logical(%maximum.47.102, %constant_5146_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.101"}
  %constant_5147_51 = s32[1]{0} constant({-1})
  %add.2981.101 = s32[1]{0} add(%shift-right-logical.20.101, %constant_5147_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.101"}
  %select.1269.101 = s32[1]{0} select(%and.302.101, %add.2981.101, %shift-right-logical.20.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.101"}
  %compare.1616.101 = pred[1]{0} compare(%select.1269.101, %constant_2166_59), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.101"}
  %add.2982.101 = s32[1]{0} add(%select.1269.101, %constant_5146_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.101"}
  %select.1270.101 = s32[1]{0} select(%compare.1616.101, %add.2982.101, %select.1269.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.101"}
  %bitcast.21242.111 = s32[1,1]{1,0} bitcast(%select.1270.101), metadata={scheduling_name="bitcast.21242.111"}
  %concatenate.701.59 = s32[1,5]{1,0} concatenate(%constant_5148_37, %bitcast.21242.111, %constant_5148_37, %constant_5148_37, %constant_5148_37), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.59"}
  %bitcast.21290.58 = s32[5]{0} bitcast(%concatenate.701.59), metadata={scheduling_name="bitcast.21290.58"}
  %slice.2375.55 = s32[1]{0} slice(%bitcast.21290.58), slice={[1:2]}, metadata={scheduling_name="slice.2375.55"}
  %bitcast.24211.26 = s32[] bitcast(%slice.2375.55), metadata={scheduling_name="bitcast.24211.26"}
  %constant_1668_112 = s32[] constant(0)
  ROOT %dynamic-update-slice.411.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%bitcast.24134.1, %convert.4169.3, %bitcast.24211.26, %constant_1668_112, %constant_1668_112, /*index=5*/%constant_1668_112, %constant_1668_112), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.411.1"}
}

%fused_dynamic_slice.16 (param_0.2384: bf16[2,1,48,128,768], param_1.2583: s32[32], param_2.1999: u32[], param_3.1643: s32[9], param_4.1397: s32[], param_5.2685: bf16[2,1,768,48,128], param_6.2465: bf16[2,1,48,128,768], param_7.2288: bf16[2,1,48,128,768], param_8.2142: bf16[2,1,768,48,128], param_9.1882: bf16[2,1,768,48,128], param_10.1512: bf16[2,1,48,128,768], param_11.1421: bf16[2,1,768,48,128]) -> (bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128], /*index=5*/bf16[1,1,768,48,128], bf16[1,1,768,48,128], bf16[1,1,768,48,128]) {
  %param_0.2384 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2384"}
  %bitcast.24134.2 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2384), metadata={scheduling_name="bitcast.24134.2"}
  %constant_5148_1 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1643 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1643"}
  %constant_1660_40 = s32[] constant(8)
  %param_4.1397 = s32[] parameter(4), metadata={scheduling_name="param_4.1397"}
  %subtract.247.37 = s32[] subtract(%constant_1660_40, %param_4.1397), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.37"}
  %dynamic-slice.1484.18 = s32[1]{0} dynamic-slice(%param_3.1643, %subtract.247.37), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.18"}
  %param_1.2583 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1.2583"}
  %param_2.1999 = u32[] parameter(2), metadata={scheduling_name="param_2.1999"}
  %dynamic-slice.1485.13 = s32[1]{0} dynamic-slice(%param_1.2583, %param_2.1999), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.13"}
  %subtract.248.8 = s32[1]{0} subtract(%dynamic-slice.1484.18, %dynamic-slice.1485.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.8"}
  %constant_2166_14 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.8 = s32[1]{0} maximum(%subtract.248.8, %constant_2166_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.8"}
  %sign.27.7 = s32[1]{0} sign(%maximum.47.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.7"}
  %constant_5144_7 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.7 = pred[1]{0} compare(%sign.27.7, %constant_5144_7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.7"}
  %constant_5145_5 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.8 = s32[1]{0} and(%maximum.47.8, %constant_5145_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.8"}
  %compare.1615.8 = pred[1]{0} compare(%and.301.8, %constant_2166_14), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.8"}
  %and.302.7 = pred[1]{0} and(%compare.1614.7, %compare.1615.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.7"}
  %constant_5146_4 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.7 = s32[1]{0} shift-right-logical(%maximum.47.8, %constant_5146_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.7"}
  %constant_5147_4 = s32[1]{0} constant({-1})
  %add.2981.7 = s32[1]{0} add(%shift-right-logical.20.7, %constant_5147_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.7"}
  %select.1269.7 = s32[1]{0} select(%and.302.7, %add.2981.7, %shift-right-logical.20.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.7"}
  %compare.1616.7 = pred[1]{0} compare(%select.1269.7, %constant_2166_14), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.7"}
  %add.2982.7 = s32[1]{0} add(%select.1269.7, %constant_5146_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.7"}
  %select.1270.7 = s32[1]{0} select(%compare.1616.7, %add.2982.7, %select.1269.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.7"}
  %bitcast.21242.139 = s32[1,1]{1,0} bitcast(%select.1270.7), metadata={scheduling_name="bitcast.21242.139"}
  %concatenate.701.87 = s32[1,5]{1,0} concatenate(%constant_5148_1, %bitcast.21242.139, %constant_5148_1, %constant_5148_1, %constant_5148_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.87"}
  %bitcast.21290.86 = s32[5]{0} bitcast(%concatenate.701.87), metadata={scheduling_name="bitcast.21290.86"}
  %slice.2375.83 = s32[1]{0} slice(%bitcast.21290.86), slice={[1:2]}, metadata={scheduling_name="slice.2375.83"}
  %bitcast.24211.40 = s32[] bitcast(%slice.2375.83), metadata={scheduling_name="bitcast.24211.40"}
  %constant_1668_96 = s32[] constant(0)
  %dynamic-slice.1535.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.24134.2, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1535.1"}
  %param_5.2685 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2685"}
  %dynamic-slice.1536.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_5.2685, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1536.1.clone.1"}
  %param_6.2465 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(6), metadata={scheduling_name="param_6.2465"}
  %bitcast.21283.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_6.2465), metadata={scheduling_name="bitcast.21283.1.clone.1"}
  %dynamic-slice.1488.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.21283.1.clone.1, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1488.1.clone.1"}
  %param_7.2288 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(7), metadata={scheduling_name="param_7.2288"}
  %bitcast.21606.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_7.2288), metadata={scheduling_name="bitcast.21606.1.clone.1"}
  %dynamic-slice.1496.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.21606.1.clone.1, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1496.1.clone.1"}
  %param_8.2142 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2142"}
  %dynamic-slice.1504.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_8.2142, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1504.1.clone.1"}
  %param_9.1882 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1882"}
  %dynamic-slice.1519.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_9.1882, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1519.1.clone.1"}
  %param_10.1512 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(10), metadata={scheduling_name="param_10.1512"}
  %bitcast.23763.2.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_10.1512), metadata={scheduling_name="bitcast.23763.2.clone.1"}
  %dynamic-slice.1525.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%bitcast.23763.2.clone.1, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1525.1.clone.1"}
  %param_11.1421 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1421"}
  %dynamic-slice.1526.1.clone.1 = bf16[1,1,768,48,128]{4,3,2,1,0} dynamic-slice(%param_11.1421, %bitcast.24211.40, %constant_1668_96, %constant_1668_96, %constant_1668_96, /*index=5*/%constant_1668_96), dynamic_slice_sizes={1,1,768,48,128}, metadata={scheduling_name="dynamic-slice.1526.1.clone.1"}
  ROOT %tuple.531 = (bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}) tuple(%dynamic-slice.1535.1, %dynamic-slice.1536.1.clone.1, %dynamic-slice.1488.1.clone.1, %dynamic-slice.1496.1.clone.1, %dynamic-slice.1504.1.clone.1, /*index=5*/%dynamic-slice.1519.1.clone.1, %dynamic-slice.1525.1.clone.1, %dynamic-slice.1526.1.clone.1), metadata={scheduling_name="tuple.531"}
}

%fused_dynamic_update_slice.12 (param_0.2380: bf16[2,1,48,128,768], param_1.2463: bf16[1,1,768,48,128], param_2.1812: bf16[1,768,48,128], param_3.1402: pred[], param_4.1426: s32[32], param_5.1303: u32[], param_6.1257: s32[9], param_7.1183: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.2380 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.2380"}
  %bitcast.23763.1 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%param_0.2380), metadata={scheduling_name="bitcast.23763.1"}
  %param_1.2463 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2463"}
  %convert.4115.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2463), metadata={scheduling_name="convert.4115.3"}
  %param_3.1402 = pred[] parameter(3), metadata={scheduling_name="param_3.1402"}
  %broadcast.5684.6 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1402), dimensions={}, metadata={scheduling_name="broadcast.5684.6"}
  %param_2.1812 = bf16[1,768,48,128]{3,2,0,1} parameter(2), metadata={scheduling_name="param_2.1812"}
  %bitcast.23786.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1812), metadata={scheduling_name="bitcast.23786.3"}
  %constant_1658_39 = bf16[] constant(0)
  %broadcast.5685.6 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1658_39), dimensions={}, metadata={scheduling_name="broadcast.5685.6"}
  %select.1295.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5684.6, %bitcast.23786.3, %broadcast.5685.6), metadata={scheduling_name="select.1295.3"}
  %bitcast.23792.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1295.3), metadata={scheduling_name="bitcast.23792.7"}
  %convert.4116.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23792.7), metadata={scheduling_name="convert.4116.7"}
  %add.3043.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4115.3, %convert.4116.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3043.5"}
  %convert.4117.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.3043.5), metadata={scheduling_name="convert.4117.3"}
  %constant_5148_30 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1257 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1257"}
  %constant_1660_80 = s32[] constant(8)
  %param_7.1183 = s32[] parameter(7), metadata={scheduling_name="param_7.1183"}
  %subtract.247.117 = s32[] subtract(%constant_1660_80, %param_7.1183), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.117"}
  %dynamic-slice.1484.98 = s32[1]{0} dynamic-slice(%param_6.1257, %subtract.247.117), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.98"}
  %param_4.1426 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1426"}
  %param_5.1303 = u32[] parameter(5), metadata={scheduling_name="param_5.1303"}
  %dynamic-slice.1485.93 = s32[1]{0} dynamic-slice(%param_4.1426, %param_5.1303), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.93"}
  %subtract.248.88 = s32[1]{0} subtract(%dynamic-slice.1484.98, %dynamic-slice.1485.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.88"}
  %constant_2166_52 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.88 = s32[1]{0} maximum(%subtract.248.88, %constant_2166_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.88"}
  %sign.27.87 = s32[1]{0} sign(%maximum.47.88), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.87"}
  %constant_5144_47 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.87 = pred[1]{0} compare(%sign.27.87, %constant_5144_47), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.87"}
  %constant_5145_45 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.88 = s32[1]{0} and(%maximum.47.88, %constant_5145_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.88"}
  %compare.1615.88 = pred[1]{0} compare(%and.301.88, %constant_2166_52), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.88"}
  %and.302.87 = pred[1]{0} and(%compare.1614.87, %compare.1615.88), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.87"}
  %constant_5146_44 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.87 = s32[1]{0} shift-right-logical(%maximum.47.88, %constant_5146_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.87"}
  %constant_5147_44 = s32[1]{0} constant({-1})
  %add.2981.87 = s32[1]{0} add(%shift-right-logical.20.87, %constant_5147_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.87"}
  %select.1269.87 = s32[1]{0} select(%and.302.87, %add.2981.87, %shift-right-logical.20.87), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.87"}
  %compare.1616.87 = pred[1]{0} compare(%select.1269.87, %constant_2166_52), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.87"}
  %add.2982.87 = s32[1]{0} add(%select.1269.87, %constant_5146_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.87"}
  %select.1270.87 = s32[1]{0} select(%compare.1616.87, %add.2982.87, %select.1269.87), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.87"}
  %bitcast.21242.97 = s32[1,1]{1,0} bitcast(%select.1270.87), metadata={scheduling_name="bitcast.21242.97"}
  %concatenate.701.45 = s32[1,5]{1,0} concatenate(%constant_5148_30, %bitcast.21242.97, %constant_5148_30, %constant_5148_30, %constant_5148_30), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.45"}
  %bitcast.21290.44 = s32[5]{0} bitcast(%concatenate.701.45), metadata={scheduling_name="bitcast.21290.44"}
  %slice.2375.41 = s32[1]{0} slice(%bitcast.21290.44), slice={[1:2]}, metadata={scheduling_name="slice.2375.41"}
  %bitcast.24211.19 = s32[] bitcast(%slice.2375.41), metadata={scheduling_name="bitcast.24211.19"}
  %constant_1668_47 = s32[] constant(0)
  ROOT %dynamic-update-slice.401.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%bitcast.23763.1, %convert.4117.3, %bitcast.24211.19, %constant_1668_47, %constant_1668_47, /*index=5*/%constant_1668_47, %constant_1668_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.401.1"}
}

%fused_reduce.5 (param_0.2390: bf16[4,8192,6144], param_1.2526: bf16[32768,6144], param_2.1873: bf16[2,1,6144], param_3.1640: s32[32], param_4.1393: u32[], param_5.1295: s32[9], param_6.1249: s32[]) -> f32[4,8192] {
  %param_1.2526 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2526"}
  %bitcast.21315.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.2526), metadata={scheduling_name="bitcast.21315.23"}
  %convert.3887.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21315.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3887.23"}
  %param_0.2390 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2390"}
  %bitcast.23281.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2390), metadata={scheduling_name="bitcast.23281.17"}
  %convert.4046.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23281.17), metadata={scheduling_name="convert.4046.17"}
  %param_2.1873 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1873"}
  %param_5.1295 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1295"}
  %constant_1660_103 = s32[] constant(8)
  %param_6.1249 = s32[] parameter(6), metadata={scheduling_name="param_6.1249"}
  %subtract.247.181 = s32[] subtract(%constant_1660_103, %param_6.1249), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.181"}
  %dynamic-slice.1484.162 = s32[1]{0} dynamic-slice(%param_5.1295, %subtract.247.181), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.162"}
  %param_3.1640 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.1640"}
  %param_4.1393 = u32[] parameter(4), metadata={scheduling_name="param_4.1393"}
  %dynamic-slice.1485.157 = s32[1]{0} dynamic-slice(%param_3.1640, %param_4.1393), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.157"}
  %subtract.248.152 = s32[1]{0} subtract(%dynamic-slice.1484.162, %dynamic-slice.1485.157), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.152"}
  %constant_2166_79 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.152 = s32[1]{0} maximum(%subtract.248.152, %constant_2166_79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.152"}
  %sign.27.147 = s32[1]{0} sign(%maximum.47.152), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.147"}
  %constant_5144_73 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.147 = pred[1]{0} compare(%sign.27.147, %constant_5144_73), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.147"}
  %constant_5145_72 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.152 = s32[1]{0} and(%maximum.47.152, %constant_5145_72), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.152"}
  %compare.1615.152 = pred[1]{0} compare(%and.301.152, %constant_2166_79), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.152"}
  %and.302.147 = pred[1]{0} and(%compare.1614.147, %compare.1615.152), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.147"}
  %constant_5146_70 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.147 = s32[1]{0} shift-right-logical(%maximum.47.152, %constant_5146_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.147"}
  %constant_5147_70 = s32[1]{0} constant({-1})
  %add.2981.147 = s32[1]{0} add(%shift-right-logical.20.147, %constant_5147_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.147"}
  %select.1269.147 = s32[1]{0} select(%and.302.147, %add.2981.147, %shift-right-logical.20.147), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.147"}
  %compare.1616.147 = pred[1]{0} compare(%select.1269.147, %constant_2166_79), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.147"}
  %add.2982.147 = s32[1]{0} add(%select.1269.147, %constant_5146_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.147"}
  %select.1270.147 = s32[1]{0} select(%compare.1616.147, %add.2982.147, %select.1269.147), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.147"}
  %bitcast.21242.161 = s32[1,1]{1,0} bitcast(%select.1270.147), metadata={scheduling_name="bitcast.21242.161"}
  %constant_1668_92 = s32[] constant(0)
  %pad.345.53 = s32[1,2]{1,0} pad(%bitcast.21242.161, %constant_1668_92), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.53"}
  %pad.346.51 = s32[1,3]{1,0} pad(%pad.345.53, %constant_1668_92), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.51"}
  %bitcast.21349.48 = s32[3]{0} bitcast(%pad.346.51), metadata={scheduling_name="bitcast.21349.48"}
  %slice.2376.43 = s32[1]{0} slice(%bitcast.21349.48), slice={[1:2]}, metadata={scheduling_name="slice.2376.43"}
  %bitcast.24050.30 = s32[] bitcast(%slice.2376.43), metadata={scheduling_name="bitcast.24050.30"}
  %dynamic-slice.1490.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1873, %bitcast.24050.30, %constant_1668_92, %constant_1668_92), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1490.3"}
  %bitcast.21355.10 = bf16[6144]{0} bitcast(%dynamic-slice.1490.3), metadata={scheduling_name="bitcast.21355.10"}
  %convert.4977.7 = f32[6144]{0} convert(%bitcast.21355.10), metadata={scheduling_name="convert.4977.7"}
  %broadcast.6028.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4977.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.14"}
  %multiply.2669.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4046.17, %broadcast.6028.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2669.11"}
  %multiply.2671.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3887.23, %multiply.2669.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2671.3"}
  %bitcast.23543.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2671.3), metadata={scheduling_name="bitcast.23543.1"}
  %constant_1694_2 = f32[] constant(0)
  ROOT %reduce.422.1 = f32[4,8192]{1,0} reduce(%bitcast.23543.1, %constant_1694_2), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.422.1"}
}

%fused_dynamic_slice.17 (param_0.2379: f32[9,1,4,48,8192,1], param_1.2462: s32[]) -> f32[1,1,1,4,48,8192] {
  %param_0.2379 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(0), metadata={scheduling_name="param_0.2379"}
  %bitcast.23501.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_0.2379), metadata={scheduling_name="bitcast.23501.1"}
  %constant_1660_9 = s32[] constant(8)
  %param_1.2462 = s32[] parameter(1), metadata={scheduling_name="param_1.2462"}
  %subtract.247.2 = s32[] subtract(%constant_1660_9, %param_1.2462), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.2"}
  %constant_1668_46 = s32[] constant(0)
  ROOT %dynamic-slice.1522.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-slice(%bitcast.23501.1, %subtract.247.2, %constant_1668_46, %constant_1668_46, %constant_1668_46, /*index=5*/%constant_1668_46, %constant_1668_46), dynamic_slice_sizes={1,1,1,4,48,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1522.1"}
}

%fused_rsqrt.4 (param_0.2397: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2397 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2397"}
  %bitcast.23342.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2397), metadata={scheduling_name="bitcast.23342.7"}
  %constant_1695_1 = f32[] constant(0.000162760422)
  %broadcast.5571.16 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_1), dimensions={}, metadata={scheduling_name="broadcast.5571.16"}
  %multiply.2658.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.23342.7, %broadcast.5571.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2658.7"}
  %constant_1696_1 = f32[] constant(1e-05)
  %broadcast.5572.8 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_1), dimensions={}, metadata={scheduling_name="broadcast.5572.8"}
  %add.3031.5 = f32[1,4,8192]{2,1,0} add(%multiply.2658.7, %broadcast.5572.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3031.5"}
  %bitcast.23352.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.3031.5), metadata={scheduling_name="bitcast.23352.1"}
  ROOT %rsqrt.98.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.23352.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.98.1"}
}

%fused_reduce.6 (param_0.2389: bf16[9,1,4,8192,6144], param_1.2525: s32[]) -> f32[4,8192] {
  %param_0.2389 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2389"}
  %constant_1660_26 = s32[] constant(8)
  %param_1.2525 = s32[] parameter(1), metadata={scheduling_name="param_1.2525"}
  %subtract.247.19 = s32[] subtract(%constant_1660_26, %param_1.2525), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.19"}
  %constant_1668_23 = s32[] constant(0)
  %dynamic-slice.1489.4 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2389, %subtract.247.19, %constant_1668_23, %constant_1668_23, %constant_1668_23, /*index=5*/%constant_1668_23), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1489.4"}
  %bitcast.23330.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1489.4), metadata={scheduling_name="bitcast.23330.21"}
  %convert.4055.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23330.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4055.21"}
  %multiply.2657.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4055.21, %convert.4055.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2657.3"}
  %bitcast.23337.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2657.3), metadata={scheduling_name="bitcast.23337.1"}
  %constant_1694_1 = f32[] constant(0)
  ROOT %reduce.421.1 = f32[4,8192]{1,0} reduce(%bitcast.23337.1, %constant_1694_1), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.421.1"}
}

%fused_transpose.6 (param_0.117: bf16[1,1,8,4,1,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.117 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.117"}
  %bitcast.23264.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.117), metadata={scheduling_name="bitcast.23264.1"}
  ROOT %transpose.754.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.23264.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.754.1"}
}

%fused_transpose.7 (param_0.127: bf16[1,1,4,6144,8,1,2048]) -> bf16[32,2048,6144] {
  %param_0.127 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} parameter(0), metadata={scheduling_name="param_0.127"}
  %bitcast.23089.1 = bf16[32,6144,2048]{2,1,0} bitcast(%param_0.127), metadata={scheduling_name="bitcast.23089.1"}
  ROOT %transpose.752.1 = bf16[32,2048,6144]{2,1,0} transpose(%bitcast.23089.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.752.1"}
}

%fused_transpose.8 (param_0.129: bf16[4,6144,16384]) -> bf16[8,24576,2048] {
  %param_0.129 = bf16[4,6144,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.129"}
  %bitcast.23082.1 = bf16[24576,8,2048]{2,1,0} bitcast(%param_0.129), metadata={scheduling_name="bitcast.23082.1"}
  ROOT %transpose.751.1 = bf16[8,24576,2048]{2,1,0} transpose(%bitcast.23082.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.751.1"}
}

%fused_scatter.4 (param_0.135: bf16[1,4,8192,8], param_1.54: s32[65536,4], param_2.1740: bf16[1,4,8192,2], param_3.1481: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.135 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.135"}
  %param_1.54 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.54"}
  %param_2.1740 = bf16[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1740"}
  %convert.4025.16 = f32[1,4,8192,2]{3,2,1,0} convert(%param_2.1740), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4025.16"}
  %param_3.1481 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1481"}
  %bitcast.22688.13 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1481), metadata={scheduling_name="bitcast.22688.13"}
  %constant_1862_3 = f32[] constant(-inf)
  %reduce.165.1 = f32[32768]{0} reduce(%param_3.1481, %constant_1862_3), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.165.1"}
  %bitcast.22696.13 = f32[4,8192]{1,0} bitcast(%reduce.165.1), metadata={scheduling_name="bitcast.22696.13"}
  %broadcast.5644.13 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22696.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5644.13"}
  %subtract.255.13 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.22688.13, %broadcast.5644.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.255.13"}
  %exponential.95.11 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.255.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.95.11"}
  %bitcast.22704.5 = f32[4,8192,2]{2,1,0} bitcast(%exponential.95.11), metadata={scheduling_name="bitcast.22704.5"}
  %constant_1694_12 = f32[] constant(0)
  %reduce.415.5 = f32[4,8192]{1,0} reduce(%bitcast.22704.5, %constant_1694_12), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.415.5"}
  %broadcast.5645.16 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.415.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5645.16"}
  %divide.468.9 = f32[1,4,8192,2]{3,2,1,0} divide(%convert.4025.16, %broadcast.5645.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.468.9"}
  %constant_2054_1 = f32[] constant(1)
  %broadcast.5620.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_2054_1), dimensions={}, metadata={scheduling_name="broadcast.5620.14"}
  %bitcast.22988.5 = f32[1,4,8192]{2,1,0} bitcast(%reduce.415.5), metadata={scheduling_name="bitcast.22988.5"}
  %multiply.2646.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22988.5, %bitcast.22988.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2646.5"}
  %divide.469.7 = f32[1,4,8192]{2,1,0} divide(%broadcast.5620.14, %multiply.2646.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.469.7"}
  %bitcast.22992.7 = f32[4,8192]{1,0} bitcast(%divide.469.7), metadata={scheduling_name="bitcast.22992.7"}
  %broadcast.5661.7 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22992.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5661.7"}
  %multiply.2647.9 = f32[1,4,8192,2]{3,2,1,0} multiply(%convert.4025.16, %broadcast.5661.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2647.9"}
  %multiply.2648.7 = f32[1,4,8192,2]{3,2,1,0} multiply(%multiply.2647.9, %exponential.95.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2648.7"}
  %bitcast.23000.5 = f32[4,8192,2]{2,1,0} bitcast(%multiply.2648.7), metadata={scheduling_name="bitcast.23000.5"}
  %reduce.419.5 = f32[4,8192]{1,0} reduce(%bitcast.23000.5, %constant_1694_12), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.419.5"}
  %bitcast.23005.3 = f32[1,4,8192]{2,1,0} bitcast(%reduce.419.5), metadata={scheduling_name="bitcast.23005.3"}
  %negate.219.3 = f32[1,4,8192]{2,1,0} negate(%bitcast.23005.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="negate.219.3"}
  %bitcast.23008.5 = f32[4,8192]{1,0} bitcast(%negate.219.3), metadata={scheduling_name="bitcast.23008.5"}
  %broadcast.5662.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.23008.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5662.5"}
  %add.3024.7 = f32[1,4,8192,2]{3,2,1,0} add(%divide.468.9, %broadcast.5662.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="add.3024.7"}
  %multiply.2649.5 = f32[1,4,8192,2]{3,2,1,0} multiply(%add.3024.7, %exponential.95.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2649.5"}
  %convert.4026.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%multiply.2649.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.4026.3"}
  %bitcast.23014.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%convert.4026.3), metadata={scheduling_name="bitcast.23014.1"}
  ROOT %scatter.216.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.135, %param_1.54, %bitcast.23014.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="scatter.216.1"}
}

%fused_transpose.9 (param_0.2365: bf16[4,8192,16384]) -> bf16[4,16392,8192] {
  %param_0.2365 = bf16[4,8192,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2365"}
  %bitcast.22932.3 = bf16[1,4,8192,8,2048]{4,3,2,1,0} bitcast(%param_0.2365), metadata={scheduling_name="bitcast.22932.3"}
  %constant_1658_6 = bf16[] constant(0)
  %pad.354.3 = bf16[1,4,8192,8,2049]{4,3,2,1,0} pad(%bitcast.22932.3, %constant_1658_6), padding=0_0x0_0x0_0x0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="pad.354.3"}
  %bitcast.22935.1 = bf16[4,8192,16392]{2,1,0} bitcast(%pad.354.3), metadata={scheduling_name="bitcast.22935.1"}
  ROOT %transpose.749.1 = bf16[4,16392,8192]{2,1,0} transpose(%bitcast.22935.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.749.1"}
}

%fused_transpose.10 (param_0.158: bf16[1,1,1,8,4,2048,6144]) -> bf16[4,6144,8,2048] {
  %param_0.158 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.158"}
  %bitcast.22925.1 = bf16[8,4,2048,6144]{3,2,1,0} bitcast(%param_0.158), metadata={scheduling_name="bitcast.22925.1"}
  ROOT %transpose.748.1 = bf16[4,6144,8,2048]{3,2,1,0} transpose(%bitcast.22925.1), dimensions={1,3,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.748.1"}
}

%fused_transpose.11 (param_0.164: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.164 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.164"}
  %bitcast.22851.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.164), metadata={scheduling_name="bitcast.22851.1"}
  ROOT %transpose.747.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.22851.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.747.1"}
}

%fused_multiply_transpose.2 (param_0.181: s32[4,8,8192], param_1.67: s32[4,8,8192], param_2.4727: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.181 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.181"}
  %bitcast.22821.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.181), metadata={scheduling_name="bitcast.22821.1"}
  %param_1.67 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.67"}
  %bitcast.22799.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.67), metadata={scheduling_name="bitcast.22799.2"}
  %multiply.2640.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.22821.1, %bitcast.22799.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2640.1"}
  %param_2.4727 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4727"}
  %bitcast.22719.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4727), metadata={scheduling_name="bitcast.22719.3.clone.1"}
  %transpose.746.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.22719.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.746.3.clone.1"}
  %bitcast.22722.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.746.3.clone.1), metadata={scheduling_name="bitcast.22722.5.clone.1"}
  %convert.3999.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22722.5.clone.1), metadata={scheduling_name="convert.3999.5.clone.1"}
  %convert.4001.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22799.2), metadata={scheduling_name="convert.4001.3.clone.1"}
  %multiply.2638.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3999.5.clone.1, %convert.4001.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2638.3.clone.1"}
  %convert.4002.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2638.3.clone.1), metadata={scheduling_name="convert.4002.1.clone.1"}
  ROOT %tuple.499 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2640.1, %convert.4002.1.clone.1), metadata={scheduling_name="tuple.499"}
}

%fused_reduce.7 (param_0.2372: pred[1,4,8,8192,2], param_1.2541: s32[1,4,8,64,16], param_2.1884: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.2372 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2372"}
  %convert.4000.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2372), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4000.17"}
  %bitcast.22733.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4000.17), metadata={scheduling_name="bitcast.22733.11"}
  %constant_1668_13 = s32[] constant(0)
  %reduce-window.164.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.22733.11, %constant_1668_13), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.164.11"}
  %param_1.2541 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2541"}
  %param_2.1884 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1884"}
  %slice.2398.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.1884), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2398.7"}
  %bitcast.22757.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2398.7), metadata={scheduling_name="bitcast.22757.9"}
  %reduce-window.167.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.22757.9, %constant_1668_13), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.167.9"}
  %slice.2399.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.167.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2399.7"}
  %bitcast.22763.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2399.7), metadata={scheduling_name="bitcast.22763.9"}
  %broadcast.5648.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.22763.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5648.9"}
  %add.3020.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.1884, %broadcast.5648.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3020.7"}
  %bitcast.22767.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.3020.7), metadata={scheduling_name="bitcast.22767.7"}
  %pad.352.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.22767.7, %constant_1668_13), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.352.7"}
  %slice.2400.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.352.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2400.5"}
  %bitcast.22771.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2400.5), metadata={scheduling_name="bitcast.22771.9"}
  %broadcast.5649.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.22771.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5649.9"}
  %add.3021.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.2541, %broadcast.5649.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3021.7"}
  %bitcast.22775.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.3021.7), metadata={scheduling_name="bitcast.22775.5"}
  %pad.353.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.22775.5, %constant_1668_13), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.353.5"}
  %slice.2401.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.353.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2401.1"}
  %bitcast.22779.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2401.1), metadata={scheduling_name="bitcast.22779.9"}
  %broadcast.5650.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.22779.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5650.9"}
  %add.3022.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.164.11, %broadcast.5650.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.3022.7"}
  %bitcast.22783.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.3022.7), metadata={scheduling_name="bitcast.22783.6"}
  %constant_1884_1 = s32[] constant(2048)
  %broadcast.5606.6 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_1884_1), dimensions={}, metadata={scheduling_name="broadcast.5606.6"}
  %compare.1639.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.22783.6, %broadcast.5606.6), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1639.3"}
  %bitcast.22789.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1639.3), metadata={scheduling_name="bitcast.22789.3"}
  %broadcast.5607.6 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_1668_13), dimensions={}, metadata={scheduling_name="broadcast.5607.6"}
  %select.1285.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.22789.3, %convert.4000.17, %broadcast.5607.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1285.3"}
  %bitcast.22796.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1285.3), metadata={scheduling_name="bitcast.22796.1"}
  %reduce.502.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.22796.1, %constant_1668_13), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.502.1"}
  %bitcast.22810.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.4000.17), metadata={scheduling_name="bitcast.22810.3.clone.1"}
  %multiply.2639.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.22810.3.clone.1, %bitcast.22783.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2639.3.clone.1"}
  %bitcast.22816.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2639.3.clone.1), metadata={scheduling_name="bitcast.22816.1.clone.1"}
  %reduce.503.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.22816.1.clone.1, %constant_1668_13), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.503.1.clone.1"}
  ROOT %tuple.500 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.502.1, %reduce.503.1.clone.1), metadata={scheduling_name="tuple.500"}
}

%fused_reduce_window.4 (param_0.2383: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.2383 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2383"}
  %slice.2397.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.2383), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2397.1"}
  %bitcast.22749.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2397.1), metadata={scheduling_name="bitcast.22749.1"}
  %constant_1668_78 = s32[] constant(0)
  ROOT %reduce-window.166.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.22749.1, %constant_1668_78), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.166.1"}
}

%fused_reduce_window.5 (param_0.2373: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.2373 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2373"}
  %bitcast.22741.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.2373), metadata={scheduling_name="bitcast.22741.1"}
  %constant_1668_24 = s32[] constant(0)
  ROOT %reduce-window.165.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.22741.1, %constant_1668_24), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.165.1"}
}

%fused_scatter.5 (param_0.213: bf16[1,4,8192,8], param_1.87: s32[65536,4], param_2.1183: pred[1,4,8192,2], param_3.1364: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.213 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.213"}
  %param_1.87 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.87"}
  %param_2.1183 = pred[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1183"}
  %param_3.1364 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1364"}
  %bitcast.22688.5 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1364), metadata={scheduling_name="bitcast.22688.5"}
  %constant_1862_1 = f32[] constant(-inf)
  %reduce.165.2 = f32[32768]{0} reduce(%param_3.1364, %constant_1862_1), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.165.2"}
  %bitcast.22696.5 = f32[4,8192]{1,0} bitcast(%reduce.165.2), metadata={scheduling_name="bitcast.22696.5"}
  %broadcast.5644.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22696.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5644.5"}
  %subtract.255.5 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.22688.5, %broadcast.5644.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.255.5"}
  %exponential.95.3 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.255.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.95.3"}
  %bitcast.22704.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.95.3), metadata={scheduling_name="bitcast.22704.3"}
  %constant_1694_11 = f32[] constant(0)
  %reduce.415.3 = f32[4,8192]{1,0} reduce(%bitcast.22704.3, %constant_1694_11), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.415.3"}
  %broadcast.5645.14 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.415.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5645.14"}
  %divide.466.7 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.95.3, %broadcast.5645.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.466.7"}
  %convert.3998.5 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.466.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3998.5"}
  %constant_1658_46 = bf16[] constant(0)
  %broadcast.5601.12 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1658_46), dimensions={}, metadata={scheduling_name="broadcast.5601.12"}
  %select.1284.3 = bf16[1,4,8192,2]{3,2,1,0} select(%param_2.1183, %convert.3998.5, %broadcast.5601.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1284.3"}
  %bitcast.22716.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1284.3), metadata={scheduling_name="bitcast.22716.1"}
  ROOT %scatter.215.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.213, %param_1.87, %bitcast.22716.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.215.1"}
}

%fused_convert_reduce.1 (param_0.6068: bf16[9,1,4,8192,6144], param_1.6461: s32[], param_2.4677: bf16[2,1,6144], param_3.3867: s32[32], param_4.2827: u32[], param_5.2596: s32[9], param_6.2340: bf16[32768,6144], param_7.2163: bf16[32768,6144], param_8.2052: bf16[2,1,6144], param_9.1767: f32[1,1,4,8192], param_10.1374: bf16[32768,6144]) -> (f32[4,8192], bf16[32768,6144], bf16[1,4,8192,6144]) {
  %param_0.6068 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6068"}
  %constant_1660_19 = s32[] constant(8)
  %param_1.6461 = s32[] parameter(1), metadata={scheduling_name="param_1.6461"}
  %subtract.247.12 = s32[] subtract(%constant_1660_19, %param_1.6461), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.12"}
  %constant_1668_9 = s32[] constant(0)
  %dynamic-slice.1497.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.6068, %subtract.247.12, %constant_1668_9, %constant_1668_9, %constant_1668_9, /*index=5*/%constant_1668_9), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1497.3"}
  %bitcast.22267.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1497.3), metadata={scheduling_name="bitcast.22267.23"}
  %convert.3944.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22267.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3944.23"}
  %param_7.2163 = bf16[32768,6144]{1,0} parameter(7), metadata={scheduling_name="param_7.2163"}
  %convert.3982.1.clone.1 = f32[32768,6144]{1,0} convert(%param_7.2163), metadata={scheduling_name="convert.3982.1.clone.1"}
  %param_6.2340 = bf16[32768,6144]{1,0} parameter(6), metadata={scheduling_name="param_6.2340"}
  %convert.3993.1.clone.1 = f32[32768,6144]{1,0} convert(%param_6.2340), metadata={scheduling_name="convert.3993.1.clone.1"}
  %add.3016.1.clone.1 = f32[32768,6144]{1,0} add(%convert.3982.1.clone.1, %convert.3993.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/attentions.py" source_line=838 scheduling_name="add.3016.1.clone.1"}
  %convert.3994.1.clone.1 = bf16[32768,6144]{1,0} convert(%add.3016.1.clone.1), metadata={scheduling_name="convert.3994.1.clone.1"}
  %bitcast.22633.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%convert.3994.1.clone.1), metadata={scheduling_name="bitcast.22633.17"}
  %convert.3995.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22633.17), metadata={scheduling_name="convert.3995.17"}
  %param_2.4677 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4677"}
  %param_5.2596 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2596"}
  %dynamic-slice.1484.178 = s32[1]{0} dynamic-slice(%param_5.2596, %subtract.247.12), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.178"}
  %param_3.3867 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.3867"}
  %param_4.2827 = u32[] parameter(4), metadata={scheduling_name="param_4.2827"}
  %dynamic-slice.1485.173 = s32[1]{0} dynamic-slice(%param_3.3867, %param_4.2827), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.173"}
  %subtract.248.168 = s32[1]{0} subtract(%dynamic-slice.1484.178, %dynamic-slice.1485.173), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.168"}
  %constant_2166_24 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.168 = s32[1]{0} maximum(%subtract.248.168, %constant_2166_24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.168"}
  %sign.27.163 = s32[1]{0} sign(%maximum.47.168), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.163"}
  %constant_5144_18 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.163 = pred[1]{0} compare(%sign.27.163, %constant_5144_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.163"}
  %constant_5145_16 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.168 = s32[1]{0} and(%maximum.47.168, %constant_5145_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.168"}
  %compare.1615.168 = pred[1]{0} compare(%and.301.168, %constant_2166_24), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.168"}
  %and.302.163 = pred[1]{0} and(%compare.1614.163, %compare.1615.168), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.163"}
  %constant_5146_15 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.163 = s32[1]{0} shift-right-logical(%maximum.47.168, %constant_5146_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.163"}
  %constant_5147_15 = s32[1]{0} constant({-1})
  %add.2981.163 = s32[1]{0} add(%shift-right-logical.20.163, %constant_5147_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.163"}
  %select.1269.163 = s32[1]{0} select(%and.302.163, %add.2981.163, %shift-right-logical.20.163), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.163"}
  %compare.1616.163 = pred[1]{0} compare(%select.1269.163, %constant_2166_24), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.163"}
  %add.2982.163 = s32[1]{0} add(%select.1269.163, %constant_5146_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.163"}
  %select.1270.163 = s32[1]{0} select(%compare.1616.163, %add.2982.163, %select.1269.163), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.163"}
  %bitcast.21242.177 = s32[1,1]{1,0} bitcast(%select.1270.163), metadata={scheduling_name="bitcast.21242.177"}
  %pad.345.69 = s32[1,2]{1,0} pad(%bitcast.21242.177, %constant_1668_9), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.69"}
  %pad.346.67 = s32[1,3]{1,0} pad(%pad.345.69, %constant_1668_9), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.67"}
  %bitcast.21349.64 = s32[3]{0} bitcast(%pad.346.67), metadata={scheduling_name="bitcast.21349.64"}
  %slice.2376.59 = s32[1]{0} slice(%bitcast.21349.64), slice={[1:2]}, metadata={scheduling_name="slice.2376.59"}
  %bitcast.24050.46 = s32[] bitcast(%slice.2376.59), metadata={scheduling_name="bitcast.24050.46"}
  %dynamic-slice.1503.11 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4677, %bitcast.24050.46, %constant_1668_9, %constant_1668_9), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1503.11"}
  %bitcast.22303.10 = bf16[6144]{0} bitcast(%dynamic-slice.1503.11), metadata={scheduling_name="bitcast.22303.10"}
  %convert.4984.7 = f32[6144]{0} convert(%bitcast.22303.10), metadata={scheduling_name="convert.4984.7"}
  %broadcast.6039.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4984.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6039.14"}
  %multiply.2631.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3995.17, %broadcast.6039.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2631.11"}
  %multiply.2633.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.23, %multiply.2631.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2633.3"}
  %bitcast.22649.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2633.3), metadata={scheduling_name="bitcast.22649.1"}
  %constant_1694_10 = f32[] constant(0)
  %reduce.414.1 = f32[4,8192]{1,0} reduce(%bitcast.22649.1, %constant_1694_10), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.414.1"}
  %param_10.1374 = bf16[32768,6144]{1,0} parameter(10), metadata={scheduling_name="param_10.1374"}
  %bitcast.21315.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_10.1374), metadata={scheduling_name="bitcast.21315.15.clone.1"}
  %convert.3887.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21315.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3887.15.clone.1"}
  %param_9.1767 = f32[1,1,4,8192]{3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1767"}
  %bitcast.21337.13.clone.1 = f32[4,8192]{1,0} bitcast(%param_9.1767), metadata={scheduling_name="bitcast.21337.13.clone.1"}
  %broadcast.5573.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21337.13.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5573.13.clone.1"}
  %multiply.2572.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3887.15.clone.1, %broadcast.5573.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2572.7.clone.1"}
  %param_8.2052 = bf16[2,1,6144]{2,1,0} parameter(8), metadata={scheduling_name="param_8.2052"}
  %dynamic-slice.1490.9.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_8.2052, %bitcast.24050.46, %constant_1668_9, %constant_1668_9), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1490.9.clone.1"}
  %bitcast.21355.8.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1490.9.clone.1), metadata={scheduling_name="bitcast.21355.8.clone.1"}
  %convert.4977.5.clone.1 = f32[6144]{0} convert(%bitcast.21355.8.clone.1), metadata={scheduling_name="convert.4977.5.clone.1"}
  %broadcast.6028.10.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4977.5.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.10.clone.1"}
  %multiply.2573.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2572.7.clone.1, %broadcast.6028.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2573.3.clone.1"}
  %convert.3889.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2573.3.clone.1), metadata={scheduling_name="convert.3889.1.clone.1"}
  ROOT %tuple.506 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%reduce.414.1, %convert.3994.1.clone.1, %convert.3889.1.clone.1), metadata={scheduling_name="tuple.506"}
}

%fused_dynamic_slice.18 (param_0.2387: f32[9,1,4,48,8192,1], param_1.2516: s32[]) -> f32[1,1,1,4,48,8192] {
  %param_0.2387 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} parameter(0), metadata={scheduling_name="param_0.2387"}
  %bitcast.22491.1 = f32[9,1,1,4,48,8192]{5,4,3,2,1,0} bitcast(%param_0.2387), metadata={scheduling_name="bitcast.22491.1"}
  %constant_1660_16 = s32[] constant(8)
  %param_1.2516 = s32[] parameter(1), metadata={scheduling_name="param_1.2516"}
  %subtract.247.9 = s32[] subtract(%constant_1660_16, %param_1.2516), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.9"}
  %constant_1668_107 = s32[] constant(0)
  ROOT %dynamic-slice.1508.1 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} dynamic-slice(%bitcast.22491.1, %subtract.247.9, %constant_1668_107, %constant_1668_107, %constant_1668_107, /*index=5*/%constant_1668_107, %constant_1668_107), dynamic_slice_sizes={1,1,1,4,48,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1508.1"}
}

%fused_rsqrt.5 (param_0.2400: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2400 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2400"}
  %bitcast.22279.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2400), metadata={scheduling_name="bitcast.22279.7"}
  %constant_1695_4 = f32[] constant(0.000162760422)
  %broadcast.5571.20 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_4), dimensions={}, metadata={scheduling_name="broadcast.5571.20"}
  %multiply.2609.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22279.7, %broadcast.5571.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2609.7"}
  %constant_1696_4 = f32[] constant(1e-05)
  %broadcast.5572.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_4), dimensions={}, metadata={scheduling_name="broadcast.5572.12"}
  %add.3006.5 = f32[1,4,8192]{2,1,0} add(%multiply.2609.7, %broadcast.5572.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3006.5"}
  %bitcast.22289.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.3006.5), metadata={scheduling_name="bitcast.22289.1"}
  ROOT %rsqrt.97.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.22289.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.97.1"}
}

%fused_reduce.8 (param_0.2395: bf16[9,1,4,8192,6144], param_1.2529: s32[]) -> f32[4,8192] {
  %param_0.2395 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2395"}
  %constant_1660_20 = s32[] constant(8)
  %param_1.2529 = s32[] parameter(1), metadata={scheduling_name="param_1.2529"}
  %subtract.247.13 = s32[] subtract(%constant_1660_20, %param_1.2529), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.13"}
  %constant_1668_6 = s32[] constant(0)
  %dynamic-slice.1497.4 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2395, %subtract.247.13, %constant_1668_6, %constant_1668_6, %constant_1668_6, /*index=5*/%constant_1668_6), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1497.4"}
  %bitcast.22267.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1497.4), metadata={scheduling_name="bitcast.22267.21"}
  %convert.3944.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22267.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3944.21"}
  %multiply.2608.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.21, %convert.3944.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2608.3"}
  %bitcast.22274.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2608.3), metadata={scheduling_name="bitcast.22274.1"}
  %constant_1694_9 = f32[] constant(0)
  ROOT %reduce.413.1 = f32[4,8192]{1,0} reduce(%bitcast.22274.1, %constant_1694_9), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.413.1"}
}

%fused_reduce.9 (param_0.2394: bf16[4,8192,6144], param_1.2528: bf16[32768,6144], param_2.1875: bf16[2,1,6144], param_3.1638: s32[32], param_4.1391: u32[], param_5.1294: s32[9], param_6.1248: s32[]) -> f32[4,8192] {
  %param_1.2528 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2528"}
  %bitcast.21630.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.2528), metadata={scheduling_name="bitcast.21630.23"}
  %convert.3899.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21630.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3899.23"}
  %param_0.2394 = bf16[4,8192,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2394"}
  %bitcast.22224.17 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2394), metadata={scheduling_name="bitcast.22224.17"}
  %convert.3942.17 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22224.17), metadata={scheduling_name="convert.3942.17"}
  %param_2.1875 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1875"}
  %param_5.1294 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1294"}
  %constant_1660_101 = s32[] constant(8)
  %param_6.1248 = s32[] parameter(6), metadata={scheduling_name="param_6.1248"}
  %subtract.247.173 = s32[] subtract(%constant_1660_101, %param_6.1248), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.173"}
  %dynamic-slice.1484.154 = s32[1]{0} dynamic-slice(%param_5.1294, %subtract.247.173), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.154"}
  %param_3.1638 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.1638"}
  %param_4.1391 = u32[] parameter(4), metadata={scheduling_name="param_4.1391"}
  %dynamic-slice.1485.149 = s32[1]{0} dynamic-slice(%param_3.1638, %param_4.1391), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.149"}
  %subtract.248.144 = s32[1]{0} subtract(%dynamic-slice.1484.154, %dynamic-slice.1485.149), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.144"}
  %constant_2166_76 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.144 = s32[1]{0} maximum(%subtract.248.144, %constant_2166_76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.144"}
  %sign.27.139 = s32[1]{0} sign(%maximum.47.144), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.139"}
  %constant_5144_70 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.139 = pred[1]{0} compare(%sign.27.139, %constant_5144_70), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.139"}
  %constant_5145_69 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.144 = s32[1]{0} and(%maximum.47.144, %constant_5145_69), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.144"}
  %compare.1615.144 = pred[1]{0} compare(%and.301.144, %constant_2166_76), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.144"}
  %and.302.139 = pred[1]{0} and(%compare.1614.139, %compare.1615.144), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.139"}
  %constant_5146_67 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.139 = s32[1]{0} shift-right-logical(%maximum.47.144, %constant_5146_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.139"}
  %constant_5147_67 = s32[1]{0} constant({-1})
  %add.2981.139 = s32[1]{0} add(%shift-right-logical.20.139, %constant_5147_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.139"}
  %select.1269.139 = s32[1]{0} select(%and.302.139, %add.2981.139, %shift-right-logical.20.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.139"}
  %compare.1616.139 = pred[1]{0} compare(%select.1269.139, %constant_2166_76), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.139"}
  %add.2982.139 = s32[1]{0} add(%select.1269.139, %constant_5146_67), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.139"}
  %select.1270.139 = s32[1]{0} select(%compare.1616.139, %add.2982.139, %select.1269.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.139"}
  %bitcast.21242.153 = s32[1,1]{1,0} bitcast(%select.1270.139), metadata={scheduling_name="bitcast.21242.153"}
  %constant_1668_114 = s32[] constant(0)
  %pad.345.45 = s32[1,2]{1,0} pad(%bitcast.21242.153, %constant_1668_114), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.45"}
  %pad.346.43 = s32[1,3]{1,0} pad(%pad.345.45, %constant_1668_114), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.43"}
  %bitcast.21349.40 = s32[3]{0} bitcast(%pad.346.43), metadata={scheduling_name="bitcast.21349.40"}
  %slice.2376.35 = s32[1]{0} slice(%bitcast.21349.40), slice={[1:2]}, metadata={scheduling_name="slice.2376.35"}
  %bitcast.24050.22 = s32[] bitcast(%slice.2376.35), metadata={scheduling_name="bitcast.24050.22"}
  %dynamic-slice.1498.3 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1875, %bitcast.24050.22, %constant_1668_114, %constant_1668_114), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1498.3"}
  %bitcast.21666.10 = bf16[6144]{0} bitcast(%dynamic-slice.1498.3), metadata={scheduling_name="bitcast.21666.10"}
  %convert.4978.7 = f32[6144]{0} convert(%bitcast.21666.10), metadata={scheduling_name="convert.4978.7"}
  %broadcast.6029.14 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4978.7), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6029.14"}
  %multiply.2601.11 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.17, %broadcast.6029.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2601.11"}
  %multiply.2603.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3899.23, %multiply.2601.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2603.3"}
  %bitcast.22240.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2603.3), metadata={scheduling_name="bitcast.22240.1"}
  %constant_1694_8 = f32[] constant(0)
  ROOT %reduce.412.1 = f32[4,8192]{1,0} reduce(%bitcast.22240.1, %constant_1694_8), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.412.1"}
}

%fused_scatter.6 (param_0.276: bf16[1,4,8192,8], param_1.110: s32[65536,4], param_2.1737: bf16[1,4,8192,2], param_3.1482: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.276 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.276"}
  %param_1.110 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.110"}
  %param_2.1737 = bf16[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1737"}
  %convert.3940.16 = f32[1,4,8192,2]{3,2,1,0} convert(%param_2.1737), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3940.16"}
  %param_3.1482 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1482"}
  %bitcast.21746.13 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1482), metadata={scheduling_name="bitcast.21746.13"}
  %constant_1862_4 = f32[] constant(-inf)
  %reduce.155.1 = f32[32768]{0} reduce(%param_3.1482, %constant_1862_4), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.155.1"}
  %bitcast.21753.13 = f32[4,8192]{1,0} bitcast(%reduce.155.1), metadata={scheduling_name="bitcast.21753.13"}
  %broadcast.5599.13 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21753.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5599.13"}
  %subtract.251.13 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.21746.13, %broadcast.5599.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.251.13"}
  %exponential.93.11 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.251.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.93.11"}
  %bitcast.21761.5 = f32[4,8192,2]{2,1,0} bitcast(%exponential.93.11), metadata={scheduling_name="bitcast.21761.5"}
  %constant_1694_7 = f32[] constant(0)
  %reduce.406.5 = f32[4,8192]{1,0} reduce(%bitcast.21761.5, %constant_1694_7), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.406.5"}
  %broadcast.5600.16 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.406.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5600.16"}
  %divide.461.9 = f32[1,4,8192,2]{3,2,1,0} divide(%convert.3940.16, %broadcast.5600.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.461.9"}
  %constant_2054_2 = f32[] constant(1)
  %broadcast.5620.12 = f32[1,4,8192]{2,1,0} broadcast(%constant_2054_2), dimensions={}, metadata={scheduling_name="broadcast.5620.12"}
  %bitcast.22183.5 = f32[1,4,8192]{2,1,0} bitcast(%reduce.406.5), metadata={scheduling_name="bitcast.22183.5"}
  %multiply.2597.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22183.5, %bitcast.22183.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2597.5"}
  %divide.462.7 = f32[1,4,8192]{2,1,0} divide(%broadcast.5620.12, %multiply.2597.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.462.7"}
  %bitcast.22187.7 = f32[4,8192]{1,0} bitcast(%divide.462.7), metadata={scheduling_name="bitcast.22187.7"}
  %broadcast.5621.7 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22187.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5621.7"}
  %multiply.2598.9 = f32[1,4,8192,2]{3,2,1,0} multiply(%convert.3940.16, %broadcast.5621.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2598.9"}
  %multiply.2599.7 = f32[1,4,8192,2]{3,2,1,0} multiply(%multiply.2598.9, %exponential.93.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2599.7"}
  %bitcast.22195.5 = f32[4,8192,2]{2,1,0} bitcast(%multiply.2599.7), metadata={scheduling_name="bitcast.22195.5"}
  %reduce.411.5 = f32[4,8192]{1,0} reduce(%bitcast.22195.5, %constant_1694_7), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.411.5"}
  %bitcast.22200.3 = f32[1,4,8192]{2,1,0} bitcast(%reduce.411.5), metadata={scheduling_name="bitcast.22200.3"}
  %negate.215.3 = f32[1,4,8192]{2,1,0} negate(%bitcast.22200.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="negate.215.3"}
  %bitcast.22203.5 = f32[4,8192]{1,0} bitcast(%negate.215.3), metadata={scheduling_name="bitcast.22203.5"}
  %broadcast.5622.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.22203.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5622.5"}
  %add.3002.7 = f32[1,4,8192,2]{3,2,1,0} add(%divide.461.9, %broadcast.5622.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="add.3002.7"}
  %multiply.2600.5 = f32[1,4,8192,2]{3,2,1,0} multiply(%add.3002.7, %exponential.93.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="multiply.2600.5"}
  %convert.3941.3 = bf16[1,4,8192,2]{3,2,1,0} convert(%multiply.2600.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3941.3"}
  %bitcast.22209.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%convert.3941.3), metadata={scheduling_name="bitcast.22209.1"}
  ROOT %scatter.214.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.276, %param_1.110, %bitcast.22209.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="scatter.214.1"}
}

%fused_transpose.12 (param_0.2366: bf16[4,8192,16384]) -> bf16[4,16392,8192] {
  %param_0.2366 = bf16[4,8192,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2366"}
  %bitcast.22124.3 = bf16[1,4,8192,8,2048]{4,3,2,1,0} bitcast(%param_0.2366), metadata={scheduling_name="bitcast.22124.3"}
  %constant_1658_8 = bf16[] constant(0)
  %pad.351.3 = bf16[1,4,8192,8,2049]{4,3,2,1,0} pad(%bitcast.22124.3, %constant_1658_8), padding=0_0x0_0x0_0x0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="pad.351.3"}
  %bitcast.22129.1 = bf16[4,8192,16392]{2,1,0} bitcast(%pad.351.3), metadata={scheduling_name="bitcast.22129.1"}
  ROOT %transpose.745.1 = bf16[4,16392,8192]{2,1,0} transpose(%bitcast.22129.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.745.1"}
}

%fused_transpose.13 (param_0.299: bf16[1,1,1,8,4,2048,6144]) -> bf16[4,6144,8,2048] {
  %param_0.299 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.299"}
  %bitcast.22117.1 = bf16[8,4,2048,6144]{3,2,1,0} bitcast(%param_0.299), metadata={scheduling_name="bitcast.22117.1"}
  ROOT %transpose.744.1 = bf16[4,6144,8,2048]{3,2,1,0} transpose(%bitcast.22117.1), dimensions={1,3,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.744.1"}
}

%fused_transpose.14 (param_0.1640: s32[32768,2], param_1.6471: u32[32], param_2.4718: u32[], param_3.3917: s32[32]) -> (s32[65536,4], s32[65536,4]) {
  %constant_1668_2 = s32[] constant(0)
  %broadcast.5576.4 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%constant_1668_2), dimensions={}, metadata={scheduling_name="broadcast.5576.4"}
  %iota.381.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={scheduling_name="iota.381.1"}
  %iota.382.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={scheduling_name="iota.382.1"}
  %param_0.1640 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1640"}
  %bitcast.22065.3 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.1640), metadata={scheduling_name="bitcast.22065.3"}
  %concatenate.706.3 = s32[1,4,4,8192,2]{4,3,2,1,0} concatenate(%broadcast.5576.4, %iota.381.1, %iota.382.1, %bitcast.22065.3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="concatenate.706.3"}
  %bitcast.22068.1 = s32[4,65536]{1,0} bitcast(%concatenate.706.3), metadata={scheduling_name="bitcast.22068.1"}
  %transpose.743.1 = s32[65536,4]{1,0} transpose(%bitcast.22068.1), dimensions={1,0}, metadata={scheduling_name="transpose.743.1"}
  %iota.373.22.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.22.clone.1"}
  %param_3.3917 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.3917"}
  %param_2.4718 = u32[] parameter(2), metadata={scheduling_name="param_2.4718"}
  %dynamic-slice.1492.3.clone.1 = s32[1]{0} dynamic-slice(%param_3.3917, %param_2.4718), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.3.clone.1"}
  %constant_5149_5_clone_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.3.clone.1 = s32[1]{0} multiply(%dynamic-slice.1492.3.clone.1, %constant_5149_5_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.3.clone.1"}
  %bitcast.21421.26.clone.1 = s32[] bitcast(%multiply.2575.3.clone.1), metadata={scheduling_name="bitcast.21421.26.clone.1"}
  %broadcast.5583.25.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.26.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.25.clone.1"}
  %add.2989.22.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.22.clone.1, %broadcast.5583.25.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.22.clone.1"}
  %iota.375.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.1.clone.1"}
  %bitcast.21702.39.clone.1 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_0.1640), metadata={scheduling_name="bitcast.21702.39.clone.1"}
  %broadcast.5584.26.clone.1 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_2), dimensions={}, metadata={scheduling_name="broadcast.5584.26.clone.1"}
  %compare.1628.13.clone.1 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21702.39.clone.1, %broadcast.5584.26.clone.1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.13.clone.1"}
  %constant_1660_1_clone_1 = s32[] constant(8)
  %broadcast.5585.22.clone.1 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_1_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5585.22.clone.1"}
  %add.2996.13.clone.1 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21702.39.clone.1, %broadcast.5585.22.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2996.13.clone.1"}
  %select.1277.13.clone.1 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.13.clone.1, %add.2996.13.clone.1, %bitcast.21702.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1277.13.clone.1"}
  %bitcast.21715.11.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1277.13.clone.1), metadata={scheduling_name="bitcast.21715.11.clone.1"}
  %concatenate.705.11.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.22.clone.1, %iota.375.1.clone.1, %bitcast.21715.11.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.11.clone.1"}
  %constant_5496_2_clone_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_1.6471 = u32[32]{0} parameter(1), metadata={scheduling_name="param_1.6471"}
  %dynamic-slice.1493.3.clone.1 = u32[1]{0} dynamic-slice(%param_1.6471, %param_2.4718), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.3.clone.1"}
  %constant_5497_2_clone_1 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.3.clone.1 = u32[1]{0} clamp(%constant_5496_2_clone_1, %dynamic-slice.1493.3.clone.1, %constant_5497_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.3.clone.1"}
  %convert.3895.3.clone.1 = s32[1]{0} convert(%clamp.26.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.3.clone.1"}
  %multiply.2578.3.clone.1 = s32[1]{0} multiply(%convert.3895.3.clone.1, %constant_5149_5_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.3.clone.1"}
  %constant_2166_5_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.6.clone.1 = s32[3]{0} concatenate(%multiply.2578.3.clone.1, %constant_2166_5_clone_1, %constant_2166_5_clone_1), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.6.clone.1"}
  %broadcast.5586.12.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.6.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.12.clone.1"}
  %subtract.250.5.clone.1 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.11.clone.1, %broadcast.5586.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.5.clone.1"}
  %pad.348.1.clone.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.5.clone.1, %constant_1668_2), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.1.clone.1"}
  %bitcast.21722.1.clone.1 = s32[4,65536]{1,0} bitcast(%pad.348.1.clone.1), metadata={scheduling_name="bitcast.21722.1.clone.1"}
  %transpose.735.1.clone.1 = s32[65536,4]{1,0} transpose(%bitcast.21722.1.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.735.1.clone.1"}
  ROOT %tuple.496 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) tuple(%transpose.743.1, %transpose.735.1.clone.1), metadata={scheduling_name="tuple.496"}
}

%fused_transpose.15 (param_0.307: bf16[1,1,8,4,1,2048,6144]) -> bf16[4,8,12582912] {
  %param_0.307 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.307"}
  %bitcast.22050.1 = bf16[8,4,12582912]{2,1,0} bitcast(%param_0.307), metadata={scheduling_name="bitcast.22050.1"}
  ROOT %transpose.742.1 = bf16[4,8,12582912]{2,1,0} transpose(%bitcast.22050.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.742.1"}
}

%fused_transpose.16 (param_0.313: bf16[1,1,4,6144,8,1,2048]) -> bf16[32,2048,6144] {
  %param_0.313 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} parameter(0), metadata={scheduling_name="param_0.313"}
  %bitcast.21967.1 = bf16[32,6144,2048]{2,1,0} bitcast(%param_0.313), metadata={scheduling_name="bitcast.21967.1"}
  ROOT %transpose.741.1 = bf16[32,2048,6144]{2,1,0} transpose(%bitcast.21967.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.741.1"}
}

%fused_transpose.17 (param_0.315: bf16[4,6144,16384]) -> bf16[8,24576,2048] {
  %param_0.315 = bf16[4,6144,16384]{2,1,0} parameter(0), metadata={scheduling_name="param_0.315"}
  %bitcast.21960.1 = bf16[24576,8,2048]{2,1,0} bitcast(%param_0.315), metadata={scheduling_name="bitcast.21960.1"}
  ROOT %transpose.740.1 = bf16[8,24576,2048]{2,1,0} transpose(%bitcast.21960.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="transpose.740.1"}
}

%fused_transpose.18 (param_0.321: bf16[4,16384,6144]) -> bf16[8,4,12582912] {
  %param_0.321 = bf16[4,16384,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.321"}
  %bitcast.21910.1 = bf16[4,8,12582912]{2,1,0} bitcast(%param_0.321), metadata={scheduling_name="bitcast.21910.1"}
  ROOT %transpose.738.1 = bf16[8,4,12582912]{2,1,0} transpose(%bitcast.21910.1), dimensions={1,0,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.738.1"}
}

%fused_multiply_transpose.3 (param_0.338: s32[4,8,8192], param_1.127: s32[4,8,8192], param_2.4713: bf16[1,4,8192,8]) -> (s32[1,4,8,8192], bf16[1,4,8,8192]) {
  %param_0.338 = s32[4,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.338"}
  %bitcast.21877.1 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_0.338), metadata={scheduling_name="bitcast.21877.1"}
  %param_1.127 = s32[4,8,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.127"}
  %bitcast.21855.2 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_1.127), metadata={scheduling_name="bitcast.21855.2"}
  %multiply.2585.1 = s32[1,4,8,8192]{3,2,1,0} multiply(%bitcast.21877.1, %bitcast.21855.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="multiply.2585.1"}
  %param_2.4713 = bf16[1,4,8192,8]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4713"}
  %bitcast.21776.3.clone.1 = bf16[4,8192,8]{2,1,0} bitcast(%param_2.4713), metadata={scheduling_name="bitcast.21776.3.clone.1"}
  %transpose.736.3.clone.1 = bf16[4,8,8192]{2,1,0} transpose(%bitcast.21776.3.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="transpose.736.3.clone.1"}
  %bitcast.21779.5.clone.1 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%transpose.736.3.clone.1), metadata={scheduling_name="bitcast.21779.5.clone.1"}
  %convert.3906.5.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21779.5.clone.1), metadata={scheduling_name="convert.3906.5.clone.1"}
  %convert.3908.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21855.2), metadata={scheduling_name="convert.3908.3.clone.1"}
  %multiply.2583.3.clone.1 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3906.5.clone.1, %convert.3908.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2583.3.clone.1"}
  %convert.3909.1.clone.1 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2583.3.clone.1), metadata={scheduling_name="convert.3909.1.clone.1"}
  ROOT %tuple.494 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) tuple(%multiply.2585.1, %convert.3909.1.clone.1), metadata={scheduling_name="tuple.494"}
}

%fused_reduce.10 (param_0.2385: pred[1,4,8,8192,2], param_1.2542: s32[1,4,8,64,16], param_2.1885: s32[1,4,8,4,16]) -> (s32[4,8,8192], s32[4,8,8192]) {
  %param_0.2385 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2385"}
  %convert.3907.17 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2385), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3907.17"}
  %bitcast.21790.11 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3907.17), metadata={scheduling_name="bitcast.21790.11"}
  %constant_1668_101 = s32[] constant(0)
  %reduce-window.160.11 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.21790.11, %constant_1668_101), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.160.11"}
  %param_1.2542 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2542"}
  %param_2.1885 = s32[1,4,8,4,16]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1885"}
  %slice.2383.7 = s32[1,4,8,4,1]{4,3,2,1,0} slice(%param_2.1885), slice={[0:1], [0:4], [0:8], [0:4], [15:16]}, metadata={scheduling_name="slice.2383.7"}
  %bitcast.21814.9 = s32[1,4,8,4]{3,2,1,0} bitcast(%slice.2383.7), metadata={scheduling_name="bitcast.21814.9"}
  %reduce-window.163.9 = s32[1,4,8,5]{3,2,1,0} reduce-window(%bitcast.21814.9, %constant_1668_101), window={size=1x1x1x4 pad=0_0x0_0x0_0x4_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.163.9"}
  %slice.2384.7 = s32[1,4,8,4]{3,2,1,0} slice(%reduce-window.163.9), slice={[0:1], [0:4], [0:8], [0:4]}, metadata={scheduling_name="slice.2384.7"}
  %bitcast.21820.9 = s32[4,8,4]{2,1,0} bitcast(%slice.2384.7), metadata={scheduling_name="bitcast.21820.9"}
  %broadcast.5603.9 = s32[1,4,8,4,16]{4,3,2,1,0} broadcast(%bitcast.21820.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5603.9"}
  %add.2997.7 = s32[1,4,8,4,16]{4,3,2,1,0} add(%param_2.1885, %broadcast.5603.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2997.7"}
  %bitcast.21824.7 = s32[1,4,8,64]{3,2,1,0} bitcast(%add.2997.7), metadata={scheduling_name="bitcast.21824.7"}
  %pad.349.7 = s32[1,4,8,65]{3,2,1,0} pad(%bitcast.21824.7, %constant_1668_101), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.349.7"}
  %slice.2385.5 = s32[1,4,8,64]{3,2,1,0} slice(%pad.349.7), slice={[0:1], [0:4], [0:8], [0:64]}, metadata={scheduling_name="slice.2385.5"}
  %bitcast.21828.9 = s32[4,8,64]{2,1,0} bitcast(%slice.2385.5), metadata={scheduling_name="bitcast.21828.9"}
  %broadcast.5604.9 = s32[1,4,8,64,16]{4,3,2,1,0} broadcast(%bitcast.21828.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5604.9"}
  %add.2998.7 = s32[1,4,8,64,16]{4,3,2,1,0} add(%param_1.2542, %broadcast.5604.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2998.7"}
  %bitcast.21832.5 = s32[1,4,8,1024]{3,2,1,0} bitcast(%add.2998.7), metadata={scheduling_name="bitcast.21832.5"}
  %pad.350.5 = s32[1,4,8,1025]{3,2,1,0} pad(%bitcast.21832.5, %constant_1668_101), padding=0_0x0_0x0_0x1_0, metadata={scheduling_name="pad.350.5"}
  %slice.2386.1 = s32[1,4,8,1024]{3,2,1,0} slice(%pad.350.5), slice={[0:1], [0:4], [0:8], [0:1024]}, metadata={scheduling_name="slice.2386.1"}
  %bitcast.21836.9 = s32[4,8,1024]{2,1,0} bitcast(%slice.2386.1), metadata={scheduling_name="bitcast.21836.9"}
  %broadcast.5605.9 = s32[1,4,8,1024,16]{4,3,2,1,0} broadcast(%bitcast.21836.9), dimensions={1,2,3}, metadata={scheduling_name="broadcast.5605.9"}
  %add.2999.7 = s32[1,4,8,1024,16]{4,3,2,1,0} add(%reduce-window.160.11, %broadcast.5605.9), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(cumsum)/reduce_window_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1140 scheduling_name="add.2999.7"}
  %bitcast.21840.6 = s32[1,4,8,16384]{3,2,1,0} bitcast(%add.2999.7), metadata={scheduling_name="bitcast.21840.6"}
  %constant_1884_2 = s32[] constant(2048)
  %broadcast.5606.4 = s32[1,4,8,16384]{3,2,1,0} broadcast(%constant_1884_2), dimensions={}, metadata={scheduling_name="broadcast.5606.4"}
  %compare.1631.3 = pred[1,4,8,16384]{3,2,1,0} compare(%bitcast.21840.6, %broadcast.5606.4), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="compare.1631.3"}
  %bitcast.21845.3 = pred[1,4,8,8192,2]{4,3,2,1,0} bitcast(%compare.1631.3), metadata={scheduling_name="bitcast.21845.3"}
  %broadcast.5607.4 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%constant_1668_101), dimensions={}, metadata={scheduling_name="broadcast.5607.4"}
  %select.1279.3 = s32[1,4,8,8192,2]{4,3,2,1,0} select(%bitcast.21845.3, %convert.3907.17, %broadcast.5607.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1149 scheduling_name="select.1279.3"}
  %bitcast.21852.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%select.1279.3), metadata={scheduling_name="bitcast.21852.1"}
  %reduce.498.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.21852.1, %constant_1668_101), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.498.1"}
  %bitcast.21866.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} bitcast(%convert.3907.17), metadata={scheduling_name="bitcast.21866.3.clone.1"}
  %multiply.2584.3.clone.1 = s32[1,4,8,16384]{3,2,1,0} multiply(%bitcast.21866.3.clone.1, %bitcast.21840.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1155 scheduling_name="multiply.2584.3.clone.1"}
  %bitcast.21872.1.clone.1 = s32[4,8,8192,2]{3,2,1,0} bitcast(%multiply.2584.3.clone.1), metadata={scheduling_name="bitcast.21872.1.clone.1"}
  %reduce.499.1.clone.1 = s32[4,8,8192]{2,1,0} reduce(%bitcast.21872.1.clone.1, %constant_1668_101), dimensions={3}, to_apply=%region_7.620, metadata={scheduling_name="reduce.499.1.clone.1"}
  ROOT %tuple.495 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) tuple(%reduce.498.1, %reduce.499.1.clone.1), metadata={scheduling_name="tuple.495"}
}

%fused_reduce_window.6 (param_0.2375: s32[1,4,8,64,16]) -> s32[1,4,8,4,16] {
  %param_0.2375 = s32[1,4,8,64,16]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2375"}
  %slice.2382.1 = s32[1,4,8,64,1]{4,3,2,1,0} slice(%param_0.2375), slice={[0:1], [0:4], [0:8], [0:64], [15:16]}, metadata={scheduling_name="slice.2382.1"}
  %bitcast.21806.1 = s32[1,4,8,4,16]{4,3,2,1,0} bitcast(%slice.2382.1), metadata={scheduling_name="bitcast.21806.1"}
  %constant_1668_27 = s32[] constant(0)
  ROOT %reduce-window.162.1 = s32[1,4,8,4,16]{4,3,2,1,0} reduce-window(%bitcast.21806.1, %constant_1668_27), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.162.1"}
}

%fused_reduce_window.7 (param_0.2377: s32[1,4,8,1024,1]) -> s32[1,4,8,64,16] {
  %param_0.2377 = s32[1,4,8,1024,1]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2377"}
  %bitcast.21798.1 = s32[1,4,8,64,16]{4,3,2,1,0} bitcast(%param_0.2377), metadata={scheduling_name="bitcast.21798.1"}
  %constant_1668_38 = s32[] constant(0)
  ROOT %reduce-window.161.1 = s32[1,4,8,64,16]{4,3,2,1,0} reduce-window(%bitcast.21798.1, %constant_1668_38), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.161.1"}
}

%fused_scatter.7 (param_0.370: bf16[1,4,8192,8], param_1.147: s32[65536,4], param_2.1185: pred[1,4,8192,2], param_3.1363: f32[32768,2]) -> bf16[1,4,8192,8] {
  %param_0.370 = bf16[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.370"}
  %param_1.147 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.147"}
  %param_2.1185 = pred[1,4,8192,2]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1185"}
  %param_3.1363 = f32[32768,2]{1,0} parameter(3), metadata={scheduling_name="param_3.1363"}
  %bitcast.21746.5 = f32[1,4,8192,2]{3,2,1,0} bitcast(%param_3.1363), metadata={scheduling_name="bitcast.21746.5"}
  %constant_1862_2 = f32[] constant(-inf)
  %reduce.155.2 = f32[32768]{0} reduce(%param_3.1363, %constant_1862_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_max" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.155.2"}
  %bitcast.21753.5 = f32[4,8192]{1,0} bitcast(%reduce.155.2), metadata={scheduling_name="bitcast.21753.5"}
  %broadcast.5599.5 = f32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21753.5), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5599.5"}
  %subtract.251.5 = f32[1,4,8192,2]{3,2,1,0} subtract(%bitcast.21746.5, %broadcast.5599.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="subtract.251.5"}
  %exponential.93.3 = f32[1,4,8192,2]{3,2,1,0} exponential(%subtract.251.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="exponential.93.3"}
  %bitcast.21761.3 = f32[4,8192,2]{2,1,0} bitcast(%exponential.93.3), metadata={scheduling_name="bitcast.21761.3"}
  %constant_1694_6 = f32[] constant(0)
  %reduce.406.3 = f32[4,8192]{1,0} reduce(%bitcast.21761.3, %constant_1694_6), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="reduce.406.3"}
  %broadcast.5600.14 = f32[1,4,8192,2]{3,2,1,0} broadcast(%reduce.406.3), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="broadcast.5600.14"}
  %divide.459.7 = f32[1,4,8192,2]{3,2,1,0} divide(%exponential.93.3, %broadcast.5600.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="divide.459.7"}
  %convert.3905.5 = bf16[1,4,8192,2]{3,2,1,0} convert(%divide.459.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="convert.3905.5"}
  %constant_1658_45 = bf16[] constant(0)
  %broadcast.5601.14 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1658_45), dimensions={}, metadata={scheduling_name="broadcast.5601.14"}
  %select.1278.3 = bf16[1,4,8192,2]{3,2,1,0} select(%param_2.1185, %convert.3905.5, %broadcast.5601.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1278.3"}
  %bitcast.21773.1 = bf16[65536,1,1,1,1]{4,3,2,1,0} bitcast(%select.1278.3), metadata={scheduling_name="bitcast.21773.1"}
  ROOT %scatter.213.1 = bf16[1,4,8192,8]{3,2,1,0} scatter(%param_0.370, %param_1.147, %bitcast.21773.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.213.1"}
}

%fused_compare.5 (param_0.1992: u32[1,4,8192,8], param_1.2556: s32[32768,2], param_2.2047: u32[32], param_3.1691: u32[], param_4.1459: s32[32], param_5.1327: s32[32]) -> pred[1,4,8192,2] {
  %iota.370.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.11"}
  %iota.371.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.9"}
  %constant_1716_3 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5577.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1716_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5577.9"}
  %multiply.2574.9 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.9, %broadcast.5577.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2574.9"}
  %add.2984.11 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.11, %multiply.2574.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.11"}
  %iota.372.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.9"}
  %param_5.1327 = s32[32]{0} parameter(5), metadata={scheduling_name="param_5.1327"}
  %param_3.1691 = u32[] parameter(3), metadata={scheduling_name="param_3.1691"}
  %dynamic-slice.1492.13 = s32[1]{0} dynamic-slice(%param_5.1327, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.13"}
  %constant_5149_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.13 = s32[1]{0} multiply(%dynamic-slice.1492.13, %constant_5149_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.13"}
  %bitcast.21421.56 = s32[] bitcast(%multiply.2575.13), metadata={scheduling_name="bitcast.21421.56"}
  %convert.3893.7 = u32[] convert(%bitcast.21421.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.7"}
  %broadcast.5578.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3893.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5578.9"}
  %add.2985.9 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.9, %broadcast.5578.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2985.9"}
  %constant_1722_3 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5579.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1722_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5579.9"}
  %multiply.2576.9 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2985.9, %broadcast.5579.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2576.9"}
  %add.2986.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2984.11, %multiply.2576.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2986.9"}
  %param_4.1459 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1459"}
  %dynamic-slice.1485.179 = s32[1]{0} dynamic-slice(%param_4.1459, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.179"}
  %convert.3894.7 = u32[1]{0} convert(%dynamic-slice.1485.179), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3894.7"}
  %constant_5365_4 = u32[1]{0} constant({1048576}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2577.7 = u32[1]{0} multiply(%convert.3894.7, %constant_5365_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2577.7"}
  %bitcast.21435.9 = u32[] bitcast(%multiply.2577.7), metadata={scheduling_name="bitcast.21435.9"}
  %broadcast.5580.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21435.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5580.9"}
  %add.2987.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2986.9, %broadcast.5580.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2987.7"}
  %constant_1729_3 = u32[] constant(1)
  %broadcast.5581.5 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1729_3), dimensions={}, metadata={scheduling_name="broadcast.5581.5"}
  %add.2988.5 = u32[1,4,8192,2]{3,2,1,0} add(%add.2987.7, %broadcast.5581.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2988.5"}
  %param_0.1992 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1992"}
  %iota.373.20 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.20"}
  %broadcast.5583.23 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.56), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.23"}
  %add.2989.20 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.20, %broadcast.5583.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.20"}
  %iota.375.5 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.5"}
  %param_1.2556 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2556"}
  %bitcast.21702.33 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2556), metadata={scheduling_name="bitcast.21702.33"}
  %constant_1668_105 = s32[] constant(0)
  %broadcast.5584.24 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_105), dimensions={}, metadata={scheduling_name="broadcast.5584.24"}
  %compare.1628.11 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21702.33, %broadcast.5584.24), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.11"}
  %constant_1660_6 = s32[] constant(8)
  %broadcast.5585.20 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_6), dimensions={}, metadata={scheduling_name="broadcast.5585.20"}
  %add.2996.11 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21702.33, %broadcast.5585.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2996.11"}
  %select.1277.11 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.11, %add.2996.11, %bitcast.21702.33), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1277.11"}
  %bitcast.21715.9 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1277.11), metadata={scheduling_name="bitcast.21715.9"}
  %concatenate.705.9 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.20, %iota.375.5, %bitcast.21715.9), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.9"}
  %constant_5496_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_2.2047 = u32[32]{0} parameter(2), metadata={scheduling_name="param_2.2047"}
  %dynamic-slice.1493.13 = u32[1]{0} dynamic-slice(%param_2.2047, %param_3.1691), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.13"}
  %constant_5497_1 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.13 = u32[1]{0} clamp(%constant_5496_1, %dynamic-slice.1493.13, %constant_5497_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.13"}
  %convert.3895.13 = s32[1]{0} convert(%clamp.26.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.13"}
  %multiply.2578.13 = s32[1]{0} multiply(%convert.3895.13, %constant_5149_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.13"}
  %constant_2166_8 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.5 = s32[3]{0} concatenate(%multiply.2578.13, %constant_2166_8, %constant_2166_8), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.5"}
  %broadcast.5586.18 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.18"}
  %subtract.250.9 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.9, %broadcast.5586.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.9"}
  %pad.348.5 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.9, %constant_1668_105), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.5"}
  %bitcast.22160.4 = s32[65536,4]{0,1} bitcast(%pad.348.5), metadata={scheduling_name="bitcast.22160.4"}
  %gather.333.3 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_0.1992, %bitcast.22160.4), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.333.3"}
  %bitcast.21741.1 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.333.3), metadata={scheduling_name="bitcast.21741.1"}
  ROOT %compare.1629.1 = pred[1,4,8192,2]{3,2,1,0} compare(%add.2988.5, %bitcast.21741.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1629.1"}
}

%fused_rsqrt.6 (param_0.2399: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2399 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2399"}
  %bitcast.21642.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2399), metadata={scheduling_name="bitcast.21642.7"}
  %constant_1695_3 = f32[] constant(0.000162760422)
  %broadcast.5571.24 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_3), dimensions={}, metadata={scheduling_name="broadcast.5571.24"}
  %multiply.2580.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21642.7, %broadcast.5571.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2580.7"}
  %constant_1696_3 = f32[] constant(1e-05)
  %broadcast.5572.16 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_3), dimensions={}, metadata={scheduling_name="broadcast.5572.16"}
  %add.2995.5 = f32[1,4,8192]{2,1,0} add(%multiply.2580.7, %broadcast.5572.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2995.5"}
  %bitcast.21652.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2995.5), metadata={scheduling_name="bitcast.21652.1"}
  ROOT %rsqrt.96.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.21652.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.96.1"}
}

%fused_reduce.11 (param_0.2393: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.2393 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2393"}
  %bitcast.21630.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2393), metadata={scheduling_name="bitcast.21630.21"}
  %convert.3899.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21630.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3899.21"}
  %multiply.2579.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3899.21, %convert.3899.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2579.3"}
  %bitcast.21637.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2579.3), metadata={scheduling_name="bitcast.21637.1"}
  %constant_1694_5 = f32[] constant(0)
  ROOT %reduce.405.1 = f32[4,8192]{1,0} reduce(%bitcast.21637.1, %constant_1694_5), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.405.1"}
}

%region_51.2293 (Arg_0.2294: pred[], Arg_1.2295: pred[]) -> pred[] {
  %Arg_1.2295 = pred[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" scheduling_name="Arg_1.2295"}
  %Arg_0.2294 = pred[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" scheduling_name="Arg_0.2294"}
  ROOT %and.300.0 = pred[] and(%Arg_0.2294, %Arg_1.2295), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.300.0"}
}

%fused_compare_reduce (param_0.2401: s32[9], param_1.2537: s32[], param_2.4733: s32[3], param_3.3944: s32[32], param_4.2886: u32[], param_5.2683: s32[5]) -> (pred[], pred[], pred[]) {
  %param_0.2401 = s32[9]{0} parameter(0), metadata={scheduling_name="param_0.2401"}
  %constant_1660_28 = s32[] constant(8)
  %param_1.2537 = s32[] parameter(1), metadata={scheduling_name="param_1.2537"}
  %subtract.247.21 = s32[] subtract(%constant_1660_28, %param_1.2537), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.21"}
  %dynamic-slice.1484.1 = s32[1]{0} dynamic-slice(%param_0.2401, %subtract.247.21), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.1"}
  %bitcast.21539.5 = s32[] bitcast(%dynamic-slice.1484.1), metadata={scheduling_name="bitcast.21539.5"}
  %constant_1721_3 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %compare.1653.1 = pred[] compare(%bitcast.21539.5, %constant_1721_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="compare.1653.1"}
  %constant_1668_58_clone_1 = s32[] constant(0)
  %broadcast.5671.5.clone.1 = s32[3]{0} broadcast(%constant_1668_58_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5671.5.clone.1"}
  %param_3.3944 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.3944"}
  %param_4.2886 = u32[] parameter(4), metadata={scheduling_name="param_4.2886"}
  %dynamic-slice.1485.135.clone.1 = s32[1]{0} dynamic-slice(%param_3.3944, %param_4.2886), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.135.clone.1"}
  %subtract.248.130.clone.1 = s32[1]{0} subtract(%dynamic-slice.1484.1, %dynamic-slice.1485.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.130.clone.1"}
  %constant_2166_20_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.130.clone.1 = s32[1]{0} maximum(%subtract.248.130.clone.1, %constant_2166_20_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.130.clone.1"}
  %sign.27.129.clone.1 = s32[1]{0} sign(%maximum.47.130.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.129.clone.1"}
  %constant_5144_14_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.129.clone.1 = pred[1]{0} compare(%sign.27.129.clone.1, %constant_5144_14_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.129.clone.1"}
  %constant_5145_12_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.130.clone.1 = s32[1]{0} and(%maximum.47.130.clone.1, %constant_5145_12_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.130.clone.1"}
  %compare.1615.130.clone.1 = pred[1]{0} compare(%and.301.130.clone.1, %constant_2166_20_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.130.clone.1"}
  %and.302.129.clone.1 = pred[1]{0} and(%compare.1614.129.clone.1, %compare.1615.130.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.129.clone.1"}
  %constant_5146_11_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.129.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.130.clone.1, %constant_5146_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.129.clone.1"}
  %constant_5147_11_clone_1 = s32[1]{0} constant({-1})
  %add.2981.129.clone.1 = s32[1]{0} add(%shift-right-logical.20.129.clone.1, %constant_5147_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.129.clone.1"}
  %select.1269.129.clone.1 = s32[1]{0} select(%and.302.129.clone.1, %add.2981.129.clone.1, %shift-right-logical.20.129.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.129.clone.1"}
  %compare.1616.129.clone.1 = pred[1]{0} compare(%select.1269.129.clone.1, %constant_2166_20_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.129.clone.1"}
  %add.2982.129.clone.1 = s32[1]{0} add(%select.1269.129.clone.1, %constant_5146_11_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.129.clone.1"}
  %select.1270.129.clone.1 = s32[1]{0} select(%compare.1616.129.clone.1, %add.2982.129.clone.1, %select.1269.129.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.129.clone.1"}
  %bitcast.21242.143.clone.1 = s32[1,1]{1,0} bitcast(%select.1270.129.clone.1), metadata={scheduling_name="bitcast.21242.143.clone.1"}
  %pad.345.35.clone.1 = s32[1,2]{1,0} pad(%bitcast.21242.143.clone.1, %constant_1668_58_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.35.clone.1"}
  %pad.346.33.clone.1 = s32[1,3]{1,0} pad(%pad.345.35.clone.1, %constant_1668_58_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.33.clone.1"}
  %bitcast.21349.30.clone.1 = s32[3]{0} bitcast(%pad.346.33.clone.1), metadata={scheduling_name="bitcast.21349.30.clone.1"}
  %slice.2404.5.clone.1 = s32[2]{0} slice(%bitcast.21349.30.clone.1), slice={[1:3]}, metadata={scheduling_name="slice.2404.5.clone.1"}
  %pad.355.10.clone.1 = s32[3]{0} pad(%slice.2404.5.clone.1, %constant_1668_58_clone_1), padding=1_0, metadata={scheduling_name="pad.355.10.clone.1"}
  %compare.1644.5.clone.1 = pred[3]{0} compare(%broadcast.5671.5.clone.1, %pad.355.10.clone.1), direction=LE, metadata={scheduling_name="compare.1644.5.clone.1"}
  %param_2.4733 = s32[3]{0} parameter(2), metadata={scheduling_name="param_2.4733"}
  %compare.1645.5.clone.1 = pred[3]{0} compare(%param_2.4733, %pad.355.10.clone.1), direction=GE, metadata={scheduling_name="compare.1645.5.clone.1"}
  %and.310.3.clone.1 = pred[3]{0} and(%compare.1644.5.clone.1, %compare.1645.5.clone.1), metadata={scheduling_name="and.310.3.clone.1"}
  %constant_1759_3_clone_1 = pred[] constant(true)
  %reduce.302.1.clone.1 = pred[] reduce(%and.310.3.clone.1, %constant_1759_3_clone_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.302.1.clone.1"}
  %broadcast.5664.5.clone.1 = s32[5]{0} broadcast(%constant_1668_58_clone_1), dimensions={}, metadata={scheduling_name="broadcast.5664.5.clone.1"}
  %constant_5148_9_clone_1 = s32[1,1]{1,0} constant({ {0} })
  %concatenate.701.91.clone.1 = s32[1,5]{1,0} concatenate(%constant_5148_9_clone_1, %bitcast.21242.143.clone.1, %constant_5148_9_clone_1, %constant_5148_9_clone_1, %constant_5148_9_clone_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.91.clone.1"}
  %bitcast.21290.92.clone.1 = s32[5]{0} bitcast(%concatenate.701.91.clone.1), metadata={scheduling_name="bitcast.21290.92.clone.1"}
  %slice.2403.7.clone.1 = s32[4]{0} slice(%bitcast.21290.92.clone.1), slice={[1:5]}, metadata={scheduling_name="slice.2403.7.clone.1"}
  %concatenate.711.5.clone.1 = s32[5]{0} concatenate(%constant_2166_20_clone_1, %slice.2403.7.clone.1), dimensions={0}, metadata={scheduling_name="concatenate.711.5.clone.1"}
  %compare.1642.5.clone.1 = pred[5]{0} compare(%broadcast.5664.5.clone.1, %concatenate.711.5.clone.1), direction=LE, metadata={scheduling_name="compare.1642.5.clone.1"}
  %param_5.2683 = s32[5]{0} parameter(5), metadata={scheduling_name="param_5.2683"}
  %compare.1643.3.clone.1 = pred[5]{0} compare(%param_5.2683, %concatenate.711.5.clone.1), direction=GE, metadata={scheduling_name="compare.1643.3.clone.1"}
  %and.309.3.clone.1 = pred[5]{0} and(%compare.1642.5.clone.1, %compare.1643.3.clone.1), metadata={scheduling_name="and.309.3.clone.1"}
  %reduce.299.1.clone.1 = pred[] reduce(%and.309.3.clone.1, %constant_1759_3_clone_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.299.1.clone.1"}
  ROOT %tuple.517 = (pred[], pred[], pred[]) tuple(%compare.1653.1, %reduce.302.1.clone.1, %reduce.299.1.clone.1), metadata={scheduling_name="tuple.517"}
}

%fused_compare.6 (param_0.1990: u32[1,4,8192,8], param_1.2558: s32[32768,2], param_2.2049: u32[32], param_3.1693: u32[], param_4.1460: s32[32], param_5.1328: s32[32]) -> pred[1,4,8192,2] {
  %iota.370.9 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.9"}
  %iota.371.7 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.7"}
  %constant_1716_2 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5577.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1716_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5577.7"}
  %multiply.2574.7 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.7, %broadcast.5577.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2574.7"}
  %add.2984.9 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.9, %multiply.2574.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.9"}
  %iota.372.7 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.7"}
  %param_5.1328 = s32[32]{0} parameter(5), metadata={scheduling_name="param_5.1328"}
  %param_3.1693 = u32[] parameter(3), metadata={scheduling_name="param_3.1693"}
  %dynamic-slice.1492.11 = s32[1]{0} dynamic-slice(%param_5.1328, %param_3.1693), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.11"}
  %constant_5149_6 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.11 = s32[1]{0} multiply(%dynamic-slice.1492.11, %constant_5149_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.11"}
  %bitcast.21421.54 = s32[] bitcast(%multiply.2575.11), metadata={scheduling_name="bitcast.21421.54"}
  %convert.3893.5 = u32[] convert(%bitcast.21421.54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.5"}
  %broadcast.5578.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3893.5), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5578.7"}
  %add.2985.7 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.7, %broadcast.5578.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2985.7"}
  %constant_1722_2 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5579.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1722_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5579.7"}
  %multiply.2576.7 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2985.7, %broadcast.5579.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2576.7"}
  %add.2986.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2984.9, %multiply.2576.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2986.7"}
  %param_4.1460 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1460"}
  %dynamic-slice.1485.177 = s32[1]{0} dynamic-slice(%param_4.1460, %param_3.1693), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.177"}
  %convert.3894.5 = u32[1]{0} convert(%dynamic-slice.1485.177), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3894.5"}
  %constant_5365_3 = u32[1]{0} constant({1048576}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2577.5 = u32[1]{0} multiply(%convert.3894.5, %constant_5365_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2577.5"}
  %bitcast.21435.7 = u32[] bitcast(%multiply.2577.5), metadata={scheduling_name="bitcast.21435.7"}
  %broadcast.5580.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21435.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5580.7"}
  %add.2987.5 = u32[1,4,8192,2]{3,2,1,0} add(%add.2986.7, %broadcast.5580.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2987.5"}
  %constant_1729_2 = u32[] constant(1)
  %broadcast.5581.3 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1729_2), dimensions={}, metadata={scheduling_name="broadcast.5581.3"}
  %add.2988.3 = u32[1,4,8192,2]{3,2,1,0} add(%add.2987.5, %broadcast.5581.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2988.3"}
  %param_0.1990 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1990"}
  %iota.373.6 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.6"}
  %broadcast.5583.9 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.54), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.9"}
  %add.2989.6 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.6, %broadcast.5583.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.6"}
  %iota.374.3 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.3"}
  %param_1.2558 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2558"}
  %bitcast.21452.21 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2558), metadata={scheduling_name="bitcast.21452.21"}
  %constant_1668_10 = s32[] constant(0)
  %broadcast.5584.10 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_10), dimensions={}, metadata={scheduling_name="broadcast.5584.10"}
  %compare.1619.7 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.21, %broadcast.5584.10), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.7"}
  %constant_1660_5 = s32[] constant(8)
  %broadcast.5585.6 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_5), dimensions={}, metadata={scheduling_name="broadcast.5585.6"}
  %add.2990.7 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.21, %broadcast.5585.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2990.7"}
  %select.1271.7 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.7, %add.2990.7, %bitcast.21452.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.7"}
  %bitcast.21465.5 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.7), metadata={scheduling_name="bitcast.21465.5"}
  %concatenate.703.5 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.6, %iota.374.3, %bitcast.21465.5), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.5"}
  %constant_5496_3 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_2.2049 = u32[32]{0} parameter(2), metadata={scheduling_name="param_2.2049"}
  %dynamic-slice.1493.5 = u32[1]{0} dynamic-slice(%param_2.2049, %param_3.1693), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.5"}
  %constant_5497_3 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.5 = u32[1]{0} clamp(%constant_5496_3, %dynamic-slice.1493.5, %constant_5497_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.5"}
  %convert.3895.5 = s32[1]{0} convert(%clamp.26.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.5"}
  %multiply.2578.5 = s32[1]{0} multiply(%convert.3895.5, %constant_5149_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.5"}
  %constant_2166_10 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.1 = s32[3]{0} concatenate(%multiply.2578.5, %constant_2166_10, %constant_2166_10), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.1"}
  %broadcast.5586.16 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.16"}
  %subtract.249.9 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.5, %broadcast.5586.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.9"}
  %pad.347.5 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.9, %constant_1668_10), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.5"}
  %bitcast.22966.4 = s32[65536,4]{0,1} bitcast(%pad.347.5), metadata={scheduling_name="bitcast.22966.4"}
  %gather.329.3 = u32[65536,1,1,1,1]{0,4,3,2,1} gather(%param_0.1990, %bitcast.22966.4), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.329.3"}
  %bitcast.21499.1 = u32[1,4,8192,2]{3,2,1,0} bitcast(%gather.329.3), metadata={scheduling_name="bitcast.21499.1"}
  ROOT %compare.1620.1 = pred[1,4,8192,2]{3,2,1,0} compare(%add.2988.3, %bitcast.21499.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1620.1"}
}

%fused_scatter.8 (param_0.424: u32[1,4,8192,8], param_1.188: s32[65536,4], param_2.2042: s32[32], param_3.1686: u32[], param_4.1454: s32[32]) -> u32[1,4,8192,8] {
  %param_0.424 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.424"}
  %param_1.188 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.188"}
  %iota.370.15 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.15"}
  %iota.371.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.13"}
  %constant_1716_1 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5577.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1716_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5577.13"}
  %multiply.2574.13 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.13, %broadcast.5577.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2574.13"}
  %add.2984.15 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.15, %multiply.2574.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.15"}
  %iota.372.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.13"}
  %param_4.1454 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1454"}
  %param_3.1686 = u32[] parameter(3), metadata={scheduling_name="param_3.1686"}
  %dynamic-slice.1492.17 = s32[1]{0} dynamic-slice(%param_4.1454, %param_3.1686), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.17"}
  %constant_5149_2 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.17 = s32[1]{0} multiply(%dynamic-slice.1492.17, %constant_5149_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.17"}
  %bitcast.21421.52 = s32[] bitcast(%multiply.2575.17), metadata={scheduling_name="bitcast.21421.52"}
  %convert.3893.3 = u32[] convert(%bitcast.21421.52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.3"}
  %broadcast.5578.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3893.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5578.13"}
  %add.2985.13 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.13, %broadcast.5578.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2985.13"}
  %constant_1722_1 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5579.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1722_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5579.13"}
  %multiply.2576.13 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2985.13, %broadcast.5579.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2576.13"}
  %add.2986.13 = u32[1,4,8192,2]{3,2,1,0} add(%add.2984.15, %multiply.2576.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2986.13"}
  %param_2.2042 = s32[32]{0} parameter(2), metadata={scheduling_name="param_2.2042"}
  %dynamic-slice.1485.175 = s32[1]{0} dynamic-slice(%param_2.2042, %param_3.1686), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.175"}
  %convert.3894.3 = u32[1]{0} convert(%dynamic-slice.1485.175), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3894.3"}
  %constant_5365_2 = u32[1]{0} constant({1048576}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2577.3 = u32[1]{0} multiply(%convert.3894.3, %constant_5365_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2577.3"}
  %bitcast.21435.13 = u32[] bitcast(%multiply.2577.3), metadata={scheduling_name="bitcast.21435.13"}
  %broadcast.5580.13 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21435.13), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5580.13"}
  %add.2987.11 = u32[1,4,8192,2]{3,2,1,0} add(%add.2986.13, %broadcast.5580.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2987.11"}
  %constant_1729_1 = u32[] constant(1)
  %broadcast.5581.9 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1729_1), dimensions={}, metadata={scheduling_name="broadcast.5581.9"}
  %add.2988.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2987.11, %broadcast.5581.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2988.9"}
  %bitcast.21490.1 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%add.2988.9), metadata={scheduling_name="bitcast.21490.1"}
  ROOT %scatter.211.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.424, %param_1.188, %bitcast.21490.1), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.211.1"}
}

%fused_scatter.9 (param_0.425: u32[1,4,8192,8], param_1.189: s32[65536,4], param_2.2041: s32[32], param_3.1685: u32[], param_4.1453: s32[32]) -> u32[1,4,8192,8] {
  %param_0.425 = u32[1,4,8192,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.425"}
  %param_1.189 = s32[65536,4]{1,0} parameter(1), metadata={scheduling_name="param_1.189"}
  %iota.370.13 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.370.13"}
  %iota.371.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.371.11"}
  %constant_1716_4 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5577.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1716_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5577.11"}
  %multiply.2574.11 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.371.11, %broadcast.5577.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2574.11"}
  %add.2984.13 = u32[1,4,8192,2]{3,2,1,0} add(%iota.370.13, %multiply.2574.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2984.13"}
  %iota.372.11 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.372.11"}
  %param_4.1453 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1453"}
  %param_3.1685 = u32[] parameter(3), metadata={scheduling_name="param_3.1685"}
  %dynamic-slice.1492.5 = s32[1]{0} dynamic-slice(%param_4.1453, %param_3.1685), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.5"}
  %constant_5149_10 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.5 = s32[1]{0} multiply(%dynamic-slice.1492.5, %constant_5149_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.5"}
  %bitcast.21421.58 = s32[] bitcast(%multiply.2575.5), metadata={scheduling_name="bitcast.21421.58"}
  %convert.3893.9 = u32[] convert(%bitcast.21421.58), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3893.9"}
  %broadcast.5578.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.3893.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5578.11"}
  %add.2985.11 = u32[1,4,8192,2]{3,2,1,0} add(%iota.372.11, %broadcast.5578.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2985.11"}
  %constant_1722_4 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5579.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1722_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5579.11"}
  %multiply.2576.11 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.2985.11, %broadcast.5579.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2576.11"}
  %add.2986.11 = u32[1,4,8192,2]{3,2,1,0} add(%add.2984.13, %multiply.2576.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2986.11"}
  %param_2.2041 = s32[32]{0} parameter(2), metadata={scheduling_name="param_2.2041"}
  %dynamic-slice.1485.181 = s32[1]{0} dynamic-slice(%param_2.2041, %param_3.1685), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.181"}
  %convert.3894.9 = u32[1]{0} convert(%dynamic-slice.1485.181), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3894.9"}
  %constant_5365_1 = u32[1]{0} constant({1048576}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2577.9 = u32[1]{0} multiply(%convert.3894.9, %constant_5365_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2577.9"}
  %bitcast.21435.11 = u32[] bitcast(%multiply.2577.9), metadata={scheduling_name="bitcast.21435.11"}
  %broadcast.5580.11 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.21435.11), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5580.11"}
  %add.2987.9 = u32[1,4,8192,2]{3,2,1,0} add(%add.2986.11, %broadcast.5580.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2987.9"}
  %constant_1729_4 = u32[] constant(1)
  %broadcast.5581.7 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1729_4), dimensions={}, metadata={scheduling_name="broadcast.5581.7"}
  %add.2988.7 = u32[1,4,8192,2]{3,2,1,0} add(%add.2987.9, %broadcast.5581.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2988.7"}
  %bitcast.21490.2 = u32[65536,1,1,1,1]{4,3,2,1,0} bitcast(%add.2988.7), metadata={scheduling_name="bitcast.21490.2"}
  ROOT %scatter.212.1 = u32[1,4,8192,8]{3,2,1,0} scatter(%param_0.425, %param_1.189, %bitcast.21490.2), update_window_dims={1,2,3,4}, inserted_window_dims={}, scatter_dims_to_operand_dims={0,1,2,3}, index_vector_dim=1, to_apply=%region_5.601, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="scatter.212.1"}
}

%fused_transpose.19 (param_0.2410: s32[32768,2], param_1.2624: u32[32], param_2.2050: u32[], param_3.1694: s32[32]) -> (s32[65536,4], s32[65536,4]) {
  %iota.373.12 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.12"}
  %param_3.1694 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.1694"}
  %param_2.2050 = u32[] parameter(2), metadata={scheduling_name="param_2.2050"}
  %dynamic-slice.1492.7 = s32[1]{0} dynamic-slice(%param_3.1694, %param_2.2050), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.7"}
  %constant_5149_9 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.7 = s32[1]{0} multiply(%dynamic-slice.1492.7, %constant_5149_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.7"}
  %bitcast.21421.16 = s32[] bitcast(%multiply.2575.7), metadata={scheduling_name="bitcast.21421.16"}
  %broadcast.5583.15 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.16), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.15"}
  %add.2989.12 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.12, %broadcast.5583.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.12"}
  %iota.374.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.1"}
  %param_0.2410 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.2410"}
  %bitcast.21452.39 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_0.2410), metadata={scheduling_name="bitcast.21452.39"}
  %constant_1668_37 = s32[] constant(0)
  %broadcast.5584.16 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_37), dimensions={}, metadata={scheduling_name="broadcast.5584.16"}
  %compare.1619.13 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.39, %broadcast.5584.16), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.13"}
  %constant_1660_3 = s32[] constant(8)
  %broadcast.5585.12 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_3), dimensions={}, metadata={scheduling_name="broadcast.5585.12"}
  %add.2990.13 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.39, %broadcast.5585.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2990.13"}
  %select.1271.13 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.13, %add.2990.13, %bitcast.21452.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.13"}
  %bitcast.21465.11 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.13), metadata={scheduling_name="bitcast.21465.11"}
  %concatenate.703.11 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.12, %iota.374.1, %bitcast.21465.11), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.11"}
  %constant_5496_6 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_1.2624 = u32[32]{0} parameter(1), metadata={scheduling_name="param_1.2624"}
  %dynamic-slice.1493.11 = u32[1]{0} dynamic-slice(%param_1.2624, %param_2.2050), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.11"}
  %constant_5497_6 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.11 = u32[1]{0} clamp(%constant_5496_6, %dynamic-slice.1493.11, %constant_5497_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.11"}
  %convert.3895.11 = s32[1]{0} convert(%clamp.26.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.11"}
  %multiply.2578.11 = s32[1]{0} multiply(%convert.3895.11, %constant_5149_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.11"}
  %constant_2166_4 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.4 = s32[3]{0} concatenate(%multiply.2578.11, %constant_2166_4, %constant_2166_4), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.4"}
  %broadcast.5586.6 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.4), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.6"}
  %subtract.249.5 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.11, %broadcast.5586.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.5"}
  %pad.347.1 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.5, %constant_1668_37), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.1"}
  %bitcast.21485.1 = s32[4,65536]{1,0} bitcast(%pad.347.1), metadata={scheduling_name="bitcast.21485.1"}
  %transpose.734.1 = s32[65536,4]{1,0} transpose(%bitcast.21485.1), dimensions={1,0}, metadata={scheduling_name="transpose.734.1"}
  %broadcast.5576.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%constant_1668_37), dimensions={}, metadata={scheduling_name="broadcast.5576.1.clone.1"}
  %iota.366.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={scheduling_name="iota.366.1.clone.1"}
  %iota.367.1.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={scheduling_name="iota.367.1.clone.1"}
  %bitcast.21402.3.clone.1 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%param_0.2410), metadata={scheduling_name="bitcast.21402.3.clone.1"}
  %concatenate.702.3.clone.1 = s32[1,4,4,8192,2]{4,3,2,1,0} concatenate(%broadcast.5576.1.clone.1, %iota.366.1.clone.1, %iota.367.1.clone.1, %bitcast.21402.3.clone.1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="concatenate.702.3.clone.1"}
  %bitcast.21405.1.clone.1 = s32[4,65536]{1,0} bitcast(%concatenate.702.3.clone.1), metadata={scheduling_name="bitcast.21405.1.clone.1"}
  %transpose.733.1.clone.1 = s32[65536,4]{1,0} transpose(%bitcast.21405.1.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.733.1.clone.1"}
  ROOT %tuple.501 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) tuple(%transpose.734.1, %transpose.733.1.clone.1), metadata={scheduling_name="tuple.501"}
}

%fused_dynamic_update_slice.13 (param_0.450: bf16[2,1,6144], param_1.2475: bf16[1,1,6144], param_2.1825: bf16[6144], param_3.1415: pred[], param_4.1355: s32[32], param_5.1247: u32[], param_6.1228: s32[9], param_7.1157: s32[]) -> bf16[2,1,6144] {
  %param_0.450 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.450"}
  %param_1.2475 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2475"}
  %convert.4045.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2475), metadata={scheduling_name="convert.4045.3"}
  %param_3.1415 = pred[] parameter(3), metadata={scheduling_name="param_3.1415"}
  %broadcast.5672.2 = pred[1,6144]{1,0} broadcast(%param_3.1415), dimensions={}, metadata={scheduling_name="broadcast.5672.2"}
  %param_2.1825 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1825"}
  %bitcast.23304.3 = bf16[1,6144]{1,0} bitcast(%param_2.1825), metadata={scheduling_name="bitcast.23304.3"}
  %constant_1658_48 = bf16[] constant(0)
  %broadcast.5673.1 = bf16[1,6144]{1,0} broadcast(%constant_1658_48), dimensions={}, metadata={scheduling_name="broadcast.5673.1"}
  %select.1292.3 = bf16[1,6144]{1,0} select(%broadcast.5672.2, %bitcast.23304.3, %broadcast.5673.1), metadata={scheduling_name="select.1292.3"}
  %bitcast.23310.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1292.3), metadata={scheduling_name="bitcast.23310.7"}
  %convert.4052.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23310.7), metadata={scheduling_name="convert.4052.7"}
  %add.3030.5 = f32[1,1,6144]{2,1,0} add(%convert.4045.3, %convert.4052.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3030.5"}
  %convert.4053.3 = bf16[1,1,6144]{2,1,0} convert(%add.3030.5), metadata={scheduling_name="convert.4053.3"}
  %param_6.1228 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1228"}
  %constant_1660_52 = s32[] constant(8)
  %param_7.1157 = s32[] parameter(7), metadata={scheduling_name="param_7.1157"}
  %subtract.247.61 = s32[] subtract(%constant_1660_52, %param_7.1157), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.61"}
  %dynamic-slice.1484.42 = s32[1]{0} dynamic-slice(%param_6.1228, %subtract.247.61), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.42"}
  %param_4.1355 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1355"}
  %param_5.1247 = u32[] parameter(5), metadata={scheduling_name="param_5.1247"}
  %dynamic-slice.1485.37 = s32[1]{0} dynamic-slice(%param_4.1355, %param_5.1247), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.37"}
  %subtract.248.32 = s32[1]{0} subtract(%dynamic-slice.1484.42, %dynamic-slice.1485.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.32"}
  %constant_2166_25 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.32 = s32[1]{0} maximum(%subtract.248.32, %constant_2166_25), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.32"}
  %sign.27.31 = s32[1]{0} sign(%maximum.47.32), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.31"}
  %constant_5144_19 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.31 = pred[1]{0} compare(%sign.27.31, %constant_5144_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.31"}
  %constant_5145_17 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.32 = s32[1]{0} and(%maximum.47.32, %constant_5145_17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.32"}
  %compare.1615.32 = pred[1]{0} compare(%and.301.32, %constant_2166_25), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.32"}
  %and.302.31 = pred[1]{0} and(%compare.1614.31, %compare.1615.32), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.31"}
  %constant_5146_16 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.31 = s32[1]{0} shift-right-logical(%maximum.47.32, %constant_5146_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.31"}
  %constant_5147_16 = s32[1]{0} constant({-1})
  %add.2981.31 = s32[1]{0} add(%shift-right-logical.20.31, %constant_5147_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.31"}
  %select.1269.31 = s32[1]{0} select(%and.302.31, %add.2981.31, %shift-right-logical.20.31), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.31"}
  %compare.1616.31 = pred[1]{0} compare(%select.1269.31, %constant_2166_25), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.31"}
  %add.2982.31 = s32[1]{0} add(%select.1269.31, %constant_5146_16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.31"}
  %select.1270.31 = s32[1]{0} select(%compare.1616.31, %add.2982.31, %select.1269.31), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.31"}
  %bitcast.21242.39 = s32[1,1]{1,0} bitcast(%select.1270.31), metadata={scheduling_name="bitcast.21242.39"}
  %constant_1668_60 = s32[] constant(0)
  %pad.345.19 = s32[1,2]{1,0} pad(%bitcast.21242.39, %constant_1668_60), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.19"}
  %pad.346.17 = s32[1,3]{1,0} pad(%pad.345.19, %constant_1668_60), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.17"}
  %bitcast.21349.14 = s32[3]{0} bitcast(%pad.346.17), metadata={scheduling_name="bitcast.21349.14"}
  %slice.2376.11 = s32[1]{0} slice(%bitcast.21349.14), slice={[1:2]}, metadata={scheduling_name="slice.2376.11"}
  %bitcast.24050.4 = s32[] bitcast(%slice.2376.11), metadata={scheduling_name="bitcast.24050.4"}
  ROOT %dynamic-update-slice.398.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.450, %convert.4053.3, %bitcast.24050.4, %constant_1668_60, %constant_1668_60), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.398.1"}
}

%fused_dynamic_update_slice.14 (param_0.452: bf16[2,1,6144], param_1.2467: bf16[1,1,6144], param_2.1816: bf16[6144], param_3.1406: pred[], param_4.1357: s32[32], param_5.1249: u32[], param_6.1230: s32[9], param_7.1158: s32[]) -> bf16[2,1,6144] {
  %param_0.452 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.452"}
  %param_1.2467 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2467"}
  %convert.4054.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2467), metadata={scheduling_name="convert.4054.3"}
  %param_3.1406 = pred[] parameter(3), metadata={scheduling_name="param_3.1406"}
  %broadcast.5672.1 = pred[1,6144]{1,0} broadcast(%param_3.1406), dimensions={}, metadata={scheduling_name="broadcast.5672.1"}
  %param_2.1816 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1816"}
  %bitcast.23710.3 = bf16[1,6144]{1,0} bitcast(%param_2.1816), metadata={scheduling_name="bitcast.23710.3"}
  %constant_1658_49 = bf16[] constant(0)
  %broadcast.5673.2 = bf16[1,6144]{1,0} broadcast(%constant_1658_49), dimensions={}, metadata={scheduling_name="broadcast.5673.2"}
  %select.1293.3 = bf16[1,6144]{1,0} select(%broadcast.5672.1, %bitcast.23710.3, %broadcast.5673.2), metadata={scheduling_name="select.1293.3"}
  %bitcast.23716.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1293.3), metadata={scheduling_name="bitcast.23716.7"}
  %convert.4110.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.23716.7), metadata={scheduling_name="convert.4110.7"}
  %add.3041.5 = f32[1,1,6144]{2,1,0} add(%convert.4054.3, %convert.4110.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3041.5"}
  %convert.4111.3 = bf16[1,1,6144]{2,1,0} convert(%add.3041.5), metadata={scheduling_name="convert.4111.3"}
  %param_6.1230 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1230"}
  %constant_1660_54 = s32[] constant(8)
  %param_7.1158 = s32[] parameter(7), metadata={scheduling_name="param_7.1158"}
  %subtract.247.65 = s32[] subtract(%constant_1660_54, %param_7.1158), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.65"}
  %dynamic-slice.1484.46 = s32[1]{0} dynamic-slice(%param_6.1230, %subtract.247.65), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.46"}
  %param_4.1357 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1357"}
  %param_5.1249 = u32[] parameter(5), metadata={scheduling_name="param_5.1249"}
  %dynamic-slice.1485.41 = s32[1]{0} dynamic-slice(%param_4.1357, %param_5.1249), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.41"}
  %subtract.248.36 = s32[1]{0} subtract(%dynamic-slice.1484.46, %dynamic-slice.1485.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.36"}
  %constant_2166_27 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.36 = s32[1]{0} maximum(%subtract.248.36, %constant_2166_27), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.36"}
  %sign.27.35 = s32[1]{0} sign(%maximum.47.36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.35"}
  %constant_5144_21 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.35 = pred[1]{0} compare(%sign.27.35, %constant_5144_21), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.35"}
  %constant_5145_19 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.36 = s32[1]{0} and(%maximum.47.36, %constant_5145_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.36"}
  %compare.1615.36 = pred[1]{0} compare(%and.301.36, %constant_2166_27), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.36"}
  %and.302.35 = pred[1]{0} and(%compare.1614.35, %compare.1615.36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.35"}
  %constant_5146_18 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.35 = s32[1]{0} shift-right-logical(%maximum.47.36, %constant_5146_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.35"}
  %constant_5147_18 = s32[1]{0} constant({-1})
  %add.2981.35 = s32[1]{0} add(%shift-right-logical.20.35, %constant_5147_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.35"}
  %select.1269.35 = s32[1]{0} select(%and.302.35, %add.2981.35, %shift-right-logical.20.35), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.35"}
  %compare.1616.35 = pred[1]{0} compare(%select.1269.35, %constant_2166_27), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.35"}
  %add.2982.35 = s32[1]{0} add(%select.1269.35, %constant_5146_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.35"}
  %select.1270.35 = s32[1]{0} select(%compare.1616.35, %add.2982.35, %select.1269.35), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.35"}
  %bitcast.21242.43 = s32[1,1]{1,0} bitcast(%select.1270.35), metadata={scheduling_name="bitcast.21242.43"}
  %constant_1668_51 = s32[] constant(0)
  %pad.345.23 = s32[1,2]{1,0} pad(%bitcast.21242.43, %constant_1668_51), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.23"}
  %pad.346.21 = s32[1,3]{1,0} pad(%pad.345.23, %constant_1668_51), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.21"}
  %bitcast.21349.18 = s32[3]{0} bitcast(%pad.346.21), metadata={scheduling_name="bitcast.21349.18"}
  %slice.2376.15 = s32[1]{0} slice(%bitcast.21349.18), slice={[1:2]}, metadata={scheduling_name="slice.2376.15"}
  %bitcast.24050.6 = s32[] bitcast(%slice.2376.15), metadata={scheduling_name="bitcast.24050.6"}
  ROOT %dynamic-update-slice.399.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.452, %convert.4111.3, %bitcast.24050.6, %constant_1668_51, %constant_1668_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.399.1"}
}

%fused_dynamic_update_slice.15 (param_0.453: bf16[2,1,6144], param_1.2520: bf16[1,1,6144], param_2.1864: bf16[6144], param_3.1456: pred[], param_4.1358: s32[32], param_5.1250: u32[], param_6.1231: s32[9], param_7.1159: s32[]) -> bf16[2,1,6144] {
  %param_0.453 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.453"}
  %param_1.2520 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2520"}
  %convert.4139.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2520), metadata={scheduling_name="convert.4139.3"}
  %param_3.1456 = pred[] parameter(3), metadata={scheduling_name="param_3.1456"}
  %broadcast.5672.3 = pred[1,6144]{1,0} broadcast(%param_3.1456), dimensions={}, metadata={scheduling_name="broadcast.5672.3"}
  %param_2.1864 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1864"}
  %bitcast.24033.3 = bf16[1,6144]{1,0} bitcast(%param_2.1864), metadata={scheduling_name="bitcast.24033.3"}
  %constant_1658_50 = bf16[] constant(0)
  %broadcast.5673.3 = bf16[1,6144]{1,0} broadcast(%constant_1658_50), dimensions={}, metadata={scheduling_name="broadcast.5673.3"}
  %select.1303.3 = bf16[1,6144]{1,0} select(%broadcast.5672.3, %bitcast.24033.3, %broadcast.5673.3), metadata={scheduling_name="select.1303.3"}
  %bitcast.24039.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1303.3), metadata={scheduling_name="bitcast.24039.7"}
  %convert.4148.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.24039.7), metadata={scheduling_name="convert.4148.7"}
  %add.3050.5 = f32[1,1,6144]{2,1,0} add(%convert.4139.3, %convert.4148.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3050.5"}
  %convert.4150.3 = bf16[1,1,6144]{2,1,0} convert(%add.3050.5), metadata={scheduling_name="convert.4150.3"}
  %param_6.1231 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1231"}
  %constant_1660_55 = s32[] constant(8)
  %param_7.1159 = s32[] parameter(7), metadata={scheduling_name="param_7.1159"}
  %subtract.247.67 = s32[] subtract(%constant_1660_55, %param_7.1159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.67"}
  %dynamic-slice.1484.48 = s32[1]{0} dynamic-slice(%param_6.1231, %subtract.247.67), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.48"}
  %param_4.1358 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1358"}
  %param_5.1250 = u32[] parameter(5), metadata={scheduling_name="param_5.1250"}
  %dynamic-slice.1485.43 = s32[1]{0} dynamic-slice(%param_4.1358, %param_5.1250), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.43"}
  %subtract.248.38 = s32[1]{0} subtract(%dynamic-slice.1484.48, %dynamic-slice.1485.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.38"}
  %constant_2166_28 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.38 = s32[1]{0} maximum(%subtract.248.38, %constant_2166_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.38"}
  %sign.27.37 = s32[1]{0} sign(%maximum.47.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.37"}
  %constant_5144_22 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.37 = pred[1]{0} compare(%sign.27.37, %constant_5144_22), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.37"}
  %constant_5145_20 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.38 = s32[1]{0} and(%maximum.47.38, %constant_5145_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.38"}
  %compare.1615.38 = pred[1]{0} compare(%and.301.38, %constant_2166_28), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.38"}
  %and.302.37 = pred[1]{0} and(%compare.1614.37, %compare.1615.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.37"}
  %constant_5146_19 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.37 = s32[1]{0} shift-right-logical(%maximum.47.38, %constant_5146_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.37"}
  %constant_5147_19 = s32[1]{0} constant({-1})
  %add.2981.37 = s32[1]{0} add(%shift-right-logical.20.37, %constant_5147_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.37"}
  %select.1269.37 = s32[1]{0} select(%and.302.37, %add.2981.37, %shift-right-logical.20.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.37"}
  %compare.1616.37 = pred[1]{0} compare(%select.1269.37, %constant_2166_28), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.37"}
  %add.2982.37 = s32[1]{0} add(%select.1269.37, %constant_5146_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.37"}
  %select.1270.37 = s32[1]{0} select(%compare.1616.37, %add.2982.37, %select.1269.37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.37"}
  %bitcast.21242.45 = s32[1,1]{1,0} bitcast(%select.1270.37), metadata={scheduling_name="bitcast.21242.45"}
  %constant_1668_111 = s32[] constant(0)
  %pad.345.25 = s32[1,2]{1,0} pad(%bitcast.21242.45, %constant_1668_111), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.25"}
  %pad.346.23 = s32[1,3]{1,0} pad(%pad.345.25, %constant_1668_111), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.23"}
  %bitcast.21349.20 = s32[3]{0} bitcast(%pad.346.23), metadata={scheduling_name="bitcast.21349.20"}
  %slice.2376.17 = s32[1]{0} slice(%bitcast.21349.20), slice={[1:2]}, metadata={scheduling_name="slice.2376.17"}
  %bitcast.24050.7 = s32[] bitcast(%slice.2376.17), metadata={scheduling_name="bitcast.24050.7"}
  ROOT %dynamic-update-slice.408.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.453, %convert.4150.3, %bitcast.24050.7, %constant_1668_111, %constant_1668_111), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.408.1"}
}

%fused_dynamic_update_slice.16 (param_0.454: bf16[2,1,6144], param_1.2469: bf16[1,1,6144], param_2.1818: bf16[6144], param_3.1408: pred[], param_4.1359: s32[32], param_5.1251: u32[], param_6.1232: s32[9], param_7.1160: s32[]) -> bf16[2,1,6144] {
  %param_0.454 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.454"}
  %param_1.2469 = bf16[1,1,6144]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2469"}
  %convert.4151.3 = f32[1,1,6144]{2,1,0} convert(%param_1.2469), metadata={scheduling_name="convert.4151.3"}
  %param_3.1408 = pred[] parameter(3), metadata={scheduling_name="param_3.1408"}
  %broadcast.5672.4 = pred[1,6144]{1,0} broadcast(%param_3.1408), dimensions={}, metadata={scheduling_name="broadcast.5672.4"}
  %param_2.1818 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.1818"}
  %bitcast.24082.3 = bf16[1,6144]{1,0} bitcast(%param_2.1818), metadata={scheduling_name="bitcast.24082.3"}
  %constant_1658_12 = bf16[] constant(0)
  %broadcast.5673.4 = bf16[1,6144]{1,0} broadcast(%constant_1658_12), dimensions={}, metadata={scheduling_name="broadcast.5673.4"}
  %select.1305.3 = bf16[1,6144]{1,0} select(%broadcast.5672.4, %bitcast.24082.3, %broadcast.5673.4), metadata={scheduling_name="select.1305.3"}
  %bitcast.24088.7 = bf16[1,1,6144]{2,1,0} bitcast(%select.1305.3), metadata={scheduling_name="bitcast.24088.7"}
  %convert.4160.7 = f32[1,1,6144]{2,1,0} convert(%bitcast.24088.7), metadata={scheduling_name="convert.4160.7"}
  %add.3051.5 = f32[1,1,6144]{2,1,0} add(%convert.4151.3, %convert.4160.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3051.5"}
  %convert.4162.3 = bf16[1,1,6144]{2,1,0} convert(%add.3051.5), metadata={scheduling_name="convert.4162.3"}
  %param_6.1232 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1232"}
  %constant_1660_56 = s32[] constant(8)
  %param_7.1160 = s32[] parameter(7), metadata={scheduling_name="param_7.1160"}
  %subtract.247.69 = s32[] subtract(%constant_1660_56, %param_7.1160), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.69"}
  %dynamic-slice.1484.50 = s32[1]{0} dynamic-slice(%param_6.1232, %subtract.247.69), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.50"}
  %param_4.1359 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1359"}
  %param_5.1251 = u32[] parameter(5), metadata={scheduling_name="param_5.1251"}
  %dynamic-slice.1485.45 = s32[1]{0} dynamic-slice(%param_4.1359, %param_5.1251), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.45"}
  %subtract.248.40 = s32[1]{0} subtract(%dynamic-slice.1484.50, %dynamic-slice.1485.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.40"}
  %constant_2166_29 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.40 = s32[1]{0} maximum(%subtract.248.40, %constant_2166_29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.40"}
  %sign.27.39 = s32[1]{0} sign(%maximum.47.40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.39"}
  %constant_5144_23 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.39 = pred[1]{0} compare(%sign.27.39, %constant_5144_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.39"}
  %constant_5145_21 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.40 = s32[1]{0} and(%maximum.47.40, %constant_5145_21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.40"}
  %compare.1615.40 = pred[1]{0} compare(%and.301.40, %constant_2166_29), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.40"}
  %and.302.39 = pred[1]{0} and(%compare.1614.39, %compare.1615.40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.39"}
  %constant_5146_20 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.39 = s32[1]{0} shift-right-logical(%maximum.47.40, %constant_5146_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.39"}
  %constant_5147_20 = s32[1]{0} constant({-1})
  %add.2981.39 = s32[1]{0} add(%shift-right-logical.20.39, %constant_5147_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.39"}
  %select.1269.39 = s32[1]{0} select(%and.302.39, %add.2981.39, %shift-right-logical.20.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.39"}
  %compare.1616.39 = pred[1]{0} compare(%select.1269.39, %constant_2166_29), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.39"}
  %add.2982.39 = s32[1]{0} add(%select.1269.39, %constant_5146_20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.39"}
  %select.1270.39 = s32[1]{0} select(%compare.1616.39, %add.2982.39, %select.1269.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.39"}
  %bitcast.21242.47 = s32[1,1]{1,0} bitcast(%select.1270.39), metadata={scheduling_name="bitcast.21242.47"}
  %constant_1668_53 = s32[] constant(0)
  %pad.345.27 = s32[1,2]{1,0} pad(%bitcast.21242.47, %constant_1668_53), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.27"}
  %pad.346.25 = s32[1,3]{1,0} pad(%pad.345.27, %constant_1668_53), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.25"}
  %bitcast.21349.22 = s32[3]{0} bitcast(%pad.346.25), metadata={scheduling_name="bitcast.21349.22"}
  %slice.2376.19 = s32[1]{0} slice(%bitcast.21349.22), slice={[1:2]}, metadata={scheduling_name="slice.2376.19"}
  %bitcast.24050.8 = s32[] bitcast(%slice.2376.19), metadata={scheduling_name="bitcast.24050.8"}
  ROOT %dynamic-update-slice.409.1 = bf16[2,1,6144]{2,1,0} dynamic-update-slice(%param_0.454, %convert.4162.3, %bitcast.24050.8, %constant_1668_53, %constant_1668_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.409.1"}
}

%fused_dynamic_slice.19 (param_0.457: bf16[2,1,6144], param_1.2574: s32[32], param_2.1957: u32[], param_3.1597: s32[9], param_4.1343: s32[], param_5.2684: bf16[2,1,768,8], param_6.2458: bf16[2,1,768,8], param_7.2270: bf16[2,1,768,8], param_8.2117: bf16[2,1,768,8], param_9.1850: bf16[2,1,6144], param_10.1472: bf16[2,1,6144], param_11.1380: bf16[2,1,6144]) -> (bf16[1,1,6144], bf16[1,1,768,8], bf16[1,1,768,8], bf16[1,1,768,8], bf16[1,1,768,8], /*index=5*/bf16[1,1,6144], bf16[1,1,6144], bf16[1,1,6144]) {
  %param_0.457 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.457"}
  %param_3.1597 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1597"}
  %constant_1660_38 = s32[] constant(8)
  %param_4.1343 = s32[] parameter(4), metadata={scheduling_name="param_4.1343"}
  %subtract.247.33 = s32[] subtract(%constant_1660_38, %param_4.1343), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.33"}
  %dynamic-slice.1484.14 = s32[1]{0} dynamic-slice(%param_3.1597, %subtract.247.33), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.14"}
  %param_1.2574 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1.2574"}
  %param_2.1957 = u32[] parameter(2), metadata={scheduling_name="param_2.1957"}
  %dynamic-slice.1485.9 = s32[1]{0} dynamic-slice(%param_1.2574, %param_2.1957), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.9"}
  %subtract.248.4 = s32[1]{0} subtract(%dynamic-slice.1484.14, %dynamic-slice.1485.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.4"}
  %constant_2166_12 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.4 = s32[1]{0} maximum(%subtract.248.4, %constant_2166_12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.4"}
  %sign.27.3 = s32[1]{0} sign(%maximum.47.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.3"}
  %constant_5144_5 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.3 = pred[1]{0} compare(%sign.27.3, %constant_5144_5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.3"}
  %constant_5145_3 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.4 = s32[1]{0} and(%maximum.47.4, %constant_5145_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.4"}
  %compare.1615.4 = pred[1]{0} compare(%and.301.4, %constant_2166_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.4"}
  %and.302.3 = pred[1]{0} and(%compare.1614.3, %compare.1615.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.3"}
  %constant_5146_2 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.3 = s32[1]{0} shift-right-logical(%maximum.47.4, %constant_5146_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.3"}
  %constant_5147_2 = s32[1]{0} constant({-1})
  %add.2981.3 = s32[1]{0} add(%shift-right-logical.20.3, %constant_5147_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.3"}
  %select.1269.3 = s32[1]{0} select(%and.302.3, %add.2981.3, %shift-right-logical.20.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.3"}
  %compare.1616.3 = pred[1]{0} compare(%select.1269.3, %constant_2166_12), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.3"}
  %add.2982.3 = s32[1]{0} add(%select.1269.3, %constant_5146_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.3"}
  %select.1270.3 = s32[1]{0} select(%compare.1616.3, %add.2982.3, %select.1269.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.3"}
  %bitcast.21242.53 = s32[1,1]{1,0} bitcast(%select.1270.3), metadata={scheduling_name="bitcast.21242.53"}
  %constant_1668_93 = s32[] constant(0)
  %pad.345.33 = s32[1,2]{1,0} pad(%bitcast.21242.53, %constant_1668_93), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.33"}
  %pad.346.31 = s32[1,3]{1,0} pad(%pad.345.33, %constant_1668_93), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.31"}
  %bitcast.21349.28 = s32[3]{0} bitcast(%pad.346.31), metadata={scheduling_name="bitcast.21349.28"}
  %slice.2376.25 = s32[1]{0} slice(%bitcast.21349.28), slice={[1:2]}, metadata={scheduling_name="slice.2376.25"}
  %bitcast.24050.11 = s32[] bitcast(%slice.2376.25), metadata={scheduling_name="bitcast.24050.11"}
  %dynamic-slice.1532.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_0.457, %bitcast.24050.11, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1532.1"}
  %param_5.2684 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2684"}
  %constant_5148_2_clone_1 = s32[1,1]{1,0} constant({ {0} })
  %concatenate.699.17.clone.1 = s32[1,4]{1,0} concatenate(%constant_5148_2_clone_1, %bitcast.21242.53, %constant_5148_2_clone_1, %constant_5148_2_clone_1), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.17.clone.1"}
  %bitcast.21245.14.clone.1 = s32[4]{0} bitcast(%concatenate.699.17.clone.1), metadata={scheduling_name="bitcast.21245.14.clone.1"}
  %slice.2373.13.clone.1 = s32[1]{0} slice(%bitcast.21245.14.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2373.13.clone.1"}
  %bitcast.23877.5.clone.1 = s32[] bitcast(%slice.2373.13.clone.1), metadata={scheduling_name="bitcast.23877.5.clone.1"}
  %dynamic-slice.1486.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_5.2684, %bitcast.23877.5.clone.1, %constant_1668_93, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1486.1.clone.1"}
  %param_6.2458 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2458"}
  %dynamic-slice.1528.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_6.2458, %bitcast.23877.5.clone.1, %constant_1668_93, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1528.1.clone.1"}
  %param_7.2270 = bf16[2,1,768,8]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2270"}
  %dynamic-slice.1491.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_7.2270, %bitcast.23877.5.clone.1, %constant_1668_93, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1491.1.clone.1"}
  %param_8.2117 = bf16[2,1,768,8]{3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2117"}
  %dynamic-slice.1499.1.clone.1 = bf16[1,1,768,8]{3,2,1,0} dynamic-slice(%param_8.2117, %bitcast.23877.5.clone.1, %constant_1668_93, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,768,8}, metadata={scheduling_name="dynamic-slice.1499.1.clone.1"}
  %param_9.1850 = bf16[2,1,6144]{2,1,0} parameter(9), metadata={scheduling_name="param_9.1850"}
  %dynamic-slice.1533.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_9.1850, %bitcast.24050.11, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1533.1.clone.1"}
  %param_10.1472 = bf16[2,1,6144]{2,1,0} parameter(10), metadata={scheduling_name="param_10.1472"}
  %dynamic-slice.1516.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_10.1472, %bitcast.24050.11, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1516.1.clone.1"}
  %param_11.1380 = bf16[2,1,6144]{2,1,0} parameter(11), metadata={scheduling_name="param_11.1380"}
  %dynamic-slice.1517.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_11.1380, %bitcast.24050.11, %constant_1668_93, %constant_1668_93), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1517.1.clone.1"}
  ROOT %tuple.524 = (bf16[1,1,6144]{2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, /*index=5*/bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}) tuple(%dynamic-slice.1532.1, %dynamic-slice.1486.1.clone.1, %dynamic-slice.1528.1.clone.1, %dynamic-slice.1491.1.clone.1, %dynamic-slice.1499.1.clone.1, /*index=5*/%dynamic-slice.1533.1.clone.1, %dynamic-slice.1516.1.clone.1, %dynamic-slice.1517.1.clone.1), metadata={scheduling_name="tuple.524"}
}

%fused_rsqrt.7 (param_0.2398: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_0.2398 = f32[4,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.2398"}
  %bitcast.21326.7 = f32[1,4,8192]{2,1,0} bitcast(%param_0.2398), metadata={scheduling_name="bitcast.21326.7"}
  %constant_1695_2 = f32[] constant(0.000162760422)
  %broadcast.5571.28 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_2), dimensions={}, metadata={scheduling_name="broadcast.5571.28"}
  %multiply.2571.7 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21326.7, %broadcast.5571.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2571.7"}
  %constant_1696_2 = f32[] constant(1e-05)
  %broadcast.5572.20 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_2), dimensions={}, metadata={scheduling_name="broadcast.5572.20"}
  %add.2983.5 = f32[1,4,8192]{2,1,0} add(%multiply.2571.7, %broadcast.5572.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2983.5"}
  %bitcast.21334.1 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2983.5), metadata={scheduling_name="bitcast.21334.1"}
  ROOT %rsqrt.95.1 = f32[1,1,4,8192]{3,2,1,0} rsqrt(%bitcast.21334.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.95.1"}
}

%fused_reduce.12 (param_0.2392: bf16[32768,6144]) -> f32[4,8192] {
  %param_0.2392 = bf16[32768,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.2392"}
  %bitcast.21315.21 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_0.2392), metadata={scheduling_name="bitcast.21315.21"}
  %convert.3887.21 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21315.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3887.21"}
  %multiply.2570.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3887.21, %convert.3887.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2570.3"}
  %bitcast.21322.1 = f32[4,8192,6144]{2,1,0} bitcast(%multiply.2570.3), metadata={scheduling_name="bitcast.21322.1"}
  %constant_1694_4 = f32[] constant(0)
  ROOT %reduce.403.1 = f32[4,8192]{1,0} reduce(%bitcast.21322.1, %constant_1694_4), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.403.1"}
}

%fused_dynamic_slice.20 (param_0.476: bf16[2,1,1,6144,16384], param_1.2596: s32[32], param_2.2012: u32[], param_3.1656: s32[9], param_4.1410: s32[], param_5.2686: bf16[2,1,1,16384,6144], param_6.2471: bf16[2,1,1,6144,16384], param_7.2305: bf16[2,1,1,6144,16384], param_8.2167: bf16[2,1,1,6144,16384], param_9.1914: bf16[2,1,1,16384,6144], param_10.1551: bf16[2,1,1,6144,16384], param_11.1462: bf16[2,1,1,6144,16384], param_12.1214: bf16[2,1,1,16384,6144], param_13.939: bf16[2,1,1,6144,16384], param_14.679: bf16[2,1,1,6144,16384], param_15.417: bf16[2,1,1,16384,6144]) -> (bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], /*index=5*/bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144], bf16[1,1,1,6144,16384], /*index=10*/bf16[1,1,1,6144,16384], bf16[1,1,1,16384,6144]) {
  %param_0.476 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.476"}
  %constant_5148_14 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1656 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1656"}
  %constant_1660_64 = s32[] constant(8)
  %param_4.1410 = s32[] parameter(4), metadata={scheduling_name="param_4.1410"}
  %subtract.247.85 = s32[] subtract(%constant_1660_64, %param_4.1410), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.85"}
  %dynamic-slice.1484.66 = s32[1]{0} dynamic-slice(%param_3.1656, %subtract.247.85), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.66"}
  %param_1.2596 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1.2596"}
  %param_2.2012 = u32[] parameter(2), metadata={scheduling_name="param_2.2012"}
  %dynamic-slice.1485.61 = s32[1]{0} dynamic-slice(%param_1.2596, %param_2.2012), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.61"}
  %subtract.248.56 = s32[1]{0} subtract(%dynamic-slice.1484.66, %dynamic-slice.1485.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.56"}
  %constant_2166_36 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.56 = s32[1]{0} maximum(%subtract.248.56, %constant_2166_36), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.56"}
  %sign.27.55 = s32[1]{0} sign(%maximum.47.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.55"}
  %constant_5144_31 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.55 = pred[1]{0} compare(%sign.27.55, %constant_5144_31), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.55"}
  %constant_5145_29 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.56 = s32[1]{0} and(%maximum.47.56, %constant_5145_29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.56"}
  %compare.1615.56 = pred[1]{0} compare(%and.301.56, %constant_2166_36), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.56"}
  %and.302.55 = pred[1]{0} and(%compare.1614.55, %compare.1615.56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.55"}
  %constant_5146_28 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.55 = s32[1]{0} shift-right-logical(%maximum.47.56, %constant_5146_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.55"}
  %constant_5147_28 = s32[1]{0} constant({-1})
  %add.2981.55 = s32[1]{0} add(%shift-right-logical.20.55, %constant_5147_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.55"}
  %select.1269.55 = s32[1]{0} select(%and.302.55, %add.2981.55, %shift-right-logical.20.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.55"}
  %compare.1616.55 = pred[1]{0} compare(%select.1269.55, %constant_2166_36), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.55"}
  %add.2982.55 = s32[1]{0} add(%select.1269.55, %constant_5146_28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.55"}
  %select.1270.55 = s32[1]{0} select(%compare.1616.55, %add.2982.55, %select.1269.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.55"}
  %bitcast.21242.65 = s32[1,1]{1,0} bitcast(%select.1270.55), metadata={scheduling_name="bitcast.21242.65"}
  %concatenate.701.13 = s32[1,5]{1,0} concatenate(%constant_5148_14, %bitcast.21242.65, %constant_5148_14, %constant_5148_14, %constant_5148_14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.13"}
  %bitcast.21290.12 = s32[5]{0} bitcast(%concatenate.701.13), metadata={scheduling_name="bitcast.21290.12"}
  %slice.2375.9 = s32[1]{0} slice(%bitcast.21290.12), slice={[1:2]}, metadata={scheduling_name="slice.2375.9"}
  %bitcast.24211.3 = s32[] bitcast(%slice.2375.9), metadata={scheduling_name="bitcast.24211.3"}
  %constant_1668_69 = s32[] constant(0)
  %dynamic-slice.1500.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_0.476, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1500.1"}
  %param_5.2686 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2686"}
  %dynamic-slice.1501.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_5.2686, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1501.1.clone.1"}
  %param_6.2471 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2471"}
  %dynamic-slice.1502.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_6.2471, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1502.1.clone.1"}
  %param_7.2305 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2305"}
  %dynamic-slice.1510.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_7.2305, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1510.1.clone.1"}
  %param_8.2167 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2167"}
  %dynamic-slice.1511.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_8.2167, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1511.1.clone.1"}
  %param_9.1914 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1914"}
  %dynamic-slice.1512.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_9.1914, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1512.1.clone.1"}
  %param_10.1551 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1551"}
  %dynamic-slice.1513.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_10.1551, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1513.1.clone.1"}
  %param_11.1462 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1462"}
  %dynamic-slice.1514.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_11.1462, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1514.1.clone.1"}
  %param_12.1214 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(12), metadata={scheduling_name="param_12.1214"}
  %dynamic-slice.1515.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_12.1214, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1515.1.clone.1"}
  %param_13.939 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(13), metadata={scheduling_name="param_13.939"}
  %dynamic-slice.1529.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_13.939, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1529.1.clone.1"}
  %param_14.679 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(14), metadata={scheduling_name="param_14.679"}
  %dynamic-slice.1530.1.clone.1 = bf16[1,1,1,6144,16384]{4,3,2,1,0} dynamic-slice(%param_14.679, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,6144,16384}, metadata={scheduling_name="dynamic-slice.1530.1.clone.1"}
  %param_15.417 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(15), metadata={scheduling_name="param_15.417"}
  %dynamic-slice.1531.1.clone.1 = bf16[1,1,1,16384,6144]{4,3,2,1,0} dynamic-slice(%param_15.417, %bitcast.24211.3, %constant_1668_69, %constant_1668_69, %constant_1668_69, /*index=5*/%constant_1668_69), dynamic_slice_sizes={1,1,1,16384,6144}, metadata={scheduling_name="dynamic-slice.1531.1.clone.1"}
  ROOT %tuple.542 = (bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=10*/bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}) tuple(%dynamic-slice.1500.1, %dynamic-slice.1501.1.clone.1, %dynamic-slice.1502.1.clone.1, %dynamic-slice.1510.1.clone.1, %dynamic-slice.1511.1.clone.1, /*index=5*/%dynamic-slice.1512.1.clone.1, %dynamic-slice.1513.1.clone.1, %dynamic-slice.1514.1.clone.1, %dynamic-slice.1515.1.clone.1, %dynamic-slice.1529.1.clone.1, /*index=10*/%dynamic-slice.1530.1.clone.1, %dynamic-slice.1531.1.clone.1), metadata={scheduling_name="tuple.542"}
}

%fused_dynamic_update_slice.17 (param_0.485: bf16[2,1,1,6144,16384], param_1.2468: bf16[1,1,1,6144,16384], param_2.1817: bf16[6144,16384], param_3.1407: pred[], param_4.1419: s32[32], param_5.1299: u32[], param_6.1253: s32[9], param_7.1179: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.485 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.485"}
  %param_1.2468 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2468"}
  %convert.4029.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2468), metadata={scheduling_name="convert.4029.3"}
  %param_3.1407 = pred[] parameter(3), metadata={scheduling_name="param_3.1407"}
  %broadcast.5665.12 = pred[6144,16384]{1,0} broadcast(%param_3.1407), dimensions={}, metadata={scheduling_name="broadcast.5665.12"}
  %param_2.1817 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1817"}
  %constant_1658_23 = bf16[] constant(0)
  %broadcast.5667.12 = bf16[6144,16384]{1,0} broadcast(%constant_1658_23), dimensions={}, metadata={scheduling_name="broadcast.5667.12"}
  %select.1289.3 = bf16[6144,16384]{1,0} select(%broadcast.5665.12, %param_2.1817, %broadcast.5667.12), metadata={scheduling_name="select.1289.3"}
  %bitcast.23137.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1289.3), metadata={scheduling_name="bitcast.23137.7"}
  %convert.4035.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23137.7), metadata={scheduling_name="convert.4035.7"}
  %add.3027.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4029.3, %convert.4035.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3027.5"}
  %convert.4036.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.3027.5), metadata={scheduling_name="convert.4036.3"}
  %constant_5148_23 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1253 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1253"}
  %constant_1660_73 = s32[] constant(8)
  %param_7.1179 = s32[] parameter(7), metadata={scheduling_name="param_7.1179"}
  %subtract.247.103 = s32[] subtract(%constant_1660_73, %param_7.1179), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.103"}
  %dynamic-slice.1484.84 = s32[1]{0} dynamic-slice(%param_6.1253, %subtract.247.103), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.84"}
  %param_4.1419 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1419"}
  %param_5.1299 = u32[] parameter(5), metadata={scheduling_name="param_5.1299"}
  %dynamic-slice.1485.79 = s32[1]{0} dynamic-slice(%param_4.1419, %param_5.1299), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.79"}
  %subtract.248.74 = s32[1]{0} subtract(%dynamic-slice.1484.84, %dynamic-slice.1485.79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.74"}
  %constant_2166_45 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.74 = s32[1]{0} maximum(%subtract.248.74, %constant_2166_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.74"}
  %sign.27.73 = s32[1]{0} sign(%maximum.47.74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.73"}
  %constant_5144_40 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.73 = pred[1]{0} compare(%sign.27.73, %constant_5144_40), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.73"}
  %constant_5145_38 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.74 = s32[1]{0} and(%maximum.47.74, %constant_5145_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.74"}
  %compare.1615.74 = pred[1]{0} compare(%and.301.74, %constant_2166_45), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.74"}
  %and.302.73 = pred[1]{0} and(%compare.1614.73, %compare.1615.74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.73"}
  %constant_5146_37 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.73 = s32[1]{0} shift-right-logical(%maximum.47.74, %constant_5146_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.73"}
  %constant_5147_37 = s32[1]{0} constant({-1})
  %add.2981.73 = s32[1]{0} add(%shift-right-logical.20.73, %constant_5147_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.73"}
  %select.1269.73 = s32[1]{0} select(%and.302.73, %add.2981.73, %shift-right-logical.20.73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.73"}
  %compare.1616.73 = pred[1]{0} compare(%select.1269.73, %constant_2166_45), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.73"}
  %add.2982.73 = s32[1]{0} add(%select.1269.73, %constant_5146_37), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.73"}
  %select.1270.73 = s32[1]{0} select(%compare.1616.73, %add.2982.73, %select.1269.73), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.73"}
  %bitcast.21242.83 = s32[1,1]{1,0} bitcast(%select.1270.73), metadata={scheduling_name="bitcast.21242.83"}
  %concatenate.701.31 = s32[1,5]{1,0} concatenate(%constant_5148_23, %bitcast.21242.83, %constant_5148_23, %constant_5148_23, %constant_5148_23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.31"}
  %bitcast.21290.30 = s32[5]{0} bitcast(%concatenate.701.31), metadata={scheduling_name="bitcast.21290.30"}
  %slice.2375.27 = s32[1]{0} slice(%bitcast.21290.30), slice={[1:2]}, metadata={scheduling_name="slice.2375.27"}
  %bitcast.24211.12 = s32[] bitcast(%slice.2375.27), metadata={scheduling_name="bitcast.24211.12"}
  %constant_1668_52 = s32[] constant(0)
  ROOT %dynamic-update-slice.395.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.485, %convert.4036.3, %bitcast.24211.12, %constant_1668_52, %constant_1668_52, /*index=5*/%constant_1668_52, %constant_1668_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.395.1"}
}

%fused_dynamic_update_slice.18 (param_0.486: bf16[2,1,1,6144,16384], param_1.2439: bf16[1,1,1,6144,16384], param_2.1787: bf16[6144,16384], param_3.1375: pred[], param_4.1420: s32[32], param_5.1300: u32[], param_6.1254: s32[9], param_7.1180: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.486 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.486"}
  %param_1.2439 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2439"}
  %convert.4037.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2439), metadata={scheduling_name="convert.4037.3"}
  %param_3.1375 = pred[] parameter(3), metadata={scheduling_name="param_3.1375"}
  %broadcast.5665.10 = pred[6144,16384]{1,0} broadcast(%param_3.1375), dimensions={}, metadata={scheduling_name="broadcast.5665.10"}
  %param_2.1787 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1787"}
  %constant_1658_24 = bf16[] constant(0)
  %broadcast.5667.10 = bf16[6144,16384]{1,0} broadcast(%constant_1658_24), dimensions={}, metadata={scheduling_name="broadcast.5667.10"}
  %select.1290.3 = bf16[6144,16384]{1,0} select(%broadcast.5665.10, %param_2.1787, %broadcast.5667.10), metadata={scheduling_name="select.1290.3"}
  %bitcast.23172.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1290.3), metadata={scheduling_name="bitcast.23172.7"}
  %convert.4040.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23172.7), metadata={scheduling_name="convert.4040.7"}
  %add.3028.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4037.3, %convert.4040.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3028.5"}
  %convert.4041.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.3028.5), metadata={scheduling_name="convert.4041.3"}
  %constant_5148_24 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1254 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1254"}
  %constant_1660_74 = s32[] constant(8)
  %param_7.1180 = s32[] parameter(7), metadata={scheduling_name="param_7.1180"}
  %subtract.247.105 = s32[] subtract(%constant_1660_74, %param_7.1180), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.105"}
  %dynamic-slice.1484.86 = s32[1]{0} dynamic-slice(%param_6.1254, %subtract.247.105), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.86"}
  %param_4.1420 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1420"}
  %param_5.1300 = u32[] parameter(5), metadata={scheduling_name="param_5.1300"}
  %dynamic-slice.1485.81 = s32[1]{0} dynamic-slice(%param_4.1420, %param_5.1300), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.81"}
  %subtract.248.76 = s32[1]{0} subtract(%dynamic-slice.1484.86, %dynamic-slice.1485.81), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.76"}
  %constant_2166_46 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.76 = s32[1]{0} maximum(%subtract.248.76, %constant_2166_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.76"}
  %sign.27.75 = s32[1]{0} sign(%maximum.47.76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.75"}
  %constant_5144_41 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.75 = pred[1]{0} compare(%sign.27.75, %constant_5144_41), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.75"}
  %constant_5145_39 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.76 = s32[1]{0} and(%maximum.47.76, %constant_5145_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.76"}
  %compare.1615.76 = pred[1]{0} compare(%and.301.76, %constant_2166_46), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.76"}
  %and.302.75 = pred[1]{0} and(%compare.1614.75, %compare.1615.76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.75"}
  %constant_5146_38 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.75 = s32[1]{0} shift-right-logical(%maximum.47.76, %constant_5146_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.75"}
  %constant_5147_38 = s32[1]{0} constant({-1})
  %add.2981.75 = s32[1]{0} add(%shift-right-logical.20.75, %constant_5147_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.75"}
  %select.1269.75 = s32[1]{0} select(%and.302.75, %add.2981.75, %shift-right-logical.20.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.75"}
  %compare.1616.75 = pred[1]{0} compare(%select.1269.75, %constant_2166_46), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.75"}
  %add.2982.75 = s32[1]{0} add(%select.1269.75, %constant_5146_38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.75"}
  %select.1270.75 = s32[1]{0} select(%compare.1616.75, %add.2982.75, %select.1269.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.75"}
  %bitcast.21242.85 = s32[1,1]{1,0} bitcast(%select.1270.75), metadata={scheduling_name="bitcast.21242.85"}
  %concatenate.701.33 = s32[1,5]{1,0} concatenate(%constant_5148_24, %bitcast.21242.85, %constant_5148_24, %constant_5148_24, %constant_5148_24), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.33"}
  %bitcast.21290.32 = s32[5]{0} bitcast(%concatenate.701.33), metadata={scheduling_name="bitcast.21290.32"}
  %slice.2375.29 = s32[1]{0} slice(%bitcast.21290.32), slice={[1:2]}, metadata={scheduling_name="slice.2375.29"}
  %bitcast.24211.13 = s32[] bitcast(%slice.2375.29), metadata={scheduling_name="bitcast.24211.13"}
  %constant_1668_8 = s32[] constant(0)
  ROOT %dynamic-update-slice.396.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.486, %convert.4041.3, %bitcast.24211.13, %constant_1668_8, %constant_1668_8, /*index=5*/%constant_1668_8, %constant_1668_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.396.1"}
}

%fused_dynamic_update_slice.19 (param_0.487: bf16[2,1,1,16384,6144], param_1.2474: bf16[16384,6144], param_2.1824: bf16[1,1,1,16384,6144], param_3.1414: pred[], param_4.1421: s32[32], param_5.1301: u32[], param_6.1255: s32[9], param_7.1181: s32[]) -> bf16[2,1,1,16384,6144] {
  %param_0.487 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.487"}
  %param_2.1824 = bf16[1,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1824"}
  %convert.4042.3 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.1824), metadata={scheduling_name="convert.4042.3"}
  %param_3.1414 = pred[] parameter(3), metadata={scheduling_name="param_3.1414"}
  %broadcast.5669.2 = pred[16384,6144]{1,0} broadcast(%param_3.1414), dimensions={}, metadata={scheduling_name="broadcast.5669.2"}
  %param_1.2474 = bf16[16384,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2474"}
  %constant_1658_25 = bf16[] constant(0)
  %broadcast.5670.10 = bf16[16384,6144]{1,0} broadcast(%constant_1658_25), dimensions={}, metadata={scheduling_name="broadcast.5670.10"}
  %select.1291.5 = bf16[16384,6144]{1,0} select(%broadcast.5669.2, %param_1.2474, %broadcast.5670.10), metadata={scheduling_name="select.1291.5"}
  %bitcast.23203.7 = bf16[1,1,1,16384,6144]{4,3,2,1,0} bitcast(%select.1291.5), metadata={scheduling_name="bitcast.23203.7"}
  %convert.4043.7 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%bitcast.23203.7), metadata={scheduling_name="convert.4043.7"}
  %add.3029.5 = f32[1,1,1,16384,6144]{4,3,2,1,0} add(%convert.4042.3, %convert.4043.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3029.5"}
  %convert.4044.3 = bf16[1,1,1,16384,6144]{4,3,2,1,0} convert(%add.3029.5), metadata={scheduling_name="convert.4044.3"}
  %constant_5148_25 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1255 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1255"}
  %constant_1660_75 = s32[] constant(8)
  %param_7.1181 = s32[] parameter(7), metadata={scheduling_name="param_7.1181"}
  %subtract.247.107 = s32[] subtract(%constant_1660_75, %param_7.1181), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.107"}
  %dynamic-slice.1484.88 = s32[1]{0} dynamic-slice(%param_6.1255, %subtract.247.107), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.88"}
  %param_4.1421 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1421"}
  %param_5.1301 = u32[] parameter(5), metadata={scheduling_name="param_5.1301"}
  %dynamic-slice.1485.83 = s32[1]{0} dynamic-slice(%param_4.1421, %param_5.1301), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.83"}
  %subtract.248.78 = s32[1]{0} subtract(%dynamic-slice.1484.88, %dynamic-slice.1485.83), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.78"}
  %constant_2166_47 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.78 = s32[1]{0} maximum(%subtract.248.78, %constant_2166_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.78"}
  %sign.27.77 = s32[1]{0} sign(%maximum.47.78), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.77"}
  %constant_5144_42 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.77 = pred[1]{0} compare(%sign.27.77, %constant_5144_42), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.77"}
  %constant_5145_40 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.78 = s32[1]{0} and(%maximum.47.78, %constant_5145_40), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.78"}
  %compare.1615.78 = pred[1]{0} compare(%and.301.78, %constant_2166_47), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.78"}
  %and.302.77 = pred[1]{0} and(%compare.1614.77, %compare.1615.78), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.77"}
  %constant_5146_39 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.77 = s32[1]{0} shift-right-logical(%maximum.47.78, %constant_5146_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.77"}
  %constant_5147_39 = s32[1]{0} constant({-1})
  %add.2981.77 = s32[1]{0} add(%shift-right-logical.20.77, %constant_5147_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.77"}
  %select.1269.77 = s32[1]{0} select(%and.302.77, %add.2981.77, %shift-right-logical.20.77), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.77"}
  %compare.1616.77 = pred[1]{0} compare(%select.1269.77, %constant_2166_47), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.77"}
  %add.2982.77 = s32[1]{0} add(%select.1269.77, %constant_5146_39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.77"}
  %select.1270.77 = s32[1]{0} select(%compare.1616.77, %add.2982.77, %select.1269.77), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.77"}
  %bitcast.21242.87 = s32[1,1]{1,0} bitcast(%select.1270.77), metadata={scheduling_name="bitcast.21242.87"}
  %concatenate.701.35 = s32[1,5]{1,0} concatenate(%constant_5148_25, %bitcast.21242.87, %constant_5148_25, %constant_5148_25, %constant_5148_25), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.35"}
  %bitcast.21290.34 = s32[5]{0} bitcast(%concatenate.701.35), metadata={scheduling_name="bitcast.21290.34"}
  %slice.2375.31 = s32[1]{0} slice(%bitcast.21290.34), slice={[1:2]}, metadata={scheduling_name="slice.2375.31"}
  %bitcast.24211.14 = s32[] bitcast(%slice.2375.31), metadata={scheduling_name="bitcast.24211.14"}
  %constant_1668_59 = s32[] constant(0)
  ROOT %dynamic-update-slice.397.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.487, %convert.4044.3, %bitcast.24211.14, %constant_1668_59, %constant_1668_59, /*index=5*/%constant_1668_59, %constant_1668_59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.397.1"}
}

%fused_dynamic_update_slice.20 (param_0.491: bf16[2,1,768,8,128], param_1.2464: bf16[1,1,768,8,128], param_2.1813: bf16[1,8,128,768], param_3.1403: pred[], param_4.1425: s32[32], param_5.1302: u32[], param_6.1256: s32[9], param_7.1182: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.491 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.491"}
  %param_1.2464 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2464"}
  %convert.4112.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2464), metadata={scheduling_name="convert.4112.3"}
  %param_3.1403 = pred[] parameter(3), metadata={scheduling_name="param_3.1403"}
  %broadcast.5682.6 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1403), dimensions={}, metadata={scheduling_name="broadcast.5682.6"}
  %param_2.1813 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1813"}
  %bitcast.23747.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1813), metadata={scheduling_name="bitcast.23747.3"}
  %constant_1658_42 = bf16[] constant(0)
  %broadcast.5683.6 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1658_42), dimensions={}, metadata={scheduling_name="broadcast.5683.6"}
  %select.1294.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5682.6, %bitcast.23747.3, %broadcast.5683.6), metadata={scheduling_name="select.1294.3"}
  %bitcast.23753.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1294.3), metadata={scheduling_name="bitcast.23753.7"}
  %convert.4113.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23753.7), metadata={scheduling_name="convert.4113.7"}
  %add.3042.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4112.3, %convert.4113.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3042.5"}
  %convert.4114.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.3042.5), metadata={scheduling_name="convert.4114.3"}
  %constant_5148_29 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1256 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1256"}
  %constant_1660_79 = s32[] constant(8)
  %param_7.1182 = s32[] parameter(7), metadata={scheduling_name="param_7.1182"}
  %subtract.247.115 = s32[] subtract(%constant_1660_79, %param_7.1182), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.115"}
  %dynamic-slice.1484.96 = s32[1]{0} dynamic-slice(%param_6.1256, %subtract.247.115), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.96"}
  %param_4.1425 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1425"}
  %param_5.1302 = u32[] parameter(5), metadata={scheduling_name="param_5.1302"}
  %dynamic-slice.1485.91 = s32[1]{0} dynamic-slice(%param_4.1425, %param_5.1302), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.91"}
  %subtract.248.86 = s32[1]{0} subtract(%dynamic-slice.1484.96, %dynamic-slice.1485.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.86"}
  %constant_2166_51 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.86 = s32[1]{0} maximum(%subtract.248.86, %constant_2166_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.86"}
  %sign.27.85 = s32[1]{0} sign(%maximum.47.86), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.85"}
  %constant_5144_46 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.85 = pred[1]{0} compare(%sign.27.85, %constant_5144_46), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.85"}
  %constant_5145_44 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.86 = s32[1]{0} and(%maximum.47.86, %constant_5145_44), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.86"}
  %compare.1615.86 = pred[1]{0} compare(%and.301.86, %constant_2166_51), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.86"}
  %and.302.85 = pred[1]{0} and(%compare.1614.85, %compare.1615.86), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.85"}
  %constant_5146_43 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.85 = s32[1]{0} shift-right-logical(%maximum.47.86, %constant_5146_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.85"}
  %constant_5147_43 = s32[1]{0} constant({-1})
  %add.2981.85 = s32[1]{0} add(%shift-right-logical.20.85, %constant_5147_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.85"}
  %select.1269.85 = s32[1]{0} select(%and.302.85, %add.2981.85, %shift-right-logical.20.85), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.85"}
  %compare.1616.85 = pred[1]{0} compare(%select.1269.85, %constant_2166_51), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.85"}
  %add.2982.85 = s32[1]{0} add(%select.1269.85, %constant_5146_43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.85"}
  %select.1270.85 = s32[1]{0} select(%compare.1616.85, %add.2982.85, %select.1269.85), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.85"}
  %bitcast.21242.95 = s32[1,1]{1,0} bitcast(%select.1270.85), metadata={scheduling_name="bitcast.21242.95"}
  %concatenate.701.43 = s32[1,5]{1,0} concatenate(%constant_5148_29, %bitcast.21242.95, %constant_5148_29, %constant_5148_29, %constant_5148_29), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.43"}
  %bitcast.21290.42 = s32[5]{0} bitcast(%concatenate.701.43), metadata={scheduling_name="bitcast.21290.42"}
  %slice.2375.39 = s32[1]{0} slice(%bitcast.21290.42), slice={[1:2]}, metadata={scheduling_name="slice.2375.39"}
  %bitcast.24211.18 = s32[] bitcast(%slice.2375.39), metadata={scheduling_name="bitcast.24211.18"}
  %constant_1668_48 = s32[] constant(0)
  ROOT %dynamic-update-slice.400.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.491, %convert.4114.3, %bitcast.24211.18, %constant_1668_48, %constant_1668_48, /*index=5*/%constant_1668_48, %constant_1668_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.400.1"}
}

%fused_dynamic_update_slice.21 (param_0.492: bf16[2,1,768,48,128], param_1.2470: bf16[1,1,768,48,128], param_2.1819: bf16[1,48,128,768], param_3.1409: pred[], param_4.1427: s32[32], param_5.1304: u32[], param_6.1258: s32[9], param_7.1184: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.492 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.492"}
  %param_1.2470 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2470"}
  %convert.4118.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2470), metadata={scheduling_name="convert.4118.3"}
  %param_3.1409 = pred[] parameter(3), metadata={scheduling_name="param_3.1409"}
  %broadcast.5684.8 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1409), dimensions={}, metadata={scheduling_name="broadcast.5684.8"}
  %param_2.1819 = bf16[1,48,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1819"}
  %bitcast.23824.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1819), metadata={scheduling_name="bitcast.23824.3"}
  %constant_1658_40 = bf16[] constant(0)
  %broadcast.5685.8 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1658_40), dimensions={}, metadata={scheduling_name="broadcast.5685.8"}
  %select.1296.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5684.8, %bitcast.23824.3, %broadcast.5685.8), metadata={scheduling_name="select.1296.3"}
  %bitcast.23830.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1296.3), metadata={scheduling_name="bitcast.23830.7"}
  %convert.4119.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.23830.7), metadata={scheduling_name="convert.4119.7"}
  %add.3044.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4118.3, %convert.4119.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3044.5"}
  %convert.4120.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.3044.5), metadata={scheduling_name="convert.4120.3"}
  %constant_5148_31 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1258 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1258"}
  %constant_1660_81 = s32[] constant(8)
  %param_7.1184 = s32[] parameter(7), metadata={scheduling_name="param_7.1184"}
  %subtract.247.119 = s32[] subtract(%constant_1660_81, %param_7.1184), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.119"}
  %dynamic-slice.1484.100 = s32[1]{0} dynamic-slice(%param_6.1258, %subtract.247.119), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.100"}
  %param_4.1427 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1427"}
  %param_5.1304 = u32[] parameter(5), metadata={scheduling_name="param_5.1304"}
  %dynamic-slice.1485.95 = s32[1]{0} dynamic-slice(%param_4.1427, %param_5.1304), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.95"}
  %subtract.248.90 = s32[1]{0} subtract(%dynamic-slice.1484.100, %dynamic-slice.1485.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.90"}
  %constant_2166_53 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.90 = s32[1]{0} maximum(%subtract.248.90, %constant_2166_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.90"}
  %sign.27.89 = s32[1]{0} sign(%maximum.47.90), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.89"}
  %constant_5144_48 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.89 = pred[1]{0} compare(%sign.27.89, %constant_5144_48), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.89"}
  %constant_5145_46 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.90 = s32[1]{0} and(%maximum.47.90, %constant_5145_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.90"}
  %compare.1615.90 = pred[1]{0} compare(%and.301.90, %constant_2166_53), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.90"}
  %and.302.89 = pred[1]{0} and(%compare.1614.89, %compare.1615.90), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.89"}
  %constant_5146_45 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.89 = s32[1]{0} shift-right-logical(%maximum.47.90, %constant_5146_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.89"}
  %constant_5147_45 = s32[1]{0} constant({-1})
  %add.2981.89 = s32[1]{0} add(%shift-right-logical.20.89, %constant_5147_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.89"}
  %select.1269.89 = s32[1]{0} select(%and.302.89, %add.2981.89, %shift-right-logical.20.89), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.89"}
  %compare.1616.89 = pred[1]{0} compare(%select.1269.89, %constant_2166_53), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.89"}
  %add.2982.89 = s32[1]{0} add(%select.1269.89, %constant_5146_45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.89"}
  %select.1270.89 = s32[1]{0} select(%compare.1616.89, %add.2982.89, %select.1269.89), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.89"}
  %bitcast.21242.99 = s32[1,1]{1,0} bitcast(%select.1270.89), metadata={scheduling_name="bitcast.21242.99"}
  %concatenate.701.47 = s32[1,5]{1,0} concatenate(%constant_5148_31, %bitcast.21242.99, %constant_5148_31, %constant_5148_31, %constant_5148_31), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.47"}
  %bitcast.21290.46 = s32[5]{0} bitcast(%concatenate.701.47), metadata={scheduling_name="bitcast.21290.46"}
  %slice.2375.43 = s32[1]{0} slice(%bitcast.21290.46), slice={[1:2]}, metadata={scheduling_name="slice.2375.43"}
  %bitcast.24211.20 = s32[] bitcast(%slice.2375.43), metadata={scheduling_name="bitcast.24211.20"}
  %constant_1668_54 = s32[] constant(0)
  ROOT %dynamic-update-slice.402.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%param_0.492, %convert.4120.3, %bitcast.24211.20, %constant_1668_54, %constant_1668_54, /*index=5*/%constant_1668_54, %constant_1668_54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.402.1"}
}

%fused_dynamic_update_slice.22 (param_0.493: bf16[2,1,768,8,128], param_1.2466: bf16[1,1,768,8,128], param_2.1815: bf16[1,8,128,768], param_3.1405: pred[], param_4.1428: s32[32], param_5.1305: u32[], param_6.1259: s32[9], param_7.1185: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.493 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.493"}
  %param_1.2466 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2466"}
  %convert.4121.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2466), metadata={scheduling_name="convert.4121.3"}
  %param_3.1405 = pred[] parameter(3), metadata={scheduling_name="param_3.1405"}
  %broadcast.5682.8 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1405), dimensions={}, metadata={scheduling_name="broadcast.5682.8"}
  %param_2.1815 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1815"}
  %bitcast.23860.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1815), metadata={scheduling_name="bitcast.23860.3"}
  %constant_1658_43 = bf16[] constant(0)
  %broadcast.5683.8 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1658_43), dimensions={}, metadata={scheduling_name="broadcast.5683.8"}
  %select.1297.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5682.8, %bitcast.23860.3, %broadcast.5683.8), metadata={scheduling_name="select.1297.3"}
  %bitcast.23866.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1297.3), metadata={scheduling_name="bitcast.23866.7"}
  %convert.4122.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.23866.7), metadata={scheduling_name="convert.4122.7"}
  %add.3045.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4121.3, %convert.4122.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3045.5"}
  %convert.4123.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.3045.5), metadata={scheduling_name="convert.4123.3"}
  %constant_5148_32 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1259 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1259"}
  %constant_1660_82 = s32[] constant(8)
  %param_7.1185 = s32[] parameter(7), metadata={scheduling_name="param_7.1185"}
  %subtract.247.121 = s32[] subtract(%constant_1660_82, %param_7.1185), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.121"}
  %dynamic-slice.1484.102 = s32[1]{0} dynamic-slice(%param_6.1259, %subtract.247.121), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.102"}
  %param_4.1428 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1428"}
  %param_5.1305 = u32[] parameter(5), metadata={scheduling_name="param_5.1305"}
  %dynamic-slice.1485.97 = s32[1]{0} dynamic-slice(%param_4.1428, %param_5.1305), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.97"}
  %subtract.248.92 = s32[1]{0} subtract(%dynamic-slice.1484.102, %dynamic-slice.1485.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.92"}
  %constant_2166_54 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.92 = s32[1]{0} maximum(%subtract.248.92, %constant_2166_54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.92"}
  %sign.27.91 = s32[1]{0} sign(%maximum.47.92), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.91"}
  %constant_5144_49 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.91 = pred[1]{0} compare(%sign.27.91, %constant_5144_49), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.91"}
  %constant_5145_47 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.92 = s32[1]{0} and(%maximum.47.92, %constant_5145_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.92"}
  %compare.1615.92 = pred[1]{0} compare(%and.301.92, %constant_2166_54), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.92"}
  %and.302.91 = pred[1]{0} and(%compare.1614.91, %compare.1615.92), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.91"}
  %constant_5146_46 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.91 = s32[1]{0} shift-right-logical(%maximum.47.92, %constant_5146_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.91"}
  %constant_5147_46 = s32[1]{0} constant({-1})
  %add.2981.91 = s32[1]{0} add(%shift-right-logical.20.91, %constant_5147_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.91"}
  %select.1269.91 = s32[1]{0} select(%and.302.91, %add.2981.91, %shift-right-logical.20.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.91"}
  %compare.1616.91 = pred[1]{0} compare(%select.1269.91, %constant_2166_54), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.91"}
  %add.2982.91 = s32[1]{0} add(%select.1269.91, %constant_5146_46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.91"}
  %select.1270.91 = s32[1]{0} select(%compare.1616.91, %add.2982.91, %select.1269.91), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.91"}
  %bitcast.21242.101 = s32[1,1]{1,0} bitcast(%select.1270.91), metadata={scheduling_name="bitcast.21242.101"}
  %concatenate.701.49 = s32[1,5]{1,0} concatenate(%constant_5148_32, %bitcast.21242.101, %constant_5148_32, %constant_5148_32, %constant_5148_32), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.49"}
  %bitcast.21290.48 = s32[5]{0} bitcast(%concatenate.701.49), metadata={scheduling_name="bitcast.21290.48"}
  %slice.2375.45 = s32[1]{0} slice(%bitcast.21290.48), slice={[1:2]}, metadata={scheduling_name="slice.2375.45"}
  %bitcast.24211.21 = s32[] bitcast(%slice.2375.45), metadata={scheduling_name="bitcast.24211.21"}
  %constant_1668_50 = s32[] constant(0)
  ROOT %dynamic-update-slice.403.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.493, %convert.4123.3, %bitcast.24211.21, %constant_1668_50, %constant_1668_50, /*index=5*/%constant_1668_50, %constant_1668_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.403.1"}
}

%fused_dynamic_update_slice.23 (param_0.494: bf16[2,1,1,6144,16384], param_1.2490: bf16[1,1,1,6144,16384], param_2.1838: bf16[6144,16384], param_3.1430: pred[], param_4.1429: s32[32], param_5.1306: u32[], param_6.1260: s32[9], param_7.1186: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.494 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.494"}
  %param_1.2490 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2490"}
  %convert.4128.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2490), metadata={scheduling_name="convert.4128.3"}
  %param_3.1430 = pred[] parameter(3), metadata={scheduling_name="param_3.1430"}
  %broadcast.5665.8 = pred[6144,16384]{1,0} broadcast(%param_3.1430), dimensions={}, metadata={scheduling_name="broadcast.5665.8"}
  %param_2.1838 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1838"}
  %constant_1658_17 = bf16[] constant(0)
  %broadcast.5667.8 = bf16[6144,16384]{1,0} broadcast(%constant_1658_17), dimensions={}, metadata={scheduling_name="broadcast.5667.8"}
  %select.1300.3 = bf16[6144,16384]{1,0} select(%broadcast.5665.8, %param_2.1838, %broadcast.5667.8), metadata={scheduling_name="select.1300.3"}
  %bitcast.23932.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1300.3), metadata={scheduling_name="bitcast.23932.7"}
  %convert.4129.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23932.7), metadata={scheduling_name="convert.4129.7"}
  %add.3047.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4128.3, %convert.4129.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3047.5"}
  %convert.4130.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.3047.5), metadata={scheduling_name="convert.4130.3"}
  %constant_5148_33 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1260 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1260"}
  %constant_1660_83 = s32[] constant(8)
  %param_7.1186 = s32[] parameter(7), metadata={scheduling_name="param_7.1186"}
  %subtract.247.123 = s32[] subtract(%constant_1660_83, %param_7.1186), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.123"}
  %dynamic-slice.1484.104 = s32[1]{0} dynamic-slice(%param_6.1260, %subtract.247.123), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.104"}
  %param_4.1429 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1429"}
  %param_5.1306 = u32[] parameter(5), metadata={scheduling_name="param_5.1306"}
  %dynamic-slice.1485.99 = s32[1]{0} dynamic-slice(%param_4.1429, %param_5.1306), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.99"}
  %subtract.248.94 = s32[1]{0} subtract(%dynamic-slice.1484.104, %dynamic-slice.1485.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.94"}
  %constant_2166_55 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.94 = s32[1]{0} maximum(%subtract.248.94, %constant_2166_55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.94"}
  %sign.27.93 = s32[1]{0} sign(%maximum.47.94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.93"}
  %constant_5144_50 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.93 = pred[1]{0} compare(%sign.27.93, %constant_5144_50), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.93"}
  %constant_5145_48 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.94 = s32[1]{0} and(%maximum.47.94, %constant_5145_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.94"}
  %compare.1615.94 = pred[1]{0} compare(%and.301.94, %constant_2166_55), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.94"}
  %and.302.93 = pred[1]{0} and(%compare.1614.93, %compare.1615.94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.93"}
  %constant_5146_47 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.93 = s32[1]{0} shift-right-logical(%maximum.47.94, %constant_5146_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.93"}
  %constant_5147_47 = s32[1]{0} constant({-1})
  %add.2981.93 = s32[1]{0} add(%shift-right-logical.20.93, %constant_5147_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.93"}
  %select.1269.93 = s32[1]{0} select(%and.302.93, %add.2981.93, %shift-right-logical.20.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.93"}
  %compare.1616.93 = pred[1]{0} compare(%select.1269.93, %constant_2166_55), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.93"}
  %add.2982.93 = s32[1]{0} add(%select.1269.93, %constant_5146_47), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.93"}
  %select.1270.93 = s32[1]{0} select(%compare.1616.93, %add.2982.93, %select.1269.93), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.93"}
  %bitcast.21242.103 = s32[1,1]{1,0} bitcast(%select.1270.93), metadata={scheduling_name="bitcast.21242.103"}
  %concatenate.701.51 = s32[1,5]{1,0} concatenate(%constant_5148_33, %bitcast.21242.103, %constant_5148_33, %constant_5148_33, %constant_5148_33), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.51"}
  %bitcast.21290.50 = s32[5]{0} bitcast(%concatenate.701.51), metadata={scheduling_name="bitcast.21290.50"}
  %slice.2375.47 = s32[1]{0} slice(%bitcast.21290.50), slice={[1:2]}, metadata={scheduling_name="slice.2375.47"}
  %bitcast.24211.22 = s32[] bitcast(%slice.2375.47), metadata={scheduling_name="bitcast.24211.22"}
  %constant_1668_79 = s32[] constant(0)
  ROOT %dynamic-update-slice.405.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.494, %convert.4130.3, %bitcast.24211.22, %constant_1668_79, %constant_1668_79, /*index=5*/%constant_1668_79, %constant_1668_79), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.405.1"}
}

%fused_dynamic_update_slice.24 (param_0.495: bf16[2,1,1,6144,16384], param_1.2441: bf16[1,1,1,6144,16384], param_2.1789: bf16[6144,16384], param_3.1378: pred[], param_4.1430: s32[32], param_5.1307: u32[], param_6.1261: s32[9], param_7.1187: s32[]) -> bf16[2,1,1,6144,16384] {
  %param_0.495 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.495"}
  %param_1.2441 = bf16[1,1,1,6144,16384]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2441"}
  %convert.4131.3 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%param_1.2441), metadata={scheduling_name="convert.4131.3"}
  %param_3.1378 = pred[] parameter(3), metadata={scheduling_name="param_3.1378"}
  %broadcast.5665.6 = pred[6144,16384]{1,0} broadcast(%param_3.1378), dimensions={}, metadata={scheduling_name="broadcast.5665.6"}
  %param_2.1789 = bf16[6144,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.1789"}
  %constant_1658_11 = bf16[] constant(0)
  %broadcast.5667.6 = bf16[6144,16384]{1,0} broadcast(%constant_1658_11), dimensions={}, metadata={scheduling_name="broadcast.5667.6"}
  %select.1301.3 = bf16[6144,16384]{1,0} select(%broadcast.5665.6, %param_2.1789, %broadcast.5667.6), metadata={scheduling_name="select.1301.3"}
  %bitcast.23960.7 = bf16[1,1,1,6144,16384]{4,3,2,1,0} bitcast(%select.1301.3), metadata={scheduling_name="bitcast.23960.7"}
  %convert.4133.7 = f32[1,1,1,6144,16384]{4,3,2,1,0} convert(%bitcast.23960.7), metadata={scheduling_name="convert.4133.7"}
  %add.3048.5 = f32[1,1,1,6144,16384]{4,3,2,1,0} add(%convert.4131.3, %convert.4133.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3048.5"}
  %convert.4135.3 = bf16[1,1,1,6144,16384]{4,3,2,1,0} convert(%add.3048.5), metadata={scheduling_name="convert.4135.3"}
  %constant_5148_34 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1261 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1261"}
  %constant_1660_84 = s32[] constant(8)
  %param_7.1187 = s32[] parameter(7), metadata={scheduling_name="param_7.1187"}
  %subtract.247.125 = s32[] subtract(%constant_1660_84, %param_7.1187), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.125"}
  %dynamic-slice.1484.106 = s32[1]{0} dynamic-slice(%param_6.1261, %subtract.247.125), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.106"}
  %param_4.1430 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1430"}
  %param_5.1307 = u32[] parameter(5), metadata={scheduling_name="param_5.1307"}
  %dynamic-slice.1485.101 = s32[1]{0} dynamic-slice(%param_4.1430, %param_5.1307), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.101"}
  %subtract.248.96 = s32[1]{0} subtract(%dynamic-slice.1484.106, %dynamic-slice.1485.101), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.96"}
  %constant_2166_56 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.96 = s32[1]{0} maximum(%subtract.248.96, %constant_2166_56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.96"}
  %sign.27.95 = s32[1]{0} sign(%maximum.47.96), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.95"}
  %constant_5144_51 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.95 = pred[1]{0} compare(%sign.27.95, %constant_5144_51), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.95"}
  %constant_5145_49 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.96 = s32[1]{0} and(%maximum.47.96, %constant_5145_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.96"}
  %compare.1615.96 = pred[1]{0} compare(%and.301.96, %constant_2166_56), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.96"}
  %and.302.95 = pred[1]{0} and(%compare.1614.95, %compare.1615.96), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.95"}
  %constant_5146_48 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.95 = s32[1]{0} shift-right-logical(%maximum.47.96, %constant_5146_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.95"}
  %constant_5147_48 = s32[1]{0} constant({-1})
  %add.2981.95 = s32[1]{0} add(%shift-right-logical.20.95, %constant_5147_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.95"}
  %select.1269.95 = s32[1]{0} select(%and.302.95, %add.2981.95, %shift-right-logical.20.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.95"}
  %compare.1616.95 = pred[1]{0} compare(%select.1269.95, %constant_2166_56), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.95"}
  %add.2982.95 = s32[1]{0} add(%select.1269.95, %constant_5146_48), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.95"}
  %select.1270.95 = s32[1]{0} select(%compare.1616.95, %add.2982.95, %select.1269.95), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.95"}
  %bitcast.21242.105 = s32[1,1]{1,0} bitcast(%select.1270.95), metadata={scheduling_name="bitcast.21242.105"}
  %concatenate.701.53 = s32[1,5]{1,0} concatenate(%constant_5148_34, %bitcast.21242.105, %constant_5148_34, %constant_5148_34, %constant_5148_34), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.53"}
  %bitcast.21290.52 = s32[5]{0} bitcast(%concatenate.701.53), metadata={scheduling_name="bitcast.21290.52"}
  %slice.2375.49 = s32[1]{0} slice(%bitcast.21290.52), slice={[1:2]}, metadata={scheduling_name="slice.2375.49"}
  %bitcast.24211.23 = s32[] bitcast(%slice.2375.49), metadata={scheduling_name="bitcast.24211.23"}
  %constant_1668_11 = s32[] constant(0)
  ROOT %dynamic-update-slice.406.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} dynamic-update-slice(%param_0.495, %convert.4135.3, %bitcast.24211.23, %constant_1668_11, %constant_1668_11, /*index=5*/%constant_1668_11, %constant_1668_11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.406.1"}
}

%fused_dynamic_update_slice.25 (param_0.496: bf16[2,1,1,16384,6144], param_1.2515: bf16[16384,6144], param_2.1861: bf16[1,1,1,16384,6144], param_3.1453: pred[], param_4.1431: s32[32], param_5.1308: u32[], param_6.1262: s32[9], param_7.1188: s32[]) -> bf16[2,1,1,16384,6144] {
  %param_0.496 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.496"}
  %param_2.1861 = bf16[1,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.1861"}
  %convert.4136.3 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.1861), metadata={scheduling_name="convert.4136.3"}
  %param_3.1453 = pred[] parameter(3), metadata={scheduling_name="param_3.1453"}
  %broadcast.5669.1 = pred[16384,6144]{1,0} broadcast(%param_3.1453), dimensions={}, metadata={scheduling_name="broadcast.5669.1"}
  %param_1.2515 = bf16[16384,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.2515"}
  %constant_1658_3 = bf16[] constant(0)
  %broadcast.5670.8 = bf16[16384,6144]{1,0} broadcast(%constant_1658_3), dimensions={}, metadata={scheduling_name="broadcast.5670.8"}
  %select.1302.5 = bf16[16384,6144]{1,0} select(%broadcast.5669.1, %param_1.2515, %broadcast.5670.8), metadata={scheduling_name="select.1302.5"}
  %bitcast.23990.7 = bf16[1,1,1,16384,6144]{4,3,2,1,0} bitcast(%select.1302.5), metadata={scheduling_name="bitcast.23990.7"}
  %convert.4137.7 = f32[1,1,1,16384,6144]{4,3,2,1,0} convert(%bitcast.23990.7), metadata={scheduling_name="convert.4137.7"}
  %add.3049.5 = f32[1,1,1,16384,6144]{4,3,2,1,0} add(%convert.4136.3, %convert.4137.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3049.5"}
  %convert.4138.3 = bf16[1,1,1,16384,6144]{4,3,2,1,0} convert(%add.3049.5), metadata={scheduling_name="convert.4138.3"}
  %constant_5148_35 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1262 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1262"}
  %constant_1660_85 = s32[] constant(8)
  %param_7.1188 = s32[] parameter(7), metadata={scheduling_name="param_7.1188"}
  %subtract.247.127 = s32[] subtract(%constant_1660_85, %param_7.1188), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.127"}
  %dynamic-slice.1484.108 = s32[1]{0} dynamic-slice(%param_6.1262, %subtract.247.127), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.108"}
  %param_4.1431 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1431"}
  %param_5.1308 = u32[] parameter(5), metadata={scheduling_name="param_5.1308"}
  %dynamic-slice.1485.103 = s32[1]{0} dynamic-slice(%param_4.1431, %param_5.1308), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.103"}
  %subtract.248.98 = s32[1]{0} subtract(%dynamic-slice.1484.108, %dynamic-slice.1485.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.98"}
  %constant_2166_57 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.98 = s32[1]{0} maximum(%subtract.248.98, %constant_2166_57), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.98"}
  %sign.27.97 = s32[1]{0} sign(%maximum.47.98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.97"}
  %constant_5144_52 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.97 = pred[1]{0} compare(%sign.27.97, %constant_5144_52), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.97"}
  %constant_5145_50 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.98 = s32[1]{0} and(%maximum.47.98, %constant_5145_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.98"}
  %compare.1615.98 = pred[1]{0} compare(%and.301.98, %constant_2166_57), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.98"}
  %and.302.97 = pred[1]{0} and(%compare.1614.97, %compare.1615.98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.97"}
  %constant_5146_49 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.97 = s32[1]{0} shift-right-logical(%maximum.47.98, %constant_5146_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.97"}
  %constant_5147_49 = s32[1]{0} constant({-1})
  %add.2981.97 = s32[1]{0} add(%shift-right-logical.20.97, %constant_5147_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.97"}
  %select.1269.97 = s32[1]{0} select(%and.302.97, %add.2981.97, %shift-right-logical.20.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.97"}
  %compare.1616.97 = pred[1]{0} compare(%select.1269.97, %constant_2166_57), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.97"}
  %add.2982.97 = s32[1]{0} add(%select.1269.97, %constant_5146_49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.97"}
  %select.1270.97 = s32[1]{0} select(%compare.1616.97, %add.2982.97, %select.1269.97), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.97"}
  %bitcast.21242.107 = s32[1,1]{1,0} bitcast(%select.1270.97), metadata={scheduling_name="bitcast.21242.107"}
  %concatenate.701.55 = s32[1,5]{1,0} concatenate(%constant_5148_35, %bitcast.21242.107, %constant_5148_35, %constant_5148_35, %constant_5148_35), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.55"}
  %bitcast.21290.54 = s32[5]{0} bitcast(%concatenate.701.55), metadata={scheduling_name="bitcast.21290.54"}
  %slice.2375.51 = s32[1]{0} slice(%bitcast.21290.54), slice={[1:2]}, metadata={scheduling_name="slice.2375.51"}
  %bitcast.24211.24 = s32[] bitcast(%slice.2375.51), metadata={scheduling_name="bitcast.24211.24"}
  %constant_1668_106 = s32[] constant(0)
  ROOT %dynamic-update-slice.407.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.496, %convert.4138.3, %bitcast.24211.24, %constant_1668_106, %constant_1668_106, /*index=5*/%constant_1668_106, %constant_1668_106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.407.1"}
}

%fused_dynamic_update_slice.26 (param_0.497: bf16[2,1,768,8,128], param_1.2483: bf16[1,1,768,8,128], param_2.1833: bf16[1,8,128,768], param_3.1425: pred[], param_4.1432: s32[32], param_5.1309: u32[], param_6.1263: s32[9], param_7.1189: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.497 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.497"}
  %param_1.2483 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2483"}
  %convert.4163.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2483), metadata={scheduling_name="convert.4163.3"}
  %param_3.1425 = pred[] parameter(3), metadata={scheduling_name="param_3.1425"}
  %broadcast.5682.10 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1425), dimensions={}, metadata={scheduling_name="broadcast.5682.10"}
  %param_2.1833 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1833"}
  %bitcast.24118.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1833), metadata={scheduling_name="bitcast.24118.3"}
  %constant_1658_44 = bf16[] constant(0)
  %broadcast.5683.10 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1658_44), dimensions={}, metadata={scheduling_name="broadcast.5683.10"}
  %select.1307.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5682.10, %bitcast.24118.3, %broadcast.5683.10), metadata={scheduling_name="select.1307.3"}
  %bitcast.24124.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1307.3), metadata={scheduling_name="bitcast.24124.7"}
  %convert.4164.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.24124.7), metadata={scheduling_name="convert.4164.7"}
  %add.3052.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4163.3, %convert.4164.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3052.5"}
  %convert.4165.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.3052.5), metadata={scheduling_name="convert.4165.3"}
  %constant_5148_36 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1263 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1263"}
  %constant_1660_86 = s32[] constant(8)
  %param_7.1189 = s32[] parameter(7), metadata={scheduling_name="param_7.1189"}
  %subtract.247.129 = s32[] subtract(%constant_1660_86, %param_7.1189), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.129"}
  %dynamic-slice.1484.110 = s32[1]{0} dynamic-slice(%param_6.1263, %subtract.247.129), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.110"}
  %param_4.1432 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1432"}
  %param_5.1309 = u32[] parameter(5), metadata={scheduling_name="param_5.1309"}
  %dynamic-slice.1485.105 = s32[1]{0} dynamic-slice(%param_4.1432, %param_5.1309), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.105"}
  %subtract.248.100 = s32[1]{0} subtract(%dynamic-slice.1484.110, %dynamic-slice.1485.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.100"}
  %constant_2166_58 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.100 = s32[1]{0} maximum(%subtract.248.100, %constant_2166_58), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.100"}
  %sign.27.99 = s32[1]{0} sign(%maximum.47.100), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.99"}
  %constant_5144_53 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.99 = pred[1]{0} compare(%sign.27.99, %constant_5144_53), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.99"}
  %constant_5145_51 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.100 = s32[1]{0} and(%maximum.47.100, %constant_5145_51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.100"}
  %compare.1615.100 = pred[1]{0} compare(%and.301.100, %constant_2166_58), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.100"}
  %and.302.99 = pred[1]{0} and(%compare.1614.99, %compare.1615.100), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.99"}
  %constant_5146_50 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.99 = s32[1]{0} shift-right-logical(%maximum.47.100, %constant_5146_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.99"}
  %constant_5147_50 = s32[1]{0} constant({-1})
  %add.2981.99 = s32[1]{0} add(%shift-right-logical.20.99, %constant_5147_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.99"}
  %select.1269.99 = s32[1]{0} select(%and.302.99, %add.2981.99, %shift-right-logical.20.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.99"}
  %compare.1616.99 = pred[1]{0} compare(%select.1269.99, %constant_2166_58), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.99"}
  %add.2982.99 = s32[1]{0} add(%select.1269.99, %constant_5146_50), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.99"}
  %select.1270.99 = s32[1]{0} select(%compare.1616.99, %add.2982.99, %select.1269.99), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.99"}
  %bitcast.21242.109 = s32[1,1]{1,0} bitcast(%select.1270.99), metadata={scheduling_name="bitcast.21242.109"}
  %concatenate.701.57 = s32[1,5]{1,0} concatenate(%constant_5148_36, %bitcast.21242.109, %constant_5148_36, %constant_5148_36, %constant_5148_36), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.57"}
  %bitcast.21290.56 = s32[5]{0} bitcast(%concatenate.701.57), metadata={scheduling_name="bitcast.21290.56"}
  %slice.2375.53 = s32[1]{0} slice(%bitcast.21290.56), slice={[1:2]}, metadata={scheduling_name="slice.2375.53"}
  %bitcast.24211.25 = s32[] bitcast(%slice.2375.53), metadata={scheduling_name="bitcast.24211.25"}
  %constant_1668_70 = s32[] constant(0)
  ROOT %dynamic-update-slice.410.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.497, %convert.4165.3, %bitcast.24211.25, %constant_1668_70, %constant_1668_70, /*index=5*/%constant_1668_70, %constant_1668_70), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.410.1"}
}

%fused_dynamic_update_slice.27 (param_0.498: bf16[2,1,768,48,128], param_1.2481: bf16[1,1,768,48,128], param_2.1831: bf16[1,48,128,768], param_3.1423: pred[], param_4.1434: s32[32], param_5.1311: u32[], param_6.1265: s32[9], param_7.1191: s32[]) -> bf16[2,1,768,48,128] {
  %param_0.498 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.498"}
  %param_1.2481 = bf16[1,1,768,48,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2481"}
  %convert.4171.3 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%param_1.2481), metadata={scheduling_name="convert.4171.3"}
  %param_3.1423 = pred[] parameter(3), metadata={scheduling_name="param_3.1423"}
  %broadcast.5684.12 = pred[768,1,48,128]{3,2,1,0} broadcast(%param_3.1423), dimensions={}, metadata={scheduling_name="broadcast.5684.12"}
  %param_2.1831 = bf16[1,48,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1831"}
  %bitcast.24194.3 = bf16[768,1,48,128]{3,2,1,0} bitcast(%param_2.1831), metadata={scheduling_name="bitcast.24194.3"}
  %constant_1658_14 = bf16[] constant(0)
  %broadcast.5685.12 = bf16[768,1,48,128]{3,2,1,0} broadcast(%constant_1658_14), dimensions={}, metadata={scheduling_name="broadcast.5685.12"}
  %select.1309.3 = bf16[768,1,48,128]{3,2,1,0} select(%broadcast.5684.12, %bitcast.24194.3, %broadcast.5685.12), metadata={scheduling_name="select.1309.3"}
  %bitcast.24200.7 = bf16[1,1,768,48,128]{4,3,2,1,0} bitcast(%select.1309.3), metadata={scheduling_name="bitcast.24200.7"}
  %convert.4172.7 = f32[1,1,768,48,128]{4,3,2,1,0} convert(%bitcast.24200.7), metadata={scheduling_name="convert.4172.7"}
  %add.3054.5 = f32[1,1,768,48,128]{4,3,2,1,0} add(%convert.4171.3, %convert.4172.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3054.5"}
  %convert.4173.3 = bf16[1,1,768,48,128]{4,3,2,1,0} convert(%add.3054.5), metadata={scheduling_name="convert.4173.3"}
  %constant_5148_38 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1265 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1265"}
  %constant_1660_88 = s32[] constant(8)
  %param_7.1191 = s32[] parameter(7), metadata={scheduling_name="param_7.1191"}
  %subtract.247.133 = s32[] subtract(%constant_1660_88, %param_7.1191), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.133"}
  %dynamic-slice.1484.114 = s32[1]{0} dynamic-slice(%param_6.1265, %subtract.247.133), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.114"}
  %param_4.1434 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1434"}
  %param_5.1311 = u32[] parameter(5), metadata={scheduling_name="param_5.1311"}
  %dynamic-slice.1485.109 = s32[1]{0} dynamic-slice(%param_4.1434, %param_5.1311), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.109"}
  %subtract.248.104 = s32[1]{0} subtract(%dynamic-slice.1484.114, %dynamic-slice.1485.109), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.104"}
  %constant_2166_60 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.104 = s32[1]{0} maximum(%subtract.248.104, %constant_2166_60), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.104"}
  %sign.27.103 = s32[1]{0} sign(%maximum.47.104), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.103"}
  %constant_5144_55 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.103 = pred[1]{0} compare(%sign.27.103, %constant_5144_55), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.103"}
  %constant_5145_53 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.104 = s32[1]{0} and(%maximum.47.104, %constant_5145_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.104"}
  %compare.1615.104 = pred[1]{0} compare(%and.301.104, %constant_2166_60), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.104"}
  %and.302.103 = pred[1]{0} and(%compare.1614.103, %compare.1615.104), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.103"}
  %constant_5146_52 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.103 = s32[1]{0} shift-right-logical(%maximum.47.104, %constant_5146_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.103"}
  %constant_5147_52 = s32[1]{0} constant({-1})
  %add.2981.103 = s32[1]{0} add(%shift-right-logical.20.103, %constant_5147_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.103"}
  %select.1269.103 = s32[1]{0} select(%and.302.103, %add.2981.103, %shift-right-logical.20.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.103"}
  %compare.1616.103 = pred[1]{0} compare(%select.1269.103, %constant_2166_60), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.103"}
  %add.2982.103 = s32[1]{0} add(%select.1269.103, %constant_5146_52), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.103"}
  %select.1270.103 = s32[1]{0} select(%compare.1616.103, %add.2982.103, %select.1269.103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.103"}
  %bitcast.21242.113 = s32[1,1]{1,0} bitcast(%select.1270.103), metadata={scheduling_name="bitcast.21242.113"}
  %concatenate.701.61 = s32[1,5]{1,0} concatenate(%constant_5148_38, %bitcast.21242.113, %constant_5148_38, %constant_5148_38, %constant_5148_38), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.61"}
  %bitcast.21290.60 = s32[5]{0} bitcast(%concatenate.701.61), metadata={scheduling_name="bitcast.21290.60"}
  %slice.2375.57 = s32[1]{0} slice(%bitcast.21290.60), slice={[1:2]}, metadata={scheduling_name="slice.2375.57"}
  %bitcast.24211.27 = s32[] bitcast(%slice.2375.57), metadata={scheduling_name="bitcast.24211.27"}
  %constant_1668_68 = s32[] constant(0)
  ROOT %dynamic-update-slice.412.1 = bf16[2,1,768,48,128]{4,3,2,1,0} dynamic-update-slice(%param_0.498, %convert.4173.3, %bitcast.24211.27, %constant_1668_68, %constant_1668_68, /*index=5*/%constant_1668_68, %constant_1668_68), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.412.1"}
}

%fused_dynamic_update_slice.28 (param_0.499: bf16[2,1,768,8,128], param_1.2509: bf16[1,1,768,8,128], param_2.1855: bf16[1,8,128,768], param_3.1448: pred[], param_4.1435: s32[32], param_5.1312: u32[], param_6.1266: s32[9], param_7.1192: s32[]) -> bf16[2,1,768,8,128] {
  %param_0.499 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.499"}
  %param_1.2509 = bf16[1,1,768,8,128]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2509"}
  %convert.4174.3 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%param_1.2509), metadata={scheduling_name="convert.4174.3"}
  %param_3.1448 = pred[] parameter(3), metadata={scheduling_name="param_3.1448"}
  %broadcast.5682.12 = pred[768,1,8,128]{3,2,1,0} broadcast(%param_3.1448), dimensions={}, metadata={scheduling_name="broadcast.5682.12"}
  %param_2.1855 = bf16[1,8,128,768]{2,1,0,3} parameter(2), metadata={scheduling_name="param_2.1855"}
  %bitcast.24230.3 = bf16[768,1,8,128]{3,2,1,0} bitcast(%param_2.1855), metadata={scheduling_name="bitcast.24230.3"}
  %constant_1658_13 = bf16[] constant(0)
  %broadcast.5683.12 = bf16[768,1,8,128]{3,2,1,0} broadcast(%constant_1658_13), dimensions={}, metadata={scheduling_name="broadcast.5683.12"}
  %select.1310.3 = bf16[768,1,8,128]{3,2,1,0} select(%broadcast.5682.12, %bitcast.24230.3, %broadcast.5683.12), metadata={scheduling_name="select.1310.3"}
  %bitcast.24236.7 = bf16[1,1,768,8,128]{4,3,2,1,0} bitcast(%select.1310.3), metadata={scheduling_name="bitcast.24236.7"}
  %convert.4175.7 = f32[1,1,768,8,128]{4,3,2,1,0} convert(%bitcast.24236.7), metadata={scheduling_name="convert.4175.7"}
  %add.3055.5 = f32[1,1,768,8,128]{4,3,2,1,0} add(%convert.4174.3, %convert.4175.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3055.5"}
  %convert.4177.3 = bf16[1,1,768,8,128]{4,3,2,1,0} convert(%add.3055.5), metadata={scheduling_name="convert.4177.3"}
  %constant_5148_39 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1266 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1266"}
  %constant_1660_89 = s32[] constant(8)
  %param_7.1192 = s32[] parameter(7), metadata={scheduling_name="param_7.1192"}
  %subtract.247.135 = s32[] subtract(%constant_1660_89, %param_7.1192), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.135"}
  %dynamic-slice.1484.116 = s32[1]{0} dynamic-slice(%param_6.1266, %subtract.247.135), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.116"}
  %param_4.1435 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1435"}
  %param_5.1312 = u32[] parameter(5), metadata={scheduling_name="param_5.1312"}
  %dynamic-slice.1485.111 = s32[1]{0} dynamic-slice(%param_4.1435, %param_5.1312), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.111"}
  %subtract.248.106 = s32[1]{0} subtract(%dynamic-slice.1484.116, %dynamic-slice.1485.111), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.106"}
  %constant_2166_61 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.106 = s32[1]{0} maximum(%subtract.248.106, %constant_2166_61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.106"}
  %sign.27.105 = s32[1]{0} sign(%maximum.47.106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.105"}
  %constant_5144_56 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.105 = pred[1]{0} compare(%sign.27.105, %constant_5144_56), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.105"}
  %constant_5145_54 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.106 = s32[1]{0} and(%maximum.47.106, %constant_5145_54), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.106"}
  %compare.1615.106 = pred[1]{0} compare(%and.301.106, %constant_2166_61), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.106"}
  %and.302.105 = pred[1]{0} and(%compare.1614.105, %compare.1615.106), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.105"}
  %constant_5146_53 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.105 = s32[1]{0} shift-right-logical(%maximum.47.106, %constant_5146_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.105"}
  %constant_5147_53 = s32[1]{0} constant({-1})
  %add.2981.105 = s32[1]{0} add(%shift-right-logical.20.105, %constant_5147_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.105"}
  %select.1269.105 = s32[1]{0} select(%and.302.105, %add.2981.105, %shift-right-logical.20.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.105"}
  %compare.1616.105 = pred[1]{0} compare(%select.1269.105, %constant_2166_61), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.105"}
  %add.2982.105 = s32[1]{0} add(%select.1269.105, %constant_5146_53), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.105"}
  %select.1270.105 = s32[1]{0} select(%compare.1616.105, %add.2982.105, %select.1269.105), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.105"}
  %bitcast.21242.115 = s32[1,1]{1,0} bitcast(%select.1270.105), metadata={scheduling_name="bitcast.21242.115"}
  %concatenate.701.63 = s32[1,5]{1,0} concatenate(%constant_5148_39, %bitcast.21242.115, %constant_5148_39, %constant_5148_39, %constant_5148_39), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.63"}
  %bitcast.21290.62 = s32[5]{0} bitcast(%concatenate.701.63), metadata={scheduling_name="bitcast.21290.62"}
  %slice.2375.59 = s32[1]{0} slice(%bitcast.21290.62), slice={[1:2]}, metadata={scheduling_name="slice.2375.59"}
  %bitcast.24211.28 = s32[] bitcast(%slice.2375.59), metadata={scheduling_name="bitcast.24211.28"}
  %constant_1668_100 = s32[] constant(0)
  ROOT %dynamic-update-slice.413.1 = bf16[2,1,768,8,128]{4,3,2,1,0} dynamic-update-slice(%param_0.499, %convert.4177.3, %bitcast.24211.28, %constant_1668_100, %constant_1668_100, /*index=5*/%constant_1668_100, %constant_1668_100), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.413.1"}
}

%fused_dynamic_slice.21 (param_0.510: bf16[2,1,768,8,128], param_1.2618: s32[32], param_2.2034: u32[], param_3.1678: s32[9], param_4.1446: s32[], param_5.2666: bf16[2,1,768,8,128], param_6.2436: bf16[2,1,768,8,128], param_7.2240: bf16[2,1,768,8,128], param_8.2081: bf16[2,1,768,8,128], param_9.1805: bf16[2,1,768,8,128], param_10.1418: bf16[2,1,768,8,128], param_11.1320: bf16[2,1,768,8,128]) -> (bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128], /*index=5*/bf16[1,1,768,8,128], bf16[1,1,768,8,128], bf16[1,1,768,8,128]) {
  %param_0.510 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.510"}
  %constant_5148_50 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1678 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1678"}
  %constant_1660_11 = s32[] constant(8)
  %param_4.1446 = s32[] parameter(4), metadata={scheduling_name="param_4.1446"}
  %subtract.247.157 = s32[] subtract(%constant_1660_11, %param_4.1446), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.157"}
  %dynamic-slice.1484.138 = s32[1]{0} dynamic-slice(%param_3.1678, %subtract.247.157), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.138"}
  %param_1.2618 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1.2618"}
  %param_2.2034 = u32[] parameter(2), metadata={scheduling_name="param_2.2034"}
  %dynamic-slice.1485.133 = s32[1]{0} dynamic-slice(%param_1.2618, %param_2.2034), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.133"}
  %subtract.248.128 = s32[1]{0} subtract(%dynamic-slice.1484.138, %dynamic-slice.1485.133), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.128"}
  %constant_2166_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.128 = s32[1]{0} maximum(%subtract.248.128, %constant_2166_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.128"}
  %sign.27.127 = s32[1]{0} sign(%maximum.47.128), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.127"}
  %constant_5144_2 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.127 = pred[1]{0} compare(%sign.27.127, %constant_5144_2), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.127"}
  %constant_5145_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.128 = s32[1]{0} and(%maximum.47.128, %constant_5145_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.128"}
  %compare.1615.128 = pred[1]{0} compare(%and.301.128, %constant_2166_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.128"}
  %and.302.127 = pred[1]{0} and(%compare.1614.127, %compare.1615.128), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.127"}
  %constant_5146_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.127 = s32[1]{0} shift-right-logical(%maximum.47.128, %constant_5146_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.127"}
  %constant_5147_1 = s32[1]{0} constant({-1})
  %add.2981.127 = s32[1]{0} add(%shift-right-logical.20.127, %constant_5147_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.127"}
  %select.1269.127 = s32[1]{0} select(%and.302.127, %add.2981.127, %shift-right-logical.20.127), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.127"}
  %compare.1616.127 = pred[1]{0} compare(%select.1269.127, %constant_2166_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.127"}
  %add.2982.127 = s32[1]{0} add(%select.1269.127, %constant_5146_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.127"}
  %select.1270.127 = s32[1]{0} select(%compare.1616.127, %add.2982.127, %select.1269.127), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.127"}
  %bitcast.21242.137 = s32[1,1]{1,0} bitcast(%select.1270.127), metadata={scheduling_name="bitcast.21242.137"}
  %concatenate.701.85 = s32[1,5]{1,0} concatenate(%constant_5148_50, %bitcast.21242.137, %constant_5148_50, %constant_5148_50, %constant_5148_50), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.701.85"}
  %bitcast.21290.84 = s32[5]{0} bitcast(%concatenate.701.85), metadata={scheduling_name="bitcast.21290.84"}
  %slice.2375.81 = s32[1]{0} slice(%bitcast.21290.84), slice={[1:2]}, metadata={scheduling_name="slice.2375.81"}
  %bitcast.24211.39 = s32[] bitcast(%slice.2375.81), metadata={scheduling_name="bitcast.24211.39"}
  %constant_1668_72 = s32[] constant(0)
  %dynamic-slice.1534.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_0.510, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1534.1"}
  %param_5.2666 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2666"}
  %dynamic-slice.1537.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_5.2666, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1537.1.clone.1"}
  %param_6.2436 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2436"}
  %dynamic-slice.1506.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_6.2436, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1506.1.clone.1"}
  %param_7.2240 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2240"}
  %dynamic-slice.1507.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_7.2240, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1507.1.clone.1"}
  %param_8.2081 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2081"}
  %dynamic-slice.1520.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_8.2081, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1520.1.clone.1"}
  %param_9.1805 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(9), metadata={scheduling_name="param_9.1805"}
  %dynamic-slice.1521.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_9.1805, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1521.1.clone.1"}
  %param_10.1418 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1418"}
  %dynamic-slice.1524.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_10.1418, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1524.1.clone.1"}
  %param_11.1320 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(11), metadata={scheduling_name="param_11.1320"}
  %dynamic-slice.1527.1.clone.1 = bf16[1,1,768,8,128]{4,3,2,1,0} dynamic-slice(%param_11.1320, %bitcast.24211.39, %constant_1668_72, %constant_1668_72, %constant_1668_72, /*index=5*/%constant_1668_72), dynamic_slice_sizes={1,1,768,8,128}, metadata={scheduling_name="dynamic-slice.1527.1.clone.1"}
  ROOT %tuple.515 = (bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}) tuple(%dynamic-slice.1534.1, %dynamic-slice.1537.1.clone.1, %dynamic-slice.1506.1.clone.1, %dynamic-slice.1507.1.clone.1, %dynamic-slice.1520.1.clone.1, /*index=5*/%dynamic-slice.1521.1.clone.1, %dynamic-slice.1524.1.clone.1, %dynamic-slice.1527.1.clone.1), metadata={scheduling_name="tuple.515"}
}

%fused_dynamic_update_slice.29 (param_0.521: bf16[2,1,768,8], param_1.2589: bf16[1,1,768,8], param_2.2005: bf16[1,768,8], param_3.1649: pred[], param_4.1403: s32[32], param_5.1297: u32[], param_6.1251: s32[9], param_7.1177: s32[]) -> bf16[2,1,768,8] {
  %param_0.521 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.521"}
  %param_1.2589 = bf16[1,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2589"}
  %convert.3886.3 = f32[1,1,768,8]{3,2,1,0} convert(%param_1.2589), metadata={scheduling_name="convert.3886.3"}
  %param_3.1649 = pred[] parameter(3), metadata={scheduling_name="param_3.1649"}
  %broadcast.5570.2 = pred[768,1,8]{2,1,0} broadcast(%param_3.1649), dimensions={}, metadata={scheduling_name="broadcast.5570.2"}
  %param_2.2005 = bf16[1,768,8]{2,0,1} parameter(2), metadata={scheduling_name="param_2.2005"}
  %bitcast.23025.3 = bf16[768,1,8]{2,1,0} bitcast(%param_2.2005), metadata={scheduling_name="bitcast.23025.3"}
  %constant_1658_51 = bf16[] constant(0)
  %broadcast.5663.1 = bf16[768,1,8]{2,1,0} broadcast(%constant_1658_51), dimensions={}, metadata={scheduling_name="broadcast.5663.1"}
  %select.1288.3 = bf16[768,1,8]{2,1,0} select(%broadcast.5570.2, %bitcast.23025.3, %broadcast.5663.1), metadata={scheduling_name="select.1288.3"}
  %bitcast.23031.7 = bf16[1,1,768,8]{3,2,1,0} bitcast(%select.1288.3), metadata={scheduling_name="bitcast.23031.7"}
  %convert.4027.7 = f32[1,1,768,8]{3,2,1,0} convert(%bitcast.23031.7), metadata={scheduling_name="convert.4027.7"}
  %add.3025.5 = f32[1,1,768,8]{3,2,1,0} add(%convert.3886.3, %convert.4027.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3025.5"}
  %convert.4028.3 = bf16[1,1,768,8]{3,2,1,0} convert(%add.3025.5), metadata={scheduling_name="convert.4028.3"}
  %constant_5148_7 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1251 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1251"}
  %constant_1660_45 = s32[] constant(8)
  %param_7.1177 = s32[] parameter(7), metadata={scheduling_name="param_7.1177"}
  %subtract.247.47 = s32[] subtract(%constant_1660_45, %param_7.1177), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.47"}
  %dynamic-slice.1484.28 = s32[1]{0} dynamic-slice(%param_6.1251, %subtract.247.47), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.28"}
  %param_4.1403 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1403"}
  %param_5.1297 = u32[] parameter(5), metadata={scheduling_name="param_5.1297"}
  %dynamic-slice.1485.23 = s32[1]{0} dynamic-slice(%param_4.1403, %param_5.1297), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.23"}
  %subtract.248.18 = s32[1]{0} subtract(%dynamic-slice.1484.28, %dynamic-slice.1485.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.18"}
  %constant_2166_18 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.18 = s32[1]{0} maximum(%subtract.248.18, %constant_2166_18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.18"}
  %sign.27.17 = s32[1]{0} sign(%maximum.47.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.17"}
  %constant_5144_12 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.17 = pred[1]{0} compare(%sign.27.17, %constant_5144_12), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.17"}
  %constant_5145_10 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.18 = s32[1]{0} and(%maximum.47.18, %constant_5145_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.18"}
  %compare.1615.18 = pred[1]{0} compare(%and.301.18, %constant_2166_18), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.18"}
  %and.302.17 = pred[1]{0} and(%compare.1614.17, %compare.1615.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.17"}
  %constant_5146_9 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.17 = s32[1]{0} shift-right-logical(%maximum.47.18, %constant_5146_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.17"}
  %constant_5147_9 = s32[1]{0} constant({-1})
  %add.2981.17 = s32[1]{0} add(%shift-right-logical.20.17, %constant_5147_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.17"}
  %select.1269.17 = s32[1]{0} select(%and.302.17, %add.2981.17, %shift-right-logical.20.17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.17"}
  %compare.1616.17 = pred[1]{0} compare(%select.1269.17, %constant_2166_18), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.17"}
  %add.2982.17 = s32[1]{0} add(%select.1269.17, %constant_5146_9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.17"}
  %select.1270.17 = s32[1]{0} select(%compare.1616.17, %add.2982.17, %select.1269.17), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.17"}
  %bitcast.21242.15 = s32[1,1]{1,0} bitcast(%select.1270.17), metadata={scheduling_name="bitcast.21242.15"}
  %concatenate.699.13 = s32[1,4]{1,0} concatenate(%constant_5148_7, %bitcast.21242.15, %constant_5148_7, %constant_5148_7), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.13"}
  %bitcast.21245.10 = s32[4]{0} bitcast(%concatenate.699.13), metadata={scheduling_name="bitcast.21245.10"}
  %slice.2373.9 = s32[1]{0} slice(%bitcast.21245.10), slice={[1:2]}, metadata={scheduling_name="slice.2373.9"}
  %bitcast.23877.3 = s32[] bitcast(%slice.2373.9), metadata={scheduling_name="bitcast.23877.3"}
  %constant_1668_109 = s32[] constant(0)
  ROOT %dynamic-update-slice.394.1 = bf16[2,1,768,8]{3,2,1,0} dynamic-update-slice(%param_0.521, %convert.4028.3, %bitcast.23877.3, %constant_1668_109, %constant_1668_109, /*index=5*/%constant_1668_109), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.394.1"}
}

%fused_dynamic_update_slice.30 (param_0.522: bf16[2,1,768,8], param_1.2590: bf16[1,1,768,8], param_2.2006: bf16[1,768,8], param_3.1650: pred[], param_4.1404: s32[32], param_5.1298: u32[], param_6.1252: s32[9], param_7.1178: s32[]) -> bf16[2,1,768,8] {
  %param_0.522 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.522"}
  %param_1.2590 = bf16[1,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2590"}
  %convert.4124.3 = f32[1,1,768,8]{3,2,1,0} convert(%param_1.2590), metadata={scheduling_name="convert.4124.3"}
  %param_3.1650 = pred[] parameter(3), metadata={scheduling_name="param_3.1650"}
  %broadcast.5570.1 = pred[768,1,8]{2,1,0} broadcast(%param_3.1650), dimensions={}, metadata={scheduling_name="broadcast.5570.1"}
  %param_2.2006 = bf16[1,768,8]{2,0,1} parameter(2), metadata={scheduling_name="param_2.2006"}
  %bitcast.23896.3 = bf16[768,1,8]{2,1,0} bitcast(%param_2.2006), metadata={scheduling_name="bitcast.23896.3"}
  %constant_1658_10 = bf16[] constant(0)
  %broadcast.5663.2 = bf16[768,1,8]{2,1,0} broadcast(%constant_1658_10), dimensions={}, metadata={scheduling_name="broadcast.5663.2"}
  %select.1299.3 = bf16[768,1,8]{2,1,0} select(%broadcast.5570.1, %bitcast.23896.3, %broadcast.5663.2), metadata={scheduling_name="select.1299.3"}
  %bitcast.23902.7 = bf16[1,1,768,8]{3,2,1,0} bitcast(%select.1299.3), metadata={scheduling_name="bitcast.23902.7"}
  %convert.4125.7 = f32[1,1,768,8]{3,2,1,0} convert(%bitcast.23902.7), metadata={scheduling_name="convert.4125.7"}
  %add.3046.5 = f32[1,1,768,8]{3,2,1,0} add(%convert.4124.3, %convert.4125.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.3046.5"}
  %convert.4127.3 = bf16[1,1,768,8]{3,2,1,0} convert(%add.3046.5), metadata={scheduling_name="convert.4127.3"}
  %constant_5148_8 = s32[1,1]{1,0} constant({ {0} })
  %param_6.1252 = s32[9]{0} parameter(6), metadata={scheduling_name="param_6.1252"}
  %constant_1660_46 = s32[] constant(8)
  %param_7.1178 = s32[] parameter(7), metadata={scheduling_name="param_7.1178"}
  %subtract.247.49 = s32[] subtract(%constant_1660_46, %param_7.1178), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.49"}
  %dynamic-slice.1484.30 = s32[1]{0} dynamic-slice(%param_6.1252, %subtract.247.49), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.30"}
  %param_4.1404 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.1404"}
  %param_5.1298 = u32[] parameter(5), metadata={scheduling_name="param_5.1298"}
  %dynamic-slice.1485.25 = s32[1]{0} dynamic-slice(%param_4.1404, %param_5.1298), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.25"}
  %subtract.248.20 = s32[1]{0} subtract(%dynamic-slice.1484.30, %dynamic-slice.1485.25), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.20"}
  %constant_2166_19 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.20 = s32[1]{0} maximum(%subtract.248.20, %constant_2166_19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.20"}
  %sign.27.19 = s32[1]{0} sign(%maximum.47.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.19"}
  %constant_5144_13 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.19 = pred[1]{0} compare(%sign.27.19, %constant_5144_13), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.19"}
  %constant_5145_11 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.20 = s32[1]{0} and(%maximum.47.20, %constant_5145_11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.20"}
  %compare.1615.20 = pred[1]{0} compare(%and.301.20, %constant_2166_19), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.20"}
  %and.302.19 = pred[1]{0} and(%compare.1614.19, %compare.1615.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.19"}
  %constant_5146_10 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.19 = s32[1]{0} shift-right-logical(%maximum.47.20, %constant_5146_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.19"}
  %constant_5147_10 = s32[1]{0} constant({-1})
  %add.2981.19 = s32[1]{0} add(%shift-right-logical.20.19, %constant_5147_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.19"}
  %select.1269.19 = s32[1]{0} select(%and.302.19, %add.2981.19, %shift-right-logical.20.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.19"}
  %compare.1616.19 = pred[1]{0} compare(%select.1269.19, %constant_2166_19), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.19"}
  %add.2982.19 = s32[1]{0} add(%select.1269.19, %constant_5146_10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.19"}
  %select.1270.19 = s32[1]{0} select(%compare.1616.19, %add.2982.19, %select.1269.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.19"}
  %bitcast.21242.17 = s32[1,1]{1,0} bitcast(%select.1270.19), metadata={scheduling_name="bitcast.21242.17"}
  %concatenate.699.15 = s32[1,4]{1,0} concatenate(%constant_5148_8, %bitcast.21242.17, %constant_5148_8, %constant_5148_8), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.15"}
  %bitcast.21245.12 = s32[4]{0} bitcast(%concatenate.699.15), metadata={scheduling_name="bitcast.21245.12"}
  %slice.2373.11 = s32[1]{0} slice(%bitcast.21245.12), slice={[1:2]}, metadata={scheduling_name="slice.2373.11"}
  %bitcast.23877.4 = s32[] bitcast(%slice.2373.11), metadata={scheduling_name="bitcast.23877.4"}
  %constant_1668_110 = s32[] constant(0)
  ROOT %dynamic-update-slice.404.1 = bf16[2,1,768,8]{3,2,1,0} dynamic-update-slice(%param_0.522, %convert.4127.3, %bitcast.23877.4, %constant_1668_110, %constant_1668_110, /*index=5*/%constant_1668_110), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-update-slice.404.1"}
}

%fused_convert.9 (param_0.643: bf16[65536,16384], param_1.865: bf16[65536,16384], param_2.4659: bf16[65536,16384]) -> (bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384]) {
  %param_1.865 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.865"}
  %bitcast.22871.23 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.865), metadata={scheduling_name="bitcast.22871.23"}
  %convert.4010.23 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22871.23), metadata={scheduling_name="convert.4010.23"}
  %constant_1931_7 = bf16[] constant(1)
  %convert.4981.5 = f32[] convert(%constant_1931_7), metadata={scheduling_name="convert.4981.5"}
  %broadcast.6034.38 = f32[1,1,32,2048,16384]{4,3,2,1,0} broadcast(%convert.4981.5), dimensions={}, metadata={scheduling_name="broadcast.6034.38"}
  %negate.218.11 = f32[1,1,32,2048,16384]{4,3,2,1,0} negate(%convert.4010.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="negate.218.11"}
  %exponential.96.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} exponential(%negate.218.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="exponential.96.9"}
  %add.3023.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%exponential.96.9, %broadcast.6034.38), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.3023.9"}
  %divide.467.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} divide(%broadcast.6034.38, %add.3023.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="divide.467.7"}
  %multiply.2642.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4010.23, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2642.3"}
  %param_0.643 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.643"}
  %bitcast.23100.7 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.643), metadata={scheduling_name="bitcast.23100.7"}
  %convert.4030.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.23100.7), metadata={scheduling_name="convert.4030.7"}
  %multiply.2655.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2642.3, %convert.4030.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2655.3"}
  %convert.4039.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2655.3), metadata={scheduling_name="convert.4039.1"}
  %param_2.4659 = bf16[65536,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.4659"}
  %bitcast.22903.9.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_2.4659), metadata={scheduling_name="bitcast.22903.9.clone.1"}
  %convert.4014.9.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22903.9.clone.1), metadata={scheduling_name="convert.4014.9.clone.1"}
  %multiply.2650.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4030.7, %convert.4014.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2650.3.clone.1"}
  %multiply.2651.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2650.3.clone.1, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2651.1.clone.1"}
  %multiply.2652.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.4010.23, %multiply.2650.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2652.5.clone.1"}
  %subtract.256.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} subtract(%broadcast.6034.38, %divide.467.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="subtract.256.5.clone.1"}
  %multiply.2653.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%divide.467.7, %subtract.256.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2653.3.clone.1"}
  %multiply.2654.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2652.5.clone.1, %multiply.2653.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2654.3.clone.1"}
  %add.3026.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%multiply.2651.1.clone.1, %multiply.2654.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.3026.1.clone.1"}
  %convert.4034.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%add.3026.1.clone.1), metadata={scheduling_name="convert.4034.1.clone.1"}
  %multiply.2643.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2642.3, %convert.4014.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2643.3.clone.1"}
  %convert.4015.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2643.3.clone.1), metadata={scheduling_name="convert.4015.1.clone.1"}
  ROOT %tuple.480 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) tuple(%convert.4039.1, %convert.4034.1.clone.1, %convert.4015.1.clone.1), metadata={scheduling_name="tuple.480"}
}

%fused_convert.10 (param_0.647: bf16[65536,16384], param_1.866: bf16[65536,16384], param_2.4690: bf16[65536,16384]) -> (bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384], bf16[1,1,32,2048,16384]) {
  %param_1.866 = bf16[65536,16384]{1,0} parameter(1), metadata={scheduling_name="param_1.866"}
  %bitcast.21930.23 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_1.866), metadata={scheduling_name="bitcast.21930.23"}
  %convert.3917.23 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.21930.23), metadata={scheduling_name="convert.3917.23"}
  %constant_1931_1 = bf16[] constant(1)
  %convert.4981.6 = f32[] convert(%constant_1931_1), metadata={scheduling_name="convert.4981.6"}
  %broadcast.6034.46 = f32[1,1,32,2048,16384]{4,3,2,1,0} broadcast(%convert.4981.6), dimensions={}, metadata={scheduling_name="broadcast.6034.46"}
  %negate.214.11 = f32[1,1,32,2048,16384]{4,3,2,1,0} negate(%convert.3917.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/neg" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="negate.214.11"}
  %exponential.94.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} exponential(%negate.214.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/exp" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="exponential.94.9"}
  %add.3000.9 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%exponential.94.9, %broadcast.6034.46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.3000.9"}
  %divide.460.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} divide(%broadcast.6034.46, %add.3000.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/div" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="divide.460.7"}
  %multiply.2587.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3917.23, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2587.3"}
  %param_0.647 = bf16[65536,16384]{1,0} parameter(0), metadata={scheduling_name="param_0.647"}
  %bitcast.22010.7 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_0.647), metadata={scheduling_name="bitcast.22010.7"}
  %convert.3925.7 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.22010.7), metadata={scheduling_name="convert.3925.7"}
  %multiply.2594.3 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2587.3, %convert.3925.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2594.3"}
  %convert.3930.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2594.3), metadata={scheduling_name="convert.3930.1"}
  %param_2.4690 = bf16[65536,16384]{1,0} parameter(2), metadata={scheduling_name="param_2.4690"}
  %bitcast.21983.9.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} bitcast(%param_2.4690), metadata={scheduling_name="bitcast.21983.9.clone.1"}
  %convert.3922.9.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} convert(%bitcast.21983.9.clone.1), metadata={scheduling_name="convert.3922.9.clone.1"}
  %multiply.2589.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3922.9.clone.1, %convert.3925.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2589.3.clone.1"}
  %multiply.2590.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2589.3.clone.1, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2590.1.clone.1"}
  %multiply.2591.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%convert.3917.23, %multiply.2589.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2591.5.clone.1"}
  %subtract.252.5.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} subtract(%broadcast.6034.46, %divide.460.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/sub" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="subtract.252.5.clone.1"}
  %multiply.2592.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%divide.460.7, %subtract.252.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2592.3.clone.1"}
  %multiply.2593.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2591.5.clone.1, %multiply.2592.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="multiply.2593.3.clone.1"}
  %add.3001.1.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} add(%multiply.2590.1.clone.1, %multiply.2593.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/jit(silu)/add_any" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1434 scheduling_name="add.3001.1.clone.1"}
  %convert.3928.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%add.3001.1.clone.1), metadata={scheduling_name="convert.3928.1.clone.1"}
  %multiply.2588.3.clone.1 = f32[1,1,32,2048,16384]{4,3,2,1,0} multiply(%multiply.2587.3, %convert.3922.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1435 scheduling_name="multiply.2588.3.clone.1"}
  %convert.3923.1.clone.1 = bf16[1,1,32,2048,16384]{4,3,2,1,0} convert(%multiply.2588.3.clone.1), metadata={scheduling_name="convert.3923.1.clone.1"}
  ROOT %tuple.490 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) tuple(%convert.3930.1, %convert.3928.1.clone.1, %convert.3923.1.clone.1), metadata={scheduling_name="tuple.490"}
}

%region_6.604.clone.4 (Arg_0.173: f32[], Arg_1.173: f32[]) -> f32[] {
  %Arg_1.173 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.173"}
  %Arg_0.173 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.173"}
  ROOT %add.2974.0 = f32[] add(%Arg_0.173, %Arg_1.173), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2974.0"}
}

%fused_convert_reduce_select (param_0.6063: pred[1], param_1.6455: f32[1,4,8192,6144], param_2.4646: f32[1,1,4,8192], param_3.3828: bf16[9,1,4,8192,6144], param_4.2803: f32[1,1,4,8192], param_5.2575: bf16[2,1,6144], param_6.2328: s32[32], param_7.2151: u32[], param_8.1999: s32[9], param_9.1716: s32[], param_10.1331: bf16[32768,6144]) -> (bf16[1,4,8192,6144], bf16[1,4,8192,6144], f32[128,6144]) {
  %param_0.6063 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.6063"}
  %bitcast.24337.3 = pred[] bitcast(%param_0.6063), metadata={scheduling_name="bitcast.24337.3"}
  %broadcast.5701.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24337.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5701.3"}
  %constant_1658_19 = bf16[] constant(0)
  %broadcast.5700.5 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1658_19), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5700.5"}
  %param_1.6455 = f32[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6455"}
  %param_10.1331 = bf16[32768,6144]{1,0} parameter(10), metadata={scheduling_name="param_10.1331"}
  %bitcast.23687.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_10.1331), metadata={scheduling_name="bitcast.23687.15.clone.1"}
  %convert.4104.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23687.15.clone.1), metadata={scheduling_name="convert.4104.15.clone.1"}
  %param_5.2575 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2575"}
  %param_8.1999 = s32[9]{0} parameter(8), metadata={scheduling_name="param_8.1999"}
  %constant_1660_23_clone_1 = s32[] constant(8)
  %param_9.1716 = s32[] parameter(9), metadata={scheduling_name="param_9.1716"}
  %subtract.247.169.clone.1 = s32[] subtract(%constant_1660_23_clone_1, %param_9.1716), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.169.clone.1"}
  %dynamic-slice.1484.150.clone.1 = s32[1]{0} dynamic-slice(%param_8.1999, %subtract.247.169.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.150.clone.1"}
  %param_6.2328 = s32[32]{0} parameter(6), metadata={scheduling_name="param_6.2328"}
  %param_7.2151 = u32[] parameter(7), metadata={scheduling_name="param_7.2151"}
  %dynamic-slice.1485.145.clone.1 = s32[1]{0} dynamic-slice(%param_6.2328, %param_7.2151), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.145.clone.1"}
  %subtract.248.140.clone.1 = s32[1]{0} subtract(%dynamic-slice.1484.150.clone.1, %dynamic-slice.1485.145.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.140.clone.1"}
  %constant_2166_75_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.140.clone.1 = s32[1]{0} maximum(%subtract.248.140.clone.1, %constant_2166_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.140.clone.1"}
  %sign.27.135.clone.1 = s32[1]{0} sign(%maximum.47.140.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.135.clone.1"}
  %constant_5144_69_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.135.clone.1 = pred[1]{0} compare(%sign.27.135.clone.1, %constant_5144_69_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.135.clone.1"}
  %constant_5145_68_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.140.clone.1 = s32[1]{0} and(%maximum.47.140.clone.1, %constant_5145_68_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.140.clone.1"}
  %compare.1615.140.clone.1 = pred[1]{0} compare(%and.301.140.clone.1, %constant_2166_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.140.clone.1"}
  %and.302.135.clone.1 = pred[1]{0} and(%compare.1614.135.clone.1, %compare.1615.140.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.135.clone.1"}
  %constant_5146_66_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.135.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.140.clone.1, %constant_5146_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.135.clone.1"}
  %constant_5147_66_clone_1 = s32[1]{0} constant({-1})
  %add.2981.135.clone.1 = s32[1]{0} add(%shift-right-logical.20.135.clone.1, %constant_5147_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.135.clone.1"}
  %select.1269.135.clone.1 = s32[1]{0} select(%and.302.135.clone.1, %add.2981.135.clone.1, %shift-right-logical.20.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.135.clone.1"}
  %compare.1616.135.clone.1 = pred[1]{0} compare(%select.1269.135.clone.1, %constant_2166_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.135.clone.1"}
  %add.2982.135.clone.1 = s32[1]{0} add(%select.1269.135.clone.1, %constant_5146_66_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.135.clone.1"}
  %select.1270.135.clone.1 = s32[1]{0} select(%compare.1616.135.clone.1, %add.2982.135.clone.1, %select.1269.135.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.135.clone.1"}
  %bitcast.21242.149.clone.1 = s32[1,1]{1,0} bitcast(%select.1270.135.clone.1), metadata={scheduling_name="bitcast.21242.149.clone.1"}
  %constant_1668_20_clone_1 = s32[] constant(0)
  %pad.345.41.clone.1 = s32[1,2]{1,0} pad(%bitcast.21242.149.clone.1, %constant_1668_20_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.41.clone.1"}
  %pad.346.39.clone.1 = s32[1,3]{1,0} pad(%pad.345.41.clone.1, %constant_1668_20_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.39.clone.1"}
  %bitcast.21349.36.clone.1 = s32[3]{0} bitcast(%pad.346.39.clone.1), metadata={scheduling_name="bitcast.21349.36.clone.1"}
  %slice.2376.31.clone.1 = s32[1]{0} slice(%bitcast.21349.36.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.31.clone.1"}
  %bitcast.24050.18.clone.1 = s32[] bitcast(%slice.2376.31.clone.1), metadata={scheduling_name="bitcast.24050.18.clone.1"}
  %dynamic-slice.1518.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_5.2575, %bitcast.24050.18.clone.1, %constant_1668_20_clone_1, %constant_1668_20_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1518.7.clone.1"}
  %bitcast.23368.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1518.7.clone.1), metadata={scheduling_name="bitcast.23368.6.clone.1"}
  %convert.4997.3.clone.1 = f32[6144]{0} convert(%bitcast.23368.6.clone.1), metadata={scheduling_name="convert.4997.3.clone.1"}
  %broadcast.6053.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4997.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6053.12.clone.1"}
  %multiply.2687.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4104.15.clone.1, %broadcast.6053.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2687.9.clone.1"}
  %param_4.2803 = f32[1,1,4,8192]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2803"}
  %bitcast.23355.17.clone.1 = f32[4,8192]{1,0} bitcast(%param_4.2803), metadata={scheduling_name="bitcast.23355.17.clone.1"}
  %broadcast.5676.17.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23355.17.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5676.17.clone.1"}
  %multiply.2688.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2687.9.clone.1, %broadcast.5676.17.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2688.5.clone.1"}
  %param_3.3828 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(3), metadata={scheduling_name="param_3.3828"}
  %dynamic-slice.1489.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_3.3828, %subtract.247.169.clone.1, %constant_1668_20_clone_1, %constant_1668_20_clone_1, %constant_1668_20_clone_1, /*index=5*/%constant_1668_20_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1489.1.clone.1"}
  %bitcast.23330.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1489.1.clone.1), metadata={scheduling_name="bitcast.23330.19.clone.1"}
  %convert.4055.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23330.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4055.19.clone.1"}
  %param_2.4646 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4646"}
  %bitcast.24381.5.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4646), metadata={scheduling_name="bitcast.24381.5.clone.1"}
  %broadcast.5704.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24381.5.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5704.5.clone.1"}
  %multiply.2693.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4055.19.clone.1, %broadcast.5704.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2693.3.clone.1"}
  %add.3061.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2688.5.clone.1, %multiply.2693.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3061.3.clone.1"}
  %add.3063.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%param_1.6455, %add.3061.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.3063.1.clone.1"}
  %convert.4182.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.3063.1.clone.1), metadata={scheduling_name="convert.4182.1.clone.1"}
  %select.1322.1 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5701.3, %broadcast.5700.5, %convert.4182.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1322.1"}
  %multiply.2659.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4055.19.clone.1, %broadcast.5676.17.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2659.11.clone.1"}
  %multiply.2684.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2659.11.clone.1, %convert.4104.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2684.5.clone.1"}
  %convert.4105.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2684.5.clone.1), metadata={scheduling_name="convert.4105.3.clone.1"}
  %bitcast.23696.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4105.3.clone.1), metadata={scheduling_name="bitcast.23696.3.clone.1"}
  %convert.4106.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23696.3.clone.1), metadata={scheduling_name="convert.4106.3.clone.1"}
  %convert.4980.6.clone.1 = f32[] convert(%constant_1658_19), metadata={scheduling_name="convert.4980.6.clone.1"}
  %reduce.587.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4106.3.clone.1, %convert.4980.6.clone.1), dimensions={1}, to_apply=%region_6.604.clone.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.587.1.clone.1"}
  ROOT %tuple.475 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}) tuple(%select.1322.1, %convert.4182.1.clone.1, %reduce.587.1.clone.1), metadata={scheduling_name="tuple.475"}
}

%fused_dynamic_update_slice.31 (param_0.879: bf16[1,4,4,8192,6144], param_1.2561: s32[9], param_2.1912: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.879 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.879"}
  %constant_1658_21 = bf16[] constant(0)
  %broadcast.5590.2 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1658_21), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5590.2"}
  %constant_1668_56 = s32[] constant(0)
  %param_1.2561 = s32[9]{0} parameter(1), metadata={scheduling_name="param_1.2561"}
  %constant_1660_34 = s32[] constant(8)
  %param_2.1912 = s32[] parameter(2), metadata={scheduling_name="param_2.1912"}
  %subtract.247.27 = s32[] subtract(%constant_1660_34, %param_2.1912), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.27"}
  %dynamic-slice.1484.7 = s32[1]{0} dynamic-slice(%param_1.2561, %subtract.247.27), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.7"}
  %bitcast.21539.7 = s32[] bitcast(%dynamic-slice.1484.7), metadata={scheduling_name="bitcast.21539.7"}
  %constant_2851_2 = s32[] constant(-2)
  %add.3056.3 = s32[] add(%bitcast.21539.7, %constant_2851_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.3056.3"}
  %compare.1646.1 = pred[] compare(%add.3056.3, %constant_1668_56), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1646.1"}
  %negate.222.2 = s32[] negate(%add.3056.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.222.2"}
  %select.1311.1 = s32[] select(%compare.1646.1, %negate.222.2, %add.3056.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1311.1"}
  %constant_1671_2 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.311.2 = s32[] and(%select.1311.1, %constant_1671_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.311.2"}
  %negate.223.2 = s32[] negate(%and.311.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.223.2"}
  %select.1312.1 = s32[] select(%compare.1646.1, %negate.223.2, %and.311.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1312.1"}
  %compare.1647.2 = pred[] compare(%select.1312.1, %constant_1668_56), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1647.2"}
  %compare.1648.2 = pred[] compare(%select.1312.1, %constant_1668_56), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1648.2"}
  %and.312.1 = pred[] and(%compare.1647.2, %compare.1648.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.312.1"}
  %constant_1721_2 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.3057.1 = s32[] add(%select.1312.1, %constant_1721_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3057.1"}
  %select.1313.2 = s32[] select(%and.312.1, %add.3057.1, %select.1312.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1313.2"}
  %compare.1649.1 = pred[] compare(%select.1313.2, %constant_1668_56), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1649.1"}
  %add.3058.1 = s32[] add(%select.1313.2, %constant_1721_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.3058.1"}
  %select.1314.2 = s32[] select(%compare.1649.1, %add.3058.1, %select.1313.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1314.2"}
  ROOT %dynamic-update-slice.414.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.879, %broadcast.5590.2, %constant_1668_56, %select.1314.2, %constant_1668_56, /*index=5*/%constant_1668_56, %constant_1668_56), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-update-slice.414.1"}
}

%fused_dynamic_update_slice.32 (param_0.880: bf16[1,2,4,8192,6144], param_1.2524: s32[9], param_2.1872: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.880 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.880"}
  %constant_1658_22 = bf16[] constant(0)
  %broadcast.5590.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1658_22), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5590.3"}
  %constant_1668_94 = s32[] constant(0)
  %param_1.2524 = s32[9]{0} parameter(1), metadata={scheduling_name="param_1.2524"}
  %constant_1660_31 = s32[] constant(8)
  %param_2.1872 = s32[] parameter(2), metadata={scheduling_name="param_2.1872"}
  %subtract.247.24 = s32[] subtract(%constant_1660_31, %param_2.1872), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.24"}
  %dynamic-slice.1484.4 = s32[1]{0} dynamic-slice(%param_1.2524, %subtract.247.24), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.4"}
  %bitcast.21539.49 = s32[] bitcast(%dynamic-slice.1484.4), metadata={scheduling_name="bitcast.21539.49"}
  %compare.1624.13 = pred[] compare(%bitcast.21539.49, %constant_1668_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.13"}
  %negate.212.3 = s32[] negate(%bitcast.21539.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.3"}
  %select.1272.15 = s32[] select(%compare.1624.13, %negate.212.3, %bitcast.21539.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.15"}
  %constant_1654_7 = s32[] constant(1)
  %and.305.5 = s32[] and(%select.1272.15, %constant_1654_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.5"}
  %negate.213.4 = s32[] negate(%and.305.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.4"}
  %select.1273.3 = s32[] select(%compare.1624.13, %negate.213.4, %and.305.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1273.3"}
  %compare.1625.1 = pred[] compare(%select.1273.3, %constant_1668_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.1"}
  %compare.1626.1 = pred[] compare(%select.1273.3, %constant_1668_94), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.1"}
  %and.306.6 = pred[] and(%compare.1625.1, %compare.1626.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.6"}
  %constant_1673_6 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2991.6 = s32[] add(%select.1273.3, %constant_1673_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2991.6"}
  %select.1274.5 = s32[] select(%and.306.6, %add.2991.6, %select.1273.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1274.5"}
  %compare.1627.3 = pred[] compare(%select.1274.5, %constant_1668_94), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.3"}
  %add.2992.3 = s32[] add(%select.1274.5, %constant_1673_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2992.3"}
  %select.1275.2 = s32[] select(%compare.1627.3, %add.2992.3, %select.1274.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1275.2"}
  ROOT %dynamic-update-slice.416.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.880, %broadcast.5590.3, %constant_1668_94, %select.1275.2, %constant_1668_94, /*index=5*/%constant_1668_94, %constant_1668_94), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-update-slice.416.1"}
}

%fused_convert.11 (param_0.1493: f32[1,1,4,8192], param_1.1432: bf16[32768,6144], param_2.1690: bf16[2,1,6144], param_3.1607: s32[32], param_4.1353: u32[], param_5.1245: s32[9], param_6.1226: s32[]) -> bf16[1,4,8192,6144] {
  %param_1.1432 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1432"}
  %bitcast.21630.15 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.1432), metadata={scheduling_name="bitcast.21630.15"}
  %convert.3899.15 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21630.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3899.15"}
  %param_0.1493 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1493"}
  %bitcast.21655.13 = f32[4,8192]{1,0} bitcast(%param_0.1493), metadata={scheduling_name="bitcast.21655.13"}
  %broadcast.5594.13 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21655.13), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5594.13"}
  %multiply.2581.7 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3899.15, %broadcast.5594.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2581.7"}
  %param_2.1690 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1690"}
  %param_5.1245 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.1245"}
  %constant_1660_50 = s32[] constant(8)
  %param_6.1226 = s32[] parameter(6), metadata={scheduling_name="param_6.1226"}
  %subtract.247.179 = s32[] subtract(%constant_1660_50, %param_6.1226), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.179"}
  %dynamic-slice.1484.160 = s32[1]{0} dynamic-slice(%param_5.1245, %subtract.247.179), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.160"}
  %param_3.1607 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.1607"}
  %param_4.1353 = u32[] parameter(4), metadata={scheduling_name="param_4.1353"}
  %dynamic-slice.1485.155 = s32[1]{0} dynamic-slice(%param_3.1607, %param_4.1353), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.155"}
  %subtract.248.150 = s32[1]{0} subtract(%dynamic-slice.1484.160, %dynamic-slice.1485.155), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.150"}
  %constant_2166_23 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.150 = s32[1]{0} maximum(%subtract.248.150, %constant_2166_23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.150"}
  %sign.27.145 = s32[1]{0} sign(%maximum.47.150), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.145"}
  %constant_5144_17 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.145 = pred[1]{0} compare(%sign.27.145, %constant_5144_17), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.145"}
  %constant_5145_15 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.150 = s32[1]{0} and(%maximum.47.150, %constant_5145_15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.150"}
  %compare.1615.150 = pred[1]{0} compare(%and.301.150, %constant_2166_23), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.150"}
  %and.302.145 = pred[1]{0} and(%compare.1614.145, %compare.1615.150), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.145"}
  %constant_5146_14 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.145 = s32[1]{0} shift-right-logical(%maximum.47.150, %constant_5146_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.145"}
  %constant_5147_14 = s32[1]{0} constant({-1})
  %add.2981.145 = s32[1]{0} add(%shift-right-logical.20.145, %constant_5147_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.145"}
  %select.1269.145 = s32[1]{0} select(%and.302.145, %add.2981.145, %shift-right-logical.20.145), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.145"}
  %compare.1616.145 = pred[1]{0} compare(%select.1269.145, %constant_2166_23), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.145"}
  %add.2982.145 = s32[1]{0} add(%select.1269.145, %constant_5146_14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.145"}
  %select.1270.145 = s32[1]{0} select(%compare.1616.145, %add.2982.145, %select.1269.145), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.145"}
  %bitcast.21242.159 = s32[1,1]{1,0} bitcast(%select.1270.145), metadata={scheduling_name="bitcast.21242.159"}
  %constant_1668_66 = s32[] constant(0)
  %pad.345.51 = s32[1,2]{1,0} pad(%bitcast.21242.159, %constant_1668_66), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.51"}
  %pad.346.49 = s32[1,3]{1,0} pad(%pad.345.51, %constant_1668_66), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.49"}
  %bitcast.21349.46 = s32[3]{0} bitcast(%pad.346.49), metadata={scheduling_name="bitcast.21349.46"}
  %slice.2376.41 = s32[1]{0} slice(%bitcast.21349.46), slice={[1:2]}, metadata={scheduling_name="slice.2376.41"}
  %bitcast.24050.28 = s32[] bitcast(%slice.2376.41), metadata={scheduling_name="bitcast.24050.28"}
  %dynamic-slice.1498.9 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.1690, %bitcast.24050.28, %constant_1668_66, %constant_1668_66), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1498.9"}
  %bitcast.21666.8 = bf16[6144]{0} bitcast(%dynamic-slice.1498.9), metadata={scheduling_name="bitcast.21666.8"}
  %convert.4978.5 = f32[6144]{0} convert(%bitcast.21666.8), metadata={scheduling_name="convert.4978.5"}
  %broadcast.6029.10 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4978.5), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6029.10"}
  %multiply.2582.3 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2581.7, %broadcast.6029.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2582.3"}
  ROOT %convert.3901.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2582.3), metadata={scheduling_name="convert.3901.1"}
}

%fused_convert.12 (param_0.1301: bf16[1,4,8192,6144], param_1.2430: bf16[1,4,8192,6144], param_2.1769: pred[1], param_3.1352: pred[1]) -> bf16[1,4,8192,6144] {
  %param_2.1769 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1769"}
  %bitcast.24404.3 = pred[] bitcast(%param_2.1769), metadata={scheduling_name="bitcast.24404.3"}
  %broadcast.5706.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24404.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="broadcast.5706.3"}
  %param_1.2430 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2430"}
  %constant_1658_18 = bf16[] constant(0)
  %broadcast.5700.12 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1658_18), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5700.12"}
  %select.1320.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5706.3, %param_1.2430, %broadcast.5700.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="select.1320.3"}
  %convert.4186.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1320.3), metadata={scheduling_name="convert.4186.1"}
  %param_3.1352 = pred[1]{0} parameter(3), metadata={scheduling_name="param_3.1352"}
  %bitcast.24428.3 = pred[] bitcast(%param_3.1352), metadata={scheduling_name="bitcast.24428.3"}
  %broadcast.5708.3 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24428.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="broadcast.5708.3"}
  %param_0.1301 = bf16[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1301"}
  %select.1321.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5708.3, %param_0.1301, %broadcast.5700.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="select.1321.3"}
  %convert.4187.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%select.1321.3), metadata={scheduling_name="convert.4187.1"}
  %add.3066.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.4186.1, %convert.4187.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="add.3066.1"}
  ROOT %convert.4189.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.3066.1), metadata={scheduling_name="convert.4189.1"}
}

%fused_convert_transpose.2 (param_0.1360: s32[1,4,8,8192], param_1.2436: bf16[1,4,8,8192]) -> (bf16[1,4,8,2048,8192], bf16[4,8192,16384], bf16[4,8192,16384]) {
  %param_1.2436 = bf16[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2436"}
  %bitcast.22804.10 = bf16[4,8,8192]{2,1,0} bitcast(%param_1.2436), metadata={scheduling_name="bitcast.22804.10"}
  %convert.4990.7 = f32[4,8,8192]{2,1,0} convert(%bitcast.22804.10), metadata={scheduling_name="convert.4990.7"}
  %broadcast.6044.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.4990.7), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6044.11"}
  %param_0.1360 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1360"}
  %bitcast.22826.11 = s32[4,8,8192]{2,1,0} bitcast(%param_0.1360), metadata={scheduling_name="bitcast.22826.11"}
  %broadcast.5654.11 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.22826.11), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5654.11"}
  %iota.387.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.387.9"}
  %compare.1640.9 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5654.11, %iota.387.9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1640.9"}
  %convert.4004.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1640.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4004.15"}
  %convert.4005.15 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4004.15), metadata={scheduling_name="convert.4005.15"}
  %multiply.2641.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6044.11, %convert.4005.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2641.11"}
  %convert.4006.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2641.11), metadata={scheduling_name="convert.4006.9"}
  %slice.2402.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.4006.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2402.7"}
  %convert.4007.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2402.7), metadata={scheduling_name="convert.4007.3"}
  %constant_1658_38 = bf16[] constant(0)
  %convert.4980.13 = f32[] convert(%constant_1658_38), metadata={scheduling_name="convert.4980.13"}
  %broadcast.6032.4 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.4980.13), dimensions={}, metadata={scheduling_name="broadcast.6032.4"}
  %compare.1641.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.4007.3, %broadcast.6032.4), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1641.3"}
  %convert.4009.2 = bf16[1,4,8,2048,8192]{4,3,2,1,0} convert(%compare.1641.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="convert.4009.2"}
  %bitcast.23077.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2402.7), metadata={scheduling_name="bitcast.23077.1.clone.1"}
  %transpose.750.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.23077.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.750.1.clone.1"}
  %bitcast.23242.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%convert.4009.2), metadata={scheduling_name="bitcast.23242.1.clone.1"}
  %transpose.753.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.23242.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.753.1.clone.1"}
  ROOT %tuple.483 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.4009.2, %transpose.750.1.clone.1, %transpose.753.1.clone.1), metadata={scheduling_name="tuple.483"}
}

%fused_convert_transpose.3 (param_0.1361: s32[1,4,8,8192], param_1.2429: bf16[1,4,8,8192]) -> (bf16[1,4,8,2048,8192], bf16[4,8192,16384], bf16[4,8192,16384]) {
  %param_1.2429 = bf16[1,4,8,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2429"}
  %bitcast.21860.10 = bf16[4,8,8192]{2,1,0} bitcast(%param_1.2429), metadata={scheduling_name="bitcast.21860.10"}
  %convert.4979.7 = f32[4,8,8192]{2,1,0} convert(%bitcast.21860.10), metadata={scheduling_name="convert.4979.7"}
  %broadcast.6030.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%convert.4979.7), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="broadcast.6030.11"}
  %param_0.1361 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1361"}
  %bitcast.21882.11 = s32[4,8,8192]{2,1,0} bitcast(%param_0.1361), metadata={scheduling_name="bitcast.21882.11"}
  %broadcast.5609.11 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.21882.11), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5609.11"}
  %iota.379.9 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.379.9"}
  %compare.1632.9 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5609.11, %iota.379.9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1632.9"}
  %convert.3911.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1632.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.3911.15"}
  %convert.3912.15 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.3911.15), metadata={scheduling_name="convert.3912.15"}
  %multiply.2586.11 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%broadcast.6030.11, %convert.3912.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2586.11"}
  %convert.3913.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2586.11), metadata={scheduling_name="convert.3913.9"}
  %slice.2387.7 = bf16[1,4,8,2048,8192]{4,3,2,1,0} slice(%convert.3913.9), slice={[0:1], [0:4], [0:8], [1:2049], [0:8192]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="slice.2387.7"}
  %convert.3914.3 = f32[1,4,8,2048,8192]{4,3,2,1,0} convert(%slice.2387.7), metadata={scheduling_name="convert.3914.3"}
  %constant_1658_7 = bf16[] constant(0)
  %convert.4980.14 = f32[] convert(%constant_1658_7), metadata={scheduling_name="convert.4980.14"}
  %broadcast.6032.8 = f32[1,4,8,2048,8192]{4,3,2,1,0} broadcast(%convert.4980.14), dimensions={}, metadata={scheduling_name="broadcast.6032.8"}
  %compare.1633.3 = pred[1,4,8,2048,8192]{4,3,2,1,0} compare(%convert.3914.3, %broadcast.6032.8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1172 scheduling_name="compare.1633.3"}
  %convert.3916.2 = bf16[1,4,8,2048,8192]{4,3,2,1,0} convert(%compare.1633.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="convert.3916.2"}
  %bitcast.21955.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%slice.2387.7), metadata={scheduling_name="bitcast.21955.1.clone.1"}
  %transpose.739.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.21955.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/slice" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 scheduling_name="transpose.739.1.clone.1"}
  %bitcast.21899.1.clone.1 = bf16[4,16384,8192]{2,1,0} bitcast(%convert.3916.2), metadata={scheduling_name="bitcast.21899.1.clone.1"}
  %transpose.737.1.clone.1 = bf16[4,8192,16384]{2,1,0} transpose(%bitcast.21899.1.clone.1), dimensions={0,2,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="transpose.737.1.clone.1"}
  ROOT %tuple.493 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) tuple(%convert.3916.2, %transpose.739.1.clone.1, %transpose.737.1.clone.1), metadata={scheduling_name="tuple.493"}
}

%fused_dynamic_update_slice.33 (param_0.1136: bf16[1,4,4,8192,6144], param_1.2512: bf16[1,4,8192,6144], param_2.1858: pred[1], param_3.1450: pred[], param_4.1166: s32[9], param_5.995: s32[]) -> bf16[1,4,4,8192,6144] {
  %param_0.1136 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1136"}
  %constant_1668_103 = s32[] constant(0)
  %param_4.1166 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1166"}
  %constant_1660_35 = s32[] constant(8)
  %param_5.995 = s32[] parameter(5), metadata={scheduling_name="param_5.995"}
  %subtract.247.28 = s32[] subtract(%constant_1660_35, %param_5.995), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.28"}
  %dynamic-slice.1484.8 = s32[1]{0} dynamic-slice(%param_4.1166, %subtract.247.28), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.8"}
  %bitcast.21539.41 = s32[] bitcast(%dynamic-slice.1484.8), metadata={scheduling_name="bitcast.21539.41"}
  %compare.1624.5 = pred[] compare(%bitcast.21539.41, %constant_1668_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.5"}
  %negate.212.5 = s32[] negate(%bitcast.21539.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.5"}
  %select.1272.3 = s32[] select(%compare.1624.5, %negate.212.5, %bitcast.21539.41), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.3"}
  %constant_1671_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.313.1 = s32[] and(%select.1272.3, %constant_1671_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.313.1"}
  %negate.224.1 = s32[] negate(%and.313.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.224.1"}
  %select.1315.1 = s32[] select(%compare.1624.5, %negate.224.1, %and.313.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1315.1"}
  %compare.1650.1 = pred[] compare(%select.1315.1, %constant_1668_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1650.1"}
  %compare.1651.1 = pred[] compare(%select.1315.1, %constant_1668_103), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1651.1"}
  %and.314.1 = pred[] and(%compare.1650.1, %compare.1651.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.314.1"}
  %constant_1721_4 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.3059.1 = s32[] add(%select.1315.1, %constant_1721_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3059.1"}
  %select.1316.1 = s32[] select(%and.314.1, %add.3059.1, %select.1315.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1316.1"}
  %compare.1652.1 = pred[] compare(%select.1316.1, %constant_1668_103), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="compare.1652.1"}
  %add.3060.1 = s32[] add(%select.1316.1, %constant_1721_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.3060.1"}
  %select.1317.1 = s32[] select(%compare.1652.1, %add.3060.1, %select.1316.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="select.1317.1"}
  %dynamic-slice.1538.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1136, %constant_1668_103, %select.1317.1, %constant_1668_103, %constant_1668_103, /*index=5*/%constant_1668_103), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-slice.1538.1"}
  %convert.4178.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1538.1), metadata={scheduling_name="convert.4178.3"}
  %param_3.1450 = pred[] parameter(3), metadata={scheduling_name="param_3.1450"}
  %broadcast.5699.2 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.1450), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5699.2"}
  %constant_1658_15 = bf16[] constant(0)
  %broadcast.5700.14 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1658_15), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5700.14"}
  %param_2.1858 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1858"}
  %bitcast.24337.9 = pred[] bitcast(%param_2.1858), metadata={scheduling_name="bitcast.24337.9"}
  %broadcast.5701.9 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24337.9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5701.9"}
  %param_1.2512 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2512"}
  %select.1318.5 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5701.9, %param_1.2512, %broadcast.5700.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1318.5"}
  %select.1319.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5699.2, %broadcast.5700.14, %select.1318.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1319.3"}
  %bitcast.24393.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1319.3), metadata={scheduling_name="bitcast.24393.7"}
  %convert.4183.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24393.7), metadata={scheduling_name="convert.4183.7"}
  %add.3064.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4178.3, %convert.4183.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="add.3064.5"}
  %convert.4184.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.3064.5), metadata={scheduling_name="convert.4184.3"}
  ROOT %dynamic-update-slice.415.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1136, %convert.4184.3, %constant_1668_103, %select.1317.1, %constant_1668_103, /*index=5*/%constant_1668_103, %constant_1668_103), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="dynamic-update-slice.415.1"}
}

%fused_dynamic_update_slice.34 (param_0.1138: bf16[1,2,4,8192,6144], param_1.2507: bf16[1,4,8192,6144], param_2.1871: s32[9], param_3.1463: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.1138 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1138"}
  %constant_1668_98 = s32[] constant(0)
  %param_2.1871 = s32[9]{0} parameter(2), metadata={scheduling_name="param_2.1871"}
  %constant_1660_30 = s32[] constant(8)
  %param_3.1463 = s32[] parameter(3), metadata={scheduling_name="param_3.1463"}
  %subtract.247.23 = s32[] subtract(%constant_1660_30, %param_3.1463), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.23"}
  %dynamic-slice.1484.3 = s32[1]{0} dynamic-slice(%param_2.1871, %subtract.247.23), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.3"}
  %bitcast.21539.45 = s32[] bitcast(%dynamic-slice.1484.3), metadata={scheduling_name="bitcast.21539.45"}
  %compare.1624.9 = pred[] compare(%bitcast.21539.45, %constant_1668_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.9"}
  %negate.212.13 = s32[] negate(%bitcast.21539.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.13"}
  %select.1272.11 = s32[] select(%compare.1624.9, %negate.212.13, %bitcast.21539.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.11"}
  %constant_1654_5 = s32[] constant(1)
  %and.305.3 = s32[] and(%select.1272.11, %constant_1654_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.3"}
  %negate.213.2 = s32[] negate(%and.305.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.2"}
  %select.1273.1 = s32[] select(%compare.1624.9, %negate.213.2, %and.305.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1273.1"}
  %compare.1625.6 = pred[] compare(%select.1273.1, %constant_1668_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.6"}
  %compare.1626.6 = pred[] compare(%select.1273.1, %constant_1668_98), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.6"}
  %and.306.5 = pred[] and(%compare.1625.6, %compare.1626.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.5"}
  %constant_1673_5 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2991.5 = s32[] add(%select.1273.1, %constant_1673_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2991.5"}
  %select.1274.4 = s32[] select(%and.306.5, %add.2991.5, %select.1273.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1274.4"}
  %compare.1627.2 = pred[] compare(%select.1274.4, %constant_1668_98), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.2"}
  %add.2992.2 = s32[] add(%select.1274.4, %constant_1673_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2992.2"}
  %select.1275.1 = s32[] select(%compare.1627.2, %add.2992.2, %select.1274.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1275.1"}
  %dynamic-slice.1540.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1138, %constant_1668_98, %select.1275.1, %constant_1668_98, %constant_1668_98, /*index=5*/%constant_1668_98), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1540.1"}
  %convert.4190.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1540.1), metadata={scheduling_name="convert.4190.3"}
  %param_1.2507 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2507"}
  %bitcast.24480.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%param_1.2507), metadata={scheduling_name="bitcast.24480.7"}
  %convert.4191.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24480.7), metadata={scheduling_name="convert.4191.7"}
  %add.3067.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4190.3, %convert.4191.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="add.3067.5"}
  %convert.4192.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.3067.5), metadata={scheduling_name="convert.4192.3"}
  ROOT %dynamic-update-slice.417.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1138, %convert.4192.3, %constant_1668_98, %select.1275.1, %constant_1668_98, /*index=5*/%constant_1668_98, %constant_1668_98), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="dynamic-update-slice.417.1"}
}

%fused_dynamic_update_slice.35 (param_0.1140: bf16[1,2,4,8192,6144], param_1.2484: bf16[1,4,8192,6144], param_2.1834: pred[1], param_3.1426: pred[], param_4.1151: s32[9], param_5.980: s32[]) -> bf16[1,2,4,8192,6144] {
  %param_0.1140 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1140"}
  %constant_1668_71 = s32[] constant(0)
  %param_4.1151 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1151"}
  %constant_1660_36 = s32[] constant(8)
  %param_5.980 = s32[] parameter(5), metadata={scheduling_name="param_5.980"}
  %subtract.247.29 = s32[] subtract(%constant_1660_36, %param_5.980), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.29"}
  %dynamic-slice.1484.9 = s32[1]{0} dynamic-slice(%param_4.1151, %subtract.247.29), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.9"}
  %bitcast.21539.51 = s32[] bitcast(%dynamic-slice.1484.9), metadata={scheduling_name="bitcast.21539.51"}
  %compare.1624.15 = pred[] compare(%bitcast.21539.51, %constant_1668_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.15"}
  %negate.212.7 = s32[] negate(%bitcast.21539.51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.7"}
  %select.1272.5 = s32[] select(%compare.1624.15, %negate.212.7, %bitcast.21539.51), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.5"}
  %constant_1654_1 = s32[] constant(1)
  %and.305.6 = s32[] and(%select.1272.5, %constant_1654_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.6"}
  %negate.213.5 = s32[] negate(%and.305.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.5"}
  %select.1273.4 = s32[] select(%compare.1624.15, %negate.213.5, %and.305.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1273.4"}
  %compare.1625.2 = pred[] compare(%select.1273.4, %constant_1668_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.2"}
  %compare.1626.2 = pred[] compare(%select.1273.4, %constant_1668_71), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.2"}
  %and.306.1 = pred[] and(%compare.1625.2, %compare.1626.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.1"}
  %constant_1673_7 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2991.1 = s32[] add(%select.1273.4, %constant_1673_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2991.1"}
  %select.1274.6 = s32[] select(%and.306.1, %add.2991.1, %select.1273.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1274.6"}
  %compare.1627.4 = pred[] compare(%select.1274.6, %constant_1668_71), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.4"}
  %add.2992.4 = s32[] add(%select.1274.6, %constant_1673_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2992.4"}
  %select.1275.3 = s32[] select(%compare.1627.4, %add.2992.4, %select.1274.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1275.3"}
  %dynamic-slice.1541.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.1140, %constant_1668_71, %select.1275.3, %constant_1668_71, %constant_1668_71, /*index=5*/%constant_1668_71), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="dynamic-slice.1541.1"}
  %convert.4193.3 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%dynamic-slice.1541.1), metadata={scheduling_name="convert.4193.3"}
  %param_3.1426 = pred[] parameter(3), metadata={scheduling_name="param_3.1426"}
  %broadcast.5699.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%param_3.1426), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5699.1"}
  %param_2.1834 = pred[1]{0} parameter(2), metadata={scheduling_name="param_2.1834"}
  %bitcast.24337.7 = pred[] bitcast(%param_2.1834), metadata={scheduling_name="bitcast.24337.7"}
  %broadcast.5701.7 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.24337.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5701.7"}
  %param_1.2484 = bf16[1,4,8192,6144]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.2484"}
  %constant_1658_9 = bf16[] constant(0)
  %broadcast.5700.16 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_1658_9), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="broadcast.5700.16"}
  %select.1318.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5701.7, %param_1.2484, %broadcast.5700.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1318.3"}
  %select.1324.3 = bf16[1,4,8192,6144]{3,2,1,0} select(%broadcast.5699.1, %select.1318.3, %broadcast.5700.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="select.1324.3"}
  %bitcast.24502.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} bitcast(%select.1324.3), metadata={scheduling_name="bitcast.24502.7"}
  %convert.4195.7 = f32[1,1,4,8192,6144]{4,3,2,1,0} convert(%bitcast.24502.7), metadata={scheduling_name="convert.4195.7"}
  %add.3069.5 = f32[1,1,4,8192,6144]{4,3,2,1,0} add(%convert.4193.3, %convert.4195.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="add.3069.5"}
  %convert.4196.3 = bf16[1,1,4,8192,6144]{4,3,2,1,0} convert(%add.3069.5), metadata={scheduling_name="convert.4196.3"}
  ROOT %dynamic-update-slice.418.1 = bf16[1,2,4,8192,6144]{4,3,2,1,0} dynamic-update-slice(%param_0.1140, %convert.4196.3, %constant_1668_71, %select.1275.3, %constant_1668_71, /*index=5*/%constant_1668_71, %constant_1668_71), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="dynamic-update-slice.418.1"}
}

%fused_convert.13 (param_0.1242: f32[1,4,8192,6144], param_1.1128: f32[1,1,4,8192], param_2.709: f32[1,1,4,8192], param_3.462: bf16[32768,6144], param_4.204: bf16[9,1,4,8192,6144], param_5.896: s32[], param_6.876: bf16[2,1,6144], param_7.1176: s32[32], param_8.1072: u32[], param_9.869: s32[9]) -> bf16[1,4,8192,6144] {
  %param_0.1242 = f32[1,4,8192,6144]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1242"}
  %param_3.462 = bf16[32768,6144]{1,0} parameter(3), metadata={scheduling_name="param_3.462"}
  %bitcast.22633.23 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_3.462), metadata={scheduling_name="bitcast.22633.23"}
  %convert.3995.23 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22633.23), metadata={scheduling_name="convert.3995.23"}
  %param_6.876 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.876"}
  %param_9.869 = s32[9]{0} parameter(9), metadata={scheduling_name="param_9.869"}
  %constant_1660_17 = s32[] constant(8)
  %param_5.896 = s32[] parameter(5), metadata={scheduling_name="param_5.896"}
  %subtract.247.193 = s32[] subtract(%constant_1660_17, %param_5.896), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.193"}
  %dynamic-slice.1484.174 = s32[1]{0} dynamic-slice(%param_9.869, %subtract.247.193), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.174"}
  %param_7.1176 = s32[32]{0} parameter(7), metadata={scheduling_name="param_7.1176"}
  %param_8.1072 = u32[] parameter(8), metadata={scheduling_name="param_8.1072"}
  %dynamic-slice.1485.169 = s32[1]{0} dynamic-slice(%param_7.1176, %param_8.1072), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.169"}
  %subtract.248.164 = s32[1]{0} subtract(%dynamic-slice.1484.174, %dynamic-slice.1485.169), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.164"}
  %constant_2166_83 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.164 = s32[1]{0} maximum(%subtract.248.164, %constant_2166_83), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.164"}
  %sign.27.159 = s32[1]{0} sign(%maximum.47.164), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.159"}
  %constant_5144_77 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.159 = pred[1]{0} compare(%sign.27.159, %constant_5144_77), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.159"}
  %constant_5145_76 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.164 = s32[1]{0} and(%maximum.47.164, %constant_5145_76), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.164"}
  %compare.1615.164 = pred[1]{0} compare(%and.301.164, %constant_2166_83), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.164"}
  %and.302.159 = pred[1]{0} and(%compare.1614.159, %compare.1615.164), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.159"}
  %constant_5146_74 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.159 = s32[1]{0} shift-right-logical(%maximum.47.164, %constant_5146_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.159"}
  %constant_5147_74 = s32[1]{0} constant({-1})
  %add.2981.159 = s32[1]{0} add(%shift-right-logical.20.159, %constant_5147_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.159"}
  %select.1269.159 = s32[1]{0} select(%and.302.159, %add.2981.159, %shift-right-logical.20.159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.159"}
  %compare.1616.159 = pred[1]{0} compare(%select.1269.159, %constant_2166_83), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.159"}
  %add.2982.159 = s32[1]{0} add(%select.1269.159, %constant_5146_74), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.159"}
  %select.1270.159 = s32[1]{0} select(%compare.1616.159, %add.2982.159, %select.1269.159), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.159"}
  %bitcast.21242.173 = s32[1,1]{1,0} bitcast(%select.1270.159), metadata={scheduling_name="bitcast.21242.173"}
  %constant_1668_7 = s32[] constant(0)
  %pad.345.65 = s32[1,2]{1,0} pad(%bitcast.21242.173, %constant_1668_7), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.65"}
  %pad.346.63 = s32[1,3]{1,0} pad(%pad.345.65, %constant_1668_7), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.63"}
  %bitcast.21349.60 = s32[3]{0} bitcast(%pad.346.63), metadata={scheduling_name="bitcast.21349.60"}
  %slice.2376.55 = s32[1]{0} slice(%bitcast.21349.60), slice={[1:2]}, metadata={scheduling_name="slice.2376.55"}
  %bitcast.24050.42 = s32[] bitcast(%slice.2376.55), metadata={scheduling_name="bitcast.24050.42"}
  %dynamic-slice.1503.7 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_6.876, %bitcast.24050.42, %constant_1668_7, %constant_1668_7), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1503.7"}
  %bitcast.22303.6 = bf16[6144]{0} bitcast(%dynamic-slice.1503.7), metadata={scheduling_name="bitcast.22303.6"}
  %convert.4984.3 = f32[6144]{0} convert(%bitcast.22303.6), metadata={scheduling_name="convert.4984.3"}
  %broadcast.6039.18 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4984.3), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6039.18"}
  %multiply.2631.15 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3995.23, %broadcast.6039.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2631.15"}
  %param_2.709 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.709"}
  %bitcast.22292.23 = f32[4,8192]{1,0} bitcast(%param_2.709), metadata={scheduling_name="bitcast.22292.23"}
  %broadcast.5628.23 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22292.23), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5628.23"}
  %multiply.2632.9 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2631.15, %broadcast.5628.23), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2632.9"}
  %param_4.204 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.204"}
  %dynamic-slice.1497.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_4.204, %subtract.247.193, %constant_1668_7, %constant_1668_7, %constant_1668_7, /*index=5*/%constant_1668_7), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1497.1"}
  %bitcast.22267.29 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1497.1), metadata={scheduling_name="bitcast.22267.29"}
  %convert.3944.29 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22267.29), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3944.29"}
  %param_1.1128 = f32[1,1,4,8192]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1128"}
  %bitcast.22670.7 = f32[4,8192]{1,0} bitcast(%param_1.1128), metadata={scheduling_name="bitcast.22670.7"}
  %broadcast.5642.7 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22670.7), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5642.7"}
  %multiply.2637.7 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.29, %broadcast.5642.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2637.7"}
  %add.3017.7 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2632.9, %multiply.2637.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3017.7"}
  %add.3019.5 = f32[1,4,8192,6144]{3,2,1,0} add(%param_0.1242, %add.3017.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.3019.5"}
  ROOT %convert.3997.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.3019.5), metadata={scheduling_name="convert.3997.1"}
}

%fused_concatenate.4 (param_0.1309: bf16[1,1,4,8192,64], param_1.1197: bf16[1,1,4,8192,64], param_2.722: bf16[1,4,8192,48,128]) -> bf16[1,4,8192,48,128] {
  %param_2.722 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.722"}
  %slice.2394.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.722), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2394.4"}
  %convert.3983.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2394.4), metadata={scheduling_name="convert.3983.14"}
  %param_0.1309 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1309"}
  %bitcast.22391.37 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1309), metadata={scheduling_name="bitcast.22391.37"}
  %convert.4986.33 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.37), metadata={scheduling_name="convert.4986.33"}
  %broadcast.6041.22 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4986.33), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6041.22"}
  %multiply.2627.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3983.14, %broadcast.6041.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2627.7"}
  %slice.2395.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.722), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2395.4"}
  %convert.3985.12 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2395.4), metadata={scheduling_name="convert.3985.12"}
  %param_1.1197 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1197"}
  %bitcast.22378.33 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1197), metadata={scheduling_name="bitcast.22378.33"}
  %convert.4985.29 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.33), metadata={scheduling_name="convert.4985.29"}
  %broadcast.6040.18 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4985.29), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6040.18"}
  %multiply.2628.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3985.12, %broadcast.6040.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2628.5"}
  %add.3014.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2627.7, %multiply.2628.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3014.5"}
  %convert.3987.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3014.5), metadata={scheduling_name="convert.3987.3"}
  %multiply.2629.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3983.14, %broadcast.6040.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2629.7"}
  %negate.217.7 = f32[1,4,8192,48,64]{4,3,2,1,0} negate(%convert.3985.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.217.7"}
  %multiply.2630.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%negate.217.7, %broadcast.6041.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2630.5"}
  %add.3015.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2629.7, %multiply.2630.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3015.5"}
  %convert.3992.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3015.5), metadata={scheduling_name="convert.3992.3"}
  ROOT %concatenate.710.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.3987.3, %convert.3992.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.710.1"}
}

%fused_concatenate.5 (param_0.1315: bf16[1,1,4,8192,64], param_1.1206: bf16[1,1,4,8192,64], param_2.731: bf16[1,4,8192,48,128]) -> bf16[1,4,8192,48,128] {
  %param_2.731 = bf16[1,4,8192,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.731"}
  %slice.2411.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.731), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2411.4"}
  %convert.4092.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2411.4), metadata={scheduling_name="convert.4092.14"}
  %param_0.1315 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1315"}
  %bitcast.22391.43 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1315), metadata={scheduling_name="bitcast.22391.43"}
  %convert.4986.39 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.43), metadata={scheduling_name="convert.4986.39"}
  %broadcast.6041.28 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4986.39), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6041.28"}
  %multiply.2680.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4092.14, %broadcast.6041.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2680.7"}
  %slice.2412.4 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%param_2.731), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2412.4"}
  %convert.4094.12 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2412.4), metadata={scheduling_name="convert.4094.12"}
  %param_1.1206 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1206"}
  %bitcast.22378.39 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1206), metadata={scheduling_name="bitcast.22378.39"}
  %convert.4985.35 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.39), metadata={scheduling_name="convert.4985.35"}
  %broadcast.6040.24 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4985.35), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6040.24"}
  %multiply.2681.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4094.12, %broadcast.6040.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2681.5"}
  %add.3038.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2680.7, %multiply.2681.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3038.5"}
  %convert.4096.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3038.5), metadata={scheduling_name="convert.4096.3"}
  %multiply.2682.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4092.14, %broadcast.6040.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2682.7"}
  %negate.221.7 = f32[1,4,8192,48,64]{4,3,2,1,0} negate(%convert.4094.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.221.7"}
  %multiply.2683.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%negate.221.7, %broadcast.6041.28), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2683.5"}
  %add.3039.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2682.7, %multiply.2683.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3039.5"}
  %convert.4101.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3039.5), metadata={scheduling_name="convert.4101.3"}
  ROOT %concatenate.715.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4096.3, %convert.4101.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.715.1"}
}

%fused_concatenate.6 (param_0.1307: bf16[1,1,4,8192,64], param_1.1195: bf16[32768,6144], param_2.720: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.1195 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1195"}
  %bitcast.22326.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.1195), metadata={scheduling_name="bitcast.22326.18"}
  %slice.2388.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.22326.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2388.9"}
  %convert.3947.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2388.9), metadata={scheduling_name="convert.3947.14"}
  %param_2.720 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.720"}
  %bitcast.22378.31 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.720), metadata={scheduling_name="bitcast.22378.31"}
  %convert.4985.27 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.31), metadata={scheduling_name="convert.4985.27"}
  %broadcast.6040.16 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4985.27), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6040.16"}
  %multiply.2614.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3947.14, %broadcast.6040.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2614.7"}
  %slice.2389.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.22326.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2389.9"}
  %convert.3952.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2389.9), metadata={scheduling_name="convert.3952.10"}
  %param_0.1307 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1307"}
  %bitcast.22391.35 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1307), metadata={scheduling_name="bitcast.22391.35"}
  %convert.4986.31 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.35), metadata={scheduling_name="convert.4986.31"}
  %broadcast.6041.20 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4986.31), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6041.20"}
  %multiply.2615.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3952.10, %broadcast.6041.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2615.5"}
  %subtract.253.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2614.7, %multiply.2615.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.253.5"}
  %convert.3955.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.253.5), metadata={scheduling_name="convert.3955.3"}
  %multiply.2616.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3952.10, %broadcast.6040.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2616.5"}
  %multiply.2617.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.3947.14, %broadcast.6041.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2617.7"}
  %add.3009.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2616.5, %multiply.2617.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3009.5"}
  %convert.3960.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3009.5), metadata={scheduling_name="convert.3960.3"}
  ROOT %concatenate.707.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.3955.3, %convert.3960.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.707.1"}
}

%fused_concatenate.7 (param_0.1313: bf16[1,1,4,8192,64], param_1.1204: bf16[32768,6144], param_2.729: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,48,128] {
  %param_1.1204 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.1204"}
  %bitcast.23391.18 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%param_1.1204), metadata={scheduling_name="bitcast.23391.18"}
  %slice.2405.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.23391.18), slice={[0:1], [0:4], [0:8192], [0:48], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2405.9"}
  %convert.4058.14 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2405.9), metadata={scheduling_name="convert.4058.14"}
  %param_2.729 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.729"}
  %bitcast.22378.37 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.729), metadata={scheduling_name="bitcast.22378.37"}
  %convert.4985.33 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.37), metadata={scheduling_name="convert.4985.33"}
  %broadcast.6040.22 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4985.33), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6040.22"}
  %multiply.2661.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4058.14, %broadcast.6040.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2661.7"}
  %slice.2406.9 = bf16[1,4,8192,48,64]{4,3,2,1,0} slice(%bitcast.23391.18), slice={[0:1], [0:4], [0:8192], [0:48], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2406.9"}
  %convert.4060.10 = f32[1,4,8192,48,64]{4,3,2,1,0} convert(%slice.2406.9), metadata={scheduling_name="convert.4060.10"}
  %param_0.1313 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1313"}
  %bitcast.22391.41 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1313), metadata={scheduling_name="bitcast.22391.41"}
  %convert.4986.37 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.41), metadata={scheduling_name="convert.4986.37"}
  %broadcast.6041.26 = f32[1,4,8192,48,64]{4,3,2,1,0} broadcast(%convert.4986.37), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6041.26"}
  %multiply.2662.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4060.10, %broadcast.6041.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2662.5"}
  %subtract.257.5 = f32[1,4,8192,48,64]{4,3,2,1,0} subtract(%multiply.2661.7, %multiply.2662.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.257.5"}
  %convert.4062.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%subtract.257.5), metadata={scheduling_name="convert.4062.3"}
  %multiply.2663.5 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4060.10, %broadcast.6040.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2663.5"}
  %multiply.2664.7 = f32[1,4,8192,48,64]{4,3,2,1,0} multiply(%convert.4058.14, %broadcast.6041.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2664.7"}
  %add.3032.5 = f32[1,4,8192,48,64]{4,3,2,1,0} add(%multiply.2663.5, %multiply.2664.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3032.5"}
  %convert.4067.3 = bf16[1,4,8192,48,64]{4,3,2,1,0} convert(%add.3032.5), metadata={scheduling_name="convert.4067.3"}
  ROOT %concatenate.712.1 = bf16[1,4,8192,48,128]{4,3,2,1,0} concatenate(%convert.4062.3, %convert.4067.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.712.1"}
}

%fused_concatenate.8 (param_0.1483: bf16[1,1,4,8192,64], param_1.1421: bf16[1,1,4,8192,64], param_2.888: bf16[1,4,8192,8,128]) -> bf16[1,4,8192,8,128] {
  %param_2.888 = bf16[1,4,8192,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.888"}
  %slice.2392.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.888), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2392.4"}
  %convert.3972.12 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2392.4), metadata={scheduling_name="convert.3972.12"}
  %param_0.1483 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1483"}
  %bitcast.22391.103 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1483), metadata={scheduling_name="bitcast.22391.103"}
  %convert.4986.97 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.103), metadata={scheduling_name="convert.4986.97"}
  %broadcast.6043.59 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4986.97), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6043.59"}
  %multiply.2623.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3972.12, %broadcast.6043.59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2623.7"}
  %slice.2393.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.888), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2393.4"}
  %convert.3974.14 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2393.4), metadata={scheduling_name="convert.3974.14"}
  %param_1.1421 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1421"}
  %bitcast.22378.83 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1421), metadata={scheduling_name="bitcast.22378.83"}
  %convert.4985.77 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.83), metadata={scheduling_name="convert.4985.77"}
  %broadcast.6042.43 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4985.77), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6042.43"}
  %multiply.2624.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3974.14, %broadcast.6042.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2624.5"}
  %add.3012.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2623.7, %multiply.2624.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3012.5"}
  %convert.3976.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3012.5), metadata={scheduling_name="convert.3976.3"}
  %multiply.2625.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3972.12, %broadcast.6042.43), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2625.5"}
  %negate.216.9 = f32[1,4,8192,8,64]{4,3,2,1,0} negate(%convert.3974.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.216.9"}
  %multiply.2626.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%negate.216.9, %broadcast.6043.59), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2626.7"}
  %add.3013.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2625.5, %multiply.2626.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3013.5"}
  %convert.3981.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3013.5), metadata={scheduling_name="convert.3981.3"}
  ROOT %concatenate.709.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.3976.3, %convert.3981.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.709.1"}
}

%fused_concatenate.9 (param_0.1490: bf16[1,1,4,8192,64], param_1.1430: bf16[1,1,4,8192,64], param_2.897: bf16[1,4,8192,8,128]) -> bf16[1,4,8192,8,128] {
  %param_2.897 = bf16[1,4,8192,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.897"}
  %slice.2409.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.897), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2409.4"}
  %convert.4081.12 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2409.4), metadata={scheduling_name="convert.4081.12"}
  %param_0.1490 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1490"}
  %bitcast.22391.109 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1490), metadata={scheduling_name="bitcast.22391.109"}
  %convert.4986.103 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.109), metadata={scheduling_name="convert.4986.103"}
  %broadcast.6043.65 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4986.103), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6043.65"}
  %multiply.2676.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4081.12, %broadcast.6043.65), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2676.7"}
  %slice.2410.4 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%param_2.897), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="slice.2410.4"}
  %convert.4083.14 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2410.4), metadata={scheduling_name="convert.4083.14"}
  %param_1.1430 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.1430"}
  %bitcast.22378.89 = bf16[4,8192,64]{2,1,0} bitcast(%param_1.1430), metadata={scheduling_name="bitcast.22378.89"}
  %convert.4985.83 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.89), metadata={scheduling_name="convert.4985.83"}
  %broadcast.6042.49 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4985.83), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6042.49"}
  %multiply.2677.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4083.14, %broadcast.6042.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2677.5"}
  %add.3036.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2676.7, %multiply.2677.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3036.5"}
  %convert.4085.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3036.5), metadata={scheduling_name="convert.4085.3"}
  %multiply.2678.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4081.12, %broadcast.6042.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2678.5"}
  %negate.220.9 = f32[1,4,8192,8,64]{4,3,2,1,0} negate(%convert.4083.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/neg" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="negate.220.9"}
  %multiply.2679.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%negate.220.9, %broadcast.6043.65), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2679.7"}
  %add.3037.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2678.5, %multiply.2679.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add_any" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="add.3037.5"}
  %convert.4090.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3037.5), metadata={scheduling_name="convert.4090.3"}
  ROOT %concatenate.714.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4085.3, %convert.4090.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="concatenate.714.1"}
}

%fused_concatenate.10 (param_0.1481: bf16[1,1,4,8192,64], param_1.1419: bf16[32768,1024], param_2.886: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.1419 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.1419"}
  %bitcast.22432.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.1419), metadata={scheduling_name="bitcast.22432.14"}
  %slice.2390.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.22432.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2390.7"}
  %convert.3961.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2390.7), metadata={scheduling_name="convert.3961.10"}
  %param_2.886 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.886"}
  %bitcast.22378.79 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.886), metadata={scheduling_name="bitcast.22378.79"}
  %convert.4985.73 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.79), metadata={scheduling_name="convert.4985.73"}
  %broadcast.6042.39 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4985.73), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6042.39"}
  %multiply.2618.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3961.10, %broadcast.6042.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2618.5"}
  %slice.2391.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.22432.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2391.7"}
  %convert.3963.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2391.7), metadata={scheduling_name="convert.3963.10"}
  %param_0.1481 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1481"}
  %bitcast.22391.99 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1481), metadata={scheduling_name="bitcast.22391.99"}
  %convert.4986.93 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.99), metadata={scheduling_name="convert.4986.93"}
  %broadcast.6043.55 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4986.93), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6043.55"}
  %multiply.2619.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3963.10, %broadcast.6043.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2619.7"}
  %subtract.254.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2618.5, %multiply.2619.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.254.5"}
  %convert.3965.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.254.5), metadata={scheduling_name="convert.3965.3"}
  %multiply.2620.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3963.10, %broadcast.6042.39), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2620.5"}
  %multiply.2621.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.3961.10, %broadcast.6043.55), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2621.7"}
  %add.3010.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2620.5, %multiply.2621.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3010.5"}
  %convert.3970.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3010.5), metadata={scheduling_name="convert.3970.3"}
  ROOT %concatenate.708.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.3965.3, %convert.3970.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.708.1"}
}

%fused_concatenate.11 (param_0.1488: bf16[1,1,4,8192,64], param_1.1428: bf16[32768,1024], param_2.895: bf16[1,1,4,8192,64]) -> bf16[1,4,8192,8,128] {
  %param_1.1428 = bf16[32768,1024]{1,0} parameter(1), metadata={scheduling_name="param_1.1428"}
  %bitcast.23443.14 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%param_1.1428), metadata={scheduling_name="bitcast.23443.14"}
  %slice.2407.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.23443.14), slice={[0:1], [0:4], [0:8192], [0:8], [0:64]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2407.7"}
  %convert.4068.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2407.7), metadata={scheduling_name="convert.4068.10"}
  %param_2.895 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.895"}
  %bitcast.22378.85 = bf16[4,8192,64]{2,1,0} bitcast(%param_2.895), metadata={scheduling_name="bitcast.22378.85"}
  %convert.4985.79 = f32[4,8192,64]{2,1,0} convert(%bitcast.22378.85), metadata={scheduling_name="convert.4985.79"}
  %broadcast.6042.45 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4985.79), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6042.45"}
  %multiply.2665.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4068.10, %broadcast.6042.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2665.5"}
  %slice.2408.7 = bf16[1,4,8192,8,64]{4,3,2,1,0} slice(%bitcast.23443.14), slice={[0:1], [0:4], [0:8192], [0:8], [64:128]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/split" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 scheduling_name="slice.2408.7"}
  %convert.4070.10 = f32[1,4,8192,8,64]{4,3,2,1,0} convert(%slice.2408.7), metadata={scheduling_name="convert.4070.10"}
  %param_0.1488 = bf16[1,1,4,8192,64]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1488"}
  %bitcast.22391.105 = bf16[4,8192,64]{2,1,0} bitcast(%param_0.1488), metadata={scheduling_name="bitcast.22391.105"}
  %convert.4986.99 = f32[4,8192,64]{2,1,0} convert(%bitcast.22391.105), metadata={scheduling_name="convert.4986.99"}
  %broadcast.6043.61 = f32[1,4,8192,8,64]{4,3,2,1,0} broadcast(%convert.4986.99), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="broadcast.6043.61"}
  %multiply.2666.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4070.10, %broadcast.6043.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="multiply.2666.7"}
  %subtract.258.5 = f32[1,4,8192,8,64]{4,3,2,1,0} subtract(%multiply.2665.5, %multiply.2666.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/sub" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=307 scheduling_name="subtract.258.5"}
  %convert.4072.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%subtract.258.5), metadata={scheduling_name="convert.4072.3"}
  %multiply.2667.5 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4070.10, %broadcast.6042.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2667.5"}
  %multiply.2668.7 = f32[1,4,8192,8,64]{4,3,2,1,0} multiply(%convert.4068.10, %broadcast.6043.61), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="multiply.2668.7"}
  %add.3033.5 = f32[1,4,8192,8,64]{4,3,2,1,0} add(%multiply.2667.5, %multiply.2668.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/add" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=308 scheduling_name="add.3033.5"}
  %convert.4077.3 = bf16[1,4,8192,8,64]{4,3,2,1,0} convert(%add.3033.5), metadata={scheduling_name="convert.4077.3"}
  ROOT %concatenate.713.1 = bf16[1,4,8192,8,128]{4,3,2,1,0} concatenate(%convert.4072.3, %convert.4077.3), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 scheduling_name="concatenate.713.1"}
}

%fused_convert.14 (param_0.2311: f32[64], param_1.2368: s32[4,4,8192], param_2.2036: s32[32], param_3.1680: u32[], param_4.1448: s32[9], param_5.1315: s32[]) -> (bf16[1,1,4,8192,64], bf16[1,1,4,8192,64]) {
  %param_1.2368 = s32[4,4,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2368"}
  %param_4.1448 = s32[9]{0} parameter(4), metadata={scheduling_name="param_4.1448"}
  %constant_1660_29 = s32[] constant(8)
  %param_5.1315 = s32[] parameter(5), metadata={scheduling_name="param_5.1315"}
  %subtract.247.163 = s32[] subtract(%constant_1660_29, %param_5.1315), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.163"}
  %dynamic-slice.1484.144 = s32[1]{0} dynamic-slice(%param_4.1448, %subtract.247.163), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.144"}
  %param_2.2036 = s32[32]{0} parameter(2), metadata={scheduling_name="param_2.2036"}
  %param_3.1680 = u32[] parameter(3), metadata={scheduling_name="param_3.1680"}
  %dynamic-slice.1485.139 = s32[1]{0} dynamic-slice(%param_2.2036, %param_3.1680), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.139"}
  %subtract.248.134 = s32[1]{0} subtract(%dynamic-slice.1484.144, %dynamic-slice.1485.139), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.134"}
  %constant_2166_6 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.134 = s32[1]{0} maximum(%subtract.248.134, %constant_2166_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.134"}
  %constant_5145_2 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.134 = s32[1]{0} and(%maximum.47.134, %constant_5145_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.134"}
  %compare.1636.5 = pred[1]{0} compare(%and.301.134, %constant_2166_6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="compare.1636.5"}
  %compare.1615.134 = pred[1]{0} compare(%and.301.134, %constant_2166_6), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.134"}
  %and.308.5 = pred[1]{0} and(%compare.1636.5, %compare.1615.134), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="and.308.5"}
  %constant_5149_3 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.3007.5 = s32[1]{0} add(%and.301.134, %constant_5149_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="add.3007.5"}
  %select.1282.5 = s32[1]{0} select(%and.308.5, %add.3007.5, %and.301.134), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_microbatch_and_repeat_ids/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=219 scheduling_name="select.1282.5"}
  %compare.1637.5 = pred[1]{0} compare(%select.1282.5, %constant_2166_6), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="compare.1637.5"}
  %add.3008.5 = s32[1]{0} add(%select.1282.5, %constant_5149_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="add.3008.5"}
  %select.1283.5 = s32[1]{0} select(%compare.1637.5, %add.3008.5, %select.1282.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="select.1283.5"}
  %bitcast.22354.7 = s32[] bitcast(%select.1283.5), metadata={scheduling_name="bitcast.22354.7"}
  %constant_1668_34 = s32[] constant(0)
  %dynamic-slice.1505.7 = s32[1,4,8192]{2,1,0} dynamic-slice(%param_1.2368, %bitcast.22354.7, %constant_1668_34, %constant_1668_34), dynamic_slice_sizes={1,4,8192}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.vmap_gather/squeeze" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=266 scheduling_name="dynamic-slice.1505.7"}
  %convert.3948.5 = f32[1,4,8192]{2,1,0} convert(%dynamic-slice.1505.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="convert.3948.5"}
  %bitcast.22359.3 = f32[4,8192]{1,0} bitcast(%convert.3948.5), metadata={scheduling_name="bitcast.22359.3"}
  %broadcast.5630.3 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%bitcast.22359.3), dimensions={2,3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5630.3"}
  %param_0.2311 = f32[64]{0} parameter(0), metadata={scheduling_name="param_0.2311"}
  %broadcast.5634.1 = f32[1,1,4,8192,64]{4,3,2,1,0} broadcast(%param_0.2311), dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="broadcast.5634.1"}
  %divide.464.4 = f32[1,1,4,8192,64]{4,3,2,1,0} divide(%broadcast.5630.3, %broadcast.5634.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=303 scheduling_name="divide.464.4"}
  %cosine.70.3 = f32[1,1,4,8192,64]{4,3,2,1,0} cosine(%divide.464.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/cos" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="cosine.70.3"}
  %convert.3950.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%cosine.70.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="convert.3950.1"}
  %sine.67.3.clone.1 = f32[1,1,4,8192,64]{4,3,2,1,0} sine(%divide.464.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/sin" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="sine.67.3.clone.1"}
  %convert.3953.1.clone.1 = bf16[1,1,4,8192,64]{4,3,2,1,0} convert(%sine.67.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=304 scheduling_name="convert.3953.1.clone.1"}
  ROOT %tuple.486 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) tuple(%convert.3950.1, %convert.3953.1.clone.1), metadata={scheduling_name="tuple.486"}
}

%fused_compare.7 (param_0.1610: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_0.1610 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1610"}
  %bitcast.21784.3 = s32[4,8192,2]{2,1,0} bitcast(%param_0.1610), metadata={scheduling_name="bitcast.21784.3"}
  %broadcast.5602.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.21784.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5602.3"}
  %iota.378.1 = s32[1,4,8,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.378.1"}
  ROOT %compare.1630.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5602.3, %iota.378.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1630.1"}
}

%fused_compare.8 (param_0.1609: s32[32768,2]) -> pred[1,4,8,8192,2] {
  %param_0.1609 = s32[32768,2]{1,0} parameter(0), metadata={scheduling_name="param_0.1609"}
  %bitcast.22727.3 = s32[4,8192,2]{2,1,0} bitcast(%param_0.1609), metadata={scheduling_name="bitcast.22727.3"}
  %broadcast.5647.3 = s32[1,4,8,8192,2]{4,3,2,1,0} broadcast(%bitcast.22727.3), dimensions={1,3,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="broadcast.5647.3"}
  %iota.385.1 = s32[1,4,8,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.385.1"}
  ROOT %compare.1638.1 = pred[1,4,8,8192,2]{4,3,2,1,0} compare(%broadcast.5647.3, %iota.385.1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="compare.1638.1"}
}

%fused_slice.2 (param_0.2369: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.2369 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2369"}
  %convert.3907.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2369), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.3907.9"}
  %bitcast.21790.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.3907.9), metadata={scheduling_name="bitcast.21790.3"}
  %constant_1668_3 = s32[] constant(0)
  %reduce-window.160.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.21790.3, %constant_1668_3), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.160.3"}
  ROOT %slice.2381.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.160.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2381.1"}
}

%fused_slice.3 (param_0.2374: pred[1,4,8,8192,2]) -> s32[1,4,8,1024,1] {
  %param_0.2374 = pred[1,4,8,8192,2]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2374"}
  %convert.4000.9 = s32[1,4,8,8192,2]{4,3,2,1,0} convert(%param_0.2374), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="convert.4000.9"}
  %bitcast.22733.3 = s32[1,4,8,1024,16]{4,3,2,1,0} bitcast(%convert.4000.9), metadata={scheduling_name="bitcast.22733.3"}
  %constant_1668_25 = s32[] constant(0)
  %reduce-window.164.3 = s32[1,4,8,1024,16]{4,3,2,1,0} reduce-window(%bitcast.22733.3, %constant_1668_25), window={size=1x1x1x1x16 pad=0_0x0_0x0_0x0_0x15_0}, to_apply=%region_7.620, metadata={scheduling_name="reduce-window.164.3"}
  ROOT %slice.2396.1 = s32[1,4,8,1024,1]{4,3,2,1,0} slice(%reduce-window.164.3), slice={[0:1], [0:4], [0:8], [0:1024], [15:16]}, metadata={scheduling_name="slice.2396.1"}
}

%region_6.604.clone.1 (Arg_0.170: f32[], Arg_1.170: f32[]) -> f32[] {
  %Arg_1.170 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.170"}
  %Arg_0.170 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.170"}
  ROOT %add.2971.0 = f32[] add(%Arg_0.170, %Arg_1.170), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2971.0"}
}

%fused_reduce.13 (param_0.2368: s32[1,4,8,8192], param_1.2434: bf16[4,16392,8192]) -> bf16[4,8,8192] {
  %param_1.2434 = bf16[4,16392,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2434"}
  %bitcast.22938.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} bitcast(%param_1.2434), metadata={scheduling_name="bitcast.22938.9"}
  %convert.4016.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%bitcast.22938.9), metadata={scheduling_name="convert.4016.9"}
  %param_0.2368 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2368"}
  %bitcast.22826.15 = s32[4,8,8192]{2,1,0} bitcast(%param_0.2368), metadata={scheduling_name="bitcast.22826.15"}
  %broadcast.5654.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.22826.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5654.15"}
  %iota.387.13 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.387.13"}
  %compare.1640.13 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5654.15, %iota.387.13), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1640.13"}
  %convert.4004.19 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1640.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.4004.19"}
  %convert.4005.19 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.4004.19), metadata={scheduling_name="convert.4005.19"}
  %multiply.2644.7 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%convert.4016.9, %convert.4005.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2644.7"}
  %convert.4018.5 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2644.7), metadata={scheduling_name="convert.4018.5"}
  %bitcast.22946.5 = bf16[4,8,2049,8192]{3,2,1,0} bitcast(%convert.4018.5), metadata={scheduling_name="bitcast.22946.5"}
  %convert.4019.5 = f32[4,8,2049,8192]{3,2,1,0} convert(%bitcast.22946.5), metadata={scheduling_name="convert.4019.5"}
  %constant_1658_28 = bf16[] constant(0)
  %convert.4980.16 = f32[] convert(%constant_1658_28), metadata={scheduling_name="convert.4980.16"}
  %reduce.504.3 = f32[4,8,8192]{2,1,0} reduce(%convert.4019.5, %convert.4980.16), dimensions={2}, to_apply=%region_6.604.clone.1, metadata={scheduling_name="reduce.504.3"}
  ROOT %convert.4021.1 = bf16[4,8,8192]{2,1,0} convert(%reduce.504.3), metadata={scheduling_name="convert.4021.1"}
}

%region_6.604.clone (Arg_0.169: f32[], Arg_1.169: f32[]) -> f32[] {
  %Arg_1.169 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.169"}
  %Arg_0.169 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.169"}
  ROOT %add.2970.0 = f32[] add(%Arg_0.169, %Arg_1.169), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2970.0"}
}

%fused_reduce.14 (param_0.2367: s32[1,4,8,8192], param_1.2433: bf16[4,16392,8192]) -> bf16[4,8,8192] {
  %param_1.2433 = bf16[4,16392,8192]{2,1,0} parameter(1), metadata={scheduling_name="param_1.2433"}
  %bitcast.22132.9 = bf16[1,4,8,2049,8192]{4,3,2,1,0} bitcast(%param_1.2433), metadata={scheduling_name="bitcast.22132.9"}
  %convert.3931.9 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%bitcast.22132.9), metadata={scheduling_name="convert.3931.9"}
  %param_0.2367 = s32[1,4,8,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2367"}
  %bitcast.21882.15 = s32[4,8,8192]{2,1,0} bitcast(%param_0.2367), metadata={scheduling_name="bitcast.21882.15"}
  %broadcast.5609.15 = s32[1,4,8,2049,8192]{4,3,2,1,0} broadcast(%bitcast.21882.15), dimensions={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="broadcast.5609.15"}
  %iota.379.13 = s32[1,4,8,2049,8192]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.379.13"}
  %compare.1632.13 = pred[1,4,8,2049,8192]{4,3,2,1,0} compare(%broadcast.5609.15, %iota.379.13), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="compare.1632.13"}
  %convert.3911.19 = s32[1,4,8,2049,8192]{4,3,2,1,0} convert(%compare.1632.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="convert.3911.19"}
  %convert.3912.19 = f32[1,4,8,2049,8192]{4,3,2,1,0} convert(%convert.3911.19), metadata={scheduling_name="convert.3912.19"}
  %multiply.2595.7 = f32[1,4,8,2049,8192]{4,3,2,1,0} multiply(%convert.3931.9, %convert.3912.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1170 scheduling_name="multiply.2595.7"}
  %convert.3933.5 = bf16[1,4,8,2049,8192]{4,3,2,1,0} convert(%multiply.2595.7), metadata={scheduling_name="convert.3933.5"}
  %bitcast.22140.5 = bf16[4,8,2049,8192]{3,2,1,0} bitcast(%convert.3933.5), metadata={scheduling_name="bitcast.22140.5"}
  %convert.3934.5 = f32[4,8,2049,8192]{3,2,1,0} convert(%bitcast.22140.5), metadata={scheduling_name="convert.3934.5"}
  %constant_1658_27 = bf16[] constant(0)
  %convert.4980.18 = f32[] convert(%constant_1658_27), metadata={scheduling_name="convert.4980.18"}
  %reduce.501.3 = f32[4,8,8192]{2,1,0} reduce(%convert.3934.5, %convert.4980.18), dimensions={2}, to_apply=%region_6.604.clone, metadata={scheduling_name="reduce.501.3"}
  ROOT %convert.3936.1 = bf16[4,8,8192]{2,1,0} convert(%reduce.501.3), metadata={scheduling_name="convert.3936.1"}
}

%fused_select (param_0.1746: pred[1,4,8192,2], param_1.2559: s32[32768,2], param_2.1901: s32[4,8,8192], param_3.1496: bf16[4,8,8192], param_4.1187: s32[3], param_5.1329: u32[32], param_6.1277: u32[], param_7.1201: s32[32]) -> bf16[1,4,8192,2] {
  %param_0.1746 = pred[1,4,8192,2]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1746"}
  %iota.373.46 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.46"}
  %param_7.1201 = s32[32]{0} parameter(7), metadata={scheduling_name="param_7.1201"}
  %param_6.1277 = u32[] parameter(6), metadata={scheduling_name="param_6.1277"}
  %dynamic-slice.1492.9 = s32[1]{0} dynamic-slice(%param_7.1201, %param_6.1277), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.9"}
  %constant_5149_7 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.9 = s32[1]{0} multiply(%dynamic-slice.1492.9, %constant_5149_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.9"}
  %bitcast.21421.50 = s32[] bitcast(%multiply.2575.9), metadata={scheduling_name="bitcast.21421.50"}
  %broadcast.5583.49 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.50), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.49"}
  %add.2989.46 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.46, %broadcast.5583.49), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.46"}
  %iota.375.17 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.375.17"}
  %param_1.2559 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2559"}
  %bitcast.21702.75 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2559), metadata={scheduling_name="bitcast.21702.75"}
  %constant_1668_43 = s32[] constant(0)
  %broadcast.5584.50 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_43), dimensions={}, metadata={scheduling_name="broadcast.5584.50"}
  %compare.1628.25 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21702.75, %broadcast.5584.50), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1628.25"}
  %constant_1660_4 = s32[] constant(8)
  %broadcast.5585.46 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_4), dimensions={}, metadata={scheduling_name="broadcast.5585.46"}
  %add.2996.25 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21702.75, %broadcast.5585.46), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2996.25"}
  %select.1277.25 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1628.25, %add.2996.25, %bitcast.21702.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1277.25"}
  %bitcast.21715.23 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1277.25), metadata={scheduling_name="bitcast.21715.23"}
  %concatenate.705.23 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.46, %iota.375.17, %bitcast.21715.23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.705.23"}
  %broadcast.5587.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%constant_1668_43), dimensions={}, metadata={scheduling_name="broadcast.5587.10"}
  %compare.1634.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.705.23, %broadcast.5587.10), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/ge" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1634.5"}
  %param_4.1187 = s32[3]{0} parameter(4), metadata={scheduling_name="param_4.1187"}
  %broadcast.5588.10 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%param_4.1187), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5588.10"}
  %compare.1635.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.705.23, %broadcast.5588.10), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1635.5"}
  %and.307.3 = pred[1,3,4,8192,2]{4,3,2,1,0} and(%compare.1634.5, %compare.1635.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.307.3"}
  %bitcast.22087.3 = pred[3,4,8192,2]{3,2,1,0} bitcast(%and.307.3), metadata={scheduling_name="bitcast.22087.3"}
  %constant_1759_5 = pred[] constant(true)
  %reduce.409.3 = pred[4,8192,2]{2,1,0} reduce(%bitcast.22087.3, %constant_1759_5), dimensions={0}, to_apply=%region_51.2293, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reduce.409.3"}
  %bitcast.22092.3 = pred[1,4,8192,2]{3,2,1,0} bitcast(%reduce.409.3), metadata={scheduling_name="bitcast.22092.3"}
  %param_3.1496 = bf16[4,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.1496"}
  %bitcast.22149.11 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%param_3.1496), metadata={scheduling_name="bitcast.22149.11"}
  %convert.3937.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22149.11), metadata={scheduling_name="convert.3937.11"}
  %param_2.1901 = s32[4,8,8192]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1901"}
  %bitcast.21855.12 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_2.1901), metadata={scheduling_name="bitcast.21855.12"}
  %convert.3908.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.21855.12), metadata={scheduling_name="convert.3908.11"}
  %multiply.2596.9 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.3937.11, %convert.3908.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2596.9"}
  %convert.3939.7 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2596.9), metadata={scheduling_name="convert.3939.7"}
  %bitcast.22158.5 = bf16[1,4,8192,8]{2,3,1,0} bitcast(%convert.3939.7), metadata={scheduling_name="bitcast.22158.5"}
  %constant_5496_4 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_5.1329 = u32[32]{0} parameter(5), metadata={scheduling_name="param_5.1329"}
  %dynamic-slice.1493.7 = u32[1]{0} dynamic-slice(%param_5.1329, %param_6.1277), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.7"}
  %constant_5497_4 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.7 = u32[1]{0} clamp(%constant_5496_4, %dynamic-slice.1493.7, %constant_5497_4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.7"}
  %convert.3895.7 = s32[1]{0} convert(%clamp.26.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.7"}
  %multiply.2578.7 = s32[1]{0} multiply(%convert.3895.7, %constant_5149_7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.7"}
  %constant_2166_11 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.12 = s32[3]{0} concatenate(%multiply.2578.7, %constant_2166_11, %constant_2166_11), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.12"}
  %broadcast.5586.24 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.12), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.24"}
  %subtract.250.13 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.705.23, %broadcast.5586.24), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.250.13"}
  %pad.348.9 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.250.13, %constant_1668_43), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.348.9"}
  %bitcast.22160.8 = s32[65536,4]{0,1} bitcast(%pad.348.9), metadata={scheduling_name="bitcast.22160.8"}
  %gather.337.5 = bf16[65536,1,1,1,1]{0,4,3,2,1} gather(%bitcast.22158.5, %bitcast.22160.8), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.337.5"}
  %bitcast.22163.3 = bf16[1,4,8192,2]{3,2,1,0} bitcast(%gather.337.5), metadata={scheduling_name="bitcast.22163.3"}
  %constant_1658_47 = bf16[] constant(0)
  %broadcast.5601.8 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1658_47), dimensions={}, metadata={scheduling_name="broadcast.5601.8"}
  %select.1280.3 = bf16[1,4,8192,2]{3,2,1,0} select(%bitcast.22092.3, %bitcast.22163.3, %broadcast.5601.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1280.3"}
  ROOT %select.1281.1 = bf16[1,4,8192,2]{3,2,1,0} select(%param_0.1746, %select.1280.3, %broadcast.5601.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1281.1"}
}

%fused_select.1 (param_0.1749: pred[1,4,8192,2], param_1.2551: s32[32768,2], param_2.1894: s32[4,8,8192], param_3.1488: bf16[4,8,8192], param_4.1179: s32[3], param_5.1330: u32[32], param_6.1278: u32[], param_7.1202: s32[32]) -> bf16[1,4,8192,2] {
  %param_0.1749 = pred[1,4,8192,2]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.1749"}
  %iota.373.42 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.373.42"}
  %param_7.1202 = s32[32]{0} parameter(7), metadata={scheduling_name="param_7.1202"}
  %param_6.1278 = u32[] parameter(6), metadata={scheduling_name="param_6.1278"}
  %dynamic-slice.1492.15 = s32[1]{0} dynamic-slice(%param_7.1202, %param_6.1278), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1492.15"}
  %constant_5149_8 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2575.15 = s32[1]{0} multiply(%dynamic-slice.1492.15, %constant_5149_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2575.15"}
  %bitcast.21421.46 = s32[] bitcast(%multiply.2575.15), metadata={scheduling_name="bitcast.21421.46"}
  %broadcast.5583.45 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.21421.46), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5583.45"}
  %add.2989.42 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.373.42, %broadcast.5583.45), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2989.42"}
  %iota.374.17 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.374.17"}
  %param_1.2551 = s32[32768,2]{1,0} parameter(1), metadata={scheduling_name="param_1.2551"}
  %bitcast.21452.75 = s32[1,4,8192,2]{3,2,1,0} bitcast(%param_1.2551), metadata={scheduling_name="bitcast.21452.75"}
  %constant_1668_39 = s32[] constant(0)
  %broadcast.5584.46 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1668_39), dimensions={}, metadata={scheduling_name="broadcast.5584.46"}
  %compare.1619.25 = pred[1,4,8192,2]{3,2,1,0} compare(%bitcast.21452.75, %broadcast.5584.46), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/lt" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1619.25"}
  %constant_1660_7 = s32[] constant(8)
  %broadcast.5585.42 = s32[1,4,8192,2]{3,2,1,0} broadcast(%constant_1660_7), dimensions={}, metadata={scheduling_name="broadcast.5585.42"}
  %add.2990.25 = s32[1,4,8192,2]{3,2,1,0} add(%bitcast.21452.75, %broadcast.5585.42), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2990.25"}
  %select.1271.25 = s32[1,4,8192,2]{3,2,1,0} select(%compare.1619.25, %add.2990.25, %bitcast.21452.75), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1271.25"}
  %bitcast.21465.23 = s32[1,1,4,8192,2]{4,3,2,1,0} bitcast(%select.1271.25), metadata={scheduling_name="bitcast.21465.23"}
  %concatenate.703.23 = s32[1,3,4,8192,2]{4,3,2,1,0} concatenate(%add.2989.42, %iota.374.17, %bitcast.21465.23), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/concatenate" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.703.23"}
  %broadcast.5587.8 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%constant_1668_39), dimensions={}, metadata={scheduling_name="broadcast.5587.8"}
  %compare.1621.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.703.23, %broadcast.5587.8), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/ge" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1621.5"}
  %param_4.1179 = s32[3]{0} parameter(4), metadata={scheduling_name="param_4.1179"}
  %broadcast.5588.8 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%param_4.1179), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5588.8"}
  %compare.1622.5 = pred[1,3,4,8192,2]{4,3,2,1,0} compare(%concatenate.703.23, %broadcast.5588.8), direction=LE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="compare.1622.5"}
  %and.304.3 = pred[1,3,4,8192,2]{4,3,2,1,0} and(%compare.1621.5, %compare.1622.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="and.304.3"}
  %bitcast.21515.3 = pred[3,4,8192,2]{3,2,1,0} bitcast(%and.304.3), metadata={scheduling_name="bitcast.21515.3"}
  %constant_1759_4 = pred[] constant(true)
  %reduce.404.3 = pred[4,8192,2]{2,1,0} reduce(%bitcast.21515.3, %constant_1759_4), dimensions={0}, to_apply=%region_51.2293, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reduce_and" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reduce.404.3"}
  %bitcast.21520.3 = pred[1,4,8192,2]{3,2,1,0} bitcast(%reduce.404.3), metadata={scheduling_name="bitcast.21520.3"}
  %param_3.1488 = bf16[4,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.1488"}
  %bitcast.22955.11 = bf16[1,4,8,8192]{3,2,1,0} bitcast(%param_3.1488), metadata={scheduling_name="bitcast.22955.11"}
  %convert.4022.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22955.11), metadata={scheduling_name="convert.4022.11"}
  %param_2.1894 = s32[4,8,8192]{2,1,0} parameter(2), metadata={scheduling_name="param_2.1894"}
  %bitcast.22799.12 = s32[1,4,8,8192]{3,2,1,0} bitcast(%param_2.1894), metadata={scheduling_name="bitcast.22799.12"}
  %convert.4001.11 = f32[1,4,8,8192]{3,2,1,0} convert(%bitcast.22799.12), metadata={scheduling_name="convert.4001.11"}
  %multiply.2645.9 = f32[1,4,8,8192]{3,2,1,0} multiply(%convert.4022.11, %convert.4001.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1152 scheduling_name="multiply.2645.9"}
  %convert.4024.7 = bf16[1,4,8,8192]{3,2,1,0} convert(%multiply.2645.9), metadata={scheduling_name="convert.4024.7"}
  %bitcast.22964.5 = bf16[1,4,8192,8]{2,3,1,0} bitcast(%convert.4024.7), metadata={scheduling_name="bitcast.22964.5"}
  %constant_5496_5 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  %param_5.1330 = u32[32]{0} parameter(5), metadata={scheduling_name="param_5.1330"}
  %dynamic-slice.1493.9 = u32[1]{0} dynamic-slice(%param_5.1330, %param_6.1278), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1493.9"}
  %constant_5497_5 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %clamp.26.9 = u32[1]{0} clamp(%constant_5496_5, %dynamic-slice.1493.9, %constant_5497_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="clamp.26.9"}
  %convert.3895.9 = s32[1]{0} convert(%clamp.26.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.3895.9"}
  %multiply.2578.9 = s32[1]{0} multiply(%convert.3895.9, %constant_5149_8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2578.9"}
  %constant_2166_2 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %concatenate.704.14 = s32[3]{0} concatenate(%multiply.2578.9, %constant_2166_2, %constant_2166_2), dimensions={0}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="concatenate.704.14"}
  %broadcast.5586.26 = s32[1,3,4,8192,2]{4,3,2,1,0} broadcast(%concatenate.704.14), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5586.26"}
  %subtract.249.13 = s32[1,3,4,8192,2]{4,3,2,1,0} subtract(%concatenate.703.23, %broadcast.5586.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="subtract.249.13"}
  %pad.347.9 = s32[1,4,4,8192,2]{4,3,2,1,0} pad(%subtract.249.13, %constant_1668_39), padding=0_0x1_0x0_0x0_0x0_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="pad.347.9"}
  %bitcast.22966.8 = s32[65536,4]{0,1} bitcast(%pad.347.9), metadata={scheduling_name="bitcast.22966.8"}
  %gather.345.5 = bf16[65536,1,1,1,1]{0,4,3,2,1} gather(%bitcast.22964.5, %bitcast.22966.8), offset_dims={1,2,3,4}, collapsed_slice_dims={}, start_index_map={0,1,2,3}, index_vector_dim=1, slice_sizes={1,1,1,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/gather" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="gather.345.5"}
  %bitcast.22969.3 = bf16[1,4,8192,2]{3,2,1,0} bitcast(%gather.345.5), metadata={scheduling_name="bitcast.22969.3"}
  %constant_1658_4 = bf16[] constant(0)
  %broadcast.5601.10 = bf16[1,4,8192,2]{3,2,1,0} broadcast(%constant_1658_4), dimensions={}, metadata={scheduling_name="broadcast.5601.10"}
  %select.1286.3 = bf16[1,4,8192,2]{3,2,1,0} select(%bitcast.21520.3, %bitcast.22969.3, %broadcast.5601.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1286.3"}
  ROOT %select.1287.1 = bf16[1,4,8192,2]{3,2,1,0} select(%param_0.1749, %select.1286.3, %broadcast.5601.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="select.1287.1"}
}

%fused_multiply.1 (param_0.2407: f32[1,1,4,8192], param_1.2548: f32[4,8192], param_2.1891: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2548 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2548"}
  %bitcast.22245.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2548), metadata={scheduling_name="bitcast.22245.3"}
  %param_0.2407 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2407"}
  %param_2.1891 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1891"}
  %bitcast.21642.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1891), metadata={scheduling_name="bitcast.21642.5"}
  %constant_1695_7 = f32[] constant(0.000162760422)
  %broadcast.5571.22 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_7), dimensions={}, metadata={scheduling_name="broadcast.5571.22"}
  %multiply.2580.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21642.5, %broadcast.5571.22), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2580.5"}
  %constant_1696_7 = f32[] constant(1e-05)
  %broadcast.5572.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_7), dimensions={}, metadata={scheduling_name="broadcast.5572.14"}
  %add.2995.3 = f32[1,4,8192]{2,1,0} add(%multiply.2580.5, %broadcast.5572.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2995.3"}
  %bitcast.21652.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2995.3), metadata={scheduling_name="bitcast.21652.6"}
  %divide.463.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2407, %bitcast.21652.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.463.5"}
  %constant_2062_2 = f32[] constant(-0.5)
  %broadcast.5623.20 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2062_2), dimensions={}, metadata={scheduling_name="broadcast.5623.20"}
  %multiply.2604.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.463.5, %broadcast.5623.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2604.5"}
  %multiply.2605.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.22245.3, %multiply.2604.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2605.3"}
  %constant_2063_2 = f32[] constant(0.000325520843)
  %broadcast.5624.1 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2063_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5624.1"}
  ROOT %multiply.2606.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2605.3, %broadcast.5624.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2606.1"}
}

%fused_multiply.2 (param_0.2408: f32[1,1,4,8192], param_1.2549: f32[4,8192], param_2.1892: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2549 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2549"}
  %bitcast.22654.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2549), metadata={scheduling_name="bitcast.22654.3"}
  %param_0.2408 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2408"}
  %param_2.1892 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1892"}
  %bitcast.22279.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1892), metadata={scheduling_name="bitcast.22279.5"}
  %constant_1695_6 = f32[] constant(0.000162760422)
  %broadcast.5571.18 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_6), dimensions={}, metadata={scheduling_name="broadcast.5571.18"}
  %multiply.2609.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.22279.5, %broadcast.5571.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2609.5"}
  %constant_1696_6 = f32[] constant(1e-05)
  %broadcast.5572.10 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_6), dimensions={}, metadata={scheduling_name="broadcast.5572.10"}
  %add.3006.3 = f32[1,4,8192]{2,1,0} add(%multiply.2609.5, %broadcast.5572.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3006.3"}
  %bitcast.22289.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.3006.3), metadata={scheduling_name="bitcast.22289.6"}
  %divide.465.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2408, %bitcast.22289.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.465.5"}
  %constant_2062_3 = f32[] constant(-0.5)
  %broadcast.5623.16 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2062_3), dimensions={}, metadata={scheduling_name="broadcast.5623.16"}
  %multiply.2634.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.465.5, %broadcast.5623.16), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2634.5"}
  %multiply.2635.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.22654.3, %multiply.2634.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2635.3"}
  %constant_2063_3 = f32[] constant(0.000325520843)
  %broadcast.5624.2 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2063_3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5624.2"}
  ROOT %multiply.2636.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2635.3, %broadcast.5624.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2636.1"}
}

%fused_multiply.3 (param_0.2409: f32[1,1,4,8192], param_1.2550: f32[4,8192], param_2.1893: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2550 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2550"}
  %bitcast.23548.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2550), metadata={scheduling_name="bitcast.23548.3"}
  %param_0.2409 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2409"}
  %param_2.1893 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1893"}
  %bitcast.21326.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1893), metadata={scheduling_name="bitcast.21326.5"}
  %constant_1695_8 = f32[] constant(0.000162760422)
  %broadcast.5571.26 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_8), dimensions={}, metadata={scheduling_name="broadcast.5571.26"}
  %multiply.2571.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.21326.5, %broadcast.5571.26), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2571.5"}
  %constant_1696_8 = f32[] constant(1e-05)
  %broadcast.5572.18 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_8), dimensions={}, metadata={scheduling_name="broadcast.5572.18"}
  %add.2983.3 = f32[1,4,8192]{2,1,0} add(%multiply.2571.5, %broadcast.5572.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.2983.3"}
  %bitcast.21334.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.2983.3), metadata={scheduling_name="bitcast.21334.6"}
  %divide.470.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2409, %bitcast.21334.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.470.5"}
  %constant_2062_4 = f32[] constant(-0.5)
  %broadcast.5623.12 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2062_4), dimensions={}, metadata={scheduling_name="broadcast.5623.12"}
  %multiply.2672.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.470.5, %broadcast.5623.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2672.5"}
  %multiply.2673.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.23548.3, %multiply.2672.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2673.3"}
  %constant_2063_4 = f32[] constant(0.000325520843)
  %broadcast.5624.3 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2063_4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5624.3"}
  ROOT %multiply.2674.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2673.3, %broadcast.5624.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2674.1"}
}

%fused_multiply.4 (param_0.2406: f32[1,1,4,8192], param_1.2547: f32[4,8192], param_2.1890: f32[4,8192]) -> f32[1,1,4,8192] {
  %param_1.2547 = f32[4,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.2547"}
  %bitcast.24365.3 = f32[1,1,4,8192]{3,2,1,0} bitcast(%param_1.2547), metadata={scheduling_name="bitcast.24365.3"}
  %param_0.2406 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2406"}
  %param_2.1890 = f32[4,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.1890"}
  %bitcast.23342.5 = f32[1,4,8192]{2,1,0} bitcast(%param_2.1890), metadata={scheduling_name="bitcast.23342.5"}
  %constant_1695_5 = f32[] constant(0.000162760422)
  %broadcast.5571.14 = f32[1,4,8192]{2,1,0} broadcast(%constant_1695_5), dimensions={}, metadata={scheduling_name="broadcast.5571.14"}
  %multiply.2658.5 = f32[1,4,8192]{2,1,0} multiply(%bitcast.23342.5, %broadcast.5571.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2658.5"}
  %constant_1696_5 = f32[] constant(1e-05)
  %broadcast.5572.6 = f32[1,4,8192]{2,1,0} broadcast(%constant_1696_5), dimensions={}, metadata={scheduling_name="broadcast.5572.6"}
  %add.3031.3 = f32[1,4,8192]{2,1,0} add(%multiply.2658.5, %broadcast.5572.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3031.3"}
  %bitcast.23352.6 = f32[1,1,4,8192]{3,2,1,0} bitcast(%add.3031.3), metadata={scheduling_name="bitcast.23352.6"}
  %divide.471.5 = f32[1,1,4,8192]{3,2,1,0} divide(%param_0.2406, %bitcast.23352.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.471.5"}
  %constant_2062_1 = f32[] constant(-0.5)
  %broadcast.5623.8 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2062_1), dimensions={}, metadata={scheduling_name="broadcast.5623.8"}
  %multiply.2690.5 = f32[1,1,4,8192]{3,2,1,0} multiply(%divide.471.5, %broadcast.5623.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2690.5"}
  %multiply.2691.3 = f32[1,1,4,8192]{3,2,1,0} multiply(%bitcast.24365.3, %multiply.2690.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2691.3"}
  %constant_2063_1 = f32[] constant(0.000325520843)
  %broadcast.5624.4 = f32[1,1,4,8192]{3,2,1,0} broadcast(%constant_2063_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5624.4"}
  ROOT %multiply.2692.1 = f32[1,1,4,8192]{3,2,1,0} multiply(%multiply.2691.3, %broadcast.5624.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2692.1"}
}

%fused_convert.15 (param_0.1924: f32[32768,8]) -> f32[32768,2] {
  %param_0.1924 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.1924"}
  %convert.3891.3 = bf16[32768,8]{1,0} convert(%param_0.1924), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.3891.3"}
  %slice.2377.3 = bf16[32768,2]{1,0} slice(%convert.3891.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2377.3"}
  ROOT %convert.3892.1 = f32[32768,2]{1,0} convert(%slice.2377.3), metadata={scheduling_name="convert.3892.1"}
}

%fused_convert.16 (param_0.1928: f32[32768,8]) -> f32[32768,2] {
  %param_0.1928 = f32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.1928"}
  %convert.3903.3 = bf16[32768,8]{1,0} convert(%param_0.1928), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="convert.3903.3"}
  %slice.2379.3 = bf16[32768,2]{1,0} slice(%convert.3903.3), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2379.3"}
  ROOT %convert.3904.1 = f32[32768,2]{1,0} convert(%slice.2379.3), metadata={scheduling_name="convert.3904.1"}
}

%region_6.604.clone.9 (Arg_0.178: f32[], Arg_1.178: f32[]) -> f32[] {
  %Arg_1.178 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.178"}
  %Arg_0.178 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.178"}
  ROOT %add.2979.0 = f32[] add(%Arg_0.178, %Arg_1.178), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2979.0"}
}

%fused_reduce.15 (param_0.1943: f32[128,6144]) -> bf16[6144] {
  %param_0.1943 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1943"}
  %constant_1658_36 = bf16[] constant(0)
  %convert.4980.20 = f32[] convert(%constant_1658_36), metadata={scheduling_name="convert.4980.20"}
  %reduce.425.3 = f32[6144]{0} reduce(%param_0.1943, %convert.4980.20), dimensions={0}, to_apply=%region_6.604.clone.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.425.3"}
  ROOT %convert.4159.1 = bf16[6144]{0} convert(%reduce.425.3), metadata={scheduling_name="convert.4159.1"}
}

%region_6.604.clone.7 (Arg_0.176: f32[], Arg_1.176: f32[]) -> f32[] {
  %Arg_1.176 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.176"}
  %Arg_0.176 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.176"}
  ROOT %add.2977.0 = f32[] add(%Arg_0.176, %Arg_1.176), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2977.0"}
}

%fused_reduce.16 (param_0.1946: f32[128,6144]) -> bf16[6144] {
  %param_0.1946 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1946"}
  %constant_1658_34 = bf16[] constant(0)
  %convert.4980.22 = f32[] convert(%constant_1658_34), metadata={scheduling_name="convert.4980.22"}
  %reduce.424.3 = f32[6144]{0} reduce(%param_0.1946, %convert.4980.22), dimensions={0}, to_apply=%region_6.604.clone.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.424.3"}
  ROOT %convert.4147.1 = bf16[6144]{0} convert(%reduce.424.3), metadata={scheduling_name="convert.4147.1"}
}

%region_6.604.clone.5 (Arg_0.174: f32[], Arg_1.174: f32[]) -> f32[] {
  %Arg_1.174 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.174"}
  %Arg_0.174 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.174"}
  ROOT %add.2975.0 = f32[] add(%Arg_0.174, %Arg_1.174), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2975.0"}
}

%fused_reduce.17 (param_0.1949: f32[128,6144]) -> bf16[6144] {
  %param_0.1949 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1949"}
  %constant_1658_32 = bf16[] constant(0)
  %convert.4980.24 = f32[] convert(%constant_1658_32), metadata={scheduling_name="convert.4980.24"}
  %reduce.423.3 = f32[6144]{0} reduce(%param_0.1949, %convert.4980.24), dimensions={0}, to_apply=%region_6.604.clone.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.423.3"}
  ROOT %convert.4109.1 = bf16[6144]{0} convert(%reduce.423.3), metadata={scheduling_name="convert.4109.1"}
}

%region_6.604.clone.3 (Arg_0.172: f32[], Arg_1.172: f32[]) -> f32[] {
  %Arg_1.172 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.172"}
  %Arg_0.172 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.172"}
  ROOT %add.2973.0 = f32[] add(%Arg_0.172, %Arg_1.172), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2973.0"}
}

%fused_reduce.18 (param_0.1952: f32[128,6144]) -> bf16[6144] {
  %param_0.1952 = f32[128,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.1952"}
  %constant_1658_30 = bf16[] constant(0)
  %convert.4980.26 = f32[] convert(%constant_1658_30), metadata={scheduling_name="convert.4980.26"}
  %reduce.420.3 = f32[6144]{0} reduce(%param_0.1952, %convert.4980.26), dimensions={0}, to_apply=%region_6.604.clone.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.420.3"}
  ROOT %convert.4051.1 = bf16[6144]{0} convert(%reduce.420.3), metadata={scheduling_name="convert.4051.1"}
}

%fused_power () -> f32[64] {
  %constant_2102_1 = f32[] constant(1e+06)
  %broadcast.5631.1 = f32[64]{0} broadcast(%constant_2102_1), dimensions={}, metadata={scheduling_name="broadcast.5631.1"}
  %iota.383.1 = s32[64]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/iota" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="iota.383.1"}
  %constant_1673_3 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %broadcast.5632.1 = s32[64]{0} broadcast(%constant_1673_3), dimensions={}, metadata={scheduling_name="broadcast.5632.1"}
  %multiply.2612.3 = s32[64]{0} multiply(%iota.383.1, %broadcast.5632.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2612.3"}
  %convert.3949.3 = f32[64]{0} convert(%multiply.2612.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="convert.3949.3"}
  %constant_2104_1 = f32[] constant(0.0078125)
  %broadcast.5633.1 = f32[64]{0} broadcast(%constant_2104_1), dimensions={}, metadata={scheduling_name="broadcast.5633.1"}
  %multiply.2613.1 = f32[64]{0} multiply(%convert.3949.3, %broadcast.5633.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2613.1"}
  ROOT %power.22.1 = f32[64]{0} power(%broadcast.5631.1, %multiply.2613.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 scheduling_name="power.22.1"}
}

%fused_multiply.5 () -> s32[65] {
  %iota.384.1 = s32[65]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="iota.384.1"}
  %constant_5296_1 = s32[] constant(8192), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %broadcast.5639.1 = s32[65]{0} broadcast(%constant_5296_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="broadcast.5639.1"}
  ROOT %multiply.2622.1 = s32[65]{0} multiply(%iota.384.1, %broadcast.5639.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="multiply.2622.1"}
}

%fused_reduce.19 (param_0.2403: s32[4], param_1.2585: s32[32], param_2.2001: u32[], param_3.1645: s32[9], param_4.1399: s32[]) -> pred[] {
  %constant_1668_1 = s32[] constant(0)
  %broadcast.5569.3 = s32[4]{0} broadcast(%constant_1668_1), dimensions={}, metadata={scheduling_name="broadcast.5569.3"}
  %constant_2166_3 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %constant_5148_3 = s32[1,1]{1,0} constant({ {0} })
  %param_3.1645 = s32[9]{0} parameter(3), metadata={scheduling_name="param_3.1645"}
  %constant_1660_41 = s32[] constant(8)
  %param_4.1399 = s32[] parameter(4), metadata={scheduling_name="param_4.1399"}
  %subtract.247.39 = s32[] subtract(%constant_1660_41, %param_4.1399), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.39"}
  %dynamic-slice.1484.20 = s32[1]{0} dynamic-slice(%param_3.1645, %subtract.247.39), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.20"}
  %param_1.2585 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1.2585"}
  %param_2.2001 = u32[] parameter(2), metadata={scheduling_name="param_2.2001"}
  %dynamic-slice.1485.15 = s32[1]{0} dynamic-slice(%param_1.2585, %param_2.2001), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.15"}
  %subtract.248.10 = s32[1]{0} subtract(%dynamic-slice.1484.20, %dynamic-slice.1485.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.10"}
  %maximum.47.10 = s32[1]{0} maximum(%subtract.248.10, %constant_2166_3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.10"}
  %sign.27.9 = s32[1]{0} sign(%maximum.47.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.9"}
  %constant_5144_8 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.9 = pred[1]{0} compare(%sign.27.9, %constant_5144_8), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.9"}
  %constant_5145_6 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.10 = s32[1]{0} and(%maximum.47.10, %constant_5145_6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.10"}
  %compare.1615.10 = pred[1]{0} compare(%and.301.10, %constant_2166_3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.10"}
  %and.302.9 = pred[1]{0} and(%compare.1614.9, %compare.1615.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.9"}
  %constant_5146_5 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.9 = s32[1]{0} shift-right-logical(%maximum.47.10, %constant_5146_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.9"}
  %constant_5147_5 = s32[1]{0} constant({-1})
  %add.2981.9 = s32[1]{0} add(%shift-right-logical.20.9, %constant_5147_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.9"}
  %select.1269.9 = s32[1]{0} select(%and.302.9, %add.2981.9, %shift-right-logical.20.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.9"}
  %compare.1616.9 = pred[1]{0} compare(%select.1269.9, %constant_2166_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.9"}
  %add.2982.9 = s32[1]{0} add(%select.1269.9, %constant_5146_5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.9"}
  %select.1270.9 = s32[1]{0} select(%compare.1616.9, %add.2982.9, %select.1269.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.9"}
  %bitcast.21242.27 = s32[1,1]{1,0} bitcast(%select.1270.9), metadata={scheduling_name="bitcast.21242.27"}
  %concatenate.699.19 = s32[1,4]{1,0} concatenate(%constant_5148_3, %bitcast.21242.27, %constant_5148_3, %constant_5148_3), dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="concatenate.699.19"}
  %bitcast.21245.16 = s32[4]{0} bitcast(%concatenate.699.19), metadata={scheduling_name="bitcast.21245.16"}
  %slice.2374.3 = s32[3]{0} slice(%bitcast.21245.16), slice={[1:4]}, metadata={scheduling_name="slice.2374.3"}
  %concatenate.700.1 = s32[4]{0} concatenate(%constant_2166_3, %slice.2374.3), dimensions={0}, metadata={scheduling_name="concatenate.700.1"}
  %compare.1617.3 = pred[4]{0} compare(%broadcast.5569.3, %concatenate.700.1), direction=LE, metadata={scheduling_name="compare.1617.3"}
  %param_0.2403 = s32[4]{0} parameter(0), metadata={scheduling_name="param_0.2403"}
  %compare.1618.3 = pred[4]{0} compare(%param_0.2403, %concatenate.700.1), direction=GE, metadata={scheduling_name="compare.1618.3"}
  %and.303.3 = pred[4]{0} and(%compare.1617.3, %compare.1618.3), metadata={scheduling_name="and.303.3"}
  %constant_1759_1 = pred[] constant(true)
  ROOT %reduce.298.1 = pred[] reduce(%and.303.3, %constant_1759_1), dimensions={0}, to_apply=%region_51.2293, metadata={scheduling_name="reduce.298.1"}
}

%fused_compare.9 (param_0.2413: s32[32], param_1.2562: u32[]) -> pred[1] {
  %param_0.2413 = s32[32]{0} parameter(0), metadata={scheduling_name="param_0.2413"}
  %param_1.2562 = u32[] parameter(1), metadata={scheduling_name="param_1.2562"}
  %dynamic-slice.1485.3 = s32[1]{0} dynamic-slice(%param_0.2413, %param_1.2562), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.3"}
  %constant_5144_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  ROOT %compare.1623.1 = pred[1]{0} compare(%dynamic-slice.1485.3, %constant_5144_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="compare.1623.1"}
}

%fused_compare.10 (param_0.2412: s32[32], param_1.2557: u32[]) -> pred[1] {
  %param_0.2412 = s32[32]{0} parameter(0), metadata={scheduling_name="param_0.2412"}
  %param_1.2557 = u32[] parameter(1), metadata={scheduling_name="param_1.2557"}
  %dynamic-slice.1485.4 = s32[1]{0} dynamic-slice(%param_0.2412, %param_1.2557), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.4"}
  %constant_2166_9 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  ROOT %compare.1654.1 = pred[1]{0} compare(%dynamic-slice.1485.4, %constant_2166_9), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="compare.1654.1"}
}

%fused_dynamic_slice.22 (param_0.2222: u32[9,2,4], param_1.2517: s32[]) -> u32[1,2,4] {
  %param_0.2222 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2222"}
  %constant_1660_8 = s32[] constant(8)
  %param_1.2517 = s32[] parameter(1), metadata={scheduling_name="param_1.2517"}
  %subtract.247.1 = s32[] subtract(%constant_1660_8, %param_1.2517), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.1"}
  %constant_1668_108 = s32[] constant(0)
  ROOT %dynamic-slice.1509.1 = u32[1,2,4]{2,1,0} dynamic-slice(%param_0.2222, %subtract.247.1, %constant_1668_108, %constant_1668_108), dynamic_slice_sizes={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1509.1"}
}

%fused_dynamic_slice.23 (param_0.2224: u32[9,2,4], param_1.2458: s32[]) -> u32[1,2,4] {
  %param_0.2224 = u32[9,2,4]{2,1,0} parameter(0), metadata={scheduling_name="param_0.2224"}
  %constant_1660_10 = s32[] constant(8)
  %param_1.2458 = s32[] parameter(1), metadata={scheduling_name="param_1.2458"}
  %subtract.247.3 = s32[] subtract(%constant_1660_10, %param_1.2458), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.3"}
  %constant_1668_42 = s32[] constant(0)
  ROOT %dynamic-slice.1523.1 = u32[1,2,4]{2,1,0} dynamic-slice(%param_0.2224, %subtract.247.3, %constant_1668_42, %constant_1668_42), dynamic_slice_sizes={1,2,4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1523.1"}
}

%fused_dynamic_slice.24 (param_0.2226: bf16[9,1,4,8192,48,128], param_1.2487: s32[]) -> bf16[1,1,4,8192,48,128] {
  %param_0.2226 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2226"}
  %constant_1660_13 = s32[] constant(8)
  %param_1.2487 = s32[] parameter(1), metadata={scheduling_name="param_1.2487"}
  %subtract.247.6 = s32[] subtract(%constant_1660_13, %param_1.2487), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.6"}
  %constant_1668_74 = s32[] constant(0)
  ROOT %dynamic-slice.1487.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-slice(%param_0.2226, %subtract.247.6, %constant_1668_74, %constant_1668_74, %constant_1668_74, /*index=5*/%constant_1668_74, %constant_1668_74), dynamic_slice_sizes={1,1,4,8192,48,128}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1487.1"}
}

%fused_convert_dynamic_slice (param_0.2227: bf16[9,1,4,8192,6144], param_1.2498: s32[], param_2.4721: bf16[2,1,6144], param_3.3924: s32[32], param_4.2867: u32[], param_5.2644: s32[9], param_6.2398: f32[1,1,4,8192], param_7.2223: bf16[1,4,8192,6144], param_8.2056: bf16[1,2,4,8192,6144], param_9.1773: pred[1], param_10.1379: bf16[1,4,8192,6144]) -> (bf16[1,1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144]) {
  %param_0.2227 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2227"}
  %constant_1660_14 = s32[] constant(8)
  %param_1.2498 = s32[] parameter(1), metadata={scheduling_name="param_1.2498"}
  %subtract.247.7 = s32[] subtract(%constant_1660_14, %param_1.2498), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.7"}
  %constant_1668_88 = s32[] constant(0)
  %dynamic-slice.1497.7 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_0.2227, %subtract.247.7, %constant_1668_88, %constant_1668_88, %constant_1668_88, /*index=5*/%constant_1668_88), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1497.7"}
  %bitcast.22267.15.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1497.7), metadata={scheduling_name="bitcast.22267.15.clone.1"}
  %convert.3944.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22267.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3944.15.clone.1"}
  %param_6.2398 = f32[1,1,4,8192]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2398"}
  %bitcast.22292.13.clone.1 = f32[4,8192]{1,0} bitcast(%param_6.2398), metadata={scheduling_name="bitcast.22292.13.clone.1"}
  %broadcast.5628.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22292.13.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5628.13.clone.1"}
  %multiply.2610.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.15.clone.1, %broadcast.5628.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2610.7.clone.1"}
  %param_2.4721 = bf16[2,1,6144]{2,1,0} parameter(2), metadata={scheduling_name="param_2.4721"}
  %param_5.2644 = s32[9]{0} parameter(5), metadata={scheduling_name="param_5.2644"}
  %dynamic-slice.1484.176.clone.1 = s32[1]{0} dynamic-slice(%param_5.2644, %subtract.247.7), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.176.clone.1"}
  %param_3.3924 = s32[32]{0} parameter(3), metadata={scheduling_name="param_3.3924"}
  %param_4.2867 = u32[] parameter(4), metadata={scheduling_name="param_4.2867"}
  %dynamic-slice.1485.171.clone.1 = s32[1]{0} dynamic-slice(%param_3.3924, %param_4.2867), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.171.clone.1"}
  %subtract.248.166.clone.1 = s32[1]{0} subtract(%dynamic-slice.1484.176.clone.1, %dynamic-slice.1485.171.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.166.clone.1"}
  %constant_2166_84_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.166.clone.1 = s32[1]{0} maximum(%subtract.248.166.clone.1, %constant_2166_84_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.166.clone.1"}
  %sign.27.161.clone.1 = s32[1]{0} sign(%maximum.47.166.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.161.clone.1"}
  %constant_5144_78_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.161.clone.1 = pred[1]{0} compare(%sign.27.161.clone.1, %constant_5144_78_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.161.clone.1"}
  %constant_5145_77_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.166.clone.1 = s32[1]{0} and(%maximum.47.166.clone.1, %constant_5145_77_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.166.clone.1"}
  %compare.1615.166.clone.1 = pred[1]{0} compare(%and.301.166.clone.1, %constant_2166_84_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.166.clone.1"}
  %and.302.161.clone.1 = pred[1]{0} and(%compare.1614.161.clone.1, %compare.1615.166.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.161.clone.1"}
  %constant_5146_75_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.161.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.166.clone.1, %constant_5146_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.161.clone.1"}
  %constant_5147_75_clone_1 = s32[1]{0} constant({-1})
  %add.2981.161.clone.1 = s32[1]{0} add(%shift-right-logical.20.161.clone.1, %constant_5147_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.161.clone.1"}
  %select.1269.161.clone.1 = s32[1]{0} select(%and.302.161.clone.1, %add.2981.161.clone.1, %shift-right-logical.20.161.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.161.clone.1"}
  %compare.1616.161.clone.1 = pred[1]{0} compare(%select.1269.161.clone.1, %constant_2166_84_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.161.clone.1"}
  %add.2982.161.clone.1 = s32[1]{0} add(%select.1269.161.clone.1, %constant_5146_75_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.161.clone.1"}
  %select.1270.161.clone.1 = s32[1]{0} select(%compare.1616.161.clone.1, %add.2982.161.clone.1, %select.1269.161.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.161.clone.1"}
  %bitcast.21242.175.clone.1 = s32[1,1]{1,0} bitcast(%select.1270.161.clone.1), metadata={scheduling_name="bitcast.21242.175.clone.1"}
  %pad.345.67.clone.1 = s32[1,2]{1,0} pad(%bitcast.21242.175.clone.1, %constant_1668_88), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.67.clone.1"}
  %pad.346.65.clone.1 = s32[1,3]{1,0} pad(%pad.345.67.clone.1, %constant_1668_88), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.65.clone.1"}
  %bitcast.21349.62.clone.1 = s32[3]{0} bitcast(%pad.346.65.clone.1), metadata={scheduling_name="bitcast.21349.62.clone.1"}
  %slice.2376.57.clone.1 = s32[1]{0} slice(%bitcast.21349.62.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.57.clone.1"}
  %bitcast.24050.44.clone.1 = s32[] bitcast(%slice.2376.57.clone.1), metadata={scheduling_name="bitcast.24050.44.clone.1"}
  %dynamic-slice.1503.9.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_2.4721, %bitcast.24050.44.clone.1, %constant_1668_88, %constant_1668_88), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1503.9.clone.1"}
  %bitcast.22303.8.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1503.9.clone.1), metadata={scheduling_name="bitcast.22303.8.clone.1"}
  %convert.4984.5.clone.1 = f32[6144]{0} convert(%bitcast.22303.8.clone.1), metadata={scheduling_name="convert.4984.5.clone.1"}
  %broadcast.6039.10.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4984.5.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6039.10.clone.1"}
  %multiply.2611.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2610.7.clone.1, %broadcast.6039.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2611.3.clone.1"}
  %convert.3946.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2611.3.clone.1), metadata={scheduling_name="convert.3946.1.clone.1"}
  %param_10.1379 = bf16[1,4,8192,6144]{3,2,1,0} parameter(10), metadata={scheduling_name="param_10.1379"}
  %convert.3896.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_10.1379), metadata={scheduling_name="convert.3896.3.clone.1"}
  %param_9.1773 = pred[1]{0} parameter(9), metadata={scheduling_name="param_9.1773"}
  %bitcast.21530.9.clone.1 = pred[] bitcast(%param_9.1773), metadata={scheduling_name="bitcast.21530.9.clone.1"}
  %broadcast.5589.9.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%bitcast.21530.9.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5589.9.clone.1"}
  %param_8.2056 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2056"}
  %bitcast.21539.39.clone.1 = s32[] bitcast(%dynamic-slice.1484.176.clone.1), metadata={scheduling_name="bitcast.21539.39.clone.1"}
  %compare.1624.3.clone.1 = pred[] compare(%bitcast.21539.39.clone.1, %constant_1668_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.3.clone.1"}
  %negate.212.9.clone.1 = s32[] negate(%bitcast.21539.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.9.clone.1"}
  %select.1272.7.clone.1 = s32[] select(%compare.1624.3.clone.1, %negate.212.9.clone.1, %bitcast.21539.39.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.7.clone.1"}
  %constant_1654_3_clone_1 = s32[] constant(1)
  %and.305.1.clone.1 = s32[] and(%select.1272.7.clone.1, %constant_1654_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.1.clone.1"}
  %negate.213.1.clone.1 = s32[] negate(%and.305.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.1.clone.1"}
  %select.1273.6.clone.1 = s32[] select(%compare.1624.3.clone.1, %negate.213.1.clone.1, %and.305.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1273.6.clone.1"}
  %compare.1625.4.clone.1 = pred[] compare(%select.1273.6.clone.1, %constant_1668_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.4.clone.1"}
  %compare.1626.4.clone.1 = pred[] compare(%select.1273.6.clone.1, %constant_1668_88), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.4.clone.1"}
  %and.306.3.clone.1 = pred[] and(%compare.1625.4.clone.1, %compare.1626.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.3.clone.1"}
  %constant_1673_2_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2991.3.clone.1 = s32[] add(%select.1273.6.clone.1, %constant_1673_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2991.3.clone.1"}
  %select.1274.2.clone.1 = s32[] select(%and.306.3.clone.1, %add.2991.3.clone.1, %select.1273.6.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1274.2.clone.1"}
  %compare.1627.5.clone.1 = pred[] compare(%select.1274.2.clone.1, %constant_1668_88), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.5.clone.1"}
  %add.2992.5.clone.1 = s32[] add(%select.1274.2.clone.1, %constant_1673_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2992.5.clone.1"}
  %select.1275.4.clone.1 = s32[] select(%compare.1627.5.clone.1, %add.2992.5.clone.1, %select.1274.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1275.4.clone.1"}
  %dynamic-slice.1494.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_8.2056, %constant_1668_88, %select.1275.4.clone.1, %constant_1668_88, %constant_1668_88, /*index=5*/%constant_1668_88), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1494.6.clone.1"}
  %constant_1658_20_clone_1 = bf16[] constant(0)
  %broadcast.5590.8.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1658_20_clone_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5590.8.clone.1"}
  %select.1276.5.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5589.9.clone.1, %dynamic-slice.1494.6.clone.1, %broadcast.5590.8.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1276.5.clone.1"}
  %bitcast.21579.7.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1276.5.clone.1), metadata={scheduling_name="bitcast.21579.7.clone.1"}
  %convert.3897.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21579.7.clone.1), metadata={scheduling_name="convert.3897.7.clone.1"}
  %add.2993.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.3896.3.clone.1, %convert.3897.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="add.2993.5.clone.1"}
  %param_7.2223 = bf16[1,4,8192,6144]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2223"}
  %convert.3898.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_7.2223), metadata={scheduling_name="convert.3898.3.clone.1"}
  %add.2994.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2993.5.clone.1, %convert.3898.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="add.2994.3.clone.1"}
  %convert.3921.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.2994.3.clone.1), metadata={scheduling_name="convert.3921.1.clone.1"}
  ROOT %tuple.507 = (bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%dynamic-slice.1497.7, %convert.3946.1.clone.1, %convert.3921.1.clone.1), metadata={scheduling_name="tuple.507"}
}

%fused_dynamic_slice.25 (param_0.2228: bf16[9,1,4,8192,48,128], param_1.2499: s32[]) -> bf16[1,1,4,8192,48,128] {
  %param_0.2228 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.2228"}
  %constant_1660_15 = s32[] constant(8)
  %param_1.2499 = s32[] parameter(1), metadata={scheduling_name="param_1.2499"}
  %subtract.247.8 = s32[] subtract(%constant_1660_15, %param_1.2499), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.8"}
  %constant_1668_89 = s32[] constant(0)
  ROOT %dynamic-slice.1495.1 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} dynamic-slice(%param_0.2228, %subtract.247.8, %constant_1668_89, %constant_1668_89, %constant_1668_89, /*index=5*/%constant_1668_89, %constant_1668_89), dynamic_slice_sizes={1,1,4,8192,48,128}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1495.1"}
}

%fused_add.1 (param_0.2362: s32[]) -> s32[] {
  %param_0.2362 = s32[] parameter(0), metadata={scheduling_name="param_0.2362"}
  %constant_1654_2 = s32[] constant(1)
  ROOT %add.2980.1 = s32[] add(%param_0.2362, %constant_1654_2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="add.2980.1"}
}

%fused_broadcast.3 () -> bf16[1,4,8192,8] {
  %constant_1658_2 = bf16[] constant(0)
  ROOT %broadcast.5575.1 = bf16[1,4,8192,8]{3,2,1,0} broadcast(%constant_1658_2), dimensions={}, metadata={scheduling_name="broadcast.5575.1"}
}

%fused_broadcast.4 () -> u32[1,4,8192,8] {
  %constant_1730_1 = u32[] constant(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375}
  ROOT %broadcast.5582.1 = u32[1,4,8192,8]{3,2,1,0} broadcast(%constant_1730_1), dimensions={}, metadata={scheduling_name="broadcast.5582.1"}
}

%region_6.604.clone.2 (Arg_0.171: f32[], Arg_1.171: f32[]) -> f32[] {
  %Arg_1.171 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.171"}
  %Arg_0.171 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.171"}
  ROOT %add.2972.0 = f32[] add(%Arg_0.171, %Arg_1.171), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2972.0"}
}

%region_6.604.clone.8 (Arg_0.177: f32[], Arg_1.177: f32[]) -> f32[] {
  %Arg_1.177 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.177"}
  %Arg_0.177 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.177"}
  ROOT %add.2978.0 = f32[] add(%Arg_0.177, %Arg_1.177), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2978.0"}
}

%fused_add_convert_reduce (param_0.6067: f32[1,1,4,8192], param_1.6460: bf16[32768,6144], param_2.4652: f32[1,1,4,8192], param_3.3837: bf16[2,1,6144], param_4.2812: bf16[4,8192,6144], param_5.2585: f32[1,4,8192,6144], param_6.2336: f32[1,1,4,8192], param_7.2160: bf16[9,1,4,8192,6144], param_8.2005: f32[1,1,4,8192], param_9.1724: bf16[2,1,6144], param_10.1342: s32[32], param_11.1252: u32[], param_12.1017: s32[9], param_13.748: s32[], param_14.534: bf16[32768,6144]) -> (bf16[1,4,8192,6144], f32[1,4,8192,6144], f32[128,6144], f32[128,6144]) {
  %param_5.2585 = f32[1,4,8192,6144]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2585"}
  %param_14.534 = bf16[32768,6144]{1,0} parameter(14), metadata={scheduling_name="param_14.534"}
  %bitcast.22633.21.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_14.534), metadata={scheduling_name="bitcast.22633.21.clone.1"}
  %convert.3995.21.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22633.21.clone.1), metadata={scheduling_name="convert.3995.21.clone.1"}
  %param_9.1724 = bf16[2,1,6144]{2,1,0} parameter(9), metadata={scheduling_name="param_9.1724"}
  %param_12.1017 = s32[9]{0} parameter(12), metadata={scheduling_name="param_12.1017"}
  %constant_1660_22_clone_1 = s32[] constant(8)
  %param_13.748 = s32[] parameter(13), metadata={scheduling_name="param_13.748"}
  %subtract.247.189.clone.1 = s32[] subtract(%constant_1660_22_clone_1, %param_13.748), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.189.clone.1"}
  %dynamic-slice.1484.170.clone.1 = s32[1]{0} dynamic-slice(%param_12.1017, %subtract.247.189.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.170.clone.1"}
  %param_10.1342 = s32[32]{0} parameter(10), metadata={scheduling_name="param_10.1342"}
  %param_11.1252 = u32[] parameter(11), metadata={scheduling_name="param_11.1252"}
  %dynamic-slice.1485.165.clone.1 = s32[1]{0} dynamic-slice(%param_10.1342, %param_11.1252), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.165.clone.1"}
  %subtract.248.160.clone.1 = s32[1]{0} subtract(%dynamic-slice.1484.170.clone.1, %dynamic-slice.1485.165.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.160.clone.1"}
  %constant_2166_81_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.160.clone.1 = s32[1]{0} maximum(%subtract.248.160.clone.1, %constant_2166_81_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.160.clone.1"}
  %sign.27.155.clone.1 = s32[1]{0} sign(%maximum.47.160.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.155.clone.1"}
  %constant_5144_75_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.155.clone.1 = pred[1]{0} compare(%sign.27.155.clone.1, %constant_5144_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.155.clone.1"}
  %constant_5145_74_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.160.clone.1 = s32[1]{0} and(%maximum.47.160.clone.1, %constant_5145_74_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.160.clone.1"}
  %compare.1615.160.clone.1 = pred[1]{0} compare(%and.301.160.clone.1, %constant_2166_81_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.160.clone.1"}
  %and.302.155.clone.1 = pred[1]{0} and(%compare.1614.155.clone.1, %compare.1615.160.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.155.clone.1"}
  %constant_5146_72_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.155.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.160.clone.1, %constant_5146_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.155.clone.1"}
  %constant_5147_72_clone_1 = s32[1]{0} constant({-1})
  %add.2981.155.clone.1 = s32[1]{0} add(%shift-right-logical.20.155.clone.1, %constant_5147_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.155.clone.1"}
  %select.1269.155.clone.1 = s32[1]{0} select(%and.302.155.clone.1, %add.2981.155.clone.1, %shift-right-logical.20.155.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.155.clone.1"}
  %compare.1616.155.clone.1 = pred[1]{0} compare(%select.1269.155.clone.1, %constant_2166_81_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.155.clone.1"}
  %add.2982.155.clone.1 = s32[1]{0} add(%select.1269.155.clone.1, %constant_5146_72_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.155.clone.1"}
  %select.1270.155.clone.1 = s32[1]{0} select(%compare.1616.155.clone.1, %add.2982.155.clone.1, %select.1269.155.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.155.clone.1"}
  %bitcast.21242.169.clone.1 = s32[1,1]{1,0} bitcast(%select.1270.155.clone.1), metadata={scheduling_name="bitcast.21242.169.clone.1"}
  %constant_1668_16_clone_1 = s32[] constant(0)
  %pad.345.61.clone.1 = s32[1,2]{1,0} pad(%bitcast.21242.169.clone.1, %constant_1668_16_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.61.clone.1"}
  %pad.346.59.clone.1 = s32[1,3]{1,0} pad(%pad.345.61.clone.1, %constant_1668_16_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.59.clone.1"}
  %bitcast.21349.56.clone.1 = s32[3]{0} bitcast(%pad.346.59.clone.1), metadata={scheduling_name="bitcast.21349.56.clone.1"}
  %slice.2376.51.clone.1 = s32[1]{0} slice(%bitcast.21349.56.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.51.clone.1"}
  %bitcast.24050.38.clone.1 = s32[] bitcast(%slice.2376.51.clone.1), metadata={scheduling_name="bitcast.24050.38.clone.1"}
  %dynamic-slice.1503.3.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_9.1724, %bitcast.24050.38.clone.1, %constant_1668_16_clone_1, %constant_1668_16_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1503.3.clone.1"}
  %bitcast.22303.12.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1503.3.clone.1), metadata={scheduling_name="bitcast.22303.12.clone.1"}
  %convert.4984.9.clone.1 = f32[6144]{0} convert(%bitcast.22303.12.clone.1), metadata={scheduling_name="convert.4984.9.clone.1"}
  %broadcast.6039.16.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4984.9.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6039.16.clone.1"}
  %multiply.2631.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3995.21.clone.1, %broadcast.6039.16.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2631.13.clone.1"}
  %param_8.2005 = f32[1,1,4,8192]{3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2005"}
  %bitcast.22292.21.clone.1 = f32[4,8192]{1,0} bitcast(%param_8.2005), metadata={scheduling_name="bitcast.22292.21.clone.1"}
  %broadcast.5628.21.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22292.21.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5628.21.clone.1"}
  %multiply.2632.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2631.13.clone.1, %broadcast.5628.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2632.7.clone.1"}
  %param_7.2160 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2160"}
  %dynamic-slice.1497.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_7.2160, %subtract.247.189.clone.1, %constant_1668_16_clone_1, %constant_1668_16_clone_1, %constant_1668_16_clone_1, /*index=5*/%constant_1668_16_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1497.6.clone.1"}
  %bitcast.22267.27.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1497.6.clone.1), metadata={scheduling_name="bitcast.22267.27.clone.1"}
  %convert.3944.27.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22267.27.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3944.27.clone.1"}
  %param_6.2336 = f32[1,1,4,8192]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2336"}
  %bitcast.22670.5.clone.1 = f32[4,8192]{1,0} bitcast(%param_6.2336), metadata={scheduling_name="bitcast.22670.5.clone.1"}
  %broadcast.5642.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22670.5.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5642.5.clone.1"}
  %multiply.2637.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.27.clone.1, %broadcast.5642.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2637.5.clone.1"}
  %add.3017.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2632.7.clone.1, %multiply.2637.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3017.5.clone.1"}
  %add.3019.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%param_5.2585, %add.3017.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.3019.3.clone.1"}
  %param_4.2812 = bf16[4,8192,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2812"}
  %bitcast.23281.13.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_4.2812), metadata={scheduling_name="bitcast.23281.13.clone.1"}
  %convert.4046.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23281.13.clone.1), metadata={scheduling_name="convert.4046.13.clone.1"}
  %param_3.3837 = bf16[2,1,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.3837"}
  %dynamic-slice.1490.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_3.3837, %bitcast.24050.38.clone.1, %constant_1668_16_clone_1, %constant_1668_16_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1490.7.clone.1"}
  %bitcast.21355.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1490.7.clone.1), metadata={scheduling_name="bitcast.21355.6.clone.1"}
  %convert.4977.3.clone.1 = f32[6144]{0} convert(%bitcast.21355.6.clone.1), metadata={scheduling_name="convert.4977.3.clone.1"}
  %broadcast.6028.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4977.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6028.12.clone.1"}
  %multiply.2669.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4046.13.clone.1, %broadcast.6028.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2669.9.clone.1"}
  %param_2.4652 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4652"}
  %bitcast.21337.15.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4652), metadata={scheduling_name="bitcast.21337.15.clone.1"}
  %broadcast.5573.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21337.15.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5573.15.clone.1"}
  %multiply.2670.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2669.9.clone.1, %broadcast.5573.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2670.5.clone.1"}
  %param_1.6460 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.6460"}
  %bitcast.21315.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.6460), metadata={scheduling_name="bitcast.21315.19.clone.1"}
  %convert.3887.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21315.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3887.19.clone.1"}
  %param_0.6067 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6067"}
  %bitcast.23564.3.clone.1 = f32[4,8192]{1,0} bitcast(%param_0.6067), metadata={scheduling_name="bitcast.23564.3.clone.1"}
  %broadcast.5680.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23564.3.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5680.3.clone.1"}
  %multiply.2675.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3887.19.clone.1, %broadcast.5680.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2675.3.clone.1"}
  %add.3034.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2670.5.clone.1, %multiply.2675.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3034.3.clone.1"}
  %add.3035.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.3019.3.clone.1, %add.3034.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.3035.1.clone.1"}
  %convert.4080.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.3035.1.clone.1), metadata={scheduling_name="convert.4080.1"}
  %multiply.2572.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3887.19.clone.1, %broadcast.5573.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2572.11.clone.1"}
  %multiply.2656.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2572.11.clone.1, %convert.4046.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2656.5.clone.1"}
  %convert.4047.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2656.5.clone.1), metadata={scheduling_name="convert.4047.3.clone.1"}
  %bitcast.23290.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4047.3.clone.1), metadata={scheduling_name="bitcast.23290.3.clone.1"}
  %convert.4048.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.23290.3.clone.1), metadata={scheduling_name="convert.4048.3.clone.1"}
  %constant_1658_29_clone_1 = bf16[] constant(0)
  %convert.4980.4.clone.1 = f32[] convert(%constant_1658_29_clone_1), metadata={scheduling_name="convert.4980.4.clone.1"}
  %reduce.585.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4048.3.clone.1, %convert.4980.4.clone.1), dimensions={1}, to_apply=%region_6.604.clone.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.585.1.clone.1"}
  %multiply.2610.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3944.27.clone.1, %broadcast.5628.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2610.11.clone.1"}
  %multiply.2686.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2610.11.clone.1, %convert.3995.21.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2686.5.clone.1"}
  %convert.4154.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2686.5.clone.1), metadata={scheduling_name="convert.4154.3.clone.1"}
  %bitcast.24068.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4154.3.clone.1), metadata={scheduling_name="bitcast.24068.3.clone.1"}
  %convert.4155.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.24068.3.clone.1), metadata={scheduling_name="convert.4155.3.clone.1"}
  %reduce.591.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4155.3.clone.1, %convert.4980.4.clone.1), dimensions={1}, to_apply=%region_6.604.clone.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.591.1.clone.1"}
  ROOT %tuple.484 = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, f32[128,6144]{1,0}) tuple(%convert.4080.1, %add.3035.1.clone.1, %reduce.585.1.clone.1, %reduce.591.1.clone.1), metadata={scheduling_name="tuple.484"}
}

%region_6.604.clone.6 (Arg_0.175: f32[], Arg_1.175: f32[]) -> f32[] {
  %Arg_1.175 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.175"}
  %Arg_0.175 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.175"}
  ROOT %add.2976.0 = f32[] add(%Arg_0.175, %Arg_1.175), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.2976.0"}
}

%fused_add_convert_dynamic_slice_reduce_select (param_0.6071: f32[1,1,4,8192], param_1.6465: bf16[32768,6144], param_2.4682: f32[1,1,4,8192], param_3.3875: bf16[2,1,6144], param_4.2834: s32[32], param_5.2605: u32[], param_6.2362: bf16[4,8192,6144], param_7.2191: bf16[1,4,8192,6144], param_8.2026: bf16[1,2,4,8192,6144], param_9.1743: s32[9], param_10.1357: s32[], param_11.1262: pred[1], param_12.1024: bf16[1,4,8192,6144], param_13.773: bf16[2,1,6144], param_14.562: f32[1,1,4,8192], param_15.334: bf16[9,1,4,8192,6144], param_16.158: bf16[1,4,4,8192,6144]) -> (bf16[1,4,8192,6144], f32[1,4,8192,6144], f32[128,6144], bf16[1,1,4,8192,6144], bf16[1,4,8192,6144], /*index=5*/bf16[1,1,4,8192,6144], bf16[1,1,4,8192,6144]) {
  %param_12.1024 = bf16[1,4,8192,6144]{3,2,1,0} parameter(12), metadata={scheduling_name="param_12.1024"}
  %convert.3896.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_12.1024), metadata={scheduling_name="convert.3896.5.clone.1"}
  %param_11.1262 = pred[1]{0} parameter(11), metadata={scheduling_name="param_11.1262"}
  %bitcast.21530.7.clone.1 = pred[] bitcast(%param_11.1262), metadata={scheduling_name="bitcast.21530.7.clone.1"}
  %broadcast.5589.7.clone.1 = pred[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%bitcast.21530.7.clone.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5589.7.clone.1"}
  %param_8.2026 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(8), metadata={scheduling_name="param_8.2026"}
  %constant_1668_75_clone_1 = s32[] constant(0)
  %param_9.1743 = s32[9]{0} parameter(9), metadata={scheduling_name="param_9.1743"}
  %constant_1660_32_clone_1 = s32[] constant(8)
  %param_10.1357 = s32[] parameter(10), metadata={scheduling_name="param_10.1357"}
  %subtract.247.25.clone.1 = s32[] subtract(%constant_1660_32_clone_1, %param_10.1357), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="subtract.247.25.clone.1"}
  %dynamic-slice.1484.5.clone.1 = s32[1]{0} dynamic-slice(%param_9.1743, %subtract.247.25.clone.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1484.5.clone.1"}
  %bitcast.21539.47.clone.1 = s32[] bitcast(%dynamic-slice.1484.5.clone.1), metadata={scheduling_name="bitcast.21539.47.clone.1"}
  %compare.1624.11.clone.1 = pred[] compare(%bitcast.21539.47.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1624.11.clone.1"}
  %negate.212.15.clone.1 = s32[] negate(%bitcast.21539.47.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.212.15.clone.1"}
  %select.1272.13.clone.1 = s32[] select(%compare.1624.11.clone.1, %negate.212.15.clone.1, %bitcast.21539.47.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1272.13.clone.1"}
  %constant_1654_6_clone_1 = s32[] constant(1)
  %and.305.4.clone.1 = s32[] and(%select.1272.13.clone.1, %constant_1654_6_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.305.4.clone.1"}
  %negate.213.3.clone.1 = s32[] negate(%and.305.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.213.3.clone.1"}
  %select.1273.2.clone.1 = s32[] select(%compare.1624.11.clone.1, %negate.213.3.clone.1, %and.305.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1273.2.clone.1"}
  %compare.1625.5.clone.1 = pred[] compare(%select.1273.2.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1625.5.clone.1"}
  %compare.1626.5.clone.1 = pred[] compare(%select.1273.2.clone.1, %constant_1668_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1626.5.clone.1"}
  %and.306.4.clone.1 = pred[] and(%compare.1625.5.clone.1, %compare.1626.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.306.4.clone.1"}
  %constant_1673_4_clone_1 = s32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %add.2991.4.clone.1 = s32[] add(%select.1273.2.clone.1, %constant_1673_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.2991.4.clone.1"}
  %select.1274.3.clone.1 = s32[] select(%and.306.4.clone.1, %add.2991.4.clone.1, %select.1273.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1274.3.clone.1"}
  %compare.1627.1.clone.1 = pred[] compare(%select.1274.3.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="compare.1627.1.clone.1"}
  %add.2992.1.clone.1 = s32[] add(%select.1274.3.clone.1, %constant_1673_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="add.2992.1.clone.1"}
  %select.1275.6.clone.1 = s32[] select(%compare.1627.1.clone.1, %add.2992.1.clone.1, %select.1274.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="select.1275.6.clone.1"}
  %dynamic-slice.1494.4.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_8.2026, %constant_1668_75_clone_1, %select.1275.6.clone.1, %constant_1668_75_clone_1, %constant_1668_75_clone_1, /*index=5*/%constant_1668_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="dynamic-slice.1494.4.clone.1"}
  %constant_1658_16_clone_1 = bf16[] constant(0)
  %broadcast.5590.6.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_1658_16_clone_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="broadcast.5590.6.clone.1"}
  %select.1276.3.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5589.7.clone.1, %dynamic-slice.1494.4.clone.1, %broadcast.5590.6.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1276.3.clone.1"}
  %bitcast.21579.9.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%select.1276.3.clone.1), metadata={scheduling_name="bitcast.21579.9.clone.1"}
  %convert.3897.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21579.9.clone.1), metadata={scheduling_name="convert.3897.9.clone.1"}
  %add.2993.7.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%convert.3896.5.clone.1, %convert.3897.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="add.2993.7.clone.1"}
  %param_7.2191 = bf16[1,4,8192,6144]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2191"}
  %convert.3898.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%param_7.2191), metadata={scheduling_name="convert.3898.5.clone.1"}
  %add.2994.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2993.7.clone.1, %convert.3898.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="add.2994.5.clone.1"}
  %param_6.2362 = bf16[4,8192,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2362"}
  %bitcast.22224.13.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_6.2362), metadata={scheduling_name="bitcast.22224.13.clone.1"}
  %convert.3942.13.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.22224.13.clone.1), metadata={scheduling_name="convert.3942.13.clone.1"}
  %param_3.3875 = bf16[2,1,6144]{2,1,0} parameter(3), metadata={scheduling_name="param_3.3875"}
  %param_4.2834 = s32[32]{0} parameter(4), metadata={scheduling_name="param_4.2834"}
  %param_5.2605 = u32[] parameter(5), metadata={scheduling_name="param_5.2605"}
  %dynamic-slice.1485.153.clone.1 = s32[1]{0} dynamic-slice(%param_4.2834, %param_5.2605), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.153.clone.1"}
  %subtract.248.148.clone.1 = s32[1]{0} subtract(%dynamic-slice.1484.5.clone.1, %dynamic-slice.1485.153.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="subtract.248.148.clone.1"}
  %constant_2166_78_clone_1 = s32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148}
  %maximum.47.148.clone.1 = s32[1]{0} maximum(%subtract.248.148.clone.1, %constant_2166_78_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/max" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="maximum.47.148.clone.1"}
  %sign.27.143.clone.1 = s32[1]{0} sign(%maximum.47.148.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sign" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="sign.27.143.clone.1"}
  %constant_5144_72_clone_1 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1614.143.clone.1 = pred[1]{0} compare(%sign.27.143.clone.1, %constant_5144_72_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1614.143.clone.1"}
  %constant_5145_71_clone_1 = s32[1]{0} constant({3}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.301.148.clone.1 = s32[1]{0} and(%maximum.47.148.clone.1, %constant_5145_71_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.301.148.clone.1"}
  %compare.1615.148.clone.1 = pred[1]{0} compare(%and.301.148.clone.1, %constant_2166_78_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="compare.1615.148.clone.1"}
  %and.302.143.clone.1 = pred[1]{0} and(%compare.1614.143.clone.1, %compare.1615.148.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="and.302.143.clone.1"}
  %constant_5146_69_clone_1 = s32[1]{0} constant({2}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %shift-right-logical.20.143.clone.1 = s32[1]{0} shift-right-logical(%maximum.47.148.clone.1, %constant_5146_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/div" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="shift-right-logical.20.143.clone.1"}
  %constant_5147_69_clone_1 = s32[1]{0} constant({-1})
  %add.2981.143.clone.1 = s32[1]{0} add(%shift-right-logical.20.143.clone.1, %constant_5147_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="add.2981.143.clone.1"}
  %select.1269.143.clone.1 = s32[1]{0} select(%and.302.143.clone.1, %add.2981.143.clone.1, %shift-right-logical.20.143.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220 scheduling_name="select.1269.143.clone.1"}
  %compare.1616.143.clone.1 = pred[1]{0} compare(%select.1269.143.clone.1, %constant_2166_78_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="compare.1616.143.clone.1"}
  %add.2982.143.clone.1 = s32[1]{0} add(%select.1269.143.clone.1, %constant_5146_69_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="add.2982.143.clone.1"}
  %select.1270.143.clone.1 = s32[1]{0} select(%compare.1616.143.clone.1, %add.2982.143.clone.1, %select.1269.143.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="select.1270.143.clone.1"}
  %bitcast.21242.157.clone.1 = s32[1,1]{1,0} bitcast(%select.1270.143.clone.1), metadata={scheduling_name="bitcast.21242.157.clone.1"}
  %pad.345.49.clone.1 = s32[1,2]{1,0} pad(%bitcast.21242.157.clone.1, %constant_1668_75_clone_1), padding=0_0x0_1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/concatenate" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.345.49.clone.1"}
  %pad.346.47.clone.1 = s32[1,3]{1,0} pad(%pad.345.49.clone.1, %constant_1668_75_clone_1), padding=0_0x1_0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=238 scheduling_name="pad.346.47.clone.1"}
  %bitcast.21349.44.clone.1 = s32[3]{0} bitcast(%pad.346.47.clone.1), metadata={scheduling_name="bitcast.21349.44.clone.1"}
  %slice.2376.39.clone.1 = s32[1]{0} slice(%bitcast.21349.44.clone.1), slice={[1:2]}, metadata={scheduling_name="slice.2376.39.clone.1"}
  %bitcast.24050.26.clone.1 = s32[] bitcast(%slice.2376.39.clone.1), metadata={scheduling_name="bitcast.24050.26.clone.1"}
  %dynamic-slice.1498.7.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_3.3875, %bitcast.24050.26.clone.1, %constant_1668_75_clone_1, %constant_1668_75_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1498.7.clone.1"}
  %bitcast.21666.6.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1498.7.clone.1), metadata={scheduling_name="bitcast.21666.6.clone.1"}
  %convert.4978.3.clone.1 = f32[6144]{0} convert(%bitcast.21666.6.clone.1), metadata={scheduling_name="convert.4978.3.clone.1"}
  %broadcast.6029.12.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4978.3.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6029.12.clone.1"}
  %multiply.2601.9.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3942.13.clone.1, %broadcast.6029.12.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2601.9.clone.1"}
  %param_2.4682 = f32[1,1,4,8192]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4682"}
  %bitcast.21655.15.clone.1 = f32[4,8192]{1,0} bitcast(%param_2.4682), metadata={scheduling_name="bitcast.21655.15.clone.1"}
  %broadcast.5594.15.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.21655.15.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5594.15.clone.1"}
  %multiply.2602.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2601.9.clone.1, %broadcast.5594.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2602.5.clone.1"}
  %param_1.6465 = bf16[32768,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.6465"}
  %bitcast.21630.19.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%param_1.6465), metadata={scheduling_name="bitcast.21630.19.clone.1"}
  %convert.3899.19.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.21630.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.3899.19.clone.1"}
  %param_0.6071 = f32[1,1,4,8192]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6071"}
  %bitcast.22259.3.clone.1 = f32[4,8192]{1,0} bitcast(%param_0.6071), metadata={scheduling_name="bitcast.22259.3.clone.1"}
  %broadcast.5625.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.22259.3.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5625.3.clone.1"}
  %multiply.2607.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3899.19.clone.1, %broadcast.5625.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2607.3.clone.1"}
  %add.3004.3.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%multiply.2602.5.clone.1, %multiply.2607.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3004.3.clone.1"}
  %add.3005.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} add(%add.2994.5.clone.1, %add.3004.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="add.3005.1.clone.1"}
  %convert.3971.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%add.3005.1.clone.1), metadata={scheduling_name="convert.3971.1"}
  %multiply.2581.11.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.3899.19.clone.1, %broadcast.5594.15.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2581.11.clone.1"}
  %multiply.2685.5.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2581.11.clone.1, %convert.3942.13.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2685.5.clone.1"}
  %convert.4142.3.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2685.5.clone.1), metadata={scheduling_name="convert.4142.3.clone.1"}
  %bitcast.24019.3.clone.1 = bf16[128,256,6144]{2,1,0} bitcast(%convert.4142.3.clone.1), metadata={scheduling_name="bitcast.24019.3.clone.1"}
  %convert.4144.3.clone.1 = f32[128,256,6144]{2,1,0} convert(%bitcast.24019.3.clone.1), metadata={scheduling_name="convert.4144.3.clone.1"}
  %convert.4980.8.clone.1 = f32[] convert(%constant_1658_16_clone_1), metadata={scheduling_name="convert.4980.8.clone.1"}
  %reduce.589.1.clone.1 = f32[128,6144]{1,0} reduce(%convert.4144.3.clone.1, %convert.4980.8.clone.1), dimensions={1}, to_apply=%region_6.604.clone.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.589.1.clone.1"}
  %select.1323.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} select(%broadcast.5589.7.clone.1, %broadcast.5590.6.clone.1, %dynamic-slice.1494.4.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="select.1323.1.clone.1"}
  %param_15.334 = bf16[9,1,4,8192,6144]{4,3,2,1,0} parameter(15), metadata={scheduling_name="param_15.334"}
  %dynamic-slice.1489.5.clone.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_15.334, %subtract.247.25.clone.1, %constant_1668_75_clone_1, %constant_1668_75_clone_1, %constant_1668_75_clone_1, /*index=5*/%constant_1668_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="dynamic-slice.1489.5.clone.1.clone.1"}
  %bitcast.23330.15.clone.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%dynamic-slice.1489.5.clone.1.clone.1), metadata={scheduling_name="bitcast.23330.15.clone.1.clone.1"}
  %convert.4055.15.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} convert(%bitcast.23330.15.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4055.15.clone.1.clone.1"}
  %param_14.562 = f32[1,1,4,8192]{3,2,1,0} parameter(14), metadata={scheduling_name="param_14.562"}
  %bitcast.23355.13.clone.1.clone.1 = f32[4,8192]{1,0} bitcast(%param_14.562), metadata={scheduling_name="bitcast.23355.13.clone.1.clone.1"}
  %broadcast.5676.13.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.23355.13.clone.1.clone.1), dimensions={1,2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5676.13.clone.1.clone.1"}
  %multiply.2659.7.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%convert.4055.15.clone.1.clone.1, %broadcast.5676.13.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2659.7.clone.1.clone.1"}
  %param_13.773 = bf16[2,1,6144]{2,1,0} parameter(13), metadata={scheduling_name="param_13.773"}
  %dynamic-slice.1518.9.clone.1.clone.1 = bf16[1,1,6144]{2,1,0} dynamic-slice(%param_13.773, %bitcast.24050.26.clone.1, %constant_1668_75_clone_1, %constant_1668_75_clone_1), dynamic_slice_sizes={1,1,6144}, metadata={scheduling_name="dynamic-slice.1518.9.clone.1.clone.1"}
  %bitcast.23368.8.clone.1.clone.1 = bf16[6144]{0} bitcast(%dynamic-slice.1518.9.clone.1.clone.1), metadata={scheduling_name="bitcast.23368.8.clone.1.clone.1"}
  %convert.4997.5.clone.1.clone.1 = f32[6144]{0} convert(%bitcast.23368.8.clone.1.clone.1), metadata={scheduling_name="convert.4997.5.clone.1.clone.1"}
  %broadcast.6053.10.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} broadcast(%convert.4997.5.clone.1.clone.1), dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6053.10.clone.1.clone.1"}
  %multiply.2660.3.clone.1.clone.1 = f32[1,4,8192,6144]{3,2,1,0} multiply(%multiply.2659.7.clone.1.clone.1, %broadcast.6053.10.clone.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2660.3.clone.1.clone.1"}
  %convert.4057.1.clone.1.clone.1 = bf16[1,4,8192,6144]{3,2,1,0} convert(%multiply.2660.3.clone.1.clone.1), metadata={scheduling_name="convert.4057.1.clone.1.clone.1"}
  %param_16.158 = bf16[1,4,4,8192,6144]{4,3,2,1,0} parameter(16), metadata={scheduling_name="param_16.158"}
  %constant_2851_1_clone_1 = s32[] constant(-2)
  %add.3056.5.clone.1 = s32[] add(%bitcast.21539.47.clone.1, %constant_2851_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/sub" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=328 scheduling_name="add.3056.5.clone.1"}
  %compare.1646.2.clone.1 = pred[] compare(%add.3056.5.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1646.2.clone.1"}
  %negate.222.1.clone.1 = s32[] negate(%add.3056.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.222.1.clone.1"}
  %select.1311.2.clone.1 = s32[] select(%compare.1646.2.clone.1, %negate.222.1.clone.1, %add.3056.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1311.2.clone.1"}
  %constant_1671_3_clone_1 = s32[] constant(3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %and.311.1.clone.1 = s32[] and(%select.1311.2.clone.1, %constant_1671_3_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.311.1.clone.1"}
  %negate.223.1.clone.1 = s32[] negate(%and.311.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="negate.223.1.clone.1"}
  %select.1312.2.clone.1 = s32[] select(%compare.1646.2.clone.1, %negate.223.1.clone.1, %and.311.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/rem" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1312.2.clone.1"}
  %compare.1647.1.clone.1 = pred[] compare(%select.1312.2.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1647.1.clone.1"}
  %compare.1648.1.clone.1 = pred[] compare(%select.1312.2.clone.1, %constant_1668_75_clone_1), direction=NE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="compare.1648.1.clone.1"}
  %and.312.2.clone.1 = pred[] and(%compare.1647.1.clone.1, %compare.1648.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/and" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="and.312.2.clone.1"}
  %constant_1721_1_clone_1 = s32[] constant(4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %add.3057.2.clone.1 = s32[] add(%select.1312.2.clone.1, %constant_1721_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="add.3057.2.clone.1"}
  %select.1313.1.clone.1 = s32[] select(%and.312.2.clone.1, %add.3057.2.clone.1, %select.1312.2.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(remainder)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=168 scheduling_name="select.1313.1.clone.1"}
  %compare.1649.2.clone.1 = pred[] compare(%select.1313.1.clone.1, %constant_1668_75_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="compare.1649.2.clone.1"}
  %add.3058.2.clone.1 = s32[] add(%select.1313.1.clone.1, %constant_1721_1_clone_1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="add.3058.2.clone.1"}
  %select.1314.1.clone.1 = s32[] select(%compare.1649.2.clone.1, %add.3058.2.clone.1, %select.1313.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="select.1314.1.clone.1"}
  %dynamic-slice.1539.1.clone.1 = bf16[1,1,4,8192,6144]{4,3,2,1,0} dynamic-slice(%param_16.158, %constant_1668_75_clone_1, %select.1314.1.clone.1, %constant_1668_75_clone_1, %constant_1668_75_clone_1, /*index=5*/%constant_1668_75_clone_1), dynamic_slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="dynamic-slice.1539.1.clone.1"}
  ROOT %tuple.505 = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, /*index=5*/bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) tuple(%convert.3971.1, %add.3005.1.clone.1, %reduce.589.1.clone.1, %select.1323.1.clone.1, %convert.4057.1.clone.1.clone.1, /*index=5*/%dynamic-slice.1489.5.clone.1.clone.1, %dynamic-slice.1539.1.clone.1), metadata={scheduling_name="tuple.505"}
}

%fused_compare.11 (param_0_0.1: s32[32], param_0_1: u32[]) -> (pred[1], pred[1]) {
  %param_0_0.1 = s32[32]{0} parameter(0), metadata={scheduling_name="param_0_0.1"}
  %param_0_1 = u32[] parameter(1), metadata={scheduling_name="param_0_1"}
  %dynamic-slice.1485.184 = s32[1]{0} dynamic-slice(%param_0_0.1, %param_0_1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218 scheduling_name="dynamic-slice.1485.184"}
  %constant_5144_79 = s32[1]{0} constant({1}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/jit(floor_divide)/ne" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=220}
  %compare.1655.2 = pred[1]{0} compare(%dynamic-slice.1485.184, %constant_5144_79), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="compare.1655.2"}
  %compare.1656.2 = pred[1]{0} compare(%dynamic-slice.1485.184, %constant_5144_79), direction=GE, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="compare.1656.2"}
  ROOT %tuple.649 = (pred[1]{0}, pred[1]{0}) tuple(%compare.1655.2, %compare.1656.2), metadata={scheduling_name="tuple.649"}
}

%async_computation.4 (param_0.6086: bf16[1,1,4,8,1,2048,6144]) -> bf16[1,1,4,8,1,2048,6144] {
  %param_0.6086 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6086"}
  ROOT %all-to-all.4.1 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6086), channel_id=221, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.4.1"}
}

%async_computation.5 (param_0.6087: bf16[1,1,4,6144,8,1,2048]) -> bf16[1,1,4,6144,8,1,2048] {
  %param_0.6087 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} parameter(0), metadata={scheduling_name="param_0.6087"}
  ROOT %all-to-all.5.1 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} all-to-all(%param_0.6087), channel_id=224, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.5.1"}
}

%async_computation.6 (param_0.6088: bf16[1,1,8,4,1,2048,6144]) -> bf16[1,1,8,4,1,2048,6144] {
  %param_0.6088 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6088"}
  ROOT %all-to-all.6.1 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} all-to-all(%param_0.6088), channel_id=229, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.6.1"}
}

%async_computation.7 (param_0.6089: bf16[1,1,1,8,4,2048,6144]) -> bf16[1,1,1,8,4,2048,6144] {
  %param_0.6089 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6089"}
  ROOT %all-to-all.7.1 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6089), channel_id=230, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.7.1"}
}

%async_computation.8 (param_0.6090: bf16[1,1,4,8,1,2048,6144]) -> bf16[1,1,4,8,1,2048,6144] {
  %param_0.6090 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6090"}
  ROOT %all-to-all.8.1 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6090), channel_id=264, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.8.1"}
}

%async_computation.9 (param_0.6091: bf16[1,1,1,8,4,2048,6144]) -> bf16[1,1,1,8,4,2048,6144] {
  %param_0.6091 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6091"}
  ROOT %all-to-all.9.1 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6091), channel_id=271, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.9.1"}
}

%async_computation.10 (param_0.6092: bf16[1,1,4,6144,8,1,2048]) -> bf16[1,1,4,6144,8,1,2048] {
  %param_0.6092 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} parameter(0), metadata={scheduling_name="param_0.6092"}
  ROOT %all-to-all.10.1 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} all-to-all(%param_0.6092), channel_id=287, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={4}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all.10.1"}
}

%async_computation.11 (param_0.6093: bf16[1,1,8,4,1,2048,6144]) -> bf16[1,1,8,4,1,2048,6144] {
  %param_0.6093 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} parameter(0), metadata={scheduling_name="param_0.6093"}
  ROOT %all-to-all.11.1 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} all-to-all(%param_0.6093), channel_id=300, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all.11.1"}
}

%add.2.clone (x.5: bf16[], y.5: bf16[]) -> bf16[] {
  %y.5 = bf16[] parameter(1), metadata={scheduling_name="y.5"}
  %x.5 = bf16[] parameter(0), metadata={scheduling_name="x.5"}
  ROOT %add.2843.0 = bf16[] add(%x.5, %y.5), metadata={scheduling_name="add.2843.0"}
}

%async_computation.12 (param_0.6094: bf16[6144,1,8], param_1.6483: bf16[6144,8,128,1], param_2.4761: bf16[6144,1,48,128], param_3.3985: bf16[6144,48,128,1], param_4.2944: bf16[6144,8,128,1], param_5.2729: bf16[6144,1,8], param_6.2547: bf16[6144,8,128,1], param_7.2395: bf16[6144,1,48,128], param_8.2263: bf16[6144,48,128,1], param_9.2287: bf16[6144,8,128,1]) -> (bf16[768,1,8], bf16[768,8,128,1], bf16[768,1,48,128], bf16[768,48,128,1], bf16[768,8,128,1], /*index=5*/bf16[768,1,8], bf16[768,8,128,1], bf16[768,1,48,128], bf16[768,48,128,1], bf16[768,8,128,1]) {
  %param_9.2287 = bf16[6144,8,128,1]{2,1,3,0} parameter(9), metadata={scheduling_name="param_9.2287"}
  %param_8.2263 = bf16[6144,48,128,1]{2,1,3,0} parameter(8), metadata={scheduling_name="param_8.2263"}
  %param_7.2395 = bf16[6144,1,48,128]{3,2,1,0} parameter(7), metadata={scheduling_name="param_7.2395"}
  %param_6.2547 = bf16[6144,8,128,1]{2,1,3,0} parameter(6), metadata={scheduling_name="param_6.2547"}
  %param_5.2729 = bf16[6144,1,8]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2729"}
  %param_4.2944 = bf16[6144,8,128,1]{2,1,3,0} parameter(4), metadata={scheduling_name="param_4.2944"}
  %param_3.3985 = bf16[6144,48,128,1]{2,1,3,0} parameter(3), metadata={scheduling_name="param_3.3985"}
  %param_2.4761 = bf16[6144,1,48,128]{3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4761"}
  %param_1.6483 = bf16[6144,8,128,1]{2,1,3,0} parameter(1), metadata={scheduling_name="param_1.6483"}
  %param_0.6094 = bf16[6144,1,8]{2,1,0} parameter(0), metadata={scheduling_name="param_0.6094"}
  ROOT %reduce-scatter.15 = (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}) reduce-scatter(%param_0.6094, %param_1.6483, %param_2.4761, %param_3.3985, %param_4.2944, /*index=5*/%param_5.2729, %param_6.2547, %param_7.2395, %param_8.2263, %param_9.2287), channel_id=614, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, use_global_device_ids=true, dimensions={0}, to_apply=%add.2.clone, metadata={scheduling_name="reduce-scatter.15"}
}

%wrapped_convert_computation.2 (param_0.6111: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6111 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6111"}
  ROOT %convert.3902.1 = f32[32768,8]{1,0} convert(%param_0.6111), metadata={scheduling_name="convert.3902.1"}
}

%wrapped_iota_computation.5 () -> s32[32768,8] {
  ROOT %iota.368.1 = s32[32768,8]{1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="iota.368.1"}
}

%wrapped_slice_computation.2 (param_0.6112: s32[32768,8]) -> s32[32768,2] {
  %param_0.6112 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6112"}
  ROOT %slice.2380.1 = s32[32768,2]{1,0} slice(%param_0.6112), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2380.1"}
}

%wrapped_iota_computation.6 () -> s32[32768,2] {
  ROOT %iota.369.1 = s32[32768,2]{1,0} iota(), iota_dimension=1, metadata={scheduling_name="iota.369.1"}
}

%wrapped_convert_computation.3 (param_0.6113: bf16[32768,8]) -> f32[32768,8] {
  %param_0.6113 = bf16[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6113"}
  ROOT %convert.3890.1 = f32[32768,8]{1,0} convert(%param_0.6113), metadata={scheduling_name="convert.3890.1"}
}

%wrapped_slice_computation.3 (param_0.6114: s32[32768,8]) -> s32[32768,2] {
  %param_0.6114 = s32[32768,8]{1,0} parameter(0), metadata={scheduling_name="param_0.6114"}
  ROOT %slice.2378.1 = s32[32768,2]{1,0} slice(%param_0.6114), slice={[0:32768], [0:2]}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="slice.2378.1"}
}

%region_30.3928_spmd (param.3: (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128])) -> (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128]) {
  %param.3 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) parameter(0), metadata={scheduling_name="param.3"}
  %constant_1663_0 = s32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.get_microbatch_and_repeat_ids/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=218}
  %constant_1718_0 = s32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_1739_0 = u32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_4687_0 = s32[4]{0} constant({0, 1, 0, 0})
  %constant_4731_0 = s32[3]{0} constant({0, 1, 0})
  %constant_4698_0 = s32[5]{0} constant({0, 1, 0, 0, 0})
  %constant_1758_0 = s32[3]{0} constant({63, 8191, 7}), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/le" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %constant_2165_0 = f32[0]{0} constant({})
  %constant_2152_0 = bf16[0]{0} constant({})
  %get-tuple-element.4616 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.3), index=23, metadata={scheduling_name="get-tuple-element.4616"}
  %collective-permute-start.3 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%get-tuple-element.4616), channel_id=178, source_target_pairs={{16,0},{17,1},{18,2},{19,3},{20,4},{21,5},{22,6},{23,7},{24,8},{25,9},{26,10},{27,11},{28,12},{29,13},{30,14},{31,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %partition-id.3.0 = u32[] partition-id(), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="partition-id.3.0"}
  %loop_compare_fusion.10 = pred[1]{0} fusion(%constant_1663_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="loop_compare_fusion.10"}
  %loop_compare_fusion.9 = pred[1]{0} fusion(%constant_1663_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="loop_compare_fusion.9"}
  %loop_compare_fusion.11 = (pred[1]{0}, pred[1]{0}) fusion(%constant_1663_0, %partition-id.3.0), kind=kLoop, calls=%fused_compare.11, metadata={scheduling_name="loop_compare_fusion.11"}
  %loop_power_fusion = f32[64]{0} fusion(), kind=kLoop, calls=%fused_power, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 deduplicated_name="loop_power_fusion" scheduling_name="loop_power_fusion"}
  %loop_multiply_fusion.5 = s32[65]{0} fusion(), kind=kLoop, calls=%fused_multiply.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 deduplicated_name="loop_multiply_fusion.5" scheduling_name="loop_multiply_fusion.5"}
  %get-tuple-element.4593 = s32[] get-tuple-element(%param.3), index=0, metadata={scheduling_name="get-tuple-element.4593"}
  %copy.804 = s32[] copy(%get-tuple-element.4593), metadata={scheduling_name="copy.804"}
  %wrapped_iota.6 = s32[32768,2]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.6, metadata={scheduling_name="wrapped_iota.6"}
  %loop_add_fusion.1 = s32[] fusion(%copy.804), kind=kLoop, calls=%fused_add.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_add_fusion.1" scheduling_name="loop_add_fusion.1"}
  %get-tuple-element.4681 = s32[9]{0} get-tuple-element(%param.3), index=33, metadata={scheduling_name="get-tuple-element.4681"}
  %get-tuple-element.4594 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=1, metadata={scheduling_name="get-tuple-element.4594"}
  %get-tuple-element.4598 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=5, metadata={scheduling_name="get-tuple-element.4598"}
  %get-tuple-element.4599 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=6, metadata={scheduling_name="get-tuple-element.4599"}
  %get-tuple-element.4604 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=11, metadata={scheduling_name="get-tuple-element.4604"}
  %get-tuple-element.4608 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=15, metadata={scheduling_name="get-tuple-element.4608"}
  %get-tuple-element.4609 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=16, metadata={scheduling_name="get-tuple-element.4609"}
  %get-tuple-element.4683 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=35, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4683"}
  %get-tuple-element.4693 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%param.3), index=45, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4693"}
  %loop_dynamic_slice_fusion.19 = (bf16[1,1,6144]{2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, bf16[1,1,768,8]{3,2,1,0}, /*index=5*/bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}, bf16[1,1,6144]{2,1,0}) fusion(%get-tuple-element.4608, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, /*index=5*/%get-tuple-element.4594, %get-tuple-element.4604, %get-tuple-element.4683, %get-tuple-element.4693, %get-tuple-element.4609, /*index=10*/%get-tuple-element.4598, %get-tuple-element.4599), kind=kLoop, calls=%fused_dynamic_slice.19, metadata={scheduling_name="loop_dynamic_slice_fusion.19"}
  %get-tuple-element.4600 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=7, metadata={scheduling_name="get-tuple-element.4600"}
  %get-tuple-element.4603 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=10, metadata={scheduling_name="get-tuple-element.4603"}
  %get-tuple-element.4610 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=17, metadata={scheduling_name="get-tuple-element.4610"}
  %get-tuple-element.4613 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=20, metadata={scheduling_name="get-tuple-element.4613"}
  %get-tuple-element.4689 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=41, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4689"}
  %get-tuple-element.4692 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=44, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4692"}
  %get-tuple-element.4699 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=51, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4699"}
  %get-tuple-element.4702 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%param.3), index=54, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4702"}
  %loop_dynamic_slice_fusion.21 = (bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}, bf16[1,1,768,8,128]{4,3,2,1,0}) fusion(%get-tuple-element.4610, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, /*index=5*/%get-tuple-element.4613, %get-tuple-element.4699, %get-tuple-element.4702, %get-tuple-element.4689, %get-tuple-element.4692, /*index=10*/%get-tuple-element.4600, %get-tuple-element.4603), kind=kLoop, calls=%fused_dynamic_slice.21, metadata={scheduling_name="loop_dynamic_slice_fusion.21"}
  %get-tuple-element.4601 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=8, metadata={scheduling_name="get-tuple-element.4601"}
  %get-tuple-element.4602 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=9, metadata={scheduling_name="get-tuple-element.4602"}
  %get-tuple-element.4611 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=18, metadata={scheduling_name="get-tuple-element.4611"}
  %get-tuple-element.4612 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=19, metadata={scheduling_name="get-tuple-element.4612"}
  %get-tuple-element.4690 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=42, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4690"}
  %get-tuple-element.4691 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=43, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4691"}
  %get-tuple-element.4700 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%param.3), index=52, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4700"}
  %get-tuple-element.4701 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%param.3), index=53, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4701"}
  %loop_dynamic_slice_fusion.16 = (bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, /*index=5*/bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}, bf16[1,1,768,48,128]{4,3,2,1,0}) fusion(%get-tuple-element.4611, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, /*index=5*/%get-tuple-element.4612, %get-tuple-element.4690, %get-tuple-element.4700, %get-tuple-element.4701, %get-tuple-element.4691, /*index=10*/%get-tuple-element.4601, %get-tuple-element.4602), kind=kLoop, calls=%fused_dynamic_slice.16, metadata={scheduling_name="loop_dynamic_slice_fusion.16"}
  %get-tuple-element.4677 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=29, metadata={scheduling_name="get-tuple-element.4677"}
  %input_reduce_fusion.8 = f32[4,8192]{1,0} fusion(%get-tuple-element.4677, %copy.804), kind=kInput, calls=%fused_reduce.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.6" scheduling_name="input_reduce_fusion.8"}
  %collective-permute-done.3 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=300 scheduling_name="collective-permute-done.3"}
  %get-tuple-element.3924 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=4, metadata={scheduling_name="get-tuple-element.3924"}
  %bitcast.21682.0 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.3924), metadata={scheduling_name="bitcast.21682.0"}
  %get-tuple-element.3923 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=3, metadata={scheduling_name="get-tuple-element.3923"}
  %bitcast.21382.0 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.3923), metadata={scheduling_name="bitcast.21382.0"}
  %get-tuple-element.3914 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=5, metadata={scheduling_name="get-tuple-element.3914"}
  %bitcast.23488.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3914), metadata={scheduling_name="bitcast.23488.0"}
  %get-tuple-element.3913 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=4, metadata={scheduling_name="get-tuple-element.3913"}
  %bitcast.23436.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3913), metadata={scheduling_name="bitcast.23436.0"}
  %get-tuple-element.3912 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=3, metadata={scheduling_name="get-tuple-element.3912"}
  %bitcast.22479.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3912), metadata={scheduling_name="bitcast.22479.0"}
  %get-tuple-element.3911 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=2, metadata={scheduling_name="get-tuple-element.3911"}
  %bitcast.22425.0 = bf16[1,768,8,128]{3,2,0,1} bitcast(%get-tuple-element.3911), metadata={scheduling_name="bitcast.22425.0"}
  %get-tuple-element.3988 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=5, metadata={scheduling_name="get-tuple-element.3988"}
  %bitcast.23384.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.3988), metadata={scheduling_name="bitcast.23384.0"}
  %get-tuple-element.3987 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=4, metadata={scheduling_name="get-tuple-element.3987"}
  %bitcast.22319.0 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.3987), metadata={scheduling_name="bitcast.22319.0"}
  %get-tuple-element.3986 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=3, metadata={scheduling_name="get-tuple-element.3986"}
  %bitcast.32290 = bf16[1,768,128,48]{2,3,0,1} bitcast(%get-tuple-element.3986), metadata={scheduling_name="bitcast.32290"}
  %get-tuple-element.3985 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=2, metadata={scheduling_name="get-tuple-element.3985"}
  %bitcast.32291 = bf16[1,768,128,48]{2,3,0,1} bitcast(%get-tuple-element.3985), metadata={scheduling_name="bitcast.32291"}
  %all-gather-start.1 = ((bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, /*index=5*/bf16[1,768,128,48]{2,3,0,1}, bf16[1,768,8]{2,0,1}, bf16[1,768,48,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}, bf16[1,768,8,128]{3,2,0,1}), (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1})) all-gather-start(%bitcast.22319.0, %bitcast.22425.0, %bitcast.22479.0, %bitcast.32290, %bitcast.21682.0, /*index=5*/%bitcast.32291, %bitcast.21382.0, %bitcast.23384.0, %bitcast.23436.0, %bitcast.23488.0), channel_id=243, replica_groups={{0,1,2,3,4,5,6,7},{8,9,10,11,12,13,14,15},{16,17,18,19,20,21,22,23},{24,25,26,27,28,29,30,31}}, dimensions={1}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.3 = bf16[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.3, metadata={deduplicated_name="loop_broadcast_fusion.3" scheduling_name="loop_broadcast_fusion.3"}
  %wrapped_iota.5 = s32[32768,8]{1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_iota.5"}
  %loop_rsqrt_fusion.5 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.8), kind=kLoop, calls=%fused_rsqrt.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.5"}
  %get-tuple-element.4680 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.3), index=32, metadata={scheduling_name="get-tuple-element.4680"}
  %loop_dynamic_slice_fusion.25 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4680, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.25, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.24" scheduling_name="loop_dynamic_slice_fusion.25"}
  %get-tuple-element.4698 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=50, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4698"}
  %get-tuple-element.4617 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=24, metadata={scheduling_name="get-tuple-element.4617"}
  %get-tuple-element.4615 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%param.3), index=22, metadata={scheduling_name="get-tuple-element.4615"}
  %loop_convert_dynamic_slice_fusion = (bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(%get-tuple-element.4677, %copy.804, %get-tuple-element.4698, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %loop_rsqrt_fusion.5, %collective-permute-done.3, %get-tuple-element.4617, %loop_compare_fusion.9, /*index=10*/%get-tuple-element.4615), kind=kLoop, calls=%fused_convert_dynamic_slice, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="loop_convert_dynamic_slice_fusion"}
  %all-gather-done.1 = (bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, /*index=5*/bf16[1,6144,128,48]{2,3,0,1}, bf16[1,6144,8]{2,0,1}, bf16[1,6144,48,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}, bf16[1,6144,8,128]{3,2,0,1}) all-gather-done(%all-gather-start.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-gather-done.1"}
  %get-tuple-element.4284 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done.1), index=3, metadata={scheduling_name="get-tuple-element.4284"}
  %bitcast.21618.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4284), metadata={scheduling_name="bitcast.21618.0"}
  %bitcast.24149.0 = bf16[32768,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.25), metadata={scheduling_name="bitcast.24149.0"}
  %get-tuple-element.3890 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3890"}
  %bitcast.21627.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3890), metadata={scheduling_name="bitcast.21627.0"}
  %cublas-lt-matmul.17 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24149.0, %bitcast.21618.0, %bitcast.21627.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.17"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_broadcast_fusion.4 = u32[1,4,8192,8]{3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.4, metadata={deduplicated_name="loop_broadcast_fusion.4" scheduling_name="loop_broadcast_fusion.4"}
  %get-tuple-element.3756.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.17), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3756.0"}
  %input_reduce_fusion.11 = f32[4,8192]{1,0} fusion(%get-tuple-element.3756.0), kind=kInput, calls=%fused_reduce.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.11"}
  %loop_rsqrt_fusion.6 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.11), kind=kLoop, calls=%fused_rsqrt.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.6"}
  %get-tuple-element.4697 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=49, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4697"}
  %loop_convert_fusion.11 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%loop_rsqrt_fusion.6, %get-tuple-element.3756.0, %get-tuple-element.4697, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_convert.11, metadata={scheduling_name="loop_convert_fusion.11"}
  %get-tuple-element.4285 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done.1), index=4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4285"}
  %bitcast.21686.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4285), metadata={scheduling_name="bitcast.21686.0"}
  %bitcast.21673.0 = bf16[32768,6144]{1,0} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.21673.0"}
  %custom-call.1083 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21673.0, %bitcast.21686.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1083"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4679 = u32[9,2,4]{2,1,0} get-tuple-element(%param.3), index=31, metadata={scheduling_name="get-tuple-element.4679"}
  %loop_dynamic_slice_fusion.22 = u32[1,2,4]{2,1,0} fusion(%get-tuple-element.4679, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.22, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.22" scheduling_name="loop_dynamic_slice_fusion.22"}
  %get-tuple-element.3757.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1083), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3757.0"}
  %wrapped_convert.2 = f32[32768,8]{1,0} fusion(%get-tuple-element.3757.0), kind=kLoop, calls=%wrapped_convert_computation.2, metadata={scheduling_name="wrapped_convert.2"}
  %sort.15.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.2, %wrapped_iota.5), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.15.0"}
  %copy.697 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.697"}
  %get-tuple-element.1391.0 = s32[32768,8]{1,0} get-tuple-element(%sort.15.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1391.0"}
  %wrapped_slice.2 = s32[32768,2]{1,0} fusion(%get-tuple-element.1391.0), kind=kLoop, calls=%wrapped_slice_computation.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.2"}
  %get-tuple-element.3840.0 = f32[32768,8]{1,0} get-tuple-element(%sort.15.0), index=0, metadata={scheduling_name="get-tuple-element.3840.0"}
  %loop_convert_fusion.16 = f32[32768,2]{1,0} fusion(%get-tuple-element.3840.0), kind=kLoop, calls=%fused_convert.16, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.16"}
  %sort.19.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.16, %wrapped_slice.2, %wrapped_iota.6), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.19.0"}
  %copy.696 = u32[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.4), metadata={scheduling_name="copy.696"}
  %get-tuple-element.1294.0 = s32[32768,2]{1,0} get-tuple-element(%sort.19.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1294.0"}
  %loop_compare_fusion.7 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.1294.0), kind=kLoop, calls=%fused_compare.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.7" scheduling_name="loop_compare_fusion.7"}
  %loop_slice_fusion.2 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.7), kind=kLoop, calls=%fused_slice.2, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.2"}
  %loop_reduce_window_fusion.7 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.2), kind=kLoop, calls=%fused_reduce_window.7, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.7"}
  %loop_transpose_fusion.9 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) fusion(%get-tuple-element.1294.0, %constant_1739_0, %partition-id.3.0, %constant_1718_0), kind=kLoop, calls=%fused_transpose.14, metadata={scheduling_name="loop_transpose_fusion.9"}
  %loop_reduce_window_fusion.6 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.7), kind=kLoop, calls=%fused_reduce_window.6, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.6"}
  %get-tuple-element.3889 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.9), index=1, metadata={scheduling_name="get-tuple-element.3889"}
  %input_scatter_fusion.9 = u32[1,4,8192,8]{3,2,1,0} fusion(%copy.696, %get-tuple-element.3889, %constant_1663_0, %partition-id.3.0, %constant_1718_0), kind=kInput, calls=%fused_scatter.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.8" scheduling_name="input_scatter_fusion.9"}
  %loop_compare_fusion.5 = pred[1,4,8192,2]{3,2,1,0} fusion(%input_scatter_fusion.9, %get-tuple-element.1294.0, %constant_1739_0, %partition-id.3.0, %constant_1663_0, /*index=5*/%constant_1718_0), kind=kLoop, calls=%fused_compare.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_compare_fusion.5" scheduling_name="loop_compare_fusion.5"}
  %input_reduce_fusion.10 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.7, %loop_reduce_window_fusion.7, %loop_reduce_window_fusion.6), kind=kInput, calls=%fused_reduce.10, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.10"}
  %get-tuple-element.3842.0 = f32[32768,2]{1,0} get-tuple-element(%sort.19.0), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3842.0"}
  %input_scatter_fusion.7 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.697, %get-tuple-element.3889, %loop_compare_fusion.5, %get-tuple-element.3842.0), kind=kInput, calls=%fused_scatter.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.5" scheduling_name="input_scatter_fusion.7"}
  %get-tuple-element.3886 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.3886"}
  %get-tuple-element.3887 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.3887"}
  %input_multiply_transpose_fusion.3 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.3887, %get-tuple-element.3886, %input_scatter_fusion.7), kind=kInput, calls=%fused_multiply_transpose.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.3"}
  %get-tuple-element.4675 = u32[9,2,4]{2,1,0} get-tuple-element(%param.3), index=27, metadata={scheduling_name="get-tuple-element.4675"}
  %loop_dynamic_slice_fusion.23 = u32[1,2,4]{2,1,0} fusion(%get-tuple-element.4675, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.23, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.22" scheduling_name="loop_dynamic_slice_fusion.23"}
  %get-tuple-element.3884 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3884"}
  %get-tuple-element.3885 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3885"}
  %input_convert_transpose_fusion.3 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.3884, %get-tuple-element.3885), kind=kInput, calls=%fused_convert_transpose.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="input_convert_transpose_fusion.2" scheduling_name="input_convert_transpose_fusion.3"}
  %get-tuple-element.4673 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=25, metadata={scheduling_name="get-tuple-element.4673"}
  %input_reduce_fusion.6 = f32[4,8192]{1,0} fusion(%get-tuple-element.4673, %copy.804), kind=kInput, calls=%fused_reduce.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.6" scheduling_name="input_reduce_fusion.6"}
  %bitcast.21907.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.21907.0"}
  %get-tuple-element.3881 = bf16[1,4,8,2048,8192]{4,3,2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3881"}
  %bitcast.21899.0 = bf16[4,16384,8192]{2,1,0} bitcast(%get-tuple-element.3881), metadata={scheduling_name="bitcast.21899.0"}
  %custom-call.1084 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.21899.0, %bitcast.21907.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1084"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_rsqrt_fusion.4 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.6), kind=kLoop, calls=%fused_rsqrt.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.4"}
  %get-tuple-element.3758.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1084), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3758.0"}
  %loop_transpose_fusion.12 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3758.0), kind=kLoop, calls=%fused_transpose.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.12"}
  %copy.731 = bf16[1,2,4,8192,6144]{4,3,2,1,0} copy(%get-tuple-element.4617), metadata={scheduling_name="copy.731"}
  %bitcast.21914.0 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} bitcast(%loop_transpose_fusion.12), metadata={scheduling_name="bitcast.21914.0"}
  %all-to-all-start.4 = ((bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.21914.0), calls=%async_computation.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.4678 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.3), index=30, metadata={scheduling_name="get-tuple-element.4678"}
  %loop_dynamic_slice_fusion.18 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%get-tuple-element.4678, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.17" scheduling_name="loop_dynamic_slice_fusion.18"}
  %get-tuple-element.4674 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%param.3), index=26, metadata={scheduling_name="get-tuple-element.4674"}
  %loop_dynamic_slice_fusion.17 = f32[1,1,1,4,48,8192]{5,4,3,2,1,0} fusion(%get-tuple-element.4674, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.17" scheduling_name="loop_dynamic_slice_fusion.17"}
  %get-tuple-element.4676 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%param.3), index=28, metadata={scheduling_name="get-tuple-element.4676"}
  %loop_dynamic_slice_fusion.24 = bf16[1,1,4,8192,48,128]{5,4,3,2,1,0} fusion(%get-tuple-element.4676, %copy.804), kind=kLoop, calls=%fused_dynamic_slice.24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_slice_fusion.24" scheduling_name="loop_dynamic_slice_fusion.24"}
  %get-tuple-element.3908 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3908"}
  %bitcast.21952.0 = bf16[4,6144,8192]{1,2,0} bitcast(%get-tuple-element.3908), metadata={scheduling_name="bitcast.21952.0"}
  %get-tuple-element.3882 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3882"}
  %custom-call.1086 = (bf16[4,6144,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.21952.0, %get-tuple-element.3882), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1086"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"134217728","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4614 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=21, metadata={scheduling_name="get-tuple-element.4614"}
  %copy.729 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%get-tuple-element.4614), metadata={scheduling_name="copy.729"}
  %get-tuple-element.3760.0 = bf16[4,6144,16384]{2,1,0} get-tuple-element(%custom-call.1086), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3760.0"}
  %loop_transpose_fusion.11 = bf16[8,24576,2048]{2,1,0} fusion(%get-tuple-element.3760.0), kind=kLoop, calls=%fused_transpose.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion.7" scheduling_name="loop_transpose_fusion.11"}
  %all-to-all-done.4 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.4"}
  %bitcast.21964.0 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} bitcast(%loop_transpose_fusion.11), metadata={scheduling_name="bitcast.21964.0"}
  %all-to-all-start.5 = ((bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4}), bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4}) async-start(%bitcast.21964.0), calls=%async_computation.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_dynamic_update_slice_fusion.32 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%copy.731, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.32, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=352 scheduling_name="loop_dynamic_update_slice_fusion.32"}
  %get-tuple-element.4595 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=2, metadata={scheduling_name="get-tuple-element.4595"}
  %get-tuple-element.4596 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=3, metadata={scheduling_name="get-tuple-element.4596"}
  %get-tuple-element.4597 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=4, metadata={scheduling_name="get-tuple-element.4597"}
  %get-tuple-element.4605 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=12, metadata={scheduling_name="get-tuple-element.4605"}
  %get-tuple-element.4606 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=13, metadata={scheduling_name="get-tuple-element.4606"}
  %get-tuple-element.4607 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=14, metadata={scheduling_name="get-tuple-element.4607"}
  %get-tuple-element.4684 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=36, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4684"}
  %get-tuple-element.4685 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=37, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4685"}
  %get-tuple-element.4686 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=38, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4686"}
  %get-tuple-element.4694 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=46, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4694"}
  %get-tuple-element.4695 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%param.3), index=47, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4695"}
  %get-tuple-element.4696 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%param.3), index=48, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4696"}
  %loop_dynamic_slice_fusion.20 = (bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}, bf16[1,1,1,6144,16384]{4,3,2,1,0}, /*index=10*/bf16[1,1,1,6144,16384]{4,3,2,1,0}, bf16[1,1,1,16384,6144]{4,3,2,1,0}) fusion(%get-tuple-element.4694, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, /*index=5*/%get-tuple-element.4696, %get-tuple-element.4695, %get-tuple-element.4684, %get-tuple-element.4685, %get-tuple-element.4686, /*index=10*/%get-tuple-element.4595, %get-tuple-element.4596, %get-tuple-element.4597, %get-tuple-element.4605, %get-tuple-element.4606, /*index=15*/%get-tuple-element.4607), kind=kLoop, calls=%fused_dynamic_slice.20, metadata={scheduling_name="loop_dynamic_slice_fusion.20"}
  %loop_dynamic_update_slice_fusion.31 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%copy.729, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.31, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/dynamic_update_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=331 scheduling_name="loop_dynamic_update_slice_fusion.31"}
  %get-tuple-element.3993 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.3993"}
  %bitcast.22007.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3993), metadata={scheduling_name="bitcast.22007.0"}
  %bitcast.22003.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.4), metadata={scheduling_name="bitcast.22003.0"}
  %custom-call.1090 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22003.0, %bitcast.22007.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1090"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3991 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.3991"}
  %bitcast.21927.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3991), metadata={scheduling_name="bitcast.21927.0"}
  %custom-call.1085 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22003.0, %bitcast.21927.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1085"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.5 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} async-done(%all-to-all-start.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.5"}
  %input_transpose_fusion.5 = bf16[32,2048,6144]{2,1,0} fusion(%all-to-all-done.5), kind=kInput, calls=%fused_transpose.16, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion" scheduling_name="input_transpose_fusion.5"}
  %get-tuple-element.3992 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.3992"}
  %bitcast.21980.0 = bf16[6144,16384]{0,1} bitcast(%get-tuple-element.3992), metadata={scheduling_name="bitcast.21980.0"}
  %bitcast.23983.0 = bf16[65536,6144]{1,0} bitcast(%input_transpose_fusion.5), metadata={scheduling_name="bitcast.23983.0"}
  %custom-call.1087 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23983.0, %bitcast.21980.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1087"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %copy.704 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.704"}
  %get-tuple-element.3761.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1087), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3761.0"}
  %get-tuple-element.3762.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1090), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3762.0"}
  %get-tuple-element.3759.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1085), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3759.0"}
  %loop_convert_fusion.10 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) fusion(%get-tuple-element.3762.0, %get-tuple-element.3759.0, %get-tuple-element.3761.0), kind=kLoop, calls=%fused_convert.10, metadata={scheduling_name="loop_convert_fusion.10"}
  %copy.699 = bf16[1,4,8192,8]{3,2,1,0} copy(%loop_broadcast_fusion.3), metadata={scheduling_name="copy.699"}
  %bitcast.22110.0 = bf16[16384,6144]{1,0} bitcast(%get-tuple-element.3992), metadata={scheduling_name="bitcast.22110.0"}
  %get-tuple-element.3877 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.3877"}
  %bitcast.22106.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3877), metadata={scheduling_name="bitcast.22106.0"}
  %custom-call.1092 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22106.0, %bitcast.22110.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1092"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %input_reduce_fusion.19 = pred[] fusion(%constant_4687_0, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kInput, calls=%fused_reduce.19, metadata={scheduling_name="input_reduce_fusion.19"}
  %get-tuple-element.3765.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1092), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3765.0"}
  %bitcast.22114.0 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3765.0), metadata={scheduling_name="bitcast.22114.0"}
  %all-to-all-start.7 = ((bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.22114.0), calls=%async_computation.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_compare_reduce_fusion = (pred[], pred[], pred[]) fusion(%get-tuple-element.4681, %copy.804, %constant_4731_0, %constant_1663_0, %partition-id.3.0, /*index=5*/%constant_4698_0), kind=kLoop, calls=%fused_compare_reduce, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="loop_compare_reduce_fusion"}
  %get-tuple-element.4682 = s32[4,4,8192]{2,1,0} get-tuple-element(%param.3), index=34, metadata={scheduling_name="get-tuple-element.4682"}
  %loop_convert_fusion.14 = (bf16[1,1,4,8192,64]{4,3,2,1,0}, bf16[1,1,4,8192,64]{4,3,2,1,0}) fusion(%loop_power_fusion, %get-tuple-element.4682, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, /*index=5*/%copy.804), kind=kLoop, calls=%fused_convert.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="loop_convert_fusion.14"}
  %get-tuple-element.4283 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4283"}
  %bitcast.22483.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4283), metadata={scheduling_name="bitcast.22483.0"}
  %get-tuple-element.3891 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_convert_dynamic_slice_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/dynamic_slice" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.3891"}
  %bitcast.24223.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3891), metadata={scheduling_name="bitcast.24223.0"}
  %custom-call.1099 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24223.0, %bitcast.22483.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1099"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22041.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3991), metadata={scheduling_name="bitcast.22041.0"}
  %get-tuple-element.3878 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.3878"}
  %bitcast.23925.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3878), metadata={scheduling_name="bitcast.23925.0"}
  %custom-call.1091 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23925.0, %bitcast.22041.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1091"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.21998.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3993), metadata={scheduling_name="bitcast.21998.0"}
  %get-tuple-element.3879 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.10), index=2, metadata={scheduling_name="get-tuple-element.3879"}
  %bitcast.23953.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3879), metadata={scheduling_name="bitcast.23953.0"}
  %get-tuple-element.3763.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1091), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3763.0"}
  %cublas-lt-matmul.18 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23953.0, %bitcast.21998.0, %get-tuple-element.3763.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="cublas-lt-matmul.18"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.7 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.7"}
  %input_transpose_fusion.4 = bf16[4,6144,8,2048]{3,2,1,0} fusion(%all-to-all-done.7), kind=kInput, calls=%fused_transpose.13, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion.2" scheduling_name="input_transpose_fusion.4"}
  %get-tuple-element.3764.0 = bf16[65536,6144]{1,0} get-tuple-element(%cublas-lt-matmul.18), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3764.0"}
  %bitcast.22047.0 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} bitcast(%get-tuple-element.3764.0), metadata={scheduling_name="bitcast.22047.0"}
  %all-to-all-start.6 = ((bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2}), bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2}) async-start(%bitcast.22047.0), calls=%async_computation.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.22097.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3908), metadata={scheduling_name="bitcast.22097.0"}
  %bitcast.22121.0 = bf16[4,6144,16384]{2,1,0} bitcast(%input_transpose_fusion.4), metadata={scheduling_name="bitcast.22121.0"}
  %custom-call.1093 = (bf16[4,8192,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.22097.0, %bitcast.22121.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1093"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4282 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4282"}
  %bitcast.22429.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4282), metadata={scheduling_name="bitcast.22429.0"}
  %custom-call.1096 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24223.0, %bitcast.22429.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1096"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3766.0 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%custom-call.1093), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3766.0"}
  %input_transpose_fusion.3 = bf16[4,16392,8192]{2,1,0} fusion(%get-tuple-element.3766.0), kind=kInput, calls=%fused_transpose.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 deduplicated_name="input_transpose_fusion.1" scheduling_name="input_transpose_fusion.3"}
  %input_reduce_fusion.14 = bf16[4,8,8192]{2,1,0} fusion(%get-tuple-element.3884, %input_transpose_fusion.3), kind=kInput, calls=%fused_reduce.14, metadata={deduplicated_name="input_reduce_fusion.13" scheduling_name="input_reduce_fusion.14"}
  %loop_select_fusion = bf16[1,4,8192,2]{3,2,1,0} fusion(%loop_compare_fusion.5, %get-tuple-element.1294.0, %get-tuple-element.3886, %input_reduce_fusion.14, %constant_1758_0, /*index=5*/%constant_1739_0, %partition-id.3.0, %constant_1718_0), kind=kLoop, calls=%fused_select, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_select_fusion" scheduling_name="loop_select_fusion"}
  %get-tuple-element.3888 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.9), index=0, metadata={scheduling_name="get-tuple-element.3888"}
  %input_scatter_fusion.6 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.699, %get-tuple-element.3888, %loop_select_fusion, %get-tuple-element.3842.0), kind=kInput, calls=%fused_scatter.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 deduplicated_name="input_scatter_fusion.4" scheduling_name="input_scatter_fusion.6"}
  %get-tuple-element.4281 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4281"}
  %bitcast.22323.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4281), metadata={scheduling_name="bitcast.22323.0"}
  %custom-call.1095 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24223.0, %bitcast.22323.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1095"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22217.0 = bf16[8,6144]{0,1} bitcast(%get-tuple-element.4285), metadata={scheduling_name="bitcast.22217.0"}
  %bitcast.23889.0 = bf16[32768,8]{1,0} bitcast(%input_scatter_fusion.6), metadata={scheduling_name="bitcast.23889.0"}
  %custom-call.1094 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23889.0, %bitcast.22217.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1094"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"262144","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.6 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} async-done(%all-to-all-start.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.6"}
  %loop_transpose_fusion.10 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.6), kind=kLoop, calls=%fused_transpose.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.6" scheduling_name="loop_transpose_fusion.10"}
  %get-tuple-element.3883 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.3), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3883"}
  %get-tuple-element.3767.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1094), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3767.0"}
  %bitcast.22221.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3767.0), metadata={scheduling_name="bitcast.22221.0"}
  %bitcast.22054.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.10), metadata={scheduling_name="bitcast.22054.0"}
  %cublas-lt-matmul.19 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.3883, %bitcast.22054.0, %bitcast.22221.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="cublas-lt-matmul.19"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3873 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.14), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.3873"}
  %get-tuple-element.3872 = bf16[1,1,4,8192,64]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.14), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=305 scheduling_name="get-tuple-element.3872"}
  %get-tuple-element.3770.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1096), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3770.0"}
  %input_concatenate_fusion.10 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3770.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.10"}
  %get-tuple-element.3768.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.19), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3768.0"}
  %input_reduce_fusion.9 = f32[4,8192]{1,0} fusion(%get-tuple-element.3768.0, %get-tuple-element.3756.0, %get-tuple-element.4697, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %copy.804), kind=kInput, calls=%fused_reduce.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="input_reduce_fusion.5" scheduling_name="input_reduce_fusion.9"}
  %loop_multiply_fusion.1 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.6, %input_reduce_fusion.9, %input_reduce_fusion.11), kind=kLoop, calls=%fused_multiply.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.1"}
  %get-tuple-element.4688 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=40, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4688"}
  %input_add_convert_dynamic_slice_reduce_select_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, /*index=5*/bf16[1,1,4,8192,6144]{4,3,2,1,0}, bf16[1,1,4,8192,6144]{4,3,2,1,0}) fusion(%loop_multiply_fusion.1, %get-tuple-element.3756.0, %loop_rsqrt_fusion.6, %get-tuple-element.4697, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.3768.0, %collective-permute-done.3, %get-tuple-element.4617, %get-tuple-element.4681, /*index=10*/%copy.804, %loop_compare_fusion.9, %get-tuple-element.4615, %get-tuple-element.4688, %loop_rsqrt_fusion.4, /*index=15*/%get-tuple-element.4673, %get-tuple-element.4614), kind=kInput, calls=%fused_add_convert_dynamic_slice_reduce_select, metadata={scheduling_name="input_add_convert_dynamic_slice_reduce_select_fusion"}
  %get-tuple-element.3769.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1095), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3769.0"}
  %input_concatenate_fusion.6 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3769.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.6"}
  %bitcast.22521.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4284), metadata={scheduling_name="bitcast.22521.0"}
  %get-tuple-element.3874 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=0, metadata={scheduling_name="get-tuple-element.3874"}
  %bitcast.22517.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3874), metadata={scheduling_name="bitcast.22517.0"}
  %custom-call.1100 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22517.0, %bitcast.22521.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1100"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22508.0 = u32[2,4]{1,0} bitcast(%loop_dynamic_slice_fusion.22), metadata={scheduling_name="bitcast.22508.0"}
  %bitcast.22499.0 = f32[1,4,48,8192,1]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.18), metadata={scheduling_name="bitcast.22499.0"}
  %bitcast.22512.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.25), metadata={scheduling_name="bitcast.22512.0"}
  %get-tuple-element.3771.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1099), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3771.0"}
  %bitcast.22487.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3771.0), metadata={scheduling_name="bitcast.22487.0"}
  %get-tuple-element.3772.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1100), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3772.0"}
  %bitcast.22525.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%get-tuple-element.3772.0), metadata={scheduling_name="bitcast.22525.0"}
  %custom-call.988 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u8[1616904192]{0}) custom-call(%input_concatenate_fusion.6, %input_concatenate_fusion.10, %bitcast.22487.0, %constant_2152_0, %bitcast.22499.0, /*index=5*/%bitcast.22508.0, %bitcast.22512.0, %bitcast.22525.0, %loop_multiply_fusion.5, %loop_multiply_fusion.5, /*index=10*/%constant_2165_0, %constant_2165_0, %constant_2165_0, %constant_2165_0, %constant_2165_0, /*index=15*/%constant_2165_0), custom_call_target="te_fused_attn_backward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, s32[65]{0}, s32[65]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.988"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.23951.0 = bf16[6144,65536]{0,1} bitcast(%all-to-all-done.4), metadata={scheduling_name="bitcast.23951.0"}
  %custom-call.1136 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23951.0, %bitcast.23953.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1136"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1315.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1315.0"}
  %input_concatenate_fusion.4 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1315.0), kind=kInput, calls=%fused_concatenate.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.4" scheduling_name="input_concatenate_fusion.4"}
  %custom-call.1135 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23951.0, %bitcast.23925.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1135"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22627.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4281), metadata={scheduling_name="bitcast.22627.0"}
  %bitcast.22623.0 = bf16[32768,6144]{1,0} bitcast(%input_concatenate_fusion.4), metadata={scheduling_name="bitcast.22623.0"}
  %custom-call.1102 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22623.0, %bitcast.22627.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1102"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1314.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1314.0"}
  %input_concatenate_fusion.8 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1314.0), kind=kInput, calls=%fused_concatenate.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.8" scheduling_name="input_concatenate_fusion.8"}
  %get-tuple-element.4286 = bf16[1,6144,128,48]{2,3,0,1} get-tuple-element(%all-gather-done.1), index=5, metadata={scheduling_name="get-tuple-element.4286"}
  %bitcast.21303.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4286), metadata={scheduling_name="bitcast.21303.0"}
  %bitcast.23779.0 = bf16[32768,6144]{1,0} bitcast(%loop_dynamic_slice_fusion.24), metadata={scheduling_name="bitcast.23779.0"}
  %get-tuple-element.3905 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=5, metadata={scheduling_name="get-tuple-element.3905"}
  %bitcast.21312.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3905), metadata={scheduling_name="bitcast.21312.0"}
  %cublas-lt-matmul.16 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23779.0, %bitcast.21303.0, %bitcast.21312.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.16"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22580.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4282), metadata={scheduling_name="bitcast.22580.0"}
  %bitcast.22576.0 = bf16[32768,1024]{1,0} bitcast(%input_concatenate_fusion.8), metadata={scheduling_name="bitcast.22576.0"}
  %custom-call.1101 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22576.0, %bitcast.22580.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1101"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3754.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.16), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3754.0"}
  %input_reduce_fusion.12 = f32[4,8192]{1,0} fusion(%get-tuple-element.3754.0), kind=kInput, calls=%fused_reduce.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="input_reduce_fusion.11" scheduling_name="input_reduce_fusion.12"}
  %bitcast.22538.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4283), metadata={scheduling_name="bitcast.22538.0"}
  %get-tuple-element.1313.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.988), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1313.0"}
  %bitcast.22534.0 = bf16[32768,1024]{1,0} bitcast(%get-tuple-element.1313.0), metadata={scheduling_name="bitcast.22534.0"}
  %get-tuple-element.3773.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1101), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3773.0"}
  %cublas-lt-matmul.20 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22534.0, %bitcast.22538.0, %get-tuple-element.3773.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.20"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_rsqrt_fusion.7 = f32[1,1,4,8192]{3,2,1,0} fusion(%input_reduce_fusion.12), kind=kLoop, calls=%fused_rsqrt.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="loop_rsqrt_fusion.4" scheduling_name="loop_rsqrt_fusion.7"}
  %get-tuple-element.4687 = bf16[2,1,6144]{2,1,0} get-tuple-element(%param.3), index=39, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_current_stage_weights/pipeline_module.get_current_repeat_from_stages/pipeline_module.vmap_parallel_gather/pipeline_module.shard_dim_by_stages/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=212 scheduling_name="get-tuple-element.4687"}
  %get-tuple-element.3775.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1102), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3775.0"}
  %get-tuple-element.3774.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.20), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3774.0"}
  %input_convert_reduce_fusion.1 = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(%get-tuple-element.4677, %copy.804, %get-tuple-element.4698, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %get-tuple-element.3775.0, %get-tuple-element.3774.0, %get-tuple-element.4687, %loop_rsqrt_fusion.7, /*index=10*/%get-tuple-element.3754.0), kind=kInput, calls=%fused_convert_reduce.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_convert_reduce_fusion.1"}
  %get-tuple-element.4287 = bf16[1,6144,8]{2,0,1} get-tuple-element(%all-gather-done.1), index=6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4287"}
  %bitcast.21386.0 = bf16[6144,8]{1,0} bitcast(%get-tuple-element.4287), metadata={scheduling_name="bitcast.21386.0"}
  %get-tuple-element.3907 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3907"}
  %bitcast.21373.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.21373.0"}
  %custom-call.1082 = (bf16[32768,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21373.0, %bitcast.21386.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1082"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23981.0 = bf16[16384,65536]{0,1} bitcast(%get-tuple-element.3877), metadata={scheduling_name="bitcast.23981.0"}
  %custom-call.1137 = (bf16[16384,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23981.0, %bitcast.23983.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1137"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3755.0 = bf16[32768,8]{1,0} get-tuple-element(%custom-call.1082), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3755.0"}
  %wrapped_convert.3 = f32[32768,8]{1,0} fusion(%get-tuple-element.3755.0), kind=kLoop, calls=%wrapped_convert_computation.3, metadata={scheduling_name="wrapped_convert.3"}
  %sort.14.0 = (f32[32768,8]{1,0}, s32[32768,8]{1,0}) sort(%wrapped_convert.3, %wrapped_iota.5), dimensions={1}, is_stable=true, to_apply=%compare-greater-than.6.clone.clone.clone.clone.clone.clone.clone.clone.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.14.0"}
  %get-tuple-element.3919 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3919"}
  %get-tuple-element.4002 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=11, metadata={scheduling_name="get-tuple-element.4002"}
  %get-tuple-element.3805.0 = bf16[16384,6144]{1,0} get-tuple-element(%custom-call.1137), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3805.0"}
  %loop_dynamic_update_slice_fusion.25 = bf16[2,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4607, %get-tuple-element.3805.0, %get-tuple-element.4002, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.25, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.19" scheduling_name="loop_dynamic_update_slice_fusion.25"}
  %get-tuple-element.1389.0 = s32[32768,8]{1,0} get-tuple-element(%sort.14.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1389.0"}
  %wrapped_slice.3 = s32[32768,2]{1,0} fusion(%get-tuple-element.1389.0), kind=kLoop, calls=%wrapped_slice_computation.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="wrapped_slice.3"}
  %get-tuple-element.3835.0 = f32[32768,8]{1,0} get-tuple-element(%sort.14.0), index=0, metadata={scheduling_name="get-tuple-element.3835.0"}
  %loop_convert_fusion.15 = f32[32768,2]{1,0} fusion(%get-tuple-element.3835.0), kind=kLoop, calls=%fused_convert.15, metadata={deduplicated_name="loop_convert_fusion.15" scheduling_name="loop_convert_fusion.15"}
  %sort.18.0 = (f32[32768,2]{1,0}, s32[32768,2]{1,0}, s32[32768,2]{1,0}) sort(%loop_convert_fusion.15, %wrapped_slice.3, %wrapped_iota.6), dimensions={1}, is_stable=true, to_apply=%compare-value-and-index.9.clone.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="sort.18.0"}
  %get-tuple-element.4001 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=10, metadata={scheduling_name="get-tuple-element.4001"}
  %get-tuple-element.3804.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1136), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3804.0"}
  %loop_dynamic_update_slice_fusion.24 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4606, %get-tuple-element.4001, %get-tuple-element.3804.0, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.24"}
  %get-tuple-element.1277.0 = s32[32768,2]{1,0} get-tuple-element(%sort.18.0), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/top_k" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 scheduling_name="get-tuple-element.1277.0"}
  %loop_compare_fusion.8 = pred[1,4,8,8192,2]{4,3,2,1,0} fusion(%get-tuple-element.1277.0), kind=kLoop, calls=%fused_compare.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 deduplicated_name="loop_compare_fusion.7" scheduling_name="loop_compare_fusion.8"}
  %loop_transpose_fusion.13 = (s32[65536,4]{1,0}, s32[65536,4]{1,0}) fusion(%get-tuple-element.1277.0, %constant_1739_0, %partition-id.3.0, %constant_1718_0), kind=kLoop, calls=%fused_transpose.19, metadata={scheduling_name="loop_transpose_fusion.13"}
  %get-tuple-element.3880 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=3, metadata={scheduling_name="get-tuple-element.3880"}
  %bitcast.24477.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3880), metadata={scheduling_name="bitcast.24477.0"}
  %collective-permute-start.6 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24477.0), channel_id=373, source_target_pairs={{0,16},{1,17},{2,18},{3,19},{4,20},{5,21},{6,22},{7,23},{8,24},{9,25},{10,26},{11,27},{12,28},{13,29},{14,30},{15,31}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_slice_fusion.3 = s32[1,4,8,1024,1]{4,3,2,1,0} fusion(%loop_compare_fusion.8), kind=kLoop, calls=%fused_slice.3, metadata={deduplicated_name="loop_slice_fusion.2" scheduling_name="loop_slice_fusion.3"}
  %loop_reduce_window_fusion.5 = s32[1,4,8,64,16]{4,3,2,1,0} fusion(%loop_slice_fusion.3), kind=kLoop, calls=%fused_reduce_window.5, metadata={deduplicated_name="loop_reduce_window_fusion.5" scheduling_name="loop_reduce_window_fusion.5"}
  %loop_reduce_window_fusion.4 = s32[1,4,8,4,16]{4,3,2,1,0} fusion(%loop_reduce_window_fusion.5), kind=kLoop, calls=%fused_reduce_window.4, metadata={deduplicated_name="loop_reduce_window_fusion.4" scheduling_name="loop_reduce_window_fusion.4"}
  %get-tuple-element.3898 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.3898"}
  %input_scatter_fusion.8 = u32[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.4, %get-tuple-element.3898, %constant_1663_0, %partition-id.3.0, %constant_1718_0), kind=kInput, calls=%fused_scatter.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.8" scheduling_name="input_scatter_fusion.8"}
  %loop_compare_fusion.6 = pred[1,4,8192,2]{3,2,1,0} fusion(%input_scatter_fusion.8, %get-tuple-element.1277.0, %constant_1739_0, %partition-id.3.0, %constant_1663_0, /*index=5*/%constant_1718_0), kind=kLoop, calls=%fused_compare.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/eq" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_compare_fusion.5" scheduling_name="loop_compare_fusion.6"}
  %input_reduce_fusion.7 = (s32[4,8,8192]{2,1,0}, s32[4,8,8192]{2,1,0}) fusion(%loop_compare_fusion.8, %loop_reduce_window_fusion.5, %loop_reduce_window_fusion.4), kind=kInput, calls=%fused_reduce.7, metadata={deduplicated_name="input_reduce_fusion.7" scheduling_name="input_reduce_fusion.7"}
  %get-tuple-element.3837.0 = f32[32768,2]{1,0} get-tuple-element(%sort.18.0), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=380 scheduling_name="get-tuple-element.3837.0"}
  %input_scatter_fusion.5 = bf16[1,4,8192,8]{3,2,1,0} fusion(%copy.704, %get-tuple-element.3898, %loop_compare_fusion.6, %get-tuple-element.3837.0), kind=kInput, calls=%fused_scatter.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="input_scatter_fusion.5" scheduling_name="input_scatter_fusion.5"}
  %get-tuple-element.3894 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.3894"}
  %get-tuple-element.3895 = s32[4,8,8192]{2,1,0} get-tuple-element(%input_reduce_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.3895"}
  %input_multiply_transpose_fusion.2 = (s32[1,4,8,8192]{3,2,1,0}, bf16[1,4,8,8192]{3,2,1,0}) fusion(%get-tuple-element.3895, %get-tuple-element.3894, %input_scatter_fusion.5), kind=kInput, calls=%fused_multiply_transpose.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 deduplicated_name="input_multiply_transpose_fusion.2" scheduling_name="input_multiply_transpose_fusion.2"}
  %get-tuple-element.4000 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=9, metadata={scheduling_name="get-tuple-element.4000"}
  %get-tuple-element.3803.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1135), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3803.0"}
  %loop_dynamic_update_slice_fusion.23 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4605, %get-tuple-element.4000, %get-tuple-element.3803.0, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.23, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.23"}
  %get-tuple-element.3892 = s32[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3892"}
  %get-tuple-element.3893 = bf16[1,4,8,8192]{3,2,1,0} get-tuple-element(%input_multiply_transpose_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/mul" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1160 scheduling_name="get-tuple-element.3893"}
  %input_convert_transpose_fusion.2 = (bf16[1,4,8,2048,8192]{4,3,2,1,0}, bf16[4,8192,16384]{2,1,0}, bf16[4,8192,16384]{2,1,0}) fusion(%get-tuple-element.3892, %get-tuple-element.3893), kind=kInput, calls=%fused_convert_transpose.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="input_convert_transpose_fusion.2" scheduling_name="input_convert_transpose_fusion.2"}
  %bitcast.23887.0 = bf16[6144,32768]{0,1} bitcast(%loop_convert_fusion.11), metadata={scheduling_name="bitcast.23887.0"}
  %custom-call.1132 = (bf16[6144,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23887.0, %bitcast.23889.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1132"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"262144","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.22848.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.22848.0"}
  %get-tuple-element.3866 = bf16[1,4,8,2048,8192]{4,3,2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3866"}
  %bitcast.23242.0 = bf16[4,16384,8192]{2,1,0} bitcast(%get-tuple-element.3866), metadata={scheduling_name="bitcast.23242.0"}
  %custom-call.1103 = (bf16[4,16384,6144]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.23242.0, %bitcast.22848.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="custom-call.1103"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"50331648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3870 = f32[4,8192]{1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3870"}
  %loop_multiply_fusion.2 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.5, %get-tuple-element.3870, %input_reduce_fusion.8), kind=kLoop, calls=%fused_multiply.2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.2"}
  %get-tuple-element.3776.0 = bf16[4,16384,6144]{2,1,0} get-tuple-element(%custom-call.1103), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3776.0"}
  %loop_transpose_fusion.8 = bf16[8,4,12582912]{2,1,0} fusion(%get-tuple-element.3776.0), kind=kLoop, calls=%fused_transpose.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.8" scheduling_name="loop_transpose_fusion.8"}
  %collective-permute-done.6 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=347 scheduling_name="collective-permute-done.6"}
  %bitcast.22855.0 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} bitcast(%loop_transpose_fusion.8), metadata={scheduling_name="bitcast.22855.0"}
  %all-to-all-start.8 = ((bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.22855.0), calls=%async_computation.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3875 = f32[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=1, metadata={scheduling_name="get-tuple-element.3875"}
  %get-tuple-element.3871 = bf16[32768,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3871"}
  %loop_convert_fusion.13 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.3875, %loop_multiply_fusion.2, %loop_rsqrt_fusion.5, %get-tuple-element.3871, %get-tuple-element.4677, /*index=5*/%copy.804, %get-tuple-element.4698, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681), kind=kLoop, calls=%fused_convert.13, metadata={scheduling_name="loop_convert_fusion.13"}
  %get-tuple-element.4290 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4290"}
  %bitcast.23492.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4290), metadata={scheduling_name="bitcast.23492.0"}
  %get-tuple-element.3904 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=4, metadata={scheduling_name="get-tuple-element.3904"}
  %bitcast.23853.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3904), metadata={scheduling_name="bitcast.23853.0"}
  %custom-call.1122 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23853.0, %bitcast.23492.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1122"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23074.0 = bf16[4,6144,8192]{1,2,0} bitcast(%loop_convert_fusion.13), metadata={scheduling_name="bitcast.23074.0"}
  %get-tuple-element.3867 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3867"}
  %custom-call.1111 = (bf16[4,6144,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.23074.0, %get-tuple-element.3867), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1111"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"134217728","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4289 = bf16[1,6144,8,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4289"}
  %bitcast.23440.0 = bf16[6144,1024]{1,0} bitcast(%get-tuple-element.4289), metadata={scheduling_name="bitcast.23440.0"}
  %custom-call.1121 = (bf16[32768,1024]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23853.0, %bitcast.23440.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1121"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3782.0 = bf16[4,6144,16384]{2,1,0} get-tuple-element(%custom-call.1111), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3782.0"}
  %loop_transpose_fusion.7 = bf16[8,24576,2048]{2,1,0} fusion(%get-tuple-element.3782.0), kind=kLoop, calls=%fused_transpose.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="loop_transpose_fusion.7" scheduling_name="loop_transpose_fusion.7"}
  %get-tuple-element.3876 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=2, metadata={scheduling_name="get-tuple-element.3876"}
  %input_reduce_fusion.16 = bf16[6144]{0} fusion(%get-tuple-element.3876), kind=kInput, calls=%fused_reduce.16, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.16"}
  %all-to-all-done.8 = bf16[1,1,4,8,1,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.8"}
  %bitcast.23086.0 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} bitcast(%loop_transpose_fusion.7), metadata={scheduling_name="bitcast.23086.0"}
  %all-to-all-start.10 = ((bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4}), bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4}) async-start(%bitcast.23086.0), calls=%async_computation.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %bitcast.24147.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3874), metadata={scheduling_name="bitcast.24147.0"}
  %custom-call.1139 = (bf16[6144,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.24147.0, %bitcast.24149.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1139"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.4288 = bf16[1,6144,48,128]{3,2,0,1} get-tuple-element(%all-gather-done.1), index=7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4288"}
  %bitcast.23388.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4288), metadata={scheduling_name="bitcast.23388.0"}
  %custom-call.1120 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23853.0, %bitcast.23388.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1120"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.24109.0 = bf16[1024,32768]{0,1} bitcast(%input_concatenate_fusion.8), metadata={scheduling_name="bitcast.24109.0"}
  %custom-call.1138 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.24109.0, %bitcast.24223.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1138"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.24221.0 = bf16[1024,32768]{0,1} bitcast(%get-tuple-element.1313.0), metadata={scheduling_name="bitcast.24221.0"}
  %custom-call.1141 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.24221.0, %bitcast.24223.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1141"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.24185.0 = bf16[6144,32768]{0,1} bitcast(%input_concatenate_fusion.4), metadata={scheduling_name="bitcast.24185.0"}
  %custom-call.1140 = (bf16[6144,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.24185.0, %bitcast.24223.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1140"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.10 = bf16[1,1,4,6144,8,1,2048]{6,5,3,2,1,0,4} async-done(%all-to-all-start.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.10"}
  %get-tuple-element.3906 = bf16[1,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%input_add_convert_dynamic_slice_reduce_select_fusion), index=6, metadata={scheduling_name="get-tuple-element.3906"}
  %bitcast.24432.0 = bf16[1,4,8192,6144]{3,2,1,0} bitcast(%get-tuple-element.3906), metadata={scheduling_name="bitcast.24432.0"}
  %collective-permute-start.4 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24432.0), channel_id=371, source_target_pairs={{16,0},{17,1},{18,2},{19,3},{20,4},{21,5},{22,6},{23,7},{24,8},{25,9},{26,10},{27,11},{28,12},{29,13},{30,14},{31,15}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/split" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3995 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=4, metadata={scheduling_name="get-tuple-element.3995"}
  %bitcast.22900.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3995), metadata={scheduling_name="bitcast.22900.0"}
  %bitcast.22891.0 = bf16[65536,6144]{1,0} bitcast(%all-to-all-done.8), metadata={scheduling_name="bitcast.22891.0"}
  %custom-call.1105 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22891.0, %bitcast.22900.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1105"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3994 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=3, metadata={scheduling_name="get-tuple-element.3994"}
  %bitcast.22868.0 = bf16[6144,16384]{1,0} bitcast(%get-tuple-element.3994), metadata={scheduling_name="bitcast.22868.0"}
  %custom-call.1104 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22891.0, %bitcast.22868.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1104"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %input_transpose_fusion = bf16[32,2048,6144]{2,1,0} fusion(%all-to-all-done.10), kind=kInput, calls=%fused_transpose.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion" scheduling_name="input_transpose_fusion"}
  %get-tuple-element.3996 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=5, metadata={scheduling_name="get-tuple-element.3996"}
  %bitcast.23097.0 = bf16[6144,16384]{0,1} bitcast(%get-tuple-element.3996), metadata={scheduling_name="bitcast.23097.0"}
  %bitcast.23196.0 = bf16[65536,6144]{1,0} bitcast(%input_transpose_fusion), metadata={scheduling_name="bitcast.23196.0"}
  %custom-call.1112 = (bf16[65536,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23196.0, %bitcast.23097.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1112"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3792.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1121), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3792.0"}
  %input_concatenate_fusion.11 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3792.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.10" scheduling_name="input_concatenate_fusion.11"}
  %get-tuple-element.3783.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1112), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3783.0"}
  %get-tuple-element.3778.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1105), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3778.0"}
  %get-tuple-element.3777.0 = bf16[65536,16384]{1,0} get-tuple-element(%custom-call.1104), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3777.0"}
  %loop_convert_fusion.9 = (bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}, bf16[1,1,32,2048,16384]{4,3,2,1,0}) fusion(%get-tuple-element.3783.0, %get-tuple-element.3777.0, %get-tuple-element.3778.0), kind=kLoop, calls=%fused_convert.9, metadata={scheduling_name="loop_convert_fusion.9"}
  %get-tuple-element.3791.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1120), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3791.0"}
  %input_concatenate_fusion.7 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3791.0, %get-tuple-element.3872), kind=kInput, calls=%fused_concatenate.7, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=312 deduplicated_name="input_concatenate_fusion.6" scheduling_name="input_concatenate_fusion.7"}
  %bitcast.22918.0 = bf16[16384,6144]{1,0} bitcast(%get-tuple-element.3996), metadata={scheduling_name="bitcast.22918.0"}
  %get-tuple-element.3865 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=2, metadata={scheduling_name="get-tuple-element.3865"}
  %bitcast.22909.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3865), metadata={scheduling_name="bitcast.22909.0"}
  %custom-call.1108 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.22909.0, %bitcast.22918.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1108"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.4 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/split" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=295 scheduling_name="collective-permute-done.4"}
  %get-tuple-element.3779.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1108), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3779.0"}
  %bitcast.22922.0 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3779.0), metadata={scheduling_name="bitcast.22922.0"}
  %all-to-all-start.9 = ((bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.22922.0), calls=%async_computation.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3918 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3918"}
  %get-tuple-element.3920 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=0, metadata={scheduling_name="get-tuple-element.3920"}
  %loop_dynamic_update_slice_fusion.15 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4608, %get-tuple-element.3920, %input_reduce_fusion.16, %get-tuple-element.3918, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.15"}
  %bitcast.23194.0 = bf16[16384,65536]{0,1} bitcast(%get-tuple-element.3865), metadata={scheduling_name="bitcast.23194.0"}
  %custom-call.1117 = (bf16[16384,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23194.0, %bitcast.23196.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="custom-call.1117"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23156.0 = bf16[6144,65536]{0,1} bitcast(%all-to-all-done.8), metadata={scheduling_name="bitcast.23156.0"}
  %get-tuple-element.3864 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=1, metadata={scheduling_name="get-tuple-element.3864"}
  %bitcast.23251.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3864), metadata={scheduling_name="bitcast.23251.0"}
  %custom-call.1113 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23156.0, %bitcast.23251.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1113"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23255.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3994), metadata={scheduling_name="bitcast.23255.0"}
  %custom-call.1118 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23251.0, %bitcast.23255.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="custom-call.1118"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23249.0 = bf16[16384,6144]{0,1} bitcast(%get-tuple-element.3995), metadata={scheduling_name="bitcast.23249.0"}
  %get-tuple-element.3863 = bf16[1,1,32,2048,16384]{4,3,2,1,0} get-tuple-element(%loop_convert_fusion.9), index=0, metadata={scheduling_name="get-tuple-element.3863"}
  %bitcast.23245.0 = bf16[65536,16384]{1,0} bitcast(%get-tuple-element.3863), metadata={scheduling_name="bitcast.23245.0"}
  %get-tuple-element.3787.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1118), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3787.0"}
  %cublas-lt-matmul.21 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23245.0, %bitcast.23249.0, %get-tuple-element.3787.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="cublas-lt-matmul.21"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"1073741824","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-to-all-done.9 = bf16[1,1,1,8,4,2048,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="all-to-all-done.9"}
  %get-tuple-element.3788.0 = bf16[65536,6144]{1,0} get-tuple-element(%cublas-lt-matmul.21), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3788.0"}
  %bitcast.23261.0 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} bitcast(%get-tuple-element.3788.0), metadata={scheduling_name="bitcast.23261.0"}
  %all-to-all-start.11 = ((bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2}), bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2}) async-start(%bitcast.23261.0), calls=%async_computation.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-start.11"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %custom-call.1114 = (bf16[6144,16384]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23156.0, %bitcast.23245.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="custom-call.1114"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"1073741824","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3999 = bf16[1,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=8, metadata={scheduling_name="get-tuple-element.3999"}
  %get-tuple-element.3786.0 = bf16[16384,6144]{1,0} get-tuple-element(%custom-call.1117), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wo/EBCH,EHM -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1439 scheduling_name="get-tuple-element.3786.0"}
  %loop_dynamic_update_slice_fusion.19 = bf16[2,1,1,16384,6144]{4,3,2,1,0} fusion(%get-tuple-element.4597, %get-tuple-element.3786.0, %get-tuple-element.3999, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.19, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.19" scheduling_name="loop_dynamic_update_slice_fusion.19"}
  %input_transpose_fusion.2 = bf16[4,6144,8,2048]{3,2,1,0} fusion(%all-to-all-done.9), kind=kInput, calls=%fused_transpose.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 deduplicated_name="input_transpose_fusion.2" scheduling_name="input_transpose_fusion.2"}
  %get-tuple-element.3997 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=6, metadata={scheduling_name="get-tuple-element.3997"}
  %get-tuple-element.3784.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1113), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_0/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1409 scheduling_name="get-tuple-element.3784.0"}
  %loop_dynamic_update_slice_fusion.17 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4595, %get-tuple-element.3997, %get-tuple-element.3784.0, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.17, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.17"}
  %bitcast.22678.0 = bf16[4,8192,6144]{2,1,0} bitcast(%loop_convert_fusion.13), metadata={scheduling_name="bitcast.22678.0"}
  %bitcast.22929.0 = bf16[4,6144,16384]{2,1,0} bitcast(%input_transpose_fusion.2), metadata={scheduling_name="bitcast.22929.0"}
  %custom-call.1109 = (bf16[4,8192,16384]{2,1,0}, s8[67108864]{0}) custom-call(%bitcast.22678.0, %bitcast.22929.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="custom-call.1109"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"50331648","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3998 = bf16[1,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.20), index=7, metadata={scheduling_name="get-tuple-element.3998"}
  %get-tuple-element.3785.0 = bf16[6144,16384]{1,0} get-tuple-element(%custom-call.1114), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/wi_1/EBCM,EMH -> EBCH/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1423 scheduling_name="get-tuple-element.3785.0"}
  %loop_dynamic_update_slice_fusion.18 = bf16[2,1,1,6144,16384]{4,3,2,1,0} fusion(%get-tuple-element.4596, %get-tuple-element.3998, %get-tuple-element.3785.0, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.18, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.17" scheduling_name="loop_dynamic_update_slice_fusion.18"}
  %get-tuple-element.3780.0 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%custom-call.1109), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/combine/EBCM,BSEC -> BSM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1460 scheduling_name="get-tuple-element.3780.0"}
  %input_transpose_fusion.1 = bf16[4,16392,8192]{2,1,0} fusion(%get-tuple-element.3780.0), kind=kInput, calls=%fused_transpose.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/pad" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1171 deduplicated_name="input_transpose_fusion.1" scheduling_name="input_transpose_fusion.1"}
  %input_reduce_fusion.13 = bf16[4,8,8192]{2,1,0} fusion(%get-tuple-element.3892, %input_transpose_fusion.1), kind=kInput, calls=%fused_reduce.13, metadata={deduplicated_name="input_reduce_fusion.13" scheduling_name="input_reduce_fusion.13"}
  %all-to-all-done.11 = bf16[1,1,8,4,1,2048,6144]{6,5,4,3,1,0,2} async-done(%all-to-all-start.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="all-to-all-done.11"}
  %collective-permute-start.5 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) collective-permute-start(%bitcast.24432.0), channel_id=372, source_target_pairs={{0,16},{1,17},{2,18},{3,19},{4,20},{5,21},{6,22},{7,23},{8,24},{9,25},{10,26},{11,27},{12,28},{13,29},{14,30},{15,31}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="collective-permute-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_select_fusion.1 = bf16[1,4,8192,2]{3,2,1,0} fusion(%loop_compare_fusion.6, %get-tuple-element.1277.0, %get-tuple-element.3894, %input_reduce_fusion.13, %constant_1758_0, /*index=5*/%constant_1739_0, %partition-id.3.0, %constant_1718_0), kind=kLoop, calls=%fused_select.1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/select_n" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 deduplicated_name="loop_select_fusion" scheduling_name="loop_select_fusion.1"}
  %get-tuple-element.3901 = s32[65536,4]{1,0} get-tuple-element(%loop_transpose_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.3901"}
  %input_scatter_fusion.4 = bf16[1,4,8192,8]{3,2,1,0} fusion(%loop_broadcast_fusion.3, %get-tuple-element.3901, %loop_select_fusion.1, %get-tuple-element.3837.0), kind=kInput, calls=%fused_scatter.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=375 deduplicated_name="input_scatter_fusion.4" scheduling_name="input_scatter_fusion.4"}
  %loop_dynamic_update_slice_fusion.34 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.32, %collective-permute-done.6, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.34, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=342 scheduling_name="loop_dynamic_update_slice_fusion.34"}
  %bitcast.23274.0 = bf16[8,6144]{0,1} bitcast(%get-tuple-element.4287), metadata={scheduling_name="bitcast.23274.0"}
  %bitcast.23270.0 = bf16[32768,8]{1,0} bitcast(%input_scatter_fusion.4), metadata={scheduling_name="bitcast.23270.0"}
  %custom-call.1119 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23270.0, %bitcast.23274.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1119"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"262144","rhs_stride":"49152","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_transpose_fusion.6 = bf16[4,8,12582912]{2,1,0} fusion(%all-to-all-done.11), kind=kLoop, calls=%fused_transpose.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 deduplicated_name="loop_transpose_fusion.6" scheduling_name="loop_transpose_fusion.6"}
  %get-tuple-element.3868 = bf16[4,8192,16384]{2,1,0} get-tuple-element(%input_convert_transpose_fusion.2), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/dot_general" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3868"}
  %get-tuple-element.3789.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1119), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3789.0"}
  %bitcast.23278.0 = bf16[4,8192,6144]{2,1,0} bitcast(%get-tuple-element.3789.0), metadata={scheduling_name="bitcast.23278.0"}
  %bitcast.23268.0 = bf16[4,16384,6144]{2,1,0} bitcast(%loop_transpose_fusion.6), metadata={scheduling_name="bitcast.23268.0"}
  %cublas-lt-matmul.22 = (bf16[4,8192,6144]{2,1,0}, s8[67108864]{0}) custom-call(%get-tuple-element.3868, %bitcast.23268.0, %bitcast.23278.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="cublas-lt-matmul.22"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["2"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":["0"],"rhs_batch_dimensions":["0"]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"134217728","rhs_stride":"100663296","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %collective-permute-done.5 = bf16[1,4,8192,6144]{3,2,1,0} collective-permute-done(%collective-permute-start.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="collective-permute-done.5"}
  %get-tuple-element.4259 = pred[1]{0} get-tuple-element(%loop_compare_fusion.11), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=293 scheduling_name="get-tuple-element.4259"}
  %get-tuple-element.4258 = pred[1]{0} get-tuple-element(%loop_compare_fusion.11), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/pad" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=294 scheduling_name="get-tuple-element.4258"}
  %loop_convert_fusion.12 = bf16[1,4,8192,6144]{3,2,1,0} fusion(%collective-permute-done.5, %collective-permute-done.4, %get-tuple-element.4258, %get-tuple-element.4259), kind=kLoop, calls=%fused_convert.12, metadata={scheduling_name="loop_convert_fusion.12"}
  %get-tuple-element.3790.0 = bf16[4,8192,6144]{2,1,0} get-tuple-element(%cublas-lt-matmul.22), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/dispatch/BSM,BSEC -> EBCM/transpose" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1388 scheduling_name="get-tuple-element.3790.0"}
  %input_reduce_fusion.5 = f32[4,8192]{1,0} fusion(%get-tuple-element.3790.0, %get-tuple-element.3754.0, %get-tuple-element.4687, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %copy.804), kind=kInput, calls=%fused_reduce.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 deduplicated_name="input_reduce_fusion.5" scheduling_name="input_reduce_fusion.5"}
  %loop_multiply_fusion.3 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.7, %input_reduce_fusion.5, %input_reduce_fusion.12), kind=kLoop, calls=%fused_multiply.3, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/post_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.3"}
  %input_add_convert_reduce_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, f32[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}, f32[128,6144]{1,0}) fusion(%loop_multiply_fusion.3, %get-tuple-element.3754.0, %loop_rsqrt_fusion.7, %get-tuple-element.4687, %get-tuple-element.3790.0, /*index=5*/%get-tuple-element.3875, %loop_multiply_fusion.2, %get-tuple-element.4677, %loop_rsqrt_fusion.5, %get-tuple-element.4698, /*index=10*/%constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, %get-tuple-element.3871), kind=kInput, calls=%fused_add_convert_reduce, metadata={scheduling_name="input_add_convert_reduce_fusion"}
  %bitcast.21362.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3907), metadata={scheduling_name="bitcast.21362.0"}
  %custom-call.1110 = (bf16[6144,8]{1,0}, s8[67108864]{0}) custom-call(%bitcast.21362.0, %bitcast.23270.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1110"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"262144","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23576.0 = bf16[6144,6144]{1,0} bitcast(%get-tuple-element.4286), metadata={scheduling_name="bitcast.23576.0"}
  %get-tuple-element.3860 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=0, metadata={scheduling_name="get-tuple-element.3860"}
  %bitcast.23572.0 = bf16[32768,6144]{1,0} bitcast(%get-tuple-element.3860), metadata={scheduling_name="bitcast.23572.0"}
  %custom-call.1123 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23572.0, %bitcast.23576.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1123"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23518.0 = u32[2,4]{1,0} bitcast(%loop_dynamic_slice_fusion.23), metadata={scheduling_name="bitcast.23518.0"}
  %bitcast.23509.0 = f32[1,4,48,8192,1]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.17), metadata={scheduling_name="bitcast.23509.0"}
  %bitcast.23522.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%loop_dynamic_slice_fusion.24), metadata={scheduling_name="bitcast.23522.0"}
  %get-tuple-element.3793.0 = bf16[32768,1024]{1,0} get-tuple-element(%custom-call.1122), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3793.0"}
  %bitcast.23496.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} bitcast(%get-tuple-element.3793.0), metadata={scheduling_name="bitcast.23496.0"}
  %get-tuple-element.3794.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1123), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3794.0"}
  %bitcast.23580.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} bitcast(%get-tuple-element.3794.0), metadata={scheduling_name="bitcast.23580.0"}
  %custom-call.991 = (bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, u8[1616904192]{0}) custom-call(%input_concatenate_fusion.7, %input_concatenate_fusion.11, %bitcast.23496.0, %constant_2152_0, %bitcast.23509.0, /*index=5*/%bitcast.23518.0, %bitcast.23522.0, %bitcast.23580.0, %loop_multiply_fusion.5, %loop_multiply_fusion.5, /*index=10*/%constant_2165_0, %constant_2165_0, %constant_2165_0, %constant_2165_0, %constant_2165_0, /*index=15*/%constant_2165_0), custom_call_target="te_fused_attn_backward_ffi", operand_layout_constraints={bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[1,4,8192,8,128]{4,3,2,1,0}, bf16[0]{0}, f32[1,4,48,8192,1]{4,3,2,1,0}, u32[2,4]{1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, bf16[1,4,8192,48,128]{4,3,2,1,0}, s32[65]{0}, s32[65]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}, f32[0]{0}}, api_version=API_VERSION_TYPED_FFI, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="custom-call.991"}, backend_config={attn_heads = 48 : i64, bias_batch = 0 : i64, bias_heads = 0 : i64, bias_type = 0 : i64, deterministic = false, dropout_probability = 0.000000e+00 : f64, input_batch = 4 : i64, is_training = true, kv_max_seqlen = 8192 : i64, mask_type = 2 : i64, max_segments_per_seq = 1 : i64, num_gqa_groups = 8 : i64, q_max_seqlen = 8192 : i64, qk_head_dim = 128 : i64, qkv_layout = 9 : i64, scaling_factor = 0.088388347648318433 : f64, v_head_dim = 128 : i64, window_size_left = -1 : i64, window_size_right = -1 : i64}
  %bitcast.23777.0 = bf16[6144,32768]{0,1} bitcast(%get-tuple-element.3860), metadata={scheduling_name="bitcast.23777.0"}
  %custom-call.1129 = (bf16[6144,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23777.0, %bitcast.23779.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1129"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1336.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1336.0"}
  %input_concatenate_fusion.9 = bf16[1,4,8192,8,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1336.0), kind=kInput, calls=%fused_concatenate.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.8" scheduling_name="input_concatenate_fusion.9"}
  %get-tuple-element.1337.0 = bf16[1,4,8192,48,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1337.0"}
  %input_concatenate_fusion.5 = bf16[1,4,8192,48,128]{4,3,2,1,0} fusion(%get-tuple-element.3873, %get-tuple-element.3872, %get-tuple-element.1337.0), kind=kInput, calls=%fused_concatenate.5, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/concatenate" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=306 deduplicated_name="input_concatenate_fusion.4" scheduling_name="input_concatenate_fusion.5"}
  %bitcast.23738.0 = bf16[1024,32768]{0,1} bitcast(%input_concatenate_fusion.9), metadata={scheduling_name="bitcast.23738.0"}
  %custom-call.1128 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23738.0, %bitcast.23853.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1128"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.1335.0 = bf16[1,4,8192,8,128]{4,3,2,1,0} get-tuple-element(%custom-call.991), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/DotProductAttention_0/_FusedDotProductAttention_0/custom_partitioning" source_file="/workspace/maxtext/MaxText/layers/attention_op.py" source_line=1148 scheduling_name="get-tuple-element.1335.0"}
  %bitcast.23851.0 = bf16[1024,32768]{0,1} bitcast(%get-tuple-element.1335.0), metadata={scheduling_name="bitcast.23851.0"}
  %custom-call.1131 = (bf16[1024,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23851.0, %bitcast.23853.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1131"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23634.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4289), metadata={scheduling_name="bitcast.23634.0"}
  %bitcast.23630.0 = bf16[32768,1024]{1,0} bitcast(%input_concatenate_fusion.9), metadata={scheduling_name="bitcast.23630.0"}
  %custom-call.1126 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23630.0, %bitcast.23634.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1126"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23681.0 = bf16[6144,6144]{0,1} bitcast(%get-tuple-element.4288), metadata={scheduling_name="bitcast.23681.0"}
  %bitcast.23677.0 = bf16[32768,6144]{1,0} bitcast(%input_concatenate_fusion.5), metadata={scheduling_name="bitcast.23677.0"}
  %custom-call.1127 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23677.0, %bitcast.23681.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1127"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"37748736","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23592.0 = bf16[1024,6144]{0,1} bitcast(%get-tuple-element.4290), metadata={scheduling_name="bitcast.23592.0"}
  %bitcast.23588.0 = bf16[32768,1024]{1,0} bitcast(%get-tuple-element.1335.0), metadata={scheduling_name="bitcast.23588.0"}
  %get-tuple-element.3795.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1126), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3795.0"}
  %cublas-lt-matmul.23 = (bf16[32768,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.23588.0, %bitcast.23592.0, %get-tuple-element.3795.0), custom_call_target="__cublas$lt$matmul", output_to_operand_aliasing={{0}: (2, {})}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="cublas-lt-matmul.23"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":1,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"33554432","rhs_stride":"6291456","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %bitcast.23815.0 = bf16[6144,32768]{0,1} bitcast(%input_concatenate_fusion.5), metadata={scheduling_name="bitcast.23815.0"}
  %custom-call.1130 = (bf16[6144,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.23815.0, %bitcast.23853.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1130"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"201326592","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3797.0 = bf16[32768,6144]{1,0} get-tuple-element(%custom-call.1127), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3797.0"}
  %get-tuple-element.3796.0 = bf16[32768,6144]{1,0} get-tuple-element(%cublas-lt-matmul.23), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3796.0"}
  %input_convert_reduce_fusion = (f32[4,8192]{1,0}, bf16[32768,6144]{1,0}) fusion(%get-tuple-element.4673, %copy.804, %get-tuple-element.4688, %constant_1663_0, %partition-id.3.0, /*index=5*/%get-tuple-element.4681, %get-tuple-element.3797.0, %get-tuple-element.3796.0), kind=kInput, calls=%fused_convert_reduce, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_convert_reduce_fusion"}
  %get-tuple-element.3862 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=2, metadata={scheduling_name="get-tuple-element.3862"}
  %input_reduce_fusion.18 = bf16[6144]{0} fusion(%get-tuple-element.3862), kind=kInput, calls=%fused_reduce.18, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.18"}
  %get-tuple-element.3858 = f32[4,8192]{1,0} get-tuple-element(%input_convert_reduce_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3858"}
  %loop_multiply_fusion.4 = f32[1,1,4,8192]{3,2,1,0} fusion(%loop_rsqrt_fusion.4, %get-tuple-element.3858, %input_reduce_fusion.6), kind=kLoop, calls=%fused_multiply.4, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 deduplicated_name="loop_multiply_fusion.1" scheduling_name="loop_multiply_fusion.4"}
  %get-tuple-element.3869 = f32[128,6144]{1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=3, metadata={scheduling_name="get-tuple-element.3869"}
  %input_reduce_fusion.15 = bf16[6144]{0} fusion(%get-tuple-element.3869), kind=kInput, calls=%fused_reduce.15, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.15"}
  %get-tuple-element.3861 = f32[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion), index=1, metadata={scheduling_name="get-tuple-element.3861"}
  %get-tuple-element.3859 = bf16[32768,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="get-tuple-element.3859"}
  %input_convert_reduce_select_fusion = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, f32[128,6144]{1,0}) fusion(%loop_compare_fusion.10, %get-tuple-element.3861, %loop_multiply_fusion.4, %get-tuple-element.4673, %loop_rsqrt_fusion.4, /*index=5*/%get-tuple-element.4688, %constant_1663_0, %partition-id.3.0, %get-tuple-element.4681, %copy.804, /*index=10*/%get-tuple-element.3859), kind=kInput, calls=%fused_convert_reduce_select, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="input_convert_reduce_select_fusion"}
  %get-tuple-element.3802.0 = bf16[6144,8]{1,0} get-tuple-element(%custom-call.1132), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3802.0"}
  %bitcast.32301 = bf16[6144,1,8]{2,1,0} bitcast(%get-tuple-element.3802.0), metadata={scheduling_name="bitcast.32301"}
  %get-tuple-element.3807.0 = bf16[6144,6144]{1,0} get-tuple-element(%custom-call.1139), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3807.0"}
  %bitcast.32303 = bf16[6144,1,48,128]{3,2,1,0} bitcast(%get-tuple-element.3807.0), metadata={scheduling_name="bitcast.32303"}
  %get-tuple-element.3806.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1138), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3806.0"}
  %bitcast.32302 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3806.0), metadata={scheduling_name="bitcast.32302"}
  %get-tuple-element.3809.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1141), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3809.0"}
  %bitcast.32305 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3809.0), metadata={scheduling_name="bitcast.32305"}
  %get-tuple-element.3808.0 = bf16[6144,6144]{0,1} get-tuple-element(%custom-call.1140), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3808.0"}
  %bitcast.32304 = bf16[6144,48,128,1]{2,1,3,0} bitcast(%get-tuple-element.3808.0), metadata={scheduling_name="bitcast.32304"}
  %get-tuple-element.3781.0 = bf16[6144,8]{1,0} get-tuple-element(%custom-call.1110), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3781.0"}
  %bitcast.32296 = bf16[6144,1,8]{2,1,0} bitcast(%get-tuple-element.3781.0), metadata={scheduling_name="bitcast.32296"}
  %get-tuple-element.3799.0 = bf16[6144,6144]{1,0} get-tuple-element(%custom-call.1129), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3799.0"}
  %bitcast.32298 = bf16[6144,1,48,128]{3,2,1,0} bitcast(%get-tuple-element.3799.0), metadata={scheduling_name="bitcast.32298"}
  %get-tuple-element.3798.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1128), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3798.0"}
  %bitcast.32297 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3798.0), metadata={scheduling_name="bitcast.32297"}
  %get-tuple-element.3801.0 = bf16[1024,6144]{0,1} get-tuple-element(%custom-call.1131), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3801.0"}
  %bitcast.32300 = bf16[6144,8,128,1]{2,1,3,0} bitcast(%get-tuple-element.3801.0), metadata={scheduling_name="bitcast.32300"}
  %get-tuple-element.3800.0 = bf16[6144,6144]{0,1} get-tuple-element(%custom-call.1130), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3800.0"}
  %bitcast.32299 = bf16[6144,48,128,1]{2,1,3,0} bitcast(%get-tuple-element.3800.0), metadata={scheduling_name="bitcast.32299"}
  %reduce-scatter-start = ((bf16[6144,1,8]{2,1,0}, bf16[6144,8,128,1]{2,1,3,0}, bf16[6144,1,48,128]{3,2,1,0}, bf16[6144,48,128,1]{2,1,3,0}, bf16[6144,8,128,1]{2,1,3,0}, /*index=5*/bf16[6144,1,8]{2,1,0}, bf16[6144,8,128,1]{2,1,3,0}, bf16[6144,1,48,128]{3,2,1,0}, bf16[6144,48,128,1]{2,1,3,0}, bf16[6144,8,128,1]{2,1,3,0}), (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0})) async-start(%bitcast.32296, %bitcast.32297, %bitcast.32298, %bitcast.32299, %bitcast.32300, /*index=5*/%bitcast.32301, %bitcast.32302, %bitcast.32303, %bitcast.32304, %bitcast.32305), calls=%async_computation.12, metadata={scheduling_name="reduce-scatter-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3917 = pred[] get-tuple-element(%loop_compare_reduce_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=183 scheduling_name="get-tuple-element.3917"}
  %get-tuple-element.3856 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.3856"}
  %loop_dynamic_update_slice_fusion.35 = bf16[1,2,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.34, %get-tuple-element.3856, %loop_compare_fusion.10, %get-tuple-element.3917, %get-tuple-element.4681, /*index=5*/%copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.35, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=169 scheduling_name="loop_dynamic_update_slice_fusion.35"}
  %copy.853 = bf16[1,2,4,8192,6144]{4,3,2,1,0} copy(%loop_dynamic_update_slice_fusion.35), metadata={scheduling_name="copy.853"}
  %loop_dynamic_update_slice_fusion.33 = bf16[1,4,4,8192,6144]{4,3,2,1,0} fusion(%loop_dynamic_update_slice_fusion.31, %get-tuple-element.3856, %loop_compare_fusion.10, %get-tuple-element.3917, %get-tuple-element.4681, /*index=5*/%copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.33, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=175 scheduling_name="loop_dynamic_update_slice_fusion.33"}
  %copy.850 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%loop_dynamic_update_slice_fusion.33), metadata={scheduling_name="copy.850"}
  %get-tuple-element.3857 = f32[128,6144]{1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=2, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.3857"}
  %input_reduce_fusion.17 = bf16[6144]{0} fusion(%get-tuple-element.3857), kind=kInput, calls=%fused_reduce.17, metadata={deduplicated_name="input_reduce_fusion.15" scheduling_name="input_reduce_fusion.17"}
  %get-tuple-element.3926 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=6, metadata={scheduling_name="get-tuple-element.3926"}
  %loop_dynamic_update_slice_fusion.13 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4598, %get-tuple-element.3926, %input_reduce_fusion.18, %get-tuple-element.3918, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.13, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.13"}
  %get-tuple-element.3925 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=5, metadata={scheduling_name="get-tuple-element.3925"}
  %loop_dynamic_update_slice_fusion.16 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4609, %get-tuple-element.3925, %input_reduce_fusion.15, %get-tuple-element.3918, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.16, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.16"}
  %get-tuple-element.3927 = bf16[1,1,6144]{2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=7, metadata={scheduling_name="get-tuple-element.3927"}
  %loop_dynamic_update_slice_fusion.14 = bf16[2,1,6144]{2,1,0} fusion(%get-tuple-element.4599, %get-tuple-element.3927, %input_reduce_fusion.17, %get-tuple-element.3918, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.13" scheduling_name="loop_dynamic_update_slice_fusion.14"}
  %reduce-scatter-done = (bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}, /*index=5*/bf16[768,1,8]{2,1,0}, bf16[768,8,128,1]{2,1,3,0}, bf16[768,1,48,128]{3,2,1,0}, bf16[768,48,128,1]{2,1,3,0}, bf16[768,8,128,1]{2,1,3,0}) async-done(%reduce-scatter-start), metadata={scheduling_name="reduce-scatter-done"}
  %get-tuple-element.3921 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=1, metadata={scheduling_name="get-tuple-element.3921"}
  %get-tuple-element.4394 = bf16[768,1,8]{2,1,0} get-tuple-element(%reduce-scatter-done), index=0, metadata={scheduling_name="get-tuple-element.4394"}
  %bitcast.32306 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.4394), metadata={scheduling_name="bitcast.32306"}
  %loop_dynamic_update_slice_fusion.29 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4594, %get-tuple-element.3921, %bitcast.32306, %input_reduce_fusion.19, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.29, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.29" scheduling_name="loop_dynamic_update_slice_fusion.29"}
  %get-tuple-element.3922 = bf16[1,1,768,8]{3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.19), index=2, metadata={scheduling_name="get-tuple-element.3922"}
  %get-tuple-element.4399 = bf16[768,1,8]{2,1,0} get-tuple-element(%reduce-scatter-done), index=5, metadata={scheduling_name="get-tuple-element.4399"}
  %bitcast.32311 = bf16[1,768,8]{2,0,1} bitcast(%get-tuple-element.4399), metadata={scheduling_name="bitcast.32311"}
  %loop_dynamic_update_slice_fusion.30 = bf16[2,1,768,8]{3,2,1,0} fusion(%get-tuple-element.4604, %get-tuple-element.3922, %bitcast.32311, %input_reduce_fusion.19, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.30, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.29" scheduling_name="loop_dynamic_update_slice_fusion.30"}
  %get-tuple-element.3916 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=7, metadata={scheduling_name="get-tuple-element.3916"}
  %get-tuple-element.4398 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=4, metadata={scheduling_name="get-tuple-element.4398"}
  %bitcast.32310 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4398), metadata={scheduling_name="bitcast.32310"}
  %loop_dynamic_update_slice_fusion.22 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4603, %get-tuple-element.3916, %bitcast.32310, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.22, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.22"}
  %get-tuple-element.3990 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=7, metadata={scheduling_name="get-tuple-element.3990"}
  %get-tuple-element.4397 = bf16[768,48,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=3, metadata={scheduling_name="get-tuple-element.4397"}
  %bitcast.32309 = bf16[1,48,128,768]{2,1,0,3} bitcast(%get-tuple-element.4397), metadata={scheduling_name="bitcast.32309"}
  %loop_dynamic_update_slice_fusion.21 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4602, %get-tuple-element.3990, %bitcast.32309, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.21, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.21" scheduling_name="loop_dynamic_update_slice_fusion.21"}
  %get-tuple-element.3909 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=0, metadata={scheduling_name="get-tuple-element.3909"}
  %get-tuple-element.4400 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=6, metadata={scheduling_name="get-tuple-element.4400"}
  %bitcast.32312 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4400), metadata={scheduling_name="bitcast.32312"}
  %loop_dynamic_update_slice_fusion.26 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4610, %get-tuple-element.3909, %bitcast.32312, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.26, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.26"}
  %get-tuple-element.3989 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=6, metadata={scheduling_name="get-tuple-element.3989"}
  %get-tuple-element.4396 = bf16[768,1,48,128]{3,2,1,0} get-tuple-element(%reduce-scatter-done), index=2, metadata={scheduling_name="get-tuple-element.4396"}
  %bitcast.32308 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.4396), metadata={scheduling_name="bitcast.32308"}
  %loop_dynamic_update_slice_fusion.12 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4601, %get-tuple-element.3989, %bitcast.32308, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.12, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.11" scheduling_name="loop_dynamic_update_slice_fusion.12"}
  %get-tuple-element.3929 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.3929"}
  %get-tuple-element.4402 = bf16[768,48,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=8, metadata={scheduling_name="get-tuple-element.4402"}
  %bitcast.32314 = bf16[1,48,128,768]{2,1,0,3} bitcast(%get-tuple-element.4402), metadata={scheduling_name="bitcast.32314"}
  %loop_dynamic_update_slice_fusion.27 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4612, %get-tuple-element.3929, %bitcast.32314, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.27, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.21" scheduling_name="loop_dynamic_update_slice_fusion.27"}
  %get-tuple-element.3928 = bf16[1,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.3928"}
  %get-tuple-element.4401 = bf16[768,1,48,128]{3,2,1,0} get-tuple-element(%reduce-scatter-done), index=7, metadata={scheduling_name="get-tuple-element.4401"}
  %bitcast.32313 = bf16[1,768,48,128]{3,2,0,1} bitcast(%get-tuple-element.4401), metadata={scheduling_name="bitcast.32313"}
  %loop_dynamic_update_slice_fusion.11 = bf16[2,1,768,48,128]{4,3,2,1,0} fusion(%get-tuple-element.4611, %get-tuple-element.3928, %bitcast.32313, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.11" scheduling_name="loop_dynamic_update_slice_fusion.11"}
  %get-tuple-element.3910 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=1, metadata={scheduling_name="get-tuple-element.3910"}
  %get-tuple-element.4403 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=9, metadata={scheduling_name="get-tuple-element.4403"}
  %bitcast.32315 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4403), metadata={scheduling_name="bitcast.32315"}
  %loop_dynamic_update_slice_fusion.28 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4613, %get-tuple-element.3910, %bitcast.32315, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.28, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.28"}
  %get-tuple-element.3915 = bf16[1,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_dynamic_slice_fusion.21), index=6, metadata={scheduling_name="get-tuple-element.3915"}
  %get-tuple-element.4395 = bf16[768,8,128,1]{2,1,3,0} get-tuple-element(%reduce-scatter-done), index=1, metadata={scheduling_name="get-tuple-element.4395"}
  %bitcast.32307 = bf16[1,8,128,768]{2,1,0,3} bitcast(%get-tuple-element.4395), metadata={scheduling_name="bitcast.32307"}
  %loop_dynamic_update_slice_fusion.20 = bf16[2,1,768,8,128]{4,3,2,1,0} fusion(%get-tuple-element.4600, %get-tuple-element.3915, %bitcast.32307, %get-tuple-element.3919, %constant_1663_0, /*index=5*/%partition-id.3.0, %get-tuple-element.4681, %copy.804), kind=kLoop, calls=%fused_dynamic_update_slice.20, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/add_any" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_dynamic_update_slice_fusion.20" scheduling_name="loop_dynamic_update_slice_fusion.20"}
  %bitcast.23799.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%loop_dynamic_update_slice_fusion.12), metadata={scheduling_name="bitcast.23799.0"}
  %bitcast.24169.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%loop_dynamic_update_slice_fusion.11), metadata={scheduling_name="bitcast.24169.0"}
  %get-tuple-element.4671 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%input_convert_reduce_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/rematted_computation/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=348 scheduling_name="get-tuple-element.4671"}
  ROOT %tuple.670 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%loop_add_fusion.1, %loop_dynamic_update_slice_fusion.29, %loop_dynamic_update_slice_fusion.17, %loop_dynamic_update_slice_fusion.18, %loop_dynamic_update_slice_fusion.19, /*index=5*/%loop_dynamic_update_slice_fusion.13, %loop_dynamic_update_slice_fusion.14, %loop_dynamic_update_slice_fusion.20, %bitcast.23799.0, %loop_dynamic_update_slice_fusion.21, /*index=10*/%loop_dynamic_update_slice_fusion.22, %loop_dynamic_update_slice_fusion.30, %loop_dynamic_update_slice_fusion.23, %loop_dynamic_update_slice_fusion.24, %loop_dynamic_update_slice_fusion.25, /*index=15*/%loop_dynamic_update_slice_fusion.15, %loop_dynamic_update_slice_fusion.16, %loop_dynamic_update_slice_fusion.26, %bitcast.24169.0, %loop_dynamic_update_slice_fusion.27, /*index=20*/%loop_dynamic_update_slice_fusion.28, %copy.850, %loop_convert_fusion.12, %get-tuple-element.4671, %copy.853, /*index=25*/%get-tuple-element.4673, %get-tuple-element.4674, %get-tuple-element.4675, %get-tuple-element.4676, %get-tuple-element.4677, /*index=30*/%get-tuple-element.4678, %get-tuple-element.4679, %get-tuple-element.4680, %get-tuple-element.4681, %get-tuple-element.4682, /*index=35*/%get-tuple-element.4683, %get-tuple-element.4684, %get-tuple-element.4685, %get-tuple-element.4686, %get-tuple-element.4687, /*index=40*/%get-tuple-element.4688, %get-tuple-element.4689, %get-tuple-element.4690, %get-tuple-element.4691, %get-tuple-element.4692, /*index=45*/%get-tuple-element.4693, %get-tuple-element.4694, %get-tuple-element.4695, %get-tuple-element.4696, %get-tuple-element.4697, /*index=50*/%get-tuple-element.4698, %get-tuple-element.4699, %get-tuple-element.4700, %get-tuple-element.4701, %get-tuple-element.4702), metadata={scheduling_name="tuple.670"}
}

%fused_compare (param_0: s32[]) -> pred[] {
  %param_0 = s32[] parameter(0), metadata={scheduling_name="param_0"}
  %constant_1635_1 = s32[] constant(9)
  ROOT %compare.1580.1 = pred[] compare(%param_0, %constant_1635_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="compare.1580.1"}
}

%region_97.4035_spmd (param.2: (s32[], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=5*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=10*/bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], /*index=15*/bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], /*index=20*/bf16[2,1,768,8,128], bf16[1,4,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,2,4,8192,6144], /*index=25*/bf16[9,1,4,8192,6144], f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,6144], /*index=30*/f32[9,1,4,48,8192,1], u32[9,2,4], bf16[9,1,4,8192,48,128], s32[9], s32[4,4,8192], /*index=35*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=40*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=45*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=50*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128])) -> pred[] {
  %param.2 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) parameter(0), metadata={scheduling_name="param.2"}
  %get-tuple-element.1265.0 = s32[] get-tuple-element(%param.2), index=0, metadata={scheduling_name="get-tuple-element.1265.0"}
  ROOT %loop_compare_fusion = pred[] fusion(%get-tuple-element.1265.0), kind=kLoop, calls=%fused_compare, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/cond/lt" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 deduplicated_name="loop_compare_fusion" scheduling_name="loop_compare_fusion"}
}

%fused_reduce.20 (param_0.5985: f32[768,32768]) -> f32[4096] {
  %param_0.5985 = f32[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5985"}
  %multiply.3012.1 = f32[768,32768]{1,0} multiply(%param_0.5985, %param_0.5985), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3012.1"}
  %bitcast.30341.1 = f32[4096,6144]{1,0} bitcast(%multiply.3012.1), metadata={scheduling_name="bitcast.30341.1"}
  %constant_3026_136 = f32[] constant(0)
  ROOT %reduce.699.1 = f32[4096]{0} reduce(%bitcast.30341.1, %constant_3026_136), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.699.1"}
}

%fused_convert_reduce.2 (param_0.5874: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5874 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5874"}
  %multiply.3007.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5874, %param_0.5874), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3007.1"}
  %bitcast.30255.1 = f32[12288]{0} bitcast(%multiply.3007.1), metadata={scheduling_name="bitcast.30255.1"}
  %constant_3026_25 = f32[] constant(0)
  %reduce.249.1 = f32[] reduce(%bitcast.30255.1, %constant_3026_25), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.249.1"}
  %convert.4802.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5874), metadata={scheduling_name="convert.4802.1"}
  ROOT %tuple.566 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.249.1, %convert.4802.1), metadata={scheduling_name="tuple.566"}
}

%fused_convert_reduce.3 (param_0.5873: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5873 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5873"}
  %multiply.3006.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5873, %param_0.5873), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3006.1"}
  %bitcast.30241.1 = f32[12288]{0} bitcast(%multiply.3006.1), metadata={scheduling_name="bitcast.30241.1"}
  %constant_3026_24 = f32[] constant(0)
  %reduce.248.1 = f32[] reduce(%bitcast.30241.1, %constant_3026_24), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.248.1"}
  %convert.4782.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5873), metadata={scheduling_name="convert.4782.1"}
  ROOT %tuple.570 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.248.1, %convert.4782.1), metadata={scheduling_name="tuple.570"}
}

%fused_reduce.21 (param_0.5862: f32[24576]) -> f32[128] {
  %param_0.5862 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5862"}
  %bitcast.30227.1 = f32[128,192]{1,0} bitcast(%param_0.5862), metadata={scheduling_name="bitcast.30227.1"}
  %constant_3026_13 = f32[] constant(0)
  ROOT %reduce.735.1 = f32[128]{0} reduce(%bitcast.30227.1, %constant_3026_13), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.735.1"}
}

%fused_reduce.22 (param_0.5860: f32[24576]) -> f32[128] {
  %param_0.5860 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5860"}
  %bitcast.30205.1 = f32[128,192]{1,0} bitcast(%param_0.5860), metadata={scheduling_name="bitcast.30205.1"}
  %constant_3026_11 = f32[] constant(0)
  ROOT %reduce.733.1 = f32[128]{0} reduce(%bitcast.30205.1, %constant_3026_11), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.733.1"}
}

%fused_reduce.23 (param_0.5859: f32[24576]) -> f32[128] {
  %param_0.5859 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5859"}
  %bitcast.30183.1 = f32[128,192]{1,0} bitcast(%param_0.5859), metadata={scheduling_name="bitcast.30183.1"}
  %constant_3026_10 = f32[] constant(0)
  ROOT %reduce.731.1 = f32[128]{0} reduce(%bitcast.30183.1, %constant_3026_10), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.731.1"}
}

%fused_convert_reduce.4 (param_0.5869: f32[2,1,768,8]) -> (f32[], bf16[2,1,768,8]) {
  %param_0.5869 = f32[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5869"}
  %multiply.3001.1 = f32[2,1,768,8]{3,2,1,0} multiply(%param_0.5869, %param_0.5869), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3001.1"}
  %bitcast.30161.1 = f32[12288]{0} bitcast(%multiply.3001.1), metadata={scheduling_name="bitcast.30161.1"}
  %constant_3026_20 = f32[] constant(0)
  %reduce.244.1 = f32[] reduce(%bitcast.30161.1, %constant_3026_20), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.244.1"}
  %convert.4685.1 = bf16[2,1,768,8]{3,2,1,0} convert(%param_0.5869), metadata={scheduling_name="convert.4685.1"}
  ROOT %tuple.583 = (f32[], bf16[2,1,768,8]{3,2,1,0}) tuple(%reduce.244.1, %convert.4685.1), metadata={scheduling_name="tuple.583"}
}

%fused_convert_reduce.5 (param_0.5858: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5858 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5858"}
  %multiply.2995.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5858, %param_0.5858), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2995.1"}
  %bitcast.30075.1 = f32[12288]{0} bitcast(%multiply.2995.1), metadata={scheduling_name="bitcast.30075.1"}
  %constant_3026_9 = f32[] constant(0)
  %reduce.239.1 = f32[] reduce(%bitcast.30075.1, %constant_3026_9), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.239.1"}
  %convert.4554.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5858), metadata={scheduling_name="convert.4554.1"}
  ROOT %tuple.599 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.239.1, %convert.4554.1), metadata={scheduling_name="tuple.599"}
}

%fused_convert_reduce.6 (param_0.5861: f32[2,1,6144]) -> (f32[], bf16[2,1,6144]) {
  %param_0.5861 = f32[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5861"}
  %multiply.2994.1 = f32[2,1,6144]{2,1,0} multiply(%param_0.5861, %param_0.5861), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2994.1"}
  %bitcast.30061.1 = f32[12288]{0} bitcast(%multiply.2994.1), metadata={scheduling_name="bitcast.30061.1"}
  %constant_3026_12 = f32[] constant(0)
  %reduce.238.1 = f32[] reduce(%bitcast.30061.1, %constant_3026_12), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.238.1"}
  %convert.4534.1 = bf16[2,1,6144]{2,1,0} convert(%param_0.5861), metadata={scheduling_name="convert.4534.1"}
  ROOT %tuple.603 = (f32[], bf16[2,1,6144]{2,1,0}) tuple(%reduce.238.1, %convert.4534.1), metadata={scheduling_name="tuple.603"}
}

%fused_reduce.24 (param_0.5857: f32[24576]) -> f32[128] {
  %param_0.5857 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5857"}
  %bitcast.30047.1 = f32[128,192]{1,0} bitcast(%param_0.5857), metadata={scheduling_name="bitcast.30047.1"}
  %constant_3026_8 = f32[] constant(0)
  ROOT %reduce.729.1 = f32[128]{0} reduce(%bitcast.30047.1, %constant_3026_8), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.729.1"}
}

%fused_reduce.25 (param_0.5850: f32[24576]) -> f32[128] {
  %param_0.5850 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5850"}
  %bitcast.30025.1 = f32[128,192]{1,0} bitcast(%param_0.5850), metadata={scheduling_name="bitcast.30025.1"}
  %constant_3026_1 = f32[] constant(0)
  ROOT %reduce.727.1 = f32[128]{0} reduce(%bitcast.30025.1, %constant_3026_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.727.1"}
}

%fused_reduce.26 (param_0.5853: f32[24576]) -> f32[128] {
  %param_0.5853 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5853"}
  %bitcast.30003.1 = f32[128,192]{1,0} bitcast(%param_0.5853), metadata={scheduling_name="bitcast.30003.1"}
  %constant_3026_4 = f32[] constant(0)
  ROOT %reduce.725.1 = f32[128]{0} reduce(%bitcast.30003.1, %constant_3026_4), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.725.1"}
}

%fused_convert_reduce.7 (param_0.5933: f32[2,1,768,8]) -> (f32[], bf16[2,1,768,8]) {
  %param_0.5933 = f32[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5933"}
  %multiply.2988.1 = f32[2,1,768,8]{3,2,1,0} multiply(%param_0.5933, %param_0.5933), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2988.1"}
  %bitcast.29981.1 = f32[12288]{0} bitcast(%multiply.2988.1), metadata={scheduling_name="bitcast.29981.1"}
  %constant_3026_84 = f32[] constant(0)
  %reduce.234.1 = f32[] reduce(%bitcast.29981.1, %constant_3026_84), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.234.1"}
  %convert.4454.1 = bf16[2,1,768,8]{3,2,1,0} convert(%param_0.5933), metadata={scheduling_name="convert.4454.1"}
  ROOT %tuple.616 = (f32[], bf16[2,1,768,8]{3,2,1,0}) tuple(%reduce.234.1, %convert.4454.1), metadata={scheduling_name="tuple.616"}
}

%fused_reduce.27 (param_0.5969: f32[8,8192], param_1.6350: f32[65536], param_2.4512: f32[8,8192], param_3.3693: s32[8,8192]) -> f32[256] {
  %param_3.3693 = s32[8,8192]{1,0} parameter(3), metadata={scheduling_name="param_3.3693"}
  %constant_2984_3 = s32[] constant(0)
  %broadcast.5804.5 = s32[8,8192]{1,0} broadcast(%constant_2984_3), dimensions={}, metadata={scheduling_name="broadcast.5804.5"}
  %compare.1723.5 = pred[8,8192]{1,0} compare(%param_3.3693, %broadcast.5804.5), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.5"}
  %param_2.4512 = f32[8,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.4512"}
  %negate.230.3 = f32[8,8192]{1,0} negate(%param_2.4512), metadata={op_name="jit(train_step)/jit(main)/neg" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="negate.230.3"}
  %param_0.5969 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5969"}
  %param_1.6350 = f32[65536]{0} parameter(1), metadata={scheduling_name="param_1.6350"}
  %bitcast.26607.24 = f32[8,8192]{1,0} bitcast(%param_1.6350), metadata={scheduling_name="bitcast.26607.24"}
  %add.3114.7 = f32[8,8192]{1,0} add(%param_0.5969, %bitcast.26607.24), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="add.3114.7"}
  %multiply.2984.7 = f32[8,8192]{1,0} multiply(%add.3114.7, %add.3114.7), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=618 scheduling_name="multiply.2984.7"}
  %constant_3026_120 = f32[] constant(0)
  %broadcast.5806.14 = f32[8,8192]{1,0} broadcast(%constant_3026_120), dimensions={}, metadata={scheduling_name="broadcast.5806.14"}
  %multiply.2985.7 = f32[8,8192]{1,0} multiply(%multiply.2984.7, %broadcast.5806.14), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=618 scheduling_name="multiply.2985.7"}
  %add.3283.5 = f32[8,8192]{1,0} add(%negate.230.3, %multiply.2985.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=619 scheduling_name="add.3283.5"}
  %select.1394.3 = f32[8,8192]{1,0} select(%compare.1723.5, %add.3283.5, %broadcast.5806.14), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="select.1394.3"}
  %bitcast.29942.1 = f32[256,256]{1,0} bitcast(%select.1394.3), metadata={scheduling_name="bitcast.29942.1"}
  ROOT %reduce.667.1 = f32[256]{0} reduce(%bitcast.29942.1, %constant_3026_120), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="reduce.667.1"}
}

%fused_reduce.28 (param_0.5967: bf16[768,32768]) -> f32[4096] {
  %param_0.5967 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5967"}
  %convert.4893.4 = f32[768,32768]{1,0} convert(%param_0.5967), metadata={scheduling_name="convert.4893.4"}
  %multiply.2978.3 = f32[768,32768]{1,0} multiply(%convert.4893.4, %convert.4893.4), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2978.3"}
  %bitcast.29894.1 = f32[4096,6144]{1,0} bitcast(%multiply.2978.3), metadata={scheduling_name="bitcast.29894.1"}
  %constant_3026_118 = f32[] constant(0)
  ROOT %reduce.663.1 = f32[4096]{0} reduce(%bitcast.29894.1, %constant_3026_118), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.663.1"}
}

%fused_reduce.29 (param_0.5855: f32[24576]) -> f32[128] {
  %param_0.5855 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5855"}
  %bitcast.29787.1 = f32[128,192]{1,0} bitcast(%param_0.5855), metadata={scheduling_name="bitcast.29787.1"}
  %constant_3026_6 = f32[] constant(0)
  ROOT %reduce.723.1 = f32[128]{0} reduce(%bitcast.29787.1, %constant_3026_6), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.723.1"}
}

%fused_reduce.30 (param_0.5856: f32[24576]) -> f32[128] {
  %param_0.5856 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5856"}
  %bitcast.29766.1 = f32[128,192]{1,0} bitcast(%param_0.5856), metadata={scheduling_name="bitcast.29766.1"}
  %constant_3026_7 = f32[] constant(0)
  ROOT %reduce.721.1 = f32[128]{0} reduce(%bitcast.29766.1, %constant_3026_7), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.721.1"}
}

%fused_reduce.31 (param_0.5854: f32[24576]) -> f32[128] {
  %param_0.5854 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5854"}
  %bitcast.29745.1 = f32[128,192]{1,0} bitcast(%param_0.5854), metadata={scheduling_name="bitcast.29745.1"}
  %constant_3026_5 = f32[] constant(0)
  ROOT %reduce.719.1 = f32[128]{0} reduce(%bitcast.29745.1, %constant_3026_5), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.719.1"}
}

%fused_reduce.32 (param_0.5994: f32[24576]) -> f32[128] {
  %param_0.5994 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5994"}
  %bitcast.29617.1 = f32[128,192]{1,0} bitcast(%param_0.5994), metadata={scheduling_name="bitcast.29617.1"}
  %constant_3026_145 = f32[] constant(0)
  ROOT %reduce.717.1 = f32[128]{0} reduce(%bitcast.29617.1, %constant_3026_145), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.717.1"}
}

%fused_reduce.33 (param_0.5993: f32[24576]) -> f32[128] {
  %param_0.5993 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5993"}
  %bitcast.29596.1 = f32[128,192]{1,0} bitcast(%param_0.5993), metadata={scheduling_name="bitcast.29596.1"}
  %constant_3026_144 = f32[] constant(0)
  ROOT %reduce.715.1 = f32[128]{0} reduce(%bitcast.29596.1, %constant_3026_144), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.715.1"}
}

%fused_reduce.34 (param_0.5992: f32[24576]) -> f32[128] {
  %param_0.5992 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5992"}
  %bitcast.29575.1 = f32[128,192]{1,0} bitcast(%param_0.5992), metadata={scheduling_name="bitcast.29575.1"}
  %constant_3026_143 = f32[] constant(0)
  ROOT %reduce.713.1 = f32[128]{0} reduce(%bitcast.29575.1, %constant_3026_143), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.713.1"}
}

%fused_reduce.35 (param_0.5951: bf16[32768,768]) -> f32[4096] {
  %param_0.5951 = bf16[32768,768]{0,1} parameter(0), metadata={scheduling_name="param_0.5951"}
  %bitcast.27413.10 = bf16[768,32768]{1,0} bitcast(%param_0.5951), metadata={scheduling_name="bitcast.27413.10"}
  %convert.4390.9 = f32[768,32768]{1,0} convert(%bitcast.27413.10), metadata={scheduling_name="convert.4390.9"}
  %multiply.2788.3 = f32[768,32768]{1,0} multiply(%convert.4390.9, %convert.4390.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2788.3"}
  %bitcast.27423.1 = f32[4096,6144]{1,0} bitcast(%multiply.2788.3), metadata={scheduling_name="bitcast.27423.1"}
  %constant_3026_102 = f32[] constant(0)
  ROOT %reduce.631.1 = f32[4096]{0} reduce(%bitcast.27423.1, %constant_3026_102), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.631.1"}
}

%fused_reduce.36 (param_0.5950: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5950 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5950"}
  %convert.4388.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5950), metadata={scheduling_name="convert.4388.4"}
  %multiply.2787.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4388.4, %convert.4388.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2787.3"}
  %bitcast.27381.1 = f32[1024,1536]{1,0} bitcast(%multiply.2787.3), metadata={scheduling_name="bitcast.27381.1"}
  %constant_3026_101 = f32[] constant(0)
  ROOT %reduce.629.1 = f32[1024]{0} reduce(%bitcast.27381.1, %constant_3026_101), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.629.1"}
}

%fused_reduce.37 (param_0.5949: bf16[2,1,768,48,128]) -> f32[2048] {
  %param_0.5949 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5949"}
  %convert.4386.6 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.5949), metadata={scheduling_name="convert.4386.6"}
  %multiply.2786.3 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4386.6, %convert.4386.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2786.3"}
  %bitcast.27357.1 = f32[2048,4608]{1,0} bitcast(%multiply.2786.3), metadata={scheduling_name="bitcast.27357.1"}
  %constant_3026_100 = f32[] constant(0)
  ROOT %reduce.627.1 = f32[2048]{0} reduce(%bitcast.27357.1, %constant_3026_100), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.627.1"}
}

%fused_reduce.38 (param_0.5948: bf16[2,1,48,128,768]) -> f32[2048] {
  %param_0.5948 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5948"}
  %convert.4384.6 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.5948), metadata={scheduling_name="convert.4384.6"}
  %multiply.2785.3 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4384.6, %convert.4384.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2785.3"}
  %bitcast.27333.1 = f32[2048,4608]{1,0} bitcast(%multiply.2785.3), metadata={scheduling_name="bitcast.27333.1"}
  %constant_3026_99 = f32[] constant(0)
  ROOT %reduce.625.1 = f32[2048]{0} reduce(%bitcast.27333.1, %constant_3026_99), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.625.1"}
}

%fused_transpose.20 (param_0.3489: bf16[2,1,48,128,768]) -> bf16[2,6144,768] {
  %param_0.3489 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3489"}
  %bitcast.27316.1 = bf16[2,768,6144]{2,1,0} bitcast(%param_0.3489), metadata={scheduling_name="bitcast.27316.1"}
  ROOT %transpose.769.1 = bf16[2,6144,768]{2,1,0} transpose(%bitcast.27316.1), dimensions={0,2,1}, metadata={scheduling_name="transpose.769.1"}
}

%fused_reduce.39 (param_0.5947: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5947 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5947"}
  %convert.4382.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5947), metadata={scheduling_name="convert.4382.4"}
  %multiply.2784.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4382.4, %convert.4382.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2784.3"}
  %bitcast.27304.1 = f32[1024,1536]{1,0} bitcast(%multiply.2784.3), metadata={scheduling_name="bitcast.27304.1"}
  %constant_3026_98 = f32[] constant(0)
  ROOT %reduce.623.1 = f32[1024]{0} reduce(%bitcast.27304.1, %constant_3026_98), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.623.1"}
}

%fused_reduce.40 (param_0.5897: bf16[2,1,6144]) -> f32[] {
  %param_0.5897 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5897"}
  %convert.4380.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5897), metadata={scheduling_name="convert.4380.4"}
  %multiply.2783.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4380.4, %convert.4380.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2783.3"}
  %bitcast.27282.1 = f32[12288]{0} bitcast(%multiply.2783.3), metadata={scheduling_name="bitcast.27282.1"}
  %constant_3026_48 = f32[] constant(0)
  ROOT %reduce.201.1 = f32[] reduce(%bitcast.27282.1, %constant_3026_48), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.201.1"}
}

%fused_reduce.41 (param_0.5896: bf16[2,1,6144]) -> f32[] {
  %param_0.5896 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5896"}
  %convert.4378.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5896), metadata={scheduling_name="convert.4378.4"}
  %multiply.2782.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4378.4, %convert.4378.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2782.3"}
  %bitcast.27262.1 = f32[12288]{0} bitcast(%multiply.2782.3), metadata={scheduling_name="bitcast.27262.1"}
  %constant_3026_47 = f32[] constant(0)
  ROOT %reduce.200.1 = f32[] reduce(%bitcast.27262.1, %constant_3026_47), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.200.1"}
}

%fused_reduce.42 (param_0.5991: f32[24576]) -> f32[128] {
  %param_0.5991 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5991"}
  %bitcast.27242.1 = f32[128,192]{1,0} bitcast(%param_0.5991), metadata={scheduling_name="bitcast.27242.1"}
  %constant_3026_142 = f32[] constant(0)
  ROOT %reduce.711.1 = f32[128]{0} reduce(%bitcast.27242.1, %constant_3026_142), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.711.1"}
}

%fused_reduce.43 (param_0.5946: bf16[2,1,1,16384,6144]) -> f32[24576] {
  %param_0.5946 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5946"}
  %convert.4376.6 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.5946), metadata={scheduling_name="convert.4376.6"}
  %multiply.2781.3 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4376.6, %convert.4376.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2781.3"}
  %bitcast.27236.1 = f32[24576,8192]{1,0} bitcast(%multiply.2781.3), metadata={scheduling_name="bitcast.27236.1"}
  %constant_3026_97 = f32[] constant(0)
  ROOT %reduce.621.1 = f32[24576]{0} reduce(%bitcast.27236.1, %constant_3026_97), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.621.1"}
}

%fused_reduce.44 (param_0.5990: f32[24576]) -> f32[128] {
  %param_0.5990 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5990"}
  %bitcast.27214.1 = f32[128,192]{1,0} bitcast(%param_0.5990), metadata={scheduling_name="bitcast.27214.1"}
  %constant_3026_141 = f32[] constant(0)
  ROOT %reduce.709.1 = f32[128]{0} reduce(%bitcast.27214.1, %constant_3026_141), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.709.1"}
}

%fused_reduce.45 (param_0.5945: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5945 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5945"}
  %convert.4374.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5945), metadata={scheduling_name="convert.4374.6"}
  %multiply.2780.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4374.6, %convert.4374.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2780.3"}
  %bitcast.27208.1 = f32[24576,8192]{1,0} bitcast(%multiply.2780.3), metadata={scheduling_name="bitcast.27208.1"}
  %constant_3026_96 = f32[] constant(0)
  ROOT %reduce.619.1 = f32[24576]{0} reduce(%bitcast.27208.1, %constant_3026_96), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.619.1"}
}

%fused_reduce.46 (param_0.5989: f32[24576]) -> f32[128] {
  %param_0.5989 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5989"}
  %bitcast.27186.1 = f32[128,192]{1,0} bitcast(%param_0.5989), metadata={scheduling_name="bitcast.27186.1"}
  %constant_3026_140 = f32[] constant(0)
  ROOT %reduce.707.1 = f32[128]{0} reduce(%bitcast.27186.1, %constant_3026_140), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.707.1"}
}

%fused_reduce.47 (param_0.5944: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5944 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5944"}
  %convert.4372.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5944), metadata={scheduling_name="convert.4372.6"}
  %multiply.2779.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4372.6, %convert.4372.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2779.3"}
  %bitcast.27180.1 = f32[24576,8192]{1,0} bitcast(%multiply.2779.3), metadata={scheduling_name="bitcast.27180.1"}
  %constant_3026_95 = f32[] constant(0)
  ROOT %reduce.617.1 = f32[24576]{0} reduce(%bitcast.27180.1, %constant_3026_95), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.617.1"}
}

%fused_reduce.48 (param_0.5892: bf16[2,1,768,8]) -> f32[] {
  %param_0.5892 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5892"}
  %convert.4370.4 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5892), metadata={scheduling_name="convert.4370.4"}
  %multiply.2778.3 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4370.4, %convert.4370.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2778.3"}
  %bitcast.27158.1 = f32[12288]{0} bitcast(%multiply.2778.3), metadata={scheduling_name="bitcast.27158.1"}
  %constant_3026_43 = f32[] constant(0)
  ROOT %reduce.196.1 = f32[] reduce(%bitcast.27158.1, %constant_3026_43), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.196.1"}
}

%fused_reduce.49 (param_0.5943: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5943 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5943"}
  %convert.4368.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5943), metadata={scheduling_name="convert.4368.4"}
  %multiply.2777.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4368.4, %convert.4368.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2777.3"}
  %bitcast.27136.1 = f32[1024,1536]{1,0} bitcast(%multiply.2777.3), metadata={scheduling_name="bitcast.27136.1"}
  %constant_3026_94 = f32[] constant(0)
  ROOT %reduce.615.1 = f32[1024]{0} reduce(%bitcast.27136.1, %constant_3026_94), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.615.1"}
}

%fused_reduce.50 (param_0.5942: bf16[2,1,768,48,128]) -> f32[2048] {
  %param_0.5942 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5942"}
  %convert.4366.6 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.5942), metadata={scheduling_name="convert.4366.6"}
  %multiply.2776.3 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4366.6, %convert.4366.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2776.3"}
  %bitcast.27112.1 = f32[2048,4608]{1,0} bitcast(%multiply.2776.3), metadata={scheduling_name="bitcast.27112.1"}
  %constant_3026_93 = f32[] constant(0)
  ROOT %reduce.613.1 = f32[2048]{0} reduce(%bitcast.27112.1, %constant_3026_93), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.613.1"}
}

%fused_reduce.51 (param_0.5941: bf16[2,1,48,128,768]) -> f32[2048] {
  %param_0.5941 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5941"}
  %convert.4364.6 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.5941), metadata={scheduling_name="convert.4364.6"}
  %multiply.2775.3 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4364.6, %convert.4364.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2775.3"}
  %bitcast.27088.1 = f32[2048,4608]{1,0} bitcast(%multiply.2775.3), metadata={scheduling_name="bitcast.27088.1"}
  %constant_3026_92 = f32[] constant(0)
  ROOT %reduce.611.1 = f32[2048]{0} reduce(%bitcast.27088.1, %constant_3026_92), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.611.1"}
}

%fused_transpose.21 (param_0.3517: bf16[2,1,48,128,768]) -> bf16[2,6144,768] {
  %param_0.3517 = bf16[2,1,48,128,768]{3,2,4,1,0} parameter(0), metadata={scheduling_name="param_0.3517"}
  %bitcast.27071.1 = bf16[2,768,6144]{2,1,0} bitcast(%param_0.3517), metadata={scheduling_name="bitcast.27071.1"}
  ROOT %transpose.768.1 = bf16[2,6144,768]{2,1,0} transpose(%bitcast.27071.1), dimensions={0,2,1}, metadata={scheduling_name="transpose.768.1"}
}

%fused_reduce.52 (param_0.5940: bf16[2,1,768,8,128]) -> f32[1024] {
  %param_0.5940 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5940"}
  %convert.4362.4 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.5940), metadata={scheduling_name="convert.4362.4"}
  %multiply.2774.3 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4362.4, %convert.4362.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2774.3"}
  %bitcast.27059.1 = f32[1024,1536]{1,0} bitcast(%multiply.2774.3), metadata={scheduling_name="bitcast.27059.1"}
  %constant_3026_91 = f32[] constant(0)
  ROOT %reduce.609.1 = f32[1024]{0} reduce(%bitcast.27059.1, %constant_3026_91), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.609.1"}
}

%fused_reduce.53 (param_0.5887: bf16[2,1,6144]) -> f32[] {
  %param_0.5887 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5887"}
  %convert.4360.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5887), metadata={scheduling_name="convert.4360.4"}
  %multiply.2773.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4360.4, %convert.4360.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2773.3"}
  %bitcast.27037.1 = f32[12288]{0} bitcast(%multiply.2773.3), metadata={scheduling_name="bitcast.27037.1"}
  %constant_3026_38 = f32[] constant(0)
  ROOT %reduce.191.1 = f32[] reduce(%bitcast.27037.1, %constant_3026_38), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.191.1"}
}

%fused_reduce.54 (param_0.5886: bf16[2,1,6144]) -> f32[] {
  %param_0.5886 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5886"}
  %convert.4358.4 = f32[2,1,6144]{2,1,0} convert(%param_0.5886), metadata={scheduling_name="convert.4358.4"}
  %multiply.2772.3 = f32[2,1,6144]{2,1,0} multiply(%convert.4358.4, %convert.4358.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2772.3"}
  %bitcast.27017.1 = f32[12288]{0} bitcast(%multiply.2772.3), metadata={scheduling_name="bitcast.27017.1"}
  %constant_3026_37 = f32[] constant(0)
  ROOT %reduce.190.1 = f32[] reduce(%bitcast.27017.1, %constant_3026_37), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.190.1"}
}

%fused_reduce.55 (param_0.5988: f32[24576]) -> f32[128] {
  %param_0.5988 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5988"}
  %bitcast.26997.1 = f32[128,192]{1,0} bitcast(%param_0.5988), metadata={scheduling_name="bitcast.26997.1"}
  %constant_3026_139 = f32[] constant(0)
  ROOT %reduce.705.1 = f32[128]{0} reduce(%bitcast.26997.1, %constant_3026_139), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.705.1"}
}

%fused_reduce.56 (param_0.5939: bf16[2,1,1,16384,6144]) -> f32[24576] {
  %param_0.5939 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5939"}
  %convert.4356.6 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.5939), metadata={scheduling_name="convert.4356.6"}
  %multiply.2771.3 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4356.6, %convert.4356.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2771.3"}
  %bitcast.26991.1 = f32[24576,8192]{1,0} bitcast(%multiply.2771.3), metadata={scheduling_name="bitcast.26991.1"}
  %constant_3026_90 = f32[] constant(0)
  ROOT %reduce.607.1 = f32[24576]{0} reduce(%bitcast.26991.1, %constant_3026_90), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.607.1"}
}

%fused_reduce.57 (param_0.5987: f32[24576]) -> f32[128] {
  %param_0.5987 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5987"}
  %bitcast.26969.1 = f32[128,192]{1,0} bitcast(%param_0.5987), metadata={scheduling_name="bitcast.26969.1"}
  %constant_3026_138 = f32[] constant(0)
  ROOT %reduce.703.1 = f32[128]{0} reduce(%bitcast.26969.1, %constant_3026_138), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.703.1"}
}

%fused_reduce.58 (param_0.5938: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5938 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5938"}
  %convert.4354.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5938), metadata={scheduling_name="convert.4354.6"}
  %multiply.2770.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4354.6, %convert.4354.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2770.3"}
  %bitcast.26963.1 = f32[24576,8192]{1,0} bitcast(%multiply.2770.3), metadata={scheduling_name="bitcast.26963.1"}
  %constant_3026_89 = f32[] constant(0)
  ROOT %reduce.605.1 = f32[24576]{0} reduce(%bitcast.26963.1, %constant_3026_89), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.605.1"}
}

%fused_reduce.59 (param_0.5986: f32[24576]) -> f32[128] {
  %param_0.5986 = f32[24576]{0} parameter(0), metadata={scheduling_name="param_0.5986"}
  %bitcast.26941.1 = f32[128,192]{1,0} bitcast(%param_0.5986), metadata={scheduling_name="bitcast.26941.1"}
  %constant_3026_137 = f32[] constant(0)
  ROOT %reduce.701.1 = f32[128]{0} reduce(%bitcast.26941.1, %constant_3026_137), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.701.1"}
}

%fused_reduce.60 (param_0.5937: bf16[2,1,1,6144,16384]) -> f32[24576] {
  %param_0.5937 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5937"}
  %convert.4352.6 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.5937), metadata={scheduling_name="convert.4352.6"}
  %multiply.2769.3 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4352.6, %convert.4352.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2769.3"}
  %bitcast.26935.1 = f32[24576,8192]{1,0} bitcast(%multiply.2769.3), metadata={scheduling_name="bitcast.26935.1"}
  %constant_3026_88 = f32[] constant(0)
  ROOT %reduce.603.1 = f32[24576]{0} reduce(%bitcast.26935.1, %constant_3026_88), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.603.1"}
}

%fused_reduce.61 (param_0.5882: bf16[2,1,768,8]) -> f32[] {
  %param_0.5882 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5882"}
  %convert.4350.4 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5882), metadata={scheduling_name="convert.4350.4"}
  %multiply.2768.3 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4350.4, %convert.4350.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2768.3"}
  %bitcast.26915.1 = f32[12288]{0} bitcast(%multiply.2768.3), metadata={scheduling_name="bitcast.26915.1"}
  %constant_3026_33 = f32[] constant(0)
  ROOT %reduce.186.1 = f32[] reduce(%bitcast.26915.1, %constant_3026_33), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.186.1"}
}

%fused_scatter.10 (param_0.3538: bf16[2,1,4,8192,6144], param_1.3714: s32[2,1], param_2.2808: bf16[1,2,1,4,8192,6144]) -> bf16[2,1,4,8192,6144] {
  %param_0.3538 = bf16[2,1,4,8192,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3538"}
  %param_1.3714 = s32[2,1]{1,0} parameter(1), metadata={scheduling_name="param_1.3714"}
  %param_2.2808 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} parameter(2), metadata={scheduling_name="param_2.2808"}
  %bitcast.26834.1 = bf16[2,1,1,4,8192,6144]{5,4,3,2,1,0} bitcast(%param_2.2808), metadata={scheduling_name="bitcast.26834.1"}
  ROOT %scatter.221.1 = bf16[2,1,4,8192,6144]{4,3,2,1,0} scatter(%param_0.3538, %param_1.3714, %bitcast.26834.1), update_window_dims={1,2,3,4,5}, inserted_window_dims={}, scatter_dims_to_operand_dims={0}, index_vector_dim=1, to_apply=%region_6.604, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="scatter.221.1"}
}

%fused_reduce.62 (param_0.5936: bf16[768,32768]) -> f32[4096] {
  %param_0.5936 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.5936"}
  %convert.4345.6 = f32[768,32768]{1,0} convert(%param_0.5936), metadata={scheduling_name="convert.4345.6"}
  %multiply.2760.3 = f32[768,32768]{1,0} multiply(%convert.4345.6, %convert.4345.6), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2760.3"}
  %bitcast.26699.1 = f32[4096,6144]{1,0} bitcast(%multiply.2760.3), metadata={scheduling_name="bitcast.26699.1"}
  %constant_3026_87 = f32[] constant(0)
  ROOT %reduce.601.1 = f32[4096]{0} reduce(%bitcast.26699.1, %constant_3026_87), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.601.1"}
}

%fused_reduce.63 (param_0.5935: f32[65536], param_1.6333: bf16[65536,32768]) -> f32[8,8192,128] {
  %param_1.6333 = bf16[65536,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6333"}
  %convert.4334.8 = f32[65536,32768]{1,0} convert(%param_1.6333), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4334.8"}
  %bitcast.26596.7 = f32[8,8192,32768]{2,1,0} bitcast(%convert.4334.8), metadata={scheduling_name="bitcast.26596.7"}
  %param_0.5935 = f32[65536]{0} parameter(0), metadata={scheduling_name="param_0.5935"}
  %bitcast.26607.10 = f32[8,8192]{1,0} bitcast(%param_0.5935), metadata={scheduling_name="bitcast.26607.10"}
  %broadcast.5809.9 = f32[8,8192,32768]{2,1,0} broadcast(%bitcast.26607.10), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="broadcast.5809.9"}
  %subtract.270.7 = f32[8,8192,32768]{2,1,0} subtract(%bitcast.26596.7, %broadcast.5809.9), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="subtract.270.7"}
  %exponential.99.3 = f32[8,8192,32768]{2,1,0} exponential(%subtract.270.7), metadata={op_name="jit(train_step)/jit(main)/exp" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=612 scheduling_name="exponential.99.3"}
  %bitcast.26613.1 = f32[8,8192,128,256]{3,2,1,0} bitcast(%exponential.99.3), metadata={scheduling_name="bitcast.26613.1"}
  %constant_3026_86 = f32[] constant(0)
  ROOT %reduce.597.1 = f32[8,8192,128]{2,1,0} reduce(%bitcast.26613.1, %constant_3026_86), dimensions={3}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="reduce.597.1"}
}

%fused_reduce.64 (param_0.6000: bf16[65536,32768]) -> f32[65536,128] {
  %param_0.6000 = bf16[65536,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.6000"}
  %convert.4334.1 = f32[65536,32768]{1,0} convert(%param_0.6000), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4334.1"}
  %bitcast.26601.1 = f32[65536,128,256]{2,1,0} bitcast(%convert.4334.1), metadata={scheduling_name="bitcast.26601.1"}
  %constant_3127_1 = f32[] constant(-inf)
  ROOT %reduce.595.1 = f32[65536,128]{1,0} reduce(%bitcast.26601.1, %constant_3127_1), dimensions={2}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="reduce.595.1"}
}

%fused_reduce.65 (param_0.5834: s32[8,8192]) -> s32[256] {
  %param_0.5834 = s32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5834"}
  %constant_2984_5 = s32[] constant(0)
  %broadcast.5804.7 = s32[8,8192]{1,0} broadcast(%constant_2984_5), dimensions={}, metadata={scheduling_name="broadcast.5804.7"}
  %compare.1723.7 = pred[8,8192]{1,0} compare(%param_0.5834, %broadcast.5804.7), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.7"}
  %convert.4330.1 = s32[8,8192]{1,0} convert(%compare.1723.7), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="convert.4330.1"}
  %bitcast.26560.1 = s32[256,256]{1,0} bitcast(%convert.4330.1), metadata={scheduling_name="bitcast.26560.1"}
  ROOT %reduce.593.1 = s32[256]{0} reduce(%bitcast.26560.1, %constant_2984_5), dimensions={1}, to_apply=%region_7.620, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="reduce.593.1"}
}

%fused_rsqrt.8 (param_0.5998: f32[8,8192]) -> f32[1,8,8192] {
  %param_0.5998 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5998"}
  %constant_3119_1 = f32[] constant(0.000162760422)
  %broadcast.5801.7 = f32[8,8192]{1,0} broadcast(%constant_3119_1), dimensions={}, metadata={scheduling_name="broadcast.5801.7"}
  %multiply.2752.7 = f32[8,8192]{1,0} multiply(%param_0.5998, %broadcast.5801.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2752.7"}
  %constant_3120_1 = f32[] constant(1e-05)
  %broadcast.5802.5 = f32[8,8192]{1,0} broadcast(%constant_3120_1), dimensions={}, metadata={scheduling_name="broadcast.5802.5"}
  %add.3112.5 = f32[8,8192]{1,0} add(%multiply.2752.7, %broadcast.5802.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3112.5"}
  %bitcast.26539.1 = f32[1,8,8192]{2,1,0} bitcast(%add.3112.5), metadata={scheduling_name="bitcast.26539.1"}
  ROOT %rsqrt.103.1 = f32[1,8,8192]{2,1,0} rsqrt(%bitcast.26539.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="rsqrt.103.1"}
}

%fused_broadcast.5 (param_0.3568: pred[1]) -> pred[1,4,8192,6144] {
  %param_0.3568 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.3568"}
  %bitcast.26505.1 = pred[] bitcast(%param_0.3568), metadata={scheduling_name="bitcast.26505.1"}
  ROOT %broadcast.5800.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.26505.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="broadcast.5800.1"}
}

%fused_transpose.22 (param_0.3570: bf16[2,1,48,128,768]) -> bf16[2,768,6144] {
  %param_0.3570 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3570"}
  %bitcast.26476.1 = bf16[2,6144,768]{2,1,0} bitcast(%param_0.3570), metadata={scheduling_name="bitcast.26476.1"}
  ROOT %transpose.767.1 = bf16[2,768,6144]{2,1,0} transpose(%bitcast.26476.1), dimensions={0,2,1}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="transpose.767.1"}
}

%fused_transpose.23 (param_0.3574: bf16[2,1,48,128,768]) -> bf16[2,768,6144] {
  %param_0.3574 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.3574"}
  %bitcast.26403.1 = bf16[2,6144,768]{2,1,0} bitcast(%param_0.3574), metadata={scheduling_name="bitcast.26403.1"}
  ROOT %transpose.766.1 = bf16[2,768,6144]{2,1,0} transpose(%bitcast.26403.1), dimensions={0,2,1}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="transpose.766.1"}
}

%fused_dynamic_slice.26 (param_0.5835: s32[256,8192], param_1.6451: u32[32], param_2.4642: u32[]) -> s32[4,4,8192] {
  %param_0.5835 = s32[256,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.5835"}
  %bitcast.26362.1 = s32[4,64,8192]{2,1,0} bitcast(%param_0.5835), metadata={scheduling_name="bitcast.26362.1"}
  %constant_2984_6 = s32[] constant(0)
  %constant_5168_1 = u32[1]{0} constant({0}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %param_1.6451 = u32[32]{0} parameter(1), metadata={scheduling_name="param_1.6451"}
  %param_2.4642 = u32[] parameter(2), metadata={scheduling_name="param_2.4642"}
  %dynamic-slice.1568.1 = u32[1]{0} dynamic-slice(%param_1.6451, %param_2.4642), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="dynamic-slice.1568.1"}
  %constant_5169_1 = u32[1]{0} constant({15}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %clamp.28.1 = u32[1]{0} clamp(%constant_5168_1, %dynamic-slice.1568.1, %constant_5169_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="clamp.28.1"}
  %convert.4324.1 = s32[1]{0} convert(%clamp.28.1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="convert.4324.1"}
  %constant_5166_1 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2745.1 = s32[1]{0} multiply(%convert.4324.1, %constant_5166_1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="multiply.2745.1"}
  %bitcast.26378.1 = s32[] bitcast(%multiply.2745.1), metadata={scheduling_name="bitcast.26378.1"}
  ROOT %dynamic-slice.1569.1 = s32[4,4,8192]{2,1,0} dynamic-slice(%bitcast.26362.1, %constant_2984_6, %bitcast.26378.1, %constant_2984_6), dynamic_slice_sizes={4,4,8192}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="dynamic-slice.1569.1"}
}

%fused_broadcast.6 (param_0.3578: pred[1]) -> pred[1,4,8192,6144] {
  %param_0.3578 = pred[1]{0} parameter(0), metadata={scheduling_name="param_0.3578"}
  %bitcast.26347.1 = pred[] bitcast(%param_0.3578), metadata={scheduling_name="bitcast.26347.1"}
  ROOT %broadcast.5791.1 = pred[1,4,8192,6144]{3,2,1,0} broadcast(%bitcast.26347.1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="broadcast.5791.1"}
}

%fused_gather (param_0.3584: s32[2,1], param_1.3734: bf16[1,2,4,8192,6144]) -> bf16[2,1,1,4,8192,6144] {
  %param_1.3734 = bf16[1,2,4,8192,6144]{4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.3734"}
  %bitcast.26511.1 = bf16[2,1,4,8192,6144]{4,3,2,0,1} bitcast(%param_1.3734), metadata={scheduling_name="bitcast.26511.1"}
  %param_0.3584 = s32[2,1]{1,0} parameter(0), metadata={scheduling_name="param_0.3584"}
  ROOT %gather.350.1 = bf16[2,1,1,4,8192,6144]{5,4,3,0,2,1} gather(%bitcast.26511.1, %param_0.3584), offset_dims={1,2,3,4,5}, collapsed_slice_dims={}, start_index_map={0}, index_vector_dim=1, slice_sizes={1,1,4,8192,6144}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="gather.350.1"}
}

%fused_convert_reduce.8 (param_0.3613: f32[8,8192], param_1.3775: f32[8,8192], param_2.2840: f32[65536], param_3.2320: bf16[65536,32768], param_4.1939: f32[8,8192], param_5.1740: s32[8,8192], param_6.2546: f32[8,8192]) -> (bf16[8,8192,32768], f32[8,8192,128]) {
  %param_0.3613 = f32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3613"}
  %broadcast.5807.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_0.3613), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5807.3"}
  %param_4.1939 = f32[8,8192]{1,0} parameter(4), metadata={scheduling_name="param_4.1939"}
  %broadcast.5812.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_4.1939), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5812.3"}
  %param_3.2320 = bf16[65536,32768]{1,0} parameter(3), metadata={scheduling_name="param_3.2320"}
  %convert.4334.14 = f32[65536,32768]{1,0} convert(%param_3.2320), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4334.14"}
  %bitcast.26596.13 = f32[8,8192,32768]{2,1,0} bitcast(%convert.4334.14), metadata={scheduling_name="bitcast.26596.13"}
  %param_2.2840 = f32[65536]{0} parameter(2), metadata={scheduling_name="param_2.2840"}
  %bitcast.26607.16 = f32[8,8192]{1,0} bitcast(%param_2.2840), metadata={scheduling_name="bitcast.26607.16"}
  %broadcast.5809.15 = f32[8,8192,32768]{2,1,0} broadcast(%bitcast.26607.16), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="broadcast.5809.15"}
  %subtract.270.13 = f32[8,8192,32768]{2,1,0} subtract(%bitcast.26596.13, %broadcast.5809.15), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=611 scheduling_name="subtract.270.13"}
  %exponential.99.9 = f32[8,8192,32768]{2,1,0} exponential(%subtract.270.13), metadata={op_name="jit(train_step)/jit(main)/exp" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=612 scheduling_name="exponential.99.9"}
  %multiply.2756.5 = f32[8,8192,32768]{2,1,0} multiply(%broadcast.5812.3, %exponential.99.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2756.5"}
  %param_1.3775 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.3775"}
  %broadcast.5813.3 = f32[8,8192,32768]{2,1,0} broadcast(%param_1.3775), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="broadcast.5813.3"}
  %divide.476.3 = f32[8,8192,32768]{2,1,0} divide(%multiply.2756.5, %broadcast.5813.3), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="divide.476.3"}
  %param_5.1740 = s32[8,8192]{1,0} parameter(5), metadata={scheduling_name="param_5.1740"}
  %broadcast.5814.5 = s32[8,8192,32768]{2,1,0} broadcast(%param_5.1740), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="broadcast.5814.5"}
  %iota.404.5 = s32[8,8192,32768]{2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="iota.404.5"}
  %compare.1724.5 = pred[8,8192,32768]{2,1,0} compare(%broadcast.5814.5, %iota.404.5), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/eq" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="compare.1724.5"}
  %convert.4335.1 = f32[8,8192,32768]{2,1,0} convert(%compare.1724.5), metadata={op_name="jit(train_step)/jit(main)/jvp(jit(_one_hot))/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=301 scheduling_name="convert.4335.1"}
  %subtract.271.1 = f32[8,8192,32768]{2,1,0} subtract(%divide.476.3, %convert.4335.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="subtract.271.1"}
  %multiply.2757.3 = f32[8,8192,32768]{2,1,0} multiply(%broadcast.5807.3, %subtract.271.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2757.3"}
  %convert.4336.1 = bf16[8,8192,32768]{2,1,0} convert(%multiply.2757.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="convert.4336.1"}
  %param_6.2546 = f32[8,8192]{1,0} parameter(6), metadata={scheduling_name="param_6.2546"}
  %broadcast.6024.3.clone.1 = f32[8,8192,32768]{2,1,0} broadcast(%param_6.2546), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=614 scheduling_name="broadcast.6024.3.clone.1"}
  %subtract.274.3.clone.1 = f32[8,8192,32768]{2,1,0} subtract(%subtract.270.13, %broadcast.6024.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=614 scheduling_name="subtract.274.3.clone.1"}
  %constant_3026_119_clone_1 = f32[] constant(0)
  %broadcast.6025.1.clone.1 = f32[8,8192,32768]{2,1,0} broadcast(%constant_3026_119_clone_1), dimensions={}, metadata={scheduling_name="broadcast.6025.1.clone.1"}
  %select.1393.1.clone.1 = f32[8,8192,32768]{2,1,0} select(%compare.1724.5, %subtract.274.3.clone.1, %broadcast.6025.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="select.1393.1.clone.1"}
  %bitcast.29921.1.clone.1 = f32[8,8192,128,256]{3,2,1,0} bitcast(%select.1393.1.clone.1), metadata={scheduling_name="bitcast.29921.1.clone.1"}
  %reduce.665.1.clone.1 = f32[8,8192,128]{2,1,0} reduce(%bitcast.29921.1.clone.1, %constant_3026_119_clone_1), dimensions={3}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="reduce.665.1.clone.1"}
  ROOT %tuple.644 = (bf16[8,8192,32768]{2,1,0}, f32[8,8192,128]{2,1,0}) tuple(%convert.4336.1, %reduce.665.1.clone.1), metadata={scheduling_name="tuple.644"}
}

%fused_convert.17 (param_0.3648: s32[8,8192]) -> bf16[8,8192,32768] {
  %param_0.3648 = s32[8,8192]{1,0} parameter(0), metadata={scheduling_name="param_0.3648"}
  %broadcast.5780.3 = s32[8,8192,32768]{2,1,0} broadcast(%param_0.3648), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="broadcast.5780.3"}
  %iota.395.3 = s32[8,8192,32768]{2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="iota.395.3"}
  %compare.1720.3 = pred[8,8192,32768]{2,1,0} compare(%broadcast.5780.3, %iota.395.3), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/eq" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="compare.1720.3"}
  ROOT %convert.4322.1 = bf16[8,8192,32768]{2,1,0} convert(%compare.1720.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="convert.4322.1"}
}

%region_6.604.clone.10 (Arg_0.179: f32[], Arg_1.179: f32[]) -> f32[] {
  %Arg_1.179 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.179"}
  %Arg_0.179 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.179"}
  ROOT %add.3099.0 = f32[] add(%Arg_0.179, %Arg_1.179), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3099.0"}
}

%fused_convert_reduce.9 (param_0.3721: f32[1,8,8192], param_1.4683: bf16[65536,6144], param_2.3423: bf16[1,1,1,8,8192,6144], param_3.2798: f32[1,8,8192], param_4.2232: bf16[6144], param_5.2728: f32[]) -> (bf16[8,8192,6144], f32[256,6144]) {
  %param_1.4683 = bf16[65536,6144]{1,0} parameter(1), metadata={scheduling_name="param_1.4683"}
  %bitcast.26649.15 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.4683), metadata={scheduling_name="bitcast.26649.15"}
  %convert.4337.15 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26649.15), metadata={scheduling_name="convert.4337.15"}
  %param_4.2232 = bf16[6144]{0} parameter(4), metadata={scheduling_name="param_4.2232"}
  %convert.4316.2 = f32[6144]{0} convert(%param_4.2232), metadata={scheduling_name="convert.4316.2"}
  %broadcast.6072.10 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4316.2), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6072.10"}
  %multiply.2761.9 = f32[8,8192,6144]{2,1,0} multiply(%convert.4337.15, %broadcast.6072.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2761.9"}
  %param_0.3721 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.3721"}
  %bitcast.26542.15 = f32[8,8192]{1,0} bitcast(%param_0.3721), metadata={scheduling_name="bitcast.26542.15"}
  %broadcast.5803.15 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26542.15), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5803.15"}
  %multiply.2762.5 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2761.9, %broadcast.5803.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2762.5"}
  %param_2.3423 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3423"}
  %bitcast.26523.19 = bf16[8,8192,6144]{2,1,0} bitcast(%param_2.3423), metadata={scheduling_name="bitcast.26523.19"}
  %convert.4328.19 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26523.19), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4328.19"}
  %param_3.2798 = f32[1,8,8192]{2,1,0} parameter(3), metadata={scheduling_name="param_3.2798"}
  %bitcast.26820.3 = f32[8,8192]{1,0} bitcast(%param_3.2798), metadata={scheduling_name="bitcast.26820.3"}
  %broadcast.5841.3 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26820.3), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5841.3"}
  %multiply.2767.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4328.19, %broadcast.5841.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2767.3"}
  %add.3117.3 = f32[8,8192,6144]{2,1,0} add(%multiply.2762.5, %multiply.2767.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/add_any" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="add.3117.3"}
  %convert.4349.1 = bf16[8,8192,6144]{2,1,0} convert(%add.3117.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4349.1"}
  %multiply.2753.11.clone.1 = f32[8,8192,6144]{2,1,0} multiply(%convert.4328.19, %broadcast.5803.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2753.11.clone.1"}
  %multiply.2758.5.clone.1 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2753.11.clone.1, %convert.4337.15), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2758.5.clone.1"}
  %convert.4338.3.clone.1 = bf16[8,8192,6144]{2,1,0} convert(%multiply.2758.5.clone.1), metadata={scheduling_name="convert.4338.3.clone.1"}
  %bitcast.26656.3.clone.1 = bf16[256,256,6144]{2,1,0} bitcast(%convert.4338.3.clone.1), metadata={scheduling_name="bitcast.26656.3.clone.1"}
  %convert.4339.3.clone.1 = f32[256,256,6144]{2,1,0} convert(%bitcast.26656.3.clone.1), metadata={scheduling_name="convert.4339.3.clone.1"}
  %param_5.2728 = f32[] parameter(5), metadata={scheduling_name="param_5.2728"}
  %reduce.599.1.clone.1 = f32[256,6144]{1,0} reduce(%convert.4339.3.clone.1, %param_5.2728), dimensions={1}, to_apply=%region_6.604.clone.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.599.1.clone.1"}
  ROOT %tuple.643 = (bf16[8,8192,6144]{2,1,0}, f32[256,6144]{1,0}) tuple(%convert.4349.1, %reduce.599.1.clone.1), metadata={scheduling_name="tuple.643"}
}

%fused_convert.18 (param_0.4438: f32[1,8,8192], param_1.4686: bf16[1,1,1,8,8192,6144], param_2.3424: bf16[6144]) -> bf16[8,8192,6144] {
  %param_1.4686 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.4686"}
  %bitcast.26523.17 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.4686), metadata={scheduling_name="bitcast.26523.17"}
  %convert.4328.17 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26523.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4328.17"}
  %param_0.4438 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.4438"}
  %bitcast.26542.17 = f32[8,8192]{1,0} bitcast(%param_0.4438), metadata={scheduling_name="bitcast.26542.17"}
  %broadcast.5803.17 = f32[8,8192,6144]{2,1,0} broadcast(%bitcast.26542.17), dimensions={0,1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="broadcast.5803.17"}
  %multiply.2753.9 = f32[8,8192,6144]{2,1,0} multiply(%convert.4328.17, %broadcast.5803.17), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2753.9"}
  %param_2.3424 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.3424"}
  %convert.4316.4 = f32[6144]{0} convert(%param_2.3424), metadata={scheduling_name="convert.4316.4"}
  %broadcast.6072.12 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4316.4), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6072.12"}
  %multiply.2754.3 = f32[8,8192,6144]{2,1,0} multiply(%multiply.2753.9, %broadcast.6072.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2754.3"}
  ROOT %convert.4333.1 = bf16[8,8192,6144]{2,1,0} convert(%multiply.2754.3), metadata={scheduling_name="convert.4333.1"}
}

%fused_reduce.66 (param_0.5875: bf16[1,1,1,8,8192,6144]) -> f32[8,8192] {
  %param_0.5875 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5875"}
  %bitcast.26523.21 = bf16[8,8192,6144]{2,1,0} bitcast(%param_0.5875), metadata={scheduling_name="bitcast.26523.21"}
  %convert.4328.21 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26523.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4328.21"}
  %multiply.2751.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4328.21, %convert.4328.21), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/square" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2751.3"}
  %constant_3026_26 = f32[] constant(0)
  ROOT %reduce.178.1 = f32[8,8192]{1,0} reduce(%multiply.2751.3, %constant_3026_26), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="reduce.178.1"}
}

%fused_reduce.67 (param_0.5881: bf16[65536,6144], param_1.6293: bf16[1,1,1,8,8192,6144], param_2.4494: bf16[6144]) -> f32[8,8192] {
  %param_1.6293 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} parameter(1), metadata={scheduling_name="param_1.6293"}
  %bitcast.26523.23 = bf16[8,8192,6144]{2,1,0} bitcast(%param_1.6293), metadata={scheduling_name="bitcast.26523.23"}
  %convert.4328.23 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26523.23), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="convert.4328.23"}
  %param_0.5881 = bf16[65536,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.5881"}
  %bitcast.26649.17 = bf16[8,8192,6144]{2,1,0} bitcast(%param_0.5881), metadata={scheduling_name="bitcast.26649.17"}
  %convert.4337.17 = f32[8,8192,6144]{2,1,0} convert(%bitcast.26649.17), metadata={scheduling_name="convert.4337.17"}
  %param_2.4494 = bf16[6144]{0} parameter(2), metadata={scheduling_name="param_2.4494"}
  %convert.4316.5 = f32[6144]{0} convert(%param_2.4494), metadata={scheduling_name="convert.4316.5"}
  %broadcast.6072.14 = f32[8,8192,6144]{2,1,0} broadcast(%convert.4316.5), dimensions={2}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="broadcast.6072.14"}
  %multiply.2761.11 = f32[8,8192,6144]{2,1,0} multiply(%convert.4337.17, %broadcast.6072.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="multiply.2761.11"}
  %multiply.2763.3 = f32[8,8192,6144]{2,1,0} multiply(%convert.4328.23, %multiply.2761.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2763.3"}
  %constant_3026_32 = f32[] constant(0)
  ROOT %reduce.185.1 = f32[8,8192]{1,0} reduce(%multiply.2763.3, %constant_3026_32), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="reduce.185.1"}
}

%fused_convert_reduce.10 (param_0.4161: bf16[2,1,1,6144,16384], param_1.4530: f32[], param_2.3309: bf16[2,1,1,6144,16384], param_3.2710: f32[], param_4.2200: bf16[2,1,1,6144,16384], param_5.2472: bf16[2,1,1,6144,16384], param_6.2223: f32[], param_7.2027: pred[], param_8.1871: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4161 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4161"}
  %convert.4455.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4161), metadata={scheduling_name="convert.4455.12"}
  %param_8.1871 = f32[] parameter(8), metadata={scheduling_name="param_8.1871"}
  %broadcast.6134.16 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1871), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6134.16"}
  %param_7.2027 = pred[] parameter(7), metadata={scheduling_name="param_7.2027"}
  %broadcast.5875.40 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2027), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5875.40"}
  %param_5.2472 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2472"}
  %convert.4352.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2472), metadata={scheduling_name="convert.4352.20"}
  %param_6.2223 = f32[] parameter(6), metadata={scheduling_name="param_6.2223"}
  %broadcast.6136.56 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2223), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6136.56"}
  %divide.487.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4352.20, %broadcast.6136.56), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.487.17"}
  %convert.4459.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.487.17), metadata={scheduling_name="convert.4459.15"}
  %select.1372.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5875.40, %param_5.2472, %convert.4459.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1372.13"}
  %convert.4460.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1372.13), metadata={scheduling_name="convert.4460.26"}
  %constant_3240_21 = bf16[] constant(0.1001)
  %convert.5017.26 = f32[] convert(%constant_3240_21), metadata={scheduling_name="convert.5017.26"}
  %broadcast.6138.48 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5017.26), dimensions={}, metadata={scheduling_name="broadcast.6138.48"}
  %multiply.2813.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4460.26, %broadcast.6138.48), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2813.11"}
  %param_4.2200 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2200"}
  %convert.4462.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2200), metadata={scheduling_name="convert.4462.9"}
  %constant_3241_20 = bf16[] constant(0.8984)
  %convert.5018.10 = f32[] convert(%constant_3241_20), metadata={scheduling_name="convert.5018.10"}
  %broadcast.6140.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.10), dimensions={}, metadata={scheduling_name="broadcast.6140.32"}
  %multiply.2814.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4462.9, %broadcast.6140.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2814.11"}
  %add.3156.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2813.11, %multiply.2814.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3156.9"}
  %param_3.2710 = f32[] parameter(3), metadata={scheduling_name="param_3.2710"}
  %broadcast.6142.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2710), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.32"}
  %multiply.2815.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4460.26, %convert.4460.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2815.15"}
  %constant_3247_20 = bf16[] constant(0.05005)
  %convert.5021.10 = f32[] convert(%constant_3247_20), metadata={scheduling_name="convert.5021.10"}
  %broadcast.6144.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5021.10), dimensions={}, metadata={scheduling_name="broadcast.6144.32"}
  %multiply.2816.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2815.15, %broadcast.6144.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2816.11"}
  %param_2.3309 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3309"}
  %convert.4468.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3309), metadata={scheduling_name="convert.4468.11"}
  %constant_3248_20 = bf16[] constant(0.9492)
  %convert.5023.10 = f32[] convert(%constant_3248_20), metadata={scheduling_name="convert.5023.10"}
  %broadcast.6146.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.10), dimensions={}, metadata={scheduling_name="broadcast.6146.32"}
  %multiply.2817.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4468.11, %broadcast.6146.32), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2817.11"}
  %add.3157.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2816.11, %multiply.2817.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3157.9"}
  %param_1.4530 = f32[] parameter(1), metadata={scheduling_name="param_1.4530"}
  %broadcast.6148.32 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4530), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6148.32"}
  %divide.488.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3157.9, %broadcast.6148.32), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.488.11"}
  %sqrt.85.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.488.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.85.9"}
  %constant_3251_20 = bf16[] constant(1.001e-08)
  %convert.5025.10 = f32[] convert(%constant_3251_20), metadata={scheduling_name="convert.5025.10"}
  %broadcast.6150.16 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5025.10), dimensions={}, metadata={scheduling_name="broadcast.6150.16"}
  %add.3158.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.85.9, %broadcast.6150.16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3158.7"}
  %multiply.2818.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6142.32, %add.3158.7), metadata={scheduling_name="multiply.2818.11"}
  %divide.489.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3156.9, %multiply.2818.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.489.9"}
  %multiply.2819.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4455.12, %broadcast.6138.48), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2819.7"}
  %add.3159.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.489.9, %multiply.2819.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3159.7"}
  %multiply.2820.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6134.16, %add.3159.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2820.7"}
  %add.3160.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4455.12, %multiply.2820.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3160.5"}
  %convert.4474.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3160.5), metadata={scheduling_name="convert.4474.1"}
  %convert.4920.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3156.9), metadata={scheduling_name="convert.4920.1.clone.1"}
  %multiply.2990.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3160.5, %add.3160.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2990.1.clone.1"}
  %bitcast.29997.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2990.1.clone.1), metadata={scheduling_name="bitcast.29997.1.clone.1"}
  %constant_3026_122_clone_1 = f32[] constant(0)
  %reduce.671.1.clone.1 = f32[24576]{0} reduce(%bitcast.29997.1.clone.1, %constant_3026_122_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.671.1.clone.1"}
  %convert.4954.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3157.9), metadata={scheduling_name="convert.4954.1.clone.1"}
  %bitcast.29569.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2815.15), metadata={scheduling_name="bitcast.29569.1.clone.1"}
  %reduce.635.1.clone.1 = f32[24576]{0} reduce(%bitcast.29569.1.clone.1, %constant_3026_122_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.635.1.clone.1"}
  ROOT %tuple.626 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4474.1, %convert.4920.1.clone.1, %reduce.671.1.clone.1, %convert.4954.1.clone.1, %reduce.635.1.clone.1), metadata={scheduling_name="tuple.626"}
}

%fused_convert_reduce.11 (param_0.4166: bf16[2,1,1,6144,16384], param_1.4531: f32[], param_2.3310: bf16[2,1,1,6144,16384], param_3.2711: f32[], param_4.2201: bf16[2,1,1,6144,16384], param_5.2473: bf16[2,1,1,6144,16384], param_6.2224: f32[], param_7.2028: pred[], param_8.1872: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4166 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4166"}
  %convert.4475.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4166), metadata={scheduling_name="convert.4475.12"}
  %param_8.1872 = f32[] parameter(8), metadata={scheduling_name="param_8.1872"}
  %broadcast.6134.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1872), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6134.20"}
  %param_7.2028 = pred[] parameter(7), metadata={scheduling_name="param_7.2028"}
  %broadcast.5875.44 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2028), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5875.44"}
  %param_5.2473 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2473"}
  %convert.4354.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2473), metadata={scheduling_name="convert.4354.20"}
  %param_6.2224 = f32[] parameter(6), metadata={scheduling_name="param_6.2224"}
  %broadcast.6136.60 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2224), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6136.60"}
  %divide.490.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4354.20, %broadcast.6136.60), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.490.17"}
  %convert.4479.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.490.17), metadata={scheduling_name="convert.4479.15"}
  %select.1373.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5875.44, %param_5.2473, %convert.4479.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1373.13"}
  %convert.4480.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1373.13), metadata={scheduling_name="convert.4480.26"}
  %constant_3240_23 = bf16[] constant(0.1001)
  %convert.5017.30 = f32[] convert(%constant_3240_23), metadata={scheduling_name="convert.5017.30"}
  %broadcast.6138.56 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5017.30), dimensions={}, metadata={scheduling_name="broadcast.6138.56"}
  %multiply.2821.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4480.26, %broadcast.6138.56), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2821.11"}
  %param_4.2201 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2201"}
  %convert.4482.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2201), metadata={scheduling_name="convert.4482.9"}
  %constant_3241_21 = bf16[] constant(0.8984)
  %convert.5018.11 = f32[] convert(%constant_3241_21), metadata={scheduling_name="convert.5018.11"}
  %broadcast.6140.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.11), dimensions={}, metadata={scheduling_name="broadcast.6140.36"}
  %multiply.2822.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4482.9, %broadcast.6140.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2822.11"}
  %add.3161.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2821.11, %multiply.2822.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3161.9"}
  %param_3.2711 = f32[] parameter(3), metadata={scheduling_name="param_3.2711"}
  %broadcast.6142.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2711), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.36"}
  %multiply.2823.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4480.26, %convert.4480.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2823.15"}
  %constant_3247_21 = bf16[] constant(0.05005)
  %convert.5021.11 = f32[] convert(%constant_3247_21), metadata={scheduling_name="convert.5021.11"}
  %broadcast.6144.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5021.11), dimensions={}, metadata={scheduling_name="broadcast.6144.36"}
  %multiply.2824.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2823.15, %broadcast.6144.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2824.11"}
  %param_2.3310 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3310"}
  %convert.4488.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3310), metadata={scheduling_name="convert.4488.11"}
  %constant_3248_21 = bf16[] constant(0.9492)
  %convert.5023.11 = f32[] convert(%constant_3248_21), metadata={scheduling_name="convert.5023.11"}
  %broadcast.6146.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.11), dimensions={}, metadata={scheduling_name="broadcast.6146.36"}
  %multiply.2825.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4488.11, %broadcast.6146.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2825.11"}
  %add.3162.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2824.11, %multiply.2825.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3162.9"}
  %param_1.4531 = f32[] parameter(1), metadata={scheduling_name="param_1.4531"}
  %broadcast.6148.36 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4531), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6148.36"}
  %divide.491.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3162.9, %broadcast.6148.36), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.491.11"}
  %sqrt.86.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.491.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.86.9"}
  %constant_3251_21 = bf16[] constant(1.001e-08)
  %convert.5025.11 = f32[] convert(%constant_3251_21), metadata={scheduling_name="convert.5025.11"}
  %broadcast.6150.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5025.11), dimensions={}, metadata={scheduling_name="broadcast.6150.20"}
  %add.3163.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.86.9, %broadcast.6150.20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3163.7"}
  %multiply.2826.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6142.36, %add.3163.7), metadata={scheduling_name="multiply.2826.11"}
  %divide.492.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3161.9, %multiply.2826.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.492.9"}
  %multiply.2827.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4475.12, %broadcast.6138.56), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2827.7"}
  %add.3164.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.492.9, %multiply.2827.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3164.7"}
  %multiply.2828.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6134.20, %add.3164.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2828.7"}
  %add.3165.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4475.12, %multiply.2828.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3165.5"}
  %convert.4494.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3165.5), metadata={scheduling_name="convert.4494.1"}
  %convert.4922.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3161.9), metadata={scheduling_name="convert.4922.1.clone.1"}
  %multiply.2991.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3165.5, %add.3165.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2991.1.clone.1"}
  %bitcast.30019.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2991.1.clone.1), metadata={scheduling_name="bitcast.30019.1.clone.1"}
  %constant_3026_123_clone_1 = f32[] constant(0)
  %reduce.673.1.clone.1 = f32[24576]{0} reduce(%bitcast.30019.1.clone.1, %constant_3026_123_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.673.1.clone.1"}
  %convert.4955.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3162.9), metadata={scheduling_name="convert.4955.1.clone.1"}
  %bitcast.29590.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2823.15), metadata={scheduling_name="bitcast.29590.1.clone.1"}
  %reduce.637.1.clone.1 = f32[24576]{0} reduce(%bitcast.29590.1.clone.1, %constant_3026_123_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.637.1.clone.1"}
  ROOT %tuple.627 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4494.1, %convert.4922.1.clone.1, %reduce.673.1.clone.1, %convert.4955.1.clone.1, %reduce.637.1.clone.1), metadata={scheduling_name="tuple.627"}
}

%fused_convert_reduce.12 (param_0.4171: bf16[2,1,1,16384,6144], param_1.4533: f32[], param_2.3312: bf16[2,1,1,16384,6144], param_3.2713: f32[], param_4.2203: bf16[2,1,1,16384,6144], param_5.2475: bf16[2,1,1,16384,6144], param_6.2226: f32[], param_7.2030: pred[], param_8.1874: f32[]) -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144], f32[24576], bf16[2,1,1,16384,6144], f32[24576]) {
  %param_0.4171 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4171"}
  %convert.4495.12 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.4171), metadata={scheduling_name="convert.4495.12"}
  %param_8.1874 = f32[] parameter(8), metadata={scheduling_name="param_8.1874"}
  %broadcast.6166.10 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_8.1874), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6166.10"}
  %param_7.2030 = pred[] parameter(7), metadata={scheduling_name="param_7.2030"}
  %broadcast.5892.22 = pred[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_7.2030), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5892.22"}
  %param_5.2475 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2475"}
  %convert.4356.20 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_5.2475), metadata={scheduling_name="convert.4356.20"}
  %param_6.2226 = f32[] parameter(6), metadata={scheduling_name="param_6.2226"}
  %broadcast.6168.30 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_6.2226), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6168.30"}
  %divide.493.17 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%convert.4356.20, %broadcast.6168.30), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.493.17"}
  %convert.4499.15 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%divide.493.17), metadata={scheduling_name="convert.4499.15"}
  %select.1374.13 = bf16[2,1,1,16384,6144]{4,3,2,1,0} select(%broadcast.5892.22, %param_5.2475, %convert.4499.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1374.13"}
  %convert.4500.26 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%select.1374.13), metadata={scheduling_name="convert.4500.26"}
  %constant_3240_28 = bf16[] constant(0.1001)
  %convert.5017.34 = f32[] convert(%constant_3240_28), metadata={scheduling_name="convert.5017.34"}
  %broadcast.6170.28 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5017.34), dimensions={}, metadata={scheduling_name="broadcast.6170.28"}
  %multiply.2829.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4500.26, %broadcast.6170.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2829.11"}
  %param_4.2203 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2203"}
  %convert.4502.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_4.2203), metadata={scheduling_name="convert.4502.9"}
  %constant_3241_23 = bf16[] constant(0.8984)
  %convert.5018.13 = f32[] convert(%constant_3241_23), metadata={scheduling_name="convert.5018.13"}
  %broadcast.6172.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5018.13), dimensions={}, metadata={scheduling_name="broadcast.6172.18"}
  %multiply.2830.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4502.9, %broadcast.6172.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2830.11"}
  %add.3166.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2829.11, %multiply.2830.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3166.9"}
  %param_3.2713 = f32[] parameter(3), metadata={scheduling_name="param_3.2713"}
  %broadcast.6174.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_3.2713), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.18"}
  %multiply.2831.15 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4500.26, %convert.4500.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2831.15"}
  %constant_3247_23 = bf16[] constant(0.05005)
  %convert.5021.13 = f32[] convert(%constant_3247_23), metadata={scheduling_name="convert.5021.13"}
  %broadcast.6176.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5021.13), dimensions={}, metadata={scheduling_name="broadcast.6176.18"}
  %multiply.2832.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%multiply.2831.15, %broadcast.6176.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2832.11"}
  %param_2.3312 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3312"}
  %convert.4508.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.3312), metadata={scheduling_name="convert.4508.11"}
  %constant_3248_23 = bf16[] constant(0.9492)
  %convert.5023.13 = f32[] convert(%constant_3248_23), metadata={scheduling_name="convert.5023.13"}
  %broadcast.6178.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5023.13), dimensions={}, metadata={scheduling_name="broadcast.6178.18"}
  %multiply.2833.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4508.11, %broadcast.6178.18), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2833.11"}
  %add.3167.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2832.11, %multiply.2833.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3167.9"}
  %param_1.4533 = f32[] parameter(1), metadata={scheduling_name="param_1.4533"}
  %broadcast.6180.18 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_1.4533), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6180.18"}
  %divide.494.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3167.9, %broadcast.6180.18), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.494.11"}
  %sqrt.87.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} sqrt(%divide.494.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.87.9"}
  %constant_3251_23 = bf16[] constant(1.001e-08)
  %convert.5025.13 = f32[] convert(%constant_3251_23), metadata={scheduling_name="convert.5025.13"}
  %broadcast.6182.10 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5025.13), dimensions={}, metadata={scheduling_name="broadcast.6182.10"}
  %add.3168.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%sqrt.87.9, %broadcast.6182.10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3168.7"}
  %multiply.2834.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6174.18, %add.3168.7), metadata={scheduling_name="multiply.2834.11"}
  %divide.495.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3166.9, %multiply.2834.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.495.9"}
  %multiply.2835.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4495.12, %broadcast.6170.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2835.7"}
  %add.3169.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%divide.495.9, %multiply.2835.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3169.7"}
  %multiply.2836.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6166.10, %add.3169.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2836.7"}
  %add.3170.5 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%convert.4495.12, %multiply.2836.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3170.5"}
  %convert.4514.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3170.5), metadata={scheduling_name="convert.4514.1"}
  %convert.4923.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3166.9), metadata={scheduling_name="convert.4923.1.clone.1"}
  %multiply.2992.1.clone.1 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%add.3170.5, %add.3170.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2992.1.clone.1"}
  %bitcast.30041.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2992.1.clone.1), metadata={scheduling_name="bitcast.30041.1.clone.1"}
  %constant_3026_124_clone_1 = f32[] constant(0)
  %reduce.675.1.clone.1 = f32[24576]{0} reduce(%bitcast.30041.1.clone.1, %constant_3026_124_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.675.1.clone.1"}
  %convert.4956.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3167.9), metadata={scheduling_name="convert.4956.1.clone.1"}
  %bitcast.29611.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2831.15), metadata={scheduling_name="bitcast.29611.1.clone.1"}
  %reduce.639.1.clone.1 = f32[24576]{0} reduce(%bitcast.29611.1.clone.1, %constant_3026_124_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.639.1.clone.1"}
  ROOT %tuple.628 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4514.1, %convert.4923.1.clone.1, %reduce.675.1.clone.1, %convert.4956.1.clone.1, %reduce.639.1.clone.1), metadata={scheduling_name="tuple.628"}
}

%fused_convert_reduce.13 (param_0.4176: bf16[2,1,1,6144,16384], param_1.4532: f32[], param_2.3311: bf16[2,1,1,6144,16384], param_3.2712: f32[], param_4.2202: bf16[2,1,1,6144,16384], param_5.2474: bf16[2,1,1,6144,16384], param_6.2225: f32[], param_7.2029: pred[], param_8.1873: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4176 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4176"}
  %convert.4686.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4176), metadata={scheduling_name="convert.4686.12"}
  %param_8.1873 = f32[] parameter(8), metadata={scheduling_name="param_8.1873"}
  %broadcast.6134.24 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1873), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6134.24"}
  %param_7.2029 = pred[] parameter(7), metadata={scheduling_name="param_7.2029"}
  %broadcast.5875.48 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2029), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5875.48"}
  %param_5.2474 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2474"}
  %convert.4372.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2474), metadata={scheduling_name="convert.4372.20"}
  %param_6.2225 = f32[] parameter(6), metadata={scheduling_name="param_6.2225"}
  %broadcast.6136.64 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2225), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6136.64"}
  %divide.517.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4372.20, %broadcast.6136.64), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.517.17"}
  %convert.4692.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.517.17), metadata={scheduling_name="convert.4692.15"}
  %select.1382.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5875.48, %param_5.2474, %convert.4692.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1382.13"}
  %convert.4694.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1382.13), metadata={scheduling_name="convert.4694.26"}
  %constant_3240_25 = bf16[] constant(0.1001)
  %convert.5017.38 = f32[] convert(%constant_3240_25), metadata={scheduling_name="convert.5017.38"}
  %broadcast.6138.64 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5017.38), dimensions={}, metadata={scheduling_name="broadcast.6138.64"}
  %multiply.2893.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4694.26, %broadcast.6138.64), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2893.11"}
  %param_4.2202 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2202"}
  %convert.4697.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2202), metadata={scheduling_name="convert.4697.9"}
  %constant_3241_22 = bf16[] constant(0.8984)
  %convert.5018.12 = f32[] convert(%constant_3241_22), metadata={scheduling_name="convert.5018.12"}
  %broadcast.6140.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.12), dimensions={}, metadata={scheduling_name="broadcast.6140.40"}
  %multiply.2894.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4697.9, %broadcast.6140.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2894.11"}
  %add.3207.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2893.11, %multiply.2894.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3207.9"}
  %param_3.2712 = f32[] parameter(3), metadata={scheduling_name="param_3.2712"}
  %broadcast.6142.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2712), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.40"}
  %multiply.2895.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4694.26, %convert.4694.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2895.15"}
  %constant_3247_22 = bf16[] constant(0.05005)
  %convert.5021.12 = f32[] convert(%constant_3247_22), metadata={scheduling_name="convert.5021.12"}
  %broadcast.6144.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5021.12), dimensions={}, metadata={scheduling_name="broadcast.6144.40"}
  %multiply.2896.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2895.15, %broadcast.6144.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2896.11"}
  %param_2.3311 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3311"}
  %convert.4706.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3311), metadata={scheduling_name="convert.4706.11"}
  %constant_3248_22 = bf16[] constant(0.9492)
  %convert.5023.12 = f32[] convert(%constant_3248_22), metadata={scheduling_name="convert.5023.12"}
  %broadcast.6146.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.12), dimensions={}, metadata={scheduling_name="broadcast.6146.40"}
  %multiply.2897.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4706.11, %broadcast.6146.40), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2897.11"}
  %add.3208.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2896.11, %multiply.2897.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3208.9"}
  %param_1.4532 = f32[] parameter(1), metadata={scheduling_name="param_1.4532"}
  %broadcast.6148.40 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4532), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6148.40"}
  %divide.518.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3208.9, %broadcast.6148.40), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.518.11"}
  %sqrt.95.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.518.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.95.9"}
  %constant_3251_22 = bf16[] constant(1.001e-08)
  %convert.5025.12 = f32[] convert(%constant_3251_22), metadata={scheduling_name="convert.5025.12"}
  %broadcast.6150.24 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5025.12), dimensions={}, metadata={scheduling_name="broadcast.6150.24"}
  %add.3209.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.95.9, %broadcast.6150.24), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3209.7"}
  %multiply.2898.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6142.40, %add.3209.7), metadata={scheduling_name="multiply.2898.11"}
  %divide.519.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3207.9, %multiply.2898.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.519.9"}
  %multiply.2899.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4686.12, %broadcast.6138.64), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2899.7"}
  %add.3210.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.519.9, %multiply.2899.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3210.7"}
  %multiply.2902.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6134.24, %add.3210.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2902.7"}
  %add.3211.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4686.12, %multiply.2902.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3211.5"}
  %convert.4715.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3211.5), metadata={scheduling_name="convert.4715.1"}
  %convert.4935.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3207.9), metadata={scheduling_name="convert.4935.1.clone.1"}
  %multiply.3003.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3211.5, %add.3211.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3003.1.clone.1"}
  %bitcast.30177.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.3003.1.clone.1), metadata={scheduling_name="bitcast.30177.1.clone.1"}
  %constant_3026_129_clone_1 = f32[] constant(0)
  %reduce.685.1.clone.1 = f32[24576]{0} reduce(%bitcast.30177.1.clone.1, %constant_3026_129_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.685.1.clone.1"}
  %convert.4964.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3208.9), metadata={scheduling_name="convert.4964.1.clone.1"}
  %bitcast.29739.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2895.15), metadata={scheduling_name="bitcast.29739.1.clone.1"}
  %reduce.649.1.clone.1 = f32[24576]{0} reduce(%bitcast.29739.1.clone.1, %constant_3026_129_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.649.1.clone.1"}
  ROOT %tuple.633 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4715.1, %convert.4935.1.clone.1, %reduce.685.1.clone.1, %convert.4964.1.clone.1, %reduce.649.1.clone.1), metadata={scheduling_name="tuple.633"}
}

%fused_convert_reduce.14 (param_0.4181: bf16[2,1,1,6144,16384], param_1.4528: f32[], param_2.3307: bf16[2,1,1,6144,16384], param_3.2708: f32[], param_4.2198: bf16[2,1,1,6144,16384], param_5.2466: bf16[2,1,1,6144,16384], param_6.2217: f32[], param_7.2021: pred[], param_8.1865: f32[]) -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], f32[24576], bf16[2,1,1,6144,16384], f32[24576]) {
  %param_0.4181 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4181"}
  %convert.4716.12 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_0.4181), metadata={scheduling_name="convert.4716.12"}
  %param_8.1865 = f32[] parameter(8), metadata={scheduling_name="param_8.1865"}
  %broadcast.6134.28 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_8.1865), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6134.28"}
  %param_7.2021 = pred[] parameter(7), metadata={scheduling_name="param_7.2021"}
  %broadcast.5875.52 = pred[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_7.2021), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5875.52"}
  %param_5.2466 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2466"}
  %convert.4374.20 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_5.2466), metadata={scheduling_name="convert.4374.20"}
  %param_6.2217 = f32[] parameter(6), metadata={scheduling_name="param_6.2217"}
  %broadcast.6136.68 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_6.2217), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6136.68"}
  %divide.520.17 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%convert.4374.20, %broadcast.6136.68), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.520.17"}
  %convert.4722.15 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%divide.520.17), metadata={scheduling_name="convert.4722.15"}
  %select.1383.13 = bf16[2,1,1,6144,16384]{4,3,2,1,0} select(%broadcast.5875.52, %param_5.2466, %convert.4722.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1383.13"}
  %convert.4724.26 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%select.1383.13), metadata={scheduling_name="convert.4724.26"}
  %constant_3240_14 = bf16[] constant(0.1001)
  %convert.5017.42 = f32[] convert(%constant_3240_14), metadata={scheduling_name="convert.5017.42"}
  %broadcast.6138.72 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5017.42), dimensions={}, metadata={scheduling_name="broadcast.6138.72"}
  %multiply.2903.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4724.26, %broadcast.6138.72), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2903.11"}
  %param_4.2198 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2198"}
  %convert.4727.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_4.2198), metadata={scheduling_name="convert.4727.9"}
  %constant_3241_14 = bf16[] constant(0.8984)
  %convert.5018.4 = f32[] convert(%constant_3241_14), metadata={scheduling_name="convert.5018.4"}
  %broadcast.6140.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5018.4), dimensions={}, metadata={scheduling_name="broadcast.6140.44"}
  %multiply.2904.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4727.9, %broadcast.6140.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2904.11"}
  %add.3212.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2903.11, %multiply.2904.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3212.9"}
  %param_3.2708 = f32[] parameter(3), metadata={scheduling_name="param_3.2708"}
  %broadcast.6142.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_3.2708), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6142.44"}
  %multiply.2905.15 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4724.26, %convert.4724.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2905.15"}
  %constant_3247_14 = bf16[] constant(0.05005)
  %convert.5021.4 = f32[] convert(%constant_3247_14), metadata={scheduling_name="convert.5021.4"}
  %broadcast.6144.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5021.4), dimensions={}, metadata={scheduling_name="broadcast.6144.44"}
  %multiply.2906.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%multiply.2905.15, %broadcast.6144.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2906.11"}
  %param_2.3307 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3307"}
  %convert.4736.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} convert(%param_2.3307), metadata={scheduling_name="convert.4736.11"}
  %constant_3248_14 = bf16[] constant(0.9492)
  %convert.5023.4 = f32[] convert(%constant_3248_14), metadata={scheduling_name="convert.5023.4"}
  %broadcast.6146.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5023.4), dimensions={}, metadata={scheduling_name="broadcast.6146.44"}
  %multiply.2907.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4736.11, %broadcast.6146.44), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2907.11"}
  %add.3213.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%multiply.2906.11, %multiply.2907.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3213.9"}
  %param_1.4528 = f32[] parameter(1), metadata={scheduling_name="param_1.4528"}
  %broadcast.6148.44 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%param_1.4528), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6148.44"}
  %divide.521.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3213.9, %broadcast.6148.44), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.521.11"}
  %sqrt.96.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} sqrt(%divide.521.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.96.9"}
  %constant_3251_14 = bf16[] constant(1.001e-08)
  %convert.5025.4 = f32[] convert(%constant_3251_14), metadata={scheduling_name="convert.5025.4"}
  %broadcast.6150.28 = f32[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%convert.5025.4), dimensions={}, metadata={scheduling_name="broadcast.6150.28"}
  %add.3214.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%sqrt.96.9, %broadcast.6150.28), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3214.7"}
  %multiply.2909.11 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6142.44, %add.3214.7), metadata={scheduling_name="multiply.2909.11"}
  %divide.522.9 = f32[2,1,1,6144,16384]{4,3,2,1,0} divide(%add.3212.9, %multiply.2909.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.522.9"}
  %multiply.2910.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%convert.4716.12, %broadcast.6138.72), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2910.7"}
  %add.3215.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%divide.522.9, %multiply.2910.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3215.7"}
  %multiply.2911.7 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%broadcast.6134.28, %add.3215.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2911.7"}
  %add.3216.5 = f32[2,1,1,6144,16384]{4,3,2,1,0} add(%convert.4716.12, %multiply.2911.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3216.5"}
  %convert.4742.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3216.5), metadata={scheduling_name="convert.4742.1"}
  %convert.4937.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3212.9), metadata={scheduling_name="convert.4937.1.clone.1"}
  %multiply.3004.1.clone.1 = f32[2,1,1,6144,16384]{4,3,2,1,0} multiply(%add.3216.5, %add.3216.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3004.1.clone.1"}
  %bitcast.30199.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.3004.1.clone.1), metadata={scheduling_name="bitcast.30199.1.clone.1"}
  %constant_3026_130_clone_1 = f32[] constant(0)
  %reduce.687.1.clone.1 = f32[24576]{0} reduce(%bitcast.30199.1.clone.1, %constant_3026_130_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.687.1.clone.1"}
  %convert.4965.1.clone.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} convert(%add.3213.9), metadata={scheduling_name="convert.4965.1.clone.1"}
  %bitcast.29760.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2905.15), metadata={scheduling_name="bitcast.29760.1.clone.1"}
  %reduce.651.1.clone.1 = f32[24576]{0} reduce(%bitcast.29760.1.clone.1, %constant_3026_130_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.651.1.clone.1"}
  ROOT %tuple.634 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4742.1, %convert.4937.1.clone.1, %reduce.687.1.clone.1, %convert.4965.1.clone.1, %reduce.651.1.clone.1), metadata={scheduling_name="tuple.634"}
}

%fused_convert_reduce.15 (param_0.4186: bf16[2,1,1,16384,6144], param_1.4529: f32[], param_2.3308: bf16[2,1,1,16384,6144], param_3.2709: f32[], param_4.2199: bf16[2,1,1,16384,6144], param_5.2467: bf16[2,1,1,16384,6144], param_6.2218: f32[], param_7.2022: pred[], param_8.1866: f32[]) -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144], f32[24576], bf16[2,1,1,16384,6144], f32[24576]) {
  %param_0.4186 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.4186"}
  %convert.4743.12 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_0.4186), metadata={scheduling_name="convert.4743.12"}
  %param_8.1866 = f32[] parameter(8), metadata={scheduling_name="param_8.1866"}
  %broadcast.6166.14 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_8.1866), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6166.14"}
  %param_7.2022 = pred[] parameter(7), metadata={scheduling_name="param_7.2022"}
  %broadcast.5892.26 = pred[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_7.2022), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5892.26"}
  %param_5.2467 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2467"}
  %convert.4376.20 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_5.2467), metadata={scheduling_name="convert.4376.20"}
  %param_6.2218 = f32[] parameter(6), metadata={scheduling_name="param_6.2218"}
  %broadcast.6168.34 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_6.2218), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6168.34"}
  %divide.523.17 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%convert.4376.20, %broadcast.6168.34), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.523.17"}
  %convert.4747.15 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%divide.523.17), metadata={scheduling_name="convert.4747.15"}
  %select.1384.13 = bf16[2,1,1,16384,6144]{4,3,2,1,0} select(%broadcast.5892.26, %param_5.2467, %convert.4747.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1384.13"}
  %convert.4748.26 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%select.1384.13), metadata={scheduling_name="convert.4748.26"}
  %constant_3240_15 = bf16[] constant(0.1001)
  %convert.5017.46 = f32[] convert(%constant_3240_15), metadata={scheduling_name="convert.5017.46"}
  %broadcast.6170.36 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5017.46), dimensions={}, metadata={scheduling_name="broadcast.6170.36"}
  %multiply.2913.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4748.26, %broadcast.6170.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2913.11"}
  %param_4.2199 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2199"}
  %convert.4750.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_4.2199), metadata={scheduling_name="convert.4750.9"}
  %constant_3241_15 = bf16[] constant(0.8984)
  %convert.5018.5 = f32[] convert(%constant_3241_15), metadata={scheduling_name="convert.5018.5"}
  %broadcast.6172.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5018.5), dimensions={}, metadata={scheduling_name="broadcast.6172.22"}
  %multiply.2914.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4750.9, %broadcast.6172.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2914.11"}
  %add.3217.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2913.11, %multiply.2914.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3217.9"}
  %param_3.2709 = f32[] parameter(3), metadata={scheduling_name="param_3.2709"}
  %broadcast.6174.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_3.2709), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6174.22"}
  %multiply.2915.15 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4748.26, %convert.4748.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2915.15"}
  %constant_3247_15 = bf16[] constant(0.05005)
  %convert.5021.5 = f32[] convert(%constant_3247_15), metadata={scheduling_name="convert.5021.5"}
  %broadcast.6176.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5021.5), dimensions={}, metadata={scheduling_name="broadcast.6176.22"}
  %multiply.2916.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%multiply.2915.15, %broadcast.6176.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2916.11"}
  %param_2.3308 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.3308"}
  %convert.4756.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} convert(%param_2.3308), metadata={scheduling_name="convert.4756.11"}
  %constant_3248_15 = bf16[] constant(0.9492)
  %convert.5023.5 = f32[] convert(%constant_3248_15), metadata={scheduling_name="convert.5023.5"}
  %broadcast.6178.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5023.5), dimensions={}, metadata={scheduling_name="broadcast.6178.22"}
  %multiply.2917.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4756.11, %broadcast.6178.22), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2917.11"}
  %add.3218.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%multiply.2916.11, %multiply.2917.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3218.9"}
  %param_1.4529 = f32[] parameter(1), metadata={scheduling_name="param_1.4529"}
  %broadcast.6180.22 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%param_1.4529), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6180.22"}
  %divide.524.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3218.9, %broadcast.6180.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.524.11"}
  %sqrt.97.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} sqrt(%divide.524.11), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.97.9"}
  %constant_3251_15 = bf16[] constant(1.001e-08)
  %convert.5025.5 = f32[] convert(%constant_3251_15), metadata={scheduling_name="convert.5025.5"}
  %broadcast.6182.14 = f32[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%convert.5025.5), dimensions={}, metadata={scheduling_name="broadcast.6182.14"}
  %add.3219.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%sqrt.97.9, %broadcast.6182.14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3219.7"}
  %multiply.2919.11 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6174.22, %add.3219.7), metadata={scheduling_name="multiply.2919.11"}
  %divide.525.9 = f32[2,1,1,16384,6144]{4,3,2,1,0} divide(%add.3217.9, %multiply.2919.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.525.9"}
  %multiply.2920.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%convert.4743.12, %broadcast.6170.36), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2920.7"}
  %add.3220.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%divide.525.9, %multiply.2920.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3220.7"}
  %multiply.2921.7 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%broadcast.6166.14, %add.3220.7), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2921.7"}
  %add.3221.5 = f32[2,1,1,16384,6144]{4,3,2,1,0} add(%convert.4743.12, %multiply.2921.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3221.5"}
  %convert.4762.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3221.5), metadata={scheduling_name="convert.4762.1"}
  %convert.4938.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3217.9), metadata={scheduling_name="convert.4938.1.clone.1"}
  %multiply.3005.1.clone.1 = f32[2,1,1,16384,6144]{4,3,2,1,0} multiply(%add.3221.5, %add.3221.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3005.1.clone.1"}
  %bitcast.30221.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.3005.1.clone.1), metadata={scheduling_name="bitcast.30221.1.clone.1"}
  %constant_3026_131_clone_1 = f32[] constant(0)
  %reduce.689.1.clone.1 = f32[24576]{0} reduce(%bitcast.30221.1.clone.1, %constant_3026_131_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.689.1.clone.1"}
  %convert.4966.1.clone.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} convert(%add.3218.9), metadata={scheduling_name="convert.4966.1.clone.1"}
  %bitcast.29781.1.clone.1 = f32[24576,8192]{1,0} bitcast(%multiply.2915.15), metadata={scheduling_name="bitcast.29781.1.clone.1"}
  %reduce.653.1.clone.1 = f32[24576]{0} reduce(%bitcast.29781.1.clone.1, %constant_3026_131_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.653.1.clone.1"}
  ROOT %tuple.635 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) tuple(%convert.4762.1, %convert.4938.1.clone.1, %reduce.689.1.clone.1, %convert.4966.1.clone.1, %reduce.653.1.clone.1), metadata={scheduling_name="tuple.635"}
}

%fused_transpose.24 (param_0.4333: bf16[768,32768], param_1.6375: f32[], param_2.4615: f32[], param_3.3798: f32[], param_4.2771: bf16[768,32768], param_5.2547: bf16[768,32768], param_6.2299: bf16[32768,768]) -> f32[768,32768] {
  %param_0.4333 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.4333"}
  %convert.4886.1 = f32[768,32768]{1,0} convert(%param_0.4333), metadata={scheduling_name="convert.4886.1"}
  %param_1.6375 = f32[] parameter(1), metadata={scheduling_name="param_1.6375"}
  %broadcast.6094.4 = f32[768,32768]{1,0} broadcast(%param_1.6375), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6094.4"}
  %param_5.2547 = bf16[768,32768]{1,0} parameter(5), metadata={scheduling_name="param_5.2547"}
  %convert.4893.14 = f32[768,32768]{1,0} convert(%param_5.2547), metadata={scheduling_name="convert.4893.14"}
  %constant_3240_12 = bf16[] constant(0.1001)
  %convert.5017.70 = f32[] convert(%constant_3240_12), metadata={scheduling_name="convert.5017.70"}
  %broadcast.6098.28 = f32[768,32768]{1,0} broadcast(%convert.5017.70), dimensions={}, metadata={scheduling_name="broadcast.6098.28"}
  %multiply.2976.7 = f32[768,32768]{1,0} multiply(%convert.4893.14, %broadcast.6098.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2976.7"}
  %param_4.2771 = bf16[768,32768]{1,0} parameter(4), metadata={scheduling_name="param_4.2771"}
  %convert.4896.5 = f32[768,32768]{1,0} convert(%param_4.2771), metadata={scheduling_name="convert.4896.5"}
  %constant_3241_12 = bf16[] constant(0.8984)
  %convert.5018.41 = f32[] convert(%constant_3241_12), metadata={scheduling_name="convert.5018.41"}
  %broadcast.6100.17 = f32[768,32768]{1,0} broadcast(%convert.5018.41), dimensions={}, metadata={scheduling_name="broadcast.6100.17"}
  %multiply.2977.7 = f32[768,32768]{1,0} multiply(%convert.4896.5, %broadcast.6100.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2977.7"}
  %add.3254.5 = f32[768,32768]{1,0} add(%multiply.2976.7, %multiply.2977.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3254.5"}
  %param_3.3798 = f32[] parameter(3), metadata={scheduling_name="param_3.3798"}
  %broadcast.6102.10 = f32[768,32768]{1,0} broadcast(%param_3.3798), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6102.10"}
  %multiply.2978.11 = f32[768,32768]{1,0} multiply(%convert.4893.14, %convert.4893.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2978.11"}
  %constant_3247_12 = bf16[] constant(0.05005)
  %convert.5021.41 = f32[] convert(%constant_3247_12), metadata={scheduling_name="convert.5021.41"}
  %broadcast.6104.17 = f32[768,32768]{1,0} broadcast(%convert.5021.41), dimensions={}, metadata={scheduling_name="broadcast.6104.17"}
  %multiply.2979.7 = f32[768,32768]{1,0} multiply(%multiply.2978.11, %broadcast.6104.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2979.7"}
  %param_6.2299 = bf16[32768,768]{1,0} parameter(6), metadata={scheduling_name="param_6.2299"}
  %transpose.771.1 = bf16[768,32768]{1,0} transpose(%param_6.2299), dimensions={1,0}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.771.1"}
  %convert.4905.5 = f32[768,32768]{1,0} convert(%transpose.771.1), metadata={scheduling_name="convert.4905.5"}
  %constant_3248_12 = bf16[] constant(0.9492)
  %convert.5023.41 = f32[] convert(%constant_3248_12), metadata={scheduling_name="convert.5023.41"}
  %broadcast.6106.17 = f32[768,32768]{1,0} broadcast(%convert.5023.41), dimensions={}, metadata={scheduling_name="broadcast.6106.17"}
  %multiply.2980.7 = f32[768,32768]{1,0} multiply(%convert.4905.5, %broadcast.6106.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2980.7"}
  %add.3256.5 = f32[768,32768]{1,0} add(%multiply.2979.7, %multiply.2980.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3256.5"}
  %param_2.4615 = f32[] parameter(2), metadata={scheduling_name="param_2.4615"}
  %broadcast.6108.18 = f32[768,32768]{1,0} broadcast(%param_2.4615), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6108.18"}
  %divide.545.9 = f32[768,32768]{1,0} divide(%add.3256.5, %broadcast.6108.18), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.545.9"}
  %sqrt.104.7 = f32[768,32768]{1,0} sqrt(%divide.545.9), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.104.7"}
  %constant_3251_12 = bf16[] constant(1.001e-08)
  %convert.5025.28 = f32[] convert(%constant_3251_12), metadata={scheduling_name="convert.5025.28"}
  %broadcast.6110.10 = f32[768,32768]{1,0} broadcast(%convert.5025.28), dimensions={}, metadata={scheduling_name="broadcast.6110.10"}
  %add.3257.5 = f32[768,32768]{1,0} add(%sqrt.104.7, %broadcast.6110.10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3257.5"}
  %multiply.2981.5 = f32[768,32768]{1,0} multiply(%broadcast.6102.10, %add.3257.5), metadata={scheduling_name="multiply.2981.5"}
  %divide.546.3 = f32[768,32768]{1,0} divide(%add.3254.5, %multiply.2981.5), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.546.3"}
  %multiply.2982.7 = f32[768,32768]{1,0} multiply(%convert.4886.1, %broadcast.6098.28), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2982.7"}
  %add.3258.5 = f32[768,32768]{1,0} add(%divide.546.3, %multiply.2982.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3258.5"}
  %multiply.2983.3 = f32[768,32768]{1,0} multiply(%broadcast.6094.4, %add.3258.5), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2983.3"}
  ROOT %add.3259.1 = f32[768,32768]{1,0} add(%convert.4886.1, %multiply.2983.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3259.1"}
}

%fused_select_transpose (param_0.6073: bf16[32768,768], param_1.6474: bf16[768,32768], param_2.4755: f32[], param_3.3980: bf16[32768,768], param_4.2937: pred[]) -> (bf16[32768,768], bf16[32768,768], bf16[768,32768]) {
  %param_4.2937 = pred[] parameter(4), metadata={scheduling_name="param_4.2937"}
  %broadcast.5853.1.clone.1 = pred[768,32768]{1,0} broadcast(%param_4.2937), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5853.1.clone.1"}
  %param_3.3980 = bf16[32768,768]{0,1} parameter(3), metadata={scheduling_name="param_3.3980"}
  %bitcast.27413.2.clone.1 = bf16[768,32768]{1,0} bitcast(%param_3.3980), metadata={scheduling_name="bitcast.27413.2.clone.1"}
  %convert.4390.11.clone.1 = f32[768,32768]{1,0} convert(%bitcast.27413.2.clone.1), metadata={scheduling_name="convert.4390.11.clone.1"}
  %param_2.4755 = f32[] parameter(2), metadata={scheduling_name="param_2.4755"}
  %broadcast.6096.10.clone.1 = f32[768,32768]{1,0} broadcast(%param_2.4755), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6096.10.clone.1"}
  %divide.544.5.clone.1 = f32[768,32768]{1,0} divide(%convert.4390.11.clone.1, %broadcast.6096.10.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.544.5.clone.1"}
  %convert.4892.3.clone.1 = bf16[768,32768]{1,0} convert(%divide.544.5.clone.1), metadata={scheduling_name="convert.4892.3.clone.1"}
  %select.1391.1.clone.1 = bf16[768,32768]{1,0} select(%broadcast.5853.1.clone.1, %bitcast.27413.2.clone.1, %convert.4892.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1391.1.clone.1"}
  %convert.4893.20 = f32[768,32768]{1,0} convert(%select.1391.1.clone.1), metadata={scheduling_name="convert.4893.20"}
  %multiply.2978.13 = f32[768,32768]{1,0} multiply(%convert.4893.20, %convert.4893.20), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2978.13"}
  %constant_3247_37 = bf16[] constant(0.05005)
  %convert.5021.51 = f32[] convert(%constant_3247_37), metadata={scheduling_name="convert.5021.51"}
  %broadcast.6104.19 = f32[768,32768]{1,0} broadcast(%convert.5021.51), dimensions={}, metadata={scheduling_name="broadcast.6104.19"}
  %multiply.2979.9 = f32[768,32768]{1,0} multiply(%multiply.2978.13, %broadcast.6104.19), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2979.9"}
  %param_0.6073 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6073"}
  %transpose.771.2 = bf16[768,32768]{1,0} transpose(%param_0.6073), dimensions={1,0}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.771.2"}
  %convert.4905.7 = f32[768,32768]{1,0} convert(%transpose.771.2), metadata={scheduling_name="convert.4905.7"}
  %constant_3248_37 = bf16[] constant(0.9492)
  %convert.5023.51 = f32[] convert(%constant_3248_37), metadata={scheduling_name="convert.5023.51"}
  %broadcast.6106.19 = f32[768,32768]{1,0} broadcast(%convert.5023.51), dimensions={}, metadata={scheduling_name="broadcast.6106.19"}
  %multiply.2980.9 = f32[768,32768]{1,0} multiply(%convert.4905.7, %broadcast.6106.19), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2980.9"}
  %add.3256.7 = f32[768,32768]{1,0} add(%multiply.2979.9, %multiply.2980.9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3256.7"}
  %convert.4973.3 = bf16[768,32768]{1,0} convert(%add.3256.7), metadata={scheduling_name="convert.4973.3"}
  %transpose.774.1 = bf16[32768,768]{1,0} transpose(%convert.4973.3), dimensions={1,0}, metadata={scheduling_name="transpose.774.1"}
  %constant_3240_3_clone_1 = bf16[] constant(0.1001)
  %convert.5017.88.clone.1 = f32[] convert(%constant_3240_3_clone_1), metadata={scheduling_name="convert.5017.88.clone.1"}
  %broadcast.6098.30.clone.1 = f32[768,32768]{1,0} broadcast(%convert.5017.88.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6098.30.clone.1"}
  %multiply.2976.9.clone.1 = f32[768,32768]{1,0} multiply(%convert.4893.20, %broadcast.6098.30.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2976.9.clone.1"}
  %param_1.6474 = bf16[768,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6474"}
  %convert.4896.7.clone.1 = f32[768,32768]{1,0} convert(%param_1.6474), metadata={scheduling_name="convert.4896.7.clone.1"}
  %constant_3241_37_clone_1 = bf16[] constant(0.8984)
  %convert.5018.51.clone.1 = f32[] convert(%constant_3241_37_clone_1), metadata={scheduling_name="convert.5018.51.clone.1"}
  %broadcast.6100.19.clone.1 = f32[768,32768]{1,0} broadcast(%convert.5018.51.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6100.19.clone.1"}
  %multiply.2977.9.clone.1 = f32[768,32768]{1,0} multiply(%convert.4896.7.clone.1, %broadcast.6100.19.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2977.9.clone.1"}
  %add.3254.7.clone.1 = f32[768,32768]{1,0} add(%multiply.2976.9.clone.1, %multiply.2977.9.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3254.7.clone.1"}
  %convert.4949.3.clone.1 = bf16[768,32768]{1,0} convert(%add.3254.7.clone.1), metadata={scheduling_name="convert.4949.3.clone.1"}
  %transpose.773.1.clone.1 = bf16[32768,768]{1,0} transpose(%convert.4949.3.clone.1), dimensions={1,0}, metadata={scheduling_name="transpose.773.1.clone.1"}
  ROOT %tuple.553 = (bf16[32768,768]{1,0}, bf16[32768,768]{1,0}, bf16[768,32768]{1,0}) tuple(%transpose.774.1, %transpose.773.1.clone.1, %select.1391.1.clone.1), metadata={scheduling_name="tuple.553"}
}

%fused_transpose.25 (param_0.4507: f32[768,32768]) -> bf16[32768,768] {
  %param_0.4507 = f32[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.4507"}
  %convert.4914.1 = bf16[768,32768]{1,0} convert(%param_0.4507), metadata={scheduling_name="convert.4914.1"}
  ROOT %transpose.772.1 = bf16[32768,768]{1,0} transpose(%convert.4914.1), dimensions={1,0}, metadata={scheduling_name="transpose.772.1"}
}

%fused_convert_reduce.16 (param_0.6006: bf16[768,32768], param_1.6429: f32[], param_2.4614: bf16[768,32768], param_3.3797: f32[], param_4.2769: bf16[768,32768], param_5.2545: bf16[768,32768], param_6.2297: f32[], param_7.2126: pred[], param_8.1965: f32[]) -> (bf16[768,32768], bf16[768,32768], f32[4096], bf16[768,32768], f32[4096]) {
  %param_0.6006 = bf16[768,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.6006"}
  %convert.4415.16 = f32[768,32768]{1,0} convert(%param_0.6006), metadata={scheduling_name="convert.4415.16"}
  %param_8.1965 = f32[] parameter(8), metadata={scheduling_name="param_8.1965"}
  %broadcast.6094.10 = f32[768,32768]{1,0} broadcast(%param_8.1965), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6094.10"}
  %param_7.2126 = pred[] parameter(7), metadata={scheduling_name="param_7.2126"}
  %broadcast.5853.14 = pred[768,32768]{1,0} broadcast(%param_7.2126), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5853.14"}
  %param_5.2545 = bf16[768,32768]{1,0} parameter(5), metadata={scheduling_name="param_5.2545"}
  %convert.4345.20 = f32[768,32768]{1,0} convert(%param_5.2545), metadata={scheduling_name="convert.4345.20"}
  %param_6.2297 = f32[] parameter(6), metadata={scheduling_name="param_6.2297"}
  %broadcast.6096.22 = f32[768,32768]{1,0} broadcast(%param_6.2297), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6096.22"}
  %divide.481.17 = f32[768,32768]{1,0} divide(%convert.4345.20, %broadcast.6096.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.481.17"}
  %convert.4419.15 = bf16[768,32768]{1,0} convert(%divide.481.17), metadata={scheduling_name="convert.4419.15"}
  %select.1370.13 = bf16[768,32768]{1,0} select(%broadcast.5853.14, %param_5.2545, %convert.4419.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1370.13"}
  %convert.4420.26 = f32[768,32768]{1,0} convert(%select.1370.13), metadata={scheduling_name="convert.4420.26"}
  %constant_3240_31 = bf16[] constant(0.1001)
  %convert.5017.144 = f32[] convert(%constant_3240_31), metadata={scheduling_name="convert.5017.144"}
  %broadcast.6098.38 = f32[768,32768]{1,0} broadcast(%convert.5017.144), dimensions={}, metadata={scheduling_name="broadcast.6098.38"}
  %multiply.2797.11 = f32[768,32768]{1,0} multiply(%convert.4420.26, %broadcast.6098.38), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2797.11"}
  %param_4.2769 = bf16[768,32768]{1,0} parameter(4), metadata={scheduling_name="param_4.2769"}
  %convert.4422.9 = f32[768,32768]{1,0} convert(%param_4.2769), metadata={scheduling_name="convert.4422.9"}
  %constant_3241_35 = bf16[] constant(0.8984)
  %convert.5018.79 = f32[] convert(%constant_3241_35), metadata={scheduling_name="convert.5018.79"}
  %broadcast.6100.23 = f32[768,32768]{1,0} broadcast(%convert.5018.79), dimensions={}, metadata={scheduling_name="broadcast.6100.23"}
  %multiply.2798.11 = f32[768,32768]{1,0} multiply(%convert.4422.9, %broadcast.6100.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2798.11"}
  %add.3146.9 = f32[768,32768]{1,0} add(%multiply.2797.11, %multiply.2798.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3146.9"}
  %param_3.3797 = f32[] parameter(3), metadata={scheduling_name="param_3.3797"}
  %broadcast.6102.14 = f32[768,32768]{1,0} broadcast(%param_3.3797), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6102.14"}
  %multiply.2799.15 = f32[768,32768]{1,0} multiply(%convert.4420.26, %convert.4420.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2799.15"}
  %constant_3247_35 = bf16[] constant(0.05005)
  %convert.5021.79 = f32[] convert(%constant_3247_35), metadata={scheduling_name="convert.5021.79"}
  %broadcast.6104.23 = f32[768,32768]{1,0} broadcast(%convert.5021.79), dimensions={}, metadata={scheduling_name="broadcast.6104.23"}
  %multiply.2800.11 = f32[768,32768]{1,0} multiply(%multiply.2799.15, %broadcast.6104.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2800.11"}
  %param_2.4614 = bf16[768,32768]{1,0} parameter(2), metadata={scheduling_name="param_2.4614"}
  %convert.4428.9 = f32[768,32768]{1,0} convert(%param_2.4614), metadata={scheduling_name="convert.4428.9"}
  %constant_3248_35 = bf16[] constant(0.9492)
  %convert.5023.79 = f32[] convert(%constant_3248_35), metadata={scheduling_name="convert.5023.79"}
  %broadcast.6106.23 = f32[768,32768]{1,0} broadcast(%convert.5023.79), dimensions={}, metadata={scheduling_name="broadcast.6106.23"}
  %multiply.2801.11 = f32[768,32768]{1,0} multiply(%convert.4428.9, %broadcast.6106.23), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2801.11"}
  %add.3147.9 = f32[768,32768]{1,0} add(%multiply.2800.11, %multiply.2801.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3147.9"}
  %param_1.6429 = f32[] parameter(1), metadata={scheduling_name="param_1.6429"}
  %broadcast.6108.22 = f32[768,32768]{1,0} broadcast(%param_1.6429), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6108.22"}
  %divide.482.13 = f32[768,32768]{1,0} divide(%add.3147.9, %broadcast.6108.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.482.13"}
  %sqrt.83.11 = f32[768,32768]{1,0} sqrt(%divide.482.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.83.11"}
  %constant_3251_3 = bf16[] constant(1.001e-08)
  %convert.5025.56 = f32[] convert(%constant_3251_3), metadata={scheduling_name="convert.5025.56"}
  %broadcast.6110.14 = f32[768,32768]{1,0} broadcast(%convert.5025.56), dimensions={}, metadata={scheduling_name="broadcast.6110.14"}
  %add.3148.9 = f32[768,32768]{1,0} add(%sqrt.83.11, %broadcast.6110.14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3148.9"}
  %multiply.2802.9 = f32[768,32768]{1,0} multiply(%broadcast.6102.14, %add.3148.9), metadata={scheduling_name="multiply.2802.9"}
  %divide.483.7 = f32[768,32768]{1,0} divide(%add.3146.9, %multiply.2802.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.483.7"}
  %multiply.2803.11 = f32[768,32768]{1,0} multiply(%convert.4415.16, %broadcast.6098.38), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2803.11"}
  %add.3149.9 = f32[768,32768]{1,0} add(%divide.483.7, %multiply.2803.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3149.9"}
  %multiply.2804.7 = f32[768,32768]{1,0} multiply(%broadcast.6094.10, %add.3149.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2804.7"}
  %add.3150.5 = f32[768,32768]{1,0} add(%convert.4415.16, %multiply.2804.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3150.5"}
  %convert.4434.1 = bf16[768,32768]{1,0} convert(%add.3150.5), metadata={scheduling_name="convert.4434.1"}
  %convert.4917.1.clone.1 = bf16[768,32768]{1,0} convert(%add.3146.9), metadata={scheduling_name="convert.4917.1.clone.1"}
  %multiply.2987.1.clone.1 = f32[768,32768]{1,0} multiply(%add.3150.5, %add.3150.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2987.1.clone.1"}
  %bitcast.29965.1.clone.1 = f32[4096,6144]{1,0} bitcast(%multiply.2987.1.clone.1), metadata={scheduling_name="bitcast.29965.1.clone.1"}
  %constant_3026_121_clone_1 = f32[] constant(0)
  %reduce.669.1.clone.1 = f32[4096]{0} reduce(%bitcast.29965.1.clone.1, %constant_3026_121_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.669.1.clone.1"}
  %convert.4952.1.clone.1 = bf16[768,32768]{1,0} convert(%add.3147.9), metadata={scheduling_name="convert.4952.1.clone.1"}
  %bitcast.29539.1.clone.1 = f32[4096,6144]{1,0} bitcast(%multiply.2799.15), metadata={scheduling_name="bitcast.29539.1.clone.1"}
  %reduce.633.1.clone.1 = f32[4096]{0} reduce(%bitcast.29539.1.clone.1, %constant_3026_121_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.633.1.clone.1"}
  ROOT %tuple.625 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}, f32[4096]{0}, bf16[768,32768]{1,0}, f32[4096]{0}) tuple(%convert.4434.1, %convert.4917.1.clone.1, %reduce.669.1.clone.1, %convert.4952.1.clone.1, %reduce.633.1.clone.1), metadata={scheduling_name="tuple.625"}
}

%fused_convert_reduce.17 (param_0.6008: bf16[2,1,48,128,768], param_1.6434: f32[], param_2.4622: bf16[2,1,48,128,768], param_3.3805: f32[], param_4.2778: bf16[2,1,48,128,768], param_5.2554: bf16[2,1,48,128,768], param_6.2306: f32[], param_7.2132: pred[], param_8.1971: f32[]) -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768], f32[2048], bf16[2,1,48,128,768], f32[2048]) {
  %param_0.6008 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6008"}
  %convert.4575.16 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.6008), metadata={scheduling_name="convert.4575.16"}
  %param_8.1971 = f32[] parameter(8), metadata={scheduling_name="param_8.1971"}
  %broadcast.6238.10 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_8.1971), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6238.10"}
  %param_7.2132 = pred[] parameter(7), metadata={scheduling_name="param_7.2132"}
  %broadcast.5931.22 = pred[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_7.2132), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5931.22"}
  %param_5.2554 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2554"}
  %convert.4364.20 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_5.2554), metadata={scheduling_name="convert.4364.20"}
  %param_6.2306 = f32[] parameter(6), metadata={scheduling_name="param_6.2306"}
  %broadcast.6240.30 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_6.2306), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6240.30"}
  %divide.505.17 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%convert.4364.20, %broadcast.6240.30), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.505.17"}
  %convert.4579.15 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%divide.505.17), metadata={scheduling_name="convert.4579.15"}
  %select.1378.13 = bf16[2,1,48,128,768]{4,3,2,1,0} select(%broadcast.5931.22, %param_5.2554, %convert.4579.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1378.13"}
  %convert.4580.26 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%select.1378.13), metadata={scheduling_name="convert.4580.26"}
  %constant_3240_42 = bf16[] constant(0.1001)
  %convert.5017.168 = f32[] convert(%constant_3240_42), metadata={scheduling_name="convert.5017.168"}
  %broadcast.6242.41 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5017.168), dimensions={}, metadata={scheduling_name="broadcast.6242.41"}
  %multiply.2861.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4580.26, %broadcast.6242.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2861.11"}
  %param_4.2778 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2778"}
  %convert.4582.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_4.2778), metadata={scheduling_name="convert.4582.9"}
  %constant_3241_39 = bf16[] constant(0.8984)
  %convert.5018.91 = f32[] convert(%constant_3241_39), metadata={scheduling_name="convert.5018.91"}
  %broadcast.6244.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5018.91), dimensions={}, metadata={scheduling_name="broadcast.6244.21"}
  %multiply.2862.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4582.9, %broadcast.6244.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2862.11"}
  %add.3186.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2861.11, %multiply.2862.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3186.9"}
  %param_3.3805 = f32[] parameter(3), metadata={scheduling_name="param_3.3805"}
  %broadcast.6246.14 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_3.3805), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6246.14"}
  %multiply.2863.15 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4580.26, %convert.4580.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2863.15"}
  %constant_3247_39 = bf16[] constant(0.05005)
  %convert.5021.91 = f32[] convert(%constant_3247_39), metadata={scheduling_name="convert.5021.91"}
  %broadcast.6248.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5021.91), dimensions={}, metadata={scheduling_name="broadcast.6248.21"}
  %multiply.2864.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%multiply.2863.15, %broadcast.6248.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2864.11"}
  %param_2.4622 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4622"}
  %convert.4588.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_2.4622), metadata={scheduling_name="convert.4588.9"}
  %constant_3248_39 = bf16[] constant(0.9492)
  %convert.5023.91 = f32[] convert(%constant_3248_39), metadata={scheduling_name="convert.5023.91"}
  %broadcast.6250.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5023.91), dimensions={}, metadata={scheduling_name="broadcast.6250.21"}
  %multiply.2865.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4588.9, %broadcast.6250.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2865.11"}
  %add.3187.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2864.11, %multiply.2865.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3187.9"}
  %param_1.6434 = f32[] parameter(1), metadata={scheduling_name="param_1.6434"}
  %broadcast.6252.22 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_1.6434), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6252.22"}
  %divide.506.13 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3187.9, %broadcast.6252.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.506.13"}
  %sqrt.91.11 = f32[2,1,48,128,768]{4,3,2,1,0} sqrt(%divide.506.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.91.11"}
  %constant_3251_31 = bf16[] constant(1.001e-08)
  %convert.5025.68 = f32[] convert(%constant_3251_31), metadata={scheduling_name="convert.5025.68"}
  %broadcast.6254.17 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5025.68), dimensions={}, metadata={scheduling_name="broadcast.6254.17"}
  %add.3188.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%sqrt.91.11, %broadcast.6254.17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3188.9"}
  %multiply.2866.9 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6246.14, %add.3188.9), metadata={scheduling_name="multiply.2866.9"}
  %divide.507.7 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3186.9, %multiply.2866.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.507.7"}
  %multiply.2867.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4575.16, %broadcast.6242.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2867.11"}
  %add.3189.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%divide.507.7, %multiply.2867.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3189.9"}
  %multiply.2868.7 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6238.10, %add.3189.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2868.7"}
  %add.3190.5 = f32[2,1,48,128,768]{4,3,2,1,0} add(%convert.4575.16, %multiply.2868.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3190.5"}
  %convert.4595.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3190.5), metadata={scheduling_name="convert.4595.1"}
  %convert.4929.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3186.9), metadata={scheduling_name="convert.4929.1.clone.1"}
  %multiply.2997.1.clone.1 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%add.3190.5, %add.3190.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2997.1.clone.1"}
  %bitcast.30109.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2997.1.clone.1), metadata={scheduling_name="bitcast.30109.1.clone.1"}
  %constant_3026_126_clone_1 = f32[] constant(0)
  %reduce.679.1.clone.1 = f32[2048]{0} reduce(%bitcast.30109.1.clone.1, %constant_3026_126_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.679.1.clone.1"}
  %convert.4960.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3187.9), metadata={scheduling_name="convert.4960.1.clone.1"}
  %bitcast.29675.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2863.15), metadata={scheduling_name="bitcast.29675.1.clone.1"}
  %reduce.643.1.clone.1 = f32[2048]{0} reduce(%bitcast.29675.1.clone.1, %constant_3026_126_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.643.1.clone.1"}
  ROOT %tuple.630 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4595.1, %convert.4929.1.clone.1, %reduce.679.1.clone.1, %convert.4960.1.clone.1, %reduce.643.1.clone.1), metadata={scheduling_name="tuple.630"}
}

%fused_convert_reduce.18 (param_0.6007: bf16[2,1,768,48,128], param_1.6433: f32[], param_2.4621: bf16[2,1,768,48,128], param_3.3804: f32[], param_4.2777: bf16[2,1,768,48,128], param_5.2553: bf16[2,1,768,48,128], param_6.2305: f32[], param_7.2131: pred[], param_8.1970: f32[]) -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128], f32[2048], bf16[2,1,768,48,128], f32[2048]) {
  %param_0.6007 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6007"}
  %convert.4596.16 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.6007), metadata={scheduling_name="convert.4596.16"}
  %param_8.1970 = f32[] parameter(8), metadata={scheduling_name="param_8.1970"}
  %broadcast.6258.10 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_8.1970), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6258.10"}
  %param_7.2131 = pred[] parameter(7), metadata={scheduling_name="param_7.2131"}
  %broadcast.5942.22 = pred[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_7.2131), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5942.22"}
  %param_5.2553 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2553"}
  %convert.4366.20 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_5.2553), metadata={scheduling_name="convert.4366.20"}
  %param_6.2305 = f32[] parameter(6), metadata={scheduling_name="param_6.2305"}
  %broadcast.6260.30 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_6.2305), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6260.30"}
  %divide.508.17 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%convert.4366.20, %broadcast.6260.30), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.508.17"}
  %convert.4602.15 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%divide.508.17), metadata={scheduling_name="convert.4602.15"}
  %select.1379.13 = bf16[2,1,768,48,128]{4,3,2,1,0} select(%broadcast.5942.22, %param_5.2553, %convert.4602.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1379.13"}
  %convert.4604.26 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%select.1379.13), metadata={scheduling_name="convert.4604.26"}
  %constant_3240_39 = bf16[] constant(0.1001)
  %convert.5017.176 = f32[] convert(%constant_3240_39), metadata={scheduling_name="convert.5017.176"}
  %broadcast.6262.41 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5017.176), dimensions={}, metadata={scheduling_name="broadcast.6262.41"}
  %multiply.2869.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4604.26, %broadcast.6262.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2869.11"}
  %param_4.2777 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2777"}
  %convert.4607.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_4.2777), metadata={scheduling_name="convert.4607.9"}
  %constant_3241_38 = bf16[] constant(0.8984)
  %convert.5018.95 = f32[] convert(%constant_3241_38), metadata={scheduling_name="convert.5018.95"}
  %broadcast.6264.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5018.95), dimensions={}, metadata={scheduling_name="broadcast.6264.21"}
  %multiply.2870.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4607.9, %broadcast.6264.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2870.11"}
  %add.3191.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2869.11, %multiply.2870.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3191.9"}
  %param_3.3804 = f32[] parameter(3), metadata={scheduling_name="param_3.3804"}
  %broadcast.6266.14 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_3.3804), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6266.14"}
  %multiply.2871.15 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4604.26, %convert.4604.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2871.15"}
  %constant_3247_38 = bf16[] constant(0.05005)
  %convert.5021.95 = f32[] convert(%constant_3247_38), metadata={scheduling_name="convert.5021.95"}
  %broadcast.6268.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5021.95), dimensions={}, metadata={scheduling_name="broadcast.6268.21"}
  %multiply.2872.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%multiply.2871.15, %broadcast.6268.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2872.11"}
  %param_2.4621 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4621"}
  %convert.4616.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_2.4621), metadata={scheduling_name="convert.4616.9"}
  %constant_3248_38 = bf16[] constant(0.9492)
  %convert.5023.95 = f32[] convert(%constant_3248_38), metadata={scheduling_name="convert.5023.95"}
  %broadcast.6270.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5023.95), dimensions={}, metadata={scheduling_name="broadcast.6270.21"}
  %multiply.2873.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4616.9, %broadcast.6270.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2873.11"}
  %add.3192.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2872.11, %multiply.2873.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3192.9"}
  %param_1.6433 = f32[] parameter(1), metadata={scheduling_name="param_1.6433"}
  %broadcast.6272.22 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_1.6433), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6272.22"}
  %divide.509.13 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3192.9, %broadcast.6272.22), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.509.13"}
  %sqrt.92.11 = f32[2,1,768,48,128]{4,3,2,1,0} sqrt(%divide.509.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.92.11"}
  %constant_3251_30 = bf16[] constant(1.001e-08)
  %convert.5025.72 = f32[] convert(%constant_3251_30), metadata={scheduling_name="convert.5025.72"}
  %broadcast.6274.17 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5025.72), dimensions={}, metadata={scheduling_name="broadcast.6274.17"}
  %add.3193.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%sqrt.92.11, %broadcast.6274.17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3193.9"}
  %multiply.2874.9 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6266.14, %add.3193.9), metadata={scheduling_name="multiply.2874.9"}
  %divide.510.7 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3191.9, %multiply.2874.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.510.7"}
  %multiply.2875.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4596.16, %broadcast.6262.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2875.11"}
  %add.3194.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%divide.510.7, %multiply.2875.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3194.9"}
  %multiply.2876.7 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6258.10, %add.3194.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2876.7"}
  %add.3195.5 = f32[2,1,768,48,128]{4,3,2,1,0} add(%convert.4596.16, %multiply.2876.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3195.5"}
  %convert.4625.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3195.5), metadata={scheduling_name="convert.4625.1"}
  %convert.4931.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3191.9), metadata={scheduling_name="convert.4931.1.clone.1"}
  %multiply.2999.1.clone.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%add.3195.5, %add.3195.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2999.1.clone.1"}
  %bitcast.30127.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2999.1.clone.1), metadata={scheduling_name="bitcast.30127.1.clone.1"}
  %constant_3026_127_clone_1 = f32[] constant(0)
  %reduce.681.1.clone.1 = f32[2048]{0} reduce(%bitcast.30127.1.clone.1, %constant_3026_127_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.681.1.clone.1"}
  %convert.4961.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3192.9), metadata={scheduling_name="convert.4961.1.clone.1"}
  %bitcast.29692.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2871.15), metadata={scheduling_name="bitcast.29692.1.clone.1"}
  %reduce.645.1.clone.1 = f32[2048]{0} reduce(%bitcast.29692.1.clone.1, %constant_3026_127_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.645.1.clone.1"}
  ROOT %tuple.631 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4625.1, %convert.4931.1.clone.1, %reduce.681.1.clone.1, %convert.4961.1.clone.1, %reduce.645.1.clone.1), metadata={scheduling_name="tuple.631"}
}

%fused_convert_reduce.19 (param_0.6004: bf16[2,1,48,128,768], param_1.6431: f32[], param_2.4619: bf16[2,1,48,128,768], param_3.3802: f32[], param_4.2775: bf16[2,1,48,128,768], param_5.2551: bf16[2,1,48,128,768], param_6.2303: f32[], param_7.2129: pred[], param_8.1968: f32[]) -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768], f32[2048], bf16[2,1,48,128,768], f32[2048]) {
  %param_0.6004 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6004"}
  %convert.4823.16 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_0.6004), metadata={scheduling_name="convert.4823.16"}
  %param_8.1968 = f32[] parameter(8), metadata={scheduling_name="param_8.1968"}
  %broadcast.6238.14 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_8.1968), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6238.14"}
  %param_7.2129 = pred[] parameter(7), metadata={scheduling_name="param_7.2129"}
  %broadcast.5931.26 = pred[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_7.2129), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5931.26"}
  %param_5.2551 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2551"}
  %convert.4384.20 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_5.2551), metadata={scheduling_name="convert.4384.20"}
  %param_6.2303 = f32[] parameter(6), metadata={scheduling_name="param_6.2303"}
  %broadcast.6240.34 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_6.2303), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6240.34"}
  %divide.535.17 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%convert.4384.20, %broadcast.6240.34), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.535.17"}
  %convert.4827.15 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%divide.535.17), metadata={scheduling_name="convert.4827.15"}
  %select.1388.13 = bf16[2,1,48,128,768]{4,3,2,1,0} select(%broadcast.5931.26, %param_5.2551, %convert.4827.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1388.13"}
  %convert.4828.26 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%select.1388.13), metadata={scheduling_name="convert.4828.26"}
  %constant_3240_18 = bf16[] constant(0.1001)
  %convert.5017.184 = f32[] convert(%constant_3240_18), metadata={scheduling_name="convert.5017.184"}
  %broadcast.6242.49 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5017.184), dimensions={}, metadata={scheduling_name="broadcast.6242.49"}
  %multiply.2947.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4828.26, %broadcast.6242.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2947.11"}
  %param_4.2775 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2775"}
  %convert.4830.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_4.2775), metadata={scheduling_name="convert.4830.9"}
  %constant_3241_18 = bf16[] constant(0.8984)
  %convert.5018.99 = f32[] convert(%constant_3241_18), metadata={scheduling_name="convert.5018.99"}
  %broadcast.6244.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5018.99), dimensions={}, metadata={scheduling_name="broadcast.6244.25"}
  %multiply.2948.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4830.9, %broadcast.6244.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2948.11"}
  %add.3237.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2947.11, %multiply.2948.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3237.9"}
  %param_3.3802 = f32[] parameter(3), metadata={scheduling_name="param_3.3802"}
  %broadcast.6246.18 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_3.3802), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6246.18"}
  %multiply.2950.15 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4828.26, %convert.4828.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2950.15"}
  %constant_3247_18 = bf16[] constant(0.05005)
  %convert.5021.99 = f32[] convert(%constant_3247_18), metadata={scheduling_name="convert.5021.99"}
  %broadcast.6248.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5021.99), dimensions={}, metadata={scheduling_name="broadcast.6248.25"}
  %multiply.2951.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%multiply.2950.15, %broadcast.6248.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2951.11"}
  %param_2.4619 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4619"}
  %convert.4836.9 = f32[2,1,48,128,768]{4,3,2,1,0} convert(%param_2.4619), metadata={scheduling_name="convert.4836.9"}
  %constant_3248_18 = bf16[] constant(0.9492)
  %convert.5023.99 = f32[] convert(%constant_3248_18), metadata={scheduling_name="convert.5023.99"}
  %broadcast.6250.25 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5023.99), dimensions={}, metadata={scheduling_name="broadcast.6250.25"}
  %multiply.2952.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4836.9, %broadcast.6250.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2952.11"}
  %add.3238.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%multiply.2951.11, %multiply.2952.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3238.9"}
  %param_1.6431 = f32[] parameter(1), metadata={scheduling_name="param_1.6431"}
  %broadcast.6252.26 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%param_1.6431), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6252.26"}
  %divide.536.13 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3238.9, %broadcast.6252.26), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.536.13"}
  %sqrt.101.11 = f32[2,1,48,128,768]{4,3,2,1,0} sqrt(%divide.536.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.101.11"}
  %constant_3251_18 = bf16[] constant(1.001e-08)
  %convert.5025.76 = f32[] convert(%constant_3251_18), metadata={scheduling_name="convert.5025.76"}
  %broadcast.6254.21 = f32[2,1,48,128,768]{4,3,2,1,0} broadcast(%convert.5025.76), dimensions={}, metadata={scheduling_name="broadcast.6254.21"}
  %add.3239.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%sqrt.101.11, %broadcast.6254.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3239.9"}
  %multiply.2954.9 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6246.18, %add.3239.9), metadata={scheduling_name="multiply.2954.9"}
  %divide.537.7 = f32[2,1,48,128,768]{4,3,2,1,0} divide(%add.3237.9, %multiply.2954.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.537.7"}
  %multiply.2955.11 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%convert.4823.16, %broadcast.6242.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2955.11"}
  %add.3241.9 = f32[2,1,48,128,768]{4,3,2,1,0} add(%divide.537.7, %multiply.2955.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3241.9"}
  %multiply.2956.7 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%broadcast.6238.14, %add.3241.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2956.7"}
  %add.3242.5 = f32[2,1,48,128,768]{4,3,2,1,0} add(%convert.4823.16, %multiply.2956.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3242.5"}
  %convert.4842.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3242.5), metadata={scheduling_name="convert.4842.1"}
  %convert.4944.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3237.9), metadata={scheduling_name="convert.4944.1.clone.1"}
  %multiply.3009.1.clone.1 = f32[2,1,48,128,768]{4,3,2,1,0} multiply(%add.3242.5, %add.3242.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3009.1.clone.1"}
  %bitcast.30289.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.3009.1.clone.1), metadata={scheduling_name="bitcast.30289.1.clone.1"}
  %constant_3026_133_clone_1 = f32[] constant(0)
  %reduce.693.1.clone.1 = f32[2048]{0} reduce(%bitcast.30289.1.clone.1, %constant_3026_133_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.693.1.clone.1"}
  %convert.4970.1.clone.1 = bf16[2,1,48,128,768]{4,3,2,1,0} convert(%add.3238.9), metadata={scheduling_name="convert.4970.1.clone.1"}
  %bitcast.29845.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2950.15), metadata={scheduling_name="bitcast.29845.1.clone.1"}
  %reduce.657.1.clone.1 = f32[2048]{0} reduce(%bitcast.29845.1.clone.1, %constant_3026_133_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.657.1.clone.1"}
  ROOT %tuple.637 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4842.1, %convert.4944.1.clone.1, %reduce.693.1.clone.1, %convert.4970.1.clone.1, %reduce.657.1.clone.1), metadata={scheduling_name="tuple.637"}
}

%fused_convert_reduce.20 (param_0.6005: bf16[2,1,768,48,128], param_1.6432: f32[], param_2.4620: bf16[2,1,768,48,128], param_3.3803: f32[], param_4.2776: bf16[2,1,768,48,128], param_5.2552: bf16[2,1,768,48,128], param_6.2304: f32[], param_7.2130: pred[], param_8.1969: f32[]) -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128], f32[2048], bf16[2,1,768,48,128], f32[2048]) {
  %param_0.6005 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6005"}
  %convert.4843.16 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_0.6005), metadata={scheduling_name="convert.4843.16"}
  %param_8.1969 = f32[] parameter(8), metadata={scheduling_name="param_8.1969"}
  %broadcast.6258.14 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_8.1969), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6258.14"}
  %param_7.2130 = pred[] parameter(7), metadata={scheduling_name="param_7.2130"}
  %broadcast.5942.26 = pred[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_7.2130), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5942.26"}
  %param_5.2552 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2552"}
  %convert.4386.20 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_5.2552), metadata={scheduling_name="convert.4386.20"}
  %param_6.2304 = f32[] parameter(6), metadata={scheduling_name="param_6.2304"}
  %broadcast.6260.34 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_6.2304), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6260.34"}
  %divide.538.17 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%convert.4386.20, %broadcast.6260.34), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.538.17"}
  %convert.4847.15 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%divide.538.17), metadata={scheduling_name="convert.4847.15"}
  %select.1389.13 = bf16[2,1,768,48,128]{4,3,2,1,0} select(%broadcast.5942.26, %param_5.2552, %convert.4847.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1389.13"}
  %convert.4848.26 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%select.1389.13), metadata={scheduling_name="convert.4848.26"}
  %constant_3240_19 = bf16[] constant(0.1001)
  %convert.5017.192 = f32[] convert(%constant_3240_19), metadata={scheduling_name="convert.5017.192"}
  %broadcast.6262.49 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5017.192), dimensions={}, metadata={scheduling_name="broadcast.6262.49"}
  %multiply.2957.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4848.26, %broadcast.6262.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2957.11"}
  %param_4.2776 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2776"}
  %convert.4850.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_4.2776), metadata={scheduling_name="convert.4850.9"}
  %constant_3241_19 = bf16[] constant(0.8984)
  %convert.5018.103 = f32[] convert(%constant_3241_19), metadata={scheduling_name="convert.5018.103"}
  %broadcast.6264.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5018.103), dimensions={}, metadata={scheduling_name="broadcast.6264.25"}
  %multiply.2959.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4850.9, %broadcast.6264.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2959.11"}
  %add.3243.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2957.11, %multiply.2959.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3243.9"}
  %param_3.3803 = f32[] parameter(3), metadata={scheduling_name="param_3.3803"}
  %broadcast.6266.18 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_3.3803), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6266.18"}
  %multiply.2960.15 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4848.26, %convert.4848.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2960.15"}
  %constant_3247_19 = bf16[] constant(0.05005)
  %convert.5021.103 = f32[] convert(%constant_3247_19), metadata={scheduling_name="convert.5021.103"}
  %broadcast.6268.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5021.103), dimensions={}, metadata={scheduling_name="broadcast.6268.25"}
  %multiply.2961.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%multiply.2960.15, %broadcast.6268.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2961.11"}
  %param_2.4620 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4620"}
  %convert.4856.9 = f32[2,1,768,48,128]{4,3,2,1,0} convert(%param_2.4620), metadata={scheduling_name="convert.4856.9"}
  %constant_3248_19 = bf16[] constant(0.9492)
  %convert.5023.103 = f32[] convert(%constant_3248_19), metadata={scheduling_name="convert.5023.103"}
  %broadcast.6270.25 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5023.103), dimensions={}, metadata={scheduling_name="broadcast.6270.25"}
  %multiply.2963.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4856.9, %broadcast.6270.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2963.11"}
  %add.3244.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%multiply.2961.11, %multiply.2963.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3244.9"}
  %param_1.6432 = f32[] parameter(1), metadata={scheduling_name="param_1.6432"}
  %broadcast.6272.26 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%param_1.6432), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6272.26"}
  %divide.539.13 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3244.9, %broadcast.6272.26), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.539.13"}
  %sqrt.102.11 = f32[2,1,768,48,128]{4,3,2,1,0} sqrt(%divide.539.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.102.11"}
  %constant_3251_19 = bf16[] constant(1.001e-08)
  %convert.5025.80 = f32[] convert(%constant_3251_19), metadata={scheduling_name="convert.5025.80"}
  %broadcast.6274.21 = f32[2,1,768,48,128]{4,3,2,1,0} broadcast(%convert.5025.80), dimensions={}, metadata={scheduling_name="broadcast.6274.21"}
  %add.3245.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%sqrt.102.11, %broadcast.6274.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3245.9"}
  %multiply.2964.9 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6266.18, %add.3245.9), metadata={scheduling_name="multiply.2964.9"}
  %divide.540.7 = f32[2,1,768,48,128]{4,3,2,1,0} divide(%add.3243.9, %multiply.2964.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.540.7"}
  %multiply.2965.11 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%convert.4843.16, %broadcast.6262.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2965.11"}
  %add.3246.9 = f32[2,1,768,48,128]{4,3,2,1,0} add(%divide.540.7, %multiply.2965.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3246.9"}
  %multiply.2966.7 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%broadcast.6258.14, %add.3246.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2966.7"}
  %add.3247.5 = f32[2,1,768,48,128]{4,3,2,1,0} add(%convert.4843.16, %multiply.2966.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3247.5"}
  %convert.4863.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3247.5), metadata={scheduling_name="convert.4863.1"}
  %convert.4946.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3243.9), metadata={scheduling_name="convert.4946.1.clone.1"}
  %multiply.3010.1.clone.1 = f32[2,1,768,48,128]{4,3,2,1,0} multiply(%add.3247.5, %add.3247.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3010.1.clone.1"}
  %bitcast.30307.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.3010.1.clone.1), metadata={scheduling_name="bitcast.30307.1.clone.1"}
  %constant_3026_134_clone_1 = f32[] constant(0)
  %reduce.695.1.clone.1 = f32[2048]{0} reduce(%bitcast.30307.1.clone.1, %constant_3026_134_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.695.1.clone.1"}
  %convert.4971.1.clone.1 = bf16[2,1,768,48,128]{4,3,2,1,0} convert(%add.3244.9), metadata={scheduling_name="convert.4971.1.clone.1"}
  %bitcast.29862.1.clone.1 = f32[2048,4608]{1,0} bitcast(%multiply.2960.15), metadata={scheduling_name="bitcast.29862.1.clone.1"}
  %reduce.659.1.clone.1 = f32[2048]{0} reduce(%bitcast.29862.1.clone.1, %constant_3026_134_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.659.1.clone.1"}
  ROOT %tuple.638 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) tuple(%convert.4863.1, %convert.4946.1.clone.1, %reduce.695.1.clone.1, %convert.4971.1.clone.1, %reduce.659.1.clone.1), metadata={scheduling_name="tuple.638"}
}

%fused_select.2 (param_0.5999: s32[], param_1.6369: s32[8,8192]) -> f32[8,8192] {
  %param_1.6369 = s32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6369"}
  %constant_2984_7 = s32[] constant(0)
  %broadcast.5804.3 = s32[8,8192]{1,0} broadcast(%constant_2984_7), dimensions={}, metadata={scheduling_name="broadcast.5804.3"}
  %compare.1723.3 = pred[8,8192]{1,0} compare(%param_1.6369, %broadcast.5804.3), direction=NE, metadata={op_name="jit(train_step)/jit(main)/ne" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="compare.1723.3"}
  %constant_2982_4 = f32[] constant(1)
  %param_0.5999 = s32[] parameter(0), metadata={scheduling_name="param_0.5999"}
  %convert.4331.7 = f32[] convert(%param_0.5999), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="convert.4331.7"}
  %constant_3124_1 = f32[] constant(1e-08)
  %add.3113.7 = f32[] add(%convert.4331.7, %constant_3124_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="add.3113.7"}
  %divide.475.3 = f32[] divide(%constant_2982_4, %add.3113.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="divide.475.3"}
  %broadcast.5805.1 = f32[8,8192]{1,0} broadcast(%divide.475.3), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="broadcast.5805.1"}
  %constant_3026_146 = f32[] constant(0)
  %broadcast.5806.1 = f32[8,8192]{1,0} broadcast(%constant_3026_146), dimensions={}, metadata={scheduling_name="broadcast.5806.1"}
  ROOT %select.1367.1 = f32[8,8192]{1,0} select(%compare.1723.3, %broadcast.5805.1, %broadcast.5806.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="select.1367.1"}
}

%fused_multiply.6 (param_0.6002: f32[1,8,8192], param_1.6373: f32[8,8192], param_2.4533: f32[8,8192]) -> f32[1,8,8192] {
  %param_1.6373 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6373"}
  %bitcast.26806.3 = f32[1,8,8192]{2,1,0} bitcast(%param_1.6373), metadata={scheduling_name="bitcast.26806.3"}
  %param_0.6002 = f32[1,8,8192]{2,1,0} parameter(0), metadata={scheduling_name="param_0.6002"}
  %param_2.4533 = f32[8,8192]{1,0} parameter(2), metadata={scheduling_name="param_2.4533"}
  %constant_3119_2 = f32[] constant(0.000162760422)
  %broadcast.5801.5 = f32[8,8192]{1,0} broadcast(%constant_3119_2), dimensions={}, metadata={scheduling_name="broadcast.5801.5"}
  %multiply.2752.5 = f32[8,8192]{1,0} multiply(%param_2.4533, %broadcast.5801.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2752.5"}
  %constant_3120_2 = f32[] constant(1e-05)
  %broadcast.5802.3 = f32[8,8192]{1,0} broadcast(%constant_3120_2), dimensions={}, metadata={scheduling_name="broadcast.5802.3"}
  %add.3112.3 = f32[8,8192]{1,0} add(%multiply.2752.5, %broadcast.5802.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/add" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="add.3112.3"}
  %bitcast.26539.6 = f32[1,8,8192]{2,1,0} bitcast(%add.3112.3), metadata={scheduling_name="bitcast.26539.6"}
  %divide.477.5 = f32[1,8,8192]{2,1,0} divide(%param_0.6002, %bitcast.26539.6), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/div" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="divide.477.5"}
  %constant_3155_1 = f32[] constant(-0.5)
  %broadcast.5839.5 = f32[1,8,8192]{2,1,0} broadcast(%constant_3155_1), dimensions={}, metadata={scheduling_name="broadcast.5839.5"}
  %multiply.2764.5 = f32[1,8,8192]{2,1,0} multiply(%divide.477.5, %broadcast.5839.5), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2764.5"}
  %multiply.2765.3 = f32[1,8,8192]{2,1,0} multiply(%bitcast.26806.3, %multiply.2764.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="multiply.2765.3"}
  %constant_3156_1 = f32[] constant(0.000325520843)
  %broadcast.5840.1 = f32[1,8,8192]{2,1,0} broadcast(%constant_3156_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="broadcast.5840.1"}
  ROOT %multiply.2766.1 = f32[1,8,8192]{2,1,0} multiply(%multiply.2765.3, %broadcast.5840.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="multiply.2766.1"}
}

%fused_add_log (param_0.6077: f32[65536], param_1.6478: f32[8,8192]) -> (f32[8,8192], f32[8,8192]) {
  %param_1.6478 = f32[8,8192]{1,0} parameter(1), metadata={scheduling_name="param_1.6478"}
  %log.6.1 = f32[8,8192]{1,0} log(%param_1.6478), metadata={op_name="jit(train_step)/jit(main)/log" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="log.6.1"}
  %param_0.6077 = f32[65536]{0} parameter(0), metadata={scheduling_name="param_0.6077"}
  %bitcast.26607.22 = f32[8,8192]{1,0} bitcast(%param_0.6077), metadata={scheduling_name="bitcast.26607.22"}
  %add.3114.5 = f32[8,8192]{1,0} add(%log.6.1, %bitcast.26607.22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=617 scheduling_name="add.3114.5"}
  %constant_3026_3 = f32[] constant(0)
  %broadcast.5806.10 = f32[8,8192]{1,0} broadcast(%constant_3026_3), dimensions={}, metadata={scheduling_name="broadcast.5806.10"}
  %multiply.2755.3 = f32[8,8192]{1,0} multiply(%add.3114.5, %broadcast.5806.10), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="multiply.2755.3"}
  %constant_2982_5 = f32[] constant(1)
  %broadcast.5811.1 = f32[8,8192]{1,0} broadcast(%constant_2982_5), dimensions={}, metadata={scheduling_name="broadcast.5811.1"}
  %add.3115.1 = f32[8,8192]{1,0} add(%multiply.2755.3, %broadcast.5811.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="add.3115.1"}
  ROOT %tuple.645 = (f32[8,8192]{1,0}, f32[8,8192]{1,0}) tuple(%add.3115.1, %log.6.1), metadata={scheduling_name="tuple.645"}
}

%fused_reduce.68 (param_0.5879: bf16[6144]) -> f32[] {
  %param_0.5879 = bf16[6144]{0} parameter(0), metadata={scheduling_name="param_0.5879"}
  %convert.4343.4 = f32[6144]{0} convert(%param_0.5879), metadata={scheduling_name="convert.4343.4"}
  %multiply.2759.3 = f32[6144]{0} multiply(%convert.4343.4, %convert.4343.4), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="multiply.2759.3"}
  %constant_3026_30 = f32[] constant(0)
  ROOT %reduce.183.1 = f32[] reduce(%multiply.2759.3, %constant_3026_30), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.183.1"}
}

%fused_convert_reduce.21 (param_0.5931: f32[6144]) -> (f32[], bf16[6144]) {
  %param_0.5931 = f32[6144]{0} parameter(0), metadata={scheduling_name="param_0.5931"}
  %multiply.2986.1 = f32[6144]{0} multiply(%param_0.5931, %param_0.5931), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2986.1"}
  %constant_3026_82 = f32[] constant(0)
  %reduce.232.1 = f32[] reduce(%multiply.2986.1, %constant_3026_82), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.232.1"}
  %convert.4414.1 = bf16[6144]{0} convert(%param_0.5931), metadata={scheduling_name="convert.4414.1"}
  ROOT %tuple.623 = (f32[], bf16[6144]{0}) tuple(%reduce.232.1, %convert.4414.1), metadata={scheduling_name="tuple.623"}
}

%fused_add_convert_reduce.1 (param_0.5510: bf16[2,1,6144], param_1.5946: f32[], param_2.4617: f32[], param_3.3800: f32[], param_4.2773: bf16[2,1,6144], param_5.2549: bf16[2,1,6144], param_6.2301: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5510 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5510"}
  %convert.4783.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5510), metadata={scheduling_name="convert.4783.1"}
  %param_1.5946 = f32[] parameter(1), metadata={scheduling_name="param_1.5946"}
  %broadcast.6186.6 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5946), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6186.6"}
  %param_5.2549 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2549"}
  %convert.4788.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2549), metadata={scheduling_name="convert.4788.14"}
  %constant_3240_16 = bf16[] constant(0.1001)
  %convert.5017.328 = f32[] convert(%constant_3240_16), metadata={scheduling_name="convert.5017.328"}
  %broadcast.6190.57 = f32[2,1,6144]{2,1,0} broadcast(%convert.5017.328), dimensions={}, metadata={scheduling_name="broadcast.6190.57"}
  %multiply.2931.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4788.14, %broadcast.6190.57), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2931.7"}
  %param_4.2773 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2773"}
  %convert.4790.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2773), metadata={scheduling_name="convert.4790.5"}
  %constant_3241_16 = bf16[] constant(0.8984)
  %convert.5018.169 = f32[] convert(%constant_3241_16), metadata={scheduling_name="convert.5018.169"}
  %broadcast.6192.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.169), dimensions={}, metadata={scheduling_name="broadcast.6192.33"}
  %multiply.2932.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4790.5, %broadcast.6192.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2932.7"}
  %add.3227.5 = f32[2,1,6144]{2,1,0} add(%multiply.2931.7, %multiply.2932.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3227.5"}
  %param_2.4617 = f32[] parameter(2), metadata={scheduling_name="param_2.4617"}
  %broadcast.6194.6 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4617), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.6"}
  %multiply.2933.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4788.14, %convert.4788.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2933.11"}
  %constant_3247_16 = bf16[] constant(0.05005)
  %convert.5021.169 = f32[] convert(%constant_3247_16), metadata={scheduling_name="convert.5021.169"}
  %broadcast.6196.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5021.169), dimensions={}, metadata={scheduling_name="broadcast.6196.33"}
  %multiply.2934.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2933.11, %broadcast.6196.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2934.7"}
  %param_6.2301 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2301"}
  %convert.4796.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2301), metadata={scheduling_name="convert.4796.5"}
  %constant_3248_16 = bf16[] constant(0.9492)
  %convert.5023.171 = f32[] convert(%constant_3248_16), metadata={scheduling_name="convert.5023.171"}
  %broadcast.6198.33 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.171), dimensions={}, metadata={scheduling_name="broadcast.6198.33"}
  %multiply.2935.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4796.5, %broadcast.6198.33), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2935.7"}
  %add.3228.5 = f32[2,1,6144]{2,1,0} add(%multiply.2934.7, %multiply.2935.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3228.5"}
  %param_3.3800 = f32[] parameter(3), metadata={scheduling_name="param_3.3800"}
  %broadcast.6200.8 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3800), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6200.8"}
  %divide.530.5 = f32[2,1,6144]{2,1,0} divide(%add.3228.5, %broadcast.6200.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.530.5"}
  %sqrt.99.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.530.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.99.3"}
  %constant_3251_16 = bf16[] constant(1.001e-08)
  %convert.5025.146 = f32[] convert(%constant_3251_16), metadata={scheduling_name="convert.5025.146"}
  %broadcast.6202.35 = f32[2,1,6144]{2,1,0} broadcast(%convert.5025.146), dimensions={}, metadata={scheduling_name="broadcast.6202.35"}
  %add.3229.9 = f32[2,1,6144]{2,1,0} add(%sqrt.99.3, %broadcast.6202.35), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3229.9"}
  %multiply.2936.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6194.6, %add.3229.9), metadata={scheduling_name="multiply.2936.7"}
  %divide.531.5 = f32[2,1,6144]{2,1,0} divide(%add.3227.5, %multiply.2936.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.531.5"}
  %multiply.2937.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4783.1, %broadcast.6190.57), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2937.5"}
  %add.3230.3 = f32[2,1,6144]{2,1,0} add(%divide.531.5, %multiply.2937.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3230.3"}
  %multiply.2938.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6186.6, %add.3230.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2938.3"}
  %add.3231.1 = f32[2,1,6144]{2,1,0} add(%convert.4783.1, %multiply.2938.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3231.1"}
  %convert.4968.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3228.5), metadata={scheduling_name="convert.4968.1.clone.1"}
  %convert.4941.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3227.5), metadata={scheduling_name="convert.4941.1.clone.1"}
  %bitcast.29813.1.clone.1 = f32[12288]{0} bitcast(%multiply.2933.11), metadata={scheduling_name="bitcast.29813.1.clone.1"}
  %constant_3026_71_clone_1 = f32[] constant(0)
  %reduce.224.1.clone.1 = f32[] reduce(%bitcast.29813.1.clone.1, %constant_3026_71_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.224.1.clone.1"}
  ROOT %tuple.569 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3231.1, %convert.4968.1.clone.1, %convert.4941.1.clone.1, %reduce.224.1.clone.1), metadata={scheduling_name="tuple.569"}
}

%fused_add_convert_reduce.2 (param_0.5513: bf16[2,1,6144], param_1.5951: f32[], param_2.4633: f32[], param_3.3816: f32[], param_4.2789: bf16[2,1,6144], param_5.2565: bf16[2,1,6144], param_6.2317: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5513 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5513"}
  %convert.4763.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5513), metadata={scheduling_name="convert.4763.1"}
  %param_1.5951 = f32[] parameter(1), metadata={scheduling_name="param_1.5951"}
  %broadcast.6186.8 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5951), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6186.8"}
  %param_5.2565 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2565"}
  %convert.4768.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2565), metadata={scheduling_name="convert.4768.14"}
  %constant_3240_61 = bf16[] constant(0.1001)
  %convert.5017.324 = f32[] convert(%constant_3240_61), metadata={scheduling_name="convert.5017.324"}
  %broadcast.6190.53 = f32[2,1,6144]{2,1,0} broadcast(%convert.5017.324), dimensions={}, metadata={scheduling_name="broadcast.6190.53"}
  %multiply.2922.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4768.14, %broadcast.6190.53), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2922.7"}
  %param_4.2789 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2789"}
  %convert.4770.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2789), metadata={scheduling_name="convert.4770.5"}
  %constant_3241_58 = bf16[] constant(0.8984)
  %convert.5018.165 = f32[] convert(%constant_3241_58), metadata={scheduling_name="convert.5018.165"}
  %broadcast.6192.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.165), dimensions={}, metadata={scheduling_name="broadcast.6192.29"}
  %multiply.2923.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4770.5, %broadcast.6192.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2923.7"}
  %add.3222.5 = f32[2,1,6144]{2,1,0} add(%multiply.2922.7, %multiply.2923.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3222.5"}
  %param_2.4633 = f32[] parameter(2), metadata={scheduling_name="param_2.4633"}
  %broadcast.6194.8 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4633), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.8"}
  %multiply.2924.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4768.14, %convert.4768.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2924.11"}
  %constant_3247_58 = bf16[] constant(0.05005)
  %convert.5021.165 = f32[] convert(%constant_3247_58), metadata={scheduling_name="convert.5021.165"}
  %broadcast.6196.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5021.165), dimensions={}, metadata={scheduling_name="broadcast.6196.29"}
  %multiply.2925.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2924.11, %broadcast.6196.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2925.7"}
  %param_6.2317 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2317"}
  %convert.4776.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2317), metadata={scheduling_name="convert.4776.5"}
  %constant_3248_58 = bf16[] constant(0.9492)
  %convert.5023.167 = f32[] convert(%constant_3248_58), metadata={scheduling_name="convert.5023.167"}
  %broadcast.6198.29 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.167), dimensions={}, metadata={scheduling_name="broadcast.6198.29"}
  %multiply.2926.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4776.5, %broadcast.6198.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2926.7"}
  %add.3223.5 = f32[2,1,6144]{2,1,0} add(%multiply.2925.7, %multiply.2926.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3223.5"}
  %param_3.3816 = f32[] parameter(3), metadata={scheduling_name="param_3.3816"}
  %broadcast.6200.12 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3816), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6200.12"}
  %divide.527.5 = f32[2,1,6144]{2,1,0} divide(%add.3223.5, %broadcast.6200.12), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.527.5"}
  %sqrt.98.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.527.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.98.3"}
  %constant_3251_42 = bf16[] constant(1.001e-08)
  %convert.5025.148 = f32[] convert(%constant_3251_42), metadata={scheduling_name="convert.5025.148"}
  %broadcast.6202.37 = f32[2,1,6144]{2,1,0} broadcast(%convert.5025.148), dimensions={}, metadata={scheduling_name="broadcast.6202.37"}
  %add.3224.9 = f32[2,1,6144]{2,1,0} add(%sqrt.98.3, %broadcast.6202.37), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3224.9"}
  %multiply.2928.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6194.8, %add.3224.9), metadata={scheduling_name="multiply.2928.7"}
  %divide.528.5 = f32[2,1,6144]{2,1,0} divide(%add.3222.5, %multiply.2928.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.528.5"}
  %multiply.2929.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4763.1, %broadcast.6190.53), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2929.5"}
  %add.3225.3 = f32[2,1,6144]{2,1,0} add(%divide.528.5, %multiply.2929.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3225.3"}
  %multiply.2930.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6186.8, %add.3225.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2930.3"}
  %add.3226.1 = f32[2,1,6144]{2,1,0} add(%convert.4763.1, %multiply.2930.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3226.1"}
  %convert.4967.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3223.5), metadata={scheduling_name="convert.4967.1.clone.1"}
  %convert.4940.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3222.5), metadata={scheduling_name="convert.4940.1.clone.1"}
  %bitcast.29800.1.clone.1 = f32[12288]{0} bitcast(%multiply.2924.11), metadata={scheduling_name="bitcast.29800.1.clone.1"}
  %constant_3026_70_clone_1 = f32[] constant(0)
  %reduce.223.1.clone.1 = f32[] reduce(%bitcast.29800.1.clone.1, %constant_3026_70_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.223.1.clone.1"}
  ROOT %tuple.573 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3226.1, %convert.4967.1.clone.1, %convert.4940.1.clone.1, %reduce.223.1.clone.1), metadata={scheduling_name="tuple.573"}
}

%fused_add_convert_reduce.3 (param_0.5530: bf16[2,1,768,8], param_1.5978: f32[], param_2.4616: f32[], param_3.3799: f32[], param_4.2772: bf16[2,1,768,8], param_5.2548: bf16[2,1,768,8], param_6.2300: bf16[2,1,768,8]) -> (f32[2,1,768,8], bf16[2,1,768,8], bf16[2,1,768,8], f32[]) {
  %param_0.5530 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5530"}
  %convert.4656.1 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5530), metadata={scheduling_name="convert.4656.1"}
  %param_1.5978 = f32[] parameter(1), metadata={scheduling_name="param_1.5978"}
  %broadcast.6114.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.5978), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6114.4"}
  %param_5.2548 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2548"}
  %convert.4664.14 = f32[2,1,768,8]{3,2,1,0} convert(%param_5.2548), metadata={scheduling_name="convert.4664.14"}
  %constant_3240_13 = bf16[] constant(0.1001)
  %convert.5017.336 = f32[] convert(%constant_3240_13), metadata={scheduling_name="convert.5017.336"}
  %broadcast.6118.29 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5017.336), dimensions={}, metadata={scheduling_name="broadcast.6118.29"}
  %multiply.2885.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4664.14, %broadcast.6118.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2885.7"}
  %param_4.2772 = bf16[2,1,768,8]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2772"}
  %convert.4667.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_4.2772), metadata={scheduling_name="convert.4667.5"}
  %constant_3241_13 = bf16[] constant(0.8984)
  %convert.5018.177 = f32[] convert(%constant_3241_13), metadata={scheduling_name="convert.5018.177"}
  %broadcast.6120.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5018.177), dimensions={}, metadata={scheduling_name="broadcast.6120.17"}
  %multiply.2886.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4667.5, %broadcast.6120.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2886.7"}
  %add.3202.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2885.7, %multiply.2886.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3202.5"}
  %param_2.4616 = f32[] parameter(2), metadata={scheduling_name="param_2.4616"}
  %broadcast.6122.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_2.4616), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6122.4"}
  %multiply.2887.11 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4664.14, %convert.4664.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2887.11"}
  %constant_3247_13 = bf16[] constant(0.05005)
  %convert.5021.177 = f32[] convert(%constant_3247_13), metadata={scheduling_name="convert.5021.177"}
  %broadcast.6124.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5021.177), dimensions={}, metadata={scheduling_name="broadcast.6124.17"}
  %multiply.2888.7 = f32[2,1,768,8]{3,2,1,0} multiply(%multiply.2887.11, %broadcast.6124.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2888.7"}
  %param_6.2300 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2300"}
  %convert.4676.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_6.2300), metadata={scheduling_name="convert.4676.5"}
  %constant_3248_13 = bf16[] constant(0.9492)
  %convert.5023.179 = f32[] convert(%constant_3248_13), metadata={scheduling_name="convert.5023.179"}
  %broadcast.6126.17 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5023.179), dimensions={}, metadata={scheduling_name="broadcast.6126.17"}
  %multiply.2889.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4676.5, %broadcast.6126.17), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2889.7"}
  %add.3203.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2888.7, %multiply.2889.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3203.5"}
  %param_3.3799 = f32[] parameter(3), metadata={scheduling_name="param_3.3799"}
  %broadcast.6128.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_3.3799), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6128.6"}
  %divide.515.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3203.5, %broadcast.6128.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.515.5"}
  %sqrt.94.3 = f32[2,1,768,8]{3,2,1,0} sqrt(%divide.515.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.94.3"}
  %constant_3251_13 = bf16[] constant(1.001e-08)
  %convert.5025.154 = f32[] convert(%constant_3251_13), metadata={scheduling_name="convert.5025.154"}
  %broadcast.6130.19 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5025.154), dimensions={}, metadata={scheduling_name="broadcast.6130.19"}
  %add.3204.9 = f32[2,1,768,8]{3,2,1,0} add(%sqrt.94.3, %broadcast.6130.19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3204.9"}
  %multiply.2890.7 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6122.4, %add.3204.9), metadata={scheduling_name="multiply.2890.7"}
  %divide.516.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3202.5, %multiply.2890.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.516.5"}
  %multiply.2891.5 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4656.1, %broadcast.6118.29), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2891.5"}
  %add.3205.3 = f32[2,1,768,8]{3,2,1,0} add(%divide.516.5, %multiply.2891.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3205.3"}
  %multiply.2892.3 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6114.4, %add.3205.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2892.3"}
  %add.3206.1 = f32[2,1,768,8]{3,2,1,0} add(%convert.4656.1, %multiply.2892.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3206.1"}
  %convert.4963.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3203.5), metadata={scheduling_name="convert.4963.1.clone.1"}
  %convert.4934.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3202.5), metadata={scheduling_name="convert.4934.1.clone.1"}
  %bitcast.29724.1.clone.1 = f32[12288]{0} bitcast(%multiply.2887.11), metadata={scheduling_name="bitcast.29724.1.clone.1"}
  %constant_3026_66_clone_1 = f32[] constant(0)
  %reduce.219.1.clone.1 = f32[] reduce(%bitcast.29724.1.clone.1, %constant_3026_66_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.219.1.clone.1"}
  ROOT %tuple.586 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) tuple(%add.3206.1, %convert.4963.1.clone.1, %convert.4934.1.clone.1, %reduce.219.1.clone.1), metadata={scheduling_name="tuple.586"}
}

%fused_add_convert_reduce.4 (param_0.5516: bf16[2,1,6144], param_1.5956: f32[], param_2.4632: f32[], param_3.3815: f32[], param_4.2788: bf16[2,1,6144], param_5.2564: bf16[2,1,6144], param_6.2316: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5516 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5516"}
  %convert.4535.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5516), metadata={scheduling_name="convert.4535.1"}
  %param_1.5956 = f32[] parameter(1), metadata={scheduling_name="param_1.5956"}
  %broadcast.6186.10 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5956), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6186.10"}
  %param_5.2564 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2564"}
  %convert.4540.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2564), metadata={scheduling_name="convert.4540.14"}
  %constant_3240_59 = bf16[] constant(0.1001)
  %convert.5017.320 = f32[] convert(%constant_3240_59), metadata={scheduling_name="convert.5017.320"}
  %broadcast.6190.49 = f32[2,1,6144]{2,1,0} broadcast(%convert.5017.320), dimensions={}, metadata={scheduling_name="broadcast.6190.49"}
  %multiply.2845.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4540.14, %broadcast.6190.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2845.7"}
  %param_4.2788 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2788"}
  %convert.4542.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2788), metadata={scheduling_name="convert.4542.5"}
  %constant_3241_57 = bf16[] constant(0.8984)
  %convert.5018.161 = f32[] convert(%constant_3241_57), metadata={scheduling_name="convert.5018.161"}
  %broadcast.6192.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.161), dimensions={}, metadata={scheduling_name="broadcast.6192.25"}
  %multiply.2846.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4542.5, %broadcast.6192.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2846.7"}
  %add.3176.5 = f32[2,1,6144]{2,1,0} add(%multiply.2845.7, %multiply.2846.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3176.5"}
  %param_2.4632 = f32[] parameter(2), metadata={scheduling_name="param_2.4632"}
  %broadcast.6194.10 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4632), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.10"}
  %multiply.2847.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4540.14, %convert.4540.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2847.11"}
  %constant_3247_57 = bf16[] constant(0.05005)
  %convert.5021.161 = f32[] convert(%constant_3247_57), metadata={scheduling_name="convert.5021.161"}
  %broadcast.6196.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5021.161), dimensions={}, metadata={scheduling_name="broadcast.6196.25"}
  %multiply.2848.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2847.11, %broadcast.6196.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2848.7"}
  %param_6.2316 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2316"}
  %convert.4548.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2316), metadata={scheduling_name="convert.4548.5"}
  %constant_3248_57 = bf16[] constant(0.9492)
  %convert.5023.163 = f32[] convert(%constant_3248_57), metadata={scheduling_name="convert.5023.163"}
  %broadcast.6198.25 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.163), dimensions={}, metadata={scheduling_name="broadcast.6198.25"}
  %multiply.2849.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4548.5, %broadcast.6198.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2849.7"}
  %add.3177.5 = f32[2,1,6144]{2,1,0} add(%multiply.2848.7, %multiply.2849.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3177.5"}
  %param_3.3815 = f32[] parameter(3), metadata={scheduling_name="param_3.3815"}
  %broadcast.6200.16 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3815), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6200.16"}
  %divide.500.5 = f32[2,1,6144]{2,1,0} divide(%add.3177.5, %broadcast.6200.16), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.500.5"}
  %sqrt.89.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.500.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.89.3"}
  %constant_3251_41 = bf16[] constant(1.001e-08)
  %convert.5025.150 = f32[] convert(%constant_3251_41), metadata={scheduling_name="convert.5025.150"}
  %broadcast.6202.39 = f32[2,1,6144]{2,1,0} broadcast(%convert.5025.150), dimensions={}, metadata={scheduling_name="broadcast.6202.39"}
  %add.3178.9 = f32[2,1,6144]{2,1,0} add(%sqrt.89.3, %broadcast.6202.39), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3178.9"}
  %multiply.2850.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6194.10, %add.3178.9), metadata={scheduling_name="multiply.2850.7"}
  %divide.501.5 = f32[2,1,6144]{2,1,0} divide(%add.3176.5, %multiply.2850.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.501.5"}
  %multiply.2851.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4535.1, %broadcast.6190.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2851.5"}
  %add.3179.3 = f32[2,1,6144]{2,1,0} add(%divide.501.5, %multiply.2851.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3179.3"}
  %multiply.2852.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6186.10, %add.3179.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2852.3"}
  %add.3180.1 = f32[2,1,6144]{2,1,0} add(%convert.4535.1, %multiply.2852.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3180.1"}
  %convert.4958.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3177.5), metadata={scheduling_name="convert.4958.1.clone.1"}
  %convert.4926.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3176.5), metadata={scheduling_name="convert.4926.1.clone.1"}
  %bitcast.29643.1.clone.1 = f32[12288]{0} bitcast(%multiply.2847.11), metadata={scheduling_name="bitcast.29643.1.clone.1"}
  %constant_3026_61_clone_1 = f32[] constant(0)
  %reduce.214.1.clone.1 = f32[] reduce(%bitcast.29643.1.clone.1, %constant_3026_61_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.214.1.clone.1"}
  ROOT %tuple.602 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3180.1, %convert.4958.1.clone.1, %convert.4926.1.clone.1, %reduce.214.1.clone.1), metadata={scheduling_name="tuple.602"}
}

%fused_add_convert_reduce.5 (param_0.5519: bf16[2,1,6144], param_1.5961: f32[], param_2.4631: f32[], param_3.3814: f32[], param_4.2787: bf16[2,1,6144], param_5.2563: bf16[2,1,6144], param_6.2315: bf16[2,1,6144]) -> (f32[2,1,6144], bf16[2,1,6144], bf16[2,1,6144], f32[]) {
  %param_0.5519 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5519"}
  %convert.4515.1 = f32[2,1,6144]{2,1,0} convert(%param_0.5519), metadata={scheduling_name="convert.4515.1"}
  %param_1.5961 = f32[] parameter(1), metadata={scheduling_name="param_1.5961"}
  %broadcast.6186.12 = f32[2,1,6144]{2,1,0} broadcast(%param_1.5961), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6186.12"}
  %param_5.2563 = bf16[2,1,6144]{2,1,0} parameter(5), metadata={scheduling_name="param_5.2563"}
  %convert.4520.14 = f32[2,1,6144]{2,1,0} convert(%param_5.2563), metadata={scheduling_name="convert.4520.14"}
  %constant_3240_57 = bf16[] constant(0.1001)
  %convert.5017.316 = f32[] convert(%constant_3240_57), metadata={scheduling_name="convert.5017.316"}
  %broadcast.6190.45 = f32[2,1,6144]{2,1,0} broadcast(%convert.5017.316), dimensions={}, metadata={scheduling_name="broadcast.6190.45"}
  %multiply.2837.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4520.14, %broadcast.6190.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2837.7"}
  %param_4.2787 = bf16[2,1,6144]{2,1,0} parameter(4), metadata={scheduling_name="param_4.2787"}
  %convert.4522.5 = f32[2,1,6144]{2,1,0} convert(%param_4.2787), metadata={scheduling_name="convert.4522.5"}
  %constant_3241_56 = bf16[] constant(0.8984)
  %convert.5018.157 = f32[] convert(%constant_3241_56), metadata={scheduling_name="convert.5018.157"}
  %broadcast.6192.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5018.157), dimensions={}, metadata={scheduling_name="broadcast.6192.21"}
  %multiply.2838.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4522.5, %broadcast.6192.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2838.7"}
  %add.3171.5 = f32[2,1,6144]{2,1,0} add(%multiply.2837.7, %multiply.2838.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3171.5"}
  %param_2.4631 = f32[] parameter(2), metadata={scheduling_name="param_2.4631"}
  %broadcast.6194.12 = f32[2,1,6144]{2,1,0} broadcast(%param_2.4631), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6194.12"}
  %multiply.2839.11 = f32[2,1,6144]{2,1,0} multiply(%convert.4520.14, %convert.4520.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2839.11"}
  %constant_3247_56 = bf16[] constant(0.05005)
  %convert.5021.157 = f32[] convert(%constant_3247_56), metadata={scheduling_name="convert.5021.157"}
  %broadcast.6196.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5021.157), dimensions={}, metadata={scheduling_name="broadcast.6196.21"}
  %multiply.2840.7 = f32[2,1,6144]{2,1,0} multiply(%multiply.2839.11, %broadcast.6196.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2840.7"}
  %param_6.2315 = bf16[2,1,6144]{2,1,0} parameter(6), metadata={scheduling_name="param_6.2315"}
  %convert.4528.5 = f32[2,1,6144]{2,1,0} convert(%param_6.2315), metadata={scheduling_name="convert.4528.5"}
  %constant_3248_56 = bf16[] constant(0.9492)
  %convert.5023.159 = f32[] convert(%constant_3248_56), metadata={scheduling_name="convert.5023.159"}
  %broadcast.6198.21 = f32[2,1,6144]{2,1,0} broadcast(%convert.5023.159), dimensions={}, metadata={scheduling_name="broadcast.6198.21"}
  %multiply.2841.7 = f32[2,1,6144]{2,1,0} multiply(%convert.4528.5, %broadcast.6198.21), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2841.7"}
  %add.3172.5 = f32[2,1,6144]{2,1,0} add(%multiply.2840.7, %multiply.2841.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3172.5"}
  %param_3.3814 = f32[] parameter(3), metadata={scheduling_name="param_3.3814"}
  %broadcast.6200.20 = f32[2,1,6144]{2,1,0} broadcast(%param_3.3814), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6200.20"}
  %divide.497.5 = f32[2,1,6144]{2,1,0} divide(%add.3172.5, %broadcast.6200.20), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.497.5"}
  %sqrt.88.3 = f32[2,1,6144]{2,1,0} sqrt(%divide.497.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.88.3"}
  %constant_3251_40 = bf16[] constant(1.001e-08)
  %convert.5025.152 = f32[] convert(%constant_3251_40), metadata={scheduling_name="convert.5025.152"}
  %broadcast.6202.41 = f32[2,1,6144]{2,1,0} broadcast(%convert.5025.152), dimensions={}, metadata={scheduling_name="broadcast.6202.41"}
  %add.3173.9 = f32[2,1,6144]{2,1,0} add(%sqrt.88.3, %broadcast.6202.41), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3173.9"}
  %multiply.2842.7 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6194.12, %add.3173.9), metadata={scheduling_name="multiply.2842.7"}
  %divide.498.5 = f32[2,1,6144]{2,1,0} divide(%add.3171.5, %multiply.2842.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.498.5"}
  %multiply.2843.5 = f32[2,1,6144]{2,1,0} multiply(%convert.4515.1, %broadcast.6190.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2843.5"}
  %add.3174.3 = f32[2,1,6144]{2,1,0} add(%divide.498.5, %multiply.2843.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3174.3"}
  %multiply.2844.3 = f32[2,1,6144]{2,1,0} multiply(%broadcast.6186.12, %add.3174.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2844.3"}
  %add.3175.1 = f32[2,1,6144]{2,1,0} add(%convert.4515.1, %multiply.2844.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3175.1"}
  %convert.4957.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3172.5), metadata={scheduling_name="convert.4957.1.clone.1"}
  %convert.4925.1.clone.1 = bf16[2,1,6144]{2,1,0} convert(%add.3171.5), metadata={scheduling_name="convert.4925.1.clone.1"}
  %bitcast.29630.1.clone.1 = f32[12288]{0} bitcast(%multiply.2839.11), metadata={scheduling_name="bitcast.29630.1.clone.1"}
  %constant_3026_60_clone_1 = f32[] constant(0)
  %reduce.213.1.clone.1 = f32[] reduce(%bitcast.29630.1.clone.1, %constant_3026_60_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.213.1.clone.1"}
  ROOT %tuple.606 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) tuple(%add.3175.1, %convert.4957.1.clone.1, %convert.4925.1.clone.1, %reduce.213.1.clone.1), metadata={scheduling_name="tuple.606"}
}

%fused_add_convert_reduce.6 (param_0.5533: bf16[2,1,768,8], param_1.5983: f32[], param_2.4634: f32[], param_3.3817: f32[], param_4.2790: bf16[2,1,768,8], param_5.2566: bf16[2,1,768,8], param_6.2318: bf16[2,1,768,8]) -> (f32[2,1,768,8], bf16[2,1,768,8], bf16[2,1,768,8], f32[]) {
  %param_0.5533 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5533"}
  %convert.4435.1 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5533), metadata={scheduling_name="convert.4435.1"}
  %param_1.5983 = f32[] parameter(1), metadata={scheduling_name="param_1.5983"}
  %broadcast.6114.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.5983), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6114.6"}
  %param_5.2566 = bf16[2,1,768,8]{3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2566"}
  %convert.4440.14 = f32[2,1,768,8]{3,2,1,0} convert(%param_5.2566), metadata={scheduling_name="convert.4440.14"}
  %constant_3240_64 = bf16[] constant(0.1001)
  %convert.5017.332 = f32[] convert(%constant_3240_64), metadata={scheduling_name="convert.5017.332"}
  %broadcast.6118.25 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5017.332), dimensions={}, metadata={scheduling_name="broadcast.6118.25"}
  %multiply.2805.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4440.14, %broadcast.6118.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2805.7"}
  %param_4.2790 = bf16[2,1,768,8]{3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2790"}
  %convert.4442.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_4.2790), metadata={scheduling_name="convert.4442.5"}
  %constant_3241_59 = bf16[] constant(0.8984)
  %convert.5018.173 = f32[] convert(%constant_3241_59), metadata={scheduling_name="convert.5018.173"}
  %broadcast.6120.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5018.173), dimensions={}, metadata={scheduling_name="broadcast.6120.13"}
  %multiply.2806.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4442.5, %broadcast.6120.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2806.7"}
  %add.3151.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2805.7, %multiply.2806.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3151.5"}
  %param_2.4634 = f32[] parameter(2), metadata={scheduling_name="param_2.4634"}
  %broadcast.6122.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_2.4634), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6122.6"}
  %multiply.2807.11 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4440.14, %convert.4440.14), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2807.11"}
  %constant_3247_59 = bf16[] constant(0.05005)
  %convert.5021.173 = f32[] convert(%constant_3247_59), metadata={scheduling_name="convert.5021.173"}
  %broadcast.6124.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5021.173), dimensions={}, metadata={scheduling_name="broadcast.6124.13"}
  %multiply.2808.7 = f32[2,1,768,8]{3,2,1,0} multiply(%multiply.2807.11, %broadcast.6124.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2808.7"}
  %param_6.2318 = bf16[2,1,768,8]{3,2,1,0} parameter(6), metadata={scheduling_name="param_6.2318"}
  %convert.4448.5 = f32[2,1,768,8]{3,2,1,0} convert(%param_6.2318), metadata={scheduling_name="convert.4448.5"}
  %constant_3248_59 = bf16[] constant(0.9492)
  %convert.5023.175 = f32[] convert(%constant_3248_59), metadata={scheduling_name="convert.5023.175"}
  %broadcast.6126.13 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5023.175), dimensions={}, metadata={scheduling_name="broadcast.6126.13"}
  %multiply.2809.7 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4448.5, %broadcast.6126.13), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2809.7"}
  %add.3152.5 = f32[2,1,768,8]{3,2,1,0} add(%multiply.2808.7, %multiply.2809.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3152.5"}
  %param_3.3817 = f32[] parameter(3), metadata={scheduling_name="param_3.3817"}
  %broadcast.6128.10 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_3.3817), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6128.10"}
  %divide.485.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3152.5, %broadcast.6128.10), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.485.5"}
  %sqrt.84.3 = f32[2,1,768,8]{3,2,1,0} sqrt(%divide.485.5), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.84.3"}
  %constant_3251_43 = bf16[] constant(1.001e-08)
  %convert.5025.156 = f32[] convert(%constant_3251_43), metadata={scheduling_name="convert.5025.156"}
  %broadcast.6130.21 = f32[2,1,768,8]{3,2,1,0} broadcast(%convert.5025.156), dimensions={}, metadata={scheduling_name="broadcast.6130.21"}
  %add.3153.9 = f32[2,1,768,8]{3,2,1,0} add(%sqrt.84.3, %broadcast.6130.21), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3153.9"}
  %multiply.2810.7 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6122.6, %add.3153.9), metadata={scheduling_name="multiply.2810.7"}
  %divide.486.5 = f32[2,1,768,8]{3,2,1,0} divide(%add.3151.5, %multiply.2810.7), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.486.5"}
  %multiply.2811.5 = f32[2,1,768,8]{3,2,1,0} multiply(%convert.4435.1, %broadcast.6118.25), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2811.5"}
  %add.3154.3 = f32[2,1,768,8]{3,2,1,0} add(%divide.486.5, %multiply.2811.5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3154.3"}
  %multiply.2812.3 = f32[2,1,768,8]{3,2,1,0} multiply(%broadcast.6114.6, %add.3154.3), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2812.3"}
  %add.3155.1 = f32[2,1,768,8]{3,2,1,0} add(%convert.4435.1, %multiply.2812.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3155.1"}
  %convert.4953.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3152.5), metadata={scheduling_name="convert.4953.1.clone.1"}
  %convert.4919.1.clone.1 = bf16[2,1,768,8]{3,2,1,0} convert(%add.3151.5), metadata={scheduling_name="convert.4919.1.clone.1"}
  %bitcast.29554.1.clone.1 = f32[12288]{0} bitcast(%multiply.2807.11), metadata={scheduling_name="bitcast.29554.1.clone.1"}
  %constant_3026_56_clone_1 = f32[] constant(0)
  %reduce.209.1.clone.1 = f32[] reduce(%bitcast.29554.1.clone.1, %constant_3026_56_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.209.1.clone.1"}
  ROOT %tuple.619 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) tuple(%add.3155.1, %convert.4953.1.clone.1, %convert.4919.1.clone.1, %reduce.209.1.clone.1), metadata={scheduling_name="tuple.619"}
}

%region_6.604.clone.11 (Arg_0.180: f32[], Arg_1.180: f32[]) -> f32[] {
  %Arg_1.180 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_1.180"}
  %Arg_0.180 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while/body/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/scatter-add" scheduling_name="Arg_0.180"}
  ROOT %add.3100.0 = f32[] add(%Arg_0.180, %Arg_1.180), metadata={op_name="/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3100.0"}
}

%fused_reduce.69 (param_0.5599: f32[256,6144], param_1.6056: f32[]) -> bf16[6144] {
  %param_0.5599 = f32[256,6144]{1,0} parameter(0), metadata={scheduling_name="param_0.5599"}
  %param_1.6056 = f32[] parameter(1), metadata={scheduling_name="param_1.6056"}
  %reduce.182.1 = f32[6144]{0} reduce(%param_0.5599, %param_1.6056), dimensions={0}, to_apply=%region_6.604.clone.11, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="reduce.182.1"}
  ROOT %convert.4342.1 = bf16[6144]{0} convert(%reduce.182.1), metadata={scheduling_name="convert.4342.1"}
}

%fused_select.3 (param_0.5739: bf16[2,1,6144], param_1.6154: f32[], param_2.4367: pred[]) -> bf16[2,1,6144] {
  %param_2.4367 = pred[] parameter(2), metadata={scheduling_name="param_2.4367"}
  %broadcast.5903.4 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4367), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5903.4"}
  %param_0.5739 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5739"}
  %convert.4380.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5739), metadata={scheduling_name="convert.4380.8"}
  %param_1.6154 = f32[] parameter(1), metadata={scheduling_name="param_1.6154"}
  %broadcast.6188.6 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6154), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6188.6"}
  %divide.529.5 = f32[2,1,6144]{2,1,0} divide(%convert.4380.8, %broadcast.6188.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.529.5"}
  %convert.4787.3 = bf16[2,1,6144]{2,1,0} convert(%divide.529.5), metadata={scheduling_name="convert.4787.3"}
  ROOT %select.1386.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5903.4, %param_0.5739, %convert.4787.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1386.1"}
}

%fused_select.4 (param_0.5738: bf16[2,1,6144], param_1.6153: f32[], param_2.4366: pred[]) -> bf16[2,1,6144] {
  %param_2.4366 = pred[] parameter(2), metadata={scheduling_name="param_2.4366"}
  %broadcast.5903.3 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4366), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5903.3"}
  %param_0.5738 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5738"}
  %convert.4378.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5738), metadata={scheduling_name="convert.4378.8"}
  %param_1.6153 = f32[] parameter(1), metadata={scheduling_name="param_1.6153"}
  %broadcast.6188.8 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6153), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6188.8"}
  %divide.526.5 = f32[2,1,6144]{2,1,0} divide(%convert.4378.8, %broadcast.6188.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.526.5"}
  %convert.4767.3 = bf16[2,1,6144]{2,1,0} convert(%divide.526.5), metadata={scheduling_name="convert.4767.3"}
  ROOT %select.1385.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5903.3, %param_0.5738, %convert.4767.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1385.1"}
}

%fused_select.5 (param_0.5740: bf16[2,1,768,8], param_1.6155: f32[], param_2.4368: pred[]) -> bf16[2,1,768,8] {
  %param_2.4368 = pred[] parameter(2), metadata={scheduling_name="param_2.4368"}
  %broadcast.5864.1 = pred[2,1,768,8]{3,2,1,0} broadcast(%param_2.4368), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5864.1"}
  %param_0.5740 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5740"}
  %convert.4370.8 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5740), metadata={scheduling_name="convert.4370.8"}
  %param_1.6155 = f32[] parameter(1), metadata={scheduling_name="param_1.6155"}
  %broadcast.6116.4 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.6155), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6116.4"}
  %divide.514.5 = f32[2,1,768,8]{3,2,1,0} divide(%convert.4370.8, %broadcast.6116.4), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.514.5"}
  %convert.4662.3 = bf16[2,1,768,8]{3,2,1,0} convert(%divide.514.5), metadata={scheduling_name="convert.4662.3"}
  ROOT %select.1381.1 = bf16[2,1,768,8]{3,2,1,0} select(%broadcast.5864.1, %param_0.5740, %convert.4662.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1381.1"}
}

%fused_select.6 (param_0.5736: bf16[2,1,6144], param_1.6151: f32[], param_2.4364: pred[]) -> bf16[2,1,6144] {
  %param_2.4364 = pred[] parameter(2), metadata={scheduling_name="param_2.4364"}
  %broadcast.5903.1 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4364), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5903.1"}
  %param_0.5736 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5736"}
  %convert.4360.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5736), metadata={scheduling_name="convert.4360.8"}
  %param_1.6151 = f32[] parameter(1), metadata={scheduling_name="param_1.6151"}
  %broadcast.6188.10 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6151), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6188.10"}
  %divide.499.5 = f32[2,1,6144]{2,1,0} divide(%convert.4360.8, %broadcast.6188.10), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.499.5"}
  %convert.4539.3 = bf16[2,1,6144]{2,1,0} convert(%divide.499.5), metadata={scheduling_name="convert.4539.3"}
  ROOT %select.1376.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5903.1, %param_0.5736, %convert.4539.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1376.1"}
}

%fused_select.7 (param_0.5737: bf16[2,1,6144], param_1.6152: f32[], param_2.4365: pred[]) -> bf16[2,1,6144] {
  %param_2.4365 = pred[] parameter(2), metadata={scheduling_name="param_2.4365"}
  %broadcast.5903.2 = pred[2,1,6144]{2,1,0} broadcast(%param_2.4365), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5903.2"}
  %param_0.5737 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5737"}
  %convert.4358.8 = f32[2,1,6144]{2,1,0} convert(%param_0.5737), metadata={scheduling_name="convert.4358.8"}
  %param_1.6152 = f32[] parameter(1), metadata={scheduling_name="param_1.6152"}
  %broadcast.6188.12 = f32[2,1,6144]{2,1,0} broadcast(%param_1.6152), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6188.12"}
  %divide.496.5 = f32[2,1,6144]{2,1,0} divide(%convert.4358.8, %broadcast.6188.12), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.496.5"}
  %convert.4519.3 = bf16[2,1,6144]{2,1,0} convert(%divide.496.5), metadata={scheduling_name="convert.4519.3"}
  ROOT %select.1375.1 = bf16[2,1,6144]{2,1,0} select(%broadcast.5903.2, %param_0.5737, %convert.4519.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1375.1"}
}

%fused_select.8 (param_0.5741: bf16[2,1,768,8], param_1.6156: f32[], param_2.4369: pred[]) -> bf16[2,1,768,8] {
  %param_2.4369 = pred[] parameter(2), metadata={scheduling_name="param_2.4369"}
  %broadcast.5864.2 = pred[2,1,768,8]{3,2,1,0} broadcast(%param_2.4369), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5864.2"}
  %param_0.5741 = bf16[2,1,768,8]{3,2,1,0} parameter(0), metadata={scheduling_name="param_0.5741"}
  %convert.4350.8 = f32[2,1,768,8]{3,2,1,0} convert(%param_0.5741), metadata={scheduling_name="convert.4350.8"}
  %param_1.6156 = f32[] parameter(1), metadata={scheduling_name="param_1.6156"}
  %broadcast.6116.6 = f32[2,1,768,8]{3,2,1,0} broadcast(%param_1.6156), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6116.6"}
  %divide.484.5 = f32[2,1,768,8]{3,2,1,0} divide(%convert.4350.8, %broadcast.6116.6), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.484.5"}
  %convert.4439.3 = bf16[2,1,768,8]{3,2,1,0} convert(%divide.484.5), metadata={scheduling_name="convert.4439.3"}
  ROOT %select.1371.1 = bf16[2,1,768,8]{3,2,1,0} select(%broadcast.5864.2, %param_0.5741, %convert.4439.3), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1371.1"}
}

%fused_power.1 () -> f32[64] {
  %constant_3053_1 = f32[] constant(1e+06)
  %broadcast.5792.1 = f32[64]{0} broadcast(%constant_3053_1), dimensions={}, metadata={scheduling_name="broadcast.5792.1"}
  %iota.398.1 = s32[64]{0} iota(), iota_dimension=0, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/iota" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="iota.398.1"}
  %constant_3054_1 = s32[] constant(2)
  %broadcast.5793.1 = s32[64]{0} broadcast(%constant_3054_1), dimensions={}, metadata={scheduling_name="broadcast.5793.1"}
  %multiply.2746.3 = s32[64]{0} multiply(%iota.398.1, %broadcast.5793.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/mul" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2746.3"}
  %convert.4325.3 = f32[64]{0} convert(%multiply.2746.3), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="convert.4325.3"}
  %constant_3055_1 = f32[] constant(0.0078125)
  %broadcast.5794.1 = f32[64]{0} broadcast(%constant_3055_1), dimensions={}, metadata={scheduling_name="broadcast.5794.1"}
  %multiply.2747.1 = f32[64]{0} multiply(%convert.4325.3, %broadcast.5794.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/div" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=272 scheduling_name="multiply.2747.1"}
  ROOT %power.23.1 = f32[64]{0} power(%broadcast.5792.1, %multiply.2747.1), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 scheduling_name="power.23.1"}
}

%fused_add_convert_reduce.7 (param_0.6037: bf16[6144], param_1.6410: bf16[6144], param_2.4586: f32[], param_3.3758: pred[], param_4.2943: bf16[6144], param_5.2726: f32[], param_6.2535: f32[], param_7.2383: f32[], param_8.2256: bf16[6144]) -> (bf16[6144], bf16[6144], f32[6144], f32[]) {
  %param_3.3758 = pred[] parameter(3), metadata={scheduling_name="param_3.3758"}
  %broadcast.5842.9 = pred[6144]{0} broadcast(%param_3.3758), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5842.9"}
  %param_1.6410 = bf16[6144]{0} parameter(1), metadata={scheduling_name="param_1.6410"}
  %convert.4343.16 = f32[6144]{0} convert(%param_1.6410), metadata={scheduling_name="convert.4343.16"}
  %param_2.4586 = f32[] parameter(2), metadata={scheduling_name="param_2.4586"}
  %broadcast.6076.11 = f32[6144]{0} broadcast(%param_2.4586), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6076.11"}
  %divide.478.13 = f32[6144]{0} divide(%convert.4343.16, %broadcast.6076.11), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.478.13"}
  %convert.4396.11 = bf16[6144]{0} convert(%divide.478.13), metadata={scheduling_name="convert.4396.11"}
  %select.1368.9 = bf16[6144]{0} select(%broadcast.5842.9, %param_1.6410, %convert.4396.11), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1368.9"}
  %convert.4397.12 = f32[6144]{0} convert(%select.1368.9), metadata={scheduling_name="convert.4397.12"}
  %constant_3240_66 = bf16[] constant(0.1001)
  %convert.5017.338 = f32[] convert(%constant_3240_66), metadata={scheduling_name="convert.5017.338"}
  %broadcast.6078.15 = f32[6144]{0} broadcast(%convert.5017.338), dimensions={}, metadata={scheduling_name="broadcast.6078.15"}
  %multiply.2789.5 = f32[6144]{0} multiply(%convert.4397.12, %broadcast.6078.15), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2789.5"}
  %param_0.6037 = bf16[6144]{0} parameter(0), metadata={scheduling_name="param_0.6037"}
  %convert.4399.3 = f32[6144]{0} convert(%param_0.6037), metadata={scheduling_name="convert.4399.3"}
  %constant_3241_66 = bf16[] constant(0.8984)
  %convert.5018.179 = f32[] convert(%constant_3241_66), metadata={scheduling_name="convert.5018.179"}
  %broadcast.6080.5 = f32[6144]{0} broadcast(%convert.5018.179), dimensions={}, metadata={scheduling_name="broadcast.6080.5"}
  %multiply.2790.3 = f32[6144]{0} multiply(%convert.4399.3, %broadcast.6080.5), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2790.3"}
  %add.3139.3 = f32[6144]{0} add(%multiply.2789.5, %multiply.2790.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3139.3"}
  %convert.4916.1 = bf16[6144]{0} convert(%add.3139.3), metadata={scheduling_name="convert.4916.1"}
  %multiply.2791.9.clone.1 = f32[6144]{0} multiply(%convert.4397.12, %convert.4397.12), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2791.9.clone.1"}
  %constant_3247_66_clone_1 = bf16[] constant(0.05005)
  %convert.5021.179.clone.1 = f32[] convert(%constant_3247_66_clone_1), metadata={scheduling_name="convert.5021.179.clone.1"}
  %broadcast.6084.5.clone.1 = f32[6144]{0} broadcast(%convert.5021.179.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6084.5.clone.1"}
  %multiply.2792.5.clone.1 = f32[6144]{0} multiply(%multiply.2791.9.clone.1, %broadcast.6084.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2792.5.clone.1"}
  %param_4.2943 = bf16[6144]{0} parameter(4), metadata={scheduling_name="param_4.2943"}
  %convert.4407.3.clone.1 = f32[6144]{0} convert(%param_4.2943), metadata={scheduling_name="convert.4407.3.clone.1"}
  %constant_3248_66_clone_1 = bf16[] constant(0.9492)
  %convert.5023.181.clone.1 = f32[] convert(%constant_3248_66_clone_1), metadata={scheduling_name="convert.5023.181.clone.1"}
  %broadcast.6086.7.clone.1 = f32[6144]{0} broadcast(%convert.5023.181.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6086.7.clone.1"}
  %multiply.2793.5.clone.1 = f32[6144]{0} multiply(%convert.4407.3.clone.1, %broadcast.6086.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2793.5.clone.1"}
  %add.3141.3.clone.1 = f32[6144]{0} add(%multiply.2792.5.clone.1, %multiply.2793.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3141.3.clone.1"}
  %convert.4950.1.clone.1 = bf16[6144]{0} convert(%add.3141.3.clone.1), metadata={scheduling_name="convert.4950.1.clone.1"}
  %param_8.2256 = bf16[6144]{0} parameter(8), metadata={scheduling_name="param_8.2256"}
  %convert.4316.1.clone.1 = f32[6144]{0} convert(%param_8.2256), metadata={scheduling_name="convert.4316.1.clone.1"}
  %param_7.2383 = f32[] parameter(7), metadata={scheduling_name="param_7.2383"}
  %broadcast.6069.1.clone.1 = f32[6144]{0} broadcast(%param_7.2383), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6069.1.clone.1"}
  %param_6.2535 = f32[] parameter(6), metadata={scheduling_name="param_6.2535"}
  %broadcast.6082.1.clone.1 = f32[6144]{0} broadcast(%param_6.2535), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6082.1.clone.1"}
  %param_5.2726 = f32[] parameter(5), metadata={scheduling_name="param_5.2726"}
  %broadcast.6088.3.clone.1 = f32[6144]{0} broadcast(%param_5.2726), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6088.3.clone.1"}
  %divide.479.3.clone.1 = f32[6144]{0} divide(%add.3141.3.clone.1, %broadcast.6088.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.479.3.clone.1"}
  %sqrt.82.7.clone.1 = f32[6144]{0} sqrt(%divide.479.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.82.7.clone.1"}
  %constant_3251_11_clone_1 = bf16[] constant(1.001e-08)
  %convert.5025.158.clone.1 = f32[] convert(%constant_3251_11_clone_1), metadata={scheduling_name="convert.5025.158.clone.1"}
  %broadcast.6090.3.clone.1 = f32[6144]{0} broadcast(%convert.5025.158.clone.1), dimensions={}, metadata={scheduling_name="broadcast.6090.3.clone.1"}
  %add.3143.7.clone.1 = f32[6144]{0} add(%sqrt.82.7.clone.1, %broadcast.6090.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3143.7.clone.1"}
  %multiply.2794.5.clone.1 = f32[6144]{0} multiply(%broadcast.6082.1.clone.1, %add.3143.7.clone.1), metadata={scheduling_name="multiply.2794.5.clone.1"}
  %divide.480.3.clone.1 = f32[6144]{0} divide(%add.3139.3, %multiply.2794.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.480.3.clone.1"}
  %multiply.2795.7.clone.1 = f32[6144]{0} multiply(%convert.4316.1.clone.1, %broadcast.6078.15), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2795.7.clone.1"}
  %add.3144.5.clone.1 = f32[6144]{0} add(%divide.480.3.clone.1, %multiply.2795.7.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3144.5.clone.1"}
  %multiply.2796.3.clone.1 = f32[6144]{0} multiply(%broadcast.6069.1.clone.1, %add.3144.5.clone.1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2796.3.clone.1"}
  %add.3145.1.clone.1 = f32[6144]{0} add(%convert.4316.1.clone.1, %multiply.2796.3.clone.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3145.1.clone.1"}
  %constant_3026_54_clone_1 = f32[] constant(0)
  %reduce.207.1.clone.1 = f32[] reduce(%multiply.2791.9.clone.1, %constant_3026_54_clone_1), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.207.1.clone.1"}
  ROOT %tuple.642 = (bf16[6144]{0}, bf16[6144]{0}, f32[6144]{0}, f32[]) tuple(%convert.4916.1, %convert.4950.1.clone.1, %add.3145.1.clone.1, %reduce.207.1.clone.1), metadata={scheduling_name="tuple.642"}
}

%fused_subtract (param_0.6058: s32[]) -> f32[] {
  %constant_2982_1 = f32[] constant(1)
  %constant_3250_1 = f32[] constant(0.95)
  %param_0.6058 = s32[] parameter(0), metadata={scheduling_name="param_0.6058"}
  %convert.4401.1 = f32[] convert(%param_0.6058), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4401.1"}
  %power.25.1 = f32[] power(%constant_3250_1, %convert.4401.1), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="power.25.1"}
  ROOT %subtract.273.1 = f32[] subtract(%constant_2982_1, %power.25.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.273.1"}
}

%fused_select_subtract (param_0.6081: s32[]) -> (f32[], s32[]) {
  %constant_2982_2 = f32[] constant(1)
  %constant_3243_1 = f32[] constant(0.9)
  %param_0.6081 = s32[] parameter(0), metadata={scheduling_name="param_0.6081"}
  %constant_3244_2_clone_1 = s32[] constant(2147483647)
  %compare.1726.1.clone.1 = pred[] compare(%param_0.6081, %constant_3244_2_clone_1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1726.1.clone.1"}
  %constant_2980_4_clone_1 = s32[] constant(1)
  %add.3140.1.clone.1 = s32[] add(%param_0.6081, %constant_2980_4_clone_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3140.1.clone.1"}
  %select.1369.1.clone.1 = s32[] select(%compare.1726.1.clone.1, %add.3140.1.clone.1, %constant_3244_2_clone_1), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1369.1.clone.1"}
  %convert.4401.2 = f32[] convert(%select.1369.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4401.2"}
  %power.24.1 = f32[] power(%constant_3243_1, %convert.4401.2), metadata={op_name="jit(train_step)/jit(main)/pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="power.24.1"}
  %subtract.272.1 = f32[] subtract(%constant_2982_2, %power.24.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.272.1"}
  ROOT %tuple.647 = (f32[], s32[]) tuple(%subtract.272.1, %select.1369.1.clone.1), metadata={scheduling_name="tuple.647"}
}

%fused_compare_sqrt (param_0.6076: f32[], param_1.6477: f32[], param_2.4758: f32[], param_3.3983: f32[], param_4.2940: f32[], param_5.2717: f32[], param_6.2522: f32[], param_7.2376: f32[], param_8.2248: f32[], param_9.2197: f32[], param_10.1866: f32[], param_11.1690: f32[], param_12.1358: f32[], param_13.1018: f32[], param_14.817: f32[], param_15.600: f32[], param_16.266: f32[], param_17.111: f32[], param_18.86: f32[], param_19.69: f32[], param_20.47: f32[], param_21.24: f32[], param_22.23: f32[]) -> (pred[], f32[]) {
  %param_21.24 = f32[] parameter(21), metadata={scheduling_name="param_21.24"}
  %param_22.23 = f32[] parameter(22), metadata={scheduling_name="param_22.23"}
  %add.3116.1.clone.1 = f32[] add(%param_21.24, %param_22.23), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3116.1.clone.1"}
  %param_20.47 = f32[] parameter(20), metadata={scheduling_name="param_20.47"}
  %add.3118.1.clone.1 = f32[] add(%add.3116.1.clone.1, %param_20.47), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3118.1.clone.1"}
  %param_19.69 = f32[] parameter(19), metadata={scheduling_name="param_19.69"}
  %add.3119.1.clone.1 = f32[] add(%add.3118.1.clone.1, %param_19.69), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3119.1.clone.1"}
  %param_18.86 = f32[] parameter(18), metadata={scheduling_name="param_18.86"}
  %add.3120.1.clone.1 = f32[] add(%add.3119.1.clone.1, %param_18.86), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3120.1.clone.1"}
  %param_17.111 = f32[] parameter(17), metadata={scheduling_name="param_17.111"}
  %add.3121.1.clone.1 = f32[] add(%add.3120.1.clone.1, %param_17.111), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3121.1.clone.1"}
  %param_16.266 = f32[] parameter(16), metadata={scheduling_name="param_16.266"}
  %add.3122.1.clone.1 = f32[] add(%add.3121.1.clone.1, %param_16.266), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3122.1.clone.1"}
  %param_15.600 = f32[] parameter(15), metadata={scheduling_name="param_15.600"}
  %add.3123.1.clone.1 = f32[] add(%add.3122.1.clone.1, %param_15.600), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3123.1.clone.1"}
  %param_14.817 = f32[] parameter(14), metadata={scheduling_name="param_14.817"}
  %add.3124.1.clone.1 = f32[] add(%add.3123.1.clone.1, %param_14.817), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3124.1.clone.1"}
  %param_13.1018 = f32[] parameter(13), metadata={scheduling_name="param_13.1018"}
  %add.3125.1.clone.1 = f32[] add(%add.3124.1.clone.1, %param_13.1018), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3125.1.clone.1"}
  %param_12.1358 = f32[] parameter(12), metadata={scheduling_name="param_12.1358"}
  %add.3126.1.clone.1 = f32[] add(%add.3125.1.clone.1, %param_12.1358), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3126.1.clone.1"}
  %param_11.1690 = f32[] parameter(11), metadata={scheduling_name="param_11.1690"}
  %add.3127.1.clone.1 = f32[] add(%add.3126.1.clone.1, %param_11.1690), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3127.1.clone.1"}
  %param_10.1866 = f32[] parameter(10), metadata={scheduling_name="param_10.1866"}
  %add.3128.1.clone.1 = f32[] add(%add.3127.1.clone.1, %param_10.1866), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3128.1.clone.1"}
  %param_9.2197 = f32[] parameter(9), metadata={scheduling_name="param_9.2197"}
  %add.3129.1.clone.1 = f32[] add(%add.3128.1.clone.1, %param_9.2197), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3129.1.clone.1"}
  %param_8.2248 = f32[] parameter(8), metadata={scheduling_name="param_8.2248"}
  %add.3130.1.clone.1 = f32[] add(%add.3129.1.clone.1, %param_8.2248), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3130.1.clone.1"}
  %param_7.2376 = f32[] parameter(7), metadata={scheduling_name="param_7.2376"}
  %add.3131.1.clone.1 = f32[] add(%add.3130.1.clone.1, %param_7.2376), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3131.1.clone.1"}
  %param_6.2522 = f32[] parameter(6), metadata={scheduling_name="param_6.2522"}
  %add.3132.1.clone.1 = f32[] add(%add.3131.1.clone.1, %param_6.2522), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3132.1.clone.1"}
  %param_5.2717 = f32[] parameter(5), metadata={scheduling_name="param_5.2717"}
  %add.3133.1.clone.1 = f32[] add(%add.3132.1.clone.1, %param_5.2717), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3133.1.clone.1"}
  %param_4.2940 = f32[] parameter(4), metadata={scheduling_name="param_4.2940"}
  %add.3134.1.clone.1 = f32[] add(%add.3133.1.clone.1, %param_4.2940), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3134.1.clone.1"}
  %param_3.3983 = f32[] parameter(3), metadata={scheduling_name="param_3.3983"}
  %add.3135.1.clone.1 = f32[] add(%add.3134.1.clone.1, %param_3.3983), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3135.1.clone.1"}
  %param_2.4758 = f32[] parameter(2), metadata={scheduling_name="param_2.4758"}
  %add.3136.1.clone.1 = f32[] add(%add.3135.1.clone.1, %param_2.4758), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3136.1.clone.1"}
  %param_1.6477 = f32[] parameter(1), metadata={scheduling_name="param_1.6477"}
  %add.3137.1.clone.1 = f32[] add(%add.3136.1.clone.1, %param_1.6477), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3137.1.clone.1"}
  %param_0.6076 = f32[] parameter(0), metadata={scheduling_name="param_0.6076"}
  %add.3138.1.clone.1 = f32[] add(%add.3137.1.clone.1, %param_0.6076), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.3138.1.clone.1"}
  %sqrt.81.1.clone.1 = f32[] sqrt(%add.3138.1.clone.1), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="sqrt.81.1.clone.1"}
  %constant_3239_1 = bf16[] constant(1)
  %convert.4392.1 = f32[] convert(%constant_3239_1), metadata={scheduling_name="convert.4392.1"}
  %compare.1725.1 = pred[] compare(%sqrt.81.1.clone.1, %convert.4392.1), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="compare.1725.1"}
  ROOT %tuple.624 = (pred[], f32[]) tuple(%compare.1725.1, %sqrt.81.1.clone.1), metadata={scheduling_name="tuple.624"}
}

%fused_multiply.7 (param_0.5836: s32[]) -> f32[] {
  %param_0.5836 = s32[] parameter(0), metadata={scheduling_name="param_0.5836"}
  %constant_2980_3 = s32[] constant(1)
  %compare.1719.1 = pred[] compare(%param_0.5836, %constant_2980_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1719.1"}
  %constant_2982_3 = f32[] constant(1)
  %constant_2984_2 = s32[] constant(0)
  %maximum.49.1 = s32[] maximum(%constant_2984_2, %param_0.5836), metadata={op_name="jit(train_step)/jit(main)/jit(clip)/max" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="maximum.49.1"}
  %minimum.4.1 = s32[] minimum(%constant_2980_3, %maximum.49.1), metadata={op_name="jit(train_step)/jit(main)/jit(clip)/min" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="minimum.4.1"}
  %convert.4317.1 = f32[] convert(%minimum.4.1), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="convert.4317.1"}
  %subtract.268.1 = f32[] subtract(%constant_2982_3, %convert.4317.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="subtract.268.1"}
  %constant_2985_1 = f32[] constant(-3e-05)
  %multiply.2738.1 = f32[] multiply(%subtract.268.1, %constant_2985_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2738.1"}
  %constant_2986_1 = f32[] constant(3e-05)
  %add.3102.1 = f32[] add(%multiply.2738.1, %constant_2986_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3102.1"}
  %constant_2987_1 = s32[] constant(-1)
  %add.3103.1 = s32[] add(%param_0.5836, %constant_2987_1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3103.1"}
  %convert.4318.1 = f32[] convert(%add.3103.1), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1260 scheduling_name="convert.4318.1"}
  %constant_2988_1 = f32[] constant(0.224399492)
  %multiply.2739.1 = f32[] multiply(%convert.4318.1, %constant_2988_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="multiply.2739.1"}
  %cosine.72.1 = f32[] cosine(%multiply.2739.1), metadata={op_name="jit(train_step)/jit(main)/cos" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="cosine.72.1"}
  %add.3104.1 = f32[] add(%cosine.72.1, %constant_2982_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="add.3104.1"}
  %constant_2990_1 = f32[] constant(1.5e-05)
  %multiply.2740.1 = f32[] multiply(%add.3104.1, %constant_2990_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="multiply.2740.1"}
  %constant_2992_1 = f32[] constant(0.5)
  %multiply.2741.1 = f32[] multiply(%add.3104.1, %constant_2992_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1261 scheduling_name="multiply.2741.1"}
  %subtract.269.1 = f32[] subtract(%constant_2982_3, %multiply.2741.1), metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="subtract.269.1"}
  %constant_2993_1 = f32[] constant(3e-06)
  %multiply.2742.1 = f32[] multiply(%subtract.269.1, %constant_2993_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="multiply.2742.1"}
  %add.3105.1 = f32[] add(%multiply.2740.1, %multiply.2742.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=1262 scheduling_name="add.3105.1"}
  %select.1366.1 = f32[] select(%compare.1719.1, %add.3102.1, %add.3105.1), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1366.1"}
  %constant_2994_1 = f32[] constant(-1)
  ROOT %multiply.2743.1 = f32[] multiply(%select.1366.1, %constant_2994_1), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2743.1"}
}

%fused_convert_reduce.22 (param_0.6010: bf16[2,1,768,8,128], param_1.6436: f32[], param_2.4624: bf16[2,1,768,8,128], param_3.3807: f32[], param_4.2780: bf16[2,1,768,8,128], param_5.2556: bf16[2,1,768,8,128], param_6.2308: f32[], param_7.2134: pred[], param_8.1973: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6010 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6010"}
  %convert.4555.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6010), metadata={scheduling_name="convert.4555.16"}
  %param_8.1973 = f32[] parameter(8), metadata={scheduling_name="param_8.1973"}
  %broadcast.6218.16 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1973), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6218.16"}
  %param_7.2134 = pred[] parameter(7), metadata={scheduling_name="param_7.2134"}
  %broadcast.5920.40 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2134), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5920.40"}
  %param_5.2556 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2556"}
  %convert.4362.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2556), metadata={scheduling_name="convert.4362.20"}
  %param_6.2308 = f32[] parameter(6), metadata={scheduling_name="param_6.2308"}
  %broadcast.6220.56 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2308), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6220.56"}
  %divide.502.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4362.20, %broadcast.6220.56), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.502.17"}
  %convert.4559.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.502.17), metadata={scheduling_name="convert.4559.15"}
  %select.1377.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5920.40, %param_5.2556, %convert.4559.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1377.13"}
  %convert.4560.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1377.13), metadata={scheduling_name="convert.4560.26"}
  %constant_3240_46 = bf16[] constant(0.1001)
  %convert.5017.348 = f32[] convert(%constant_3240_46), metadata={scheduling_name="convert.5017.348"}
  %broadcast.6222.73 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5017.348), dimensions={}, metadata={scheduling_name="broadcast.6222.73"}
  %multiply.2853.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4560.26, %broadcast.6222.73), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2853.11"}
  %param_4.2780 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2780"}
  %convert.4562.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2780), metadata={scheduling_name="convert.4562.9"}
  %constant_3241_45 = bf16[] constant(0.8984)
  %convert.5018.185 = f32[] convert(%constant_3241_45), metadata={scheduling_name="convert.5018.185"}
  %broadcast.6224.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.185), dimensions={}, metadata={scheduling_name="broadcast.6224.37"}
  %multiply.2854.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4562.9, %broadcast.6224.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2854.11"}
  %add.3181.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2853.11, %multiply.2854.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3181.9"}
  %param_3.3807 = f32[] parameter(3), metadata={scheduling_name="param_3.3807"}
  %broadcast.6226.24 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3807), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6226.24"}
  %multiply.2855.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4560.26, %convert.4560.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2855.15"}
  %constant_3247_45 = bf16[] constant(0.05005)
  %convert.5021.185 = f32[] convert(%constant_3247_45), metadata={scheduling_name="convert.5021.185"}
  %broadcast.6228.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5021.185), dimensions={}, metadata={scheduling_name="broadcast.6228.37"}
  %multiply.2856.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2855.15, %broadcast.6228.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2856.11"}
  %param_2.4624 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4624"}
  %convert.4568.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4624), metadata={scheduling_name="convert.4568.9"}
  %constant_3248_45 = bf16[] constant(0.9492)
  %convert.5023.187 = f32[] convert(%constant_3248_45), metadata={scheduling_name="convert.5023.187"}
  %broadcast.6230.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.187), dimensions={}, metadata={scheduling_name="broadcast.6230.37"}
  %multiply.2857.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4568.9, %broadcast.6230.37), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2857.11"}
  %add.3182.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2856.11, %multiply.2857.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3182.9"}
  %param_1.6436 = f32[] parameter(1), metadata={scheduling_name="param_1.6436"}
  %broadcast.6232.40 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6436), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6232.40"}
  %divide.503.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3182.9, %broadcast.6232.40), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.503.13"}
  %sqrt.90.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.503.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.90.11"}
  %constant_3251_33 = bf16[] constant(1.001e-08)
  %convert.5025.162 = f32[] convert(%constant_3251_33), metadata={scheduling_name="convert.5025.162"}
  %broadcast.6234.29 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5025.162), dimensions={}, metadata={scheduling_name="broadcast.6234.29"}
  %add.3183.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.90.11, %broadcast.6234.29), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3183.9"}
  %multiply.2858.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6226.24, %add.3183.9), metadata={scheduling_name="multiply.2858.9"}
  %divide.504.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3181.9, %multiply.2858.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.504.7"}
  %multiply.2859.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4555.16, %broadcast.6222.73), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2859.11"}
  %add.3184.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.504.7, %multiply.2859.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3184.9"}
  %multiply.2860.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6218.16, %add.3184.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2860.7"}
  %add.3185.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4555.16, %multiply.2860.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3185.5"}
  %convert.4574.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3185.5), metadata={scheduling_name="convert.4574.1"}
  %convert.4928.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3181.9), metadata={scheduling_name="convert.4928.1.clone.1"}
  %multiply.2996.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3185.5, %add.3185.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.2996.1.clone.1"}
  %bitcast.30091.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2996.1.clone.1), metadata={scheduling_name="bitcast.30091.1.clone.1"}
  %constant_3026_125_clone_1 = f32[] constant(0)
  %reduce.677.1.clone.1 = f32[1024]{0} reduce(%bitcast.30091.1.clone.1, %constant_3026_125_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.677.1.clone.1"}
  %convert.4959.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3182.9), metadata={scheduling_name="convert.4959.1.clone.1"}
  %bitcast.29658.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2855.15), metadata={scheduling_name="bitcast.29658.1.clone.1"}
  %reduce.641.1.clone.1 = f32[1024]{0} reduce(%bitcast.29658.1.clone.1, %constant_3026_125_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.641.1.clone.1"}
  ROOT %tuple.629 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4574.1, %convert.4928.1.clone.1, %reduce.677.1.clone.1, %convert.4959.1.clone.1, %reduce.641.1.clone.1), metadata={scheduling_name="tuple.629"}
}

%fused_convert_reduce.23 (param_0.6011: bf16[2,1,768,8,128], param_1.6437: f32[], param_2.4625: bf16[2,1,768,8,128], param_3.3808: f32[], param_4.2781: bf16[2,1,768,8,128], param_5.2557: bf16[2,1,768,8,128], param_6.2309: f32[], param_7.2135: pred[], param_8.1974: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6011 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6011"}
  %convert.4626.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6011), metadata={scheduling_name="convert.4626.16"}
  %param_8.1974 = f32[] parameter(8), metadata={scheduling_name="param_8.1974"}
  %broadcast.6218.20 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1974), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6218.20"}
  %param_7.2135 = pred[] parameter(7), metadata={scheduling_name="param_7.2135"}
  %broadcast.5920.44 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2135), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5920.44"}
  %param_5.2557 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2557"}
  %convert.4368.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2557), metadata={scheduling_name="convert.4368.20"}
  %param_6.2309 = f32[] parameter(6), metadata={scheduling_name="param_6.2309"}
  %broadcast.6220.60 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2309), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6220.60"}
  %divide.511.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4368.20, %broadcast.6220.60), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.511.17"}
  %convert.4632.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.511.17), metadata={scheduling_name="convert.4632.15"}
  %select.1380.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5920.44, %param_5.2557, %convert.4632.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1380.13"}
  %convert.4634.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1380.13), metadata={scheduling_name="convert.4634.26"}
  %constant_3240_48 = bf16[] constant(0.1001)
  %convert.5017.356 = f32[] convert(%constant_3240_48), metadata={scheduling_name="convert.5017.356"}
  %broadcast.6222.81 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5017.356), dimensions={}, metadata={scheduling_name="broadcast.6222.81"}
  %multiply.2877.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4634.26, %broadcast.6222.81), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2877.11"}
  %param_4.2781 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2781"}
  %convert.4637.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2781), metadata={scheduling_name="convert.4637.9"}
  %constant_3241_46 = bf16[] constant(0.8984)
  %convert.5018.189 = f32[] convert(%constant_3241_46), metadata={scheduling_name="convert.5018.189"}
  %broadcast.6224.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.189), dimensions={}, metadata={scheduling_name="broadcast.6224.41"}
  %multiply.2878.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4637.9, %broadcast.6224.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2878.11"}
  %add.3196.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2877.11, %multiply.2878.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3196.9"}
  %param_3.3808 = f32[] parameter(3), metadata={scheduling_name="param_3.3808"}
  %broadcast.6226.28 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3808), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6226.28"}
  %multiply.2879.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4634.26, %convert.4634.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2879.15"}
  %constant_3247_46 = bf16[] constant(0.05005)
  %convert.5021.189 = f32[] convert(%constant_3247_46), metadata={scheduling_name="convert.5021.189"}
  %broadcast.6228.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5021.189), dimensions={}, metadata={scheduling_name="broadcast.6228.41"}
  %multiply.2880.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2879.15, %broadcast.6228.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2880.11"}
  %param_2.4625 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4625"}
  %convert.4646.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4625), metadata={scheduling_name="convert.4646.9"}
  %constant_3248_46 = bf16[] constant(0.9492)
  %convert.5023.191 = f32[] convert(%constant_3248_46), metadata={scheduling_name="convert.5023.191"}
  %broadcast.6230.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.191), dimensions={}, metadata={scheduling_name="broadcast.6230.41"}
  %multiply.2881.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4646.9, %broadcast.6230.41), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2881.11"}
  %add.3197.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2880.11, %multiply.2881.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3197.9"}
  %param_1.6437 = f32[] parameter(1), metadata={scheduling_name="param_1.6437"}
  %broadcast.6232.44 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6437), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6232.44"}
  %divide.512.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3197.9, %broadcast.6232.44), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.512.13"}
  %sqrt.93.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.512.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.93.11"}
  %constant_3251_34 = bf16[] constant(1.001e-08)
  %convert.5025.166 = f32[] convert(%constant_3251_34), metadata={scheduling_name="convert.5025.166"}
  %broadcast.6234.33 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5025.166), dimensions={}, metadata={scheduling_name="broadcast.6234.33"}
  %add.3198.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.93.11, %broadcast.6234.33), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3198.9"}
  %multiply.2882.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6226.28, %add.3198.9), metadata={scheduling_name="multiply.2882.9"}
  %divide.513.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3196.9, %multiply.2882.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.513.7"}
  %multiply.2883.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4626.16, %broadcast.6222.81), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2883.11"}
  %add.3199.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.513.7, %multiply.2883.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3199.9"}
  %multiply.2884.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6218.20, %add.3199.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2884.7"}
  %add.3201.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4626.16, %multiply.2884.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3201.5"}
  %convert.4655.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3201.5), metadata={scheduling_name="convert.4655.1"}
  %convert.4932.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3196.9), metadata={scheduling_name="convert.4932.1.clone.1"}
  %multiply.3000.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3201.5, %add.3201.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3000.1.clone.1"}
  %bitcast.30145.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.3000.1.clone.1), metadata={scheduling_name="bitcast.30145.1.clone.1"}
  %constant_3026_128_clone_1 = f32[] constant(0)
  %reduce.683.1.clone.1 = f32[1024]{0} reduce(%bitcast.30145.1.clone.1, %constant_3026_128_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.683.1.clone.1"}
  %convert.4962.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3197.9), metadata={scheduling_name="convert.4962.1.clone.1"}
  %bitcast.29709.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2879.15), metadata={scheduling_name="bitcast.29709.1.clone.1"}
  %reduce.647.1.clone.1 = f32[1024]{0} reduce(%bitcast.29709.1.clone.1, %constant_3026_128_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.647.1.clone.1"}
  ROOT %tuple.632 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4655.1, %convert.4932.1.clone.1, %reduce.683.1.clone.1, %convert.4962.1.clone.1, %reduce.647.1.clone.1), metadata={scheduling_name="tuple.632"}
}

%fused_convert_reduce.24 (param_0.6012: bf16[2,1,768,8,128], param_1.6438: f32[], param_2.4626: bf16[2,1,768,8,128], param_3.3809: f32[], param_4.2782: bf16[2,1,768,8,128], param_5.2558: bf16[2,1,768,8,128], param_6.2310: f32[], param_7.2136: pred[], param_8.1975: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6012 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6012"}
  %convert.4803.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6012), metadata={scheduling_name="convert.4803.16"}
  %param_8.1975 = f32[] parameter(8), metadata={scheduling_name="param_8.1975"}
  %broadcast.6218.24 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1975), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6218.24"}
  %param_7.2136 = pred[] parameter(7), metadata={scheduling_name="param_7.2136"}
  %broadcast.5920.48 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2136), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5920.48"}
  %param_5.2558 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2558"}
  %convert.4382.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2558), metadata={scheduling_name="convert.4382.20"}
  %param_6.2310 = f32[] parameter(6), metadata={scheduling_name="param_6.2310"}
  %broadcast.6220.64 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2310), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6220.64"}
  %divide.532.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4382.20, %broadcast.6220.64), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.532.17"}
  %convert.4807.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.532.17), metadata={scheduling_name="convert.4807.15"}
  %select.1387.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5920.48, %param_5.2558, %convert.4807.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1387.13"}
  %convert.4808.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1387.13), metadata={scheduling_name="convert.4808.26"}
  %constant_3240_50 = bf16[] constant(0.1001)
  %convert.5017.364 = f32[] convert(%constant_3240_50), metadata={scheduling_name="convert.5017.364"}
  %broadcast.6222.89 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5017.364), dimensions={}, metadata={scheduling_name="broadcast.6222.89"}
  %multiply.2939.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4808.26, %broadcast.6222.89), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2939.11"}
  %param_4.2782 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2782"}
  %convert.4810.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2782), metadata={scheduling_name="convert.4810.9"}
  %constant_3241_47 = bf16[] constant(0.8984)
  %convert.5018.193 = f32[] convert(%constant_3241_47), metadata={scheduling_name="convert.5018.193"}
  %broadcast.6224.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.193), dimensions={}, metadata={scheduling_name="broadcast.6224.45"}
  %multiply.2940.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4810.9, %broadcast.6224.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2940.11"}
  %add.3232.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2939.11, %multiply.2940.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3232.9"}
  %param_3.3809 = f32[] parameter(3), metadata={scheduling_name="param_3.3809"}
  %broadcast.6226.32 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3809), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6226.32"}
  %multiply.2941.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4808.26, %convert.4808.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2941.15"}
  %constant_3247_47 = bf16[] constant(0.05005)
  %convert.5021.193 = f32[] convert(%constant_3247_47), metadata={scheduling_name="convert.5021.193"}
  %broadcast.6228.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5021.193), dimensions={}, metadata={scheduling_name="broadcast.6228.45"}
  %multiply.2942.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2941.15, %broadcast.6228.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2942.11"}
  %param_2.4626 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4626"}
  %convert.4816.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4626), metadata={scheduling_name="convert.4816.9"}
  %constant_3248_47 = bf16[] constant(0.9492)
  %convert.5023.195 = f32[] convert(%constant_3248_47), metadata={scheduling_name="convert.5023.195"}
  %broadcast.6230.45 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.195), dimensions={}, metadata={scheduling_name="broadcast.6230.45"}
  %multiply.2943.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4816.9, %broadcast.6230.45), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2943.11"}
  %add.3233.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2942.11, %multiply.2943.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3233.9"}
  %param_1.6438 = f32[] parameter(1), metadata={scheduling_name="param_1.6438"}
  %broadcast.6232.48 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6438), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6232.48"}
  %divide.533.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3233.9, %broadcast.6232.48), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.533.13"}
  %sqrt.100.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.533.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.100.11"}
  %constant_3251_35 = bf16[] constant(1.001e-08)
  %convert.5025.170 = f32[] convert(%constant_3251_35), metadata={scheduling_name="convert.5025.170"}
  %broadcast.6234.37 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5025.170), dimensions={}, metadata={scheduling_name="broadcast.6234.37"}
  %add.3234.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.100.11, %broadcast.6234.37), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3234.9"}
  %multiply.2944.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6226.32, %add.3234.9), metadata={scheduling_name="multiply.2944.9"}
  %divide.534.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3232.9, %multiply.2944.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.534.7"}
  %multiply.2945.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4803.16, %broadcast.6222.89), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2945.11"}
  %add.3235.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.534.7, %multiply.2945.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3235.9"}
  %multiply.2946.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6218.24, %add.3235.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2946.7"}
  %add.3236.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4803.16, %multiply.2946.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3236.5"}
  %convert.4822.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3236.5), metadata={scheduling_name="convert.4822.1"}
  %convert.4943.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3232.9), metadata={scheduling_name="convert.4943.1.clone.1"}
  %multiply.3008.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3236.5, %add.3236.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3008.1.clone.1"}
  %bitcast.30271.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.3008.1.clone.1), metadata={scheduling_name="bitcast.30271.1.clone.1"}
  %constant_3026_132_clone_1 = f32[] constant(0)
  %reduce.691.1.clone.1 = f32[1024]{0} reduce(%bitcast.30271.1.clone.1, %constant_3026_132_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.691.1.clone.1"}
  %convert.4969.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3233.9), metadata={scheduling_name="convert.4969.1.clone.1"}
  %bitcast.29828.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2941.15), metadata={scheduling_name="bitcast.29828.1.clone.1"}
  %reduce.655.1.clone.1 = f32[1024]{0} reduce(%bitcast.29828.1.clone.1, %constant_3026_132_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.655.1.clone.1"}
  ROOT %tuple.636 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4822.1, %convert.4943.1.clone.1, %reduce.691.1.clone.1, %convert.4969.1.clone.1, %reduce.655.1.clone.1), metadata={scheduling_name="tuple.636"}
}

%fused_convert_reduce.25 (param_0.6003: bf16[2,1,768,8,128], param_1.6430: f32[], param_2.4618: bf16[2,1,768,8,128], param_3.3801: f32[], param_4.2774: bf16[2,1,768,8,128], param_5.2550: bf16[2,1,768,8,128], param_6.2302: f32[], param_7.2128: pred[], param_8.1967: f32[]) -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], f32[1024], bf16[2,1,768,8,128], f32[1024]) {
  %param_0.6003 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(0), metadata={scheduling_name="param_0.6003"}
  %convert.4864.16 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_0.6003), metadata={scheduling_name="convert.4864.16"}
  %param_8.1967 = f32[] parameter(8), metadata={scheduling_name="param_8.1967"}
  %broadcast.6218.28 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_8.1967), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6218.28"}
  %param_7.2128 = pred[] parameter(7), metadata={scheduling_name="param_7.2128"}
  %broadcast.5920.52 = pred[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_7.2128), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.5920.52"}
  %param_5.2550 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(5), metadata={scheduling_name="param_5.2550"}
  %convert.4388.20 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_5.2550), metadata={scheduling_name="convert.4388.20"}
  %param_6.2302 = f32[] parameter(6), metadata={scheduling_name="param_6.2302"}
  %broadcast.6220.68 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_6.2302), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="broadcast.6220.68"}
  %divide.541.17 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%convert.4388.20, %broadcast.6220.68), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="divide.541.17"}
  %convert.4869.15 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%divide.541.17), metadata={scheduling_name="convert.4869.15"}
  %select.1390.13 = bf16[2,1,768,8,128]{4,3,2,1,0} select(%broadcast.5920.52, %param_5.2550, %convert.4869.15), metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="select.1390.13"}
  %convert.4870.26 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%select.1390.13), metadata={scheduling_name="convert.4870.26"}
  %constant_3240_17 = bf16[] constant(0.1001)
  %convert.5017.372 = f32[] convert(%constant_3240_17), metadata={scheduling_name="convert.5017.372"}
  %broadcast.6222.97 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5017.372), dimensions={}, metadata={scheduling_name="broadcast.6222.97"}
  %multiply.2968.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4870.26, %broadcast.6222.97), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2968.11"}
  %param_4.2774 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(4), metadata={scheduling_name="param_4.2774"}
  %convert.4872.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_4.2774), metadata={scheduling_name="convert.4872.9"}
  %constant_3241_17 = bf16[] constant(0.8984)
  %convert.5018.197 = f32[] convert(%constant_3241_17), metadata={scheduling_name="convert.5018.197"}
  %broadcast.6224.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5018.197), dimensions={}, metadata={scheduling_name="broadcast.6224.49"}
  %multiply.2969.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4872.9, %broadcast.6224.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2969.11"}
  %add.3249.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2968.11, %multiply.2969.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3249.9"}
  %param_3.3801 = f32[] parameter(3), metadata={scheduling_name="param_3.3801"}
  %broadcast.6226.36 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_3.3801), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6226.36"}
  %multiply.2970.15 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4870.26, %convert.4870.26), metadata={op_name="jit(train_step)/jit(main)/integer_pow" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2970.15"}
  %constant_3247_17 = bf16[] constant(0.05005)
  %convert.5021.197 = f32[] convert(%constant_3247_17), metadata={scheduling_name="convert.5021.197"}
  %broadcast.6228.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5021.197), dimensions={}, metadata={scheduling_name="broadcast.6228.49"}
  %multiply.2971.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%multiply.2970.15, %broadcast.6228.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2971.11"}
  %param_2.4618 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(2), metadata={scheduling_name="param_2.4618"}
  %convert.4878.9 = f32[2,1,768,8,128]{4,3,2,1,0} convert(%param_2.4618), metadata={scheduling_name="convert.4878.9"}
  %constant_3248_17 = bf16[] constant(0.9492)
  %convert.5023.199 = f32[] convert(%constant_3248_17), metadata={scheduling_name="convert.5023.199"}
  %broadcast.6230.49 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5023.199), dimensions={}, metadata={scheduling_name="broadcast.6230.49"}
  %multiply.2972.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4878.9, %broadcast.6230.49), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2972.11"}
  %add.3250.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%multiply.2971.11, %multiply.2972.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3250.9"}
  %param_1.6430 = f32[] parameter(1), metadata={scheduling_name="param_1.6430"}
  %broadcast.6232.52 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%param_1.6430), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="broadcast.6232.52"}
  %divide.542.13 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3250.9, %broadcast.6232.52), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.542.13"}
  %sqrt.103.11 = f32[2,1,768,8,128]{4,3,2,1,0} sqrt(%divide.542.13), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="sqrt.103.11"}
  %constant_3251_17 = bf16[] constant(1.001e-08)
  %convert.5025.174 = f32[] convert(%constant_3251_17), metadata={scheduling_name="convert.5025.174"}
  %broadcast.6234.41 = f32[2,1,768,8,128]{4,3,2,1,0} broadcast(%convert.5025.174), dimensions={}, metadata={scheduling_name="broadcast.6234.41"}
  %add.3251.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%sqrt.103.11, %broadcast.6234.41), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3251.9"}
  %multiply.2973.9 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6226.36, %add.3251.9), metadata={scheduling_name="multiply.2973.9"}
  %divide.543.7 = f32[2,1,768,8,128]{4,3,2,1,0} divide(%add.3249.9, %multiply.2973.9), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="divide.543.7"}
  %multiply.2974.11 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%convert.4864.16, %broadcast.6222.97), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2974.11"}
  %add.3252.9 = f32[2,1,768,8,128]{4,3,2,1,0} add(%divide.543.7, %multiply.2974.11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3252.9"}
  %multiply.2975.7 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%broadcast.6218.28, %add.3252.9), metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="multiply.2975.7"}
  %add.3253.5 = f32[2,1,768,8,128]{4,3,2,1,0} add(%convert.4864.16, %multiply.2975.7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3253.5"}
  %convert.4884.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3253.5), metadata={scheduling_name="convert.4884.1"}
  %convert.4947.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3249.9), metadata={scheduling_name="convert.4947.1.clone.1"}
  %multiply.3011.1.clone.1 = f32[2,1,768,8,128]{4,3,2,1,0} multiply(%add.3253.5, %add.3253.5), metadata={op_name="jit(train_step)/jit(main)/square" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="multiply.3011.1.clone.1"}
  %bitcast.30325.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.3011.1.clone.1), metadata={scheduling_name="bitcast.30325.1.clone.1"}
  %constant_3026_135_clone_1 = f32[] constant(0)
  %reduce.697.1.clone.1 = f32[1024]{0} reduce(%bitcast.30325.1.clone.1, %constant_3026_135_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.697.1.clone.1"}
  %convert.4972.1.clone.1 = bf16[2,1,768,8,128]{4,3,2,1,0} convert(%add.3250.9), metadata={scheduling_name="convert.4972.1.clone.1"}
  %bitcast.29879.1.clone.1 = f32[1024,1536]{1,0} bitcast(%multiply.2970.15), metadata={scheduling_name="bitcast.29879.1.clone.1"}
  %reduce.661.1.clone.1 = f32[1024]{0} reduce(%bitcast.29879.1.clone.1, %constant_3026_135_clone_1), dimensions={1}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.661.1.clone.1"}
  ROOT %tuple.639 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) tuple(%convert.4884.1, %convert.4947.1.clone.1, %reduce.697.1.clone.1, %convert.4972.1.clone.1, %reduce.661.1.clone.1), metadata={scheduling_name="tuple.639"}
}

%fused_reduce.70 (param_0.5833: s32[256]) -> s32[] {
  %param_0.5833 = s32[256]{0} parameter(0), metadata={scheduling_name="param_0.5833"}
  %constant_2984_4 = s32[] constant(0)
  ROOT %reduce.179.1 = s32[] reduce(%param_0.5833, %constant_2984_4), dimensions={0}, to_apply=%region_7.620, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="reduce.179.1"}
}

%fused_broadcast.7 () -> (bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144], bf16[1,4,8192,6144]) {
  %constant_2996_1 = bf16[] constant(0)
  %broadcast.5778.1 = bf16[1,4,8192,6144]{3,2,1,0} broadcast(%constant_2996_1), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=97 scheduling_name="broadcast.5778.1"}
  %copy.1022 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5778.1), metadata={scheduling_name="copy.1022"}
  %copy.1023 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5778.1), metadata={scheduling_name="copy.1023"}
  %copy.1024 = bf16[1,4,8192,6144]{3,2,1,0} copy(%broadcast.5778.1), metadata={scheduling_name="copy.1024"}
  ROOT %tuple.674 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) tuple(%broadcast.5778.1, %copy.1022, %copy.1023, %copy.1024), metadata={scheduling_name="tuple.674"}
}

%fused_broadcast.8 () -> (bf16[1,4,4,8192,6144], bf16[1,4,4,8192,6144]) {
  %constant_2996_2 = bf16[] constant(0)
  %broadcast.5777.1 = bf16[1,4,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2996_2), dimensions={}, metadata={scheduling_name="broadcast.5777.1"}
  %copy.1021 = bf16[1,4,4,8192,6144]{4,3,2,1,0} copy(%broadcast.5777.1), metadata={scheduling_name="copy.1021"}
  ROOT %tuple.673 = (bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}) tuple(%broadcast.5777.1, %copy.1021), metadata={scheduling_name="tuple.673"}
}

%fused_broadcast.9 () -> bf16[2,1,4,8192,6144] {
  %constant_2996_3 = bf16[] constant(0)
  ROOT %broadcast.5838.1 = bf16[2,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2996_3), dimensions={}, metadata={scheduling_name="broadcast.5838.1"}
}

%fused_broadcast.10 () -> (bf16[9,1,4,8192,6144], bf16[9,1,4,8192,6144]) {
  %constant_2996_4 = bf16[] constant(0)
  %broadcast.5781.1 = bf16[9,1,4,8192,6144]{4,3,2,1,0} broadcast(%constant_2996_4), dimensions={}, metadata={scheduling_name="broadcast.5781.1"}
  %copy.1025 = bf16[9,1,4,8192,6144]{4,3,2,1,0} copy(%broadcast.5781.1), metadata={scheduling_name="copy.1025"}
  ROOT %tuple.675 = (bf16[9,1,4,8192,6144]{4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}) tuple(%broadcast.5781.1, %copy.1025), metadata={scheduling_name="tuple.675"}
}

%fused_broadcast.11 () -> (bf16[9,1,4,8192,48,128], bf16[9,1,4,8192,48,128]) {
  %constant_2996_5 = bf16[] constant(0)
  %broadcast.5784.1 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} broadcast(%constant_2996_5), dimensions={}, metadata={scheduling_name="broadcast.5784.1"}
  %copy.1027 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} copy(%broadcast.5784.1), metadata={scheduling_name="copy.1027"}
  ROOT %tuple.677 = (bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}) tuple(%broadcast.5784.1, %copy.1027), metadata={scheduling_name="tuple.677"}
}

%fused_broadcast.12 () -> (bf16[2,1,768,48,128], bf16[2,1,768,48,128]) {
  %constant_2996_7 = bf16[] constant(0)
  %broadcast.5823.1 = bf16[2,1,768,48,128]{4,3,2,1,0} broadcast(%constant_2996_7), dimensions={}, metadata={scheduling_name="broadcast.5823.1"}
  %copy.1036 = bf16[2,1,768,48,128]{4,3,2,1,0} copy(%broadcast.5823.1), metadata={scheduling_name="copy.1036"}
  ROOT %tuple.682 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}) tuple(%broadcast.5823.1, %copy.1036), metadata={scheduling_name="tuple.682"}
}

%fused_convert.19 () -> f32[] {
  %constant_2996_8 = bf16[] constant(0)
  ROOT %convert.4340.1 = f32[] convert(%constant_2996_8), metadata={scheduling_name="convert.4340.1"}
}

%fused_broadcast.13 () -> (bf16[2,1,768,8,128], bf16[2,1,768,8,128], bf16[2,1,768,8,128], bf16[2,1,768,8,128]) {
  %constant_2996_9 = bf16[] constant(0)
  %broadcast.5821.1 = bf16[2,1,768,8,128]{4,3,2,1,0} broadcast(%constant_2996_9), dimensions={}, metadata={scheduling_name="broadcast.5821.1"}
  %copy.1032 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5821.1), metadata={scheduling_name="copy.1032"}
  %copy.1033 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5821.1), metadata={scheduling_name="copy.1033"}
  %copy.1034 = bf16[2,1,768,8,128]{4,3,2,1,0} copy(%broadcast.5821.1), metadata={scheduling_name="copy.1034"}
  ROOT %tuple.680 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%broadcast.5821.1, %copy.1032, %copy.1033, %copy.1034), metadata={scheduling_name="tuple.680"}
}

%fused_broadcast.14 () -> (bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384]) {
  %constant_2996_11 = bf16[] constant(0)
  %broadcast.5816.1 = bf16[2,1,1,6144,16384]{4,3,2,1,0} broadcast(%constant_2996_11), dimensions={}, metadata={scheduling_name="broadcast.5816.1"}
  %copy.1028 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5816.1), metadata={scheduling_name="copy.1028"}
  %copy.1029 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5816.1), metadata={scheduling_name="copy.1029"}
  %copy.1030 = bf16[2,1,1,6144,16384]{4,3,2,1,0} copy(%broadcast.5816.1), metadata={scheduling_name="copy.1030"}
  ROOT %tuple.678 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}) tuple(%broadcast.5816.1, %copy.1028, %copy.1029, %copy.1030), metadata={scheduling_name="tuple.678"}
}

%fused_broadcast.15 () -> (bf16[2,1,48,128,768], bf16[2,1,48,128,768]) {
  %constant_2996_12 = bf16[] constant(0)
  %broadcast.6073.1 = bf16[2,1,48,128,768]{3,2,4,1,0} broadcast(%constant_2996_12), dimensions={}, metadata={scheduling_name="broadcast.6073.1"}
  %copy.1035 = bf16[2,1,48,128,768]{3,2,4,1,0} copy(%broadcast.6073.1), metadata={scheduling_name="copy.1035"}
  ROOT %tuple.681 = (bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}) tuple(%broadcast.6073.1, %copy.1035), metadata={scheduling_name="tuple.681"}
}

%fused_broadcast.16 () -> (bf16[2,1,1,16384,6144], bf16[2,1,1,16384,6144]) {
  %constant_2996_13 = bf16[] constant(0)
  %broadcast.5818.1 = bf16[2,1,1,16384,6144]{4,3,2,1,0} broadcast(%constant_2996_13), dimensions={}, metadata={scheduling_name="broadcast.5818.1"}
  %copy.1031 = bf16[2,1,1,16384,6144]{4,3,2,1,0} copy(%broadcast.5818.1), metadata={scheduling_name="copy.1031"}
  ROOT %tuple.679 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}) tuple(%broadcast.5818.1, %copy.1031), metadata={scheduling_name="tuple.679"}
}

%fused_broadcast.17 () -> (f32[9,1,4,48,8192,1], f32[9,1,4,48,8192,1]) {
  %constant_3026_2 = f32[] constant(0)
  %broadcast.6070.1 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} broadcast(%constant_3026_2), dimensions={}, metadata={scheduling_name="broadcast.6070.1"}
  %copy.1026 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} copy(%broadcast.6070.1), metadata={scheduling_name="copy.1026"}
  ROOT %tuple.676 = (f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}) tuple(%broadcast.6070.1, %copy.1026), metadata={scheduling_name="tuple.676"}
}

%fused_reduce.71 (param_0.5863: f32[128]) -> f32[] {
  %param_0.5863 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5863"}
  %constant_3026_14 = f32[] constant(0)
  ROOT %reduce.237.1 = f32[] reduce(%param_0.5863, %constant_3026_14), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.237.1"}
}

%fused_reduce.72 (param_0.5864: f32[128]) -> f32[] {
  %param_0.5864 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5864"}
  %constant_3026_15 = f32[] constant(0)
  ROOT %reduce.236.1 = f32[] reduce(%param_0.5864, %constant_3026_15), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.236.1"}
}

%fused_reduce.73 (param_0.5865: f32[1024]) -> f32[] {
  %param_0.5865 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5865"}
  %constant_3026_16 = f32[] constant(0)
  ROOT %reduce.240.1 = f32[] reduce(%param_0.5865, %constant_3026_16), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.240.1"}
}

%fused_reduce.74 (param_0.5866: f32[128]) -> f32[] {
  %param_0.5866 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5866"}
  %constant_3026_17 = f32[] constant(0)
  ROOT %reduce.246.1 = f32[] reduce(%param_0.5866, %constant_3026_17), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.246.1"}
}

%fused_reduce.75 (param_0.5867: f32[128]) -> f32[] {
  %param_0.5867 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5867"}
  %constant_3026_18 = f32[] constant(0)
  ROOT %reduce.247.1 = f32[] reduce(%param_0.5867, %constant_3026_18), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.247.1"}
}

%fused_reduce.76 (param_0.5868: f32[128]) -> f32[] {
  %param_0.5868 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5868"}
  %constant_3026_19 = f32[] constant(0)
  ROOT %reduce.245.1 = f32[] reduce(%param_0.5868, %constant_3026_19), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.245.1"}
}

%fused_reduce.77 (param_0.5870: f32[1024]) -> f32[] {
  %param_0.5870 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5870"}
  %constant_3026_21 = f32[] constant(0)
  ROOT %reduce.243.1 = f32[] reduce(%param_0.5870, %constant_3026_21), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.243.1"}
}

%fused_reduce.78 (param_0.5871: f32[2048]) -> f32[] {
  %param_0.5871 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5871"}
  %constant_3026_22 = f32[] constant(0)
  ROOT %reduce.242.1 = f32[] reduce(%param_0.5871, %constant_3026_22), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.242.1"}
}

%fused_reduce.79 (param_0.5872: f32[2048]) -> f32[] {
  %param_0.5872 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5872"}
  %constant_3026_23 = f32[] constant(0)
  ROOT %reduce.241.1 = f32[] reduce(%param_0.5872, %constant_3026_23), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.241.1"}
}

%fused_reduce.80 (param_0.5876: f32[1024]) -> f32[] {
  %param_0.5876 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5876"}
  %constant_3026_27 = f32[] constant(0)
  ROOT %reduce.250.1 = f32[] reduce(%param_0.5876, %constant_3026_27), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.250.1"}
}

%fused_reduce.81 (param_0.5877: f32[8,8192,128]) -> f32[8,8192] {
  %param_0.5877 = f32[8,8192,128]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5877"}
  %constant_3026_28 = f32[] constant(0)
  ROOT %reduce.181.1 = f32[8,8192]{1,0} reduce(%param_0.5877, %constant_3026_28), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="reduce.181.1"}
}

%fused_reduce.82 (param_0.5878: f32[2048]) -> f32[] {
  %param_0.5878 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5878"}
  %constant_3026_29 = f32[] constant(0)
  ROOT %reduce.252.1 = f32[] reduce(%param_0.5878, %constant_3026_29), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.252.1"}
}

%fused_reduce.83 (param_0.5880: f32[4096]) -> f32[] {
  %param_0.5880 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5880"}
  %constant_3026_31 = f32[] constant(0)
  ROOT %reduce.184.1 = f32[] reduce(%param_0.5880, %constant_3026_31), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.184.1"}
}

%fused_reduce.84 (param_0.5883: f32[128]) -> f32[] {
  %param_0.5883 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5883"}
  %constant_3026_34 = f32[] constant(0)
  ROOT %reduce.187.1 = f32[] reduce(%param_0.5883, %constant_3026_34), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.187.1"}
}

%fused_reduce.85 (param_0.5884: f32[128]) -> f32[] {
  %param_0.5884 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5884"}
  %constant_3026_35 = f32[] constant(0)
  ROOT %reduce.188.1 = f32[] reduce(%param_0.5884, %constant_3026_35), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.188.1"}
}

%fused_reduce.86 (param_0.5885: f32[128]) -> f32[] {
  %param_0.5885 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5885"}
  %constant_3026_36 = f32[] constant(0)
  ROOT %reduce.189.1 = f32[] reduce(%param_0.5885, %constant_3026_36), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.189.1"}
}

%fused_reduce.87 (param_0.5888: f32[1024]) -> f32[] {
  %param_0.5888 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5888"}
  %constant_3026_39 = f32[] constant(0)
  ROOT %reduce.192.1 = f32[] reduce(%param_0.5888, %constant_3026_39), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.192.1"}
}

%fused_reduce.88 (param_0.5889: f32[2048]) -> f32[] {
  %param_0.5889 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5889"}
  %constant_3026_40 = f32[] constant(0)
  ROOT %reduce.193.1 = f32[] reduce(%param_0.5889, %constant_3026_40), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.193.1"}
}

%fused_reduce.89 (param_0.5890: f32[2048]) -> f32[] {
  %param_0.5890 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5890"}
  %constant_3026_41 = f32[] constant(0)
  ROOT %reduce.194.1 = f32[] reduce(%param_0.5890, %constant_3026_41), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.194.1"}
}

%fused_reduce.90 (param_0.5891: f32[1024]) -> f32[] {
  %param_0.5891 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5891"}
  %constant_3026_42 = f32[] constant(0)
  ROOT %reduce.195.1 = f32[] reduce(%param_0.5891, %constant_3026_42), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.195.1"}
}

%fused_reduce.91 (param_0.5893: f32[128]) -> f32[] {
  %param_0.5893 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5893"}
  %constant_3026_44 = f32[] constant(0)
  ROOT %reduce.197.1 = f32[] reduce(%param_0.5893, %constant_3026_44), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.197.1"}
}

%fused_reduce.92 (param_0.5894: f32[128]) -> f32[] {
  %param_0.5894 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5894"}
  %constant_3026_45 = f32[] constant(0)
  ROOT %reduce.198.1 = f32[] reduce(%param_0.5894, %constant_3026_45), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.198.1"}
}

%fused_reduce.93 (param_0.5895: f32[128]) -> f32[] {
  %param_0.5895 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5895"}
  %constant_3026_46 = f32[] constant(0)
  ROOT %reduce.199.1 = f32[] reduce(%param_0.5895, %constant_3026_46), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.199.1"}
}

%fused_reduce.94 (param_0.5898: f32[1024]) -> f32[] {
  %param_0.5898 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5898"}
  %constant_3026_49 = f32[] constant(0)
  ROOT %reduce.202.1 = f32[] reduce(%param_0.5898, %constant_3026_49), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.202.1"}
}

%fused_reduce.95 (param_0.5899: f32[2048]) -> f32[] {
  %param_0.5899 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5899"}
  %constant_3026_50 = f32[] constant(0)
  ROOT %reduce.203.1 = f32[] reduce(%param_0.5899, %constant_3026_50), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.203.1"}
}

%fused_reduce.96 (param_0.5900: f32[2048]) -> f32[] {
  %param_0.5900 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5900"}
  %constant_3026_51 = f32[] constant(0)
  ROOT %reduce.204.1 = f32[] reduce(%param_0.5900, %constant_3026_51), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.204.1"}
}

%fused_reduce.97 (param_0.5901: f32[1024]) -> f32[] {
  %param_0.5901 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5901"}
  %constant_3026_52 = f32[] constant(0)
  ROOT %reduce.205.1 = f32[] reduce(%param_0.5901, %constant_3026_52), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.205.1"}
}

%fused_reduce.98 (param_0.5902: f32[4096]) -> f32[] {
  %param_0.5902 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5902"}
  %constant_3026_53 = f32[] constant(0)
  ROOT %reduce.206.1 = f32[] reduce(%param_0.5902, %constant_3026_53), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="reduce.206.1"}
}

%fused_reduce.99 (param_0.5904: f32[4096]) -> f32[] {
  %param_0.5904 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5904"}
  %constant_3026_55 = f32[] constant(0)
  ROOT %reduce.208.1 = f32[] reduce(%param_0.5904, %constant_3026_55), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.208.1"}
}

%fused_reduce.100 (param_0.5906: f32[128]) -> f32[] {
  %param_0.5906 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5906"}
  %constant_3026_57 = f32[] constant(0)
  ROOT %reduce.210.1 = f32[] reduce(%param_0.5906, %constant_3026_57), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.210.1"}
}

%fused_reduce.101 (param_0.5907: f32[128]) -> f32[] {
  %param_0.5907 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5907"}
  %constant_3026_58 = f32[] constant(0)
  ROOT %reduce.211.1 = f32[] reduce(%param_0.5907, %constant_3026_58), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.211.1"}
}

%fused_reduce.102 (param_0.5908: f32[128]) -> f32[] {
  %param_0.5908 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5908"}
  %constant_3026_59 = f32[] constant(0)
  ROOT %reduce.212.1 = f32[] reduce(%param_0.5908, %constant_3026_59), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.212.1"}
}

%fused_reduce.103 (param_0.5911: f32[1024]) -> f32[] {
  %param_0.5911 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5911"}
  %constant_3026_62 = f32[] constant(0)
  ROOT %reduce.215.1 = f32[] reduce(%param_0.5911, %constant_3026_62), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.215.1"}
}

%fused_reduce.104 (param_0.5912: f32[2048]) -> f32[] {
  %param_0.5912 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5912"}
  %constant_3026_63 = f32[] constant(0)
  ROOT %reduce.216.1 = f32[] reduce(%param_0.5912, %constant_3026_63), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.216.1"}
}

%fused_reduce.105 (param_0.5913: f32[2048]) -> f32[] {
  %param_0.5913 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5913"}
  %constant_3026_64 = f32[] constant(0)
  ROOT %reduce.217.1 = f32[] reduce(%param_0.5913, %constant_3026_64), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.217.1"}
}

%fused_reduce.106 (param_0.5914: f32[1024]) -> f32[] {
  %param_0.5914 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5914"}
  %constant_3026_65 = f32[] constant(0)
  ROOT %reduce.218.1 = f32[] reduce(%param_0.5914, %constant_3026_65), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.218.1"}
}

%fused_reduce.107 (param_0.5916: f32[128]) -> f32[] {
  %param_0.5916 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5916"}
  %constant_3026_67 = f32[] constant(0)
  ROOT %reduce.220.1 = f32[] reduce(%param_0.5916, %constant_3026_67), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.220.1"}
}

%fused_reduce.108 (param_0.5917: f32[128]) -> f32[] {
  %param_0.5917 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5917"}
  %constant_3026_68 = f32[] constant(0)
  ROOT %reduce.221.1 = f32[] reduce(%param_0.5917, %constant_3026_68), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.221.1"}
}

%fused_reduce.109 (param_0.5918: f32[128]) -> f32[] {
  %param_0.5918 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5918"}
  %constant_3026_69 = f32[] constant(0)
  ROOT %reduce.222.1 = f32[] reduce(%param_0.5918, %constant_3026_69), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.222.1"}
}

%fused_reduce.110 (param_0.5921: f32[1024]) -> f32[] {
  %param_0.5921 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5921"}
  %constant_3026_72 = f32[] constant(0)
  ROOT %reduce.225.1 = f32[] reduce(%param_0.5921, %constant_3026_72), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.225.1"}
}

%fused_reduce.111 (param_0.5922: f32[2048]) -> f32[] {
  %param_0.5922 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5922"}
  %constant_3026_73 = f32[] constant(0)
  ROOT %reduce.226.1 = f32[] reduce(%param_0.5922, %constant_3026_73), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.226.1"}
}

%fused_reduce.112 (param_0.5923: f32[2048]) -> f32[] {
  %param_0.5923 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5923"}
  %constant_3026_74 = f32[] constant(0)
  ROOT %reduce.227.1 = f32[] reduce(%param_0.5923, %constant_3026_74), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.227.1"}
}

%fused_reduce.113 (param_0.5924: f32[1024]) -> f32[] {
  %param_0.5924 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5924"}
  %constant_3026_75 = f32[] constant(0)
  ROOT %reduce.228.1 = f32[] reduce(%param_0.5924, %constant_3026_75), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.228.1"}
}

%fused_reduce.114 (param_0.5925: f32[4096]) -> f32[] {
  %param_0.5925 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5925"}
  %constant_3026_76 = f32[] constant(0)
  ROOT %reduce.229.1 = f32[] reduce(%param_0.5925, %constant_3026_76), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.229.1"}
}

%fused_reduce.115 (param_0.5926: f32[2048]) -> f32[] {
  %param_0.5926 = f32[2048]{0} parameter(0), metadata={scheduling_name="param_0.5926"}
  %constant_3026_77 = f32[] constant(0)
  ROOT %reduce.251.1 = f32[] reduce(%param_0.5926, %constant_3026_77), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.251.1"}
}

%fused_reduce.116 (param_0.5927: f32[8,8192,128]) -> f32[8,8192] {
  %param_0.5927 = f32[8,8192,128]{2,1,0} parameter(0), metadata={scheduling_name="param_0.5927"}
  %constant_3026_78 = f32[] constant(0)
  ROOT %reduce.230.1 = f32[8,8192]{1,0} reduce(%param_0.5927, %constant_3026_78), dimensions={2}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 scheduling_name="reduce.230.1"}
}

%fused_reduce.117 (param_0.5928: f32[1024]) -> f32[] {
  %param_0.5928 = f32[1024]{0} parameter(0), metadata={scheduling_name="param_0.5928"}
  %constant_3026_79 = f32[] constant(0)
  ROOT %reduce.253.1 = f32[] reduce(%param_0.5928, %constant_3026_79), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.253.1"}
}

%fused_reduce.118 (param_0.5929: f32[4096]) -> f32[] {
  %param_0.5929 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5929"}
  %constant_3026_80 = f32[] constant(0)
  ROOT %reduce.254.1 = f32[] reduce(%param_0.5929, %constant_3026_80), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.254.1"}
}

%fused_reduce.119 (param_0.5930: f32[256]) -> f32[] {
  %param_0.5930 = f32[256]{0} parameter(0), metadata={scheduling_name="param_0.5930"}
  %constant_3026_81 = f32[] constant(0)
  ROOT %reduce.231.1 = f32[] reduce(%param_0.5930, %constant_3026_81), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="reduce.231.1"}
}

%fused_reduce.120 (param_0.5932: f32[4096]) -> f32[] {
  %param_0.5932 = f32[4096]{0} parameter(0), metadata={scheduling_name="param_0.5932"}
  %constant_3026_83 = f32[] constant(0)
  ROOT %reduce.233.1 = f32[] reduce(%param_0.5932, %constant_3026_83), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.233.1"}
}

%fused_reduce.121 (param_0.5934: f32[128]) -> f32[] {
  %param_0.5934 = f32[128]{0} parameter(0), metadata={scheduling_name="param_0.5934"}
  %constant_3026_85 = f32[] constant(0)
  ROOT %reduce.235.1 = f32[] reduce(%param_0.5934, %constant_3026_85), dimensions={0}, to_apply=%region_1.585, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="reduce.235.1"}
}

%fused_reduce.122 (param_0.6001: f32[65536,128]) -> f32[65536] {
  %param_0.6001 = f32[65536,128]{1,0} parameter(0), metadata={scheduling_name="param_0.6001"}
  %constant_3127_2 = f32[] constant(-inf)
  ROOT %reduce.330.1 = f32[65536]{0} reduce(%param_0.6001, %constant_3127_2), dimensions={1}, to_apply=%region_3.593, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="reduce.330.1"}
}

%fused_compare_dynamic_slice (param_0.6078: s32[32], param_1.6479: u32[]) -> (pred[1], s32[1]) {
  %param_0.6078 = s32[32]{0} parameter(0), metadata={scheduling_name="param_0.6078"}
  %param_1.6479 = u32[] parameter(1), metadata={scheduling_name="param_1.6479"}
  %dynamic-slice.1567.1 = s32[1]{0} dynamic-slice(%param_0.6078, %param_1.6479), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="dynamic-slice.1567.1"}
  %constant_5167_1 = s32[1]{0} constant({0})
  %compare.1721.1 = pred[1]{0} compare(%dynamic-slice.1567.1, %constant_5167_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="compare.1721.1"}
  ROOT %tuple.646 = (pred[1]{0}, s32[1]{0}) tuple(%compare.1721.1, %dynamic-slice.1567.1), metadata={scheduling_name="tuple.646"}
}

%fused_compare.12 (param_0.6061: s32[1]) -> pred[1] {
  %param_0.6061 = s32[1]{0} parameter(0), metadata={scheduling_name="param_0.6061"}
  %constant_5170_1 = s32[1]{0} constant({1})
  ROOT %compare.1722.1 = pred[1]{0} compare(%param_0.6061, %constant_5170_1), direction=EQ, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="compare.1722.1"}
}

%fused_add_select (param_0_0.2: s32[], param_1_0.2: s32[]) -> (s32[], s32[]) {
  %param_0_0.2 = s32[] parameter(0), metadata={scheduling_name="param_0_0.2"}
  %constant_2980_5 = s32[] constant(1)
  %add.3101.2 = s32[] add(%param_0_0.2, %constant_2980_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3101.2"}
  %param_1_0.2 = s32[] parameter(1), metadata={scheduling_name="param_1_0.2"}
  %constant_3244_3 = s32[] constant(2147483647)
  %compare.1727.2 = pred[] compare(%param_1_0.2, %constant_3244_3), direction=LT, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="compare.1727.2"}
  %add.3260.2 = s32[] add(%param_1_0.2, %constant_2980_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="add.3260.2"}
  %select.1392.2 = s32[] select(%compare.1727.2, %add.3260.2, %constant_3244_3), metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="select.1392.2"}
  ROOT %tuple.650 = (s32[], s32[]) tuple(%add.3101.2, %select.1392.2), metadata={scheduling_name="tuple.650"}
}

%fused_convert.20 (param_0_0.3: f32[], param_0_1.1: f32[], param_0_2: f32[], param_0_3: f32[], param_0_4: f32[], param_0_5: f32[], param_0_6: f32[], param_0_7: f32[], param_0_8: f32[], param_0_9: f32[], param_0_10: f32[], param_0_11: f32[], param_0_12: f32[], param_0_13: f32[], param_0_14: f32[], param_0_15: f32[], param_0_16: f32[], param_0_17: f32[], param_0_18: f32[], param_0_19: f32[], param_0_20: f32[], param_0_21: f32[], param_0_22: f32[], param_1_0.3: f32[], param_1_1.1: f32[], param_1_2: f32[], param_1_3: f32[], param_1_4: f32[], param_1_5: f32[], param_1_6: f32[], param_1_7: f32[], param_1_8: f32[], param_1_9: f32[], param_1_10: f32[], param_1_11: f32[], param_1_12: f32[], param_1_13: f32[], param_1_14: f32[], param_1_15: f32[], param_1_16: f32[], param_1_17: f32[], param_1_18: f32[], param_1_19: f32[], param_1_20: f32[], param_1_21: f32[], param_1_22: f32[], param_2_0: f32[], param_2_1: f32[], param_2_2: f32[], param_2_3: f32[], param_2_4: f32[], param_2_5: f32[], param_2_6: f32[], param_2_7: f32[], param_2_8: f32[], param_2_9: f32[], param_2_10: f32[], param_2_11: f32[], param_2_12: f32[], param_2_13: f32[], param_2_14: f32[], param_2_15: f32[], param_2_16: f32[], param_2_17: f32[], param_2_18: f32[], param_2_19: f32[], param_2_20: f32[], param_2_21: f32[], param_2_22: f32[]) -> (bf16[], bf16[], bf16[]) {
  %param_0_21 = f32[] parameter(21), metadata={scheduling_name="param_0_21"}
  %param_0_22 = f32[] parameter(22), metadata={scheduling_name="param_0_22"}
  %add.3309.2 = f32[] add(%param_0_21, %param_0_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3309.2"}
  %param_0_20 = f32[] parameter(20), metadata={scheduling_name="param_0_20"}
  %add.3310.2 = f32[] add(%add.3309.2, %param_0_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3310.2"}
  %param_0_19 = f32[] parameter(19), metadata={scheduling_name="param_0_19"}
  %add.3311.2 = f32[] add(%add.3310.2, %param_0_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3311.2"}
  %param_0_18 = f32[] parameter(18), metadata={scheduling_name="param_0_18"}
  %add.3312.2 = f32[] add(%add.3311.2, %param_0_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3312.2"}
  %param_0_17 = f32[] parameter(17), metadata={scheduling_name="param_0_17"}
  %add.3313.2 = f32[] add(%add.3312.2, %param_0_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3313.2"}
  %param_0_16 = f32[] parameter(16), metadata={scheduling_name="param_0_16"}
  %add.3314.2 = f32[] add(%add.3313.2, %param_0_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3314.2"}
  %param_0_15 = f32[] parameter(15), metadata={scheduling_name="param_0_15"}
  %add.3315.2 = f32[] add(%add.3314.2, %param_0_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3315.2"}
  %param_0_14 = f32[] parameter(14), metadata={scheduling_name="param_0_14"}
  %add.3316.2 = f32[] add(%add.3315.2, %param_0_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3316.2"}
  %param_0_13 = f32[] parameter(13), metadata={scheduling_name="param_0_13"}
  %add.3317.2 = f32[] add(%add.3316.2, %param_0_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3317.2"}
  %param_0_12 = f32[] parameter(12), metadata={scheduling_name="param_0_12"}
  %add.3318.2 = f32[] add(%add.3317.2, %param_0_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3318.2"}
  %param_0_11 = f32[] parameter(11), metadata={scheduling_name="param_0_11"}
  %add.3319.2 = f32[] add(%add.3318.2, %param_0_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3319.2"}
  %param_0_10 = f32[] parameter(10), metadata={scheduling_name="param_0_10"}
  %add.3320.2 = f32[] add(%add.3319.2, %param_0_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3320.2"}
  %param_0_9 = f32[] parameter(9), metadata={scheduling_name="param_0_9"}
  %add.3322.2 = f32[] add(%add.3320.2, %param_0_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3322.2"}
  %param_0_8 = f32[] parameter(8), metadata={scheduling_name="param_0_8"}
  %add.3323.2 = f32[] add(%add.3322.2, %param_0_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3323.2"}
  %param_0_7 = f32[] parameter(7), metadata={scheduling_name="param_0_7"}
  %add.3324.2 = f32[] add(%add.3323.2, %param_0_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3324.2"}
  %param_0_6 = f32[] parameter(6), metadata={scheduling_name="param_0_6"}
  %add.3325.2 = f32[] add(%add.3324.2, %param_0_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3325.2"}
  %param_0_5 = f32[] parameter(5), metadata={scheduling_name="param_0_5"}
  %add.3326.2 = f32[] add(%add.3325.2, %param_0_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3326.2"}
  %param_0_4 = f32[] parameter(4), metadata={scheduling_name="param_0_4"}
  %add.3327.2 = f32[] add(%add.3326.2, %param_0_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3327.2"}
  %param_0_3 = f32[] parameter(3), metadata={scheduling_name="param_0_3"}
  %add.3328.2 = f32[] add(%add.3327.2, %param_0_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3328.2"}
  %param_0_2 = f32[] parameter(2), metadata={scheduling_name="param_0_2"}
  %add.3329.2 = f32[] add(%add.3328.2, %param_0_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3329.2"}
  %param_0_1.1 = f32[] parameter(1), metadata={scheduling_name="param_0_1.1"}
  %add.3330.2 = f32[] add(%add.3329.2, %param_0_1.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3330.2"}
  %param_0_0.3 = f32[] parameter(0), metadata={scheduling_name="param_0_0.3"}
  %add.3331.2 = f32[] add(%add.3330.2, %param_0_0.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3331.2"}
  %sqrt.107.2 = f32[] sqrt(%add.3331.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.107.2"}
  %convert.4976.2 = bf16[] convert(%sqrt.107.2), metadata={scheduling_name="convert.4976.2"}
  %param_1_21 = f32[] parameter(44), metadata={scheduling_name="param_1_21"}
  %param_1_22 = f32[] parameter(45), metadata={scheduling_name="param_1_22"}
  %add.3284.2 = f32[] add(%param_1_21, %param_1_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3284.2"}
  %param_1_20 = f32[] parameter(43), metadata={scheduling_name="param_1_20"}
  %add.3285.2 = f32[] add(%add.3284.2, %param_1_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3285.2"}
  %param_1_19 = f32[] parameter(42), metadata={scheduling_name="param_1_19"}
  %add.3286.2 = f32[] add(%add.3285.2, %param_1_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3286.2"}
  %param_1_18 = f32[] parameter(41), metadata={scheduling_name="param_1_18"}
  %add.3287.2 = f32[] add(%add.3286.2, %param_1_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3287.2"}
  %param_1_17 = f32[] parameter(40), metadata={scheduling_name="param_1_17"}
  %add.3288.2 = f32[] add(%add.3287.2, %param_1_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3288.2"}
  %param_1_16 = f32[] parameter(39), metadata={scheduling_name="param_1_16"}
  %add.3289.2 = f32[] add(%add.3288.2, %param_1_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3289.2"}
  %param_1_15 = f32[] parameter(38), metadata={scheduling_name="param_1_15"}
  %add.3290.2 = f32[] add(%add.3289.2, %param_1_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3290.2"}
  %param_1_14 = f32[] parameter(37), metadata={scheduling_name="param_1_14"}
  %add.3291.2 = f32[] add(%add.3290.2, %param_1_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3291.2"}
  %param_1_13 = f32[] parameter(36), metadata={scheduling_name="param_1_13"}
  %add.3292.2 = f32[] add(%add.3291.2, %param_1_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3292.2"}
  %param_1_12 = f32[] parameter(35), metadata={scheduling_name="param_1_12"}
  %add.3293.2 = f32[] add(%add.3292.2, %param_1_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3293.2"}
  %param_1_11 = f32[] parameter(34), metadata={scheduling_name="param_1_11"}
  %add.3294.2 = f32[] add(%add.3293.2, %param_1_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3294.2"}
  %param_1_10 = f32[] parameter(33), metadata={scheduling_name="param_1_10"}
  %add.3295.2 = f32[] add(%add.3294.2, %param_1_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3295.2"}
  %param_1_9 = f32[] parameter(32), metadata={scheduling_name="param_1_9"}
  %add.3296.2 = f32[] add(%add.3295.2, %param_1_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3296.2"}
  %param_1_8 = f32[] parameter(31), metadata={scheduling_name="param_1_8"}
  %add.3297.2 = f32[] add(%add.3296.2, %param_1_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3297.2"}
  %param_1_7 = f32[] parameter(30), metadata={scheduling_name="param_1_7"}
  %add.3298.2 = f32[] add(%add.3297.2, %param_1_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3298.2"}
  %param_1_6 = f32[] parameter(29), metadata={scheduling_name="param_1_6"}
  %add.3300.2 = f32[] add(%add.3298.2, %param_1_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3300.2"}
  %param_1_5 = f32[] parameter(28), metadata={scheduling_name="param_1_5"}
  %add.3301.2 = f32[] add(%add.3300.2, %param_1_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3301.2"}
  %param_1_4 = f32[] parameter(27), metadata={scheduling_name="param_1_4"}
  %add.3303.2 = f32[] add(%add.3301.2, %param_1_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3303.2"}
  %param_1_3 = f32[] parameter(26), metadata={scheduling_name="param_1_3"}
  %add.3304.2 = f32[] add(%add.3303.2, %param_1_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3304.2"}
  %param_1_2 = f32[] parameter(25), metadata={scheduling_name="param_1_2"}
  %add.3306.2 = f32[] add(%add.3304.2, %param_1_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3306.2"}
  %param_1_1.1 = f32[] parameter(24), metadata={scheduling_name="param_1_1.1"}
  %add.3307.2 = f32[] add(%add.3306.2, %param_1_1.1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3307.2"}
  %param_1_0.3 = f32[] parameter(23), metadata={scheduling_name="param_1_0.3"}
  %add.3308.2 = f32[] add(%add.3307.2, %param_1_0.3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3308.2"}
  %sqrt.106.2 = f32[] sqrt(%add.3308.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.106.2"}
  %convert.4975.2 = bf16[] convert(%sqrt.106.2), metadata={scheduling_name="convert.4975.2"}
  %param_2_21 = f32[] parameter(67), metadata={scheduling_name="param_2_21"}
  %param_2_22 = f32[] parameter(68), metadata={scheduling_name="param_2_22"}
  %add.3261.2 = f32[] add(%param_2_21, %param_2_22), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3261.2"}
  %param_2_20 = f32[] parameter(66), metadata={scheduling_name="param_2_20"}
  %add.3262.2 = f32[] add(%add.3261.2, %param_2_20), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3262.2"}
  %param_2_19 = f32[] parameter(65), metadata={scheduling_name="param_2_19"}
  %add.3263.2 = f32[] add(%add.3262.2, %param_2_19), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3263.2"}
  %param_2_18 = f32[] parameter(64), metadata={scheduling_name="param_2_18"}
  %add.3264.2 = f32[] add(%add.3263.2, %param_2_18), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3264.2"}
  %param_2_17 = f32[] parameter(63), metadata={scheduling_name="param_2_17"}
  %add.3265.2 = f32[] add(%add.3264.2, %param_2_17), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3265.2"}
  %param_2_16 = f32[] parameter(62), metadata={scheduling_name="param_2_16"}
  %add.3266.2 = f32[] add(%add.3265.2, %param_2_16), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3266.2"}
  %param_2_15 = f32[] parameter(61), metadata={scheduling_name="param_2_15"}
  %add.3267.2 = f32[] add(%add.3266.2, %param_2_15), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3267.2"}
  %param_2_14 = f32[] parameter(60), metadata={scheduling_name="param_2_14"}
  %add.3268.2 = f32[] add(%add.3267.2, %param_2_14), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3268.2"}
  %param_2_13 = f32[] parameter(59), metadata={scheduling_name="param_2_13"}
  %add.3269.2 = f32[] add(%add.3268.2, %param_2_13), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3269.2"}
  %param_2_12 = f32[] parameter(58), metadata={scheduling_name="param_2_12"}
  %add.3270.2 = f32[] add(%add.3269.2, %param_2_12), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3270.2"}
  %param_2_11 = f32[] parameter(57), metadata={scheduling_name="param_2_11"}
  %add.3271.2 = f32[] add(%add.3270.2, %param_2_11), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3271.2"}
  %param_2_10 = f32[] parameter(56), metadata={scheduling_name="param_2_10"}
  %add.3272.2 = f32[] add(%add.3271.2, %param_2_10), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3272.2"}
  %param_2_9 = f32[] parameter(55), metadata={scheduling_name="param_2_9"}
  %add.3273.2 = f32[] add(%add.3272.2, %param_2_9), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3273.2"}
  %param_2_8 = f32[] parameter(54), metadata={scheduling_name="param_2_8"}
  %add.3274.2 = f32[] add(%add.3273.2, %param_2_8), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3274.2"}
  %param_2_7 = f32[] parameter(53), metadata={scheduling_name="param_2_7"}
  %add.3275.2 = f32[] add(%add.3274.2, %param_2_7), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3275.2"}
  %param_2_6 = f32[] parameter(52), metadata={scheduling_name="param_2_6"}
  %add.3276.2 = f32[] add(%add.3275.2, %param_2_6), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3276.2"}
  %param_2_5 = f32[] parameter(51), metadata={scheduling_name="param_2_5"}
  %add.3277.2 = f32[] add(%add.3276.2, %param_2_5), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3277.2"}
  %param_2_4 = f32[] parameter(50), metadata={scheduling_name="param_2_4"}
  %add.3278.2 = f32[] add(%add.3277.2, %param_2_4), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3278.2"}
  %param_2_3 = f32[] parameter(49), metadata={scheduling_name="param_2_3"}
  %add.3279.2 = f32[] add(%add.3278.2, %param_2_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3279.2"}
  %param_2_2 = f32[] parameter(48), metadata={scheduling_name="param_2_2"}
  %add.3280.2 = f32[] add(%add.3279.2, %param_2_2), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3280.2"}
  %param_2_1 = f32[] parameter(47), metadata={scheduling_name="param_2_1"}
  %add.3281.2 = f32[] add(%add.3280.2, %param_2_1), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3281.2"}
  %param_2_0 = f32[] parameter(46), metadata={scheduling_name="param_2_0"}
  %add.3282.2 = f32[] add(%add.3281.2, %param_2_0), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.3282.2"}
  %sqrt.105.2 = f32[] sqrt(%add.3282.2), metadata={op_name="jit(train_step)/jit(main)/sqrt" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="sqrt.105.2"}
  %convert.4974.2 = bf16[] convert(%sqrt.105.2), metadata={scheduling_name="convert.4974.2"}
  ROOT %tuple.651 = (bf16[], bf16[], bf16[]) tuple(%convert.4976.2, %convert.4975.2, %convert.4974.2), metadata={scheduling_name="tuple.651"}
}

%fused_slice.4 () -> (bf16[12288], bf16[12288]) {
  %constant_2996_14 = bf16[] constant(0)
  %broadcast.5819.2 = bf16[2,1,6144]{2,1,0} broadcast(%constant_2996_14), dimensions={}, metadata={scheduling_name="broadcast.5819.2"}
  %reshape.8606 = bf16[12288]{0} reshape(%broadcast.5819.2), metadata={scheduling_name="reshape.8606"}
  %broadcast.5815.2 = bf16[2,1,768,8]{3,2,1,0} broadcast(%constant_2996_14), dimensions={}, metadata={scheduling_name="broadcast.5815.2"}
  %reshape.8607 = bf16[12288]{0} reshape(%broadcast.5815.2), metadata={scheduling_name="reshape.8607"}
  %concatenate.725 = bf16[24576]{0} concatenate(%reshape.8606, %reshape.8607), dimensions={0}, metadata={scheduling_name="concatenate.725"}
  %slice.2442 = bf16[12288]{0} slice(%concatenate.725), slice={[0:12288]}, metadata={scheduling_name="slice.2442"}
  %slice.2443 = bf16[12288]{0} slice(%concatenate.725), slice={[12288:24576]}, metadata={scheduling_name="slice.2443"}
  ROOT %tuple.652 = (bf16[12288]{0}, bf16[12288]{0}) tuple(%slice.2442, %slice.2443), metadata={scheduling_name="tuple.652"}
}

%fused_slice.5 (param_1_0.4: s32[32], param_1_1.2: u32[]) -> (s32[9], s32[65536]) {
  %constant_2984_8 = s32[] constant(0)
  %broadcast.5789.2 = s32[9]{0} broadcast(%constant_2984_8), dimensions={}, metadata={scheduling_name="broadcast.5789.2"}
  %iota.396.2 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.396.2"}
  %param_1_0.4 = s32[32]{0} parameter(0), metadata={scheduling_name="param_1_0.4"}
  %param_1_1.2 = u32[] parameter(1), metadata={scheduling_name="param_1_1.2"}
  %dynamic-slice.1566.6 = s32[1]{0} dynamic-slice(%param_1_0.4, %param_1_1.2), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1566.6"}
  %constant_5166_4 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2744.6 = s32[1]{0} multiply(%dynamic-slice.1566.6, %constant_5166_4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2744.6"}
  %bitcast.26332.7 = s32[] bitcast(%multiply.2744.6), metadata={scheduling_name="bitcast.26332.7"}
  %broadcast.5790.4 = s32[1,1,4,8192,2]{4,3,2,1,0} broadcast(%bitcast.26332.7), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5790.4"}
  %add.3106.2 = s32[1,1,4,8192,2]{4,3,2,1,0} add(%iota.396.2, %broadcast.5790.4), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3106.2"}
  %reshape.8608 = s32[65536]{0} reshape(%add.3106.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reshape.8608"}
  %concatenate.726 = s32[65545]{0} concatenate(%broadcast.5789.2, %reshape.8608), dimensions={0}, metadata={scheduling_name="concatenate.726"}
  %slice.2444 = s32[9]{0} slice(%concatenate.726), slice={[0:9]}, metadata={scheduling_name="slice.2444"}
  %slice.2445 = s32[65536]{0} slice(%concatenate.726), slice={[9:65545]}, metadata={scheduling_name="slice.2445"}
  ROOT %tuple.653 = (s32[9]{0}, s32[65536]{0}) tuple(%slice.2444, %slice.2445), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="tuple.653"}
}

%fused_slice.6 (param_1_0.5: s32[1], param_1_1.3: s32[32], param_1_2.1: u32[]) -> (u32[72], u32[65536]) {
  %constant_3027_2 = u32[] constant(0)
  %broadcast.5783.2 = u32[9,2,4]{2,1,0} broadcast(%constant_3027_2), dimensions={}, metadata={scheduling_name="broadcast.5783.2"}
  %reshape.8609 = u32[72]{0} reshape(%broadcast.5783.2), metadata={scheduling_name="reshape.8609"}
  %iota.399.8 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.399.8"}
  %iota.400.6 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.400.6"}
  %constant_3057_2 = u32[] constant(2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5795.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_3057_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5795.6"}
  %multiply.2748.6 = u32[1,4,8192,2]{3,2,1,0} multiply(%iota.400.6, %broadcast.5795.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2748.6"}
  %add.3107.8 = u32[1,4,8192,2]{3,2,1,0} add(%iota.399.8, %multiply.2748.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3107.8"}
  %iota.401.6 = u32[1,4,8192,2]{3,2,1,0} iota(), iota_dimension=1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.401.6"}
  %param_1_1.3 = s32[32]{0} parameter(1), metadata={scheduling_name="param_1_1.3"}
  %param_1_2.1 = u32[] parameter(2), metadata={scheduling_name="param_1_2.1"}
  %dynamic-slice.1566.7 = s32[1]{0} dynamic-slice(%param_1_1.3, %param_1_2.1), dynamic_slice_sizes={1}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="dynamic-slice.1566.7"}
  %constant_5166_5 = s32[1]{0} constant({4}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2744.7 = s32[1]{0} multiply(%dynamic-slice.1566.7, %constant_5166_5), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2744.7"}
  %bitcast.26332.8 = s32[] bitcast(%multiply.2744.7), metadata={scheduling_name="bitcast.26332.8"}
  %convert.4326.4 = u32[] convert(%bitcast.26332.8), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4326.4"}
  %broadcast.5796.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%convert.4326.4), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5796.6"}
  %add.3108.6 = u32[1,4,8192,2]{3,2,1,0} add(%iota.401.6, %broadcast.5796.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3108.6"}
  %constant_3063_2 = u32[] constant(16384), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %broadcast.5797.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_3063_2), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5797.6"}
  %multiply.2749.6 = u32[1,4,8192,2]{3,2,1,0} multiply(%add.3108.6, %broadcast.5797.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2749.6"}
  %add.3109.6 = u32[1,4,8192,2]{3,2,1,0} add(%add.3107.8, %multiply.2749.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3109.6"}
  %param_1_0.5 = s32[1]{0} parameter(0), metadata={scheduling_name="param_1_0.5"}
  %convert.4327.4 = u32[1]{0} convert(%param_1_0.5), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="convert.4327.4"}
  %constant_5333_2 = u32[1]{0} constant({1048576}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %multiply.2750.4 = u32[1]{0} multiply(%convert.4327.4, %constant_5333_2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="multiply.2750.4"}
  %bitcast.26437.6 = u32[] bitcast(%multiply.2750.4), metadata={scheduling_name="bitcast.26437.6"}
  %broadcast.5798.6 = u32[1,4,8192,2]{3,2,1,0} broadcast(%bitcast.26437.6), dimensions={}, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="broadcast.5798.6"}
  %add.3110.4 = u32[1,4,8192,2]{3,2,1,0} add(%add.3109.6, %broadcast.5798.6), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/reshape" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3110.4"}
  %constant_3070_2 = u32[] constant(1)
  %broadcast.5799.2 = u32[1,4,8192,2]{3,2,1,0} broadcast(%constant_3070_2), dimensions={}, metadata={scheduling_name="broadcast.5799.2"}
  %add.3111.2 = u32[1,4,8192,2]{3,2,1,0} add(%add.3110.4, %broadcast.5799.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="add.3111.2"}
  %reshape.8610 = u32[65536]{0} reshape(%add.3111.2), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="reshape.8610"}
  %concatenate.727 = u32[65608]{0} concatenate(%reshape.8609, %reshape.8610), dimensions={0}, metadata={scheduling_name="concatenate.727"}
  %slice.2446 = u32[72]{0} slice(%concatenate.727), slice={[0:72]}, metadata={scheduling_name="slice.2446"}
  %slice.2447 = u32[65536]{0} slice(%concatenate.727), slice={[72:65608]}, metadata={scheduling_name="slice.2447"}
  ROOT %tuple.654 = (u32[72]{0}, u32[65536]{0}) tuple(%slice.2446, %slice.2447), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="tuple.654"}
}

%async_computation.13 (param_0.6095: bf16[1,1,1,2,4,8192,6144]) -> bf16[1,1,1,2,4,8192,6144] {
  %param_0.6095 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6095"}
  ROOT %all-to-all.12.1 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6095), channel_id=2, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all.12.1"}
}

%region_24.1883.clone (Arg_0.3: s32[], Arg_1.3: s32[]) -> s32[] {
  %Arg_1.3 = s32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.3"}
  %Arg_0.3 = s32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.3"}
  ROOT %add.2838.0 = s32[] add(%Arg_0.3, %Arg_1.3), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="add.2838.0"}
}

%region_25.1918.clone (Arg_0.4: bf16[], Arg_1.4: bf16[]) -> bf16[] {
  %Arg_1.4 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" scheduling_name="Arg_1.4"}
  %Arg_0.4 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" scheduling_name="Arg_0.4"}
  ROOT %add.2839.0 = bf16[] add(%Arg_0.4, %Arg_1.4), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="add.2839.0"}
}

%add.1.clone (x.3: bf16[], y.3: bf16[]) -> bf16[] {
  %y.3 = bf16[] parameter(1), metadata={scheduling_name="y.3"}
  %x.3 = bf16[] parameter(0), metadata={scheduling_name="x.3"}
  ROOT %add.2841.0 = bf16[] add(%x.3, %y.3), metadata={scheduling_name="add.2841.0"}
}

%async_computation.14 (param_0.6096: bf16[1,1,1,2,4,8192,6144]) -> bf16[1,1,1,2,4,8192,6144] {
  %param_0.6096 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} parameter(0), metadata={scheduling_name="param_0.6096"}
  ROOT %all-to-all.14.1 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} all-to-all(%param_0.6096), channel_id=146, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, dimensions={3}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all.14.1"}
}

%async_computation.15 (param_0.6097: bf16[1,2,1,1,4,8192,6144]) -> bf16[1,2,1,1,4,8192,6144] {
  %param_0.6097 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6097"}
  ROOT %all-to-all.15.1 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} all-to-all(%param_0.6097), channel_id=410, replica_groups={{0,1},{2,3},{4,5},{6,7},{8,9},{10,11},{12,13},{14,15},{16,17},{18,19},{20,21},{22,23},{24,25},{26,27},{28,29},{30,31}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all.15.1"}
}

%add.29.clone (x.59: bf16[], y.59: bf16[]) -> bf16[] {
  %y.59 = bf16[] parameter(1), metadata={scheduling_name="y.59"}
  %x.59 = bf16[] parameter(0), metadata={scheduling_name="x.59"}
  ROOT %add.2899.0 = bf16[] add(%x.59, %y.59), metadata={scheduling_name="add.2899.0"}
}

%region_23.1876.clone (Arg_0.92: f32[], Arg_1.92: f32[]) -> f32[] {
  %Arg_1.92 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.92"}
  %Arg_0.92 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.92"}
  ROOT %add.2924.0 = f32[] add(%Arg_0.92, %Arg_1.92), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="add.2924.0"}
}

%add.4.clone (x.9: bf16[], y.9: bf16[]) -> bf16[] {
  %y.9 = bf16[] parameter(1), metadata={scheduling_name="y.9"}
  %x.9 = bf16[] parameter(0), metadata={scheduling_name="x.9"}
  ROOT %add.2845.0 = bf16[] add(%x.9, %y.9), metadata={scheduling_name="add.2845.0"}
}

%add.5.clone (x.11: bf16[], y.11: bf16[]) -> bf16[] {
  %y.11 = bf16[] parameter(1), metadata={scheduling_name="y.11"}
  %x.11 = bf16[] parameter(0), metadata={scheduling_name="x.11"}
  ROOT %add.2846.0 = bf16[] add(%x.11, %y.11), metadata={scheduling_name="add.2846.0"}
}

%add.6.clone (x.13: bf16[], y.13: bf16[]) -> bf16[] {
  %y.13 = bf16[] parameter(1), metadata={scheduling_name="y.13"}
  %x.13 = bf16[] parameter(0), metadata={scheduling_name="x.13"}
  ROOT %add.2848.0 = bf16[] add(%x.13, %y.13), metadata={scheduling_name="add.2848.0"}
}

%add.12.clone (x.25: bf16[], y.25: bf16[]) -> bf16[] {
  %y.25 = bf16[] parameter(1), metadata={scheduling_name="y.25"}
  %x.25 = bf16[] parameter(0), metadata={scheduling_name="x.25"}
  ROOT %add.2856.0 = bf16[] add(%x.25, %y.25), metadata={scheduling_name="add.2856.0"}
}

%add.17.clone (x.35: bf16[], y.35: bf16[]) -> bf16[] {
  %y.35 = bf16[] parameter(1), metadata={scheduling_name="y.35"}
  %x.35 = bf16[] parameter(0), metadata={scheduling_name="x.35"}
  ROOT %add.2862.0 = bf16[] add(%x.35, %y.35), metadata={scheduling_name="add.2862.0"}
}

%add.18.clone (x.37: bf16[], y.37: bf16[]) -> bf16[] {
  %y.37 = bf16[] parameter(1), metadata={scheduling_name="y.37"}
  %x.37 = bf16[] parameter(0), metadata={scheduling_name="x.37"}
  ROOT %add.2863.0 = bf16[] add(%x.37, %y.37), metadata={scheduling_name="add.2863.0"}
}

%add.19.clone (x.39: bf16[], y.39: bf16[]) -> bf16[] {
  %y.39 = bf16[] parameter(1), metadata={scheduling_name="y.39"}
  %x.39 = bf16[] parameter(0), metadata={scheduling_name="x.39"}
  ROOT %add.2864.0 = bf16[] add(%x.39, %y.39), metadata={scheduling_name="add.2864.0"}
}

%async_computation.16 (param_0.6098: bf16[1,2,1,1,4,8192,6144]) -> bf16[1,2,1,1,4,8192,6144] {
  %param_0.6098 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} parameter(0), metadata={scheduling_name="param_0.6098"}
  ROOT %all-to-all.44.1 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} all-to-all(%param_0.6098), channel_id=128, replica_groups={{0,1},{2,3},{4,5},{6,7},{8,9},{10,11},{12,13},{14,15},{16,17},{18,19},{20,21},{22,23},{24,25},{26,27},{28,29},{30,31}}, dimensions={1}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all.44.1"}
}

%add.28.clone (x.57: bf16[], y.57: bf16[]) -> bf16[] {
  %y.57 = bf16[] parameter(1), metadata={scheduling_name="y.57"}
  %x.57 = bf16[] parameter(0), metadata={scheduling_name="x.57"}
  ROOT %add.2898.0 = bf16[] add(%x.57, %y.57), metadata={scheduling_name="add.2898.0"}
}

%async_computation.17 (param_0.6099: bf16[6144,32768], param_1.6484: bf16[6144,32768]) -> (bf16[768,32768], bf16[768,32768]) {
  %param_1.6484 = bf16[6144,32768]{1,0} parameter(1), metadata={scheduling_name="param_1.6484"}
  %param_0.6099 = bf16[6144,32768]{1,0} parameter(0), metadata={scheduling_name="param_0.6099"}
  ROOT %reduce-scatter.16 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}) reduce-scatter(%param_0.6099, %param_1.6484), channel_id=625, replica_groups=[4,8]<=[32], use_global_device_ids=true, dimensions={0}, to_apply=%add.28.clone, metadata={scheduling_name="reduce-scatter.16"}
}

%region_120.4324.clone (Arg_0.53: f32[], Arg_1.53: f32[]) -> f32[] {
  %Arg_1.53 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.53"}
  %Arg_0.53 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.53"}
  ROOT %add.2900.0 = f32[] add(%Arg_0.53, %Arg_1.53), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2900.0"}
}

%add.27.clone (x.55: bf16[], y.55: bf16[]) -> bf16[] {
  %y.55 = bf16[] parameter(1), metadata={scheduling_name="y.55"}
  %x.55 = bf16[] parameter(0), metadata={scheduling_name="x.55"}
  ROOT %add.2875.0 = bf16[] add(%x.55, %y.55), metadata={scheduling_name="add.2875.0"}
}

%region_119.4315.clone (Arg_0.50: f32[], Arg_1.50: f32[]) -> f32[] {
  %Arg_1.50 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.50"}
  %Arg_0.50 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.50"}
  ROOT %add.2897.0 = f32[] add(%Arg_0.50, %Arg_1.50), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2897.0"}
}

%add.23.clone (x.47: bf16[], y.47: bf16[]) -> bf16[] {
  %y.47 = bf16[] parameter(1), metadata={scheduling_name="y.47"}
  %x.47 = bf16[] parameter(0), metadata={scheduling_name="x.47"}
  ROOT %add.2871.0 = bf16[] add(%x.47, %y.47), metadata={scheduling_name="add.2871.0"}
}

%add.10.clone (x.21: bf16[], y.21: bf16[]) -> bf16[] {
  %y.21 = bf16[] parameter(1), metadata={scheduling_name="y.21"}
  %x.21 = bf16[] parameter(0), metadata={scheduling_name="x.21"}
  ROOT %add.2854.0 = bf16[] add(%x.21, %y.21), metadata={scheduling_name="add.2854.0"}
}

%region_59.2325.clone (Arg_0.12: bf16[], Arg_1.12: bf16[]) -> bf16[] {
  %Arg_1.12 = bf16[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_1.12"}
  %Arg_0.12 = bf16[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" scheduling_name="Arg_0.12"}
  ROOT %add.2866.0 = bf16[] add(%Arg_0.12, %Arg_1.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while/body/checkpoint/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/pre_self_attention_layer_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="add.2866.0"}
}

%region_115.4279.clone (Arg_0.42: f32[], Arg_1.42: f32[]) -> f32[] {
  %Arg_1.42 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.42"}
  %Arg_0.42 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.42"}
  ROOT %add.2893.0 = f32[] add(%Arg_0.42, %Arg_1.42), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="add.2893.0"}
}

%region_189.5599.clone (Arg_0.130: f32[], Arg_1.130: f32[]) -> f32[] {
  %Arg_1.130 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.130"}
  %Arg_0.130 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.130"}
  ROOT %add.2946.0 = f32[] add(%Arg_0.130, %Arg_1.130), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2946.0"}
}

%region_188.5590.clone (Arg_0.128: f32[], Arg_1.128: f32[]) -> f32[] {
  %Arg_1.128 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.128"}
  %Arg_0.128 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.128"}
  ROOT %add.2945.0 = f32[] add(%Arg_0.128, %Arg_1.128), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2945.0"}
}

%region_184.5554.clone (Arg_0.121: f32[], Arg_1.121: f32[]) -> f32[] {
  %Arg_1.121 = f32[] parameter(1), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_1.121"}
  %Arg_0.121 = f32[] parameter(0), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" scheduling_name="Arg_0.121"}
  ROOT %add.2941.0 = f32[] add(%Arg_0.121, %Arg_1.121), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="add.2941.0"}
}

%copy_horizontally_fused_computation (param_0_0.4: f32[], param_1.6485: f32[], param_2.4762: s32[]) -> (f32[], f32[], f32[]) {
  %param_0_0.4 = f32[] parameter(0), metadata={scheduling_name="param_0_0.4"}
  %copy.1039 = f32[] copy(%param_0_0.4), metadata={scheduling_name="copy.1039"}
  %copy.1040 = f32[] copy(%param_0_0.4), metadata={scheduling_name="copy.1040"}
  %param_1.6485 = f32[] parameter(1), metadata={scheduling_name="param_1.6485"}
  %param_2.4762 = s32[] parameter(2), metadata={scheduling_name="param_2.4762"}
  %convert.4331.8 = f32[] convert(%param_2.4762), metadata={op_name="jit(train_step)/jit(main)/convert_element_type" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="convert.4331.8"}
  %constant_3124_3 = f32[] constant(1e-08)
  %add.3113.8 = f32[] add(%convert.4331.8, %constant_3124_3), metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="add.3113.8"}
  %divide.547.2 = f32[] divide(%param_1.6485, %add.3113.8), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="divide.547.2"}
  ROOT %tuple.683 = (f32[], f32[], f32[]) tuple(%copy.1039, %copy.1040, %divide.547.2), metadata={scheduling_name="tuple.683"}
}

%copy_horizontally_fused_computation.1 (param_0_0.5: bf16[2,1,6144]) -> (bf16[2,1,6144], bf16[2,1,6144]) {
  %param_0_0.5 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0_0.5"}
  %copy.1043 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.5), metadata={scheduling_name="copy.1043"}
  %copy.1044 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.5), metadata={scheduling_name="copy.1044"}
  ROOT %tuple.684 = (bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}) tuple(%copy.1043, %copy.1044), metadata={scheduling_name="tuple.684"}
}

%copy_horizontally_fused_computation.2 (param_0_0.6: bf16[2,1,6144], param_1_0.8: bf16[2,1,768,8]) -> (bf16[12288], bf16[12288]) {
  %param_0_0.6 = bf16[2,1,6144]{2,1,0} parameter(0), metadata={scheduling_name="param_0_0.6"}
  %copy.1047 = bf16[2,1,6144]{2,1,0} copy(%param_0_0.6), metadata={scheduling_name="copy.1047"}
  %reshape.8611 = bf16[12288]{0} reshape(%copy.1047), metadata={scheduling_name="reshape.8611"}
  %param_1_0.8 = bf16[2,1,768,8]{3,2,1,0} parameter(1), metadata={scheduling_name="param_1_0.8"}
  %copy.1048 = bf16[2,1,768,8]{3,2,1,0} copy(%param_1_0.8), metadata={scheduling_name="copy.1048"}
  %reshape.8612 = bf16[12288]{0} reshape(%copy.1048), metadata={scheduling_name="reshape.8612"}
  %concatenate.738 = bf16[24576]{0} concatenate(%reshape.8611, %reshape.8612), dimensions={0}, metadata={scheduling_name="concatenate.738"}
  %slice.2549 = bf16[12288]{0} slice(%concatenate.738), slice={[0:12288]}, metadata={scheduling_name="slice.2549"}
  %slice.2550 = bf16[12288]{0} slice(%concatenate.738), slice={[12288:24576]}, metadata={scheduling_name="slice.2550"}
  ROOT %tuple.685 = (bf16[12288]{0}, bf16[12288]{0}) tuple(%slice.2549, %slice.2550), metadata={scheduling_name="tuple.685"}
}

%wrapped_transpose_computation (param_0.6106: bf16[32768,768]) -> bf16[768,32768] {
  %param_0.6106 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6106"}
  ROOT %transpose.765.1 = bf16[768,32768]{1,0} transpose(%param_0.6106), dimensions={1,0}, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.765.1"}
}

%wrapped_iota_computation () -> s32[1,1,4,8192,2] {
  ROOT %iota.397.1 = s32[1,1,4,8192,2]{4,3,2,1,0} iota(), iota_dimension=3, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="iota.397.1"}
}

%wrapped_iota_computation.1 () -> s32[1,1,1,1,8] {
  ROOT %iota.402.1 = s32[1,1,1,1,8]{4,3,2,1,0} iota(), iota_dimension=4, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="iota.402.1"}
}

%wrapped_iota_computation.2 () -> s32[1,1,1,1,2049] {
  ROOT %iota.403.1 = s32[1,1,1,1,2049]{4,3,2,1,0} iota(), iota_dimension=4, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="iota.403.1"}
}

%wrapped_concatenate_computation (param_0.6115: f32[1], param_1.6486: f32[1], param_2.4763: f32[1], param_3.3986: f32[1]) -> f32[4] {
  %param_0.6115 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6115"}
  %param_1.6486 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6486"}
  %param_2.4763 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4763"}
  %param_3.3986 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3986"}
  ROOT %concatenate.739 = f32[4]{0} concatenate(%param_0.6115, %param_1.6486, %param_2.4763, %param_3.3986), dimensions={0}, metadata={scheduling_name="concatenate.739"}
}

%wrapped_slice_computation.4 (param_0.6116: f32[4]) -> f32[1] {
  %param_0.6116 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6116"}
  ROOT %slice.2551 = f32[1]{0} slice(%param_0.6116), slice={[0:1]}, metadata={scheduling_name="slice.2551"}
}

%wrapped_concatenate_computation.1 (param_0.6117: bf16[1572864], param_1.6487: bf16[9437184]) -> bf16[11010048] {
  %param_0.6117 = bf16[1572864]{0} parameter(0), metadata={scheduling_name="param_0.6117"}
  %param_1.6487 = bf16[9437184]{0} parameter(1), metadata={scheduling_name="param_1.6487"}
  ROOT %concatenate.740 = bf16[11010048]{0} concatenate(%param_0.6117, %param_1.6487), dimensions={0}, metadata={scheduling_name="concatenate.740"}
}

%wrapped_slice_computation.5 (param_0.6118: bf16[11010048]) -> bf16[1572864] {
  %param_0.6118 = bf16[11010048]{0} parameter(0), metadata={scheduling_name="param_0.6118"}
  ROOT %slice.2552 = bf16[1572864]{0} slice(%param_0.6118), slice={[0:1572864]}, metadata={scheduling_name="slice.2552"}
}

%wrapped_slice_computation.6 (param_0.6119: bf16[11010048]) -> bf16[9437184] {
  %param_0.6119 = bf16[11010048]{0} parameter(0), metadata={scheduling_name="param_0.6119"}
  ROOT %slice.2553 = bf16[9437184]{0} slice(%param_0.6119), slice={[1572864:11010048]}, metadata={scheduling_name="slice.2553"}
}

%wrapped_concatenate_computation.2 (param_0.6120: bf16[9437184], param_1.6488: bf16[1572864], param_2.4764: bf16[12288], param_3.3987: bf16[1572864]) -> bf16[12595200] {
  %param_0.6120 = bf16[9437184]{0} parameter(0), metadata={scheduling_name="param_0.6120"}
  %param_1.6488 = bf16[1572864]{0} parameter(1), metadata={scheduling_name="param_1.6488"}
  %param_2.4764 = bf16[12288]{0} parameter(2), metadata={scheduling_name="param_2.4764"}
  %param_3.3987 = bf16[1572864]{0} parameter(3), metadata={scheduling_name="param_3.3987"}
  ROOT %concatenate.741 = bf16[12595200]{0} concatenate(%param_0.6120, %param_1.6488, %param_2.4764, %param_3.3987), dimensions={0}, metadata={scheduling_name="concatenate.741"}
}

%wrapped_slice_computation.7 (param_0.6121: bf16[12595200]) -> bf16[9437184] {
  %param_0.6121 = bf16[12595200]{0} parameter(0), metadata={scheduling_name="param_0.6121"}
  ROOT %slice.2554 = bf16[9437184]{0} slice(%param_0.6121), slice={[0:9437184]}, metadata={scheduling_name="slice.2554"}
}

%wrapped_slice_computation.8 (param_0.6122: bf16[12595200]) -> bf16[1572864] {
  %param_0.6122 = bf16[12595200]{0} parameter(0), metadata={scheduling_name="param_0.6122"}
  ROOT %slice.2555 = bf16[1572864]{0} slice(%param_0.6122), slice={[9437184:11010048]}, metadata={scheduling_name="slice.2555"}
}

%wrapped_slice_computation.9 (param_0.6123: bf16[12595200]) -> bf16[12288] {
  %param_0.6123 = bf16[12595200]{0} parameter(0), metadata={scheduling_name="param_0.6123"}
  ROOT %slice.2556 = bf16[12288]{0} slice(%param_0.6123), slice={[11010048:11022336]}, metadata={scheduling_name="slice.2556"}
}

%wrapped_slice_computation.10 (param_0.6124: bf16[12595200]) -> bf16[1572864] {
  %param_0.6124 = bf16[12595200]{0} parameter(0), metadata={scheduling_name="param_0.6124"}
  ROOT %slice.2557 = bf16[1572864]{0} slice(%param_0.6124), slice={[11022336:12595200]}, metadata={scheduling_name="slice.2557"}
}

%wrapped_concatenate_computation.3 (param_0.6125: bf16[9437184], param_1.6489: bf16[1572864], param_2.4765: bf16[12288]) -> bf16[11022336] {
  %param_0.6125 = bf16[9437184]{0} parameter(0), metadata={scheduling_name="param_0.6125"}
  %param_1.6489 = bf16[1572864]{0} parameter(1), metadata={scheduling_name="param_1.6489"}
  %param_2.4765 = bf16[12288]{0} parameter(2), metadata={scheduling_name="param_2.4765"}
  ROOT %concatenate.742 = bf16[11022336]{0} concatenate(%param_0.6125, %param_1.6489, %param_2.4765), dimensions={0}, metadata={scheduling_name="concatenate.742"}
}

%wrapped_slice_computation.11 (param_0.6126: bf16[11022336]) -> bf16[9437184] {
  %param_0.6126 = bf16[11022336]{0} parameter(0), metadata={scheduling_name="param_0.6126"}
  ROOT %slice.2558 = bf16[9437184]{0} slice(%param_0.6126), slice={[0:9437184]}, metadata={scheduling_name="slice.2558"}
}

%wrapped_slice_computation.12 (param_0.6127: bf16[11022336]) -> bf16[1572864] {
  %param_0.6127 = bf16[11022336]{0} parameter(0), metadata={scheduling_name="param_0.6127"}
  ROOT %slice.2559 = bf16[1572864]{0} slice(%param_0.6127), slice={[9437184:11010048]}, metadata={scheduling_name="slice.2559"}
}

%wrapped_slice_computation.13 (param_0.6128: bf16[11022336]) -> bf16[12288] {
  %param_0.6128 = bf16[11022336]{0} parameter(0), metadata={scheduling_name="param_0.6128"}
  ROOT %slice.2560 = bf16[12288]{0} slice(%param_0.6128), slice={[11010048:11022336]}, metadata={scheduling_name="slice.2560"}
}

%wrapped_concatenate_computation.4 (param_0.6129: f32[1], param_1.6490: f32[1], param_2.4766: f32[1], param_3.3988: f32[1], param_4.2945: f32[1], param_5.2730: f32[1], param_6.2548: f32[1], param_7.2396: f32[1], param_8.2264: f32[1], param_9.2288: f32[1], param_10.1943: f32[1], param_11.1718: f32[1], param_12.1366: f32[1], param_13.1025: f32[1], param_14.818: f32[1], param_15.601: f32[1], param_16.267: f32[1], param_17.112: f32[1], param_18.87: f32[1], param_19.70: f32[1], param_20.48: f32[1], param_21.25: f32[1], param_22.24: f32[1], param_23.10: f32[1], param_24.4: f32[1], param_25: f32[1], param_26: f32[1], param_27: f32[1], param_28: f32[1], param_29: f32[1], param_30: f32[1], param_31: f32[1]) -> f32[32] {
  %param_0.6129 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6129"}
  %param_1.6490 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6490"}
  %param_2.4766 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4766"}
  %param_3.3988 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3988"}
  %param_4.2945 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2945"}
  %param_5.2730 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2730"}
  %param_6.2548 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2548"}
  %param_7.2396 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2396"}
  %param_8.2264 = f32[1]{0} parameter(8), metadata={scheduling_name="param_8.2264"}
  %param_9.2288 = f32[1]{0} parameter(9), metadata={scheduling_name="param_9.2288"}
  %param_10.1943 = f32[1]{0} parameter(10), metadata={scheduling_name="param_10.1943"}
  %param_11.1718 = f32[1]{0} parameter(11), metadata={scheduling_name="param_11.1718"}
  %param_12.1366 = f32[1]{0} parameter(12), metadata={scheduling_name="param_12.1366"}
  %param_13.1025 = f32[1]{0} parameter(13), metadata={scheduling_name="param_13.1025"}
  %param_14.818 = f32[1]{0} parameter(14), metadata={scheduling_name="param_14.818"}
  %param_15.601 = f32[1]{0} parameter(15), metadata={scheduling_name="param_15.601"}
  %param_16.267 = f32[1]{0} parameter(16), metadata={scheduling_name="param_16.267"}
  %param_17.112 = f32[1]{0} parameter(17), metadata={scheduling_name="param_17.112"}
  %param_18.87 = f32[1]{0} parameter(18), metadata={scheduling_name="param_18.87"}
  %param_19.70 = f32[1]{0} parameter(19), metadata={scheduling_name="param_19.70"}
  %param_20.48 = f32[1]{0} parameter(20), metadata={scheduling_name="param_20.48"}
  %param_21.25 = f32[1]{0} parameter(21), metadata={scheduling_name="param_21.25"}
  %param_22.24 = f32[1]{0} parameter(22), metadata={scheduling_name="param_22.24"}
  %param_23.10 = f32[1]{0} parameter(23), metadata={scheduling_name="param_23.10"}
  %param_24.4 = f32[1]{0} parameter(24), metadata={scheduling_name="param_24.4"}
  %param_25 = f32[1]{0} parameter(25), metadata={scheduling_name="param_25"}
  %param_26 = f32[1]{0} parameter(26), metadata={scheduling_name="param_26"}
  %param_27 = f32[1]{0} parameter(27), metadata={scheduling_name="param_27"}
  %param_28 = f32[1]{0} parameter(28), metadata={scheduling_name="param_28"}
  %param_29 = f32[1]{0} parameter(29), metadata={scheduling_name="param_29"}
  %param_30 = f32[1]{0} parameter(30), metadata={scheduling_name="param_30"}
  %param_31 = f32[1]{0} parameter(31), metadata={scheduling_name="param_31"}
  ROOT %concatenate.743 = f32[32]{0} concatenate(%param_0.6129, %param_1.6490, %param_2.4766, %param_3.3988, %param_4.2945, /*index=5*/%param_5.2730, %param_6.2548, %param_7.2396, %param_8.2264, %param_9.2288, /*index=10*/%param_10.1943, %param_11.1718, %param_12.1366, %param_13.1025, %param_14.818, /*index=15*/%param_15.601, %param_16.267, %param_17.112, %param_18.87, %param_19.70, /*index=20*/%param_20.48, %param_21.25, %param_22.24, %param_23.10, %param_24.4, /*index=25*/%param_25, %param_26, %param_27, %param_28, %param_29, /*index=30*/%param_30, %param_31), dimensions={0}, metadata={scheduling_name="concatenate.743"}
}

%wrapped_slice_computation.14 (param_0.6130: f32[32]) -> f32[1] {
  %param_0.6130 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6130"}
  ROOT %slice.2561 = f32[1]{0} slice(%param_0.6130), slice={[0:1]}, metadata={scheduling_name="slice.2561"}
}

%wrapped_slice_computation.15 (param_0.6131: f32[32]) -> f32[1] {
  %param_0.6131 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6131"}
  ROOT %slice.2562 = f32[1]{0} slice(%param_0.6131), slice={[1:2]}, metadata={scheduling_name="slice.2562"}
}

%wrapped_slice_computation.16 (param_0.6132: f32[32]) -> f32[1] {
  %param_0.6132 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6132"}
  ROOT %slice.2563 = f32[1]{0} slice(%param_0.6132), slice={[2:3]}, metadata={scheduling_name="slice.2563"}
}

%wrapped_slice_computation.17 (param_0.6133: f32[32]) -> f32[1] {
  %param_0.6133 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6133"}
  ROOT %slice.2564 = f32[1]{0} slice(%param_0.6133), slice={[3:4]}, metadata={scheduling_name="slice.2564"}
}

%wrapped_concatenate_computation.5 (param_0.6134: bf16[12288], param_1.6491: bf16[12288], param_2.4767: bf16[12288], param_3.3989: bf16[12288]) -> bf16[49152] {
  %param_0.6134 = bf16[12288]{0} parameter(0), metadata={scheduling_name="param_0.6134"}
  %param_1.6491 = bf16[12288]{0} parameter(1), metadata={scheduling_name="param_1.6491"}
  %param_2.4767 = bf16[12288]{0} parameter(2), metadata={scheduling_name="param_2.4767"}
  %param_3.3989 = bf16[12288]{0} parameter(3), metadata={scheduling_name="param_3.3989"}
  ROOT %concatenate.744 = bf16[49152]{0} concatenate(%param_0.6134, %param_1.6491, %param_2.4767, %param_3.3989), dimensions={0}, metadata={scheduling_name="concatenate.744"}
}

%wrapped_slice_computation.18 (param_0.6135: bf16[49152]) -> bf16[12288] {
  %param_0.6135 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6135"}
  ROOT %slice.2565 = bf16[12288]{0} slice(%param_0.6135), slice={[0:12288]}, metadata={scheduling_name="slice.2565"}
}

%wrapped_slice_computation.19 (param_0.6136: bf16[49152]) -> bf16[12288] {
  %param_0.6136 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6136"}
  ROOT %slice.2566 = bf16[12288]{0} slice(%param_0.6136), slice={[12288:24576]}, metadata={scheduling_name="slice.2566"}
}

%wrapped_slice_computation.20 (param_0.6137: bf16[49152]) -> bf16[12288] {
  %param_0.6137 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6137"}
  ROOT %slice.2567 = bf16[12288]{0} slice(%param_0.6137), slice={[24576:36864]}, metadata={scheduling_name="slice.2567"}
}

%wrapped_slice_computation.21 (param_0.6138: bf16[49152]) -> bf16[12288] {
  %param_0.6138 = bf16[49152]{0} parameter(0), metadata={scheduling_name="param_0.6138"}
  ROOT %slice.2568 = bf16[12288]{0} slice(%param_0.6138), slice={[36864:49152]}, metadata={scheduling_name="slice.2568"}
}

%wrapped_concatenate_computation.6 (param_0.6139: f32[1], param_1.6492: f32[1], param_2.4768: f32[1], param_3.3990: f32[1], param_4.2946: f32[1], param_5.2731: f32[1], param_6.2549: f32[1], param_7.2397: f32[1]) -> f32[8] {
  %param_0.6139 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6139"}
  %param_1.6492 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6492"}
  %param_2.4768 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4768"}
  %param_3.3990 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3990"}
  %param_4.2946 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2946"}
  %param_5.2731 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2731"}
  %param_6.2549 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2549"}
  %param_7.2397 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2397"}
  ROOT %concatenate.745 = f32[8]{0} concatenate(%param_0.6139, %param_1.6492, %param_2.4768, %param_3.3990, %param_4.2946, /*index=5*/%param_5.2731, %param_6.2549, %param_7.2397), dimensions={0}, metadata={scheduling_name="concatenate.745"}
}

%wrapped_slice_computation.22 (param_0.6140: f32[8]) -> f32[1] {
  %param_0.6140 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6140"}
  ROOT %slice.2569 = f32[1]{0} slice(%param_0.6140), slice={[0:1]}, metadata={scheduling_name="slice.2569"}
}

%wrapped_slice_computation.23 (param_0.6141: f32[8]) -> f32[1] {
  %param_0.6141 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6141"}
  ROOT %slice.2570 = f32[1]{0} slice(%param_0.6141), slice={[1:2]}, metadata={scheduling_name="slice.2570"}
}

%wrapped_slice_computation.24 (param_0.6142: f32[32]) -> f32[1] {
  %param_0.6142 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6142"}
  ROOT %slice.2571 = f32[1]{0} slice(%param_0.6142), slice={[4:5]}, metadata={scheduling_name="slice.2571"}
}

%wrapped_slice_computation.25 (param_0.6143: f32[32]) -> f32[1] {
  %param_0.6143 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6143"}
  ROOT %slice.2572 = f32[1]{0} slice(%param_0.6143), slice={[5:6]}, metadata={scheduling_name="slice.2572"}
}

%wrapped_slice_computation.26 (param_0.6144: f32[32]) -> f32[1] {
  %param_0.6144 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6144"}
  ROOT %slice.2573 = f32[1]{0} slice(%param_0.6144), slice={[6:7]}, metadata={scheduling_name="slice.2573"}
}

%wrapped_slice_computation.27 (param_0.6145: f32[32]) -> f32[1] {
  %param_0.6145 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6145"}
  ROOT %slice.2574 = f32[1]{0} slice(%param_0.6145), slice={[7:8]}, metadata={scheduling_name="slice.2574"}
}

%wrapped_slice_computation.28 (param_0.6146: f32[32]) -> f32[1] {
  %param_0.6146 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6146"}
  ROOT %slice.2575 = f32[1]{0} slice(%param_0.6146), slice={[8:9]}, metadata={scheduling_name="slice.2575"}
}

%wrapped_slice_computation.29 (param_0.6147: f32[32]) -> f32[1] {
  %param_0.6147 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6147"}
  ROOT %slice.2576 = f32[1]{0} slice(%param_0.6147), slice={[9:10]}, metadata={scheduling_name="slice.2576"}
}

%wrapped_slice_computation.30 (param_0.6148: f32[32]) -> f32[1] {
  %param_0.6148 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6148"}
  ROOT %slice.2577 = f32[1]{0} slice(%param_0.6148), slice={[10:11]}, metadata={scheduling_name="slice.2577"}
}

%wrapped_slice_computation.31 (param_0.6149: f32[32]) -> f32[1] {
  %param_0.6149 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6149"}
  ROOT %slice.2578 = f32[1]{0} slice(%param_0.6149), slice={[11:12]}, metadata={scheduling_name="slice.2578"}
}

%wrapped_slice_computation.32 (param_0.6150: f32[8]) -> f32[1] {
  %param_0.6150 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6150"}
  ROOT %slice.2579 = f32[1]{0} slice(%param_0.6150), slice={[2:3]}, metadata={scheduling_name="slice.2579"}
}

%wrapped_slice_computation.33 (param_0.6151: f32[8]) -> f32[1] {
  %param_0.6151 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6151"}
  ROOT %slice.2580 = f32[1]{0} slice(%param_0.6151), slice={[3:4]}, metadata={scheduling_name="slice.2580"}
}

%wrapped_slice_computation.34 (param_0.6152: f32[32]) -> f32[1] {
  %param_0.6152 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6152"}
  ROOT %slice.2581 = f32[1]{0} slice(%param_0.6152), slice={[12:13]}, metadata={scheduling_name="slice.2581"}
}

%wrapped_slice_computation.35 (param_0.6153: f32[32]) -> f32[1] {
  %param_0.6153 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6153"}
  ROOT %slice.2582 = f32[1]{0} slice(%param_0.6153), slice={[13:14]}, metadata={scheduling_name="slice.2582"}
}

%wrapped_slice_computation.36 (param_0.6154: f32[32]) -> f32[1] {
  %param_0.6154 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6154"}
  ROOT %slice.2583 = f32[1]{0} slice(%param_0.6154), slice={[14:15]}, metadata={scheduling_name="slice.2583"}
}

%wrapped_slice_computation.37 (param_0.6155: f32[32]) -> f32[1] {
  %param_0.6155 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6155"}
  ROOT %slice.2584 = f32[1]{0} slice(%param_0.6155), slice={[15:16]}, metadata={scheduling_name="slice.2584"}
}

%wrapped_slice_computation.38 (param_0.6156: f32[4]) -> f32[1] {
  %param_0.6156 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6156"}
  ROOT %slice.2585 = f32[1]{0} slice(%param_0.6156), slice={[1:2]}, metadata={scheduling_name="slice.2585"}
}

%wrapped_transpose_computation.1 (param_0.6157: bf16[32768,768]) -> bf16[768,32768] {
  %param_0.6157 = bf16[32768,768]{1,0} parameter(0), metadata={scheduling_name="param_0.6157"}
  ROOT %transpose.770.1 = bf16[768,32768]{1,0} transpose(%param_0.6157), dimensions={1,0}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="transpose.770.1"}
}

%wrapped_slice_computation.39 (param_0.6158: f32[4]) -> f32[1] {
  %param_0.6158 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6158"}
  ROOT %slice.2586 = f32[1]{0} slice(%param_0.6158), slice={[2:3]}, metadata={scheduling_name="slice.2586"}
}

%wrapped_slice_computation.40 (param_0.6159: f32[32]) -> f32[1] {
  %param_0.6159 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6159"}
  ROOT %slice.2587 = f32[1]{0} slice(%param_0.6159), slice={[16:17]}, metadata={scheduling_name="slice.2587"}
}

%wrapped_slice_computation.41 (param_0.6160: f32[32]) -> f32[1] {
  %param_0.6160 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6160"}
  ROOT %slice.2588 = f32[1]{0} slice(%param_0.6160), slice={[17:18]}, metadata={scheduling_name="slice.2588"}
}

%wrapped_slice_computation.42 (param_0.6161: f32[32]) -> f32[1] {
  %param_0.6161 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6161"}
  ROOT %slice.2589 = f32[1]{0} slice(%param_0.6161), slice={[18:19]}, metadata={scheduling_name="slice.2589"}
}

%wrapped_slice_computation.43 (param_0.6162: f32[32]) -> f32[1] {
  %param_0.6162 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6162"}
  ROOT %slice.2590 = f32[1]{0} slice(%param_0.6162), slice={[19:20]}, metadata={scheduling_name="slice.2590"}
}

%wrapped_slice_computation.44 (param_0.6163: f32[8]) -> f32[1] {
  %param_0.6163 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6163"}
  ROOT %slice.2591 = f32[1]{0} slice(%param_0.6163), slice={[4:5]}, metadata={scheduling_name="slice.2591"}
}

%wrapped_slice_computation.45 (param_0.6164: f32[8]) -> f32[1] {
  %param_0.6164 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6164"}
  ROOT %slice.2592 = f32[1]{0} slice(%param_0.6164), slice={[5:6]}, metadata={scheduling_name="slice.2592"}
}

%wrapped_slice_computation.46 (param_0.6165: f32[32]) -> f32[1] {
  %param_0.6165 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6165"}
  ROOT %slice.2593 = f32[1]{0} slice(%param_0.6165), slice={[20:21]}, metadata={scheduling_name="slice.2593"}
}

%wrapped_slice_computation.47 (param_0.6166: f32[32]) -> f32[1] {
  %param_0.6166 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6166"}
  ROOT %slice.2594 = f32[1]{0} slice(%param_0.6166), slice={[21:22]}, metadata={scheduling_name="slice.2594"}
}

%wrapped_slice_computation.48 (param_0.6167: f32[32]) -> f32[1] {
  %param_0.6167 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6167"}
  ROOT %slice.2595 = f32[1]{0} slice(%param_0.6167), slice={[22:23]}, metadata={scheduling_name="slice.2595"}
}

%wrapped_slice_computation.49 (param_0.6168: f32[32]) -> f32[1] {
  %param_0.6168 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6168"}
  ROOT %slice.2596 = f32[1]{0} slice(%param_0.6168), slice={[23:24]}, metadata={scheduling_name="slice.2596"}
}

%wrapped_slice_computation.50 (param_0.6169: f32[32]) -> f32[1] {
  %param_0.6169 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6169"}
  ROOT %slice.2597 = f32[1]{0} slice(%param_0.6169), slice={[24:25]}, metadata={scheduling_name="slice.2597"}
}

%wrapped_slice_computation.51 (param_0.6170: f32[32]) -> f32[1] {
  %param_0.6170 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6170"}
  ROOT %slice.2598 = f32[1]{0} slice(%param_0.6170), slice={[25:26]}, metadata={scheduling_name="slice.2598"}
}

%wrapped_slice_computation.52 (param_0.6171: f32[32]) -> f32[1] {
  %param_0.6171 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6171"}
  ROOT %slice.2599 = f32[1]{0} slice(%param_0.6171), slice={[26:27]}, metadata={scheduling_name="slice.2599"}
}

%wrapped_slice_computation.53 (param_0.6172: f32[32]) -> f32[1] {
  %param_0.6172 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6172"}
  ROOT %slice.2600 = f32[1]{0} slice(%param_0.6172), slice={[27:28]}, metadata={scheduling_name="slice.2600"}
}

%wrapped_slice_computation.54 (param_0.6173: f32[8]) -> f32[1] {
  %param_0.6173 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6173"}
  ROOT %slice.2601 = f32[1]{0} slice(%param_0.6173), slice={[6:7]}, metadata={scheduling_name="slice.2601"}
}

%wrapped_slice_computation.55 (param_0.6174: f32[8]) -> f32[1] {
  %param_0.6174 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6174"}
  ROOT %slice.2602 = f32[1]{0} slice(%param_0.6174), slice={[7:8]}, metadata={scheduling_name="slice.2602"}
}

%wrapped_slice_computation.56 (param_0.6175: f32[32]) -> f32[1] {
  %param_0.6175 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6175"}
  ROOT %slice.2603 = f32[1]{0} slice(%param_0.6175), slice={[28:29]}, metadata={scheduling_name="slice.2603"}
}

%wrapped_slice_computation.57 (param_0.6176: f32[32]) -> f32[1] {
  %param_0.6176 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6176"}
  ROOT %slice.2604 = f32[1]{0} slice(%param_0.6176), slice={[29:30]}, metadata={scheduling_name="slice.2604"}
}

%wrapped_slice_computation.58 (param_0.6177: f32[32]) -> f32[1] {
  %param_0.6177 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6177"}
  ROOT %slice.2605 = f32[1]{0} slice(%param_0.6177), slice={[30:31]}, metadata={scheduling_name="slice.2605"}
}

%wrapped_slice_computation.59 (param_0.6178: f32[32]) -> f32[1] {
  %param_0.6178 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6178"}
  ROOT %slice.2606 = f32[1]{0} slice(%param_0.6178), slice={[31:32]}, metadata={scheduling_name="slice.2606"}
}

%wrapped_slice_computation.60 (param_0.6179: f32[4]) -> f32[1] {
  %param_0.6179 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6179"}
  ROOT %slice.2607 = f32[1]{0} slice(%param_0.6179), slice={[3:4]}, metadata={scheduling_name="slice.2607"}
}

%wrapped_concatenate_computation.7 (param_0.6180: f32[1], param_1.6493: f32[1], param_2.4769: f32[1], param_3.3991: f32[1]) -> f32[4] {
  %param_0.6180 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6180"}
  %param_1.6493 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6493"}
  %param_2.4769 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4769"}
  %param_3.3991 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3991"}
  ROOT %concatenate.746 = f32[4]{0} concatenate(%param_0.6180, %param_1.6493, %param_2.4769, %param_3.3991), dimensions={0}, metadata={scheduling_name="concatenate.746"}
}

%wrapped_slice_computation.61 (param_0.6181: f32[4]) -> f32[1] {
  %param_0.6181 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6181"}
  ROOT %slice.2608 = f32[1]{0} slice(%param_0.6181), slice={[0:1]}, metadata={scheduling_name="slice.2608"}
}

%wrapped_concatenate_computation.8 (param_0.6182: f32[1], param_1.6494: f32[1], param_2.4770: f32[1], param_3.3992: f32[1], param_4.2947: f32[1], param_5.2732: f32[1], param_6.2550: f32[1], param_7.2398: f32[1], param_8.2265: f32[1], param_9.2289: f32[1], param_10.1944: f32[1], param_11.1719: f32[1], param_12.1367: f32[1], param_13.1026: f32[1], param_14.819: f32[1], param_15.602: f32[1], param_16.268: f32[1], param_17.113: f32[1], param_18.88: f32[1], param_19.71: f32[1], param_20.49: f32[1], param_21.26: f32[1], param_22.25: f32[1], param_23.11: f32[1], param_24.5: f32[1], param_25.1: f32[1], param_26.1: f32[1], param_27.1: f32[1], param_28.1: f32[1], param_29.1: f32[1], param_30.1: f32[1], param_31.1: f32[1]) -> f32[32] {
  %param_0.6182 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6182"}
  %param_1.6494 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6494"}
  %param_2.4770 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4770"}
  %param_3.3992 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3992"}
  %param_4.2947 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2947"}
  %param_5.2732 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2732"}
  %param_6.2550 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2550"}
  %param_7.2398 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2398"}
  %param_8.2265 = f32[1]{0} parameter(8), metadata={scheduling_name="param_8.2265"}
  %param_9.2289 = f32[1]{0} parameter(9), metadata={scheduling_name="param_9.2289"}
  %param_10.1944 = f32[1]{0} parameter(10), metadata={scheduling_name="param_10.1944"}
  %param_11.1719 = f32[1]{0} parameter(11), metadata={scheduling_name="param_11.1719"}
  %param_12.1367 = f32[1]{0} parameter(12), metadata={scheduling_name="param_12.1367"}
  %param_13.1026 = f32[1]{0} parameter(13), metadata={scheduling_name="param_13.1026"}
  %param_14.819 = f32[1]{0} parameter(14), metadata={scheduling_name="param_14.819"}
  %param_15.602 = f32[1]{0} parameter(15), metadata={scheduling_name="param_15.602"}
  %param_16.268 = f32[1]{0} parameter(16), metadata={scheduling_name="param_16.268"}
  %param_17.113 = f32[1]{0} parameter(17), metadata={scheduling_name="param_17.113"}
  %param_18.88 = f32[1]{0} parameter(18), metadata={scheduling_name="param_18.88"}
  %param_19.71 = f32[1]{0} parameter(19), metadata={scheduling_name="param_19.71"}
  %param_20.49 = f32[1]{0} parameter(20), metadata={scheduling_name="param_20.49"}
  %param_21.26 = f32[1]{0} parameter(21), metadata={scheduling_name="param_21.26"}
  %param_22.25 = f32[1]{0} parameter(22), metadata={scheduling_name="param_22.25"}
  %param_23.11 = f32[1]{0} parameter(23), metadata={scheduling_name="param_23.11"}
  %param_24.5 = f32[1]{0} parameter(24), metadata={scheduling_name="param_24.5"}
  %param_25.1 = f32[1]{0} parameter(25), metadata={scheduling_name="param_25.1"}
  %param_26.1 = f32[1]{0} parameter(26), metadata={scheduling_name="param_26.1"}
  %param_27.1 = f32[1]{0} parameter(27), metadata={scheduling_name="param_27.1"}
  %param_28.1 = f32[1]{0} parameter(28), metadata={scheduling_name="param_28.1"}
  %param_29.1 = f32[1]{0} parameter(29), metadata={scheduling_name="param_29.1"}
  %param_30.1 = f32[1]{0} parameter(30), metadata={scheduling_name="param_30.1"}
  %param_31.1 = f32[1]{0} parameter(31), metadata={scheduling_name="param_31.1"}
  ROOT %concatenate.747 = f32[32]{0} concatenate(%param_0.6182, %param_1.6494, %param_2.4770, %param_3.3992, %param_4.2947, /*index=5*/%param_5.2732, %param_6.2550, %param_7.2398, %param_8.2265, %param_9.2289, /*index=10*/%param_10.1944, %param_11.1719, %param_12.1367, %param_13.1026, %param_14.819, /*index=15*/%param_15.602, %param_16.268, %param_17.113, %param_18.88, %param_19.71, /*index=20*/%param_20.49, %param_21.26, %param_22.25, %param_23.11, %param_24.5, /*index=25*/%param_25.1, %param_26.1, %param_27.1, %param_28.1, %param_29.1, /*index=30*/%param_30.1, %param_31.1), dimensions={0}, metadata={scheduling_name="concatenate.747"}
}

%wrapped_slice_computation.62 (param_0.6183: f32[32]) -> f32[1] {
  %param_0.6183 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6183"}
  ROOT %slice.2609 = f32[1]{0} slice(%param_0.6183), slice={[0:1]}, metadata={scheduling_name="slice.2609"}
}

%wrapped_slice_computation.63 (param_0.6184: f32[32]) -> f32[1] {
  %param_0.6184 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6184"}
  ROOT %slice.2610 = f32[1]{0} slice(%param_0.6184), slice={[1:2]}, metadata={scheduling_name="slice.2610"}
}

%wrapped_slice_computation.64 (param_0.6185: f32[32]) -> f32[1] {
  %param_0.6185 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6185"}
  ROOT %slice.2611 = f32[1]{0} slice(%param_0.6185), slice={[2:3]}, metadata={scheduling_name="slice.2611"}
}

%wrapped_slice_computation.65 (param_0.6186: f32[32]) -> f32[1] {
  %param_0.6186 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6186"}
  ROOT %slice.2612 = f32[1]{0} slice(%param_0.6186), slice={[3:4]}, metadata={scheduling_name="slice.2612"}
}

%wrapped_concatenate_computation.9 (param_0.6187: f32[1], param_1.6495: f32[1], param_2.4771: f32[1], param_3.3993: f32[1], param_4.2948: f32[1], param_5.2733: f32[1], param_6.2551: f32[1], param_7.2399: f32[1]) -> f32[8] {
  %param_0.6187 = f32[1]{0} parameter(0), metadata={scheduling_name="param_0.6187"}
  %param_1.6495 = f32[1]{0} parameter(1), metadata={scheduling_name="param_1.6495"}
  %param_2.4771 = f32[1]{0} parameter(2), metadata={scheduling_name="param_2.4771"}
  %param_3.3993 = f32[1]{0} parameter(3), metadata={scheduling_name="param_3.3993"}
  %param_4.2948 = f32[1]{0} parameter(4), metadata={scheduling_name="param_4.2948"}
  %param_5.2733 = f32[1]{0} parameter(5), metadata={scheduling_name="param_5.2733"}
  %param_6.2551 = f32[1]{0} parameter(6), metadata={scheduling_name="param_6.2551"}
  %param_7.2399 = f32[1]{0} parameter(7), metadata={scheduling_name="param_7.2399"}
  ROOT %concatenate.748 = f32[8]{0} concatenate(%param_0.6187, %param_1.6495, %param_2.4771, %param_3.3993, %param_4.2948, /*index=5*/%param_5.2733, %param_6.2551, %param_7.2399), dimensions={0}, metadata={scheduling_name="concatenate.748"}
}

%wrapped_slice_computation.66 (param_0.6188: f32[8]) -> f32[1] {
  %param_0.6188 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6188"}
  ROOT %slice.2613 = f32[1]{0} slice(%param_0.6188), slice={[0:1]}, metadata={scheduling_name="slice.2613"}
}

%wrapped_slice_computation.67 (param_0.6189: f32[8]) -> f32[1] {
  %param_0.6189 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6189"}
  ROOT %slice.2614 = f32[1]{0} slice(%param_0.6189), slice={[1:2]}, metadata={scheduling_name="slice.2614"}
}

%wrapped_slice_computation.68 (param_0.6190: f32[32]) -> f32[1] {
  %param_0.6190 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6190"}
  ROOT %slice.2615 = f32[1]{0} slice(%param_0.6190), slice={[4:5]}, metadata={scheduling_name="slice.2615"}
}

%wrapped_slice_computation.69 (param_0.6191: f32[32]) -> f32[1] {
  %param_0.6191 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6191"}
  ROOT %slice.2616 = f32[1]{0} slice(%param_0.6191), slice={[5:6]}, metadata={scheduling_name="slice.2616"}
}

%wrapped_slice_computation.70 (param_0.6192: f32[32]) -> f32[1] {
  %param_0.6192 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6192"}
  ROOT %slice.2617 = f32[1]{0} slice(%param_0.6192), slice={[6:7]}, metadata={scheduling_name="slice.2617"}
}

%wrapped_slice_computation.71 (param_0.6193: f32[32]) -> f32[1] {
  %param_0.6193 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6193"}
  ROOT %slice.2618 = f32[1]{0} slice(%param_0.6193), slice={[7:8]}, metadata={scheduling_name="slice.2618"}
}

%wrapped_slice_computation.72 (param_0.6194: f32[32]) -> f32[1] {
  %param_0.6194 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6194"}
  ROOT %slice.2619 = f32[1]{0} slice(%param_0.6194), slice={[8:9]}, metadata={scheduling_name="slice.2619"}
}

%wrapped_slice_computation.73 (param_0.6195: f32[32]) -> f32[1] {
  %param_0.6195 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6195"}
  ROOT %slice.2620 = f32[1]{0} slice(%param_0.6195), slice={[9:10]}, metadata={scheduling_name="slice.2620"}
}

%wrapped_slice_computation.74 (param_0.6196: f32[32]) -> f32[1] {
  %param_0.6196 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6196"}
  ROOT %slice.2621 = f32[1]{0} slice(%param_0.6196), slice={[10:11]}, metadata={scheduling_name="slice.2621"}
}

%wrapped_slice_computation.75 (param_0.6197: f32[32]) -> f32[1] {
  %param_0.6197 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6197"}
  ROOT %slice.2622 = f32[1]{0} slice(%param_0.6197), slice={[11:12]}, metadata={scheduling_name="slice.2622"}
}

%wrapped_slice_computation.76 (param_0.6198: f32[8]) -> f32[1] {
  %param_0.6198 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6198"}
  ROOT %slice.2623 = f32[1]{0} slice(%param_0.6198), slice={[2:3]}, metadata={scheduling_name="slice.2623"}
}

%wrapped_slice_computation.77 (param_0.6199: f32[8]) -> f32[1] {
  %param_0.6199 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6199"}
  ROOT %slice.2624 = f32[1]{0} slice(%param_0.6199), slice={[3:4]}, metadata={scheduling_name="slice.2624"}
}

%wrapped_slice_computation.78 (param_0.6200: f32[32]) -> f32[1] {
  %param_0.6200 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6200"}
  ROOT %slice.2625 = f32[1]{0} slice(%param_0.6200), slice={[12:13]}, metadata={scheduling_name="slice.2625"}
}

%wrapped_slice_computation.79 (param_0.6201: f32[32]) -> f32[1] {
  %param_0.6201 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6201"}
  ROOT %slice.2626 = f32[1]{0} slice(%param_0.6201), slice={[13:14]}, metadata={scheduling_name="slice.2626"}
}

%wrapped_slice_computation.80 (param_0.6202: f32[32]) -> f32[1] {
  %param_0.6202 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6202"}
  ROOT %slice.2627 = f32[1]{0} slice(%param_0.6202), slice={[14:15]}, metadata={scheduling_name="slice.2627"}
}

%wrapped_slice_computation.81 (param_0.6203: f32[32]) -> f32[1] {
  %param_0.6203 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6203"}
  ROOT %slice.2628 = f32[1]{0} slice(%param_0.6203), slice={[15:16]}, metadata={scheduling_name="slice.2628"}
}

%wrapped_slice_computation.82 (param_0.6204: f32[4]) -> f32[1] {
  %param_0.6204 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6204"}
  ROOT %slice.2629 = f32[1]{0} slice(%param_0.6204), slice={[1:2]}, metadata={scheduling_name="slice.2629"}
}

%wrapped_slice_computation.83 (param_0.6205: f32[4]) -> f32[1] {
  %param_0.6205 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6205"}
  ROOT %slice.2630 = f32[1]{0} slice(%param_0.6205), slice={[2:3]}, metadata={scheduling_name="slice.2630"}
}

%wrapped_slice_computation.84 (param_0.6206: f32[32]) -> f32[1] {
  %param_0.6206 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6206"}
  ROOT %slice.2631 = f32[1]{0} slice(%param_0.6206), slice={[16:17]}, metadata={scheduling_name="slice.2631"}
}

%wrapped_slice_computation.85 (param_0.6207: f32[32]) -> f32[1] {
  %param_0.6207 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6207"}
  ROOT %slice.2632 = f32[1]{0} slice(%param_0.6207), slice={[17:18]}, metadata={scheduling_name="slice.2632"}
}

%wrapped_slice_computation.86 (param_0.6208: f32[32]) -> f32[1] {
  %param_0.6208 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6208"}
  ROOT %slice.2633 = f32[1]{0} slice(%param_0.6208), slice={[18:19]}, metadata={scheduling_name="slice.2633"}
}

%wrapped_slice_computation.87 (param_0.6209: f32[32]) -> f32[1] {
  %param_0.6209 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6209"}
  ROOT %slice.2634 = f32[1]{0} slice(%param_0.6209), slice={[19:20]}, metadata={scheduling_name="slice.2634"}
}

%wrapped_slice_computation.88 (param_0.6210: f32[8]) -> f32[1] {
  %param_0.6210 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6210"}
  ROOT %slice.2635 = f32[1]{0} slice(%param_0.6210), slice={[4:5]}, metadata={scheduling_name="slice.2635"}
}

%wrapped_slice_computation.89 (param_0.6211: f32[8]) -> f32[1] {
  %param_0.6211 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6211"}
  ROOT %slice.2636 = f32[1]{0} slice(%param_0.6211), slice={[5:6]}, metadata={scheduling_name="slice.2636"}
}

%wrapped_slice_computation.90 (param_0.6212: f32[32]) -> f32[1] {
  %param_0.6212 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6212"}
  ROOT %slice.2637 = f32[1]{0} slice(%param_0.6212), slice={[20:21]}, metadata={scheduling_name="slice.2637"}
}

%wrapped_slice_computation.91 (param_0.6213: f32[32]) -> f32[1] {
  %param_0.6213 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6213"}
  ROOT %slice.2638 = f32[1]{0} slice(%param_0.6213), slice={[21:22]}, metadata={scheduling_name="slice.2638"}
}

%wrapped_slice_computation.92 (param_0.6214: f32[32]) -> f32[1] {
  %param_0.6214 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6214"}
  ROOT %slice.2639 = f32[1]{0} slice(%param_0.6214), slice={[22:23]}, metadata={scheduling_name="slice.2639"}
}

%wrapped_slice_computation.93 (param_0.6215: f32[32]) -> f32[1] {
  %param_0.6215 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6215"}
  ROOT %slice.2640 = f32[1]{0} slice(%param_0.6215), slice={[23:24]}, metadata={scheduling_name="slice.2640"}
}

%wrapped_slice_computation.94 (param_0.6216: f32[32]) -> f32[1] {
  %param_0.6216 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6216"}
  ROOT %slice.2641 = f32[1]{0} slice(%param_0.6216), slice={[24:25]}, metadata={scheduling_name="slice.2641"}
}

%wrapped_slice_computation.95 (param_0.6217: f32[32]) -> f32[1] {
  %param_0.6217 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6217"}
  ROOT %slice.2642 = f32[1]{0} slice(%param_0.6217), slice={[25:26]}, metadata={scheduling_name="slice.2642"}
}

%wrapped_slice_computation.96 (param_0.6218: f32[32]) -> f32[1] {
  %param_0.6218 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6218"}
  ROOT %slice.2643 = f32[1]{0} slice(%param_0.6218), slice={[26:27]}, metadata={scheduling_name="slice.2643"}
}

%wrapped_slice_computation.97 (param_0.6219: f32[32]) -> f32[1] {
  %param_0.6219 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6219"}
  ROOT %slice.2644 = f32[1]{0} slice(%param_0.6219), slice={[27:28]}, metadata={scheduling_name="slice.2644"}
}

%wrapped_slice_computation.98 (param_0.6220: f32[8]) -> f32[1] {
  %param_0.6220 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6220"}
  ROOT %slice.2645 = f32[1]{0} slice(%param_0.6220), slice={[6:7]}, metadata={scheduling_name="slice.2645"}
}

%wrapped_slice_computation.99 (param_0.6221: f32[8]) -> f32[1] {
  %param_0.6221 = f32[8]{0} parameter(0), metadata={scheduling_name="param_0.6221"}
  ROOT %slice.2646 = f32[1]{0} slice(%param_0.6221), slice={[7:8]}, metadata={scheduling_name="slice.2646"}
}

%wrapped_slice_computation.100 (param_0.6222: f32[32]) -> f32[1] {
  %param_0.6222 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6222"}
  ROOT %slice.2647 = f32[1]{0} slice(%param_0.6222), slice={[28:29]}, metadata={scheduling_name="slice.2647"}
}

%wrapped_slice_computation.101 (param_0.6223: f32[32]) -> f32[1] {
  %param_0.6223 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6223"}
  ROOT %slice.2648 = f32[1]{0} slice(%param_0.6223), slice={[29:30]}, metadata={scheduling_name="slice.2648"}
}

%wrapped_slice_computation.102 (param_0.6224: f32[32]) -> f32[1] {
  %param_0.6224 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6224"}
  ROOT %slice.2649 = f32[1]{0} slice(%param_0.6224), slice={[30:31]}, metadata={scheduling_name="slice.2649"}
}

%wrapped_slice_computation.103 (param_0.6225: f32[32]) -> f32[1] {
  %param_0.6225 = f32[32]{0} parameter(0), metadata={scheduling_name="param_0.6225"}
  ROOT %slice.2650 = f32[1]{0} slice(%param_0.6225), slice={[31:32]}, metadata={scheduling_name="slice.2650"}
}

%wrapped_slice_computation.104 (param_0.6226: f32[4]) -> f32[1] {
  %param_0.6226 = f32[4]{0} parameter(0), metadata={scheduling_name="param_0.6226"}
  ROOT %slice.2651 = f32[1]{0} slice(%param_0.6226), slice={[3:4]}, metadata={scheduling_name="slice.2651"}
}

ENTRY %main.5687_spmd (param.4: s32[], param.5: bf16[6144], param.31: bf16[768,32768], param.16: bf16[2,1,768,8], param.17: bf16[2,1,1,6144,16384], param.18: bf16[2,1,1,6144,16384], param.19: bf16[2,1,1,16384,6144], param.15: bf16[2,1,6144], param.9: bf16[2,1,6144], param.12: bf16[2,1,768,8,128], param.14: bf16[2,1,48,128,768], param.10: bf16[2,1,768,48,128], param.13: bf16[2,1,768,8,128], param.26: bf16[2,1,768,8], param.27: bf16[2,1,1,6144,16384], param.28: bf16[2,1,1,6144,16384], param.29: bf16[2,1,1,16384,6144], param.25: bf16[2,1,6144], param.20: bf16[2,1,6144], param.22: bf16[2,1,768,8,128], param.24: bf16[2,1,48,128,768], param.21: bf16[2,1,768,48,128], param.23: bf16[2,1,768,8,128], param.8: bf16[32768,768], param.34: s32[], param.33: bf16[6144], param.36: bf16[768,32768], param.38: bf16[2,1,768,8], param.40: bf16[2,1,1,6144,16384], param.42: bf16[2,1,1,6144,16384], param.44: bf16[2,1,1,16384,6144], param.46: bf16[2,1,6144], param.48: bf16[2,1,6144], param.50: bf16[2,1,768,8,128], param.52: bf16[2,1,48,128,768], param.54: bf16[2,1,768,48,128], param.56: bf16[2,1,768,8,128], param.58: bf16[2,1,768,8], param.60: bf16[2,1,1,6144,16384], param.62: bf16[2,1,1,6144,16384], param.64: bf16[2,1,1,16384,6144], param.66: bf16[2,1,6144], param.68: bf16[2,1,6144], param.70: bf16[2,1,768,8,128], param.72: bf16[2,1,48,128,768], param.74: bf16[2,1,768,48,128], param.76: bf16[2,1,768,8,128], param.78: bf16[32768,768], param.35: bf16[6144], param.37: bf16[768,32768], param.39: bf16[2,1,768,8], param.41: bf16[2,1,1,6144,16384], param.43: bf16[2,1,1,6144,16384], param.45: bf16[2,1,1,16384,6144], param.47: bf16[2,1,6144], param.49: bf16[2,1,6144], param.51: bf16[2,1,768,8,128], param.53: bf16[2,1,48,128,768], param.55: bf16[2,1,768,48,128], param.57: bf16[2,1,768,8,128], param.59: bf16[2,1,768,8], param.61: bf16[2,1,1,6144,16384], param.63: bf16[2,1,1,6144,16384], param.65: bf16[2,1,1,16384,6144], param.67: bf16[2,1,6144], param.69: bf16[2,1,6144], param.71: bf16[2,1,768,8,128], param.73: bf16[2,1,48,128,768], param.75: bf16[2,1,768,48,128], param.77: bf16[2,1,768,8,128], param.79: bf16[32768,768], param.6: s32[], param.7: s32[8,8192], param.11: s32[8,8192], param.32: s32[8,8192], param.30: s32[8,8192]) -> (s32[], bf16[6144], bf16[768,32768], bf16[2,1,768,8], bf16[2,1,1,6144,16384], /*index=5*/bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], /*index=10*/bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], /*index=15*/bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], /*index=20*/bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[32768,768], s32[], /*index=25*/bf16[6144], bf16[768,32768], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], /*index=30*/bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], /*index=35*/bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], /*index=40*/bf16[2,1,1,16384,6144], bf16[2,1,6144], bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], /*index=45*/bf16[2,1,768,48,128], bf16[2,1,768,8,128], bf16[32768,768], bf16[6144], bf16[768,32768], /*index=50*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=55*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=60*/bf16[2,1,768,8], bf16[2,1,1,6144,16384], bf16[2,1,1,6144,16384], bf16[2,1,1,16384,6144], bf16[2,1,6144], /*index=65*/bf16[2,1,6144], bf16[2,1,768,8,128], bf16[2,1,48,128,768], bf16[2,1,768,48,128], bf16[2,1,768,8,128], /*index=70*/bf16[32768,768], s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[]) {
  %param.8 = bf16[32768,768]{1,0} parameter(23), sharding={devices=[1,8,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.8"}
  %param.31 = bf16[768,32768]{1,0} parameter(2), sharding={devices=[8,1,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.31"}
  %param.7 = s32[8,8192]{1,0} parameter(72), sharding={devices=[32,1]<=[32]}, metadata={op_name="data[\'inputs\']" scheduling_name="param.7"}
  %constant_3042_0 = s32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193}
  %constant_2984_0 = s32[] constant(0)
  %constant_3031_0 = s32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000}
  %param.14 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(10), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.14"}
  %param.11 = s32[8,8192]{1,0} parameter(73), sharding={devices=[32,1]<=[32]}, metadata={op_name="data[\'inputs_position\']" scheduling_name="param.11"}
  %param.24 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(20), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.24"}
  %constant_3047_0 = u32[32]{0} constant({...}), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643}
  %param.9 = bf16[2,1,6144]{2,1,0} parameter(8), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.9"}
  %param.10 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(11), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.10"}
  %param.12 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(9), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.12"}
  %param.13 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(12), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.13"}
  %param.15 = bf16[2,1,6144]{2,1,0} parameter(7), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.15"}
  %param.16 = bf16[2,1,768,8]{3,2,1,0} parameter(3), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.16"}
  %param.17 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(4), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.17"}
  %param.18 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(5), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.18"}
  %param.19 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(6), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.19"}
  %param.20 = bf16[2,1,6144]{2,1,0} parameter(18), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.20"}
  %param.21 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(21), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.21"}
  %param.22 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(19), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.22"}
  %param.23 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(22), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.23"}
  %param.25 = bf16[2,1,6144]{2,1,0} parameter(17), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.25"}
  %param.26 = bf16[2,1,768,8]{3,2,1,0} parameter(13), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.26"}
  %param.27 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(14), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.27"}
  %param.28 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(15), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.28"}
  %param.29 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(16), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.29"}
  %constant_3089_0 = s32[2,1]{1,0} constant({ {1}, {0} })
  %param.30 = s32[8,8192]{1,0} parameter(75), sharding={devices=[32,1]<=[32]}, metadata={op_name="data[\'targets_segmentation\']" scheduling_name="param.30"}
  %param.5 = bf16[6144]{0} parameter(1), sharding={replicated}, metadata={op_name="state.params[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.5"}
  %param.32 = s32[8,8192]{1,0} parameter(74), sharding={devices=[32,1]<=[32]}, metadata={op_name="data[\'targets\']" scheduling_name="param.32"}
  %param.6 = s32[] parameter(71), sharding={replicated}, metadata={op_name="state.opt_state[2].count" scheduling_name="param.6"}
  %param.4 = s32[] parameter(0), sharding={replicated}, metadata={op_name="state.step" scheduling_name="param.4"}
  %param.34 = s32[] parameter(24), sharding={replicated}, metadata={op_name="state.opt_state[0].count" scheduling_name="param.34"}
  %param.78 = bf16[32768,768]{1,0} parameter(47), sharding={devices=[1,8,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.78"}
  %param.79 = bf16[32768,768]{1,0} parameter(70), sharding={devices=[1,8,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="param.79"}
  %constant_3026_0 = f32[] constant(0)
  %param.35 = bf16[6144]{0} parameter(48), sharding={replicated}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.35"}
  %param.33 = bf16[6144]{0} parameter(25), sharding={replicated}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'decoder_norm\'][\'scale\']" scheduling_name="param.33"}
  %param.39 = bf16[2,1,768,8]{3,2,1,0} parameter(50), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.39"}
  %param.38 = bf16[2,1,768,8]{3,2,1,0} parameter(27), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.38"}
  %param.47 = bf16[2,1,6144]{2,1,0} parameter(54), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.47"}
  %param.46 = bf16[2,1,6144]{2,1,0} parameter(31), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.46"}
  %param.69 = bf16[2,1,6144]{2,1,0} parameter(65), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.69"}
  %param.68 = bf16[2,1,6144]{2,1,0} parameter(42), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.68"}
  %param.49 = bf16[2,1,6144]{2,1,0} parameter(55), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.49"}
  %param.48 = bf16[2,1,6144]{2,1,0} parameter(32), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'pre_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.48"}
  %param.67 = bf16[2,1,6144]{2,1,0} parameter(64), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.67"}
  %param.66 = bf16[2,1,6144]{2,1,0} parameter(41), sharding={devices=[1,2,1,16]<=[32] last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'post_self_attention_layer_norm\'][\'scale\']" scheduling_name="param.66"}
  %param.59 = bf16[2,1,768,8]{3,2,1,0} parameter(60), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.59"}
  %param.58 = bf16[2,1,768,8]{3,2,1,0} parameter(37), sharding={devices=[1,2,8,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'gate\'][\'kernel\']" scheduling_name="param.58"}
  %param.71 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(66), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.71"}
  %param.70 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(43), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.70"}
  %param.51 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(56), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.51"}
  %param.50 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(33), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'key\'][\'kernel\']" scheduling_name="param.50"}
  %param.77 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(69), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.77"}
  %param.76 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(46), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.76"}
  %param.57 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(59), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.57"}
  %param.56 = bf16[2,1,768,8,128]{4,3,2,1,0} parameter(36), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'value\'][\'kernel\']" scheduling_name="param.56"}
  %param.55 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(58), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.55"}
  %param.54 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(35), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.54"}
  %param.73 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(67), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.73"}
  %param.72 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(44), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.72"}
  %param.75 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(68), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.75"}
  %param.74 = bf16[2,1,768,48,128]{4,3,2,1,0} parameter(45), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'query\'][\'kernel\']" scheduling_name="param.74"}
  %param.53 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(57), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.53"}
  %param.52 = bf16[2,1,48,128,768]{4,3,2,1,0} parameter(34), sharding={devices=[1,2,1,1,8,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" scheduling_name="param.52"}
  %param.37 = bf16[768,32768]{1,0} parameter(49), sharding={devices=[8,1,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.37"}
  %param.36 = bf16[768,32768]{1,0} parameter(26), sharding={devices=[8,1,4]<=[4,8]T(1,0) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'logits_dense\'][\'kernel\']" scheduling_name="param.36"}
  %param.41 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(51), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.41"}
  %param.40 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(28), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.40"}
  %param.43 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(52), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.43"}
  %param.42 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(29), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.42"}
  %param.61 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(61), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.61"}
  %param.60 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(38), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_0\']" scheduling_name="param.60"}
  %param.45 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(53), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.45"}
  %param.44 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(30), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.44"}
  %param.63 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(62), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.63"}
  %param.62 = bf16[2,1,1,6144,16384]{4,3,2,1,0} parameter(39), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wi_1\']" scheduling_name="param.62"}
  %param.65 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(63), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].nu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.65"}
  %param.64 = bf16[2,1,1,16384,6144]{4,3,2,1,0} parameter(40), sharding={devices=[1,2,8,1,1,2]<=[2,2,8]T(0,2,1) last_tile_dim_replicate}, metadata={op_name="state.opt_state[0].mu[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'MoeBlock_0\'][\'wo\']" scheduling_name="param.64"}
  %wrapped_transpose = bf16[768,32768]{1,0} fusion(%param.8), kind=kInput, calls=%wrapped_transpose_computation, metadata={op_name="state.params[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="wrapped_transpose"}
  %all-gather-start.3 = ((bf16[768,32768]{1,0}, bf16[768,32768]{1,0}), (bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0})) all-gather-start(%wrapped_transpose, %param.31), channel_id=1, replica_groups=[4,8]<=[32], dimensions={0}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-gather-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_convert_fusion.17 = bf16[8,8192,32768]{2,1,0} fusion(%param.7), kind=kLoop, calls=%fused_convert.17, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=149 scheduling_name="loop_convert_fusion.17"}
  %all-gather-done.3 = (bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0}) all-gather-done(%all-gather-start.3), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-gather-done.3"}
  %get-tuple-element.4291 = bf16[6144,32768]{1,0} get-tuple-element(%all-gather-done.3), index=0, metadata={scheduling_name="get-tuple-element.4291"}
  %bitcast.32295 = bf16[32768,6144]{0,1} bitcast(%get-tuple-element.4291), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="bitcast.32295"}
  %bitcast.26280.0 = bf16[65536,32768]{1,0} bitcast(%loop_convert_fusion.17), metadata={scheduling_name="bitcast.26280.0"}
  %custom-call.1188 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26280.0, %bitcast.32295), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="custom-call.1188"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3830.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1188), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_embedding/token_embedder/dot_general" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="get-tuple-element.3830.0"}
  %bitcast.26291.0 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.3830.0), metadata={scheduling_name="bitcast.26291.0"}
  %all-to-all-start.12 = ((bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26291.0), calls=%async_computation.13, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all-start.12"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %partition-id.14.0 = u32[] partition-id(), metadata={scheduling_name="partition-id.14.0"}
  %loop_compare_dynamic_slice_fusion = (pred[1]{0}, s32[1]{0}) fusion(%constant_3042_0, %partition-id.14.0), kind=kLoop, calls=%fused_compare_dynamic_slice, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="loop_compare_dynamic_slice_fusion"}
  %copy.1049 = s32[] copy(%constant_2984_0)
  %input_slice_fusion.1 = (s32[9]{0}, s32[65536]{0}) fusion(%constant_3031_0, %partition-id.14.0), kind=kInput, calls=%fused_slice.5, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="input_slice_fusion.1"}
  %get-tuple-element.4424 = s32[1]{0} get-tuple-element(%loop_compare_dynamic_slice_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="get-tuple-element.4424"}
  %input_slice_fusion.2 = (u32[72]{0}, u32[65536]{0}) fusion(%get-tuple-element.4424, %constant_3031_0, %partition-id.14.0), kind=kInput, calls=%fused_slice.6, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="input_slice_fusion.2"}
  %copy.734 = s32[] copy(%copy.1049), metadata={scheduling_name="copy.734"}
  %get-tuple-element.4269 = u32[72]{0} get-tuple-element(%input_slice_fusion.2), index=0, metadata={scheduling_name="get-tuple-element.4269"}
  %bitcast.32284 = u32[9,2,4]{2,1,0} bitcast(%get-tuple-element.4269), metadata={scheduling_name="bitcast.32284"}
  %copy.745 = u32[9,2,4]{2,1,0} copy(%bitcast.32284), metadata={scheduling_name="copy.745"}
  %input_transpose_fusion.9 = bf16[2,768,6144]{2,1,0} fusion(%param.14), kind=kInput, calls=%fused_transpose.23, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_0\'][\'self_attention\'][\'out\'][\'kernel\']" deduplicated_name="input_transpose_fusion.8" scheduling_name="input_transpose_fusion.9"}
  %loop_compare_fusion.12 = pred[1]{0} fusion(%get-tuple-element.4424), kind=kLoop, calls=%fused_compare.12, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 scheduling_name="loop_compare_fusion.12"}
  %wrapped_iota.1 = s32[1,1,1,1,8]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1179 scheduling_name="wrapped_iota.1"}
  %loop_power_fusion.1 = f32[64]{0} fusion(), kind=kLoop, calls=%fused_power.1, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/self_attention/pow" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=273 deduplicated_name="loop_power_fusion" scheduling_name="loop_power_fusion.1"}
  %all-to-all-done.12 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.12), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="all-to-all-done.12"}
  %all-gather-start.2 = (s32[8,8192]{1,0}, s32[256,8192]{1,0}) all-gather-start(%param.11), channel_id=4, replica_groups=[1,32]<=[32], dimensions={0}, use_global_device_ids=true, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=641 scheduling_name="all-gather-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_iota.2 = s32[1,1,1,1,2049]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation.2, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/jit(_one_hot)/iota" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1161 scheduling_name="wrapped_iota.2"}
  %wrapped_iota = s32[1,1,4,8192,2]{4,3,2,1,0} fusion(), kind=kLoop, calls=%wrapped_iota_computation, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_1/MoeBlock_0/broadcast_in_dim" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="wrapped_iota"}
  %loop_broadcast_fusion.17 = (f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.17, metadata={scheduling_name="loop_broadcast_fusion.17"}
  %loop_broadcast_fusion.7 = (bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=97 scheduling_name="loop_broadcast_fusion.7"}
  %loop_broadcast_fusion.8 = (bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.8, metadata={scheduling_name="loop_broadcast_fusion.8"}
  %input_transpose_fusion.8 = bf16[2,768,6144]{2,1,0} fusion(%param.24), kind=kInput, calls=%fused_transpose.22, metadata={op_name="state.params[\'params\'][\'decoder\'][\'pipeline_module\'][\'layers\'][\'layers_1\'][\'self_attention\'][\'out\'][\'kernel\']" deduplicated_name="input_transpose_fusion.8" scheduling_name="input_transpose_fusion.8"}
  %all-gather-done.2 = s32[256,8192]{1,0} all-gather-done(%all-gather-start.2), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/sharding_constraint" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=641 scheduling_name="all-gather-done.2"}
  %bitcast.26295.0 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} bitcast(%all-to-all-done.12), metadata={scheduling_name="bitcast.26295.0"}
  %collective-permute-start.7 = (bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}, bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}) collective-permute-start(%bitcast.26295.0), channel_id=3, source_target_pairs={{0,0},{8,1},{1,2},{9,3},{2,4},{10,5},{3,6},{11,7},{4,8},{12,9},{5,10},{13,11},{6,12},{14,13},{7,14},{15,15},{16,16},{24,17},{17,18},{25,19},{18,20},{26,21},{19,22},{27,23},{20,24},{28,25},{21,26},{29,27},{22,28},{30,29},{23,30},{31,31}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="collective-permute-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.11 = (bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.11, metadata={scheduling_name="loop_broadcast_fusion.11"}
  %loop_broadcast_fusion.10 = (bf16[9,1,4,8192,6144]{4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.10, metadata={scheduling_name="loop_broadcast_fusion.10"}
  %get-tuple-element.4252 = pred[1]{0} get-tuple-element(%loop_compare_dynamic_slice_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/eq" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 scheduling_name="get-tuple-element.4252"}
  %loop_broadcast_fusion.6 = pred[1,4,8192,6144]{3,2,1,0} fusion(%get-tuple-element.4252), kind=kLoop, calls=%fused_broadcast.6, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_iteration_inputs/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=193 deduplicated_name="loop_broadcast_fusion.5" scheduling_name="loop_broadcast_fusion.6"}
  %loop_broadcast_fusion.5 = pred[1,4,8192,6144]{3,2,1,0} fusion(%loop_compare_fusion.12), kind=kLoop, calls=%fused_broadcast.5, metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/pipeline_module.get_new_loop_state/iota" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=349 deduplicated_name="loop_broadcast_fusion.5" scheduling_name="loop_broadcast_fusion.5"}
  %loop_dynamic_slice_fusion.26 = s32[4,4,8192]{2,1,0} fusion(%all-gather-done.2, %constant_3047_0, %partition-id.14.0), kind=kLoop, calls=%fused_dynamic_slice.26, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=643 scheduling_name="loop_dynamic_slice_fusion.26"}
  %collective-permute-done.7 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} collective-permute-done(%collective-permute-start.7), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.init_states/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=119 scheduling_name="collective-permute-done.7"}
  %bitcast.26353.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.9), metadata={scheduling_name="bitcast.26353.0"}
  %bitcast.26357.0 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param.10), metadata={scheduling_name="bitcast.26357.0"}
  %bitcast.26396.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.12), metadata={scheduling_name="bitcast.26396.0"}
  %bitcast.26400.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.13), metadata={scheduling_name="bitcast.26400.0"}
  %bitcast.26411.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.15), metadata={scheduling_name="bitcast.26411.0"}
  %bitcast.26415.0 = bf16[1,2,768,8]{3,2,1,0} bitcast(%param.16), metadata={scheduling_name="bitcast.26415.0"}
  %bitcast.26449.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.17), metadata={scheduling_name="bitcast.26449.0"}
  %bitcast.26453.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.18), metadata={scheduling_name="bitcast.26453.0"}
  %bitcast.26457.0 = bf16[1,2,1,16384,6144]{4,3,2,1,0} bitcast(%param.19), metadata={scheduling_name="bitcast.26457.0"}
  %bitcast.26461.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.20), metadata={scheduling_name="bitcast.26461.0"}
  %bitcast.26465.0 = bf16[1,2,768,48,128]{4,3,2,1,0} bitcast(%param.21), metadata={scheduling_name="bitcast.26465.0"}
  %bitcast.26469.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.22), metadata={scheduling_name="bitcast.26469.0"}
  %bitcast.26473.0 = bf16[1,2,768,8,128]{4,3,2,1,0} bitcast(%param.23), metadata={scheduling_name="bitcast.26473.0"}
  %bitcast.26484.0 = bf16[1,2,6144]{2,1,0} bitcast(%param.25), metadata={scheduling_name="bitcast.26484.0"}
  %bitcast.26488.0 = bf16[1,2,768,8]{3,2,1,0} bitcast(%param.26), metadata={scheduling_name="bitcast.26488.0"}
  %bitcast.26492.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.27), metadata={scheduling_name="bitcast.26492.0"}
  %bitcast.26496.0 = bf16[1,2,1,6144,16384]{4,3,2,1,0} bitcast(%param.28), metadata={scheduling_name="bitcast.26496.0"}
  %bitcast.26500.0 = bf16[1,2,1,16384,6144]{4,3,2,1,0} bitcast(%param.29), metadata={scheduling_name="bitcast.26500.0"}
  %bitcast.26392.0 = f32[1,1,1,1,64]{4,3,2,1,0} bitcast(%loop_power_fusion.1), metadata={scheduling_name="bitcast.26392.0"}
  %bitcast.26340.0 = s32[1,4,8192,2,1]{3,2,1,4,0} bitcast(%wrapped_iota), metadata={scheduling_name="bitcast.26340.0"}
  %get-tuple-element.4419 = s32[9]{0} get-tuple-element(%input_slice_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4419"}
  %get-tuple-element.4268 = s32[65536]{0} get-tuple-element(%input_slice_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4268"}
  %bitcast.26337.0 = s32[1,4,8192,2,1]{3,2,1,4,0} bitcast(%get-tuple-element.4268), metadata={scheduling_name="bitcast.26337.0"}
  %get-tuple-element.4270 = u32[65536]{0} get-tuple-element(%input_slice_fusion.2), index=1, metadata={scheduling_name="get-tuple-element.4270"}
  %bitcast.32285 = u32[1,4,8192,2]{3,2,1,0} bitcast(%get-tuple-element.4270), metadata={op_name="jit(train_step)/jit(main)/pipeline_module.run_iteration_scannable/pipeline_module.run_one_iteration/vmap(layers.func_to_vmap)/layers/layers_0/MoeBlock_0/add" source_file="/workspace/maxtext/MaxText/layers/moe.py" source_line=1000 scheduling_name="bitcast.32285"}
  %bitcast.26407.0 = bf16[1,2,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.9), metadata={scheduling_name="bitcast.26407.0"}
  %bitcast.26480.0 = bf16[1,2,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.8), metadata={scheduling_name="bitcast.26480.0"}
  %get-tuple-element.4869 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%loop_broadcast_fusion.17), index=0, metadata={scheduling_name="get-tuple-element.4869"}
  %get-tuple-element.4870 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%loop_broadcast_fusion.17), index=1, metadata={scheduling_name="get-tuple-element.4870"}
  %get-tuple-element.4866 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=3, metadata={scheduling_name="get-tuple-element.4866"}
  %get-tuple-element.4864 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.4864"}
  %get-tuple-element.4862 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.8), index=1, metadata={scheduling_name="get-tuple-element.4862"}
  %bitcast.26299.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} bitcast(%collective-permute-done.7), metadata={scheduling_name="bitcast.26299.0"}
  %get-tuple-element.4871 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.11), index=0, metadata={scheduling_name="get-tuple-element.4871"}
  %get-tuple-element.4872 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.11), index=1, metadata={scheduling_name="get-tuple-element.4872"}
  %get-tuple-element.4867 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.4867"}
  %get-tuple-element.4868 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.4868"}
  %tuple.665 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) tuple(%copy.734, %get-tuple-element.4862, %get-tuple-element.4866, %get-tuple-element.4864, %bitcast.26299.0, /*index=5*/%get-tuple-element.4867, %get-tuple-element.4869, %bitcast.32284, %get-tuple-element.4871, %get-tuple-element.4868, /*index=10*/%get-tuple-element.4870, %copy.745, %get-tuple-element.4872, %get-tuple-element.4419, %bitcast.26337.0, /*index=15*/%bitcast.26340.0, %loop_broadcast_fusion.6, %bitcast.26353.0, %get-tuple-element.4424, %bitcast.26357.0, /*index=20*/%loop_dynamic_slice_fusion.26, %bitcast.26392.0, %bitcast.26396.0, %bitcast.26400.0, %bitcast.26407.0, /*index=25*/%bitcast.26411.0, %bitcast.26415.0, %bitcast.32285, %wrapped_iota.1, %wrapped_iota.2, /*index=30*/%bitcast.26449.0, %bitcast.26453.0, %bitcast.26457.0, %bitcast.26461.0, %bitcast.26465.0, /*index=35*/%bitcast.26469.0, %bitcast.26473.0, %bitcast.26480.0, %bitcast.26484.0, %bitcast.26488.0, /*index=40*/%bitcast.26492.0, %bitcast.26496.0, %bitcast.26500.0, %loop_broadcast_fusion.5), metadata={scheduling_name="tuple.665"}
  %while.74 = (s32[], bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=5*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=10*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[1,4,8192,2,1]{3,2,1,4,0}, /*index=15*/s32[1,4,8192,2,1]{3,2,1,4,0}, pred[1,4,8192,6144]{3,2,1,0}, bf16[1,2,6144]{2,1,0}, s32[1]{0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=20*/s32[4,4,8192]{2,1,0}, f32[1,1,1,1,64]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, /*index=25*/bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, u32[1,4,8192,2]{3,2,1,0}, s32[1,1,1,1,8]{4,3,2,1,0}, s32[1,1,1,1,2049]{4,3,2,1,0}, /*index=30*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,48,128]{4,3,2,1,0}, /*index=35*/bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,768,8,128]{4,3,2,1,0}, bf16[1,2,48,128,768]{3,2,4,1,0}, bf16[1,2,6144]{2,1,0}, bf16[1,2,768,8]{3,2,1,0}, /*index=40*/bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,6144,16384]{4,3,2,1,0}, bf16[1,2,1,16384,6144]{4,3,2,1,0}, pred[1,4,8192,6144]{3,2,1,0}) while(%tuple.665), condition=%region_18.1706.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone, body=%region_0.1585.sunk.clone.sunk.clone.clone.clone.clone_spmd.clone.clone.clone.clone.clone.clone.clone, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="while.74"}, backend_config={"known_trip_count":{"n":"9"},"known_init_step":{"init":"0","step":"1"},"known_induction_variable":{"tuple_index":"0"}}
  %get-tuple-element.1353.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=4, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1353.0"}
  %loop_gather_fusion = bf16[2,1,1,4,8192,6144]{5,4,3,0,2,1} fusion(%constant_3089_0, %get-tuple-element.1353.0), kind=kLoop, calls=%fused_gather, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/gather" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="loop_gather_fusion"}
  %bitcast.26516.0 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} bitcast(%loop_gather_fusion), metadata={scheduling_name="bitcast.26516.0"}
  %all-to-all-start.15 = ((bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}), bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}) async-start(%bitcast.26516.0), calls=%async_computation.16, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all-start.15"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-to-all-done.15 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} async-done(%all-to-all-start.15), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="all-to-all-done.15"}
  %bitcast.26520.0 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} bitcast(%all-to-all-done.15), metadata={scheduling_name="bitcast.26520.0"}
  %collective-permute-start.10 = (bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}, bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}) collective-permute-start(%bitcast.26520.0), channel_id=129, source_target_pairs={{0,0},{2,1},{4,2},{6,3},{8,4},{10,5},{12,6},{14,7},{1,8},{3,9},{5,10},{7,11},{9,12},{11,13},{13,14},{15,15},{16,16},{18,17},{20,18},{22,19},{24,20},{26,21},{28,22},{30,23},{17,24},{19,25},{21,26},{23,27},{25,28},{27,29},{29,30},{31,31}}, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="collective-permute-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_reduce_fusion.65 = s32[256]{0} fusion(%param.30), kind=kInput, calls=%fused_reduce.65, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="input_reduce_fusion.65"}
  %input_reduce_fusion.70 = s32[] fusion(%input_reduce_fusion.65), kind=kInput, calls=%fused_reduce.70, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="input_reduce_fusion.70"}
  %collective-permute-done.10 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} collective-permute-done(%collective-permute-start.10), metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="collective-permute-done.10"}
  %all-reduce-start = s32[] all-reduce-start(%input_reduce_fusion.70), channel_id=130, replica_groups=[1,32]<=[32], use_global_device_ids=true, to_apply=%region_24.1883.clone, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="all-reduce-start"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_reduce_fusion.66 = f32[8,8192]{1,0} fusion(%collective-permute-done.10), kind=kInput, calls=%fused_reduce.66, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="input_reduce_fusion.66"}
  %loop_rsqrt_fusion.8 = f32[1,8,8192]{2,1,0} fusion(%input_reduce_fusion.66), kind=kLoop, calls=%fused_rsqrt.8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/decoder_norm/rsqrt" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="loop_rsqrt_fusion.8"}
  %loop_convert_fusion.18 = bf16[8,8192,6144]{2,1,0} fusion(%loop_rsqrt_fusion.8, %collective-permute-done.10, %param.5), kind=kLoop, calls=%fused_convert.18, metadata={scheduling_name="loop_convert_fusion.18"}
  %get-tuple-element.4292 = bf16[6144,32768]{1,0} get-tuple-element(%all-gather-done.3), index=1, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.4292"}
  %bitcast.26588.0 = bf16[65536,6144]{1,0} bitcast(%loop_convert_fusion.18), metadata={scheduling_name="bitcast.26588.0"}
  %custom-call.1189 = (bf16[65536,32768]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26588.0, %get-tuple-element.4292), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1189"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %get-tuple-element.3831.0 = bf16[65536,32768]{1,0} get-tuple-element(%custom-call.1189), index=0, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3831.0"}
  %input_reduce_fusion.64 = f32[65536,128]{1,0} fusion(%get-tuple-element.3831.0), kind=kInput, calls=%fused_reduce.64, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="input_reduce_fusion.64"}
  %input_reduce_fusion.122 = f32[65536]{0} fusion(%input_reduce_fusion.64), kind=kInput, calls=%fused_reduce.122, metadata={op_name="jit(train_step)/jit(main)/reduce_max" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=610 scheduling_name="input_reduce_fusion.122"}
  %input_reduce_fusion.63 = f32[8,8192,128]{2,1,0} fusion(%input_reduce_fusion.122, %get-tuple-element.3831.0), kind=kInput, calls=%fused_reduce.63, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 scheduling_name="input_reduce_fusion.63"}
  %input_reduce_fusion.81 = f32[8,8192]{1,0} fusion(%input_reduce_fusion.63), kind=kInput, calls=%fused_reduce.81, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=613 deduplicated_name="input_reduce_fusion.81" scheduling_name="input_reduce_fusion.81"}
  %loop_add_log_fusion = (f32[8,8192]{1,0}, f32[8,8192]{1,0}) fusion(%input_reduce_fusion.122, %input_reduce_fusion.81), kind=kLoop, calls=%fused_add_log, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="loop_add_log_fusion"}
  %all-reduce-done = s32[] all-reduce-done(%all-reduce-start), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=307 scheduling_name="all-reduce-done"}
  %loop_select_fusion.2 = f32[8,8192]{1,0} fusion(%all-reduce-done, %param.30), kind=kLoop, calls=%fused_select.2, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=305 scheduling_name="loop_select_fusion.2"}
  %get-tuple-element.4251 = f32[8,8192]{1,0} get-tuple-element(%loop_add_log_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="get-tuple-element.4251"}
  %get-tuple-element.4250 = f32[8,8192]{1,0} get-tuple-element(%loop_add_log_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=302 scheduling_name="get-tuple-element.4250"}
  %input_convert_reduce_fusion.8 = (bf16[8,8192,32768]{2,1,0}, f32[8,8192,128]{2,1,0}) fusion(%loop_select_fusion.2, %input_reduce_fusion.81, %input_reduce_fusion.122, %get-tuple-element.3831.0, %get-tuple-element.4250, /*index=5*/%param.32, %get-tuple-element.4251), kind=kInput, calls=%fused_convert_reduce.8, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="input_convert_reduce_fusion.8"}
  %get-tuple-element.4248 = bf16[8,8192,32768]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.8), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="get-tuple-element.4248"}
  %bitcast.26684.0 = bf16[65536,32768]{1,0} bitcast(%get-tuple-element.4248), metadata={scheduling_name="bitcast.26684.0"}
  %custom-call.1190 = (bf16[65536,6144]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26684.0, %get-tuple-element.4292), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1190"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["1"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"201326592","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %loop_convert_fusion.19 = f32[] fusion(), kind=kLoop, calls=%fused_convert.19, metadata={scheduling_name="loop_convert_fusion.19"}
  %get-tuple-element.3832.0 = bf16[65536,6144]{1,0} get-tuple-element(%custom-call.1190), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/dot_general" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3832.0"}
  %input_reduce_fusion.67 = f32[8,8192]{1,0} fusion(%get-tuple-element.3832.0, %collective-permute-done.10, %param.5), kind=kInput, calls=%fused_reduce.67, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=61 scheduling_name="input_reduce_fusion.67"}
  %loop_multiply_fusion.6 = f32[1,8,8192]{2,1,0} fusion(%loop_rsqrt_fusion.8, %input_reduce_fusion.67, %input_reduce_fusion.66), kind=kLoop, calls=%fused_multiply.6, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/mul" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=60 scheduling_name="loop_multiply_fusion.6"}
  %input_convert_reduce_fusion.9 = (bf16[8,8192,6144]{2,1,0}, f32[256,6144]{1,0}) fusion(%loop_rsqrt_fusion.8, %get-tuple-element.3832.0, %collective-permute-done.10, %loop_multiply_fusion.6, %param.5, /*index=5*/%loop_convert_fusion.19), kind=kInput, calls=%fused_convert_reduce.9, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="input_convert_reduce_fusion.9"}
  %get-tuple-element.4246 = bf16[8,8192,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.9), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="get-tuple-element.4246"}
  %bitcast.26827.0 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} bitcast(%get-tuple-element.4246), metadata={scheduling_name="bitcast.26827.0"}
  %all-to-all-start.13 = ((bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}), bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3}) async-start(%bitcast.26827.0), calls=%async_computation.14, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all-start.13"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-to-all-done.13 = bf16[1,1,1,2,4,8192,6144]{6,5,4,2,1,0,3} async-done(%all-to-all-start.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="all-to-all-done.13"}
  %bitcast.26831.0 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} bitcast(%all-to-all-done.13), metadata={scheduling_name="bitcast.26831.0"}
  %collective-permute-start.8 = (bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}, bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0}) collective-permute-start(%bitcast.26831.0), channel_id=147, source_target_pairs={{0,0},{8,1},{1,2},{9,3},{2,4},{10,5},{3,6},{11,7},{4,8},{12,9},{5,10},{13,11},{6,12},{14,13},{7,14},{15,15},{16,16},{24,17},{17,18},{25,19},{18,20},{26,21},{19,22},{27,23},{20,24},{28,25},{21,26},{29,27},{22,28},{30,29},{23,30},{31,31}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="collective-permute-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %input_slice_fusion = (bf16[12288]{0}, bf16[12288]{0}) fusion(), kind=kInput, calls=%fused_slice.4, metadata={scheduling_name="input_slice_fusion"}
  %get-tuple-element.4265 = bf16[12288]{0} get-tuple-element(%input_slice_fusion), index=0, metadata={scheduling_name="get-tuple-element.4265"}
  %bitcast.32281 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4265), metadata={scheduling_name="bitcast.32281"}
  %get-tuple-element.4266 = bf16[12288]{0} get-tuple-element(%input_slice_fusion), index=1, metadata={scheduling_name="get-tuple-element.4266"}
  %bitcast.32282 = bf16[2,1,768,8]{3,2,1,0} bitcast(%get-tuple-element.4266), metadata={scheduling_name="bitcast.32282"}
  %copy_fusion.2 = (bf16[12288]{0}, bf16[12288]{0}) fusion(%bitcast.32281, %bitcast.32282), kind=kInput, calls=%copy_horizontally_fused_computation.2, metadata={scheduling_name="copy_fusion.2"}
  %copy_fusion.1 = (bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}) fusion(%bitcast.32281), kind=kLoop, calls=%copy_horizontally_fused_computation.1, metadata={scheduling_name="copy_fusion.1"}
  %loop_broadcast_fusion.13 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.13, metadata={scheduling_name="loop_broadcast_fusion.13"}
  %get-tuple-element.4247 = f32[256,6144]{1,0} get-tuple-element(%input_convert_reduce_fusion.9), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=59 scheduling_name="get-tuple-element.4247"}
  %input_reduce_fusion.69 = bf16[6144]{0} fusion(%get-tuple-element.4247, %loop_convert_fusion.19), kind=kInput, calls=%fused_reduce.69, metadata={scheduling_name="input_reduce_fusion.69"}
  %collective-permute-done.8 = bf16[1,2,1,4,8192,6144]{5,4,3,1,2,0} collective-permute-done(%collective-permute-start.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="collective-permute-done.8"}
  %all-reduce-start.1 = bf16[6144]{0} all-reduce-start(%input_reduce_fusion.69), channel_id=132, replica_groups=[1,32]<=[32], use_global_device_ids=true, to_apply=%region_25.1918.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="all-reduce-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_broadcast_fusion.15 = (bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.15, metadata={scheduling_name="loop_broadcast_fusion.15"}
  %loop_broadcast_fusion.12 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.12, metadata={scheduling_name="loop_broadcast_fusion.12"}
  %loop_broadcast_fusion.9 = bf16[2,1,4,8192,6144]{4,3,2,1,0} fusion(), kind=kLoop, calls=%fused_broadcast.9, metadata={scheduling_name="loop_broadcast_fusion.9"}
  %loop_broadcast_fusion.16 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.16, metadata={scheduling_name="loop_broadcast_fusion.16"}
  %loop_broadcast_fusion.14 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}) fusion(), kind=kLoop, calls=%fused_broadcast.14, metadata={scheduling_name="loop_broadcast_fusion.14"}
  %get-tuple-element.4249 = f32[8,8192,128]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.8), index=1, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/convert_element_type" source_file="/workspace/maxtext/MaxText/layers/decoders.py" source_line=583 scheduling_name="get-tuple-element.4249"}
  %input_reduce_fusion.116 = f32[8,8192]{1,0} fusion(%get-tuple-element.4249), kind=kInput, calls=%fused_reduce.116, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=615 deduplicated_name="input_reduce_fusion.81" scheduling_name="input_reduce_fusion.116"}
  %input_reduce_fusion.27 = f32[256]{0} fusion(%get-tuple-element.4251, %input_reduce_fusion.122, %input_reduce_fusion.116, %param.30), kind=kInput, calls=%fused_reduce.27, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="input_reduce_fusion.27"}
  %input_reduce_fusion.119 = f32[] fusion(%input_reduce_fusion.27), kind=kInput, calls=%fused_reduce.119, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="input_reduce_fusion.119"}
  %input_scatter_fusion.10 = bf16[2,1,4,8192,6144]{4,3,2,1,0} fusion(%loop_broadcast_fusion.9, %constant_3089_0, %collective-permute-done.8), kind=kInput, calls=%fused_scatter.10, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/pipeline_module.permute_output_micro_per_stage_dim/scatter-add" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=374 scheduling_name="input_scatter_fusion.10"}
  %all-reduce-done.1 = bf16[6144]{0} all-reduce-done(%all-reduce-start.1), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/decoder_norm/reduce_sum" source_file="/workspace/maxtext/MaxText/layers/normalizations.py" source_line=69 scheduling_name="all-reduce-done.1"}
  %get-tuple-element.4892 = bf16[12288]{0} get-tuple-element(%copy_fusion.2), index=0, metadata={scheduling_name="get-tuple-element.4892"}
  %bitcast.32549 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4892), metadata={scheduling_name="bitcast.32549"}
  %get-tuple-element.4893 = bf16[12288]{0} get-tuple-element(%copy_fusion.2), index=1, metadata={scheduling_name="get-tuple-element.4893"}
  %bitcast.32550 = bf16[2,1,768,8]{3,2,1,0} bitcast(%get-tuple-element.4893), metadata={scheduling_name="bitcast.32550"}
  %get-tuple-element.4890 = bf16[2,1,6144]{2,1,0} get-tuple-element(%copy_fusion.1), index=0, metadata={scheduling_name="get-tuple-element.4890"}
  %bitcast.32547 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4890), metadata={scheduling_name="bitcast.32547"}
  %get-tuple-element.4891 = bf16[2,1,6144]{2,1,0} get-tuple-element(%copy_fusion.1), index=1, metadata={scheduling_name="get-tuple-element.4891"}
  %bitcast.32548 = bf16[2,1,6144]{2,1,0} bitcast(%get-tuple-element.4891), metadata={scheduling_name="bitcast.32548"}
  %get-tuple-element.4882 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=3, metadata={scheduling_name="get-tuple-element.4882"}
  %get-tuple-element.4881 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=2, metadata={scheduling_name="get-tuple-element.4881"}
  %get-tuple-element.4879 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.4879"}
  %get-tuple-element.4880 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.4880"}
  %bitcast.26876.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.9), metadata={scheduling_name="bitcast.26876.0"}
  %bitcast.26898.0 = bf16[2,1,48,128,768]{3,2,4,1,0} bitcast(%input_transpose_fusion.8), metadata={scheduling_name="bitcast.26898.0"}
  %get-tuple-element.4883 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%loop_broadcast_fusion.15), index=0, metadata={scheduling_name="get-tuple-element.4883"}
  %get-tuple-element.4884 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%loop_broadcast_fusion.15), index=1, metadata={scheduling_name="get-tuple-element.4884"}
  %get-tuple-element.4885 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.12), index=0, metadata={scheduling_name="get-tuple-element.4885"}
  %get-tuple-element.4886 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.12), index=1, metadata={scheduling_name="get-tuple-element.4886"}
  %get-tuple-element.4877 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.4877"}
  %get-tuple-element.4878 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.4878"}
  %get-tuple-element.4876 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=3, metadata={scheduling_name="get-tuple-element.4876"}
  %get-tuple-element.4875 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=2, metadata={scheduling_name="get-tuple-element.4875"}
  %get-tuple-element.4873 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=0, metadata={scheduling_name="get-tuple-element.4873"}
  %get-tuple-element.4874 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.14), index=1, metadata={scheduling_name="get-tuple-element.4874"}
  %get-tuple-element.4863 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.4863"}
  %get-tuple-element.4865 = bf16[1,4,8192,6144]{3,2,1,0} get-tuple-element(%loop_broadcast_fusion.7), index=2, metadata={scheduling_name="get-tuple-element.4865"}
  %get-tuple-element.4861 = bf16[1,4,4,8192,6144]{4,3,2,1,0} get-tuple-element(%loop_broadcast_fusion.8), index=0, metadata={scheduling_name="get-tuple-element.4861"}
  %get-tuple-element.4567 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=9, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4567"}
  %get-tuple-element.4566 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%while.74), index=8, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4566"}
  %get-tuple-element.4565 = u32[9,2,4]{2,1,0} get-tuple-element(%while.74), index=7, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4565"}
  %get-tuple-element.4564 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%while.74), index=6, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4564"}
  %get-tuple-element.4563 = bf16[9,1,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.74), index=5, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4563"}
  %get-tuple-element.4571 = s32[9]{0} get-tuple-element(%while.74), index=13, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4571"}
  %get-tuple-element.4570 = bf16[9,1,4,8192,48,128]{5,4,3,2,1,0} get-tuple-element(%while.74), index=12, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4570"}
  %get-tuple-element.4569 = u32[9,2,4]{2,1,0} get-tuple-element(%while.74), index=11, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4569"}
  %get-tuple-element.4568 = f32[9,1,4,48,8192,1]{4,3,2,5,1,0} get-tuple-element(%while.74), index=10, metadata={op_name="jit(train_step)/jit(main)/jvp(Transformer)/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.4568"}
  %bitcast.26838.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} bitcast(%input_scatter_fusion.10), metadata={scheduling_name="bitcast.26838.0"}
  %tuple.668 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) tuple(%copy.1049, %bitcast.32282, %get-tuple-element.4873, %get-tuple-element.4875, %get-tuple-element.4877, /*index=5*/%bitcast.32281, %bitcast.32549, %get-tuple-element.4879, %get-tuple-element.4883, %get-tuple-element.4885, /*index=10*/%get-tuple-element.4881, %bitcast.32550, %get-tuple-element.4876, %get-tuple-element.4874, %get-tuple-element.4878, /*index=15*/%bitcast.32547, %bitcast.32548, %get-tuple-element.4882, %get-tuple-element.4884, %get-tuple-element.4886, /*index=20*/%get-tuple-element.4880, %get-tuple-element.4861, %get-tuple-element.4863, %get-tuple-element.4865, %bitcast.26838.0, /*index=25*/%get-tuple-element.4563, %get-tuple-element.4564, %get-tuple-element.4565, %get-tuple-element.4566, %get-tuple-element.4567, /*index=30*/%get-tuple-element.4568, %get-tuple-element.4569, %get-tuple-element.4570, %get-tuple-element.4571, %loop_dynamic_slice_fusion.26, /*index=35*/%param.16, %param.17, %param.18, %param.19, %param.15, /*index=40*/%param.9, %param.12, %bitcast.26876.0, %param.10, %param.13, /*index=45*/%param.26, %param.27, %param.28, %param.29, %param.25, /*index=50*/%param.20, %param.22, %bitcast.26898.0, %param.21, %param.23), metadata={scheduling_name="tuple.668"}
  %while.75 = (s32[], bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=5*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, /*index=15*/bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[1,4,4,8192,6144]{4,3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,4,8192,6144]{3,2,1,0}, bf16[1,2,4,8192,6144]{4,3,2,1,0}, /*index=25*/bf16[9,1,4,8192,6144]{4,3,2,1,0}, f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, bf16[9,1,4,8192,6144]{4,3,2,1,0}, /*index=30*/f32[9,1,4,48,8192,1]{4,3,2,5,1,0}, u32[9,2,4]{2,1,0}, bf16[9,1,4,8192,48,128]{5,4,3,2,1,0}, s32[9]{0}, s32[4,4,8192]{2,1,0}, /*index=35*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=40*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=50*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{3,2,4,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}) while(%tuple.668), condition=%region_97.4035_spmd, body=%region_30.3928_spmd, metadata={scheduling_name="while.75"}, backend_config={"known_trip_count":{"n":"9"},"known_init_step":{"init":"0","step":"1"},"known_induction_variable":{"tuple_index":"0"}}
  %all-reduce-start.4 = f32[] all-reduce-start(%input_reduce_fusion.119), channel_id=453, replica_groups=[1,32]<=[32], use_global_device_ids=true, to_apply=%region_23.1876.clone, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="all-reduce-start.4"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3576.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=16, metadata={scheduling_name="get-tuple-element.3576.0"}
  %bitcast.32408 = bf16[12288]{0} bitcast(%get-tuple-element.3576.0), metadata={scheduling_name="bitcast.32408"}
  %get-tuple-element.3575.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=15, metadata={scheduling_name="get-tuple-element.3575.0"}
  %bitcast.32409 = bf16[12288]{0} bitcast(%get-tuple-element.3575.0), metadata={scheduling_name="bitcast.32409"}
  %get-tuple-element.3566.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=6, metadata={scheduling_name="get-tuple-element.3566.0"}
  %bitcast.32410 = bf16[12288]{0} bitcast(%get-tuple-element.3566.0), metadata={scheduling_name="bitcast.32410"}
  %get-tuple-element.3565.0 = bf16[2,1,6144]{2,1,0} get-tuple-element(%while.75), index=5, metadata={scheduling_name="get-tuple-element.3565.0"}
  %bitcast.32411 = bf16[12288]{0} bitcast(%get-tuple-element.3565.0), metadata={scheduling_name="bitcast.32411"}
  %wrapped_concatenate.5 = bf16[49152]{0} fusion(%bitcast.32408, %bitcast.32409, %bitcast.32410, %bitcast.32411), kind=kLoop, calls=%wrapped_concatenate_computation.5, metadata={scheduling_name="wrapped_concatenate.5"}
  %all-reduce-done.4 = f32[] all-reduce-done(%all-reduce-start.4), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/train.py" source_line=306 scheduling_name="all-reduce-done.4"}
  %all-reduce-start.17 = bf16[49152]{0} all-reduce-start(%wrapped_concatenate.5), channel_id=609, replica_groups=[2,16]<=[32], use_global_device_ids=true, to_apply=%region_59.2325.clone, metadata={scheduling_name="all-reduce-start.17"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3568.0 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%while.75), index=8, metadata={scheduling_name="get-tuple-element.3568.0"}
  %input_transpose_fusion.7 = bf16[2,6144,768]{2,1,0} fusion(%get-tuple-element.3568.0), kind=kInput, calls=%fused_transpose.21, metadata={deduplicated_name="input_transpose_fusion.6" scheduling_name="input_transpose_fusion.7"}
  %get-tuple-element.3567.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=7, metadata={scheduling_name="get-tuple-element.3567.0"}
  %bitcast.32403 = bf16[1572864]{0} bitcast(%get-tuple-element.3567.0), metadata={scheduling_name="bitcast.32403"}
  %get-tuple-element.3561.0 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%while.75), index=1, metadata={scheduling_name="get-tuple-element.3561.0"}
  %bitcast.32404 = bf16[12288]{0} bitcast(%get-tuple-element.3561.0), metadata={scheduling_name="bitcast.32404"}
  %bitcast.32402 = bf16[9437184]{0} bitcast(%input_transpose_fusion.7), metadata={scheduling_name="bitcast.32402"}
  %wrapped_concatenate.3 = bf16[11022336]{0} fusion(%bitcast.32402, %bitcast.32403, %bitcast.32404), kind=kLoop, calls=%wrapped_concatenate_computation.3, metadata={scheduling_name="wrapped_concatenate.3"}
  %all-reduce-done.17 = bf16[49152]{0} all-reduce-done(%all-reduce-start.17), metadata={scheduling_name="all-reduce-done.17"}
  %all-reduce-start.16 = bf16[11022336]{0} all-reduce-start(%wrapped_concatenate.3), channel_id=601, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.10.clone, metadata={scheduling_name="all-reduce-start.16"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.16 = bf16[11022336]{0} all-reduce-done(%all-reduce-start.16), metadata={scheduling_name="all-reduce-done.16"}
  %get-tuple-element.3569.0 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%while.75), index=9, metadata={scheduling_name="get-tuple-element.3569.0"}
  %all-reduce-start.8 = bf16[2,1,768,48,128]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3569.0), channel_id=602, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.12.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.8"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3578.0 = bf16[2,1,48,128,768]{3,2,4,1,0} get-tuple-element(%while.75), index=18, metadata={scheduling_name="get-tuple-element.3578.0"}
  %input_transpose_fusion.6 = bf16[2,6144,768]{2,1,0} fusion(%get-tuple-element.3578.0), kind=kInput, calls=%fused_transpose.20, metadata={deduplicated_name="input_transpose_fusion.6" scheduling_name="input_transpose_fusion.6"}
  %get-tuple-element.3577.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=17, metadata={scheduling_name="get-tuple-element.3577.0"}
  %bitcast.32395 = bf16[1572864]{0} bitcast(%get-tuple-element.3577.0), metadata={scheduling_name="bitcast.32395"}
  %get-tuple-element.3571.0 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%while.75), index=11, metadata={scheduling_name="get-tuple-element.3571.0"}
  %bitcast.32396 = bf16[12288]{0} bitcast(%get-tuple-element.3571.0), metadata={scheduling_name="bitcast.32396"}
  %get-tuple-element.3570.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=10, metadata={scheduling_name="get-tuple-element.3570.0"}
  %bitcast.32397 = bf16[1572864]{0} bitcast(%get-tuple-element.3570.0), metadata={scheduling_name="bitcast.32397"}
  %bitcast.32394 = bf16[9437184]{0} bitcast(%input_transpose_fusion.6), metadata={scheduling_name="bitcast.32394"}
  %wrapped_concatenate.2 = bf16[12595200]{0} fusion(%bitcast.32394, %bitcast.32395, %bitcast.32396, %bitcast.32397), kind=kLoop, calls=%wrapped_concatenate_computation.2, metadata={scheduling_name="wrapped_concatenate.2"}
  %all-reduce-done.8 = bf16[2,1,768,48,128]{4,3,2,1,0} all-reduce-done(%all-reduce-start.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.8"}
  %all-reduce-start.15 = bf16[12595200]{0} all-reduce-start(%wrapped_concatenate.2), channel_id=611, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.23.clone, metadata={scheduling_name="all-reduce-start.15"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %get-tuple-element.3580.0 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%while.75), index=20, metadata={scheduling_name="get-tuple-element.3580.0"}
  %bitcast.32326 = bf16[1572864]{0} bitcast(%get-tuple-element.3580.0), metadata={scheduling_name="bitcast.32326"}
  %get-tuple-element.3579.0 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%while.75), index=19, metadata={scheduling_name="get-tuple-element.3579.0"}
  %bitcast.32327 = bf16[9437184]{0} bitcast(%get-tuple-element.3579.0), metadata={scheduling_name="bitcast.32327"}
  %wrapped_concatenate.1 = bf16[11010048]{0} fusion(%bitcast.32326, %bitcast.32327), kind=kLoop, calls=%wrapped_concatenate_computation.1, metadata={scheduling_name="wrapped_concatenate.1"}
  %all-reduce-done.15 = bf16[12595200]{0} all-reduce-done(%all-reduce-start.15), metadata={scheduling_name="all-reduce-done.15"}
  %all-reduce-start.13 = bf16[11010048]{0} all-reduce-start(%wrapped_concatenate.1), channel_id=613, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.27.clone, metadata={scheduling_name="all-reduce-start.13"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.13 = bf16[11010048]{0} all-reduce-done(%all-reduce-start.13), metadata={scheduling_name="all-reduce-done.13"}
  %get-tuple-element.3562.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=2, metadata={scheduling_name="get-tuple-element.3562.0"}
  %all-reduce-start.5 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3562.0), channel_id=595, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.4.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.5"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.5 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-done(%all-reduce-start.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.5"}
  %get-tuple-element.3563.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=3, metadata={scheduling_name="get-tuple-element.3563.0"}
  %all-reduce-start.6 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3563.0), channel_id=596, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.5.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.6"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.6 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-done(%all-reduce-start.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.6"}
  %get-tuple-element.3564.0 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=4, metadata={scheduling_name="get-tuple-element.3564.0"}
  %all-reduce-start.7 = bf16[2,1,1,16384,6144]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3564.0), channel_id=597, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.6.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.7"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.7 = bf16[2,1,1,16384,6144]{4,3,2,1,0} all-reduce-done(%all-reduce-start.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.7"}
  %get-tuple-element.3572.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=12, metadata={scheduling_name="get-tuple-element.3572.0"}
  %all-reduce-start.9 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3572.0), channel_id=605, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.17.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":true,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %all-reduce-done.9 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-done(%all-reduce-start.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.9"}
  %get-tuple-element.3573.0 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%while.75), index=13, metadata={scheduling_name="get-tuple-element.3573.0"}
  %all-reduce-start.10 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3573.0), channel_id=606, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.18.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.10"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_multiply_fusion.7 = f32[] fusion(%param.6), kind=kLoop, calls=%fused_multiply.7, metadata={op_name="jit(train_step)/jit(main)/mul" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_multiply_fusion.7"}
  %loop_add_select_fusion = (s32[], s32[]) fusion(%param.4, %param.6), kind=kLoop, calls=%fused_add_select, metadata={scheduling_name="loop_add_select_fusion"}
  %all-reduce-done.10 = bf16[2,1,1,6144,16384]{4,3,2,1,0} all-reduce-done(%all-reduce-start.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.10"}
  %get-tuple-element.1383.0 = bf16[1,2,4,8192,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=24, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="get-tuple-element.1383.0"}
  %bitcast.27398.0 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} bitcast(%get-tuple-element.1383.0), metadata={scheduling_name="bitcast.27398.0"}
  %all-to-all-start.14 = ((bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}), bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1}) async-start(%bitcast.27398.0), calls=%async_computation.15, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all-start.14"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_select_subtract_fusion = (f32[], s32[]) fusion(%param.34), kind=kLoop, calls=%fused_select_subtract, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_select_subtract_fusion"}
  %wrapped_transpose.1 = bf16[768,32768]{1,0} fusion(%param.78), kind=kInput, calls=%wrapped_transpose_computation.1, metadata={op_name="state.opt_state[0].mu[\'params\'][\'token_embedder\'][\'embedding\']" scheduling_name="wrapped_transpose.1"}
  %copy.944 = bf16[32768,768]{1,0} copy(%param.79), metadata={scheduling_name="copy.944"}
  %get-tuple-element.4806 = s32[] get-tuple-element(%loop_select_subtract_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4806"}
  %loop_subtract_fusion = f32[] fusion(%get-tuple-element.4806), kind=kLoop, calls=%fused_subtract, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="loop_subtract_fusion"}
  %bitcast.26682.0 = bf16[6144,65536]{0,1} bitcast(%loop_convert_fusion.18), metadata={scheduling_name="bitcast.26682.0"}
  %custom-call.1191 = (bf16[6144,32768]{1,0}, s8[67108864]{0}) custom-call(%bitcast.26682.0, %bitcast.26684.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="custom-call.1191"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"402653184","rhs_stride":"2147483648","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %copy_fusion = (f32[], f32[], f32[]) fusion(%constant_3026_0, %all-reduce-done.4, %all-reduce-done), kind=kLoop, calls=%copy_horizontally_fused_computation, metadata={scheduling_name="copy_fusion"}
  %wrapped_slice.21 = bf16[12288]{0} fusion(%all-reduce-done.17), kind=kLoop, calls=%wrapped_slice_computation.21, metadata={scheduling_name="wrapped_slice.21"}
  %all-to-all-done.14 = bf16[1,2,1,1,4,8192,6144]{6,5,4,3,2,0,1} async-done(%all-to-all-start.14), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="all-to-all-done.14"}
  %get-tuple-element.3574.0 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%while.75), index=14, metadata={scheduling_name="get-tuple-element.3574.0"}
  %all-reduce-start.11 = bf16[2,1,1,16384,6144]{4,3,2,1,0} all-reduce-start(%get-tuple-element.3574.0), channel_id=607, replica_groups={{0,8},{1,9},{2,10},{3,11},{4,12},{5,13},{6,14},{7,15},{16,24},{17,25},{18,26},{19,27},{20,28},{21,29},{22,30},{23,31}}, use_global_device_ids=true, to_apply=%add.19.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-start.11"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.20 = bf16[12288]{0} fusion(%all-reduce-done.17), kind=kLoop, calls=%wrapped_slice_computation.20, metadata={scheduling_name="wrapped_slice.20"}
  %wrapped_slice.19 = bf16[12288]{0} fusion(%all-reduce-done.17), kind=kLoop, calls=%wrapped_slice_computation.19, metadata={scheduling_name="wrapped_slice.19"}
  %wrapped_slice.18 = bf16[12288]{0} fusion(%all-reduce-done.17), kind=kLoop, calls=%wrapped_slice_computation.18, metadata={scheduling_name="wrapped_slice.18"}
  %wrapped_slice.13 = bf16[12288]{0} fusion(%all-reduce-done.16), kind=kLoop, calls=%wrapped_slice_computation.13, metadata={scheduling_name="wrapped_slice.13"}
  %wrapped_slice.12 = bf16[1572864]{0} fusion(%all-reduce-done.16), kind=kLoop, calls=%wrapped_slice_computation.12, metadata={scheduling_name="wrapped_slice.12"}
  %all-reduce-done.11 = bf16[2,1,1,16384,6144]{4,3,2,1,0} all-reduce-done(%all-reduce-start.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="all-reduce-done.11"}
  %bitcast.27402.0 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} bitcast(%all-to-all-done.14), metadata={scheduling_name="bitcast.27402.0"}
  %collective-permute-start.9 = (bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}, bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0}) collective-permute-start(%bitcast.27402.0), channel_id=411, source_target_pairs={{0,0},{2,1},{4,2},{6,3},{8,4},{10,5},{12,6},{14,7},{1,8},{3,9},{5,10},{7,11},{9,12},{11,13},{13,14},{15,15},{16,16},{18,17},{20,18},{22,19},{24,20},{26,21},{28,22},{30,23},{17,24},{19,25},{21,26},{23,27},{25,28},{27,29},{29,30},{31,31}}, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="collective-permute-start.9"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.11 = bf16[9437184]{0} fusion(%all-reduce-done.16), kind=kLoop, calls=%wrapped_slice_computation.11, metadata={scheduling_name="wrapped_slice.11"}
  %bitcast.32415 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.21), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32415"}
  %input_reduce_fusion.54 = f32[] fusion(%bitcast.32415), kind=kInput, calls=%fused_reduce.54, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.54"}
  %bitcast.32414 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.20), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32414"}
  %input_reduce_fusion.53 = f32[] fusion(%bitcast.32414), kind=kInput, calls=%fused_reduce.53, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.53"}
  %bitcast.32412 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.18), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32412"}
  %input_reduce_fusion.40 = f32[] fusion(%bitcast.32412), kind=kInput, calls=%fused_reduce.40, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.40"}
  %bitcast.32413 = bf16[2,1,6144]{2,1,0} bitcast(%wrapped_slice.19), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32413"}
  %input_reduce_fusion.41 = f32[] fusion(%bitcast.32413), kind=kInput, calls=%fused_reduce.41, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.40" scheduling_name="input_reduce_fusion.41"}
  %bitcast.32407 = bf16[2,1,768,8]{3,2,1,0} bitcast(%wrapped_slice.13), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32407"}
  %input_reduce_fusion.61 = f32[] fusion(%bitcast.32407), kind=kInput, calls=%fused_reduce.61, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.48" scheduling_name="input_reduce_fusion.61"}
  %bitcast.32406 = bf16[2,1,768,8,128]{4,3,2,1,0} bitcast(%wrapped_slice.12), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32406"}
  %input_reduce_fusion.52 = f32[1024]{0} fusion(%bitcast.32406), kind=kInput, calls=%fused_reduce.52, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.52"}
  %input_reduce_fusion.87 = f32[] fusion(%input_reduce_fusion.52), kind=kInput, calls=%fused_reduce.87, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.87"}
  %bitcast.32405 = bf16[2,1,48,128,768]{4,3,2,1,0} bitcast(%wrapped_slice.11), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32405"}
  %input_reduce_fusion.51 = f32[2048]{0} fusion(%bitcast.32405), kind=kInput, calls=%fused_reduce.51, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.38" scheduling_name="input_reduce_fusion.51"}
  %input_reduce_fusion.88 = f32[] fusion(%input_reduce_fusion.51), kind=kInput, calls=%fused_reduce.88, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.88"}
  %bitcast.32419 = f32[1]{0} bitcast(%input_reduce_fusion.54), metadata={scheduling_name="bitcast.32419"}
  %bitcast.32423 = f32[1]{0} bitcast(%input_reduce_fusion.54), metadata={scheduling_name="bitcast.32423"}
  %bitcast.32418 = f32[1]{0} bitcast(%input_reduce_fusion.53), metadata={scheduling_name="bitcast.32418"}
  %bitcast.32422 = f32[1]{0} bitcast(%input_reduce_fusion.53), metadata={scheduling_name="bitcast.32422"}
  %bitcast.32416 = f32[1]{0} bitcast(%input_reduce_fusion.40), metadata={scheduling_name="bitcast.32416"}
  %bitcast.32420 = f32[1]{0} bitcast(%input_reduce_fusion.40), metadata={scheduling_name="bitcast.32420"}
  %bitcast.32417 = f32[1]{0} bitcast(%input_reduce_fusion.41), metadata={scheduling_name="bitcast.32417"}
  %bitcast.32421 = f32[1]{0} bitcast(%input_reduce_fusion.41), metadata={scheduling_name="bitcast.32421"}
  %wrapped_concatenate.6 = f32[8]{0} fusion(%bitcast.32416, %bitcast.32417, %bitcast.32418, %bitcast.32419, %bitcast.32420, /*index=5*/%bitcast.32421, %bitcast.32422, %bitcast.32423), kind=kLoop, calls=%wrapped_concatenate_computation.6, metadata={scheduling_name="wrapped_concatenate.6"}
  %wrapped_slice.9 = bf16[12288]{0} fusion(%all-reduce-done.15), kind=kLoop, calls=%wrapped_slice_computation.9, metadata={scheduling_name="wrapped_slice.9"}
  %wrapped_slice.10 = bf16[1572864]{0} fusion(%all-reduce-done.15), kind=kLoop, calls=%wrapped_slice_computation.10, metadata={scheduling_name="wrapped_slice.10"}
  %wrapped_slice.8 = bf16[1572864]{0} fusion(%all-reduce-done.15), kind=kLoop, calls=%wrapped_slice_computation.8, metadata={scheduling_name="wrapped_slice.8"}
  %collective-permute-done.9 = bf16[1,1,1,8,8192,6144]{5,4,3,2,1,0} collective-permute-done(%collective-permute-start.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/reshape" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=628 scheduling_name="collective-permute-done.9"}
  %all-reduce-start.18 = f32[8]{0} all-reduce-start(%wrapped_concatenate.6), channel_id=401, replica_groups=[16,2]<=[2,16]T(1,0), use_global_device_ids=true, to_apply=%region_115.4279.clone, metadata={scheduling_name="all-reduce-start.18"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.7 = bf16[9437184]{0} fusion(%all-reduce-done.15), kind=kLoop, calls=%wrapped_slice_computation.7, metadata={scheduling_name="wrapped_slice.7"}
  %wrapped_slice.5 = bf16[1572864]{0} fusion(%all-reduce-done.13), kind=kLoop, calls=%wrapped_slice_computation.5, metadata={scheduling_name="wrapped_slice.5"}
  %wrapped_slice.6 = bf16[9437184]{0} fusion(%all-reduce-done.13), kind=kLoop, calls=%wrapped_slice_computation.6, metadata={scheduling_name="wrapped_slice.6"}
  %input_reduce_fusion.50 = f32[2048]{0} fusion(%all-reduce-done.8), kind=kInput, calls=%fused_reduce.50, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.37" scheduling_name="input_reduce_fusion.50"}
  %input_reduce_fusion.89 = f32[] fusion(%input_reduce_fusion.50), kind=kInput, calls=%fused_reduce.89, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.89"}
  %bitcast.32400 = bf16[2,1,768,8]{3,2,1,0} bitcast(%wrapped_slice.9), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32400"}
  %input_reduce_fusion.48 = f32[] fusion(%bitcast.32400), kind=kInput, calls=%fused_reduce.48, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.48" scheduling_name="input_reduce_fusion.48"}
  %bitcast.32401 = bf16[2,1,768,8,128]{4,3,2,1,0} bitcast(%wrapped_slice.10), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32401"}
  %input_reduce_fusion.49 = f32[1024]{0} fusion(%bitcast.32401), kind=kInput, calls=%fused_reduce.49, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.49"}
  %input_reduce_fusion.90 = f32[] fusion(%input_reduce_fusion.49), kind=kInput, calls=%fused_reduce.90, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.90"}
  %bitcast.32399 = bf16[2,1,768,8,128]{4,3,2,1,0} bitcast(%wrapped_slice.8), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32399"}
  %input_reduce_fusion.39 = f32[1024]{0} fusion(%bitcast.32399), kind=kInput, calls=%fused_reduce.39, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.39"}
  %input_reduce_fusion.94 = f32[] fusion(%input_reduce_fusion.39), kind=kInput, calls=%fused_reduce.94, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.94"}
  %bitcast.32398 = bf16[2,1,48,128,768]{4,3,2,1,0} bitcast(%wrapped_slice.7), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32398"}
  %input_reduce_fusion.38 = f32[2048]{0} fusion(%bitcast.32398), kind=kInput, calls=%fused_reduce.38, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.38" scheduling_name="input_reduce_fusion.38"}
  %input_reduce_fusion.95 = f32[] fusion(%input_reduce_fusion.38), kind=kInput, calls=%fused_reduce.95, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.95"}
  %bitcast.32328 = bf16[2,1,768,8,128]{4,3,2,1,0} bitcast(%wrapped_slice.5), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32328"}
  %input_reduce_fusion.36 = f32[1024]{0} fusion(%bitcast.32328), kind=kInput, calls=%fused_reduce.36, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.36" scheduling_name="input_reduce_fusion.36"}
  %input_reduce_fusion.97 = f32[] fusion(%input_reduce_fusion.36), kind=kInput, calls=%fused_reduce.97, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.97"}
  %bitcast.32329 = bf16[2,1,768,48,128]{4,3,2,1,0} bitcast(%wrapped_slice.6), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/pipeline_module/while" source_file="/workspace/maxtext/MaxText/layers/pipeline.py" source_line=783 scheduling_name="bitcast.32329"}
  %input_reduce_fusion.37 = f32[2048]{0} fusion(%bitcast.32329), kind=kInput, calls=%fused_reduce.37, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.37" scheduling_name="input_reduce_fusion.37"}
  %input_reduce_fusion.96 = f32[] fusion(%input_reduce_fusion.37), kind=kInput, calls=%fused_reduce.96, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.96"}
  %input_reduce_fusion.60 = f32[24576]{0} fusion(%all-reduce-done.5), kind=kInput, calls=%fused_reduce.60, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.60"}
  %input_reduce_fusion.59 = f32[128]{0} fusion(%input_reduce_fusion.60), kind=kInput, calls=%fused_reduce.59, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.59"}
  %input_reduce_fusion.84 = f32[] fusion(%input_reduce_fusion.59), kind=kInput, calls=%fused_reduce.84, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.84"}
  %input_reduce_fusion.58 = f32[24576]{0} fusion(%all-reduce-done.6), kind=kInput, calls=%fused_reduce.58, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.58"}
  %input_reduce_fusion.57 = f32[128]{0} fusion(%input_reduce_fusion.58), kind=kInput, calls=%fused_reduce.57, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.57"}
  %input_reduce_fusion.85 = f32[] fusion(%input_reduce_fusion.57), kind=kInput, calls=%fused_reduce.85, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.85"}
  %input_reduce_fusion.56 = f32[24576]{0} fusion(%all-reduce-done.7), kind=kInput, calls=%fused_reduce.56, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.43" scheduling_name="input_reduce_fusion.56"}
  %input_reduce_fusion.55 = f32[128]{0} fusion(%input_reduce_fusion.56), kind=kInput, calls=%fused_reduce.55, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.55"}
  %input_reduce_fusion.86 = f32[] fusion(%input_reduce_fusion.55), kind=kInput, calls=%fused_reduce.86, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.86"}
  %input_reduce_fusion.47 = f32[24576]{0} fusion(%all-reduce-done.9), kind=kInput, calls=%fused_reduce.47, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.47"}
  %input_reduce_fusion.46 = f32[128]{0} fusion(%input_reduce_fusion.47), kind=kInput, calls=%fused_reduce.46, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.46"}
  %input_reduce_fusion.91 = f32[] fusion(%input_reduce_fusion.46), kind=kInput, calls=%fused_reduce.91, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.91"}
  %input_reduce_fusion.45 = f32[24576]{0} fusion(%all-reduce-done.10), kind=kInput, calls=%fused_reduce.45, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.45" scheduling_name="input_reduce_fusion.45"}
  %input_reduce_fusion.44 = f32[128]{0} fusion(%input_reduce_fusion.45), kind=kInput, calls=%fused_reduce.44, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.44"}
  %input_reduce_fusion.92 = f32[] fusion(%input_reduce_fusion.44), kind=kInput, calls=%fused_reduce.92, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.92"}
  %input_reduce_fusion.43 = f32[24576]{0} fusion(%all-reduce-done.11), kind=kInput, calls=%fused_reduce.43, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.43" scheduling_name="input_reduce_fusion.43"}
  %input_reduce_fusion.42 = f32[128]{0} fusion(%input_reduce_fusion.43), kind=kInput, calls=%fused_reduce.42, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.42"}
  %input_reduce_fusion.93 = f32[] fusion(%input_reduce_fusion.42), kind=kInput, calls=%fused_reduce.93, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.93"}
  %input_reduce_fusion.68 = f32[] fusion(%all-reduce-done.1), kind=kInput, calls=%fused_reduce.68, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="input_reduce_fusion.68"}
  %bitcast.32345 = f32[1]{0} bitcast(%input_reduce_fusion.61), metadata={scheduling_name="bitcast.32345"}
  %bitcast.32361 = f32[1]{0} bitcast(%input_reduce_fusion.61), metadata={scheduling_name="bitcast.32361"}
  %bitcast.32341 = f32[1]{0} bitcast(%input_reduce_fusion.87), metadata={scheduling_name="bitcast.32341"}
  %bitcast.32357 = f32[1]{0} bitcast(%input_reduce_fusion.87), metadata={scheduling_name="bitcast.32357"}
  %bitcast.32340 = f32[1]{0} bitcast(%input_reduce_fusion.88), metadata={scheduling_name="bitcast.32340"}
  %bitcast.32356 = f32[1]{0} bitcast(%input_reduce_fusion.88), metadata={scheduling_name="bitcast.32356"}
  %bitcast.32339 = f32[1]{0} bitcast(%input_reduce_fusion.89), metadata={scheduling_name="bitcast.32339"}
  %bitcast.32355 = f32[1]{0} bitcast(%input_reduce_fusion.89), metadata={scheduling_name="bitcast.32355"}
  %bitcast.32337 = f32[1]{0} bitcast(%input_reduce_fusion.48), metadata={scheduling_name="bitcast.32337"}
  %bitcast.32353 = f32[1]{0} bitcast(%input_reduce_fusion.48), metadata={scheduling_name="bitcast.32353"}
  %bitcast.32338 = f32[1]{0} bitcast(%input_reduce_fusion.90), metadata={scheduling_name="bitcast.32338"}
  %bitcast.32354 = f32[1]{0} bitcast(%input_reduce_fusion.90), metadata={scheduling_name="bitcast.32354"}
  %bitcast.32333 = f32[1]{0} bitcast(%input_reduce_fusion.94), metadata={scheduling_name="bitcast.32333"}
  %bitcast.32349 = f32[1]{0} bitcast(%input_reduce_fusion.94), metadata={scheduling_name="bitcast.32349"}
  %bitcast.32332 = f32[1]{0} bitcast(%input_reduce_fusion.95), metadata={scheduling_name="bitcast.32332"}
  %bitcast.32348 = f32[1]{0} bitcast(%input_reduce_fusion.95), metadata={scheduling_name="bitcast.32348"}
  %bitcast.32330 = f32[1]{0} bitcast(%input_reduce_fusion.97), metadata={scheduling_name="bitcast.32330"}
  %bitcast.32346 = f32[1]{0} bitcast(%input_reduce_fusion.97), metadata={scheduling_name="bitcast.32346"}
  %bitcast.32331 = f32[1]{0} bitcast(%input_reduce_fusion.96), metadata={scheduling_name="bitcast.32331"}
  %bitcast.32347 = f32[1]{0} bitcast(%input_reduce_fusion.96), metadata={scheduling_name="bitcast.32347"}
  %bitcast.32344 = f32[1]{0} bitcast(%input_reduce_fusion.84), metadata={scheduling_name="bitcast.32344"}
  %bitcast.32360 = f32[1]{0} bitcast(%input_reduce_fusion.84), metadata={scheduling_name="bitcast.32360"}
  %bitcast.32343 = f32[1]{0} bitcast(%input_reduce_fusion.85), metadata={scheduling_name="bitcast.32343"}
  %bitcast.32359 = f32[1]{0} bitcast(%input_reduce_fusion.85), metadata={scheduling_name="bitcast.32359"}
  %bitcast.32342 = f32[1]{0} bitcast(%input_reduce_fusion.86), metadata={scheduling_name="bitcast.32342"}
  %bitcast.32358 = f32[1]{0} bitcast(%input_reduce_fusion.86), metadata={scheduling_name="bitcast.32358"}
  %bitcast.32336 = f32[1]{0} bitcast(%input_reduce_fusion.91), metadata={scheduling_name="bitcast.32336"}
  %bitcast.32352 = f32[1]{0} bitcast(%input_reduce_fusion.91), metadata={scheduling_name="bitcast.32352"}
  %bitcast.32335 = f32[1]{0} bitcast(%input_reduce_fusion.92), metadata={scheduling_name="bitcast.32335"}
  %bitcast.32351 = f32[1]{0} bitcast(%input_reduce_fusion.92), metadata={scheduling_name="bitcast.32351"}
  %bitcast.32334 = f32[1]{0} bitcast(%input_reduce_fusion.93), metadata={scheduling_name="bitcast.32334"}
  %bitcast.32350 = f32[1]{0} bitcast(%input_reduce_fusion.93), metadata={scheduling_name="bitcast.32350"}
  %wrapped_concatenate.4 = f32[32]{0} fusion(%bitcast.32330, %bitcast.32331, %bitcast.32332, %bitcast.32333, %bitcast.32334, /*index=5*/%bitcast.32335, %bitcast.32336, %bitcast.32337, %bitcast.32338, %bitcast.32339, /*index=10*/%bitcast.32340, %bitcast.32341, %bitcast.32342, %bitcast.32343, %bitcast.32344, /*index=15*/%bitcast.32345, %bitcast.32346, %bitcast.32347, %bitcast.32348, %bitcast.32349, /*index=20*/%bitcast.32350, %bitcast.32351, %bitcast.32352, %bitcast.32353, %bitcast.32354, /*index=25*/%bitcast.32355, %bitcast.32356, %bitcast.32357, %bitcast.32358, %bitcast.32359, /*index=30*/%bitcast.32360, %bitcast.32361), kind=kLoop, calls=%wrapped_concatenate_computation.4, metadata={scheduling_name="wrapped_concatenate.4"}
  %bitcast.27394.0 = bf16[32768,65536]{0,1} bitcast(%loop_convert_fusion.17), metadata={scheduling_name="bitcast.27394.0"}
  %bitcast.27406.0 = bf16[65536,6144]{1,0} bitcast(%collective-permute-done.9), metadata={scheduling_name="bitcast.27406.0"}
  %custom-call.1192 = (bf16[32768,6144]{0,1}, s8[67108864]{0}) custom-call(%bitcast.27394.0, %bitcast.27406.0), custom_call_target="__cublas$lt$matmul", metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="custom-call.1192"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"gemm_backend_config":{"alpha_real":1,"alpha_imag":0,"beta":0,"dot_dimension_numbers":{"lhs_contracting_dimensions":["1"],"rhs_contracting_dimensions":["0"],"lhs_batch_dimensions":[],"rhs_batch_dimensions":[]},"precision_config":{"operand_precision":["DEFAULT","DEFAULT"],"algorithm":"ALG_UNSET"},"epilogue":"DEFAULT","damax_output":false,"reification_cost":[],"lhs_stride":"2147483648","rhs_stride":"402653184","grad_x":false,"grad_y":false},"force_earliest_schedule":false}
  %all-reduce-done.18 = f32[8]{0} all-reduce-done(%all-reduce-start.18), metadata={scheduling_name="all-reduce-done.18"}
  %all-reduce-start.14 = f32[32]{0} all-reduce-start(%wrapped_concatenate.4), channel_id=545, replica_groups={{0,1,2,3,4,5,6,7,16,17,18,19,20,21,22,23},{8,9,10,11,12,13,14,15,24,25,26,27,28,29,30,31}}, use_global_device_ids=true, to_apply=%region_119.4315.clone, metadata={scheduling_name="all-reduce-start.14"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.55 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.55, metadata={scheduling_name="wrapped_slice.55"}
  %wrapped_slice.54 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.54, metadata={scheduling_name="wrapped_slice.54"}
  %wrapped_slice.45 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.45, metadata={scheduling_name="wrapped_slice.45"}
  %wrapped_slice.44 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.44, metadata={scheduling_name="wrapped_slice.44"}
  %wrapped_slice.33 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.33, metadata={scheduling_name="wrapped_slice.33"}
  %wrapped_slice.32 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.32, metadata={scheduling_name="wrapped_slice.32"}
  %wrapped_slice.23 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.23, metadata={scheduling_name="wrapped_slice.23"}
  %wrapped_slice.22 = f32[1]{0} fusion(%all-reduce-done.18), kind=kLoop, calls=%wrapped_slice_computation.22, metadata={scheduling_name="wrapped_slice.22"}
  %all-reduce-done.14 = f32[32]{0} all-reduce-done(%all-reduce-start.14), metadata={scheduling_name="all-reduce-done.14"}
  %get-tuple-element.3833.0 = bf16[6144,32768]{1,0} get-tuple-element(%custom-call.1191), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="get-tuple-element.3833.0"}
  %get-tuple-element.3834.0 = bf16[32768,6144]{0,1} get-tuple-element(%custom-call.1192), index=0, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="get-tuple-element.3834.0"}
  %bitcast.32316 = bf16[6144,32768]{1,0} bitcast(%get-tuple-element.3834.0), metadata={scheduling_name="bitcast.32316"}
  %reduce-scatter-start.1 = ((bf16[6144,32768]{1,0}, bf16[6144,32768]{1,0}), (bf16[768,32768]{1,0}, bf16[768,32768]{1,0})) async-start(%bitcast.32316, %get-tuple-element.3833.0), calls=%async_computation.17, metadata={scheduling_name="reduce-scatter-start.1"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.59 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.59, metadata={scheduling_name="wrapped_slice.59"}
  %wrapped_slice.58 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.58, metadata={scheduling_name="wrapped_slice.58"}
  %wrapped_slice.57 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.57, metadata={scheduling_name="wrapped_slice.57"}
  %wrapped_slice.56 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.56, metadata={scheduling_name="wrapped_slice.56"}
  %wrapped_slice.53 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.53, metadata={scheduling_name="wrapped_slice.53"}
  %wrapped_slice.52 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.52, metadata={scheduling_name="wrapped_slice.52"}
  %wrapped_slice.51 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.51, metadata={scheduling_name="wrapped_slice.51"}
  %wrapped_slice.50 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.50, metadata={scheduling_name="wrapped_slice.50"}
  %wrapped_slice.49 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.49, metadata={scheduling_name="wrapped_slice.49"}
  %wrapped_slice.48 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.48, metadata={scheduling_name="wrapped_slice.48"}
  %wrapped_slice.47 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.47, metadata={scheduling_name="wrapped_slice.47"}
  %wrapped_slice.46 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.46, metadata={scheduling_name="wrapped_slice.46"}
  %wrapped_slice.43 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.43, metadata={scheduling_name="wrapped_slice.43"}
  %wrapped_slice.42 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.42, metadata={scheduling_name="wrapped_slice.42"}
  %reduce-scatter-done.1 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}) async-done(%reduce-scatter-start.1), metadata={scheduling_name="reduce-scatter-done.1"}
  %get-tuple-element.4404 = bf16[768,32768]{1,0} get-tuple-element(%reduce-scatter-done.1), index=0, metadata={scheduling_name="get-tuple-element.4404"}
  %bitcast.32317 = bf16[32768,768]{0,1} bitcast(%get-tuple-element.4404), metadata={scheduling_name="bitcast.32317"}
  %all-reduce-start.3 = bf16[32768,768]{0,1} all-reduce-start(%bitcast.32317), channel_id=413, replica_groups=[8,4]<=[4,8]T(1,0), use_global_device_ids=true, to_apply=%add.29.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-reduce-start.3"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.37 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.37, metadata={scheduling_name="wrapped_slice.37"}
  %wrapped_slice.36 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.36, metadata={scheduling_name="wrapped_slice.36"}
  %wrapped_slice.35 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.35, metadata={scheduling_name="wrapped_slice.35"}
  %wrapped_slice.34 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.34, metadata={scheduling_name="wrapped_slice.34"}
  %wrapped_slice.31 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.31, metadata={scheduling_name="wrapped_slice.31"}
  %all-reduce-done.3 = bf16[32768,768]{0,1} all-reduce-done(%all-reduce-start.3), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_embedding/token_embedder/transpose" source_file="/workspace/maxtext/MaxText/layers/embeddings.py" source_line=150 scheduling_name="all-reduce-done.3"}
  %get-tuple-element.4405 = bf16[768,32768]{1,0} get-tuple-element(%reduce-scatter-done.1), index=1, metadata={scheduling_name="get-tuple-element.4405"}
  %all-reduce-start.2 = bf16[768,32768]{1,0} all-reduce-start(%get-tuple-element.4405), channel_id=134, replica_groups=[8,4]<=[4,8]T(1,0), use_global_device_ids=true, to_apply=%add.1.clone, metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-reduce-start.2"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.30 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.30, metadata={scheduling_name="wrapped_slice.30"}
  %wrapped_slice.29 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.29, metadata={scheduling_name="wrapped_slice.29"}
  %wrapped_slice.28 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.28, metadata={scheduling_name="wrapped_slice.28"}
  %wrapped_slice.27 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.27, metadata={scheduling_name="wrapped_slice.27"}
  %wrapped_slice.26 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.26, metadata={scheduling_name="wrapped_slice.26"}
  %input_reduce_fusion.35 = f32[4096]{0} fusion(%all-reduce-done.3), kind=kInput, calls=%fused_reduce.35, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="input_reduce_fusion.35"}
  %input_reduce_fusion.98 = f32[] fusion(%input_reduce_fusion.35), kind=kInput, calls=%fused_reduce.98, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.98"}
  %all-reduce-done.2 = bf16[768,32768]{1,0} all-reduce-done(%all-reduce-start.2), metadata={op_name="jit(train_step)/jit(main)/transpose(jvp(Transformer))/decoder/decoder._apply_output_head/logits_dense/transpose" source_file="/workspace/maxtext/MaxText/layers/linears.py" source_line=88 scheduling_name="all-reduce-done.2"}
  %input_reduce_fusion.62 = f32[4096]{0} fusion(%all-reduce-done.2), kind=kInput, calls=%fused_reduce.62, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.28" scheduling_name="input_reduce_fusion.62"}
  %input_reduce_fusion.83 = f32[] fusion(%input_reduce_fusion.62), kind=kInput, calls=%fused_reduce.83, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.83"}
  %wrapped_slice.25 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.25, metadata={scheduling_name="wrapped_slice.25"}
  %bitcast.32318 = f32[1]{0} bitcast(%input_reduce_fusion.98), metadata={scheduling_name="bitcast.32318"}
  %bitcast.32320 = f32[1]{0} bitcast(%input_reduce_fusion.98), metadata={scheduling_name="bitcast.32320"}
  %bitcast.32319 = f32[1]{0} bitcast(%input_reduce_fusion.83), metadata={scheduling_name="bitcast.32319"}
  %bitcast.32321 = f32[1]{0} bitcast(%input_reduce_fusion.83), metadata={scheduling_name="bitcast.32321"}
  %wrapped_concatenate = f32[4]{0} fusion(%bitcast.32318, %bitcast.32319, %bitcast.32320, %bitcast.32321), kind=kLoop, calls=%wrapped_concatenate_computation, metadata={scheduling_name="wrapped_concatenate"}
  %all-reduce-start.12 = f32[4]{0} all-reduce-start(%wrapped_concatenate), channel_id=414, replica_groups=[4,8]<=[32], use_global_device_ids=true, to_apply=%region_120.4324.clone, metadata={scheduling_name="all-reduce-start.12"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.24 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.24, metadata={scheduling_name="wrapped_slice.24"}
  %wrapped_slice.17 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.17, metadata={scheduling_name="wrapped_slice.17"}
  %wrapped_slice.16 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.16, metadata={scheduling_name="wrapped_slice.16"}
  %wrapped_slice.15 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.15, metadata={scheduling_name="wrapped_slice.15"}
  %wrapped_slice.14 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.14, metadata={scheduling_name="wrapped_slice.14"}
  %all-reduce-done.12 = f32[4]{0} all-reduce-done(%all-reduce-start.12), metadata={scheduling_name="all-reduce-done.12"}
  %wrapped_slice.38 = f32[1]{0} fusion(%all-reduce-done.12), kind=kLoop, calls=%wrapped_slice_computation.38, metadata={scheduling_name="wrapped_slice.38"}
  %wrapped_slice.4 = f32[1]{0} fusion(%all-reduce-done.12), kind=kLoop, calls=%wrapped_slice_computation.4, metadata={scheduling_name="wrapped_slice.4"}
  %wrapped_slice.41 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.41, metadata={scheduling_name="wrapped_slice.41"}
  %bitcast.32427 = f32[] bitcast(%wrapped_slice.33), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32427"}
  %bitcast.32426 = f32[] bitcast(%wrapped_slice.32), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32426"}
  %bitcast.32425 = f32[] bitcast(%wrapped_slice.23), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32425"}
  %bitcast.32424 = f32[] bitcast(%wrapped_slice.22), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32424"}
  %bitcast.32377 = f32[] bitcast(%wrapped_slice.37), metadata={scheduling_name="bitcast.32377"}
  %bitcast.32376 = f32[] bitcast(%wrapped_slice.36), metadata={scheduling_name="bitcast.32376"}
  %bitcast.32375 = f32[] bitcast(%wrapped_slice.35), metadata={scheduling_name="bitcast.32375"}
  %bitcast.32374 = f32[] bitcast(%wrapped_slice.34), metadata={scheduling_name="bitcast.32374"}
  %bitcast.32373 = f32[] bitcast(%wrapped_slice.31), metadata={scheduling_name="bitcast.32373"}
  %bitcast.32372 = f32[] bitcast(%wrapped_slice.30), metadata={scheduling_name="bitcast.32372"}
  %bitcast.32371 = f32[] bitcast(%wrapped_slice.29), metadata={scheduling_name="bitcast.32371"}
  %bitcast.32370 = f32[] bitcast(%wrapped_slice.28), metadata={scheduling_name="bitcast.32370"}
  %bitcast.32369 = f32[] bitcast(%wrapped_slice.27), metadata={scheduling_name="bitcast.32369"}
  %bitcast.32368 = f32[] bitcast(%wrapped_slice.26), metadata={scheduling_name="bitcast.32368"}
  %bitcast.32367 = f32[] bitcast(%wrapped_slice.25), metadata={scheduling_name="bitcast.32367"}
  %bitcast.32366 = f32[] bitcast(%wrapped_slice.24), metadata={scheduling_name="bitcast.32366"}
  %bitcast.32365 = f32[] bitcast(%wrapped_slice.17), metadata={scheduling_name="bitcast.32365"}
  %bitcast.32364 = f32[] bitcast(%wrapped_slice.16), metadata={scheduling_name="bitcast.32364"}
  %bitcast.32363 = f32[] bitcast(%wrapped_slice.15), metadata={scheduling_name="bitcast.32363"}
  %bitcast.32362 = f32[] bitcast(%wrapped_slice.14), metadata={scheduling_name="bitcast.32362"}
  %bitcast.32323 = f32[] bitcast(%wrapped_slice.38), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32323"}
  %bitcast.32322 = f32[] bitcast(%wrapped_slice.4), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="bitcast.32322"}
  %loop_compare_sqrt_fusion = (pred[], f32[]) fusion(%bitcast.32322, %bitcast.32362, %bitcast.32363, %bitcast.32364, %bitcast.32365, /*index=5*/%bitcast.32424, %bitcast.32425, %bitcast.32366, %bitcast.32367, %bitcast.32368, /*index=10*/%bitcast.32369, %bitcast.32370, %bitcast.32371, %bitcast.32372, %bitcast.32373, /*index=15*/%bitcast.32426, %bitcast.32427, %bitcast.32374, %bitcast.32375, %bitcast.32376, /*index=20*/%bitcast.32377, %input_reduce_fusion.68, %bitcast.32323), kind=kLoop, calls=%fused_compare_sqrt, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="loop_compare_sqrt_fusion"}
  %wrapped_slice.40 = f32[1]{0} fusion(%all-reduce-done.14), kind=kLoop, calls=%wrapped_slice_computation.40, metadata={scheduling_name="wrapped_slice.40"}
  %get-tuple-element.4226 = f32[] get-tuple-element(%loop_compare_sqrt_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="get-tuple-element.4226"}
  %get-tuple-element.4225 = pred[] get-tuple-element(%loop_compare_sqrt_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/lt" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 scheduling_name="get-tuple-element.4225"}
  %loop_select_fusion.4 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32413, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.4, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.4"}
  %loop_select_fusion.6 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32414, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.6, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.6"}
  %loop_select_fusion.3 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32412, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.3, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.3"}
  %loop_select_fusion.7 = bf16[2,1,6144]{2,1,0} fusion(%bitcast.32415, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.7, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.3" scheduling_name="loop_select_fusion.7"}
  %input_select_transpose_fusion = (bf16[32768,768]{1,0}, bf16[32768,768]{1,0}, bf16[768,32768]{1,0}) fusion(%copy.944, %wrapped_transpose.1, %get-tuple-element.4226, %all-reduce-done.3, %get-tuple-element.4225), kind=kInput, calls=%fused_select_transpose, metadata={scheduling_name="input_select_transpose_fusion"}
  %loop_select_fusion.8 = bf16[2,1,768,8]{3,2,1,0} fusion(%bitcast.32407, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.8, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.5" scheduling_name="loop_select_fusion.8"}
  %get-tuple-element.4126 = bf16[768,32768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=2, metadata={scheduling_name="get-tuple-element.4126"}
  %input_reduce_fusion.28 = f32[4096]{0} fusion(%get-tuple-element.4126), kind=kInput, calls=%fused_reduce.28, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.28" scheduling_name="input_reduce_fusion.28"}
  %get-tuple-element.4254 = f32[] get-tuple-element(%loop_select_subtract_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/sub" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4254"}
  %input_transpose_fusion.10 = f32[768,32768]{1,0} fusion(%wrapped_transpose, %loop_multiply_fusion.7, %loop_subtract_fusion, %get-tuple-element.4254, %wrapped_transpose.1, /*index=5*/%get-tuple-element.4126, %copy.944), kind=kInput, calls=%fused_transpose.24, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="input_transpose_fusion.10"}
  %input_add_convert_reduce_fusion.7 = (bf16[6144]{0}, bf16[6144]{0}, f32[6144]{0}, f32[]) fusion(%param.33, %all-reduce-done.1, %get-tuple-element.4226, %get-tuple-element.4225, %param.35, /*index=5*/%loop_subtract_fusion, %get-tuple-element.4254, %loop_multiply_fusion.7, %param.5), kind=kInput, calls=%fused_add_convert_reduce.7, metadata={scheduling_name="input_add_convert_reduce_fusion.7"}
  %input_add_convert_reduce_fusion.6 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) fusion(%param.16, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.38, /*index=5*/%loop_select_fusion.8, %param.39), kind=kInput, calls=%fused_add_convert_reduce.6, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.3" scheduling_name="input_add_convert_reduce_fusion.6"}
  %get-tuple-element.4244 = f32[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=2, metadata={scheduling_name="get-tuple-element.4244"}
  %input_convert_reduce_fusion.21 = (f32[], bf16[6144]{0}) fusion(%get-tuple-element.4244), kind=kInput, calls=%fused_convert_reduce.21, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="input_convert_reduce_fusion.21"}
  %get-tuple-element.4215 = f32[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4215"}
  %input_convert_reduce_fusion.7 = (f32[], bf16[2,1,768,8]{3,2,1,0}) fusion(%get-tuple-element.4215), kind=kInput, calls=%fused_convert_reduce.7, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.4" scheduling_name="input_convert_reduce_fusion.7"}
  %input_add_convert_reduce_fusion.5 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.15, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.46, /*index=5*/%loop_select_fusion.7, %param.47), kind=kInput, calls=%fused_add_convert_reduce.5, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.5"}
  %input_add_convert_reduce_fusion.1 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.20, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.68, /*index=5*/%loop_select_fusion.3, %param.69), kind=kInput, calls=%fused_add_convert_reduce.1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.1"}
  %get-tuple-element.4197 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4197"}
  %input_convert_reduce_fusion.6 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4197), kind=kInput, calls=%fused_convert_reduce.6, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.6"}
  %get-tuple-element.4145 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4145"}
  %input_convert_reduce_fusion.2 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4145), kind=kInput, calls=%fused_convert_reduce.2, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.2"}
  %input_add_convert_reduce_fusion.4 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.9, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.48, /*index=5*/%loop_select_fusion.6, %param.49), kind=kInput, calls=%fused_add_convert_reduce.4, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.4"}
  %input_add_convert_reduce_fusion.2 = (f32[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, f32[]) fusion(%param.25, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.66, /*index=5*/%loop_select_fusion.4, %param.67), kind=kInput, calls=%fused_add_convert_reduce.2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.1" scheduling_name="input_add_convert_reduce_fusion.2"}
  %get-tuple-element.4191 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4191"}
  %input_convert_reduce_fusion.5 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4191), kind=kInput, calls=%fused_convert_reduce.5, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.5"}
  %get-tuple-element.4151 = f32[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4151"}
  %input_convert_reduce_fusion.3 = (f32[], bf16[2,1,6144]{2,1,0}) fusion(%get-tuple-element.4151), kind=kInput, calls=%fused_convert_reduce.3, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.2" scheduling_name="input_convert_reduce_fusion.3"}
  %get-tuple-element.4200 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.5), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4200"}
  %bitcast.32511 = f32[1]{0} bitcast(%get-tuple-element.4200), metadata={scheduling_name="bitcast.32511"}
  %get-tuple-element.4195 = f32[] get-tuple-element(%input_convert_reduce_fusion.6), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4195"}
  %bitcast.32507 = f32[1]{0} bitcast(%get-tuple-element.4195), metadata={scheduling_name="bitcast.32507"}
  %get-tuple-element.4148 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.1), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4148"}
  %bitcast.32508 = f32[1]{0} bitcast(%get-tuple-element.4148), metadata={scheduling_name="bitcast.32508"}
  %get-tuple-element.4143 = f32[] get-tuple-element(%input_convert_reduce_fusion.2), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4143"}
  %bitcast.32504 = f32[1]{0} bitcast(%get-tuple-element.4143), metadata={scheduling_name="bitcast.32504"}
  %get-tuple-element.4194 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.4), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4194"}
  %bitcast.32510 = f32[1]{0} bitcast(%get-tuple-element.4194), metadata={scheduling_name="bitcast.32510"}
  %get-tuple-element.4189 = f32[] get-tuple-element(%input_convert_reduce_fusion.5), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4189"}
  %bitcast.32506 = f32[1]{0} bitcast(%get-tuple-element.4189), metadata={scheduling_name="bitcast.32506"}
  %get-tuple-element.4154 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.2), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4154"}
  %bitcast.32509 = f32[1]{0} bitcast(%get-tuple-element.4154), metadata={scheduling_name="bitcast.32509"}
  %get-tuple-element.4149 = f32[] get-tuple-element(%input_convert_reduce_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4149"}
  %bitcast.32505 = f32[1]{0} bitcast(%get-tuple-element.4149), metadata={scheduling_name="bitcast.32505"}
  %wrapped_concatenate.9 = f32[8]{0} fusion(%bitcast.32504, %bitcast.32505, %bitcast.32506, %bitcast.32507, %bitcast.32508, /*index=5*/%bitcast.32509, %bitcast.32510, %bitcast.32511), kind=kLoop, calls=%wrapped_concatenate_computation.9, metadata={scheduling_name="wrapped_concatenate.9"}
  %all-reduce-start.21 = f32[8]{0} all-reduce-start(%wrapped_concatenate.9), channel_id=482, replica_groups=[16,2]<=[2,16]T(1,0), use_global_device_ids=true, to_apply=%region_184.5554.clone, metadata={scheduling_name="all-reduce-start.21"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %loop_select_fusion.5 = bf16[2,1,768,8]{3,2,1,0} fusion(%bitcast.32400, %get-tuple-element.4226, %get-tuple-element.4225), kind=kLoop, calls=%fused_select.5, metadata={op_name="jit(train_step)/jit(main)/select_n" source_file="/workspace/maxtext/MaxText/maxtext_utils.py" source_line=847 deduplicated_name="loop_select_fusion.5" scheduling_name="loop_select_fusion.5"}
  %input_add_convert_reduce_fusion.3 = (f32[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, f32[]) fusion(%param.26, %loop_multiply_fusion.7, %get-tuple-element.4254, %loop_subtract_fusion, %param.58, /*index=5*/%loop_select_fusion.5, %param.59), kind=kInput, calls=%fused_add_convert_reduce.3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 deduplicated_name="input_add_convert_reduce_fusion.3" scheduling_name="input_add_convert_reduce_fusion.3"}
  %input_convert_reduce_fusion.24 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.22, %loop_subtract_fusion, %param.71, %get-tuple-element.4254, %param.70, /*index=5*/%bitcast.32399, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.24, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.24"}
  %get-tuple-element.4169 = f32[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4169"}
  %input_convert_reduce_fusion.4 = (f32[], bf16[2,1,768,8]{3,2,1,0}) fusion(%get-tuple-element.4169), kind=kInput, calls=%fused_convert_reduce.4, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_convert_reduce_fusion.4" scheduling_name="input_convert_reduce_fusion.4"}
  %get-tuple-element.4238 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.24), index=4, metadata={scheduling_name="get-tuple-element.4238"}
  %input_reduce_fusion.110 = f32[] fusion(%get-tuple-element.4238), kind=kInput, calls=%fused_reduce.110, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.110"}
  %input_convert_reduce_fusion.22 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.12, %loop_subtract_fusion, %param.51, %get-tuple-element.4254, %param.50, /*index=5*/%bitcast.32406, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.22, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.22"}
  %get-tuple-element.4141 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.24), index=2, metadata={scheduling_name="get-tuple-element.4141"}
  %input_reduce_fusion.80 = f32[] fusion(%get-tuple-element.4141), kind=kInput, calls=%fused_reduce.80, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.80"}
  %get-tuple-element.4231 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.22), index=4, metadata={scheduling_name="get-tuple-element.4231"}
  %input_reduce_fusion.103 = f32[] fusion(%get-tuple-element.4231), kind=kInput, calls=%fused_reduce.103, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.103"}
  %input_convert_reduce_fusion.25 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.23, %loop_subtract_fusion, %param.77, %get-tuple-element.4254, %param.76, /*index=5*/%bitcast.32328, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.25, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.25"}
  %get-tuple-element.4187 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.22), index=2, metadata={scheduling_name="get-tuple-element.4187"}
  %input_reduce_fusion.73 = f32[] fusion(%get-tuple-element.4187), kind=kInput, calls=%fused_reduce.73, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.73"}
  %get-tuple-element.4241 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.25), index=4, metadata={scheduling_name="get-tuple-element.4241"}
  %input_reduce_fusion.113 = f32[] fusion(%get-tuple-element.4241), kind=kInput, calls=%fused_reduce.113, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.113"}
  %input_convert_reduce_fusion.23 = (bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}, bf16[2,1,768,8,128]{4,3,2,1,0}, f32[1024]{0}) fusion(%param.13, %loop_subtract_fusion, %param.57, %get-tuple-element.4254, %param.56, /*index=5*/%bitcast.32401, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.23, metadata={deduplicated_name="input_convert_reduce_fusion.22" scheduling_name="input_convert_reduce_fusion.23"}
  %get-tuple-element.4129 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.25), index=2, metadata={scheduling_name="get-tuple-element.4129"}
  %input_reduce_fusion.117 = f32[] fusion(%get-tuple-element.4129), kind=kInput, calls=%fused_reduce.117, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.117"}
  %get-tuple-element.4234 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.23), index=4, metadata={scheduling_name="get-tuple-element.4234"}
  %input_reduce_fusion.106 = f32[] fusion(%get-tuple-element.4234), kind=kInput, calls=%fused_reduce.106, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.106"}
  %input_convert_reduce_fusion.18 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.10, %loop_subtract_fusion, %param.55, %get-tuple-element.4254, %param.54, /*index=5*/%all-reduce-done.8, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.18, metadata={deduplicated_name="input_convert_reduce_fusion.18" scheduling_name="input_convert_reduce_fusion.18"}
  %get-tuple-element.4175 = f32[1024]{0} get-tuple-element(%input_convert_reduce_fusion.23), index=2, metadata={scheduling_name="get-tuple-element.4175"}
  %input_reduce_fusion.77 = f32[] fusion(%get-tuple-element.4175), kind=kInput, calls=%fused_reduce.77, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.73" scheduling_name="input_reduce_fusion.77"}
  %get-tuple-element.4233 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.18), index=4, metadata={scheduling_name="get-tuple-element.4233"}
  %input_reduce_fusion.105 = f32[] fusion(%get-tuple-element.4233), kind=kInput, calls=%fused_reduce.105, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.105"}
  %input_convert_reduce_fusion.19 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.24, %loop_subtract_fusion, %param.73, %get-tuple-element.4254, %param.72, /*index=5*/%bitcast.32398, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.19, metadata={deduplicated_name="input_convert_reduce_fusion.17" scheduling_name="input_convert_reduce_fusion.19"}
  %get-tuple-element.4179 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.18), index=2, metadata={scheduling_name="get-tuple-element.4179"}
  %input_reduce_fusion.78 = f32[] fusion(%get-tuple-element.4179), kind=kInput, calls=%fused_reduce.78, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.78"}
  %get-tuple-element.4239 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.19), index=4, metadata={scheduling_name="get-tuple-element.4239"}
  %input_reduce_fusion.111 = f32[] fusion(%get-tuple-element.4239), kind=kInput, calls=%fused_reduce.111, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.111"}
  %input_convert_reduce_fusion.20 = (bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,768,48,128]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.21, %loop_subtract_fusion, %param.75, %get-tuple-element.4254, %param.74, /*index=5*/%bitcast.32329, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.20, metadata={deduplicated_name="input_convert_reduce_fusion.18" scheduling_name="input_convert_reduce_fusion.20"}
  %get-tuple-element.4137 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.19), index=2, metadata={scheduling_name="get-tuple-element.4137"}
  %input_reduce_fusion.115 = f32[] fusion(%get-tuple-element.4137), kind=kInput, calls=%fused_reduce.115, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.115"}
  %get-tuple-element.4240 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.20), index=4, metadata={scheduling_name="get-tuple-element.4240"}
  %input_reduce_fusion.112 = f32[] fusion(%get-tuple-element.4240), kind=kInput, calls=%fused_reduce.112, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.112"}
  %input_convert_reduce_fusion.17 = (bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}, bf16[2,1,48,128,768]{4,3,2,1,0}, f32[2048]{0}) fusion(%param.14, %loop_subtract_fusion, %param.53, %get-tuple-element.4254, %param.52, /*index=5*/%bitcast.32405, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.17, metadata={deduplicated_name="input_convert_reduce_fusion.17" scheduling_name="input_convert_reduce_fusion.17"}
  %get-tuple-element.4133 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.4133"}
  %input_reduce_fusion.82 = f32[] fusion(%get-tuple-element.4133), kind=kInput, calls=%fused_reduce.82, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.82"}
  %get-tuple-element.4232 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.17), index=4, metadata={scheduling_name="get-tuple-element.4232"}
  %input_reduce_fusion.104 = f32[] fusion(%get-tuple-element.4232), kind=kInput, calls=%fused_reduce.104, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.104"}
  %get-tuple-element.4183 = f32[2048]{0} get-tuple-element(%input_convert_reduce_fusion.17), index=2, metadata={scheduling_name="get-tuple-element.4183"}
  %input_reduce_fusion.79 = f32[] fusion(%get-tuple-element.4183), kind=kInput, calls=%fused_reduce.79, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.78" scheduling_name="input_reduce_fusion.79"}
  %input_reduce_fusion.20 = f32[4096]{0} fusion(%input_transpose_fusion.10), kind=kInput, calls=%fused_reduce.20, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="input_reduce_fusion.20"}
  %input_reduce_fusion.118 = f32[] fusion(%input_reduce_fusion.20), kind=kInput, calls=%fused_reduce.118, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.118"}
  %input_convert_reduce_fusion.16 = (bf16[768,32768]{1,0}, bf16[768,32768]{1,0}, f32[4096]{0}, bf16[768,32768]{1,0}, f32[4096]{0}) fusion(%param.31, %loop_subtract_fusion, %param.37, %get-tuple-element.4254, %param.36, /*index=5*/%all-reduce-done.2, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.16, metadata={scheduling_name="input_convert_reduce_fusion.16"}
  %input_reduce_fusion.114 = f32[] fusion(%input_reduce_fusion.28), kind=kInput, calls=%fused_reduce.114, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.114"}
  %get-tuple-element.4227 = f32[4096]{0} get-tuple-element(%input_convert_reduce_fusion.16), index=4, metadata={scheduling_name="get-tuple-element.4227"}
  %input_reduce_fusion.99 = f32[] fusion(%get-tuple-element.4227), kind=kInput, calls=%fused_reduce.99, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.99"}
  %input_convert_reduce_fusion.10 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.17, %loop_subtract_fusion, %param.41, %get-tuple-element.4254, %param.40, /*index=5*/%all-reduce-done.5, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.10, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.10"}
  %get-tuple-element.4221 = f32[4096]{0} get-tuple-element(%input_convert_reduce_fusion.16), index=2, metadata={scheduling_name="get-tuple-element.4221"}
  %input_reduce_fusion.120 = f32[] fusion(%get-tuple-element.4221), kind=kInput, calls=%fused_reduce.120, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.83" scheduling_name="input_reduce_fusion.120"}
  %get-tuple-element.4211 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.10), index=2, metadata={scheduling_name="get-tuple-element.4211"}
  %input_reduce_fusion.26 = f32[128]{0} fusion(%get-tuple-element.4211), kind=kInput, calls=%fused_reduce.26, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.26"}
  %input_reduce_fusion.121 = f32[] fusion(%input_reduce_fusion.26), kind=kInput, calls=%fused_reduce.121, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.121"}
  %get-tuple-element.4228 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.10), index=4, metadata={scheduling_name="get-tuple-element.4228"}
  %input_reduce_fusion.34 = f32[128]{0} fusion(%get-tuple-element.4228), kind=kInput, calls=%fused_reduce.34, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.34"}
  %input_convert_reduce_fusion.11 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.18, %loop_subtract_fusion, %param.43, %get-tuple-element.4254, %param.42, /*index=5*/%all-reduce-done.6, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.11, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.11"}
  %input_reduce_fusion.100 = f32[] fusion(%input_reduce_fusion.34), kind=kInput, calls=%fused_reduce.100, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.100"}
  %get-tuple-element.4207 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.11), index=2, metadata={scheduling_name="get-tuple-element.4207"}
  %input_reduce_fusion.25 = f32[128]{0} fusion(%get-tuple-element.4207), kind=kInput, calls=%fused_reduce.25, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.25"}
  %input_reduce_fusion.72 = f32[] fusion(%input_reduce_fusion.25), kind=kInput, calls=%fused_reduce.72, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.72"}
  %get-tuple-element.4229 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.11), index=4, metadata={scheduling_name="get-tuple-element.4229"}
  %input_reduce_fusion.33 = f32[128]{0} fusion(%get-tuple-element.4229), kind=kInput, calls=%fused_reduce.33, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.33"}
  %input_convert_reduce_fusion.13 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.27, %loop_subtract_fusion, %param.61, %get-tuple-element.4254, %param.60, /*index=5*/%all-reduce-done.9, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.13, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.13"}
  %input_reduce_fusion.101 = f32[] fusion(%input_reduce_fusion.33), kind=kInput, calls=%fused_reduce.101, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.101"}
  %get-tuple-element.4165 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.13), index=2, metadata={scheduling_name="get-tuple-element.4165"}
  %input_reduce_fusion.23 = f32[128]{0} fusion(%get-tuple-element.4165), kind=kInput, calls=%fused_reduce.23, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.23"}
  %input_reduce_fusion.76 = f32[] fusion(%input_reduce_fusion.23), kind=kInput, calls=%fused_reduce.76, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.76"}
  %get-tuple-element.4235 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.13), index=4, metadata={scheduling_name="get-tuple-element.4235"}
  %input_reduce_fusion.31 = f32[128]{0} fusion(%get-tuple-element.4235), kind=kInput, calls=%fused_reduce.31, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.31"}
  %input_convert_reduce_fusion.12 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.19, %loop_subtract_fusion, %param.45, %get-tuple-element.4254, %param.44, /*index=5*/%all-reduce-done.7, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.12, metadata={deduplicated_name="input_convert_reduce_fusion.12" scheduling_name="input_convert_reduce_fusion.12"}
  %input_reduce_fusion.107 = f32[] fusion(%input_reduce_fusion.31), kind=kInput, calls=%fused_reduce.107, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.107"}
  %get-tuple-element.4203 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.12), index=2, metadata={scheduling_name="get-tuple-element.4203"}
  %input_reduce_fusion.24 = f32[128]{0} fusion(%get-tuple-element.4203), kind=kInput, calls=%fused_reduce.24, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.24"}
  %input_reduce_fusion.71 = f32[] fusion(%input_reduce_fusion.24), kind=kInput, calls=%fused_reduce.71, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.71"}
  %get-tuple-element.4230 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.12), index=4, metadata={scheduling_name="get-tuple-element.4230"}
  %input_reduce_fusion.32 = f32[128]{0} fusion(%get-tuple-element.4230), kind=kInput, calls=%fused_reduce.32, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.32"}
  %input_convert_reduce_fusion.14 = (bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.28, %loop_subtract_fusion, %param.63, %get-tuple-element.4254, %param.62, /*index=5*/%all-reduce-done.10, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.14, metadata={deduplicated_name="input_convert_reduce_fusion.10" scheduling_name="input_convert_reduce_fusion.14"}
  %input_reduce_fusion.102 = f32[] fusion(%input_reduce_fusion.32), kind=kInput, calls=%fused_reduce.102, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.102"}
  %get-tuple-element.4161 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.14), index=2, metadata={scheduling_name="get-tuple-element.4161"}
  %input_reduce_fusion.22 = f32[128]{0} fusion(%get-tuple-element.4161), kind=kInput, calls=%fused_reduce.22, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.22"}
  %input_reduce_fusion.74 = f32[] fusion(%input_reduce_fusion.22), kind=kInput, calls=%fused_reduce.74, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.74"}
  %get-tuple-element.4236 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.14), index=4, metadata={scheduling_name="get-tuple-element.4236"}
  %input_reduce_fusion.30 = f32[128]{0} fusion(%get-tuple-element.4236), kind=kInput, calls=%fused_reduce.30, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.30"}
  %input_convert_reduce_fusion.15 = (bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, f32[24576]{0}) fusion(%param.29, %loop_subtract_fusion, %param.65, %get-tuple-element.4254, %param.64, /*index=5*/%all-reduce-done.11, %get-tuple-element.4226, %get-tuple-element.4225, %loop_multiply_fusion.7), kind=kInput, calls=%fused_convert_reduce.15, metadata={deduplicated_name="input_convert_reduce_fusion.12" scheduling_name="input_convert_reduce_fusion.15"}
  %input_reduce_fusion.108 = f32[] fusion(%input_reduce_fusion.30), kind=kInput, calls=%fused_reduce.108, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.108"}
  %get-tuple-element.4157 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.15), index=2, metadata={scheduling_name="get-tuple-element.4157"}
  %input_reduce_fusion.21 = f32[128]{0} fusion(%get-tuple-element.4157), kind=kInput, calls=%fused_reduce.21, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.21"}
  %input_reduce_fusion.75 = f32[] fusion(%input_reduce_fusion.21), kind=kInput, calls=%fused_reduce.75, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.75"}
  %get-tuple-element.4237 = f32[24576]{0} get-tuple-element(%input_convert_reduce_fusion.15), index=4, metadata={scheduling_name="get-tuple-element.4237"}
  %input_reduce_fusion.29 = f32[128]{0} fusion(%get-tuple-element.4237), kind=kInput, calls=%fused_reduce.29, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.21" scheduling_name="input_reduce_fusion.29"}
  %bitcast.32432 = f32[1]{0} bitcast(%input_reduce_fusion.118), metadata={scheduling_name="bitcast.32432"}
  %bitcast.32434 = f32[1]{0} bitcast(%input_reduce_fusion.114), metadata={scheduling_name="bitcast.32434"}
  %bitcast.32435 = f32[1]{0} bitcast(%input_reduce_fusion.99), metadata={scheduling_name="bitcast.32435"}
  %bitcast.32433 = f32[1]{0} bitcast(%input_reduce_fusion.120), metadata={scheduling_name="bitcast.32433"}
  %wrapped_concatenate.7 = f32[4]{0} fusion(%bitcast.32432, %bitcast.32433, %bitcast.32434, %bitcast.32435), kind=kLoop, calls=%wrapped_concatenate_computation.7, metadata={scheduling_name="wrapped_concatenate.7"}
  %input_reduce_fusion.109 = f32[] fusion(%input_reduce_fusion.29), kind=kInput, calls=%fused_reduce.109, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 deduplicated_name="input_reduce_fusion.71" scheduling_name="input_reduce_fusion.109"}
  %get-tuple-element.4218 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.6), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4218"}
  %bitcast.32471 = f32[1]{0} bitcast(%get-tuple-element.4218), metadata={scheduling_name="bitcast.32471"}
  %get-tuple-element.4213 = f32[] get-tuple-element(%input_convert_reduce_fusion.7), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4213"}
  %bitcast.32455 = f32[1]{0} bitcast(%get-tuple-element.4213), metadata={scheduling_name="bitcast.32455"}
  %get-tuple-element.4172 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.3), index=3, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4172"}
  %bitcast.32463 = f32[1]{0} bitcast(%get-tuple-element.4172), metadata={scheduling_name="bitcast.32463"}
  %get-tuple-element.4167 = f32[] get-tuple-element(%input_convert_reduce_fusion.4), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4167"}
  %bitcast.32447 = f32[1]{0} bitcast(%get-tuple-element.4167), metadata={scheduling_name="bitcast.32447"}
  %bitcast.32459 = f32[1]{0} bitcast(%input_reduce_fusion.110), metadata={scheduling_name="bitcast.32459"}
  %bitcast.32443 = f32[1]{0} bitcast(%input_reduce_fusion.80), metadata={scheduling_name="bitcast.32443"}
  %bitcast.32467 = f32[1]{0} bitcast(%input_reduce_fusion.103), metadata={scheduling_name="bitcast.32467"}
  %bitcast.32451 = f32[1]{0} bitcast(%input_reduce_fusion.73), metadata={scheduling_name="bitcast.32451"}
  %bitcast.32456 = f32[1]{0} bitcast(%input_reduce_fusion.113), metadata={scheduling_name="bitcast.32456"}
  %bitcast.32440 = f32[1]{0} bitcast(%input_reduce_fusion.117), metadata={scheduling_name="bitcast.32440"}
  %bitcast.32464 = f32[1]{0} bitcast(%input_reduce_fusion.106), metadata={scheduling_name="bitcast.32464"}
  %bitcast.32448 = f32[1]{0} bitcast(%input_reduce_fusion.77), metadata={scheduling_name="bitcast.32448"}
  %bitcast.32465 = f32[1]{0} bitcast(%input_reduce_fusion.105), metadata={scheduling_name="bitcast.32465"}
  %bitcast.32449 = f32[1]{0} bitcast(%input_reduce_fusion.78), metadata={scheduling_name="bitcast.32449"}
  %bitcast.32458 = f32[1]{0} bitcast(%input_reduce_fusion.111), metadata={scheduling_name="bitcast.32458"}
  %bitcast.32442 = f32[1]{0} bitcast(%input_reduce_fusion.115), metadata={scheduling_name="bitcast.32442"}
  %bitcast.32457 = f32[1]{0} bitcast(%input_reduce_fusion.112), metadata={scheduling_name="bitcast.32457"}
  %bitcast.32441 = f32[1]{0} bitcast(%input_reduce_fusion.82), metadata={scheduling_name="bitcast.32441"}
  %bitcast.32466 = f32[1]{0} bitcast(%input_reduce_fusion.104), metadata={scheduling_name="bitcast.32466"}
  %bitcast.32450 = f32[1]{0} bitcast(%input_reduce_fusion.79), metadata={scheduling_name="bitcast.32450"}
  %bitcast.32454 = f32[1]{0} bitcast(%input_reduce_fusion.121), metadata={scheduling_name="bitcast.32454"}
  %bitcast.32470 = f32[1]{0} bitcast(%input_reduce_fusion.100), metadata={scheduling_name="bitcast.32470"}
  %bitcast.32453 = f32[1]{0} bitcast(%input_reduce_fusion.72), metadata={scheduling_name="bitcast.32453"}
  %bitcast.32469 = f32[1]{0} bitcast(%input_reduce_fusion.101), metadata={scheduling_name="bitcast.32469"}
  %bitcast.32446 = f32[1]{0} bitcast(%input_reduce_fusion.76), metadata={scheduling_name="bitcast.32446"}
  %bitcast.32462 = f32[1]{0} bitcast(%input_reduce_fusion.107), metadata={scheduling_name="bitcast.32462"}
  %bitcast.32452 = f32[1]{0} bitcast(%input_reduce_fusion.71), metadata={scheduling_name="bitcast.32452"}
  %bitcast.32468 = f32[1]{0} bitcast(%input_reduce_fusion.102), metadata={scheduling_name="bitcast.32468"}
  %bitcast.32445 = f32[1]{0} bitcast(%input_reduce_fusion.74), metadata={scheduling_name="bitcast.32445"}
  %bitcast.32461 = f32[1]{0} bitcast(%input_reduce_fusion.108), metadata={scheduling_name="bitcast.32461"}
  %bitcast.32444 = f32[1]{0} bitcast(%input_reduce_fusion.75), metadata={scheduling_name="bitcast.32444"}
  %bitcast.32460 = f32[1]{0} bitcast(%input_reduce_fusion.109), metadata={scheduling_name="bitcast.32460"}
  %wrapped_concatenate.8 = f32[32]{0} fusion(%bitcast.32440, %bitcast.32441, %bitcast.32442, %bitcast.32443, %bitcast.32444, /*index=5*/%bitcast.32445, %bitcast.32446, %bitcast.32447, %bitcast.32448, %bitcast.32449, /*index=10*/%bitcast.32450, %bitcast.32451, %bitcast.32452, %bitcast.32453, %bitcast.32454, /*index=15*/%bitcast.32455, %bitcast.32456, %bitcast.32457, %bitcast.32458, %bitcast.32459, /*index=20*/%bitcast.32460, %bitcast.32461, %bitcast.32462, %bitcast.32463, %bitcast.32464, /*index=25*/%bitcast.32465, %bitcast.32466, %bitcast.32467, %bitcast.32468, %bitcast.32469, /*index=30*/%bitcast.32470, %bitcast.32471), kind=kLoop, calls=%wrapped_concatenate_computation.8, metadata={scheduling_name="wrapped_concatenate.8"}
  %wrapped_slice.60 = f32[1]{0} fusion(%all-reduce-done.12), kind=kLoop, calls=%wrapped_slice_computation.60, metadata={scheduling_name="wrapped_slice.60"}
  %wrapped_slice.39 = f32[1]{0} fusion(%all-reduce-done.12), kind=kLoop, calls=%wrapped_slice_computation.39, metadata={scheduling_name="wrapped_slice.39"}
  %all-reduce-done.21 = f32[8]{0} all-reduce-done(%all-reduce-start.21), metadata={scheduling_name="all-reduce-done.21"}
  %all-reduce-start.19 = f32[4]{0} all-reduce-start(%wrapped_concatenate.7), channel_id=491, replica_groups=[4,8]<=[32], use_global_device_ids=true, to_apply=%region_189.5599.clone, metadata={scheduling_name="all-reduce-start.19"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.99 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.99, metadata={scheduling_name="wrapped_slice.99"}
  %wrapped_slice.98 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.98, metadata={scheduling_name="wrapped_slice.98"}
  %wrapped_slice.89 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.89, metadata={scheduling_name="wrapped_slice.89"}
  %wrapped_slice.88 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.88, metadata={scheduling_name="wrapped_slice.88"}
  %wrapped_slice.77 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.77, metadata={scheduling_name="wrapped_slice.77"}
  %wrapped_slice.76 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.76, metadata={scheduling_name="wrapped_slice.76"}
  %wrapped_slice.67 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.67, metadata={scheduling_name="wrapped_slice.67"}
  %all-reduce-done.19 = f32[4]{0} all-reduce-done(%all-reduce-start.19), metadata={scheduling_name="all-reduce-done.19"}
  %all-reduce-start.20 = f32[32]{0} all-reduce-start(%wrapped_concatenate.8), channel_id=577, replica_groups={{0,1,2,3,4,5,6,7,16,17,18,19,20,21,22,23},{8,9,10,11,12,13,14,15,24,25,26,27,28,29,30,31}}, use_global_device_ids=true, to_apply=%region_188.5590.clone, metadata={scheduling_name="all-reduce-start.20"}, backend_config={"operation_queue_id":"0","wait_on_operation_queues":[],"collective_backend_config":{"is_sync":false,"is_pipelined":false,"reification_cost":[]},"force_earliest_schedule":false}
  %wrapped_slice.66 = f32[1]{0} fusion(%all-reduce-done.21), kind=kLoop, calls=%wrapped_slice_computation.66, metadata={scheduling_name="wrapped_slice.66"}
  %wrapped_slice.104 = f32[1]{0} fusion(%all-reduce-done.19), kind=kLoop, calls=%wrapped_slice_computation.104, metadata={scheduling_name="wrapped_slice.104"}
  %wrapped_slice.83 = f32[1]{0} fusion(%all-reduce-done.19), kind=kLoop, calls=%wrapped_slice_computation.83, metadata={scheduling_name="wrapped_slice.83"}
  %wrapped_slice.82 = f32[1]{0} fusion(%all-reduce-done.19), kind=kLoop, calls=%wrapped_slice_computation.82, metadata={scheduling_name="wrapped_slice.82"}
  %wrapped_slice.61 = f32[1]{0} fusion(%all-reduce-done.19), kind=kLoop, calls=%wrapped_slice_computation.61, metadata={scheduling_name="wrapped_slice.61"}
  %all-reduce-done.20 = f32[32]{0} all-reduce-done(%all-reduce-start.20), metadata={scheduling_name="all-reduce-done.20"}
  %wrapped_slice.103 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.103, metadata={scheduling_name="wrapped_slice.103"}
  %wrapped_slice.102 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.102, metadata={scheduling_name="wrapped_slice.102"}
  %wrapped_slice.101 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.101, metadata={scheduling_name="wrapped_slice.101"}
  %wrapped_slice.100 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.100, metadata={scheduling_name="wrapped_slice.100"}
  %wrapped_slice.97 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.97, metadata={scheduling_name="wrapped_slice.97"}
  %wrapped_slice.96 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.96, metadata={scheduling_name="wrapped_slice.96"}
  %wrapped_slice.95 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.95, metadata={scheduling_name="wrapped_slice.95"}
  %wrapped_slice.94 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.94, metadata={scheduling_name="wrapped_slice.94"}
  %wrapped_slice.93 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.93, metadata={scheduling_name="wrapped_slice.93"}
  %wrapped_slice.92 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.92, metadata={scheduling_name="wrapped_slice.92"}
  %wrapped_slice.91 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.91, metadata={scheduling_name="wrapped_slice.91"}
  %wrapped_slice.90 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.90, metadata={scheduling_name="wrapped_slice.90"}
  %wrapped_slice.87 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.87, metadata={scheduling_name="wrapped_slice.87"}
  %wrapped_slice.86 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.86, metadata={scheduling_name="wrapped_slice.86"}
  %wrapped_slice.85 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.85, metadata={scheduling_name="wrapped_slice.85"}
  %wrapped_slice.84 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.84, metadata={scheduling_name="wrapped_slice.84"}
  %wrapped_slice.81 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.81, metadata={scheduling_name="wrapped_slice.81"}
  %wrapped_slice.80 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.80, metadata={scheduling_name="wrapped_slice.80"}
  %wrapped_slice.79 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.79, metadata={scheduling_name="wrapped_slice.79"}
  %wrapped_slice.78 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.78, metadata={scheduling_name="wrapped_slice.78"}
  %wrapped_slice.75 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.75, metadata={scheduling_name="wrapped_slice.75"}
  %wrapped_slice.74 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.74, metadata={scheduling_name="wrapped_slice.74"}
  %wrapped_slice.73 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.73, metadata={scheduling_name="wrapped_slice.73"}
  %wrapped_slice.72 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.72, metadata={scheduling_name="wrapped_slice.72"}
  %wrapped_slice.71 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.71, metadata={scheduling_name="wrapped_slice.71"}
  %wrapped_slice.70 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.70, metadata={scheduling_name="wrapped_slice.70"}
  %wrapped_slice.69 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.69, metadata={scheduling_name="wrapped_slice.69"}
  %wrapped_slice.68 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.68, metadata={scheduling_name="wrapped_slice.68"}
  %wrapped_slice.65 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.65, metadata={scheduling_name="wrapped_slice.65"}
  %wrapped_slice.64 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.64, metadata={scheduling_name="wrapped_slice.64"}
  %wrapped_slice.63 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.63, metadata={scheduling_name="wrapped_slice.63"}
  %wrapped_slice.62 = f32[1]{0} fusion(%all-reduce-done.20), kind=kLoop, calls=%wrapped_slice_computation.62, metadata={scheduling_name="wrapped_slice.62"}
  %input_transpose_fusion.11 = bf16[32768,768]{1,0} fusion(%input_transpose_fusion.10), kind=kInput, calls=%fused_transpose.25, metadata={scheduling_name="input_transpose_fusion.11"}
  %bitcast.32431 = f32[] bitcast(%wrapped_slice.55), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32431"}
  %bitcast.32430 = f32[] bitcast(%wrapped_slice.54), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32430"}
  %bitcast.32429 = f32[] bitcast(%wrapped_slice.45), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32429"}
  %bitcast.32428 = f32[] bitcast(%wrapped_slice.44), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32428"}
  %bitcast.32393 = f32[] bitcast(%wrapped_slice.59), metadata={scheduling_name="bitcast.32393"}
  %bitcast.32392 = f32[] bitcast(%wrapped_slice.58), metadata={scheduling_name="bitcast.32392"}
  %bitcast.32391 = f32[] bitcast(%wrapped_slice.57), metadata={scheduling_name="bitcast.32391"}
  %bitcast.32390 = f32[] bitcast(%wrapped_slice.56), metadata={scheduling_name="bitcast.32390"}
  %bitcast.32389 = f32[] bitcast(%wrapped_slice.53), metadata={scheduling_name="bitcast.32389"}
  %bitcast.32388 = f32[] bitcast(%wrapped_slice.52), metadata={scheduling_name="bitcast.32388"}
  %bitcast.32387 = f32[] bitcast(%wrapped_slice.51), metadata={scheduling_name="bitcast.32387"}
  %bitcast.32386 = f32[] bitcast(%wrapped_slice.50), metadata={scheduling_name="bitcast.32386"}
  %bitcast.32385 = f32[] bitcast(%wrapped_slice.49), metadata={scheduling_name="bitcast.32385"}
  %bitcast.32384 = f32[] bitcast(%wrapped_slice.48), metadata={scheduling_name="bitcast.32384"}
  %bitcast.32383 = f32[] bitcast(%wrapped_slice.47), metadata={scheduling_name="bitcast.32383"}
  %bitcast.32382 = f32[] bitcast(%wrapped_slice.46), metadata={scheduling_name="bitcast.32382"}
  %bitcast.32381 = f32[] bitcast(%wrapped_slice.43), metadata={scheduling_name="bitcast.32381"}
  %bitcast.32380 = f32[] bitcast(%wrapped_slice.42), metadata={scheduling_name="bitcast.32380"}
  %bitcast.32379 = f32[] bitcast(%wrapped_slice.41), metadata={scheduling_name="bitcast.32379"}
  %bitcast.32378 = f32[] bitcast(%wrapped_slice.40), metadata={scheduling_name="bitcast.32378"}
  %bitcast.32325 = f32[] bitcast(%wrapped_slice.60), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32325"}
  %bitcast.32324 = f32[] bitcast(%wrapped_slice.39), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32324"}
  %get-tuple-element.4245 = f32[] get-tuple-element(%input_add_convert_reduce_fusion.7), index=3, metadata={scheduling_name="get-tuple-element.4245"}
  %get-tuple-element.4223 = f32[] get-tuple-element(%input_convert_reduce_fusion.21), index=0, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4223"}
  %bitcast.32519 = f32[] bitcast(%wrapped_slice.99), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32519"}
  %bitcast.32518 = f32[] bitcast(%wrapped_slice.98), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32518"}
  %bitcast.32517 = f32[] bitcast(%wrapped_slice.89), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32517"}
  %bitcast.32516 = f32[] bitcast(%wrapped_slice.88), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32516"}
  %bitcast.32515 = f32[] bitcast(%wrapped_slice.77), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32515"}
  %bitcast.32514 = f32[] bitcast(%wrapped_slice.76), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32514"}
  %bitcast.32513 = f32[] bitcast(%wrapped_slice.67), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32513"}
  %bitcast.32512 = f32[] bitcast(%wrapped_slice.66), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32512"}
  %bitcast.32439 = f32[] bitcast(%wrapped_slice.104), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32439"}
  %bitcast.32438 = f32[] bitcast(%wrapped_slice.83), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32438"}
  %bitcast.32437 = f32[] bitcast(%wrapped_slice.82), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32437"}
  %bitcast.32436 = f32[] bitcast(%wrapped_slice.61), metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="bitcast.32436"}
  %bitcast.32503 = f32[] bitcast(%wrapped_slice.103), metadata={scheduling_name="bitcast.32503"}
  %bitcast.32502 = f32[] bitcast(%wrapped_slice.102), metadata={scheduling_name="bitcast.32502"}
  %bitcast.32501 = f32[] bitcast(%wrapped_slice.101), metadata={scheduling_name="bitcast.32501"}
  %bitcast.32500 = f32[] bitcast(%wrapped_slice.100), metadata={scheduling_name="bitcast.32500"}
  %bitcast.32499 = f32[] bitcast(%wrapped_slice.97), metadata={scheduling_name="bitcast.32499"}
  %bitcast.32498 = f32[] bitcast(%wrapped_slice.96), metadata={scheduling_name="bitcast.32498"}
  %bitcast.32497 = f32[] bitcast(%wrapped_slice.95), metadata={scheduling_name="bitcast.32497"}
  %bitcast.32496 = f32[] bitcast(%wrapped_slice.94), metadata={scheduling_name="bitcast.32496"}
  %bitcast.32495 = f32[] bitcast(%wrapped_slice.93), metadata={scheduling_name="bitcast.32495"}
  %bitcast.32494 = f32[] bitcast(%wrapped_slice.92), metadata={scheduling_name="bitcast.32494"}
  %bitcast.32493 = f32[] bitcast(%wrapped_slice.91), metadata={scheduling_name="bitcast.32493"}
  %bitcast.32492 = f32[] bitcast(%wrapped_slice.90), metadata={scheduling_name="bitcast.32492"}
  %bitcast.32491 = f32[] bitcast(%wrapped_slice.87), metadata={scheduling_name="bitcast.32491"}
  %bitcast.32490 = f32[] bitcast(%wrapped_slice.86), metadata={scheduling_name="bitcast.32490"}
  %bitcast.32489 = f32[] bitcast(%wrapped_slice.85), metadata={scheduling_name="bitcast.32489"}
  %bitcast.32488 = f32[] bitcast(%wrapped_slice.84), metadata={scheduling_name="bitcast.32488"}
  %bitcast.32487 = f32[] bitcast(%wrapped_slice.81), metadata={scheduling_name="bitcast.32487"}
  %bitcast.32486 = f32[] bitcast(%wrapped_slice.80), metadata={scheduling_name="bitcast.32486"}
  %bitcast.32485 = f32[] bitcast(%wrapped_slice.79), metadata={scheduling_name="bitcast.32485"}
  %bitcast.32484 = f32[] bitcast(%wrapped_slice.78), metadata={scheduling_name="bitcast.32484"}
  %bitcast.32483 = f32[] bitcast(%wrapped_slice.75), metadata={scheduling_name="bitcast.32483"}
  %bitcast.32482 = f32[] bitcast(%wrapped_slice.74), metadata={scheduling_name="bitcast.32482"}
  %bitcast.32481 = f32[] bitcast(%wrapped_slice.73), metadata={scheduling_name="bitcast.32481"}
  %bitcast.32480 = f32[] bitcast(%wrapped_slice.72), metadata={scheduling_name="bitcast.32480"}
  %bitcast.32479 = f32[] bitcast(%wrapped_slice.71), metadata={scheduling_name="bitcast.32479"}
  %bitcast.32478 = f32[] bitcast(%wrapped_slice.70), metadata={scheduling_name="bitcast.32478"}
  %bitcast.32477 = f32[] bitcast(%wrapped_slice.69), metadata={scheduling_name="bitcast.32477"}
  %bitcast.32476 = f32[] bitcast(%wrapped_slice.68), metadata={scheduling_name="bitcast.32476"}
  %bitcast.32475 = f32[] bitcast(%wrapped_slice.65), metadata={scheduling_name="bitcast.32475"}
  %bitcast.32474 = f32[] bitcast(%wrapped_slice.64), metadata={scheduling_name="bitcast.32474"}
  %bitcast.32473 = f32[] bitcast(%wrapped_slice.63), metadata={scheduling_name="bitcast.32473"}
  %bitcast.32472 = f32[] bitcast(%wrapped_slice.62), metadata={scheduling_name="bitcast.32472"}
  %loop_convert_fusion.20 = (bf16[], bf16[], bf16[]) fusion(%bitcast.32324, %bitcast.32378, %bitcast.32379, %bitcast.32380, %bitcast.32381, /*index=5*/%bitcast.32428, %bitcast.32429, %bitcast.32382, %bitcast.32383, %bitcast.32384, /*index=10*/%bitcast.32385, %bitcast.32386, %bitcast.32387, %bitcast.32388, %bitcast.32389, /*index=15*/%bitcast.32430, %bitcast.32431, %bitcast.32390, %bitcast.32391, %bitcast.32392, /*index=20*/%bitcast.32393, %input_reduce_fusion.68, %bitcast.32325, %bitcast.32436, %bitcast.32472, /*index=25*/%bitcast.32473, %bitcast.32474, %bitcast.32475, %bitcast.32512, %bitcast.32513, /*index=30*/%bitcast.32476, %bitcast.32477, %bitcast.32478, %bitcast.32479, %bitcast.32480, /*index=35*/%bitcast.32481, %bitcast.32482, %bitcast.32483, %bitcast.32514, %bitcast.32515, /*index=40*/%bitcast.32484, %bitcast.32485, %bitcast.32486, %bitcast.32487, %get-tuple-element.4223, /*index=45*/%bitcast.32437, %bitcast.32438, %bitcast.32488, %bitcast.32489, %bitcast.32490, /*index=50*/%bitcast.32491, %bitcast.32516, %bitcast.32517, %bitcast.32492, %bitcast.32493, /*index=55*/%bitcast.32494, %bitcast.32495, %bitcast.32496, %bitcast.32497, %bitcast.32498, /*index=60*/%bitcast.32499, %bitcast.32518, %bitcast.32519, %bitcast.32500, %bitcast.32501, /*index=65*/%bitcast.32502, %bitcast.32503, %get-tuple-element.4245, %bitcast.32439), kind=kLoop, calls=%fused_convert.20, metadata={scheduling_name="loop_convert_fusion.20"}
  %get-tuple-element.4853 = s32[] get-tuple-element(%loop_add_select_fusion), index=1, metadata={op_name="jit(train_step)/jit(main)/jit(_where)/select_n" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4853"}
  %get-tuple-element.4782 = s32[] get-tuple-element(%loop_add_select_fusion), index=0, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4782"}
  %get-tuple-element.4889 = f32[] get-tuple-element(%copy_fusion), index=2, metadata={scheduling_name="get-tuple-element.4889"}
  %bitcast.32546 = f32[] bitcast(%get-tuple-element.4889), metadata={op_name="jit(train_step)/jit(main)/div" source_file="/workspace/maxtext/MaxText/train.py" source_line=320 scheduling_name="bitcast.32546"}
  %get-tuple-element.4888 = f32[] get-tuple-element(%copy_fusion), index=1, metadata={scheduling_name="get-tuple-element.4888"}
  %bitcast.32545 = f32[] bitcast(%get-tuple-element.4888), metadata={scheduling_name="bitcast.32545"}
  %get-tuple-element.4887 = f32[] get-tuple-element(%copy_fusion), index=0, metadata={scheduling_name="get-tuple-element.4887"}
  %bitcast.32544 = f32[] bitcast(%get-tuple-element.4887), metadata={scheduling_name="bitcast.32544"}
  %get-tuple-element.4830 = bf16[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=1, metadata={scheduling_name="get-tuple-element.4830"}
  %get-tuple-element.4807 = bf16[6144]{0} get-tuple-element(%input_add_convert_reduce_fusion.7), index=0, metadata={scheduling_name="get-tuple-element.4807"}
  %get-tuple-element.4783 = bf16[6144]{0} get-tuple-element(%input_convert_reduce_fusion.21), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4783"}
  %get-tuple-element.4809 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4809"}
  %get-tuple-element.4832 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4832"}
  %get-tuple-element.4785 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.7), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4785"}
  %get-tuple-element.4813 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4813"}
  %get-tuple-element.4836 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.5), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4836"}
  %get-tuple-element.4789 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.6), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4789"}
  %get-tuple-element.4824 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4824"}
  %get-tuple-element.4847 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.1), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4847"}
  %get-tuple-element.4800 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4800"}
  %get-tuple-element.4814 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4814"}
  %get-tuple-element.4837 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4837"}
  %get-tuple-element.4790 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.5), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4790"}
  %get-tuple-element.4819 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4819"}
  %get-tuple-element.4842 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4842"}
  %get-tuple-element.4795 = bf16[2,1,768,8]{3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.4), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4795"}
  %get-tuple-element.4823 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=2, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4823"}
  %get-tuple-element.4846 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_add_convert_reduce_fusion.2), index=1, metadata={op_name="jit(train_step)/jit(main)/add" source_file="/workspace/maxtext/MaxText/train.py" source_line=447 scheduling_name="get-tuple-element.4846"}
  %get-tuple-element.4799 = bf16[2,1,6144]{2,1,0} get-tuple-element(%input_convert_reduce_fusion.3), index=1, metadata={op_name="jit(train_step)/jit(main)/reduce_sum" source_file="/workspace/maxtext/MaxText/max_utils.py" source_line=73 scheduling_name="get-tuple-element.4799"}
  %get-tuple-element.4848 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=3, metadata={scheduling_name="get-tuple-element.4848"}
  %get-tuple-element.4825 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=1, metadata={scheduling_name="get-tuple-element.4825"}
  %get-tuple-element.4801 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.24), index=0, metadata={scheduling_name="get-tuple-element.4801"}
  %get-tuple-element.4838 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=3, metadata={scheduling_name="get-tuple-element.4838"}
  %get-tuple-element.4815 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=1, metadata={scheduling_name="get-tuple-element.4815"}
  %get-tuple-element.4791 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.22), index=0, metadata={scheduling_name="get-tuple-element.4791"}
  %get-tuple-element.4851 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=3, metadata={scheduling_name="get-tuple-element.4851"}
  %get-tuple-element.4828 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=1, metadata={scheduling_name="get-tuple-element.4828"}
  %get-tuple-element.4804 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.25), index=0, metadata={scheduling_name="get-tuple-element.4804"}
  %get-tuple-element.4841 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=3, metadata={scheduling_name="get-tuple-element.4841"}
  %get-tuple-element.4818 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=1, metadata={scheduling_name="get-tuple-element.4818"}
  %get-tuple-element.4794 = bf16[2,1,768,8,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.23), index=0, metadata={scheduling_name="get-tuple-element.4794"}
  %get-tuple-element.4840 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=3, metadata={scheduling_name="get-tuple-element.4840"}
  %get-tuple-element.4817 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=1, metadata={scheduling_name="get-tuple-element.4817"}
  %get-tuple-element.4793 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.18), index=0, metadata={scheduling_name="get-tuple-element.4793"}
  %get-tuple-element.4849 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=3, metadata={scheduling_name="get-tuple-element.4849"}
  %get-tuple-element.4826 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=1, metadata={scheduling_name="get-tuple-element.4826"}
  %get-tuple-element.4802 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.19), index=0, metadata={scheduling_name="get-tuple-element.4802"}
  %get-tuple-element.4850 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=3, metadata={scheduling_name="get-tuple-element.4850"}
  %get-tuple-element.4827 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.4827"}
  %get-tuple-element.4803 = bf16[2,1,768,48,128]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.4803"}
  %get-tuple-element.4839 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=3, metadata={scheduling_name="get-tuple-element.4839"}
  %get-tuple-element.4816 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=1, metadata={scheduling_name="get-tuple-element.4816"}
  %get-tuple-element.4792 = bf16[2,1,48,128,768]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.17), index=0, metadata={scheduling_name="get-tuple-element.4792"}
  %get-tuple-element.4829 = bf16[32768,768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=1, metadata={scheduling_name="get-tuple-element.4829"}
  %get-tuple-element.4852 = bf16[32768,768]{1,0} get-tuple-element(%input_select_transpose_fusion), index=0, metadata={scheduling_name="get-tuple-element.4852"}
  %get-tuple-element.4831 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=3, metadata={scheduling_name="get-tuple-element.4831"}
  %get-tuple-element.4808 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=1, metadata={scheduling_name="get-tuple-element.4808"}
  %get-tuple-element.4784 = bf16[768,32768]{1,0} get-tuple-element(%input_convert_reduce_fusion.16), index=0, metadata={scheduling_name="get-tuple-element.4784"}
  %get-tuple-element.4833 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=3, metadata={scheduling_name="get-tuple-element.4833"}
  %get-tuple-element.4810 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=1, metadata={scheduling_name="get-tuple-element.4810"}
  %get-tuple-element.4786 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.10), index=0, metadata={scheduling_name="get-tuple-element.4786"}
  %get-tuple-element.4834 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=3, metadata={scheduling_name="get-tuple-element.4834"}
  %get-tuple-element.4811 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=1, metadata={scheduling_name="get-tuple-element.4811"}
  %get-tuple-element.4787 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.11), index=0, metadata={scheduling_name="get-tuple-element.4787"}
  %get-tuple-element.4843 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=3, metadata={scheduling_name="get-tuple-element.4843"}
  %get-tuple-element.4820 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=1, metadata={scheduling_name="get-tuple-element.4820"}
  %get-tuple-element.4796 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.13), index=0, metadata={scheduling_name="get-tuple-element.4796"}
  %get-tuple-element.4835 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=3, metadata={scheduling_name="get-tuple-element.4835"}
  %get-tuple-element.4812 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=1, metadata={scheduling_name="get-tuple-element.4812"}
  %get-tuple-element.4788 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.12), index=0, metadata={scheduling_name="get-tuple-element.4788"}
  %get-tuple-element.4844 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=3, metadata={scheduling_name="get-tuple-element.4844"}
  %get-tuple-element.4821 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=1, metadata={scheduling_name="get-tuple-element.4821"}
  %get-tuple-element.4797 = bf16[2,1,1,6144,16384]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.14), index=0, metadata={scheduling_name="get-tuple-element.4797"}
  %get-tuple-element.4845 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=3, metadata={scheduling_name="get-tuple-element.4845"}
  %get-tuple-element.4822 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=1, metadata={scheduling_name="get-tuple-element.4822"}
  %get-tuple-element.4798 = bf16[2,1,1,16384,6144]{4,3,2,1,0} get-tuple-element(%input_convert_reduce_fusion.15), index=0, metadata={scheduling_name="get-tuple-element.4798"}
  %get-tuple-element.4854 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=2, metadata={scheduling_name="get-tuple-element.4854"}
  %get-tuple-element.4858 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=1, metadata={scheduling_name="get-tuple-element.4858"}
  %get-tuple-element.4859 = bf16[] get-tuple-element(%loop_convert_fusion.20), index=0, metadata={scheduling_name="get-tuple-element.4859"}
  ROOT %tuple.672 = (s32[], bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=5*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=10*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=15*/bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=20*/bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, s32[], /*index=25*/bf16[6144]{0}, bf16[768,32768]{1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=30*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=35*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, /*index=40*/bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, /*index=45*/bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[32768,768]{1,0}, bf16[6144]{0}, bf16[768,32768]{1,0}, /*index=50*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=55*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=60*/bf16[2,1,768,8]{3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,6144,16384]{4,3,2,1,0}, bf16[2,1,1,16384,6144]{4,3,2,1,0}, bf16[2,1,6144]{2,1,0}, /*index=65*/bf16[2,1,6144]{2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, bf16[2,1,48,128,768]{4,3,2,1,0}, bf16[2,1,768,48,128]{4,3,2,1,0}, bf16[2,1,768,8,128]{4,3,2,1,0}, /*index=70*/bf16[32768,768]{1,0}, s32[], bf16[], f32[], f32[], /*index=75*/f32[], bf16[], bf16[], s32[]) tuple(%get-tuple-element.4782, %get-tuple-element.4783, %get-tuple-element.4784, %get-tuple-element.4785, %get-tuple-element.4786, /*index=5*/%get-tuple-element.4787, %get-tuple-element.4788, %get-tuple-element.4789, %get-tuple-element.4790, %get-tuple-element.4791, /*index=10*/%get-tuple-element.4792, %get-tuple-element.4793, %get-tuple-element.4794, %get-tuple-element.4795, %get-tuple-element.4796, /*index=15*/%get-tuple-element.4797, %get-tuple-element.4798, %get-tuple-element.4799, %get-tuple-element.4800, %get-tuple-element.4801, /*index=20*/%get-tuple-element.4802, %get-tuple-element.4803, %get-tuple-element.4804, %input_transpose_fusion.11, %get-tuple-element.4806, /*index=25*/%get-tuple-element.4807, %get-tuple-element.4808, %get-tuple-element.4809, %get-tuple-element.4810, %get-tuple-element.4811, /*index=30*/%get-tuple-element.4812, %get-tuple-element.4813, %get-tuple-element.4814, %get-tuple-element.4815, %get-tuple-element.4816, /*index=35*/%get-tuple-element.4817, %get-tuple-element.4818, %get-tuple-element.4819, %get-tuple-element.4820, %get-tuple-element.4821, /*index=40*/%get-tuple-element.4822, %get-tuple-element.4823, %get-tuple-element.4824, %get-tuple-element.4825, %get-tuple-element.4826, /*index=45*/%get-tuple-element.4827, %get-tuple-element.4828, %get-tuple-element.4829, %get-tuple-element.4830, %get-tuple-element.4831, /*index=50*/%get-tuple-element.4832, %get-tuple-element.4833, %get-tuple-element.4834, %get-tuple-element.4835, %get-tuple-element.4836, /*index=55*/%get-tuple-element.4837, %get-tuple-element.4838, %get-tuple-element.4839, %get-tuple-element.4840, %get-tuple-element.4841, /*index=60*/%get-tuple-element.4842, %get-tuple-element.4843, %get-tuple-element.4844, %get-tuple-element.4845, %get-tuple-element.4846, /*index=65*/%get-tuple-element.4847, %get-tuple-element.4848, %get-tuple-element.4849, %get-tuple-element.4850, %get-tuple-element.4851, /*index=70*/%get-tuple-element.4852, %get-tuple-element.4853, %get-tuple-element.4854, %bitcast.32546, %bitcast.32544, /*index=75*/%bitcast.32545, %get-tuple-element.4858, %get-tuple-element.4859, %all-reduce-done), metadata={scheduling_name="tuple.672"}
}

